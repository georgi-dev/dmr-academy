{"version":3,"sources":["build/node_modules/browser-pack/_prelude.js","build/node_modules/codemirror/lib/codemirror.js","build/vendors/summernote/build/vendors/summernote/summernote.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"summernote.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n\n// This is CodeMirror (http://codemirror.net), a code editor\n// implemented in JavaScript on top of the browser's DOM.\n//\n// You can find some technical background for some of the code below\n// at http://marijnhaverbeke.nl/blog/#cm-internals .\n\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.CodeMirror = factory());\n}(this, (function () { 'use strict';\n\n// Kludges for bugs and behavior differences that can't be feature\n// detected are enabled based on userAgent etc sniffing.\nvar userAgent = navigator.userAgent;\nvar platform = navigator.platform;\n\nvar gecko = /gecko\\/\\d/i.test(userAgent);\nvar ie_upto10 = /MSIE \\d/.test(userAgent);\nvar ie_11up = /Trident\\/(?:[7-9]|\\d{2,})\\..*rv:(\\d+)/.exec(userAgent);\nvar edge = /Edge\\/(\\d+)/.exec(userAgent);\nvar ie = ie_upto10 || ie_11up || edge;\nvar ie_version = ie && (ie_upto10 ? document.documentMode || 6 : +(edge || ie_11up)[1]);\nvar webkit = !edge && /WebKit\\//.test(userAgent);\nvar qtwebkit = webkit && /Qt\\/\\d+\\.\\d+/.test(userAgent);\nvar chrome = !edge && /Chrome\\//.test(userAgent);\nvar presto = /Opera\\//.test(userAgent);\nvar safari = /Apple Computer/.test(navigator.vendor);\nvar mac_geMountainLion = /Mac OS X 1\\d\\D([8-9]|\\d\\d)\\D/.test(userAgent);\nvar phantom = /PhantomJS/.test(userAgent);\n\nvar ios = !edge && /AppleWebKit/.test(userAgent) && /Mobile\\/\\w+/.test(userAgent);\nvar android = /Android/.test(userAgent);\n// This is woefully incomplete. Suggestions for alternative methods welcome.\nvar mobile = ios || android || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);\nvar mac = ios || /Mac/.test(platform);\nvar chromeOS = /\\bCrOS\\b/.test(userAgent);\nvar windows = /win/i.test(platform);\n\nvar presto_version = presto && userAgent.match(/Version\\/(\\d*\\.\\d*)/);\nif (presto_version) { presto_version = Number(presto_version[1]); }\nif (presto_version && presto_version >= 15) { presto = false; webkit = true; }\n// Some browsers use the wrong event properties to signal cmd/ctrl on OS X\nvar flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));\nvar captureRightClick = gecko || (ie && ie_version >= 9);\n\nfunction classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\") }\n\nvar rmClass = function(node, cls) {\n  var current = node.className;\n  var match = classTest(cls).exec(current);\n  if (match) {\n    var after = current.slice(match.index + match[0].length);\n    node.className = current.slice(0, match.index) + (after ? match[1] + after : \"\");\n  }\n};\n\nfunction removeChildren(e) {\n  for (var count = e.childNodes.length; count > 0; --count)\n    { e.removeChild(e.firstChild); }\n  return e\n}\n\nfunction removeChildrenAndAdd(parent, e) {\n  return removeChildren(parent).appendChild(e)\n}\n\nfunction elt(tag, content, className, style) {\n  var e = document.createElement(tag);\n  if (className) { e.className = className; }\n  if (style) { e.style.cssText = style; }\n  if (typeof content == \"string\") { e.appendChild(document.createTextNode(content)); }\n  else if (content) { for (var i = 0; i < content.length; ++i) { e.appendChild(content[i]); } }\n  return e\n}\n// wrapper for elt, which removes the elt from the accessibility tree\nfunction eltP(tag, content, className, style) {\n  var e = elt(tag, content, className, style);\n  e.setAttribute(\"role\", \"presentation\");\n  return e\n}\n\nvar range;\nif (document.createRange) { range = function(node, start, end, endNode) {\n  var r = document.createRange();\n  r.setEnd(endNode || node, end);\n  r.setStart(node, start);\n  return r\n}; }\nelse { range = function(node, start, end) {\n  var r = document.body.createTextRange();\n  try { r.moveToElementText(node.parentNode); }\n  catch(e) { return r }\n  r.collapse(true);\n  r.moveEnd(\"character\", end);\n  r.moveStart(\"character\", start);\n  return r\n}; }\n\nfunction contains(parent, child) {\n  if (child.nodeType == 3) // Android browser always returns false when child is a textnode\n    { child = child.parentNode; }\n  if (parent.contains)\n    { return parent.contains(child) }\n  do {\n    if (child.nodeType == 11) { child = child.host; }\n    if (child == parent) { return true }\n  } while (child = child.parentNode)\n}\n\nfunction activeElt() {\n  // IE and Edge may throw an \"Unspecified Error\" when accessing document.activeElement.\n  // IE < 10 will throw when accessed while the page is loading or in an iframe.\n  // IE > 9 and Edge will throw when accessed in an iframe if document.body is unavailable.\n  var activeElement;\n  try {\n    activeElement = document.activeElement;\n  } catch(e) {\n    activeElement = document.body || null;\n  }\n  while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement)\n    { activeElement = activeElement.shadowRoot.activeElement; }\n  return activeElement\n}\n\nfunction addClass(node, cls) {\n  var current = node.className;\n  if (!classTest(cls).test(current)) { node.className += (current ? \" \" : \"\") + cls; }\n}\nfunction joinClasses(a, b) {\n  var as = a.split(\" \");\n  for (var i = 0; i < as.length; i++)\n    { if (as[i] && !classTest(as[i]).test(b)) { b += \" \" + as[i]; } }\n  return b\n}\n\nvar selectInput = function(node) { node.select(); };\nif (ios) // Mobile Safari apparently has a bug where select() is broken.\n  { selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; }; }\nelse if (ie) // Suppress mysterious IE10 errors\n  { selectInput = function(node) { try { node.select(); } catch(_e) {} }; }\n\nfunction bind(f) {\n  var args = Array.prototype.slice.call(arguments, 1);\n  return function(){return f.apply(null, args)}\n}\n\nfunction copyObj(obj, target, overwrite) {\n  if (!target) { target = {}; }\n  for (var prop in obj)\n    { if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))\n      { target[prop] = obj[prop]; } }\n  return target\n}\n\n// Counts the column offset in a string, taking tabs into account.\n// Used mostly to find indentation.\nfunction countColumn(string, end, tabSize, startIndex, startValue) {\n  if (end == null) {\n    end = string.search(/[^\\s\\u00a0]/);\n    if (end == -1) { end = string.length; }\n  }\n  for (var i = startIndex || 0, n = startValue || 0;;) {\n    var nextTab = string.indexOf(\"\\t\", i);\n    if (nextTab < 0 || nextTab >= end)\n      { return n + (end - i) }\n    n += nextTab - i;\n    n += tabSize - (n % tabSize);\n    i = nextTab + 1;\n  }\n}\n\nvar Delayed = function() {this.id = null;};\nDelayed.prototype.set = function (ms, f) {\n  clearTimeout(this.id);\n  this.id = setTimeout(f, ms);\n};\n\nfunction indexOf(array, elt) {\n  for (var i = 0; i < array.length; ++i)\n    { if (array[i] == elt) { return i } }\n  return -1\n}\n\n// Number of pixels added to scroller and sizer to hide scrollbar\nvar scrollerGap = 30;\n\n// Returned or thrown by various protocols to signal 'I'm not\n// handling this'.\nvar Pass = {toString: function(){return \"CodeMirror.Pass\"}};\n\n// Reused option objects for setSelection & friends\nvar sel_dontScroll = {scroll: false};\nvar sel_mouse = {origin: \"*mouse\"};\nvar sel_move = {origin: \"+move\"};\n\n// The inverse of countColumn -- find the offset that corresponds to\n// a particular column.\nfunction findColumn(string, goal, tabSize) {\n  for (var pos = 0, col = 0;;) {\n    var nextTab = string.indexOf(\"\\t\", pos);\n    if (nextTab == -1) { nextTab = string.length; }\n    var skipped = nextTab - pos;\n    if (nextTab == string.length || col + skipped >= goal)\n      { return pos + Math.min(skipped, goal - col) }\n    col += nextTab - pos;\n    col += tabSize - (col % tabSize);\n    pos = nextTab + 1;\n    if (col >= goal) { return pos }\n  }\n}\n\nvar spaceStrs = [\"\"];\nfunction spaceStr(n) {\n  while (spaceStrs.length <= n)\n    { spaceStrs.push(lst(spaceStrs) + \" \"); }\n  return spaceStrs[n]\n}\n\nfunction lst(arr) { return arr[arr.length-1] }\n\nfunction map(array, f) {\n  var out = [];\n  for (var i = 0; i < array.length; i++) { out[i] = f(array[i], i); }\n  return out\n}\n\nfunction insertSorted(array, value, score) {\n  var pos = 0, priority = score(value);\n  while (pos < array.length && score(array[pos]) <= priority) { pos++; }\n  array.splice(pos, 0, value);\n}\n\nfunction nothing() {}\n\nfunction createObj(base, props) {\n  var inst;\n  if (Object.create) {\n    inst = Object.create(base);\n  } else {\n    nothing.prototype = base;\n    inst = new nothing();\n  }\n  if (props) { copyObj(props, inst); }\n  return inst\n}\n\nvar nonASCIISingleCaseWordChar = /[\\u00df\\u0587\\u0590-\\u05f4\\u0600-\\u06ff\\u3040-\\u309f\\u30a0-\\u30ff\\u3400-\\u4db5\\u4e00-\\u9fcc\\uac00-\\ud7af]/;\nfunction isWordCharBasic(ch) {\n  return /\\w/.test(ch) || ch > \"\\x80\" &&\n    (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch))\n}\nfunction isWordChar(ch, helper) {\n  if (!helper) { return isWordCharBasic(ch) }\n  if (helper.source.indexOf(\"\\\\w\") > -1 && isWordCharBasic(ch)) { return true }\n  return helper.test(ch)\n}\n\nfunction isEmpty(obj) {\n  for (var n in obj) { if (obj.hasOwnProperty(n) && obj[n]) { return false } }\n  return true\n}\n\n// Extending unicode characters. A series of a non-extending char +\n// any number of extending chars is treated as a single unit as far\n// as editing and measuring is concerned. This is not fully correct,\n// since some scripts/fonts/browsers also treat other configurations\n// of code points as a group.\nvar extendingChars = /[\\u0300-\\u036f\\u0483-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1\\u05c2\\u05c4\\u05c5\\u05c7\\u0610-\\u061a\\u064b-\\u065e\\u0670\\u06d6-\\u06dc\\u06de-\\u06e4\\u06e7\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0900-\\u0902\\u093c\\u0941-\\u0948\\u094d\\u0951-\\u0955\\u0962\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2\\u09e3\\u0a01\\u0a02\\u0a3c\\u0a41\\u0a42\\u0a47\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70\\u0a71\\u0a75\\u0a81\\u0a82\\u0abc\\u0ac1-\\u0ac5\\u0ac7\\u0ac8\\u0acd\\u0ae2\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57\\u0b62\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55\\u0c56\\u0c62\\u0c63\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc\\u0ccd\\u0cd5\\u0cd6\\u0ce2\\u0ce3\\u0d3e\\u0d41-\\u0d44\\u0d4d\\u0d57\\u0d62\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9\\u0ebb\\u0ebc\\u0ec8-\\u0ecd\\u0f18\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86\\u0f87\\u0f90-\\u0f97\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039\\u103a\\u103d\\u103e\\u1058\\u1059\\u105e-\\u1060\\u1071-\\u1074\\u1082\\u1085\\u1086\\u108d\\u109d\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752\\u1753\\u1772\\u1773\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927\\u1928\\u1932\\u1939-\\u193b\\u1a17\\u1a18\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1b00-\\u1b03\\u1b34\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80\\u1b81\\u1ba2-\\u1ba5\\u1ba8\\u1ba9\\u1c2c-\\u1c33\\u1c36\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1dc0-\\u1de6\\u1dfd-\\u1dff\\u200c\\u200d\\u20d0-\\u20f0\\u2cef-\\u2cf1\\u2de0-\\u2dff\\u302a-\\u302f\\u3099\\u309a\\ua66f-\\ua672\\ua67c\\ua67d\\ua6f0\\ua6f1\\ua802\\ua806\\ua80b\\ua825\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc\\uaa29-\\uaa2e\\uaa31\\uaa32\\uaa35\\uaa36\\uaa43\\uaa4c\\uaab0\\uaab2-\\uaab4\\uaab7\\uaab8\\uaabe\\uaabf\\uaac1\\uabe5\\uabe8\\uabed\\udc00-\\udfff\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\ufe26\\uff9e\\uff9f]/;\nfunction isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch) }\n\n// Returns a number from the range [`0`; `str.length`] unless `pos` is outside that range.\nfunction skipExtendingChars(str, pos, dir) {\n  while ((dir < 0 ? pos > 0 : pos < str.length) && isExtendingChar(str.charAt(pos))) { pos += dir; }\n  return pos\n}\n\n// Returns the value from the range [`from`; `to`] that satisfies\n// `pred` and is closest to `from`. Assumes that at least `to` satisfies `pred`.\nfunction findFirst(pred, from, to) {\n  for (;;) {\n    if (Math.abs(from - to) <= 1) { return pred(from) ? from : to }\n    var mid = Math.floor((from + to) / 2);\n    if (pred(mid)) { to = mid; }\n    else { from = mid; }\n  }\n}\n\n// The display handles the DOM integration, both for input reading\n// and content drawing. It holds references to DOM nodes and\n// display-related state.\n\nfunction Display(place, doc, input) {\n  var d = this;\n  this.input = input;\n\n  // Covers bottom-right square when both scrollbars are present.\n  d.scrollbarFiller = elt(\"div\", null, \"CodeMirror-scrollbar-filler\");\n  d.scrollbarFiller.setAttribute(\"cm-not-content\", \"true\");\n  // Covers bottom of gutter when coverGutterNextToScrollbar is on\n  // and h scrollbar is present.\n  d.gutterFiller = elt(\"div\", null, \"CodeMirror-gutter-filler\");\n  d.gutterFiller.setAttribute(\"cm-not-content\", \"true\");\n  // Will contain the actual code, positioned to cover the viewport.\n  d.lineDiv = eltP(\"div\", null, \"CodeMirror-code\");\n  // Elements are added to these to represent selection and cursors.\n  d.selectionDiv = elt(\"div\", null, null, \"position: relative; z-index: 1\");\n  d.cursorDiv = elt(\"div\", null, \"CodeMirror-cursors\");\n  // A visibility: hidden element used to find the size of things.\n  d.measure = elt(\"div\", null, \"CodeMirror-measure\");\n  // When lines outside of the viewport are measured, they are drawn in this.\n  d.lineMeasure = elt(\"div\", null, \"CodeMirror-measure\");\n  // Wraps everything that needs to exist inside the vertically-padded coordinate system\n  d.lineSpace = eltP(\"div\", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],\n                    null, \"position: relative; outline: none\");\n  var lines = eltP(\"div\", [d.lineSpace], \"CodeMirror-lines\");\n  // Moved around its parent to cover visible view.\n  d.mover = elt(\"div\", [lines], null, \"position: relative\");\n  // Set to the height of the document, allowing scrolling.\n  d.sizer = elt(\"div\", [d.mover], \"CodeMirror-sizer\");\n  d.sizerWidth = null;\n  // Behavior of elts with overflow: auto and padding is\n  // inconsistent across browsers. This is used to ensure the\n  // scrollable area is big enough.\n  d.heightForcer = elt(\"div\", null, null, \"position: absolute; height: \" + scrollerGap + \"px; width: 1px;\");\n  // Will contain the gutters, if any.\n  d.gutters = elt(\"div\", null, \"CodeMirror-gutters\");\n  d.lineGutter = null;\n  // Actual scrollable element.\n  d.scroller = elt(\"div\", [d.sizer, d.heightForcer, d.gutters], \"CodeMirror-scroll\");\n  d.scroller.setAttribute(\"tabIndex\", \"-1\");\n  // The element in which the editor lives.\n  d.wrapper = elt(\"div\", [d.scrollbarFiller, d.gutterFiller, d.scroller], \"CodeMirror\");\n\n  // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)\n  if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }\n  if (!webkit && !(gecko && mobile)) { d.scroller.draggable = true; }\n\n  if (place) {\n    if (place.appendChild) { place.appendChild(d.wrapper); }\n    else { place(d.wrapper); }\n  }\n\n  // Current rendered range (may be bigger than the view window).\n  d.viewFrom = d.viewTo = doc.first;\n  d.reportedViewFrom = d.reportedViewTo = doc.first;\n  // Information about the rendered lines.\n  d.view = [];\n  d.renderedView = null;\n  // Holds info about a single rendered line when it was rendered\n  // for measurement, while not in view.\n  d.externalMeasured = null;\n  // Empty space (in pixels) above the view\n  d.viewOffset = 0;\n  d.lastWrapHeight = d.lastWrapWidth = 0;\n  d.updateLineNumbers = null;\n\n  d.nativeBarWidth = d.barHeight = d.barWidth = 0;\n  d.scrollbarsClipped = false;\n\n  // Used to only resize the line number gutter when necessary (when\n  // the amount of lines crosses a boundary that makes its width change)\n  d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;\n  // Set to true when a non-horizontal-scrolling line widget is\n  // added. As an optimization, line widget aligning is skipped when\n  // this is false.\n  d.alignWidgets = false;\n\n  d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n\n  // Tracks the maximum line length so that the horizontal scrollbar\n  // can be kept static when scrolling.\n  d.maxLine = null;\n  d.maxLineLength = 0;\n  d.maxLineChanged = false;\n\n  // Used for measuring wheel scrolling granularity\n  d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;\n\n  // True when shift is held down.\n  d.shift = false;\n\n  // Used to track whether anything happened since the context menu\n  // was opened.\n  d.selForContextMenu = null;\n\n  d.activeTouch = null;\n\n  input.init(d);\n}\n\n// Find the line object corresponding to the given line number.\nfunction getLine(doc, n) {\n  n -= doc.first;\n  if (n < 0 || n >= doc.size) { throw new Error(\"There is no line \" + (n + doc.first) + \" in the document.\") }\n  var chunk = doc;\n  while (!chunk.lines) {\n    for (var i = 0;; ++i) {\n      var child = chunk.children[i], sz = child.chunkSize();\n      if (n < sz) { chunk = child; break }\n      n -= sz;\n    }\n  }\n  return chunk.lines[n]\n}\n\n// Get the part of a document between two positions, as an array of\n// strings.\nfunction getBetween(doc, start, end) {\n  var out = [], n = start.line;\n  doc.iter(start.line, end.line + 1, function (line) {\n    var text = line.text;\n    if (n == end.line) { text = text.slice(0, end.ch); }\n    if (n == start.line) { text = text.slice(start.ch); }\n    out.push(text);\n    ++n;\n  });\n  return out\n}\n// Get the lines between from and to, as array of strings.\nfunction getLines(doc, from, to) {\n  var out = [];\n  doc.iter(from, to, function (line) { out.push(line.text); }); // iter aborts when callback returns truthy value\n  return out\n}\n\n// Update the height of a line, propagating the height change\n// upwards to parent nodes.\nfunction updateLineHeight(line, height) {\n  var diff = height - line.height;\n  if (diff) { for (var n = line; n; n = n.parent) { n.height += diff; } }\n}\n\n// Given a line object, find its line number by walking up through\n// its parent links.\nfunction lineNo(line) {\n  if (line.parent == null) { return null }\n  var cur = line.parent, no = indexOf(cur.lines, line);\n  for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {\n    for (var i = 0;; ++i) {\n      if (chunk.children[i] == cur) { break }\n      no += chunk.children[i].chunkSize();\n    }\n  }\n  return no + cur.first\n}\n\n// Find the line at the given vertical position, using the height\n// information in the document tree.\nfunction lineAtHeight(chunk, h) {\n  var n = chunk.first;\n  outer: do {\n    for (var i$1 = 0; i$1 < chunk.children.length; ++i$1) {\n      var child = chunk.children[i$1], ch = child.height;\n      if (h < ch) { chunk = child; continue outer }\n      h -= ch;\n      n += child.chunkSize();\n    }\n    return n\n  } while (!chunk.lines)\n  var i = 0;\n  for (; i < chunk.lines.length; ++i) {\n    var line = chunk.lines[i], lh = line.height;\n    if (h < lh) { break }\n    h -= lh;\n  }\n  return n + i\n}\n\nfunction isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size}\n\nfunction lineNumberFor(options, i) {\n  return String(options.lineNumberFormatter(i + options.firstLineNumber))\n}\n\n// A Pos instance represents a position within the text.\nfunction Pos(line, ch, sticky) {\n  if ( sticky === void 0 ) sticky = null;\n\n  if (!(this instanceof Pos)) { return new Pos(line, ch, sticky) }\n  this.line = line;\n  this.ch = ch;\n  this.sticky = sticky;\n}\n\n// Compare two positions, return 0 if they are the same, a negative\n// number when a is less, and a positive number otherwise.\nfunction cmp(a, b) { return a.line - b.line || a.ch - b.ch }\n\nfunction equalCursorPos(a, b) { return a.sticky == b.sticky && cmp(a, b) == 0 }\n\nfunction copyPos(x) {return Pos(x.line, x.ch)}\nfunction maxPos(a, b) { return cmp(a, b) < 0 ? b : a }\nfunction minPos(a, b) { return cmp(a, b) < 0 ? a : b }\n\n// Most of the external API clips given positions to make sure they\n// actually exist within the document.\nfunction clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1))}\nfunction clipPos(doc, pos) {\n  if (pos.line < doc.first) { return Pos(doc.first, 0) }\n  var last = doc.first + doc.size - 1;\n  if (pos.line > last) { return Pos(last, getLine(doc, last).text.length) }\n  return clipToLen(pos, getLine(doc, pos.line).text.length)\n}\nfunction clipToLen(pos, linelen) {\n  var ch = pos.ch;\n  if (ch == null || ch > linelen) { return Pos(pos.line, linelen) }\n  else if (ch < 0) { return Pos(pos.line, 0) }\n  else { return pos }\n}\nfunction clipPosArray(doc, array) {\n  var out = [];\n  for (var i = 0; i < array.length; i++) { out[i] = clipPos(doc, array[i]); }\n  return out\n}\n\n// Optimize some code when these features are not used.\nvar sawReadOnlySpans = false;\nvar sawCollapsedSpans = false;\n\nfunction seeReadOnlySpans() {\n  sawReadOnlySpans = true;\n}\n\nfunction seeCollapsedSpans() {\n  sawCollapsedSpans = true;\n}\n\n// TEXTMARKER SPANS\n\nfunction MarkedSpan(marker, from, to) {\n  this.marker = marker;\n  this.from = from; this.to = to;\n}\n\n// Search an array of spans for a span matching the given marker.\nfunction getMarkedSpanFor(spans, marker) {\n  if (spans) { for (var i = 0; i < spans.length; ++i) {\n    var span = spans[i];\n    if (span.marker == marker) { return span }\n  } }\n}\n// Remove a span from an array, returning undefined if no spans are\n// left (we don't store arrays for lines without spans).\nfunction removeMarkedSpan(spans, span) {\n  var r;\n  for (var i = 0; i < spans.length; ++i)\n    { if (spans[i] != span) { (r || (r = [])).push(spans[i]); } }\n  return r\n}\n// Add a span to a line.\nfunction addMarkedSpan(line, span) {\n  line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];\n  span.marker.attachLine(line);\n}\n\n// Used for the algorithm that adjusts markers for a change in the\n// document. These functions cut an array of spans at a given\n// character position, returning an array of remaining chunks (or\n// undefined if nothing remains).\nfunction markedSpansBefore(old, startCh, isInsert) {\n  var nw;\n  if (old) { for (var i = 0; i < old.length; ++i) {\n    var span = old[i], marker = span.marker;\n    var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);\n    if (startsBefore || span.from == startCh && marker.type == \"bookmark\" && (!isInsert || !span.marker.insertLeft)) {\n      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);(nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));\n    }\n  } }\n  return nw\n}\nfunction markedSpansAfter(old, endCh, isInsert) {\n  var nw;\n  if (old) { for (var i = 0; i < old.length; ++i) {\n    var span = old[i], marker = span.marker;\n    var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);\n    if (endsAfter || span.from == endCh && marker.type == \"bookmark\" && (!isInsert || span.marker.insertLeft)) {\n      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);(nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,\n                                            span.to == null ? null : span.to - endCh));\n    }\n  } }\n  return nw\n}\n\n// Given a change object, compute the new set of marker spans that\n// cover the line in which the change took place. Removes spans\n// entirely within the change, reconnects spans belonging to the\n// same marker that appear on both sides of the change, and cuts off\n// spans partially within the change. Returns an array of span\n// arrays with one element for each line in (after) the change.\nfunction stretchSpansOverChange(doc, change) {\n  if (change.full) { return null }\n  var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;\n  var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;\n  if (!oldFirst && !oldLast) { return null }\n\n  var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;\n  // Get the spans that 'stick out' on both sides\n  var first = markedSpansBefore(oldFirst, startCh, isInsert);\n  var last = markedSpansAfter(oldLast, endCh, isInsert);\n\n  // Next, merge those two ends\n  var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);\n  if (first) {\n    // Fix up .to properties of first\n    for (var i = 0; i < first.length; ++i) {\n      var span = first[i];\n      if (span.to == null) {\n        var found = getMarkedSpanFor(last, span.marker);\n        if (!found) { span.to = startCh; }\n        else if (sameLine) { span.to = found.to == null ? null : found.to + offset; }\n      }\n    }\n  }\n  if (last) {\n    // Fix up .from in last (or move them into first in case of sameLine)\n    for (var i$1 = 0; i$1 < last.length; ++i$1) {\n      var span$1 = last[i$1];\n      if (span$1.to != null) { span$1.to += offset; }\n      if (span$1.from == null) {\n        var found$1 = getMarkedSpanFor(first, span$1.marker);\n        if (!found$1) {\n          span$1.from = offset;\n          if (sameLine) { (first || (first = [])).push(span$1); }\n        }\n      } else {\n        span$1.from += offset;\n        if (sameLine) { (first || (first = [])).push(span$1); }\n      }\n    }\n  }\n  // Make sure we didn't create any zero-length spans\n  if (first) { first = clearEmptySpans(first); }\n  if (last && last != first) { last = clearEmptySpans(last); }\n\n  var newMarkers = [first];\n  if (!sameLine) {\n    // Fill gap with whole-line-spans\n    var gap = change.text.length - 2, gapMarkers;\n    if (gap > 0 && first)\n      { for (var i$2 = 0; i$2 < first.length; ++i$2)\n        { if (first[i$2].to == null)\n          { (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i$2].marker, null, null)); } } }\n    for (var i$3 = 0; i$3 < gap; ++i$3)\n      { newMarkers.push(gapMarkers); }\n    newMarkers.push(last);\n  }\n  return newMarkers\n}\n\n// Remove spans that are empty and don't have a clearWhenEmpty\n// option of false.\nfunction clearEmptySpans(spans) {\n  for (var i = 0; i < spans.length; ++i) {\n    var span = spans[i];\n    if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)\n      { spans.splice(i--, 1); }\n  }\n  if (!spans.length) { return null }\n  return spans\n}\n\n// Used to 'clip' out readOnly ranges when making a change.\nfunction removeReadOnlyRanges(doc, from, to) {\n  var markers = null;\n  doc.iter(from.line, to.line + 1, function (line) {\n    if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {\n      var mark = line.markedSpans[i].marker;\n      if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))\n        { (markers || (markers = [])).push(mark); }\n    } }\n  });\n  if (!markers) { return null }\n  var parts = [{from: from, to: to}];\n  for (var i = 0; i < markers.length; ++i) {\n    var mk = markers[i], m = mk.find(0);\n    for (var j = 0; j < parts.length; ++j) {\n      var p = parts[j];\n      if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) { continue }\n      var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);\n      if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)\n        { newParts.push({from: p.from, to: m.from}); }\n      if (dto > 0 || !mk.inclusiveRight && !dto)\n        { newParts.push({from: m.to, to: p.to}); }\n      parts.splice.apply(parts, newParts);\n      j += newParts.length - 3;\n    }\n  }\n  return parts\n}\n\n// Connect or disconnect spans from a line.\nfunction detachMarkedSpans(line) {\n  var spans = line.markedSpans;\n  if (!spans) { return }\n  for (var i = 0; i < spans.length; ++i)\n    { spans[i].marker.detachLine(line); }\n  line.markedSpans = null;\n}\nfunction attachMarkedSpans(line, spans) {\n  if (!spans) { return }\n  for (var i = 0; i < spans.length; ++i)\n    { spans[i].marker.attachLine(line); }\n  line.markedSpans = spans;\n}\n\n// Helpers used when computing which overlapping collapsed span\n// counts as the larger one.\nfunction extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0 }\nfunction extraRight(marker) { return marker.inclusiveRight ? 1 : 0 }\n\n// Returns a number indicating which of two overlapping collapsed\n// spans is larger (and thus includes the other). Falls back to\n// comparing ids when the spans cover exactly the same range.\nfunction compareCollapsedMarkers(a, b) {\n  var lenDiff = a.lines.length - b.lines.length;\n  if (lenDiff != 0) { return lenDiff }\n  var aPos = a.find(), bPos = b.find();\n  var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);\n  if (fromCmp) { return -fromCmp }\n  var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);\n  if (toCmp) { return toCmp }\n  return b.id - a.id\n}\n\n// Find out whether a line ends or starts in a collapsed span. If\n// so, return the marker for that span.\nfunction collapsedSpanAtSide(line, start) {\n  var sps = sawCollapsedSpans && line.markedSpans, found;\n  if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {\n    sp = sps[i];\n    if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&\n        (!found || compareCollapsedMarkers(found, sp.marker) < 0))\n      { found = sp.marker; }\n  } }\n  return found\n}\nfunction collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true) }\nfunction collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false) }\n\n// Test whether there exists a collapsed span that partially\n// overlaps (covers the start or end, but not both) of a new span.\n// Such overlap is not allowed.\nfunction conflictingCollapsedRange(doc, lineNo$$1, from, to, marker) {\n  var line = getLine(doc, lineNo$$1);\n  var sps = sawCollapsedSpans && line.markedSpans;\n  if (sps) { for (var i = 0; i < sps.length; ++i) {\n    var sp = sps[i];\n    if (!sp.marker.collapsed) { continue }\n    var found = sp.marker.find(0);\n    var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);\n    var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);\n    if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) { continue }\n    if (fromCmp <= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.to, from) >= 0 : cmp(found.to, from) > 0) ||\n        fromCmp >= 0 && (sp.marker.inclusiveRight && marker.inclusiveLeft ? cmp(found.from, to) <= 0 : cmp(found.from, to) < 0))\n      { return true }\n  } }\n}\n\n// A visual line is a line as drawn on the screen. Folding, for\n// example, can cause multiple logical lines to appear on the same\n// visual line. This finds the start of the visual line that the\n// given line is part of (usually that is the line itself).\nfunction visualLine(line) {\n  var merged;\n  while (merged = collapsedSpanAtStart(line))\n    { line = merged.find(-1, true).line; }\n  return line\n}\n\nfunction visualLineEnd(line) {\n  var merged;\n  while (merged = collapsedSpanAtEnd(line))\n    { line = merged.find(1, true).line; }\n  return line\n}\n\n// Returns an array of logical lines that continue the visual line\n// started by the argument, or undefined if there are no such lines.\nfunction visualLineContinued(line) {\n  var merged, lines;\n  while (merged = collapsedSpanAtEnd(line)) {\n    line = merged.find(1, true).line\n    ;(lines || (lines = [])).push(line);\n  }\n  return lines\n}\n\n// Get the line number of the start of the visual line that the\n// given line number is part of.\nfunction visualLineNo(doc, lineN) {\n  var line = getLine(doc, lineN), vis = visualLine(line);\n  if (line == vis) { return lineN }\n  return lineNo(vis)\n}\n\n// Get the line number of the start of the next visual line after\n// the given line.\nfunction visualLineEndNo(doc, lineN) {\n  if (lineN > doc.lastLine()) { return lineN }\n  var line = getLine(doc, lineN), merged;\n  if (!lineIsHidden(doc, line)) { return lineN }\n  while (merged = collapsedSpanAtEnd(line))\n    { line = merged.find(1, true).line; }\n  return lineNo(line) + 1\n}\n\n// Compute whether a line is hidden. Lines count as hidden when they\n// are part of a visual line that starts with another line, or when\n// they are entirely covered by collapsed, non-widget span.\nfunction lineIsHidden(doc, line) {\n  var sps = sawCollapsedSpans && line.markedSpans;\n  if (sps) { for (var sp = (void 0), i = 0; i < sps.length; ++i) {\n    sp = sps[i];\n    if (!sp.marker.collapsed) { continue }\n    if (sp.from == null) { return true }\n    if (sp.marker.widgetNode) { continue }\n    if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))\n      { return true }\n  } }\n}\nfunction lineIsHiddenInner(doc, line, span) {\n  if (span.to == null) {\n    var end = span.marker.find(1, true);\n    return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker))\n  }\n  if (span.marker.inclusiveRight && span.to == line.text.length)\n    { return true }\n  for (var sp = (void 0), i = 0; i < line.markedSpans.length; ++i) {\n    sp = line.markedSpans[i];\n    if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&\n        (sp.to == null || sp.to != span.from) &&\n        (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&\n        lineIsHiddenInner(doc, line, sp)) { return true }\n  }\n}\n\n// Find the height above the given line.\nfunction heightAtLine(lineObj) {\n  lineObj = visualLine(lineObj);\n\n  var h = 0, chunk = lineObj.parent;\n  for (var i = 0; i < chunk.lines.length; ++i) {\n    var line = chunk.lines[i];\n    if (line == lineObj) { break }\n    else { h += line.height; }\n  }\n  for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {\n    for (var i$1 = 0; i$1 < p.children.length; ++i$1) {\n      var cur = p.children[i$1];\n      if (cur == chunk) { break }\n      else { h += cur.height; }\n    }\n  }\n  return h\n}\n\n// Compute the character length of a line, taking into account\n// collapsed ranges (see markText) that might hide parts, and join\n// other lines onto it.\nfunction lineLength(line) {\n  if (line.height == 0) { return 0 }\n  var len = line.text.length, merged, cur = line;\n  while (merged = collapsedSpanAtStart(cur)) {\n    var found = merged.find(0, true);\n    cur = found.from.line;\n    len += found.from.ch - found.to.ch;\n  }\n  cur = line;\n  while (merged = collapsedSpanAtEnd(cur)) {\n    var found$1 = merged.find(0, true);\n    len -= cur.text.length - found$1.from.ch;\n    cur = found$1.to.line;\n    len += cur.text.length - found$1.to.ch;\n  }\n  return len\n}\n\n// Find the longest line in the document.\nfunction findMaxLine(cm) {\n  var d = cm.display, doc = cm.doc;\n  d.maxLine = getLine(doc, doc.first);\n  d.maxLineLength = lineLength(d.maxLine);\n  d.maxLineChanged = true;\n  doc.iter(function (line) {\n    var len = lineLength(line);\n    if (len > d.maxLineLength) {\n      d.maxLineLength = len;\n      d.maxLine = line;\n    }\n  });\n}\n\n// BIDI HELPERS\n\nfunction iterateBidiSections(order, from, to, f) {\n  if (!order) { return f(from, to, \"ltr\") }\n  var found = false;\n  for (var i = 0; i < order.length; ++i) {\n    var part = order[i];\n    if (part.from < to && part.to > from || from == to && part.to == from) {\n      f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? \"rtl\" : \"ltr\");\n      found = true;\n    }\n  }\n  if (!found) { f(from, to, \"ltr\"); }\n}\n\nvar bidiOther = null;\nfunction getBidiPartAt(order, ch, sticky) {\n  var found;\n  bidiOther = null;\n  for (var i = 0; i < order.length; ++i) {\n    var cur = order[i];\n    if (cur.from < ch && cur.to > ch) { return i }\n    if (cur.to == ch) {\n      if (cur.from != cur.to && sticky == \"before\") { found = i; }\n      else { bidiOther = i; }\n    }\n    if (cur.from == ch) {\n      if (cur.from != cur.to && sticky != \"before\") { found = i; }\n      else { bidiOther = i; }\n    }\n  }\n  return found != null ? found : bidiOther\n}\n\n// Bidirectional ordering algorithm\n// See http://unicode.org/reports/tr9/tr9-13.html for the algorithm\n// that this (partially) implements.\n\n// One-char codes used for character types:\n// L (L):   Left-to-Right\n// R (R):   Right-to-Left\n// r (AL):  Right-to-Left Arabic\n// 1 (EN):  European Number\n// + (ES):  European Number Separator\n// % (ET):  European Number Terminator\n// n (AN):  Arabic Number\n// , (CS):  Common Number Separator\n// m (NSM): Non-Spacing Mark\n// b (BN):  Boundary Neutral\n// s (B):   Paragraph Separator\n// t (S):   Segment Separator\n// w (WS):  Whitespace\n// N (ON):  Other Neutrals\n\n// Returns null if characters are ordered as they appear\n// (left-to-right), or an array of sections ({from, to, level}\n// objects) in the order in which they occur visually.\nvar bidiOrdering = (function() {\n  // Character types for codepoints 0 to 0xff\n  var lowTypes = \"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN\";\n  // Character types for codepoints 0x600 to 0x6f9\n  var arabicTypes = \"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111\";\n  function charType(code) {\n    if (code <= 0xf7) { return lowTypes.charAt(code) }\n    else if (0x590 <= code && code <= 0x5f4) { return \"R\" }\n    else if (0x600 <= code && code <= 0x6f9) { return arabicTypes.charAt(code - 0x600) }\n    else if (0x6ee <= code && code <= 0x8ac) { return \"r\" }\n    else if (0x2000 <= code && code <= 0x200b) { return \"w\" }\n    else if (code == 0x200c) { return \"b\" }\n    else { return \"L\" }\n  }\n\n  var bidiRE = /[\\u0590-\\u05f4\\u0600-\\u06ff\\u0700-\\u08ac]/;\n  var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;\n\n  function BidiSpan(level, from, to) {\n    this.level = level;\n    this.from = from; this.to = to;\n  }\n\n  return function(str, direction) {\n    var outerType = direction == \"ltr\" ? \"L\" : \"R\";\n\n    if (str.length == 0 || direction == \"ltr\" && !bidiRE.test(str)) { return false }\n    var len = str.length, types = [];\n    for (var i = 0; i < len; ++i)\n      { types.push(charType(str.charCodeAt(i))); }\n\n    // W1. Examine each non-spacing mark (NSM) in the level run, and\n    // change the type of the NSM to the type of the previous\n    // character. If the NSM is at the start of the level run, it will\n    // get the type of sor.\n    for (var i$1 = 0, prev = outerType; i$1 < len; ++i$1) {\n      var type = types[i$1];\n      if (type == \"m\") { types[i$1] = prev; }\n      else { prev = type; }\n    }\n\n    // W2. Search backwards from each instance of a European number\n    // until the first strong type (R, L, AL, or sor) is found. If an\n    // AL is found, change the type of the European number to Arabic\n    // number.\n    // W3. Change all ALs to R.\n    for (var i$2 = 0, cur = outerType; i$2 < len; ++i$2) {\n      var type$1 = types[i$2];\n      if (type$1 == \"1\" && cur == \"r\") { types[i$2] = \"n\"; }\n      else if (isStrong.test(type$1)) { cur = type$1; if (type$1 == \"r\") { types[i$2] = \"R\"; } }\n    }\n\n    // W4. A single European separator between two European numbers\n    // changes to a European number. A single common separator between\n    // two numbers of the same type changes to that type.\n    for (var i$3 = 1, prev$1 = types[0]; i$3 < len - 1; ++i$3) {\n      var type$2 = types[i$3];\n      if (type$2 == \"+\" && prev$1 == \"1\" && types[i$3+1] == \"1\") { types[i$3] = \"1\"; }\n      else if (type$2 == \",\" && prev$1 == types[i$3+1] &&\n               (prev$1 == \"1\" || prev$1 == \"n\")) { types[i$3] = prev$1; }\n      prev$1 = type$2;\n    }\n\n    // W5. A sequence of European terminators adjacent to European\n    // numbers changes to all European numbers.\n    // W6. Otherwise, separators and terminators change to Other\n    // Neutral.\n    for (var i$4 = 0; i$4 < len; ++i$4) {\n      var type$3 = types[i$4];\n      if (type$3 == \",\") { types[i$4] = \"N\"; }\n      else if (type$3 == \"%\") {\n        var end = (void 0);\n        for (end = i$4 + 1; end < len && types[end] == \"%\"; ++end) {}\n        var replace = (i$4 && types[i$4-1] == \"!\") || (end < len && types[end] == \"1\") ? \"1\" : \"N\";\n        for (var j = i$4; j < end; ++j) { types[j] = replace; }\n        i$4 = end - 1;\n      }\n    }\n\n    // W7. Search backwards from each instance of a European number\n    // until the first strong type (R, L, or sor) is found. If an L is\n    // found, then change the type of the European number to L.\n    for (var i$5 = 0, cur$1 = outerType; i$5 < len; ++i$5) {\n      var type$4 = types[i$5];\n      if (cur$1 == \"L\" && type$4 == \"1\") { types[i$5] = \"L\"; }\n      else if (isStrong.test(type$4)) { cur$1 = type$4; }\n    }\n\n    // N1. A sequence of neutrals takes the direction of the\n    // surrounding strong text if the text on both sides has the same\n    // direction. European and Arabic numbers act as if they were R in\n    // terms of their influence on neutrals. Start-of-level-run (sor)\n    // and end-of-level-run (eor) are used at level run boundaries.\n    // N2. Any remaining neutrals take the embedding direction.\n    for (var i$6 = 0; i$6 < len; ++i$6) {\n      if (isNeutral.test(types[i$6])) {\n        var end$1 = (void 0);\n        for (end$1 = i$6 + 1; end$1 < len && isNeutral.test(types[end$1]); ++end$1) {}\n        var before = (i$6 ? types[i$6-1] : outerType) == \"L\";\n        var after = (end$1 < len ? types[end$1] : outerType) == \"L\";\n        var replace$1 = before == after ? (before ? \"L\" : \"R\") : outerType;\n        for (var j$1 = i$6; j$1 < end$1; ++j$1) { types[j$1] = replace$1; }\n        i$6 = end$1 - 1;\n      }\n    }\n\n    // Here we depart from the documented algorithm, in order to avoid\n    // building up an actual levels array. Since there are only three\n    // levels (0, 1, 2) in an implementation that doesn't take\n    // explicit embedding into account, we can build up the order on\n    // the fly, without following the level-based algorithm.\n    var order = [], m;\n    for (var i$7 = 0; i$7 < len;) {\n      if (countsAsLeft.test(types[i$7])) {\n        var start = i$7;\n        for (++i$7; i$7 < len && countsAsLeft.test(types[i$7]); ++i$7) {}\n        order.push(new BidiSpan(0, start, i$7));\n      } else {\n        var pos = i$7, at = order.length;\n        for (++i$7; i$7 < len && types[i$7] != \"L\"; ++i$7) {}\n        for (var j$2 = pos; j$2 < i$7;) {\n          if (countsAsNum.test(types[j$2])) {\n            if (pos < j$2) { order.splice(at, 0, new BidiSpan(1, pos, j$2)); }\n            var nstart = j$2;\n            for (++j$2; j$2 < i$7 && countsAsNum.test(types[j$2]); ++j$2) {}\n            order.splice(at, 0, new BidiSpan(2, nstart, j$2));\n            pos = j$2;\n          } else { ++j$2; }\n        }\n        if (pos < i$7) { order.splice(at, 0, new BidiSpan(1, pos, i$7)); }\n      }\n    }\n    if (order[0].level == 1 && (m = str.match(/^\\s+/))) {\n      order[0].from = m[0].length;\n      order.unshift(new BidiSpan(0, 0, m[0].length));\n    }\n    if (lst(order).level == 1 && (m = str.match(/\\s+$/))) {\n      lst(order).to -= m[0].length;\n      order.push(new BidiSpan(0, len - m[0].length, len));\n    }\n\n    return direction == \"rtl\" ? order.reverse() : order\n  }\n})();\n\n// Get the bidi ordering for the given line (and cache it). Returns\n// false for lines that are fully left-to-right, and an array of\n// BidiSpan objects otherwise.\nfunction getOrder(line, direction) {\n  var order = line.order;\n  if (order == null) { order = line.order = bidiOrdering(line.text, direction); }\n  return order\n}\n\nfunction moveCharLogically(line, ch, dir) {\n  var target = skipExtendingChars(line.text, ch + dir, dir);\n  return target < 0 || target > line.text.length ? null : target\n}\n\nfunction moveLogically(line, start, dir) {\n  var ch = moveCharLogically(line, start.ch, dir);\n  return ch == null ? null : new Pos(start.line, ch, dir < 0 ? \"after\" : \"before\")\n}\n\nfunction endOfLine(visually, cm, lineObj, lineNo, dir) {\n  if (visually) {\n    var order = getOrder(lineObj, cm.doc.direction);\n    if (order) {\n      var part = dir < 0 ? lst(order) : order[0];\n      var moveInStorageOrder = (dir < 0) == (part.level == 1);\n      var sticky = moveInStorageOrder ? \"after\" : \"before\";\n      var ch;\n      // With a wrapped rtl chunk (possibly spanning multiple bidi parts),\n      // it could be that the last bidi part is not on the last visual line,\n      // since visual lines contain content order-consecutive chunks.\n      // Thus, in rtl, we are looking for the first (content-order) character\n      // in the rtl chunk that is on the last line (that is, the same line\n      // as the last (content-order) character).\n      if (part.level > 0) {\n        var prep = prepareMeasureForLine(cm, lineObj);\n        ch = dir < 0 ? lineObj.text.length - 1 : 0;\n        var targetTop = measureCharPrepared(cm, prep, ch).top;\n        ch = findFirst(function (ch) { return measureCharPrepared(cm, prep, ch).top == targetTop; }, (dir < 0) == (part.level == 1) ? part.from : part.to - 1, ch);\n        if (sticky == \"before\") { ch = moveCharLogically(lineObj, ch, 1); }\n      } else { ch = dir < 0 ? part.to : part.from; }\n      return new Pos(lineNo, ch, sticky)\n    }\n  }\n  return new Pos(lineNo, dir < 0 ? lineObj.text.length : 0, dir < 0 ? \"before\" : \"after\")\n}\n\nfunction moveVisually(cm, line, start, dir) {\n  var bidi = getOrder(line, cm.doc.direction);\n  if (!bidi) { return moveLogically(line, start, dir) }\n  if (start.ch >= line.text.length) {\n    start.ch = line.text.length;\n    start.sticky = \"before\";\n  } else if (start.ch <= 0) {\n    start.ch = 0;\n    start.sticky = \"after\";\n  }\n  var partPos = getBidiPartAt(bidi, start.ch, start.sticky), part = bidi[partPos];\n  if (cm.doc.direction == \"ltr\" && part.level % 2 == 0 && (dir > 0 ? part.to > start.ch : part.from < start.ch)) {\n    // Case 1: We move within an ltr part in an ltr editor. Even with wrapped lines,\n    // nothing interesting happens.\n    return moveLogically(line, start, dir)\n  }\n\n  var mv = function (pos, dir) { return moveCharLogically(line, pos instanceof Pos ? pos.ch : pos, dir); };\n  var prep;\n  var getWrappedLineExtent = function (ch) {\n    if (!cm.options.lineWrapping) { return {begin: 0, end: line.text.length} }\n    prep = prep || prepareMeasureForLine(cm, line);\n    return wrappedLineExtentChar(cm, line, prep, ch)\n  };\n  var wrappedLineExtent = getWrappedLineExtent(start.sticky == \"before\" ? mv(start, -1) : start.ch);\n\n  if (cm.doc.direction == \"rtl\" || part.level == 1) {\n    var moveInStorageOrder = (part.level == 1) == (dir < 0);\n    var ch = mv(start, moveInStorageOrder ? 1 : -1);\n    if (ch != null && (!moveInStorageOrder ? ch >= part.from && ch >= wrappedLineExtent.begin : ch <= part.to && ch <= wrappedLineExtent.end)) {\n      // Case 2: We move within an rtl part or in an rtl editor on the same visual line\n      var sticky = moveInStorageOrder ? \"before\" : \"after\";\n      return new Pos(start.line, ch, sticky)\n    }\n  }\n\n  // Case 3: Could not move within this bidi part in this visual line, so leave\n  // the current bidi part\n\n  var searchInVisualLine = function (partPos, dir, wrappedLineExtent) {\n    var getRes = function (ch, moveInStorageOrder) { return moveInStorageOrder\n      ? new Pos(start.line, mv(ch, 1), \"before\")\n      : new Pos(start.line, ch, \"after\"); };\n\n    for (; partPos >= 0 && partPos < bidi.length; partPos += dir) {\n      var part = bidi[partPos];\n      var moveInStorageOrder = (dir > 0) == (part.level != 1);\n      var ch = moveInStorageOrder ? wrappedLineExtent.begin : mv(wrappedLineExtent.end, -1);\n      if (part.from <= ch && ch < part.to) { return getRes(ch, moveInStorageOrder) }\n      ch = moveInStorageOrder ? part.from : mv(part.to, -1);\n      if (wrappedLineExtent.begin <= ch && ch < wrappedLineExtent.end) { return getRes(ch, moveInStorageOrder) }\n    }\n  };\n\n  // Case 3a: Look for other bidi parts on the same visual line\n  var res = searchInVisualLine(partPos + dir, dir, wrappedLineExtent);\n  if (res) { return res }\n\n  // Case 3b: Look for other bidi parts on the next visual line\n  var nextCh = dir > 0 ? wrappedLineExtent.end : mv(wrappedLineExtent.begin, -1);\n  if (nextCh != null && !(dir > 0 && nextCh == line.text.length)) {\n    res = searchInVisualLine(dir > 0 ? 0 : bidi.length - 1, dir, getWrappedLineExtent(nextCh));\n    if (res) { return res }\n  }\n\n  // Case 4: Nowhere to move\n  return null\n}\n\n// EVENT HANDLING\n\n// Lightweight event framework. on/off also work on DOM nodes,\n// registering native DOM handlers.\n\nvar noHandlers = [];\n\nvar on = function(emitter, type, f) {\n  if (emitter.addEventListener) {\n    emitter.addEventListener(type, f, false);\n  } else if (emitter.attachEvent) {\n    emitter.attachEvent(\"on\" + type, f);\n  } else {\n    var map$$1 = emitter._handlers || (emitter._handlers = {});\n    map$$1[type] = (map$$1[type] || noHandlers).concat(f);\n  }\n};\n\nfunction getHandlers(emitter, type) {\n  return emitter._handlers && emitter._handlers[type] || noHandlers\n}\n\nfunction off(emitter, type, f) {\n  if (emitter.removeEventListener) {\n    emitter.removeEventListener(type, f, false);\n  } else if (emitter.detachEvent) {\n    emitter.detachEvent(\"on\" + type, f);\n  } else {\n    var map$$1 = emitter._handlers, arr = map$$1 && map$$1[type];\n    if (arr) {\n      var index = indexOf(arr, f);\n      if (index > -1)\n        { map$$1[type] = arr.slice(0, index).concat(arr.slice(index + 1)); }\n    }\n  }\n}\n\nfunction signal(emitter, type /*, values...*/) {\n  var handlers = getHandlers(emitter, type);\n  if (!handlers.length) { return }\n  var args = Array.prototype.slice.call(arguments, 2);\n  for (var i = 0; i < handlers.length; ++i) { handlers[i].apply(null, args); }\n}\n\n// The DOM events that CodeMirror handles can be overridden by\n// registering a (non-DOM) handler on the editor for the event name,\n// and preventDefault-ing the event in that handler.\nfunction signalDOMEvent(cm, e, override) {\n  if (typeof e == \"string\")\n    { e = {type: e, preventDefault: function() { this.defaultPrevented = true; }}; }\n  signal(cm, override || e.type, cm, e);\n  return e_defaultPrevented(e) || e.codemirrorIgnore\n}\n\nfunction signalCursorActivity(cm) {\n  var arr = cm._handlers && cm._handlers.cursorActivity;\n  if (!arr) { return }\n  var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);\n  for (var i = 0; i < arr.length; ++i) { if (indexOf(set, arr[i]) == -1)\n    { set.push(arr[i]); } }\n}\n\nfunction hasHandler(emitter, type) {\n  return getHandlers(emitter, type).length > 0\n}\n\n// Add on and off methods to a constructor's prototype, to make\n// registering events on such objects more convenient.\nfunction eventMixin(ctor) {\n  ctor.prototype.on = function(type, f) {on(this, type, f);};\n  ctor.prototype.off = function(type, f) {off(this, type, f);};\n}\n\n// Due to the fact that we still support jurassic IE versions, some\n// compatibility wrappers are needed.\n\nfunction e_preventDefault(e) {\n  if (e.preventDefault) { e.preventDefault(); }\n  else { e.returnValue = false; }\n}\nfunction e_stopPropagation(e) {\n  if (e.stopPropagation) { e.stopPropagation(); }\n  else { e.cancelBubble = true; }\n}\nfunction e_defaultPrevented(e) {\n  return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false\n}\nfunction e_stop(e) {e_preventDefault(e); e_stopPropagation(e);}\n\nfunction e_target(e) {return e.target || e.srcElement}\nfunction e_button(e) {\n  var b = e.which;\n  if (b == null) {\n    if (e.button & 1) { b = 1; }\n    else if (e.button & 2) { b = 3; }\n    else if (e.button & 4) { b = 2; }\n  }\n  if (mac && e.ctrlKey && b == 1) { b = 3; }\n  return b\n}\n\n// Detect drag-and-drop\nvar dragAndDrop = function() {\n  // There is *some* kind of drag-and-drop support in IE6-8, but I\n  // couldn't get it to work yet.\n  if (ie && ie_version < 9) { return false }\n  var div = elt('div');\n  return \"draggable\" in div || \"dragDrop\" in div\n}();\n\nvar zwspSupported;\nfunction zeroWidthElement(measure) {\n  if (zwspSupported == null) {\n    var test = elt(\"span\", \"\\u200b\");\n    removeChildrenAndAdd(measure, elt(\"span\", [test, document.createTextNode(\"x\")]));\n    if (measure.firstChild.offsetHeight != 0)\n      { zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8); }\n  }\n  var node = zwspSupported ? elt(\"span\", \"\\u200b\") :\n    elt(\"span\", \"\\u00a0\", null, \"display: inline-block; width: 1px; margin-right: -1px\");\n  node.setAttribute(\"cm-text\", \"\");\n  return node\n}\n\n// Feature-detect IE's crummy client rect reporting for bidi text\nvar badBidiRects;\nfunction hasBadBidiRects(measure) {\n  if (badBidiRects != null) { return badBidiRects }\n  var txt = removeChildrenAndAdd(measure, document.createTextNode(\"A\\u062eA\"));\n  var r0 = range(txt, 0, 1).getBoundingClientRect();\n  var r1 = range(txt, 1, 2).getBoundingClientRect();\n  removeChildren(measure);\n  if (!r0 || r0.left == r0.right) { return false } // Safari returns null in some cases (#2780)\n  return badBidiRects = (r1.right - r0.right < 3)\n}\n\n// See if \"\".split is the broken IE version, if so, provide an\n// alternative way to split lines.\nvar splitLinesAuto = \"\\n\\nb\".split(/\\n/).length != 3 ? function (string) {\n  var pos = 0, result = [], l = string.length;\n  while (pos <= l) {\n    var nl = string.indexOf(\"\\n\", pos);\n    if (nl == -1) { nl = string.length; }\n    var line = string.slice(pos, string.charAt(nl - 1) == \"\\r\" ? nl - 1 : nl);\n    var rt = line.indexOf(\"\\r\");\n    if (rt != -1) {\n      result.push(line.slice(0, rt));\n      pos += rt + 1;\n    } else {\n      result.push(line);\n      pos = nl + 1;\n    }\n  }\n  return result\n} : function (string) { return string.split(/\\r\\n?|\\n/); };\n\nvar hasSelection = window.getSelection ? function (te) {\n  try { return te.selectionStart != te.selectionEnd }\n  catch(e) { return false }\n} : function (te) {\n  var range$$1;\n  try {range$$1 = te.ownerDocument.selection.createRange();}\n  catch(e) {}\n  if (!range$$1 || range$$1.parentElement() != te) { return false }\n  return range$$1.compareEndPoints(\"StartToEnd\", range$$1) != 0\n};\n\nvar hasCopyEvent = (function () {\n  var e = elt(\"div\");\n  if (\"oncopy\" in e) { return true }\n  e.setAttribute(\"oncopy\", \"return;\");\n  return typeof e.oncopy == \"function\"\n})();\n\nvar badZoomedRects = null;\nfunction hasBadZoomedRects(measure) {\n  if (badZoomedRects != null) { return badZoomedRects }\n  var node = removeChildrenAndAdd(measure, elt(\"span\", \"x\"));\n  var normal = node.getBoundingClientRect();\n  var fromRange = range(node, 0, 1).getBoundingClientRect();\n  return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1\n}\n\n// Known modes, by name and by MIME\nvar modes = {};\nvar mimeModes = {};\n\n// Extra arguments are stored as the mode's dependencies, which is\n// used by (legacy) mechanisms like loadmode.js to automatically\n// load a mode. (Preferred mechanism is the require/define calls.)\nfunction defineMode(name, mode) {\n  if (arguments.length > 2)\n    { mode.dependencies = Array.prototype.slice.call(arguments, 2); }\n  modes[name] = mode;\n}\n\nfunction defineMIME(mime, spec) {\n  mimeModes[mime] = spec;\n}\n\n// Given a MIME type, a {name, ...options} config object, or a name\n// string, return a mode config object.\nfunction resolveMode(spec) {\n  if (typeof spec == \"string\" && mimeModes.hasOwnProperty(spec)) {\n    spec = mimeModes[spec];\n  } else if (spec && typeof spec.name == \"string\" && mimeModes.hasOwnProperty(spec.name)) {\n    var found = mimeModes[spec.name];\n    if (typeof found == \"string\") { found = {name: found}; }\n    spec = createObj(found, spec);\n    spec.name = found.name;\n  } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+xml$/.test(spec)) {\n    return resolveMode(\"application/xml\")\n  } else if (typeof spec == \"string\" && /^[\\w\\-]+\\/[\\w\\-]+\\+json$/.test(spec)) {\n    return resolveMode(\"application/json\")\n  }\n  if (typeof spec == \"string\") { return {name: spec} }\n  else { return spec || {name: \"null\"} }\n}\n\n// Given a mode spec (anything that resolveMode accepts), find and\n// initialize an actual mode object.\nfunction getMode(options, spec) {\n  spec = resolveMode(spec);\n  var mfactory = modes[spec.name];\n  if (!mfactory) { return getMode(options, \"text/plain\") }\n  var modeObj = mfactory(options, spec);\n  if (modeExtensions.hasOwnProperty(spec.name)) {\n    var exts = modeExtensions[spec.name];\n    for (var prop in exts) {\n      if (!exts.hasOwnProperty(prop)) { continue }\n      if (modeObj.hasOwnProperty(prop)) { modeObj[\"_\" + prop] = modeObj[prop]; }\n      modeObj[prop] = exts[prop];\n    }\n  }\n  modeObj.name = spec.name;\n  if (spec.helperType) { modeObj.helperType = spec.helperType; }\n  if (spec.modeProps) { for (var prop$1 in spec.modeProps)\n    { modeObj[prop$1] = spec.modeProps[prop$1]; } }\n\n  return modeObj\n}\n\n// This can be used to attach properties to mode objects from\n// outside the actual mode definition.\nvar modeExtensions = {};\nfunction extendMode(mode, properties) {\n  var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});\n  copyObj(properties, exts);\n}\n\nfunction copyState(mode, state) {\n  if (state === true) { return state }\n  if (mode.copyState) { return mode.copyState(state) }\n  var nstate = {};\n  for (var n in state) {\n    var val = state[n];\n    if (val instanceof Array) { val = val.concat([]); }\n    nstate[n] = val;\n  }\n  return nstate\n}\n\n// Given a mode and a state (for that mode), find the inner mode and\n// state at the position that the state refers to.\nfunction innerMode(mode, state) {\n  var info;\n  while (mode.innerMode) {\n    info = mode.innerMode(state);\n    if (!info || info.mode == mode) { break }\n    state = info.state;\n    mode = info.mode;\n  }\n  return info || {mode: mode, state: state}\n}\n\nfunction startState(mode, a1, a2) {\n  return mode.startState ? mode.startState(a1, a2) : true\n}\n\n// STRING STREAM\n\n// Fed to the mode parsers, provides helper functions to make\n// parsers more succinct.\n\nvar StringStream = function(string, tabSize) {\n  this.pos = this.start = 0;\n  this.string = string;\n  this.tabSize = tabSize || 8;\n  this.lastColumnPos = this.lastColumnValue = 0;\n  this.lineStart = 0;\n};\n\nStringStream.prototype.eol = function () {return this.pos >= this.string.length};\nStringStream.prototype.sol = function () {return this.pos == this.lineStart};\nStringStream.prototype.peek = function () {return this.string.charAt(this.pos) || undefined};\nStringStream.prototype.next = function () {\n  if (this.pos < this.string.length)\n    { return this.string.charAt(this.pos++) }\n};\nStringStream.prototype.eat = function (match) {\n  var ch = this.string.charAt(this.pos);\n  var ok;\n  if (typeof match == \"string\") { ok = ch == match; }\n  else { ok = ch && (match.test ? match.test(ch) : match(ch)); }\n  if (ok) {++this.pos; return ch}\n};\nStringStream.prototype.eatWhile = function (match) {\n  var start = this.pos;\n  while (this.eat(match)){}\n  return this.pos > start\n};\nStringStream.prototype.eatSpace = function () {\n    var this$1 = this;\n\n  var start = this.pos;\n  while (/[\\s\\u00a0]/.test(this.string.charAt(this.pos))) { ++this$1.pos; }\n  return this.pos > start\n};\nStringStream.prototype.skipToEnd = function () {this.pos = this.string.length;};\nStringStream.prototype.skipTo = function (ch) {\n  var found = this.string.indexOf(ch, this.pos);\n  if (found > -1) {this.pos = found; return true}\n};\nStringStream.prototype.backUp = function (n) {this.pos -= n;};\nStringStream.prototype.column = function () {\n  if (this.lastColumnPos < this.start) {\n    this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);\n    this.lastColumnPos = this.start;\n  }\n  return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)\n};\nStringStream.prototype.indentation = function () {\n  return countColumn(this.string, null, this.tabSize) -\n    (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0)\n};\nStringStream.prototype.match = function (pattern, consume, caseInsensitive) {\n  if (typeof pattern == \"string\") {\n    var cased = function (str) { return caseInsensitive ? str.toLowerCase() : str; };\n    var substr = this.string.substr(this.pos, pattern.length);\n    if (cased(substr) == cased(pattern)) {\n      if (consume !== false) { this.pos += pattern.length; }\n      return true\n    }\n  } else {\n    var match = this.string.slice(this.pos).match(pattern);\n    if (match && match.index > 0) { return null }\n    if (match && consume !== false) { this.pos += match[0].length; }\n    return match\n  }\n};\nStringStream.prototype.current = function (){return this.string.slice(this.start, this.pos)};\nStringStream.prototype.hideFirstChars = function (n, inner) {\n  this.lineStart += n;\n  try { return inner() }\n  finally { this.lineStart -= n; }\n};\n\n// Compute a style array (an array starting with a mode generation\n// -- for invalidation -- followed by pairs of end positions and\n// style strings), which is used to highlight the tokens on the\n// line.\nfunction highlightLine(cm, line, state, forceToEnd) {\n  // A styles array always starts with a number identifying the\n  // mode/overlays that it is based on (for easy invalidation).\n  var st = [cm.state.modeGen], lineClasses = {};\n  // Compute the base array of styles\n  runMode(cm, line.text, cm.doc.mode, state, function (end, style) { return st.push(end, style); },\n    lineClasses, forceToEnd);\n\n  // Run overlays, adjust style array.\n  var loop = function ( o ) {\n    var overlay = cm.state.overlays[o], i = 1, at = 0;\n    runMode(cm, line.text, overlay.mode, true, function (end, style) {\n      var start = i;\n      // Ensure there's a token end at the current position, and that i points at it\n      while (at < end) {\n        var i_end = st[i];\n        if (i_end > end)\n          { st.splice(i, 1, end, st[i+1], i_end); }\n        i += 2;\n        at = Math.min(end, i_end);\n      }\n      if (!style) { return }\n      if (overlay.opaque) {\n        st.splice(start, i - start, end, \"overlay \" + style);\n        i = start + 2;\n      } else {\n        for (; start < i; start += 2) {\n          var cur = st[start+1];\n          st[start+1] = (cur ? cur + \" \" : \"\") + \"overlay \" + style;\n        }\n      }\n    }, lineClasses);\n  };\n\n  for (var o = 0; o < cm.state.overlays.length; ++o) loop( o );\n\n  return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null}\n}\n\nfunction getLineStyles(cm, line, updateFrontier) {\n  if (!line.styles || line.styles[0] != cm.state.modeGen) {\n    var state = getStateBefore(cm, lineNo(line));\n    var result = highlightLine(cm, line, line.text.length > cm.options.maxHighlightLength ? copyState(cm.doc.mode, state) : state);\n    line.stateAfter = state;\n    line.styles = result.styles;\n    if (result.classes) { line.styleClasses = result.classes; }\n    else if (line.styleClasses) { line.styleClasses = null; }\n    if (updateFrontier === cm.doc.frontier) { cm.doc.frontier++; }\n  }\n  return line.styles\n}\n\nfunction getStateBefore(cm, n, precise) {\n  var doc = cm.doc, display = cm.display;\n  if (!doc.mode.startState) { return true }\n  var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;\n  if (!state) { state = startState(doc.mode); }\n  else { state = copyState(doc.mode, state); }\n  doc.iter(pos, n, function (line) {\n    processLine(cm, line.text, state);\n    var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;\n    line.stateAfter = save ? copyState(doc.mode, state) : null;\n    ++pos;\n  });\n  if (precise) { doc.frontier = pos; }\n  return state\n}\n\n// Lightweight form of highlight -- proceed over this line and\n// update state, but don't save a style array. Used for lines that\n// aren't currently visible.\nfunction processLine(cm, text, state, startAt) {\n  var mode = cm.doc.mode;\n  var stream = new StringStream(text, cm.options.tabSize);\n  stream.start = stream.pos = startAt || 0;\n  if (text == \"\") { callBlankLine(mode, state); }\n  while (!stream.eol()) {\n    readToken(mode, stream, state);\n    stream.start = stream.pos;\n  }\n}\n\nfunction callBlankLine(mode, state) {\n  if (mode.blankLine) { return mode.blankLine(state) }\n  if (!mode.innerMode) { return }\n  var inner = innerMode(mode, state);\n  if (inner.mode.blankLine) { return inner.mode.blankLine(inner.state) }\n}\n\nfunction readToken(mode, stream, state, inner) {\n  for (var i = 0; i < 10; i++) {\n    if (inner) { inner[0] = innerMode(mode, state).mode; }\n    var style = mode.token(stream, state);\n    if (stream.pos > stream.start) { return style }\n  }\n  throw new Error(\"Mode \" + mode.name + \" failed to advance stream.\")\n}\n\n// Utility for getTokenAt and getLineTokens\nfunction takeToken(cm, pos, precise, asArray) {\n  var getObj = function (copy) { return ({\n    start: stream.start, end: stream.pos,\n    string: stream.current(),\n    type: style || null,\n    state: copy ? copyState(doc.mode, state) : state\n  }); };\n\n  var doc = cm.doc, mode = doc.mode, style;\n  pos = clipPos(doc, pos);\n  var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);\n  var stream = new StringStream(line.text, cm.options.tabSize), tokens;\n  if (asArray) { tokens = []; }\n  while ((asArray || stream.pos < pos.ch) && !stream.eol()) {\n    stream.start = stream.pos;\n    style = readToken(mode, stream, state);\n    if (asArray) { tokens.push(getObj(true)); }\n  }\n  return asArray ? tokens : getObj()\n}\n\nfunction extractLineClasses(type, output) {\n  if (type) { for (;;) {\n    var lineClass = type.match(/(?:^|\\s+)line-(background-)?(\\S+)/);\n    if (!lineClass) { break }\n    type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);\n    var prop = lineClass[1] ? \"bgClass\" : \"textClass\";\n    if (output[prop] == null)\n      { output[prop] = lineClass[2]; }\n    else if (!(new RegExp(\"(?:^|\\s)\" + lineClass[2] + \"(?:$|\\s)\")).test(output[prop]))\n      { output[prop] += \" \" + lineClass[2]; }\n  } }\n  return type\n}\n\n// Run the given mode's parser over a line, calling f for each token.\nfunction runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {\n  var flattenSpans = mode.flattenSpans;\n  if (flattenSpans == null) { flattenSpans = cm.options.flattenSpans; }\n  var curStart = 0, curStyle = null;\n  var stream = new StringStream(text, cm.options.tabSize), style;\n  var inner = cm.options.addModeClass && [null];\n  if (text == \"\") { extractLineClasses(callBlankLine(mode, state), lineClasses); }\n  while (!stream.eol()) {\n    if (stream.pos > cm.options.maxHighlightLength) {\n      flattenSpans = false;\n      if (forceToEnd) { processLine(cm, text, state, stream.pos); }\n      stream.pos = text.length;\n      style = null;\n    } else {\n      style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);\n    }\n    if (inner) {\n      var mName = inner[0].name;\n      if (mName) { style = \"m-\" + (style ? mName + \" \" + style : mName); }\n    }\n    if (!flattenSpans || curStyle != style) {\n      while (curStart < stream.start) {\n        curStart = Math.min(stream.start, curStart + 5000);\n        f(curStart, curStyle);\n      }\n      curStyle = style;\n    }\n    stream.start = stream.pos;\n  }\n  while (curStart < stream.pos) {\n    // Webkit seems to refuse to render text nodes longer than 57444\n    // characters, and returns inaccurate measurements in nodes\n    // starting around 5000 chars.\n    var pos = Math.min(stream.pos, curStart + 5000);\n    f(pos, curStyle);\n    curStart = pos;\n  }\n}\n\n// Finds the line to start with when starting a parse. Tries to\n// find a line with a stateAfter, so that it can start with a\n// valid state. If that fails, it returns the line with the\n// smallest indentation, which tends to need the least context to\n// parse correctly.\nfunction findStartLine(cm, n, precise) {\n  var minindent, minline, doc = cm.doc;\n  var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);\n  for (var search = n; search > lim; --search) {\n    if (search <= doc.first) { return doc.first }\n    var line = getLine(doc, search - 1);\n    if (line.stateAfter && (!precise || search <= doc.frontier)) { return search }\n    var indented = countColumn(line.text, null, cm.options.tabSize);\n    if (minline == null || minindent > indented) {\n      minline = search - 1;\n      minindent = indented;\n    }\n  }\n  return minline\n}\n\n// LINE DATA STRUCTURE\n\n// Line objects. These hold state related to a line, including\n// highlighting info (the styles array).\nvar Line = function(text, markedSpans, estimateHeight) {\n  this.text = text;\n  attachMarkedSpans(this, markedSpans);\n  this.height = estimateHeight ? estimateHeight(this) : 1;\n};\n\nLine.prototype.lineNo = function () { return lineNo(this) };\neventMixin(Line);\n\n// Change the content (text, markers) of a line. Automatically\n// invalidates cached information and tries to re-estimate the\n// line's height.\nfunction updateLine(line, text, markedSpans, estimateHeight) {\n  line.text = text;\n  if (line.stateAfter) { line.stateAfter = null; }\n  if (line.styles) { line.styles = null; }\n  if (line.order != null) { line.order = null; }\n  detachMarkedSpans(line);\n  attachMarkedSpans(line, markedSpans);\n  var estHeight = estimateHeight ? estimateHeight(line) : 1;\n  if (estHeight != line.height) { updateLineHeight(line, estHeight); }\n}\n\n// Detach a line from the document tree and its markers.\nfunction cleanUpLine(line) {\n  line.parent = null;\n  detachMarkedSpans(line);\n}\n\n// Convert a style as returned by a mode (either null, or a string\n// containing one or more styles) to a CSS style. This is cached,\n// and also looks for line-wide styles.\nvar styleToClassCache = {};\nvar styleToClassCacheWithMode = {};\nfunction interpretTokenStyle(style, options) {\n  if (!style || /^\\s*$/.test(style)) { return null }\n  var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;\n  return cache[style] ||\n    (cache[style] = style.replace(/\\S+/g, \"cm-$&\"))\n}\n\n// Render the DOM representation of the text of a line. Also builds\n// up a 'line map', which points at the DOM nodes that represent\n// specific stretches of text, and is used by the measuring code.\n// The returned object contains the DOM node, this map, and\n// information about line-wide styles that were set by the mode.\nfunction buildLineContent(cm, lineView) {\n  // The padding-right forces the element to have a 'border', which\n  // is needed on Webkit to be able to get line-level bounding\n  // rectangles for it (in measureChar).\n  var content = eltP(\"span\", null, null, webkit ? \"padding-right: .1px\" : null);\n  var builder = {pre: eltP(\"pre\", [content], \"CodeMirror-line\"), content: content,\n                 col: 0, pos: 0, cm: cm,\n                 trailingSpace: false,\n                 splitSpaces: (ie || webkit) && cm.getOption(\"lineWrapping\")};\n  lineView.measure = {};\n\n  // Iterate over the logical lines that make up this visual line.\n  for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {\n    var line = i ? lineView.rest[i - 1] : lineView.line, order = (void 0);\n    builder.pos = 0;\n    builder.addToken = buildToken;\n    // Optionally wire in some hacks into the token-rendering\n    // algorithm, to deal with browser quirks.\n    if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line, cm.doc.direction)))\n      { builder.addToken = buildTokenBadBidi(builder.addToken, order); }\n    builder.map = [];\n    var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);\n    insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));\n    if (line.styleClasses) {\n      if (line.styleClasses.bgClass)\n        { builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || \"\"); }\n      if (line.styleClasses.textClass)\n        { builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || \"\"); }\n    }\n\n    // Ensure at least a single node is present, for measuring.\n    if (builder.map.length == 0)\n      { builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure))); }\n\n    // Store the map and a cache object for the current logical line\n    if (i == 0) {\n      lineView.measure.map = builder.map;\n      lineView.measure.cache = {};\n    } else {\n      (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map)\n      ;(lineView.measure.caches || (lineView.measure.caches = [])).push({});\n    }\n  }\n\n  // See issue #2901\n  if (webkit) {\n    var last = builder.content.lastChild;\n    if (/\\bcm-tab\\b/.test(last.className) || (last.querySelector && last.querySelector(\".cm-tab\")))\n      { builder.content.className = \"cm-tab-wrap-hack\"; }\n  }\n\n  signal(cm, \"renderLine\", cm, lineView.line, builder.pre);\n  if (builder.pre.className)\n    { builder.textClass = joinClasses(builder.pre.className, builder.textClass || \"\"); }\n\n  return builder\n}\n\nfunction defaultSpecialCharPlaceholder(ch) {\n  var token = elt(\"span\", \"\\u2022\", \"cm-invalidchar\");\n  token.title = \"\\\\u\" + ch.charCodeAt(0).toString(16);\n  token.setAttribute(\"aria-label\", token.title);\n  return token\n}\n\n// Build up the DOM representation for a single token, and add it to\n// the line map. Takes care to render special characters separately.\nfunction buildToken(builder, text, style, startStyle, endStyle, title, css) {\n  if (!text) { return }\n  var displayText = builder.splitSpaces ? splitSpaces(text, builder.trailingSpace) : text;\n  var special = builder.cm.state.specialChars, mustWrap = false;\n  var content;\n  if (!special.test(text)) {\n    builder.col += text.length;\n    content = document.createTextNode(displayText);\n    builder.map.push(builder.pos, builder.pos + text.length, content);\n    if (ie && ie_version < 9) { mustWrap = true; }\n    builder.pos += text.length;\n  } else {\n    content = document.createDocumentFragment();\n    var pos = 0;\n    while (true) {\n      special.lastIndex = pos;\n      var m = special.exec(text);\n      var skipped = m ? m.index - pos : text.length - pos;\n      if (skipped) {\n        var txt = document.createTextNode(displayText.slice(pos, pos + skipped));\n        if (ie && ie_version < 9) { content.appendChild(elt(\"span\", [txt])); }\n        else { content.appendChild(txt); }\n        builder.map.push(builder.pos, builder.pos + skipped, txt);\n        builder.col += skipped;\n        builder.pos += skipped;\n      }\n      if (!m) { break }\n      pos += skipped + 1;\n      var txt$1 = (void 0);\n      if (m[0] == \"\\t\") {\n        var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;\n        txt$1 = content.appendChild(elt(\"span\", spaceStr(tabWidth), \"cm-tab\"));\n        txt$1.setAttribute(\"role\", \"presentation\");\n        txt$1.setAttribute(\"cm-text\", \"\\t\");\n        builder.col += tabWidth;\n      } else if (m[0] == \"\\r\" || m[0] == \"\\n\") {\n        txt$1 = content.appendChild(elt(\"span\", m[0] == \"\\r\" ? \"\\u240d\" : \"\\u2424\", \"cm-invalidchar\"));\n        txt$1.setAttribute(\"cm-text\", m[0]);\n        builder.col += 1;\n      } else {\n        txt$1 = builder.cm.options.specialCharPlaceholder(m[0]);\n        txt$1.setAttribute(\"cm-text\", m[0]);\n        if (ie && ie_version < 9) { content.appendChild(elt(\"span\", [txt$1])); }\n        else { content.appendChild(txt$1); }\n        builder.col += 1;\n      }\n      builder.map.push(builder.pos, builder.pos + 1, txt$1);\n      builder.pos++;\n    }\n  }\n  builder.trailingSpace = displayText.charCodeAt(text.length - 1) == 32;\n  if (style || startStyle || endStyle || mustWrap || css) {\n    var fullStyle = style || \"\";\n    if (startStyle) { fullStyle += startStyle; }\n    if (endStyle) { fullStyle += endStyle; }\n    var token = elt(\"span\", [content], fullStyle, css);\n    if (title) { token.title = title; }\n    return builder.content.appendChild(token)\n  }\n  builder.content.appendChild(content);\n}\n\nfunction splitSpaces(text, trailingBefore) {\n  if (text.length > 1 && !/  /.test(text)) { return text }\n  var spaceBefore = trailingBefore, result = \"\";\n  for (var i = 0; i < text.length; i++) {\n    var ch = text.charAt(i);\n    if (ch == \" \" && spaceBefore && (i == text.length - 1 || text.charCodeAt(i + 1) == 32))\n      { ch = \"\\u00a0\"; }\n    result += ch;\n    spaceBefore = ch == \" \";\n  }\n  return result\n}\n\n// Work around nonsense dimensions being reported for stretches of\n// right-to-left text.\nfunction buildTokenBadBidi(inner, order) {\n  return function (builder, text, style, startStyle, endStyle, title, css) {\n    style = style ? style + \" cm-force-border\" : \"cm-force-border\";\n    var start = builder.pos, end = start + text.length;\n    for (;;) {\n      // Find the part that overlaps with the start of this text\n      var part = (void 0);\n      for (var i = 0; i < order.length; i++) {\n        part = order[i];\n        if (part.to > start && part.from <= start) { break }\n      }\n      if (part.to >= end) { return inner(builder, text, style, startStyle, endStyle, title, css) }\n      inner(builder, text.slice(0, part.to - start), style, startStyle, null, title, css);\n      startStyle = null;\n      text = text.slice(part.to - start);\n      start = part.to;\n    }\n  }\n}\n\nfunction buildCollapsedSpan(builder, size, marker, ignoreWidget) {\n  var widget = !ignoreWidget && marker.widgetNode;\n  if (widget) { builder.map.push(builder.pos, builder.pos + size, widget); }\n  if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {\n    if (!widget)\n      { widget = builder.content.appendChild(document.createElement(\"span\")); }\n    widget.setAttribute(\"cm-marker\", marker.id);\n  }\n  if (widget) {\n    builder.cm.display.input.setUneditable(widget);\n    builder.content.appendChild(widget);\n  }\n  builder.pos += size;\n  builder.trailingSpace = false;\n}\n\n// Outputs a number of spans to make up a line, taking highlighting\n// and marked text into account.\nfunction insertLineContent(line, builder, styles) {\n  var spans = line.markedSpans, allText = line.text, at = 0;\n  if (!spans) {\n    for (var i$1 = 1; i$1 < styles.length; i$1+=2)\n      { builder.addToken(builder, allText.slice(at, at = styles[i$1]), interpretTokenStyle(styles[i$1+1], builder.cm.options)); }\n    return\n  }\n\n  var len = allText.length, pos = 0, i = 1, text = \"\", style, css;\n  var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;\n  for (;;) {\n    if (nextChange == pos) { // Update current marker set\n      spanStyle = spanEndStyle = spanStartStyle = title = css = \"\";\n      collapsed = null; nextChange = Infinity;\n      var foundBookmarks = [], endStyles = (void 0);\n      for (var j = 0; j < spans.length; ++j) {\n        var sp = spans[j], m = sp.marker;\n        if (m.type == \"bookmark\" && sp.from == pos && m.widgetNode) {\n          foundBookmarks.push(m);\n        } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {\n          if (sp.to != null && sp.to != pos && nextChange > sp.to) {\n            nextChange = sp.to;\n            spanEndStyle = \"\";\n          }\n          if (m.className) { spanStyle += \" \" + m.className; }\n          if (m.css) { css = (css ? css + \";\" : \"\") + m.css; }\n          if (m.startStyle && sp.from == pos) { spanStartStyle += \" \" + m.startStyle; }\n          if (m.endStyle && sp.to == nextChange) { (endStyles || (endStyles = [])).push(m.endStyle, sp.to); }\n          if (m.title && !title) { title = m.title; }\n          if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))\n            { collapsed = sp; }\n        } else if (sp.from > pos && nextChange > sp.from) {\n          nextChange = sp.from;\n        }\n      }\n      if (endStyles) { for (var j$1 = 0; j$1 < endStyles.length; j$1 += 2)\n        { if (endStyles[j$1 + 1] == nextChange) { spanEndStyle += \" \" + endStyles[j$1]; } } }\n\n      if (!collapsed || collapsed.from == pos) { for (var j$2 = 0; j$2 < foundBookmarks.length; ++j$2)\n        { buildCollapsedSpan(builder, 0, foundBookmarks[j$2]); } }\n      if (collapsed && (collapsed.from || 0) == pos) {\n        buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,\n                           collapsed.marker, collapsed.from == null);\n        if (collapsed.to == null) { return }\n        if (collapsed.to == pos) { collapsed = false; }\n      }\n    }\n    if (pos >= len) { break }\n\n    var upto = Math.min(len, nextChange);\n    while (true) {\n      if (text) {\n        var end = pos + text.length;\n        if (!collapsed) {\n          var tokenText = end > upto ? text.slice(0, upto - pos) : text;\n          builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,\n                           spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : \"\", title, css);\n        }\n        if (end >= upto) {text = text.slice(upto - pos); pos = upto; break}\n        pos = end;\n        spanStartStyle = \"\";\n      }\n      text = allText.slice(at, at = styles[i++]);\n      style = interpretTokenStyle(styles[i++], builder.cm.options);\n    }\n  }\n}\n\n\n// These objects are used to represent the visible (currently drawn)\n// part of the document. A LineView may correspond to multiple\n// logical lines, if those are connected by collapsed ranges.\nfunction LineView(doc, line, lineN) {\n  // The starting line\n  this.line = line;\n  // Continuing lines, if any\n  this.rest = visualLineContinued(line);\n  // Number of logical lines in this visual line\n  this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;\n  this.node = this.text = null;\n  this.hidden = lineIsHidden(doc, line);\n}\n\n// Create a range of LineView objects for the given lines.\nfunction buildViewArray(cm, from, to) {\n  var array = [], nextPos;\n  for (var pos = from; pos < to; pos = nextPos) {\n    var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);\n    nextPos = pos + view.size;\n    array.push(view);\n  }\n  return array\n}\n\nvar operationGroup = null;\n\nfunction pushOperation(op) {\n  if (operationGroup) {\n    operationGroup.ops.push(op);\n  } else {\n    op.ownsGroup = operationGroup = {\n      ops: [op],\n      delayedCallbacks: []\n    };\n  }\n}\n\nfunction fireCallbacksForOps(group) {\n  // Calls delayed callbacks and cursorActivity handlers until no\n  // new ones appear\n  var callbacks = group.delayedCallbacks, i = 0;\n  do {\n    for (; i < callbacks.length; i++)\n      { callbacks[i].call(null); }\n    for (var j = 0; j < group.ops.length; j++) {\n      var op = group.ops[j];\n      if (op.cursorActivityHandlers)\n        { while (op.cursorActivityCalled < op.cursorActivityHandlers.length)\n          { op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm); } }\n    }\n  } while (i < callbacks.length)\n}\n\nfunction finishOperation(op, endCb) {\n  var group = op.ownsGroup;\n  if (!group) { return }\n\n  try { fireCallbacksForOps(group); }\n  finally {\n    operationGroup = null;\n    endCb(group);\n  }\n}\n\nvar orphanDelayedCallbacks = null;\n\n// Often, we want to signal events at a point where we are in the\n// middle of some work, but don't want the handler to start calling\n// other methods on the editor, which might be in an inconsistent\n// state or simply not expect any other events to happen.\n// signalLater looks whether there are any handlers, and schedules\n// them to be executed when the last operation ends, or, if no\n// operation is active, when a timeout fires.\nfunction signalLater(emitter, type /*, values...*/) {\n  var arr = getHandlers(emitter, type);\n  if (!arr.length) { return }\n  var args = Array.prototype.slice.call(arguments, 2), list;\n  if (operationGroup) {\n    list = operationGroup.delayedCallbacks;\n  } else if (orphanDelayedCallbacks) {\n    list = orphanDelayedCallbacks;\n  } else {\n    list = orphanDelayedCallbacks = [];\n    setTimeout(fireOrphanDelayed, 0);\n  }\n  var loop = function ( i ) {\n    list.push(function () { return arr[i].apply(null, args); });\n  };\n\n  for (var i = 0; i < arr.length; ++i)\n    loop( i );\n}\n\nfunction fireOrphanDelayed() {\n  var delayed = orphanDelayedCallbacks;\n  orphanDelayedCallbacks = null;\n  for (var i = 0; i < delayed.length; ++i) { delayed[i](); }\n}\n\n// When an aspect of a line changes, a string is added to\n// lineView.changes. This updates the relevant part of the line's\n// DOM structure.\nfunction updateLineForChanges(cm, lineView, lineN, dims) {\n  for (var j = 0; j < lineView.changes.length; j++) {\n    var type = lineView.changes[j];\n    if (type == \"text\") { updateLineText(cm, lineView); }\n    else if (type == \"gutter\") { updateLineGutter(cm, lineView, lineN, dims); }\n    else if (type == \"class\") { updateLineClasses(cm, lineView); }\n    else if (type == \"widget\") { updateLineWidgets(cm, lineView, dims); }\n  }\n  lineView.changes = null;\n}\n\n// Lines with gutter elements, widgets or a background class need to\n// be wrapped, and have the extra elements added to the wrapper div\nfunction ensureLineWrapped(lineView) {\n  if (lineView.node == lineView.text) {\n    lineView.node = elt(\"div\", null, null, \"position: relative\");\n    if (lineView.text.parentNode)\n      { lineView.text.parentNode.replaceChild(lineView.node, lineView.text); }\n    lineView.node.appendChild(lineView.text);\n    if (ie && ie_version < 8) { lineView.node.style.zIndex = 2; }\n  }\n  return lineView.node\n}\n\nfunction updateLineBackground(cm, lineView) {\n  var cls = lineView.bgClass ? lineView.bgClass + \" \" + (lineView.line.bgClass || \"\") : lineView.line.bgClass;\n  if (cls) { cls += \" CodeMirror-linebackground\"; }\n  if (lineView.background) {\n    if (cls) { lineView.background.className = cls; }\n    else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }\n  } else if (cls) {\n    var wrap = ensureLineWrapped(lineView);\n    lineView.background = wrap.insertBefore(elt(\"div\", null, cls), wrap.firstChild);\n    cm.display.input.setUneditable(lineView.background);\n  }\n}\n\n// Wrapper around buildLineContent which will reuse the structure\n// in display.externalMeasured when possible.\nfunction getLineContent(cm, lineView) {\n  var ext = cm.display.externalMeasured;\n  if (ext && ext.line == lineView.line) {\n    cm.display.externalMeasured = null;\n    lineView.measure = ext.measure;\n    return ext.built\n  }\n  return buildLineContent(cm, lineView)\n}\n\n// Redraw the line's text. Interacts with the background and text\n// classes because the mode may output tokens that influence these\n// classes.\nfunction updateLineText(cm, lineView) {\n  var cls = lineView.text.className;\n  var built = getLineContent(cm, lineView);\n  if (lineView.text == lineView.node) { lineView.node = built.pre; }\n  lineView.text.parentNode.replaceChild(built.pre, lineView.text);\n  lineView.text = built.pre;\n  if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {\n    lineView.bgClass = built.bgClass;\n    lineView.textClass = built.textClass;\n    updateLineClasses(cm, lineView);\n  } else if (cls) {\n    lineView.text.className = cls;\n  }\n}\n\nfunction updateLineClasses(cm, lineView) {\n  updateLineBackground(cm, lineView);\n  if (lineView.line.wrapClass)\n    { ensureLineWrapped(lineView).className = lineView.line.wrapClass; }\n  else if (lineView.node != lineView.text)\n    { lineView.node.className = \"\"; }\n  var textClass = lineView.textClass ? lineView.textClass + \" \" + (lineView.line.textClass || \"\") : lineView.line.textClass;\n  lineView.text.className = textClass || \"\";\n}\n\nfunction updateLineGutter(cm, lineView, lineN, dims) {\n  if (lineView.gutter) {\n    lineView.node.removeChild(lineView.gutter);\n    lineView.gutter = null;\n  }\n  if (lineView.gutterBackground) {\n    lineView.node.removeChild(lineView.gutterBackground);\n    lineView.gutterBackground = null;\n  }\n  if (lineView.line.gutterClass) {\n    var wrap = ensureLineWrapped(lineView);\n    lineView.gutterBackground = elt(\"div\", null, \"CodeMirror-gutter-background \" + lineView.line.gutterClass,\n                                    (\"left: \" + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + \"px; width: \" + (dims.gutterTotalWidth) + \"px\"));\n    cm.display.input.setUneditable(lineView.gutterBackground);\n    wrap.insertBefore(lineView.gutterBackground, lineView.text);\n  }\n  var markers = lineView.line.gutterMarkers;\n  if (cm.options.lineNumbers || markers) {\n    var wrap$1 = ensureLineWrapped(lineView);\n    var gutterWrap = lineView.gutter = elt(\"div\", null, \"CodeMirror-gutter-wrapper\", (\"left: \" + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + \"px\"));\n    cm.display.input.setUneditable(gutterWrap);\n    wrap$1.insertBefore(gutterWrap, lineView.text);\n    if (lineView.line.gutterClass)\n      { gutterWrap.className += \" \" + lineView.line.gutterClass; }\n    if (cm.options.lineNumbers && (!markers || !markers[\"CodeMirror-linenumbers\"]))\n      { lineView.lineNumber = gutterWrap.appendChild(\n        elt(\"div\", lineNumberFor(cm.options, lineN),\n            \"CodeMirror-linenumber CodeMirror-gutter-elt\",\n            (\"left: \" + (dims.gutterLeft[\"CodeMirror-linenumbers\"]) + \"px; width: \" + (cm.display.lineNumInnerWidth) + \"px\"))); }\n    if (markers) { for (var k = 0; k < cm.options.gutters.length; ++k) {\n      var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];\n      if (found)\n        { gutterWrap.appendChild(elt(\"div\", [found], \"CodeMirror-gutter-elt\",\n                                   (\"left: \" + (dims.gutterLeft[id]) + \"px; width: \" + (dims.gutterWidth[id]) + \"px\"))); }\n    } }\n  }\n}\n\nfunction updateLineWidgets(cm, lineView, dims) {\n  if (lineView.alignable) { lineView.alignable = null; }\n  for (var node = lineView.node.firstChild, next = (void 0); node; node = next) {\n    next = node.nextSibling;\n    if (node.className == \"CodeMirror-linewidget\")\n      { lineView.node.removeChild(node); }\n  }\n  insertLineWidgets(cm, lineView, dims);\n}\n\n// Build a line's DOM representation from scratch\nfunction buildLineElement(cm, lineView, lineN, dims) {\n  var built = getLineContent(cm, lineView);\n  lineView.text = lineView.node = built.pre;\n  if (built.bgClass) { lineView.bgClass = built.bgClass; }\n  if (built.textClass) { lineView.textClass = built.textClass; }\n\n  updateLineClasses(cm, lineView);\n  updateLineGutter(cm, lineView, lineN, dims);\n  insertLineWidgets(cm, lineView, dims);\n  return lineView.node\n}\n\n// A lineView may contain multiple logical lines (when merged by\n// collapsed spans). The widgets for all of them need to be drawn.\nfunction insertLineWidgets(cm, lineView, dims) {\n  insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);\n  if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)\n    { insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false); } }\n}\n\nfunction insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {\n  if (!line.widgets) { return }\n  var wrap = ensureLineWrapped(lineView);\n  for (var i = 0, ws = line.widgets; i < ws.length; ++i) {\n    var widget = ws[i], node = elt(\"div\", [widget.node], \"CodeMirror-linewidget\");\n    if (!widget.handleMouseEvents) { node.setAttribute(\"cm-ignore-events\", \"true\"); }\n    positionLineWidget(widget, node, lineView, dims);\n    cm.display.input.setUneditable(node);\n    if (allowAbove && widget.above)\n      { wrap.insertBefore(node, lineView.gutter || lineView.text); }\n    else\n      { wrap.appendChild(node); }\n    signalLater(widget, \"redraw\");\n  }\n}\n\nfunction positionLineWidget(widget, node, lineView, dims) {\n  if (widget.noHScroll) {\n    (lineView.alignable || (lineView.alignable = [])).push(node);\n    var width = dims.wrapperWidth;\n    node.style.left = dims.fixedPos + \"px\";\n    if (!widget.coverGutter) {\n      width -= dims.gutterTotalWidth;\n      node.style.paddingLeft = dims.gutterTotalWidth + \"px\";\n    }\n    node.style.width = width + \"px\";\n  }\n  if (widget.coverGutter) {\n    node.style.zIndex = 5;\n    node.style.position = \"relative\";\n    if (!widget.noHScroll) { node.style.marginLeft = -dims.gutterTotalWidth + \"px\"; }\n  }\n}\n\nfunction widgetHeight(widget) {\n  if (widget.height != null) { return widget.height }\n  var cm = widget.doc.cm;\n  if (!cm) { return 0 }\n  if (!contains(document.body, widget.node)) {\n    var parentStyle = \"position: relative;\";\n    if (widget.coverGutter)\n      { parentStyle += \"margin-left: -\" + cm.display.gutters.offsetWidth + \"px;\"; }\n    if (widget.noHScroll)\n      { parentStyle += \"width: \" + cm.display.wrapper.clientWidth + \"px;\"; }\n    removeChildrenAndAdd(cm.display.measure, elt(\"div\", [widget.node], null, parentStyle));\n  }\n  return widget.height = widget.node.parentNode.offsetHeight\n}\n\n// Return true when the given mouse event happened in a widget\nfunction eventInWidget(display, e) {\n  for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {\n    if (!n || (n.nodeType == 1 && n.getAttribute(\"cm-ignore-events\") == \"true\") ||\n        (n.parentNode == display.sizer && n != display.mover))\n      { return true }\n  }\n}\n\n// POSITION MEASUREMENT\n\nfunction paddingTop(display) {return display.lineSpace.offsetTop}\nfunction paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight}\nfunction paddingH(display) {\n  if (display.cachedPaddingH) { return display.cachedPaddingH }\n  var e = removeChildrenAndAdd(display.measure, elt(\"pre\", \"x\"));\n  var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;\n  var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};\n  if (!isNaN(data.left) && !isNaN(data.right)) { display.cachedPaddingH = data; }\n  return data\n}\n\nfunction scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth }\nfunction displayWidth(cm) {\n  return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth\n}\nfunction displayHeight(cm) {\n  return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight\n}\n\n// Ensure the lineView.wrapping.heights array is populated. This is\n// an array of bottom offsets for the lines that make up a drawn\n// line. When lineWrapping is on, there might be more than one\n// height.\nfunction ensureLineHeights(cm, lineView, rect) {\n  var wrapping = cm.options.lineWrapping;\n  var curWidth = wrapping && displayWidth(cm);\n  if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {\n    var heights = lineView.measure.heights = [];\n    if (wrapping) {\n      lineView.measure.width = curWidth;\n      var rects = lineView.text.firstChild.getClientRects();\n      for (var i = 0; i < rects.length - 1; i++) {\n        var cur = rects[i], next = rects[i + 1];\n        if (Math.abs(cur.bottom - next.bottom) > 2)\n          { heights.push((cur.bottom + next.top) / 2 - rect.top); }\n      }\n    }\n    heights.push(rect.bottom - rect.top);\n  }\n}\n\n// Find a line map (mapping character offsets to text nodes) and a\n// measurement cache for the given line number. (A line view might\n// contain multiple lines when collapsed ranges are present.)\nfunction mapFromLineView(lineView, line, lineN) {\n  if (lineView.line == line)\n    { return {map: lineView.measure.map, cache: lineView.measure.cache} }\n  for (var i = 0; i < lineView.rest.length; i++)\n    { if (lineView.rest[i] == line)\n      { return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]} } }\n  for (var i$1 = 0; i$1 < lineView.rest.length; i$1++)\n    { if (lineNo(lineView.rest[i$1]) > lineN)\n      { return {map: lineView.measure.maps[i$1], cache: lineView.measure.caches[i$1], before: true} } }\n}\n\n// Render a line into the hidden node display.externalMeasured. Used\n// when measurement is needed for a line that's not in the viewport.\nfunction updateExternalMeasurement(cm, line) {\n  line = visualLine(line);\n  var lineN = lineNo(line);\n  var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);\n  view.lineN = lineN;\n  var built = view.built = buildLineContent(cm, view);\n  view.text = built.pre;\n  removeChildrenAndAdd(cm.display.lineMeasure, built.pre);\n  return view\n}\n\n// Get a {top, bottom, left, right} box (in line-local coordinates)\n// for a given character.\nfunction measureChar(cm, line, ch, bias) {\n  return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias)\n}\n\n// Find a line view that corresponds to the given line number.\nfunction findViewForLine(cm, lineN) {\n  if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)\n    { return cm.display.view[findViewIndex(cm, lineN)] }\n  var ext = cm.display.externalMeasured;\n  if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)\n    { return ext }\n}\n\n// Measurement can be split in two steps, the set-up work that\n// applies to the whole line, and the measurement of the actual\n// character. Functions like coordsChar, that need to do a lot of\n// measurements in a row, can thus ensure that the set-up work is\n// only done once.\nfunction prepareMeasureForLine(cm, line) {\n  var lineN = lineNo(line);\n  var view = findViewForLine(cm, lineN);\n  if (view && !view.text) {\n    view = null;\n  } else if (view && view.changes) {\n    updateLineForChanges(cm, view, lineN, getDimensions(cm));\n    cm.curOp.forceUpdate = true;\n  }\n  if (!view)\n    { view = updateExternalMeasurement(cm, line); }\n\n  var info = mapFromLineView(view, line, lineN);\n  return {\n    line: line, view: view, rect: null,\n    map: info.map, cache: info.cache, before: info.before,\n    hasHeights: false\n  }\n}\n\n// Given a prepared measurement object, measures the position of an\n// actual character (or fetches it from the cache).\nfunction measureCharPrepared(cm, prepared, ch, bias, varHeight) {\n  if (prepared.before) { ch = -1; }\n  var key = ch + (bias || \"\"), found;\n  if (prepared.cache.hasOwnProperty(key)) {\n    found = prepared.cache[key];\n  } else {\n    if (!prepared.rect)\n      { prepared.rect = prepared.view.text.getBoundingClientRect(); }\n    if (!prepared.hasHeights) {\n      ensureLineHeights(cm, prepared.view, prepared.rect);\n      prepared.hasHeights = true;\n    }\n    found = measureCharInner(cm, prepared, ch, bias);\n    if (!found.bogus) { prepared.cache[key] = found; }\n  }\n  return {left: found.left, right: found.right,\n          top: varHeight ? found.rtop : found.top,\n          bottom: varHeight ? found.rbottom : found.bottom}\n}\n\nvar nullRect = {left: 0, right: 0, top: 0, bottom: 0};\n\nfunction nodeAndOffsetInLineMap(map$$1, ch, bias) {\n  var node, start, end, collapse, mStart, mEnd;\n  // First, search the line map for the text node corresponding to,\n  // or closest to, the target character.\n  for (var i = 0; i < map$$1.length; i += 3) {\n    mStart = map$$1[i];\n    mEnd = map$$1[i + 1];\n    if (ch < mStart) {\n      start = 0; end = 1;\n      collapse = \"left\";\n    } else if (ch < mEnd) {\n      start = ch - mStart;\n      end = start + 1;\n    } else if (i == map$$1.length - 3 || ch == mEnd && map$$1[i + 3] > ch) {\n      end = mEnd - mStart;\n      start = end - 1;\n      if (ch >= mEnd) { collapse = \"right\"; }\n    }\n    if (start != null) {\n      node = map$$1[i + 2];\n      if (mStart == mEnd && bias == (node.insertLeft ? \"left\" : \"right\"))\n        { collapse = bias; }\n      if (bias == \"left\" && start == 0)\n        { while (i && map$$1[i - 2] == map$$1[i - 3] && map$$1[i - 1].insertLeft) {\n          node = map$$1[(i -= 3) + 2];\n          collapse = \"left\";\n        } }\n      if (bias == \"right\" && start == mEnd - mStart)\n        { while (i < map$$1.length - 3 && map$$1[i + 3] == map$$1[i + 4] && !map$$1[i + 5].insertLeft) {\n          node = map$$1[(i += 3) + 2];\n          collapse = \"right\";\n        } }\n      break\n    }\n  }\n  return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd}\n}\n\nfunction getUsefulRect(rects, bias) {\n  var rect = nullRect;\n  if (bias == \"left\") { for (var i = 0; i < rects.length; i++) {\n    if ((rect = rects[i]).left != rect.right) { break }\n  } } else { for (var i$1 = rects.length - 1; i$1 >= 0; i$1--) {\n    if ((rect = rects[i$1]).left != rect.right) { break }\n  } }\n  return rect\n}\n\nfunction measureCharInner(cm, prepared, ch, bias) {\n  var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);\n  var node = place.node, start = place.start, end = place.end, collapse = place.collapse;\n\n  var rect;\n  if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.\n    for (var i$1 = 0; i$1 < 4; i$1++) { // Retry a maximum of 4 times when nonsense rectangles are returned\n      while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) { --start; }\n      while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) { ++end; }\n      if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart)\n        { rect = node.parentNode.getBoundingClientRect(); }\n      else\n        { rect = getUsefulRect(range(node, start, end).getClientRects(), bias); }\n      if (rect.left || rect.right || start == 0) { break }\n      end = start;\n      start = start - 1;\n      collapse = \"right\";\n    }\n    if (ie && ie_version < 11) { rect = maybeUpdateRectForZooming(cm.display.measure, rect); }\n  } else { // If it is a widget, simply get the box for the whole widget.\n    if (start > 0) { collapse = bias = \"right\"; }\n    var rects;\n    if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)\n      { rect = rects[bias == \"right\" ? rects.length - 1 : 0]; }\n    else\n      { rect = node.getBoundingClientRect(); }\n  }\n  if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {\n    var rSpan = node.parentNode.getClientRects()[0];\n    if (rSpan)\n      { rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom}; }\n    else\n      { rect = nullRect; }\n  }\n\n  var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;\n  var mid = (rtop + rbot) / 2;\n  var heights = prepared.view.measure.heights;\n  var i = 0;\n  for (; i < heights.length - 1; i++)\n    { if (mid < heights[i]) { break } }\n  var top = i ? heights[i - 1] : 0, bot = heights[i];\n  var result = {left: (collapse == \"right\" ? rect.right : rect.left) - prepared.rect.left,\n                right: (collapse == \"left\" ? rect.left : rect.right) - prepared.rect.left,\n                top: top, bottom: bot};\n  if (!rect.left && !rect.right) { result.bogus = true; }\n  if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }\n\n  return result\n}\n\n// Work around problem with bounding client rects on ranges being\n// returned incorrectly when zoomed on IE10 and below.\nfunction maybeUpdateRectForZooming(measure, rect) {\n  if (!window.screen || screen.logicalXDPI == null ||\n      screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))\n    { return rect }\n  var scaleX = screen.logicalXDPI / screen.deviceXDPI;\n  var scaleY = screen.logicalYDPI / screen.deviceYDPI;\n  return {left: rect.left * scaleX, right: rect.right * scaleX,\n          top: rect.top * scaleY, bottom: rect.bottom * scaleY}\n}\n\nfunction clearLineMeasurementCacheFor(lineView) {\n  if (lineView.measure) {\n    lineView.measure.cache = {};\n    lineView.measure.heights = null;\n    if (lineView.rest) { for (var i = 0; i < lineView.rest.length; i++)\n      { lineView.measure.caches[i] = {}; } }\n  }\n}\n\nfunction clearLineMeasurementCache(cm) {\n  cm.display.externalMeasure = null;\n  removeChildren(cm.display.lineMeasure);\n  for (var i = 0; i < cm.display.view.length; i++)\n    { clearLineMeasurementCacheFor(cm.display.view[i]); }\n}\n\nfunction clearCaches(cm) {\n  clearLineMeasurementCache(cm);\n  cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;\n  if (!cm.options.lineWrapping) { cm.display.maxLineChanged = true; }\n  cm.display.lineNumChars = null;\n}\n\nfunction pageScrollX() {\n  // Work around https://bugs.chromium.org/p/chromium/issues/detail?id=489206\n  // which causes page_Offset and bounding client rects to use\n  // different reference viewports and invalidate our calculations.\n  if (chrome && android) { return -(document.body.getBoundingClientRect().left - parseInt(getComputedStyle(document.body).marginLeft)) }\n  return window.pageXOffset || (document.documentElement || document.body).scrollLeft\n}\nfunction pageScrollY() {\n  if (chrome && android) { return -(document.body.getBoundingClientRect().top - parseInt(getComputedStyle(document.body).marginTop)) }\n  return window.pageYOffset || (document.documentElement || document.body).scrollTop\n}\n\n// Converts a {top, bottom, left, right} box from line-local\n// coordinates into another coordinate system. Context may be one of\n// \"line\", \"div\" (display.lineDiv), \"local\"./null (editor), \"window\",\n// or \"page\".\nfunction intoCoordSystem(cm, lineObj, rect, context, includeWidgets) {\n  if (!includeWidgets && lineObj.widgets) { for (var i = 0; i < lineObj.widgets.length; ++i) { if (lineObj.widgets[i].above) {\n    var size = widgetHeight(lineObj.widgets[i]);\n    rect.top += size; rect.bottom += size;\n  } } }\n  if (context == \"line\") { return rect }\n  if (!context) { context = \"local\"; }\n  var yOff = heightAtLine(lineObj);\n  if (context == \"local\") { yOff += paddingTop(cm.display); }\n  else { yOff -= cm.display.viewOffset; }\n  if (context == \"page\" || context == \"window\") {\n    var lOff = cm.display.lineSpace.getBoundingClientRect();\n    yOff += lOff.top + (context == \"window\" ? 0 : pageScrollY());\n    var xOff = lOff.left + (context == \"window\" ? 0 : pageScrollX());\n    rect.left += xOff; rect.right += xOff;\n  }\n  rect.top += yOff; rect.bottom += yOff;\n  return rect\n}\n\n// Coverts a box from \"div\" coords to another coordinate system.\n// Context may be \"window\", \"page\", \"div\", or \"local\"./null.\nfunction fromCoordSystem(cm, coords, context) {\n  if (context == \"div\") { return coords }\n  var left = coords.left, top = coords.top;\n  // First move into \"page\" coordinate system\n  if (context == \"page\") {\n    left -= pageScrollX();\n    top -= pageScrollY();\n  } else if (context == \"local\" || !context) {\n    var localBox = cm.display.sizer.getBoundingClientRect();\n    left += localBox.left;\n    top += localBox.top;\n  }\n\n  var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();\n  return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top}\n}\n\nfunction charCoords(cm, pos, context, lineObj, bias) {\n  if (!lineObj) { lineObj = getLine(cm.doc, pos.line); }\n  return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context)\n}\n\n// Returns a box for a given cursor position, which may have an\n// 'other' property containing the position of the secondary cursor\n// on a bidi boundary.\n// A cursor Pos(line, char, \"before\") is on the same visual line as `char - 1`\n// and after `char - 1` in writing order of `char - 1`\n// A cursor Pos(line, char, \"after\") is on the same visual line as `char`\n// and before `char` in writing order of `char`\n// Examples (upper-case letters are RTL, lower-case are LTR):\n//     Pos(0, 1, ...)\n//     before   after\n// ab     a|b     a|b\n// aB     a|B     aB|\n// Ab     |Ab     A|b\n// AB     B|A     B|A\n// Every position after the last character on a line is considered to stick\n// to the last character on the line.\nfunction cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {\n  lineObj = lineObj || getLine(cm.doc, pos.line);\n  if (!preparedMeasure) { preparedMeasure = prepareMeasureForLine(cm, lineObj); }\n  function get(ch, right) {\n    var m = measureCharPrepared(cm, preparedMeasure, ch, right ? \"right\" : \"left\", varHeight);\n    if (right) { m.left = m.right; } else { m.right = m.left; }\n    return intoCoordSystem(cm, lineObj, m, context)\n  }\n  var order = getOrder(lineObj, cm.doc.direction), ch = pos.ch, sticky = pos.sticky;\n  if (ch >= lineObj.text.length) {\n    ch = lineObj.text.length;\n    sticky = \"before\";\n  } else if (ch <= 0) {\n    ch = 0;\n    sticky = \"after\";\n  }\n  if (!order) { return get(sticky == \"before\" ? ch - 1 : ch, sticky == \"before\") }\n\n  function getBidi(ch, partPos, invert) {\n    var part = order[partPos], right = (part.level % 2) != 0;\n    return get(invert ? ch - 1 : ch, right != invert)\n  }\n  var partPos = getBidiPartAt(order, ch, sticky);\n  var other = bidiOther;\n  var val = getBidi(ch, partPos, sticky == \"before\");\n  if (other != null) { val.other = getBidi(ch, other, sticky != \"before\"); }\n  return val\n}\n\n// Used to cheaply estimate the coordinates for a position. Used for\n// intermediate scroll updates.\nfunction estimateCoords(cm, pos) {\n  var left = 0;\n  pos = clipPos(cm.doc, pos);\n  if (!cm.options.lineWrapping) { left = charWidth(cm.display) * pos.ch; }\n  var lineObj = getLine(cm.doc, pos.line);\n  var top = heightAtLine(lineObj) + paddingTop(cm.display);\n  return {left: left, right: left, top: top, bottom: top + lineObj.height}\n}\n\n// Positions returned by coordsChar contain some extra information.\n// xRel is the relative x position of the input coordinates compared\n// to the found position (so xRel > 0 means the coordinates are to\n// the right of the character position, for example). When outside\n// is true, that means the coordinates lie outside the line's\n// vertical range.\nfunction PosWithInfo(line, ch, sticky, outside, xRel) {\n  var pos = Pos(line, ch, sticky);\n  pos.xRel = xRel;\n  if (outside) { pos.outside = true; }\n  return pos\n}\n\n// Compute the character position closest to the given coordinates.\n// Input must be lineSpace-local (\"div\" coordinate system).\nfunction coordsChar(cm, x, y) {\n  var doc = cm.doc;\n  y += cm.display.viewOffset;\n  if (y < 0) { return PosWithInfo(doc.first, 0, null, true, -1) }\n  var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;\n  if (lineN > last)\n    { return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, null, true, 1) }\n  if (x < 0) { x = 0; }\n\n  var lineObj = getLine(doc, lineN);\n  for (;;) {\n    var found = coordsCharInner(cm, lineObj, lineN, x, y);\n    var merged = collapsedSpanAtEnd(lineObj);\n    var mergedPos = merged && merged.find(0, true);\n    if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))\n      { lineN = lineNo(lineObj = mergedPos.to.line); }\n    else\n      { return found }\n  }\n}\n\nfunction wrappedLineExtent(cm, lineObj, preparedMeasure, y) {\n  var measure = function (ch) { return intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, ch), \"line\"); };\n  var end = lineObj.text.length;\n  var begin = findFirst(function (ch) { return measure(ch - 1).bottom <= y; }, end, 0);\n  end = findFirst(function (ch) { return measure(ch).top > y; }, begin, end);\n  return {begin: begin, end: end}\n}\n\nfunction wrappedLineExtentChar(cm, lineObj, preparedMeasure, target) {\n  var targetTop = intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, target), \"line\").top;\n  return wrappedLineExtent(cm, lineObj, preparedMeasure, targetTop)\n}\n\nfunction coordsCharInner(cm, lineObj, lineNo$$1, x, y) {\n  y -= heightAtLine(lineObj);\n  var begin = 0, end = lineObj.text.length;\n  var preparedMeasure = prepareMeasureForLine(cm, lineObj);\n  var pos;\n  var order = getOrder(lineObj, cm.doc.direction);\n  if (order) {\n    if (cm.options.lineWrapping) {\n      var assign;\n      ((assign = wrappedLineExtent(cm, lineObj, preparedMeasure, y), begin = assign.begin, end = assign.end, assign));\n    }\n    pos = new Pos(lineNo$$1, begin);\n    var beginLeft = cursorCoords(cm, pos, \"line\", lineObj, preparedMeasure).left;\n    var dir = beginLeft < x ? 1 : -1;\n    var prevDiff, diff = beginLeft - x, prevPos;\n    do {\n      prevDiff = diff;\n      prevPos = pos;\n      pos = moveVisually(cm, lineObj, pos, dir);\n      if (pos == null || pos.ch < begin || end <= (pos.sticky == \"before\" ? pos.ch - 1 : pos.ch)) {\n        pos = prevPos;\n        break\n      }\n      diff = cursorCoords(cm, pos, \"line\", lineObj, preparedMeasure).left - x;\n    } while ((dir < 0) != (diff < 0) && (Math.abs(diff) <= Math.abs(prevDiff)))\n    if (Math.abs(diff) > Math.abs(prevDiff)) {\n      if ((diff < 0) == (prevDiff < 0)) { throw new Error(\"Broke out of infinite loop in coordsCharInner\") }\n      pos = prevPos;\n    }\n  } else {\n    var ch = findFirst(function (ch) {\n      var box = intoCoordSystem(cm, lineObj, measureCharPrepared(cm, preparedMeasure, ch), \"line\");\n      if (box.top > y) {\n        // For the cursor stickiness\n        end = Math.min(ch, end);\n        return true\n      }\n      else if (box.bottom <= y) { return false }\n      else if (box.left > x) { return true }\n      else if (box.right < x) { return false }\n      else { return (x - box.left < box.right - x) }\n    }, begin, end);\n    ch = skipExtendingChars(lineObj.text, ch, 1);\n    pos = new Pos(lineNo$$1, ch, ch == end ? \"before\" : \"after\");\n  }\n  var coords = cursorCoords(cm, pos, \"line\", lineObj, preparedMeasure);\n  if (y < coords.top || coords.bottom < y) { pos.outside = true; }\n  pos.xRel = x < coords.left ? -1 : (x > coords.right ? 1 : 0);\n  return pos\n}\n\nvar measureText;\n// Compute the default text height.\nfunction textHeight(display) {\n  if (display.cachedTextHeight != null) { return display.cachedTextHeight }\n  if (measureText == null) {\n    measureText = elt(\"pre\");\n    // Measure a bunch of lines, for browsers that compute\n    // fractional heights.\n    for (var i = 0; i < 49; ++i) {\n      measureText.appendChild(document.createTextNode(\"x\"));\n      measureText.appendChild(elt(\"br\"));\n    }\n    measureText.appendChild(document.createTextNode(\"x\"));\n  }\n  removeChildrenAndAdd(display.measure, measureText);\n  var height = measureText.offsetHeight / 50;\n  if (height > 3) { display.cachedTextHeight = height; }\n  removeChildren(display.measure);\n  return height || 1\n}\n\n// Compute the default character width.\nfunction charWidth(display) {\n  if (display.cachedCharWidth != null) { return display.cachedCharWidth }\n  var anchor = elt(\"span\", \"xxxxxxxxxx\");\n  var pre = elt(\"pre\", [anchor]);\n  removeChildrenAndAdd(display.measure, pre);\n  var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;\n  if (width > 2) { display.cachedCharWidth = width; }\n  return width || 10\n}\n\n// Do a bulk-read of the DOM positions and sizes needed to draw the\n// view, so that we don't interleave reading and writing to the DOM.\nfunction getDimensions(cm) {\n  var d = cm.display, left = {}, width = {};\n  var gutterLeft = d.gutters.clientLeft;\n  for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {\n    left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;\n    width[cm.options.gutters[i]] = n.clientWidth;\n  }\n  return {fixedPos: compensateForHScroll(d),\n          gutterTotalWidth: d.gutters.offsetWidth,\n          gutterLeft: left,\n          gutterWidth: width,\n          wrapperWidth: d.wrapper.clientWidth}\n}\n\n// Computes display.scroller.scrollLeft + display.gutters.offsetWidth,\n// but using getBoundingClientRect to get a sub-pixel-accurate\n// result.\nfunction compensateForHScroll(display) {\n  return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left\n}\n\n// Returns a function that estimates the height of a line, to use as\n// first approximation until the line becomes visible (and is thus\n// properly measurable).\nfunction estimateHeight(cm) {\n  var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;\n  var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);\n  return function (line) {\n    if (lineIsHidden(cm.doc, line)) { return 0 }\n\n    var widgetsHeight = 0;\n    if (line.widgets) { for (var i = 0; i < line.widgets.length; i++) {\n      if (line.widgets[i].height) { widgetsHeight += line.widgets[i].height; }\n    } }\n\n    if (wrapping)\n      { return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th }\n    else\n      { return widgetsHeight + th }\n  }\n}\n\nfunction estimateLineHeights(cm) {\n  var doc = cm.doc, est = estimateHeight(cm);\n  doc.iter(function (line) {\n    var estHeight = est(line);\n    if (estHeight != line.height) { updateLineHeight(line, estHeight); }\n  });\n}\n\n// Given a mouse event, find the corresponding position. If liberal\n// is false, it checks whether a gutter or scrollbar was clicked,\n// and returns null if it was. forRect is used by rectangular\n// selections, and tries to estimate a character position even for\n// coordinates beyond the right of the text.\nfunction posFromMouse(cm, e, liberal, forRect) {\n  var display = cm.display;\n  if (!liberal && e_target(e).getAttribute(\"cm-not-content\") == \"true\") { return null }\n\n  var x, y, space = display.lineSpace.getBoundingClientRect();\n  // Fails unpredictably on IE[67] when mouse is dragged around quickly.\n  try { x = e.clientX - space.left; y = e.clientY - space.top; }\n  catch (e) { return null }\n  var coords = coordsChar(cm, x, y), line;\n  if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {\n    var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;\n    coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));\n  }\n  return coords\n}\n\n// Find the view element corresponding to a given line. Return null\n// when the line isn't visible.\nfunction findViewIndex(cm, n) {\n  if (n >= cm.display.viewTo) { return null }\n  n -= cm.display.viewFrom;\n  if (n < 0) { return null }\n  var view = cm.display.view;\n  for (var i = 0; i < view.length; i++) {\n    n -= view[i].size;\n    if (n < 0) { return i }\n  }\n}\n\nfunction updateSelection(cm) {\n  cm.display.input.showSelection(cm.display.input.prepareSelection());\n}\n\nfunction prepareSelection(cm, primary) {\n  var doc = cm.doc, result = {};\n  var curFragment = result.cursors = document.createDocumentFragment();\n  var selFragment = result.selection = document.createDocumentFragment();\n\n  for (var i = 0; i < doc.sel.ranges.length; i++) {\n    if (primary === false && i == doc.sel.primIndex) { continue }\n    var range$$1 = doc.sel.ranges[i];\n    if (range$$1.from().line >= cm.display.viewTo || range$$1.to().line < cm.display.viewFrom) { continue }\n    var collapsed = range$$1.empty();\n    if (collapsed || cm.options.showCursorWhenSelecting)\n      { drawSelectionCursor(cm, range$$1.head, curFragment); }\n    if (!collapsed)\n      { drawSelectionRange(cm, range$$1, selFragment); }\n  }\n  return result\n}\n\n// Draws a cursor for the given range\nfunction drawSelectionCursor(cm, head, output) {\n  var pos = cursorCoords(cm, head, \"div\", null, null, !cm.options.singleCursorHeightPerLine);\n\n  var cursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor\"));\n  cursor.style.left = pos.left + \"px\";\n  cursor.style.top = pos.top + \"px\";\n  cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + \"px\";\n\n  if (pos.other) {\n    // Secondary cursor, shown when on a 'jump' in bi-directional text\n    var otherCursor = output.appendChild(elt(\"div\", \"\\u00a0\", \"CodeMirror-cursor CodeMirror-secondarycursor\"));\n    otherCursor.style.display = \"\";\n    otherCursor.style.left = pos.other.left + \"px\";\n    otherCursor.style.top = pos.other.top + \"px\";\n    otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + \"px\";\n  }\n}\n\n// Draws the given range as a highlighted selection\nfunction drawSelectionRange(cm, range$$1, output) {\n  var display = cm.display, doc = cm.doc;\n  var fragment = document.createDocumentFragment();\n  var padding = paddingH(cm.display), leftSide = padding.left;\n  var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;\n\n  function add(left, top, width, bottom) {\n    if (top < 0) { top = 0; }\n    top = Math.round(top);\n    bottom = Math.round(bottom);\n    fragment.appendChild(elt(\"div\", null, \"CodeMirror-selected\", (\"position: absolute; left: \" + left + \"px;\\n                             top: \" + top + \"px; width: \" + (width == null ? rightSide - left : width) + \"px;\\n                             height: \" + (bottom - top) + \"px\")));\n  }\n\n  function drawForLine(line, fromArg, toArg) {\n    var lineObj = getLine(doc, line);\n    var lineLen = lineObj.text.length;\n    var start, end;\n    function coords(ch, bias) {\n      return charCoords(cm, Pos(line, ch), \"div\", lineObj, bias)\n    }\n\n    iterateBidiSections(getOrder(lineObj, doc.direction), fromArg || 0, toArg == null ? lineLen : toArg, function (from, to, dir) {\n      var leftPos = coords(from, \"left\"), rightPos, left, right;\n      if (from == to) {\n        rightPos = leftPos;\n        left = right = leftPos.left;\n      } else {\n        rightPos = coords(to - 1, \"right\");\n        if (dir == \"rtl\") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }\n        left = leftPos.left;\n        right = rightPos.right;\n      }\n      if (fromArg == null && from == 0) { left = leftSide; }\n      if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part\n        add(left, leftPos.top, null, leftPos.bottom);\n        left = leftSide;\n        if (leftPos.bottom < rightPos.top) { add(left, leftPos.bottom, null, rightPos.top); }\n      }\n      if (toArg == null && to == lineLen) { right = rightSide; }\n      if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)\n        { start = leftPos; }\n      if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)\n        { end = rightPos; }\n      if (left < leftSide + 1) { left = leftSide; }\n      add(left, rightPos.top, right - left, rightPos.bottom);\n    });\n    return {start: start, end: end}\n  }\n\n  var sFrom = range$$1.from(), sTo = range$$1.to();\n  if (sFrom.line == sTo.line) {\n    drawForLine(sFrom.line, sFrom.ch, sTo.ch);\n  } else {\n    var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);\n    var singleVLine = visualLine(fromLine) == visualLine(toLine);\n    var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;\n    var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;\n    if (singleVLine) {\n      if (leftEnd.top < rightStart.top - 2) {\n        add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);\n        add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);\n      } else {\n        add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);\n      }\n    }\n    if (leftEnd.bottom < rightStart.top)\n      { add(leftSide, leftEnd.bottom, null, rightStart.top); }\n  }\n\n  output.appendChild(fragment);\n}\n\n// Cursor-blinking\nfunction restartBlink(cm) {\n  if (!cm.state.focused) { return }\n  var display = cm.display;\n  clearInterval(display.blinker);\n  var on = true;\n  display.cursorDiv.style.visibility = \"\";\n  if (cm.options.cursorBlinkRate > 0)\n    { display.blinker = setInterval(function () { return display.cursorDiv.style.visibility = (on = !on) ? \"\" : \"hidden\"; },\n      cm.options.cursorBlinkRate); }\n  else if (cm.options.cursorBlinkRate < 0)\n    { display.cursorDiv.style.visibility = \"hidden\"; }\n}\n\nfunction ensureFocus(cm) {\n  if (!cm.state.focused) { cm.display.input.focus(); onFocus(cm); }\n}\n\nfunction delayBlurEvent(cm) {\n  cm.state.delayingBlurEvent = true;\n  setTimeout(function () { if (cm.state.delayingBlurEvent) {\n    cm.state.delayingBlurEvent = false;\n    onBlur(cm);\n  } }, 100);\n}\n\nfunction onFocus(cm, e) {\n  if (cm.state.delayingBlurEvent) { cm.state.delayingBlurEvent = false; }\n\n  if (cm.options.readOnly == \"nocursor\") { return }\n  if (!cm.state.focused) {\n    signal(cm, \"focus\", cm, e);\n    cm.state.focused = true;\n    addClass(cm.display.wrapper, \"CodeMirror-focused\");\n    // This test prevents this from firing when a context\n    // menu is closed (since the input reset would kill the\n    // select-all detection hack)\n    if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {\n      cm.display.input.reset();\n      if (webkit) { setTimeout(function () { return cm.display.input.reset(true); }, 20); } // Issue #1730\n    }\n    cm.display.input.receivedFocus();\n  }\n  restartBlink(cm);\n}\nfunction onBlur(cm, e) {\n  if (cm.state.delayingBlurEvent) { return }\n\n  if (cm.state.focused) {\n    signal(cm, \"blur\", cm, e);\n    cm.state.focused = false;\n    rmClass(cm.display.wrapper, \"CodeMirror-focused\");\n  }\n  clearInterval(cm.display.blinker);\n  setTimeout(function () { if (!cm.state.focused) { cm.display.shift = false; } }, 150);\n}\n\n// Read the actual heights of the rendered lines, and update their\n// stored heights to match.\nfunction updateHeightsInViewport(cm) {\n  var display = cm.display;\n  var prevBottom = display.lineDiv.offsetTop;\n  for (var i = 0; i < display.view.length; i++) {\n    var cur = display.view[i], height = (void 0);\n    if (cur.hidden) { continue }\n    if (ie && ie_version < 8) {\n      var bot = cur.node.offsetTop + cur.node.offsetHeight;\n      height = bot - prevBottom;\n      prevBottom = bot;\n    } else {\n      var box = cur.node.getBoundingClientRect();\n      height = box.bottom - box.top;\n    }\n    var diff = cur.line.height - height;\n    if (height < 2) { height = textHeight(display); }\n    if (diff > .001 || diff < -.001) {\n      updateLineHeight(cur.line, height);\n      updateWidgetHeight(cur.line);\n      if (cur.rest) { for (var j = 0; j < cur.rest.length; j++)\n        { updateWidgetHeight(cur.rest[j]); } }\n    }\n  }\n}\n\n// Read and store the height of line widgets associated with the\n// given line.\nfunction updateWidgetHeight(line) {\n  if (line.widgets) { for (var i = 0; i < line.widgets.length; ++i)\n    { line.widgets[i].height = line.widgets[i].node.parentNode.offsetHeight; } }\n}\n\n// Compute the lines that are visible in a given viewport (defaults\n// the the current scroll position). viewport may contain top,\n// height, and ensure (see op.scrollToPos) properties.\nfunction visibleLines(display, doc, viewport) {\n  var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;\n  top = Math.floor(top - paddingTop(display));\n  var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;\n\n  var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);\n  // Ensure is a {from: {line, ch}, to: {line, ch}} object, and\n  // forces those lines into the viewport (if possible).\n  if (viewport && viewport.ensure) {\n    var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;\n    if (ensureFrom < from) {\n      from = ensureFrom;\n      to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);\n    } else if (Math.min(ensureTo, doc.lastLine()) >= to) {\n      from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);\n      to = ensureTo;\n    }\n  }\n  return {from: from, to: Math.max(to, from + 1)}\n}\n\n// Re-align line numbers and gutter marks to compensate for\n// horizontal scrolling.\nfunction alignHorizontally(cm) {\n  var display = cm.display, view = display.view;\n  if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) { return }\n  var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;\n  var gutterW = display.gutters.offsetWidth, left = comp + \"px\";\n  for (var i = 0; i < view.length; i++) { if (!view[i].hidden) {\n    if (cm.options.fixedGutter) {\n      if (view[i].gutter)\n        { view[i].gutter.style.left = left; }\n      if (view[i].gutterBackground)\n        { view[i].gutterBackground.style.left = left; }\n    }\n    var align = view[i].alignable;\n    if (align) { for (var j = 0; j < align.length; j++)\n      { align[j].style.left = left; } }\n  } }\n  if (cm.options.fixedGutter)\n    { display.gutters.style.left = (comp + gutterW) + \"px\"; }\n}\n\n// Used to ensure that the line number gutter is still the right\n// size for the current document size. Returns true when an update\n// is needed.\nfunction maybeUpdateLineNumberWidth(cm) {\n  if (!cm.options.lineNumbers) { return false }\n  var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;\n  if (last.length != display.lineNumChars) {\n    var test = display.measure.appendChild(elt(\"div\", [elt(\"div\", last)],\n                                               \"CodeMirror-linenumber CodeMirror-gutter-elt\"));\n    var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;\n    display.lineGutter.style.width = \"\";\n    display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;\n    display.lineNumWidth = display.lineNumInnerWidth + padding;\n    display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;\n    display.lineGutter.style.width = display.lineNumWidth + \"px\";\n    updateGutterSpace(cm);\n    return true\n  }\n  return false\n}\n\n// SCROLLING THINGS INTO VIEW\n\n// If an editor sits on the top or bottom of the window, partially\n// scrolled out of view, this ensures that the cursor is visible.\nfunction maybeScrollWindow(cm, rect) {\n  if (signalDOMEvent(cm, \"scrollCursorIntoView\")) { return }\n\n  var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;\n  if (rect.top + box.top < 0) { doScroll = true; }\n  else if (rect.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) { doScroll = false; }\n  if (doScroll != null && !phantom) {\n    var scrollNode = elt(\"div\", \"\\u200b\", null, (\"position: absolute;\\n                         top: \" + (rect.top - display.viewOffset - paddingTop(cm.display)) + \"px;\\n                         height: \" + (rect.bottom - rect.top + scrollGap(cm) + display.barHeight) + \"px;\\n                         left: \" + (rect.left) + \"px; width: \" + (Math.max(2, rect.right - rect.left)) + \"px;\"));\n    cm.display.lineSpace.appendChild(scrollNode);\n    scrollNode.scrollIntoView(doScroll);\n    cm.display.lineSpace.removeChild(scrollNode);\n  }\n}\n\n// Scroll a given position into view (immediately), verifying that\n// it actually became visible (as line heights are accurately\n// measured, the position of something may 'drift' during drawing).\nfunction scrollPosIntoView(cm, pos, end, margin) {\n  if (margin == null) { margin = 0; }\n  var rect;\n  for (var limit = 0; limit < 5; limit++) {\n    var changed = false;\n    var coords = cursorCoords(cm, pos);\n    var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);\n    rect = {left: Math.min(coords.left, endCoords.left),\n            top: Math.min(coords.top, endCoords.top) - margin,\n            right: Math.max(coords.left, endCoords.left),\n            bottom: Math.max(coords.bottom, endCoords.bottom) + margin};\n    var scrollPos = calculateScrollPos(cm, rect);\n    var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;\n    if (scrollPos.scrollTop != null) {\n      updateScrollTop(cm, scrollPos.scrollTop);\n      if (Math.abs(cm.doc.scrollTop - startTop) > 1) { changed = true; }\n    }\n    if (scrollPos.scrollLeft != null) {\n      setScrollLeft(cm, scrollPos.scrollLeft);\n      if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) { changed = true; }\n    }\n    if (!changed) { break }\n  }\n  return rect\n}\n\n// Scroll a given set of coordinates into view (immediately).\nfunction scrollIntoView(cm, rect) {\n  var scrollPos = calculateScrollPos(cm, rect);\n  if (scrollPos.scrollTop != null) { updateScrollTop(cm, scrollPos.scrollTop); }\n  if (scrollPos.scrollLeft != null) { setScrollLeft(cm, scrollPos.scrollLeft); }\n}\n\n// Calculate a new scroll position needed to scroll the given\n// rectangle into view. Returns an object with scrollTop and\n// scrollLeft properties. When these are undefined, the\n// vertical/horizontal position does not need to be adjusted.\nfunction calculateScrollPos(cm, rect) {\n  var display = cm.display, snapMargin = textHeight(cm.display);\n  if (rect.top < 0) { rect.top = 0; }\n  var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;\n  var screen = displayHeight(cm), result = {};\n  if (rect.bottom - rect.top > screen) { rect.bottom = rect.top + screen; }\n  var docBottom = cm.doc.height + paddingVert(display);\n  var atTop = rect.top < snapMargin, atBottom = rect.bottom > docBottom - snapMargin;\n  if (rect.top < screentop) {\n    result.scrollTop = atTop ? 0 : rect.top;\n  } else if (rect.bottom > screentop + screen) {\n    var newTop = Math.min(rect.top, (atBottom ? docBottom : rect.bottom) - screen);\n    if (newTop != screentop) { result.scrollTop = newTop; }\n  }\n\n  var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;\n  var screenw = displayWidth(cm) - (cm.options.fixedGutter ? display.gutters.offsetWidth : 0);\n  var tooWide = rect.right - rect.left > screenw;\n  if (tooWide) { rect.right = rect.left + screenw; }\n  if (rect.left < 10)\n    { result.scrollLeft = 0; }\n  else if (rect.left < screenleft)\n    { result.scrollLeft = Math.max(0, rect.left - (tooWide ? 0 : 10)); }\n  else if (rect.right > screenw + screenleft - 3)\n    { result.scrollLeft = rect.right + (tooWide ? 0 : 10) - screenw; }\n  return result\n}\n\n// Store a relative adjustment to the scroll position in the current\n// operation (to be applied when the operation finishes).\nfunction addToScrollTop(cm, top) {\n  if (top == null) { return }\n  resolveScrollToPos(cm);\n  cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;\n}\n\n// Make sure that at the end of the operation the current cursor is\n// shown.\nfunction ensureCursorVisible(cm) {\n  resolveScrollToPos(cm);\n  var cur = cm.getCursor(), from = cur, to = cur;\n  if (!cm.options.lineWrapping) {\n    from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;\n    to = Pos(cur.line, cur.ch + 1);\n  }\n  cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin};\n}\n\nfunction scrollToCoords(cm, x, y) {\n  if (x != null || y != null) { resolveScrollToPos(cm); }\n  if (x != null) { cm.curOp.scrollLeft = x; }\n  if (y != null) { cm.curOp.scrollTop = y; }\n}\n\nfunction scrollToRange(cm, range$$1) {\n  resolveScrollToPos(cm);\n  cm.curOp.scrollToPos = range$$1;\n}\n\n// When an operation has its scrollToPos property set, and another\n// scroll action is applied before the end of the operation, this\n// 'simulates' scrolling that position into view in a cheap way, so\n// that the effect of intermediate scroll commands is not ignored.\nfunction resolveScrollToPos(cm) {\n  var range$$1 = cm.curOp.scrollToPos;\n  if (range$$1) {\n    cm.curOp.scrollToPos = null;\n    var from = estimateCoords(cm, range$$1.from), to = estimateCoords(cm, range$$1.to);\n    scrollToCoordsRange(cm, from, to, range$$1.margin);\n  }\n}\n\nfunction scrollToCoordsRange(cm, from, to, margin) {\n  var sPos = calculateScrollPos(cm, {\n    left: Math.min(from.left, to.left),\n    top: Math.min(from.top, to.top) - margin,\n    right: Math.max(from.right, to.right),\n    bottom: Math.max(from.bottom, to.bottom) + margin\n  });\n  scrollToCoords(cm, sPos.scrollLeft, sPos.scrollTop);\n}\n\n// Sync the scrollable area and scrollbars, ensure the viewport\n// covers the visible area.\nfunction updateScrollTop(cm, val) {\n  if (Math.abs(cm.doc.scrollTop - val) < 2) { return }\n  if (!gecko) { updateDisplaySimple(cm, {top: val}); }\n  setScrollTop(cm, val, true);\n  if (gecko) { updateDisplaySimple(cm); }\n  startWorker(cm, 100);\n}\n\nfunction setScrollTop(cm, val, forceScroll) {\n  val = Math.min(cm.display.scroller.scrollHeight - cm.display.scroller.clientHeight, val);\n  if (cm.display.scroller.scrollTop == val && !forceScroll) { return }\n  cm.doc.scrollTop = val;\n  cm.display.scrollbars.setScrollTop(val);\n  if (cm.display.scroller.scrollTop != val) { cm.display.scroller.scrollTop = val; }\n}\n\n// Sync scroller and scrollbar, ensure the gutter elements are\n// aligned.\nfunction setScrollLeft(cm, val, isScroller, forceScroll) {\n  val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);\n  if ((isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) && !forceScroll) { return }\n  cm.doc.scrollLeft = val;\n  alignHorizontally(cm);\n  if (cm.display.scroller.scrollLeft != val) { cm.display.scroller.scrollLeft = val; }\n  cm.display.scrollbars.setScrollLeft(val);\n}\n\n// SCROLLBARS\n\n// Prepare DOM reads needed to update the scrollbars. Done in one\n// shot to minimize update/measure roundtrips.\nfunction measureForScrollbars(cm) {\n  var d = cm.display, gutterW = d.gutters.offsetWidth;\n  var docH = Math.round(cm.doc.height + paddingVert(cm.display));\n  return {\n    clientHeight: d.scroller.clientHeight,\n    viewHeight: d.wrapper.clientHeight,\n    scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,\n    viewWidth: d.wrapper.clientWidth,\n    barLeft: cm.options.fixedGutter ? gutterW : 0,\n    docHeight: docH,\n    scrollHeight: docH + scrollGap(cm) + d.barHeight,\n    nativeBarWidth: d.nativeBarWidth,\n    gutterWidth: gutterW\n  }\n}\n\nvar NativeScrollbars = function(place, scroll, cm) {\n  this.cm = cm;\n  var vert = this.vert = elt(\"div\", [elt(\"div\", null, null, \"min-width: 1px\")], \"CodeMirror-vscrollbar\");\n  var horiz = this.horiz = elt(\"div\", [elt(\"div\", null, null, \"height: 100%; min-height: 1px\")], \"CodeMirror-hscrollbar\");\n  place(vert); place(horiz);\n\n  on(vert, \"scroll\", function () {\n    if (vert.clientHeight) { scroll(vert.scrollTop, \"vertical\"); }\n  });\n  on(horiz, \"scroll\", function () {\n    if (horiz.clientWidth) { scroll(horiz.scrollLeft, \"horizontal\"); }\n  });\n\n  this.checkedZeroWidth = false;\n  // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).\n  if (ie && ie_version < 8) { this.horiz.style.minHeight = this.vert.style.minWidth = \"18px\"; }\n};\n\nNativeScrollbars.prototype.update = function (measure) {\n  var needsH = measure.scrollWidth > measure.clientWidth + 1;\n  var needsV = measure.scrollHeight > measure.clientHeight + 1;\n  var sWidth = measure.nativeBarWidth;\n\n  if (needsV) {\n    this.vert.style.display = \"block\";\n    this.vert.style.bottom = needsH ? sWidth + \"px\" : \"0\";\n    var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);\n    // A bug in IE8 can cause this value to be negative, so guard it.\n    this.vert.firstChild.style.height =\n      Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + \"px\";\n  } else {\n    this.vert.style.display = \"\";\n    this.vert.firstChild.style.height = \"0\";\n  }\n\n  if (needsH) {\n    this.horiz.style.display = \"block\";\n    this.horiz.style.right = needsV ? sWidth + \"px\" : \"0\";\n    this.horiz.style.left = measure.barLeft + \"px\";\n    var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);\n    this.horiz.firstChild.style.width =\n      Math.max(0, measure.scrollWidth - measure.clientWidth + totalWidth) + \"px\";\n  } else {\n    this.horiz.style.display = \"\";\n    this.horiz.firstChild.style.width = \"0\";\n  }\n\n  if (!this.checkedZeroWidth && measure.clientHeight > 0) {\n    if (sWidth == 0) { this.zeroWidthHack(); }\n    this.checkedZeroWidth = true;\n  }\n\n  return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0}\n};\n\nNativeScrollbars.prototype.setScrollLeft = function (pos) {\n  if (this.horiz.scrollLeft != pos) { this.horiz.scrollLeft = pos; }\n  if (this.disableHoriz) { this.enableZeroWidthBar(this.horiz, this.disableHoriz, \"horiz\"); }\n};\n\nNativeScrollbars.prototype.setScrollTop = function (pos) {\n  if (this.vert.scrollTop != pos) { this.vert.scrollTop = pos; }\n  if (this.disableVert) { this.enableZeroWidthBar(this.vert, this.disableVert, \"vert\"); }\n};\n\nNativeScrollbars.prototype.zeroWidthHack = function () {\n  var w = mac && !mac_geMountainLion ? \"12px\" : \"18px\";\n  this.horiz.style.height = this.vert.style.width = w;\n  this.horiz.style.pointerEvents = this.vert.style.pointerEvents = \"none\";\n  this.disableHoriz = new Delayed;\n  this.disableVert = new Delayed;\n};\n\nNativeScrollbars.prototype.enableZeroWidthBar = function (bar, delay, type) {\n  bar.style.pointerEvents = \"auto\";\n  function maybeDisable() {\n    // To find out whether the scrollbar is still visible, we\n    // check whether the element under the pixel in the bottom\n    // right corner of the scrollbar box is the scrollbar box\n    // itself (when the bar is still visible) or its filler child\n    // (when the bar is hidden). If it is still visible, we keep\n    // it enabled, if it's hidden, we disable pointer events.\n    var box = bar.getBoundingClientRect();\n    var elt$$1 = type == \"vert\" ? document.elementFromPoint(box.right - 1, (box.top + box.bottom) / 2)\n        : document.elementFromPoint((box.right + box.left) / 2, box.bottom - 1);\n    if (elt$$1 != bar) { bar.style.pointerEvents = \"none\"; }\n    else { delay.set(1000, maybeDisable); }\n  }\n  delay.set(1000, maybeDisable);\n};\n\nNativeScrollbars.prototype.clear = function () {\n  var parent = this.horiz.parentNode;\n  parent.removeChild(this.horiz);\n  parent.removeChild(this.vert);\n};\n\nvar NullScrollbars = function () {};\n\nNullScrollbars.prototype.update = function () { return {bottom: 0, right: 0} };\nNullScrollbars.prototype.setScrollLeft = function () {};\nNullScrollbars.prototype.setScrollTop = function () {};\nNullScrollbars.prototype.clear = function () {};\n\nfunction updateScrollbars(cm, measure) {\n  if (!measure) { measure = measureForScrollbars(cm); }\n  var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;\n  updateScrollbarsInner(cm, measure);\n  for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {\n    if (startWidth != cm.display.barWidth && cm.options.lineWrapping)\n      { updateHeightsInViewport(cm); }\n    updateScrollbarsInner(cm, measureForScrollbars(cm));\n    startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;\n  }\n}\n\n// Re-synchronize the fake scrollbars with the actual size of the\n// content.\nfunction updateScrollbarsInner(cm, measure) {\n  var d = cm.display;\n  var sizes = d.scrollbars.update(measure);\n\n  d.sizer.style.paddingRight = (d.barWidth = sizes.right) + \"px\";\n  d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + \"px\";\n  d.heightForcer.style.borderBottom = sizes.bottom + \"px solid transparent\";\n\n  if (sizes.right && sizes.bottom) {\n    d.scrollbarFiller.style.display = \"block\";\n    d.scrollbarFiller.style.height = sizes.bottom + \"px\";\n    d.scrollbarFiller.style.width = sizes.right + \"px\";\n  } else { d.scrollbarFiller.style.display = \"\"; }\n  if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {\n    d.gutterFiller.style.display = \"block\";\n    d.gutterFiller.style.height = sizes.bottom + \"px\";\n    d.gutterFiller.style.width = measure.gutterWidth + \"px\";\n  } else { d.gutterFiller.style.display = \"\"; }\n}\n\nvar scrollbarModel = {\"native\": NativeScrollbars, \"null\": NullScrollbars};\n\nfunction initScrollbars(cm) {\n  if (cm.display.scrollbars) {\n    cm.display.scrollbars.clear();\n    if (cm.display.scrollbars.addClass)\n      { rmClass(cm.display.wrapper, cm.display.scrollbars.addClass); }\n  }\n\n  cm.display.scrollbars = new scrollbarModel[cm.options.scrollbarStyle](function (node) {\n    cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);\n    // Prevent clicks in the scrollbars from killing focus\n    on(node, \"mousedown\", function () {\n      if (cm.state.focused) { setTimeout(function () { return cm.display.input.focus(); }, 0); }\n    });\n    node.setAttribute(\"cm-not-content\", \"true\");\n  }, function (pos, axis) {\n    if (axis == \"horizontal\") { setScrollLeft(cm, pos); }\n    else { updateScrollTop(cm, pos); }\n  }, cm);\n  if (cm.display.scrollbars.addClass)\n    { addClass(cm.display.wrapper, cm.display.scrollbars.addClass); }\n}\n\n// Operations are used to wrap a series of changes to the editor\n// state in such a way that each change won't have to update the\n// cursor and display (which would be awkward, slow, and\n// error-prone). Instead, display updates are batched and then all\n// combined and executed at once.\n\nvar nextOpId = 0;\n// Start a new operation.\nfunction startOperation(cm) {\n  cm.curOp = {\n    cm: cm,\n    viewChanged: false,      // Flag that indicates that lines might need to be redrawn\n    startHeight: cm.doc.height, // Used to detect need to update scrollbar\n    forceUpdate: false,      // Used to force a redraw\n    updateInput: null,       // Whether to reset the input textarea\n    typing: false,           // Whether this reset should be careful to leave existing text (for compositing)\n    changeObjs: null,        // Accumulated changes, for firing change events\n    cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on\n    cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already\n    selectionChanged: false, // Whether the selection needs to be redrawn\n    updateMaxLine: false,    // Set when the widest line needs to be determined anew\n    scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet\n    scrollToPos: null,       // Used to scroll to a specific position\n    focus: false,\n    id: ++nextOpId           // Unique ID\n  };\n  pushOperation(cm.curOp);\n}\n\n// Finish an operation, updating the display and signalling delayed events\nfunction endOperation(cm) {\n  var op = cm.curOp;\n  finishOperation(op, function (group) {\n    for (var i = 0; i < group.ops.length; i++)\n      { group.ops[i].cm.curOp = null; }\n    endOperations(group);\n  });\n}\n\n// The DOM updates done when an operation finishes are batched so\n// that the minimum number of relayouts are required.\nfunction endOperations(group) {\n  var ops = group.ops;\n  for (var i = 0; i < ops.length; i++) // Read DOM\n    { endOperation_R1(ops[i]); }\n  for (var i$1 = 0; i$1 < ops.length; i$1++) // Write DOM (maybe)\n    { endOperation_W1(ops[i$1]); }\n  for (var i$2 = 0; i$2 < ops.length; i$2++) // Read DOM\n    { endOperation_R2(ops[i$2]); }\n  for (var i$3 = 0; i$3 < ops.length; i$3++) // Write DOM (maybe)\n    { endOperation_W2(ops[i$3]); }\n  for (var i$4 = 0; i$4 < ops.length; i$4++) // Read DOM\n    { endOperation_finish(ops[i$4]); }\n}\n\nfunction endOperation_R1(op) {\n  var cm = op.cm, display = cm.display;\n  maybeClipScrollbars(cm);\n  if (op.updateMaxLine) { findMaxLine(cm); }\n\n  op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||\n    op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||\n                       op.scrollToPos.to.line >= display.viewTo) ||\n    display.maxLineChanged && cm.options.lineWrapping;\n  op.update = op.mustUpdate &&\n    new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);\n}\n\nfunction endOperation_W1(op) {\n  op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);\n}\n\nfunction endOperation_R2(op) {\n  var cm = op.cm, display = cm.display;\n  if (op.updatedDisplay) { updateHeightsInViewport(cm); }\n\n  op.barMeasure = measureForScrollbars(cm);\n\n  // If the max line changed since it was last measured, measure it,\n  // and ensure the document's width matches it.\n  // updateDisplay_W2 will use these properties to do the actual resizing\n  if (display.maxLineChanged && !cm.options.lineWrapping) {\n    op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;\n    cm.display.sizerWidth = op.adjustWidthTo;\n    op.barMeasure.scrollWidth =\n      Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);\n    op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));\n  }\n\n  if (op.updatedDisplay || op.selectionChanged)\n    { op.preparedSelection = display.input.prepareSelection(op.focus); }\n}\n\nfunction endOperation_W2(op) {\n  var cm = op.cm;\n\n  if (op.adjustWidthTo != null) {\n    cm.display.sizer.style.minWidth = op.adjustWidthTo + \"px\";\n    if (op.maxScrollLeft < cm.doc.scrollLeft)\n      { setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true); }\n    cm.display.maxLineChanged = false;\n  }\n\n  var takeFocus = op.focus && op.focus == activeElt() && (!document.hasFocus || document.hasFocus());\n  if (op.preparedSelection)\n    { cm.display.input.showSelection(op.preparedSelection, takeFocus); }\n  if (op.updatedDisplay || op.startHeight != cm.doc.height)\n    { updateScrollbars(cm, op.barMeasure); }\n  if (op.updatedDisplay)\n    { setDocumentHeight(cm, op.barMeasure); }\n\n  if (op.selectionChanged) { restartBlink(cm); }\n\n  if (cm.state.focused && op.updateInput)\n    { cm.display.input.reset(op.typing); }\n  if (takeFocus) { ensureFocus(op.cm); }\n}\n\nfunction endOperation_finish(op) {\n  var cm = op.cm, display = cm.display, doc = cm.doc;\n\n  if (op.updatedDisplay) { postUpdateDisplay(cm, op.update); }\n\n  // Abort mouse wheel delta measurement, when scrolling explicitly\n  if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))\n    { display.wheelStartX = display.wheelStartY = null; }\n\n  // Propagate the scroll position to the actual DOM scroller\n  if (op.scrollTop != null) { setScrollTop(cm, op.scrollTop, op.forceScroll); }\n\n  if (op.scrollLeft != null) { setScrollLeft(cm, op.scrollLeft, true, true); }\n  // If we need to scroll a specific position into view, do so.\n  if (op.scrollToPos) {\n    var rect = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),\n                                 clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);\n    maybeScrollWindow(cm, rect);\n  }\n\n  // Fire events for markers that are hidden/unidden by editing or\n  // undoing\n  var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;\n  if (hidden) { for (var i = 0; i < hidden.length; ++i)\n    { if (!hidden[i].lines.length) { signal(hidden[i], \"hide\"); } } }\n  if (unhidden) { for (var i$1 = 0; i$1 < unhidden.length; ++i$1)\n    { if (unhidden[i$1].lines.length) { signal(unhidden[i$1], \"unhide\"); } } }\n\n  if (display.wrapper.offsetHeight)\n    { doc.scrollTop = cm.display.scroller.scrollTop; }\n\n  // Fire change events, and delayed event handlers\n  if (op.changeObjs)\n    { signal(cm, \"changes\", cm, op.changeObjs); }\n  if (op.update)\n    { op.update.finish(); }\n}\n\n// Run the given function in an operation\nfunction runInOp(cm, f) {\n  if (cm.curOp) { return f() }\n  startOperation(cm);\n  try { return f() }\n  finally { endOperation(cm); }\n}\n// Wraps a function in an operation. Returns the wrapped function.\nfunction operation(cm, f) {\n  return function() {\n    if (cm.curOp) { return f.apply(cm, arguments) }\n    startOperation(cm);\n    try { return f.apply(cm, arguments) }\n    finally { endOperation(cm); }\n  }\n}\n// Used to add methods to editor and doc instances, wrapping them in\n// operations.\nfunction methodOp(f) {\n  return function() {\n    if (this.curOp) { return f.apply(this, arguments) }\n    startOperation(this);\n    try { return f.apply(this, arguments) }\n    finally { endOperation(this); }\n  }\n}\nfunction docMethodOp(f) {\n  return function() {\n    var cm = this.cm;\n    if (!cm || cm.curOp) { return f.apply(this, arguments) }\n    startOperation(cm);\n    try { return f.apply(this, arguments) }\n    finally { endOperation(cm); }\n  }\n}\n\n// Updates the display.view data structure for a given change to the\n// document. From and to are in pre-change coordinates. Lendiff is\n// the amount of lines added or subtracted by the change. This is\n// used for changes that span multiple lines, or change the way\n// lines are divided into visual lines. regLineChange (below)\n// registers single-line changes.\nfunction regChange(cm, from, to, lendiff) {\n  if (from == null) { from = cm.doc.first; }\n  if (to == null) { to = cm.doc.first + cm.doc.size; }\n  if (!lendiff) { lendiff = 0; }\n\n  var display = cm.display;\n  if (lendiff && to < display.viewTo &&\n      (display.updateLineNumbers == null || display.updateLineNumbers > from))\n    { display.updateLineNumbers = from; }\n\n  cm.curOp.viewChanged = true;\n\n  if (from >= display.viewTo) { // Change after\n    if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)\n      { resetView(cm); }\n  } else if (to <= display.viewFrom) { // Change before\n    if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {\n      resetView(cm);\n    } else {\n      display.viewFrom += lendiff;\n      display.viewTo += lendiff;\n    }\n  } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap\n    resetView(cm);\n  } else if (from <= display.viewFrom) { // Top overlap\n    var cut = viewCuttingPoint(cm, to, to + lendiff, 1);\n    if (cut) {\n      display.view = display.view.slice(cut.index);\n      display.viewFrom = cut.lineN;\n      display.viewTo += lendiff;\n    } else {\n      resetView(cm);\n    }\n  } else if (to >= display.viewTo) { // Bottom overlap\n    var cut$1 = viewCuttingPoint(cm, from, from, -1);\n    if (cut$1) {\n      display.view = display.view.slice(0, cut$1.index);\n      display.viewTo = cut$1.lineN;\n    } else {\n      resetView(cm);\n    }\n  } else { // Gap in the middle\n    var cutTop = viewCuttingPoint(cm, from, from, -1);\n    var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);\n    if (cutTop && cutBot) {\n      display.view = display.view.slice(0, cutTop.index)\n        .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))\n        .concat(display.view.slice(cutBot.index));\n      display.viewTo += lendiff;\n    } else {\n      resetView(cm);\n    }\n  }\n\n  var ext = display.externalMeasured;\n  if (ext) {\n    if (to < ext.lineN)\n      { ext.lineN += lendiff; }\n    else if (from < ext.lineN + ext.size)\n      { display.externalMeasured = null; }\n  }\n}\n\n// Register a change to a single line. Type must be one of \"text\",\n// \"gutter\", \"class\", \"widget\"\nfunction regLineChange(cm, line, type) {\n  cm.curOp.viewChanged = true;\n  var display = cm.display, ext = cm.display.externalMeasured;\n  if (ext && line >= ext.lineN && line < ext.lineN + ext.size)\n    { display.externalMeasured = null; }\n\n  if (line < display.viewFrom || line >= display.viewTo) { return }\n  var lineView = display.view[findViewIndex(cm, line)];\n  if (lineView.node == null) { return }\n  var arr = lineView.changes || (lineView.changes = []);\n  if (indexOf(arr, type) == -1) { arr.push(type); }\n}\n\n// Clear the view.\nfunction resetView(cm) {\n  cm.display.viewFrom = cm.display.viewTo = cm.doc.first;\n  cm.display.view = [];\n  cm.display.viewOffset = 0;\n}\n\nfunction viewCuttingPoint(cm, oldN, newN, dir) {\n  var index = findViewIndex(cm, oldN), diff, view = cm.display.view;\n  if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)\n    { return {index: index, lineN: newN} }\n  var n = cm.display.viewFrom;\n  for (var i = 0; i < index; i++)\n    { n += view[i].size; }\n  if (n != oldN) {\n    if (dir > 0) {\n      if (index == view.length - 1) { return null }\n      diff = (n + view[index].size) - oldN;\n      index++;\n    } else {\n      diff = n - oldN;\n    }\n    oldN += diff; newN += diff;\n  }\n  while (visualLineNo(cm.doc, newN) != newN) {\n    if (index == (dir < 0 ? 0 : view.length - 1)) { return null }\n    newN += dir * view[index - (dir < 0 ? 1 : 0)].size;\n    index += dir;\n  }\n  return {index: index, lineN: newN}\n}\n\n// Force the view to cover a given range, adding empty view element\n// or clipping off existing ones as needed.\nfunction adjustView(cm, from, to) {\n  var display = cm.display, view = display.view;\n  if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {\n    display.view = buildViewArray(cm, from, to);\n    display.viewFrom = from;\n  } else {\n    if (display.viewFrom > from)\n      { display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view); }\n    else if (display.viewFrom < from)\n      { display.view = display.view.slice(findViewIndex(cm, from)); }\n    display.viewFrom = from;\n    if (display.viewTo < to)\n      { display.view = display.view.concat(buildViewArray(cm, display.viewTo, to)); }\n    else if (display.viewTo > to)\n      { display.view = display.view.slice(0, findViewIndex(cm, to)); }\n  }\n  display.viewTo = to;\n}\n\n// Count the number of lines in the view whose DOM representation is\n// out of date (or nonexistent).\nfunction countDirtyView(cm) {\n  var view = cm.display.view, dirty = 0;\n  for (var i = 0; i < view.length; i++) {\n    var lineView = view[i];\n    if (!lineView.hidden && (!lineView.node || lineView.changes)) { ++dirty; }\n  }\n  return dirty\n}\n\n// HIGHLIGHT WORKER\n\nfunction startWorker(cm, time) {\n  if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)\n    { cm.state.highlight.set(time, bind(highlightWorker, cm)); }\n}\n\nfunction highlightWorker(cm) {\n  var doc = cm.doc;\n  if (doc.frontier < doc.first) { doc.frontier = doc.first; }\n  if (doc.frontier >= cm.display.viewTo) { return }\n  var end = +new Date + cm.options.workTime;\n  var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));\n  var changedLines = [];\n\n  doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function (line) {\n    if (doc.frontier >= cm.display.viewFrom) { // Visible\n      var oldStyles = line.styles, tooLong = line.text.length > cm.options.maxHighlightLength;\n      var highlighted = highlightLine(cm, line, tooLong ? copyState(doc.mode, state) : state, true);\n      line.styles = highlighted.styles;\n      var oldCls = line.styleClasses, newCls = highlighted.classes;\n      if (newCls) { line.styleClasses = newCls; }\n      else if (oldCls) { line.styleClasses = null; }\n      var ischange = !oldStyles || oldStyles.length != line.styles.length ||\n        oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);\n      for (var i = 0; !ischange && i < oldStyles.length; ++i) { ischange = oldStyles[i] != line.styles[i]; }\n      if (ischange) { changedLines.push(doc.frontier); }\n      line.stateAfter = tooLong ? state : copyState(doc.mode, state);\n    } else {\n      if (line.text.length <= cm.options.maxHighlightLength)\n        { processLine(cm, line.text, state); }\n      line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;\n    }\n    ++doc.frontier;\n    if (+new Date > end) {\n      startWorker(cm, cm.options.workDelay);\n      return true\n    }\n  });\n  if (changedLines.length) { runInOp(cm, function () {\n    for (var i = 0; i < changedLines.length; i++)\n      { regLineChange(cm, changedLines[i], \"text\"); }\n  }); }\n}\n\n// DISPLAY DRAWING\n\nvar DisplayUpdate = function(cm, viewport, force) {\n  var display = cm.display;\n\n  this.viewport = viewport;\n  // Store some values that we'll need later (but don't want to force a relayout for)\n  this.visible = visibleLines(display, cm.doc, viewport);\n  this.editorIsHidden = !display.wrapper.offsetWidth;\n  this.wrapperHeight = display.wrapper.clientHeight;\n  this.wrapperWidth = display.wrapper.clientWidth;\n  this.oldDisplayWidth = displayWidth(cm);\n  this.force = force;\n  this.dims = getDimensions(cm);\n  this.events = [];\n};\n\nDisplayUpdate.prototype.signal = function (emitter, type) {\n  if (hasHandler(emitter, type))\n    { this.events.push(arguments); }\n};\nDisplayUpdate.prototype.finish = function () {\n    var this$1 = this;\n\n  for (var i = 0; i < this.events.length; i++)\n    { signal.apply(null, this$1.events[i]); }\n};\n\nfunction maybeClipScrollbars(cm) {\n  var display = cm.display;\n  if (!display.scrollbarsClipped && display.scroller.offsetWidth) {\n    display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;\n    display.heightForcer.style.height = scrollGap(cm) + \"px\";\n    display.sizer.style.marginBottom = -display.nativeBarWidth + \"px\";\n    display.sizer.style.borderRightWidth = scrollGap(cm) + \"px\";\n    display.scrollbarsClipped = true;\n  }\n}\n\nfunction selectionSnapshot(cm) {\n  if (cm.hasFocus()) { return null }\n  var active = activeElt();\n  if (!active || !contains(cm.display.lineDiv, active)) { return null }\n  var result = {activeElt: active};\n  if (window.getSelection) {\n    var sel = window.getSelection();\n    if (sel.anchorNode && sel.extend && contains(cm.display.lineDiv, sel.anchorNode)) {\n      result.anchorNode = sel.anchorNode;\n      result.anchorOffset = sel.anchorOffset;\n      result.focusNode = sel.focusNode;\n      result.focusOffset = sel.focusOffset;\n    }\n  }\n  return result\n}\n\nfunction restoreSelection(snapshot) {\n  if (!snapshot || !snapshot.activeElt || snapshot.activeElt == activeElt()) { return }\n  snapshot.activeElt.focus();\n  if (snapshot.anchorNode && contains(document.body, snapshot.anchorNode) && contains(document.body, snapshot.focusNode)) {\n    var sel = window.getSelection(), range$$1 = document.createRange();\n    range$$1.setEnd(snapshot.anchorNode, snapshot.anchorOffset);\n    range$$1.collapse(false);\n    sel.removeAllRanges();\n    sel.addRange(range$$1);\n    sel.extend(snapshot.focusNode, snapshot.focusOffset);\n  }\n}\n\n// Does the actual updating of the line display. Bails out\n// (returning false) when there is nothing to be done and forced is\n// false.\nfunction updateDisplayIfNeeded(cm, update) {\n  var display = cm.display, doc = cm.doc;\n\n  if (update.editorIsHidden) {\n    resetView(cm);\n    return false\n  }\n\n  // Bail out if the visible area is already rendered and nothing changed.\n  if (!update.force &&\n      update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&\n      (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&\n      display.renderedView == display.view && countDirtyView(cm) == 0)\n    { return false }\n\n  if (maybeUpdateLineNumberWidth(cm)) {\n    resetView(cm);\n    update.dims = getDimensions(cm);\n  }\n\n  // Compute a suitable new viewport (from & to)\n  var end = doc.first + doc.size;\n  var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);\n  var to = Math.min(end, update.visible.to + cm.options.viewportMargin);\n  if (display.viewFrom < from && from - display.viewFrom < 20) { from = Math.max(doc.first, display.viewFrom); }\n  if (display.viewTo > to && display.viewTo - to < 20) { to = Math.min(end, display.viewTo); }\n  if (sawCollapsedSpans) {\n    from = visualLineNo(cm.doc, from);\n    to = visualLineEndNo(cm.doc, to);\n  }\n\n  var different = from != display.viewFrom || to != display.viewTo ||\n    display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;\n  adjustView(cm, from, to);\n\n  display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));\n  // Position the mover div to align with the current scroll position\n  cm.display.mover.style.top = display.viewOffset + \"px\";\n\n  var toUpdate = countDirtyView(cm);\n  if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&\n      (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))\n    { return false }\n\n  // For big changes, we hide the enclosing element during the\n  // update, since that speeds up the operations on most browsers.\n  var selSnapshot = selectionSnapshot(cm);\n  if (toUpdate > 4) { display.lineDiv.style.display = \"none\"; }\n  patchDisplay(cm, display.updateLineNumbers, update.dims);\n  if (toUpdate > 4) { display.lineDiv.style.display = \"\"; }\n  display.renderedView = display.view;\n  // There might have been a widget with a focused element that got\n  // hidden or updated, if so re-focus it.\n  restoreSelection(selSnapshot);\n\n  // Prevent selection and cursors from interfering with the scroll\n  // width and height.\n  removeChildren(display.cursorDiv);\n  removeChildren(display.selectionDiv);\n  display.gutters.style.height = display.sizer.style.minHeight = 0;\n\n  if (different) {\n    display.lastWrapHeight = update.wrapperHeight;\n    display.lastWrapWidth = update.wrapperWidth;\n    startWorker(cm, 400);\n  }\n\n  display.updateLineNumbers = null;\n\n  return true\n}\n\nfunction postUpdateDisplay(cm, update) {\n  var viewport = update.viewport;\n\n  for (var first = true;; first = false) {\n    if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {\n      // Clip forced viewport to actual scrollable area.\n      if (viewport && viewport.top != null)\n        { viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)}; }\n      // Updated line heights might result in the drawn area not\n      // actually covering the viewport. Keep looping until it does.\n      update.visible = visibleLines(cm.display, cm.doc, viewport);\n      if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)\n        { break }\n    }\n    if (!updateDisplayIfNeeded(cm, update)) { break }\n    updateHeightsInViewport(cm);\n    var barMeasure = measureForScrollbars(cm);\n    updateSelection(cm);\n    updateScrollbars(cm, barMeasure);\n    setDocumentHeight(cm, barMeasure);\n  }\n\n  update.signal(cm, \"update\", cm);\n  if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {\n    update.signal(cm, \"viewportChange\", cm, cm.display.viewFrom, cm.display.viewTo);\n    cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;\n  }\n}\n\nfunction updateDisplaySimple(cm, viewport) {\n  var update = new DisplayUpdate(cm, viewport);\n  if (updateDisplayIfNeeded(cm, update)) {\n    updateHeightsInViewport(cm);\n    postUpdateDisplay(cm, update);\n    var barMeasure = measureForScrollbars(cm);\n    updateSelection(cm);\n    updateScrollbars(cm, barMeasure);\n    setDocumentHeight(cm, barMeasure);\n    update.finish();\n  }\n}\n\n// Sync the actual display DOM structure with display.view, removing\n// nodes for lines that are no longer in view, and creating the ones\n// that are not there yet, and updating the ones that are out of\n// date.\nfunction patchDisplay(cm, updateNumbersFrom, dims) {\n  var display = cm.display, lineNumbers = cm.options.lineNumbers;\n  var container = display.lineDiv, cur = container.firstChild;\n\n  function rm(node) {\n    var next = node.nextSibling;\n    // Works around a throw-scroll bug in OS X Webkit\n    if (webkit && mac && cm.display.currentWheelTarget == node)\n      { node.style.display = \"none\"; }\n    else\n      { node.parentNode.removeChild(node); }\n    return next\n  }\n\n  var view = display.view, lineN = display.viewFrom;\n  // Loop over the elements in the view, syncing cur (the DOM nodes\n  // in display.lineDiv) with the view as we go.\n  for (var i = 0; i < view.length; i++) {\n    var lineView = view[i];\n    if (lineView.hidden) {\n    } else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet\n      var node = buildLineElement(cm, lineView, lineN, dims);\n      container.insertBefore(node, cur);\n    } else { // Already drawn\n      while (cur != lineView.node) { cur = rm(cur); }\n      var updateNumber = lineNumbers && updateNumbersFrom != null &&\n        updateNumbersFrom <= lineN && lineView.lineNumber;\n      if (lineView.changes) {\n        if (indexOf(lineView.changes, \"gutter\") > -1) { updateNumber = false; }\n        updateLineForChanges(cm, lineView, lineN, dims);\n      }\n      if (updateNumber) {\n        removeChildren(lineView.lineNumber);\n        lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));\n      }\n      cur = lineView.node.nextSibling;\n    }\n    lineN += lineView.size;\n  }\n  while (cur) { cur = rm(cur); }\n}\n\nfunction updateGutterSpace(cm) {\n  var width = cm.display.gutters.offsetWidth;\n  cm.display.sizer.style.marginLeft = width + \"px\";\n}\n\nfunction setDocumentHeight(cm, measure) {\n  cm.display.sizer.style.minHeight = measure.docHeight + \"px\";\n  cm.display.heightForcer.style.top = measure.docHeight + \"px\";\n  cm.display.gutters.style.height = (measure.docHeight + cm.display.barHeight + scrollGap(cm)) + \"px\";\n}\n\n// Rebuild the gutter elements, ensure the margin to the left of the\n// code matches their width.\nfunction updateGutters(cm) {\n  var gutters = cm.display.gutters, specs = cm.options.gutters;\n  removeChildren(gutters);\n  var i = 0;\n  for (; i < specs.length; ++i) {\n    var gutterClass = specs[i];\n    var gElt = gutters.appendChild(elt(\"div\", null, \"CodeMirror-gutter \" + gutterClass));\n    if (gutterClass == \"CodeMirror-linenumbers\") {\n      cm.display.lineGutter = gElt;\n      gElt.style.width = (cm.display.lineNumWidth || 1) + \"px\";\n    }\n  }\n  gutters.style.display = i ? \"\" : \"none\";\n  updateGutterSpace(cm);\n}\n\n// Make sure the gutters options contains the element\n// \"CodeMirror-linenumbers\" when the lineNumbers option is true.\nfunction setGuttersForLineNumbers(options) {\n  var found = indexOf(options.gutters, \"CodeMirror-linenumbers\");\n  if (found == -1 && options.lineNumbers) {\n    options.gutters = options.gutters.concat([\"CodeMirror-linenumbers\"]);\n  } else if (found > -1 && !options.lineNumbers) {\n    options.gutters = options.gutters.slice(0);\n    options.gutters.splice(found, 1);\n  }\n}\n\n// Since the delta values reported on mouse wheel events are\n// unstandardized between browsers and even browser versions, and\n// generally horribly unpredictable, this code starts by measuring\n// the scroll effect that the first few mouse wheel events have,\n// and, from that, detects the way it can convert deltas to pixel\n// offsets afterwards.\n//\n// The reason we want to know the amount a wheel event will scroll\n// is that it gives us a chance to update the display before the\n// actual scrolling happens, reducing flickering.\n\nvar wheelSamples = 0;\nvar wheelPixelsPerUnit = null;\n// Fill in a browser-detected starting value on browsers where we\n// know one. These don't have to be accurate -- the result of them\n// being wrong would just be a slight flicker on the first wheel\n// scroll (if it is large enough).\nif (ie) { wheelPixelsPerUnit = -.53; }\nelse if (gecko) { wheelPixelsPerUnit = 15; }\nelse if (chrome) { wheelPixelsPerUnit = -.7; }\nelse if (safari) { wheelPixelsPerUnit = -1/3; }\n\nfunction wheelEventDelta(e) {\n  var dx = e.wheelDeltaX, dy = e.wheelDeltaY;\n  if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) { dx = e.detail; }\n  if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) { dy = e.detail; }\n  else if (dy == null) { dy = e.wheelDelta; }\n  return {x: dx, y: dy}\n}\nfunction wheelEventPixels(e) {\n  var delta = wheelEventDelta(e);\n  delta.x *= wheelPixelsPerUnit;\n  delta.y *= wheelPixelsPerUnit;\n  return delta\n}\n\nfunction onScrollWheel(cm, e) {\n  var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;\n\n  var display = cm.display, scroll = display.scroller;\n  // Quit if there's nothing to scroll here\n  var canScrollX = scroll.scrollWidth > scroll.clientWidth;\n  var canScrollY = scroll.scrollHeight > scroll.clientHeight;\n  if (!(dx && canScrollX || dy && canScrollY)) { return }\n\n  // Webkit browsers on OS X abort momentum scrolls when the target\n  // of the scroll event is removed from the scrollable element.\n  // This hack (see related code in patchDisplay) makes sure the\n  // element is kept around.\n  if (dy && mac && webkit) {\n    outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {\n      for (var i = 0; i < view.length; i++) {\n        if (view[i].node == cur) {\n          cm.display.currentWheelTarget = cur;\n          break outer\n        }\n      }\n    }\n  }\n\n  // On some browsers, horizontal scrolling will cause redraws to\n  // happen before the gutter has been realigned, causing it to\n  // wriggle around in a most unseemly way. When we have an\n  // estimated pixels/delta value, we just handle horizontal\n  // scrolling entirely here. It'll be slightly off from native, but\n  // better than glitching out.\n  if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {\n    if (dy && canScrollY)\n      { updateScrollTop(cm, Math.max(0, scroll.scrollTop + dy * wheelPixelsPerUnit)); }\n    setScrollLeft(cm, Math.max(0, scroll.scrollLeft + dx * wheelPixelsPerUnit));\n    // Only prevent default scrolling if vertical scrolling is\n    // actually possible. Otherwise, it causes vertical scroll\n    // jitter on OSX trackpads when deltaX is small and deltaY\n    // is large (issue #3579)\n    if (!dy || (dy && canScrollY))\n      { e_preventDefault(e); }\n    display.wheelStartX = null; // Abort measurement, if in progress\n    return\n  }\n\n  // 'Project' the visible viewport to cover the area that is being\n  // scrolled into view (if we know enough to estimate it).\n  if (dy && wheelPixelsPerUnit != null) {\n    var pixels = dy * wheelPixelsPerUnit;\n    var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;\n    if (pixels < 0) { top = Math.max(0, top + pixels - 50); }\n    else { bot = Math.min(cm.doc.height, bot + pixels + 50); }\n    updateDisplaySimple(cm, {top: top, bottom: bot});\n  }\n\n  if (wheelSamples < 20) {\n    if (display.wheelStartX == null) {\n      display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;\n      display.wheelDX = dx; display.wheelDY = dy;\n      setTimeout(function () {\n        if (display.wheelStartX == null) { return }\n        var movedX = scroll.scrollLeft - display.wheelStartX;\n        var movedY = scroll.scrollTop - display.wheelStartY;\n        var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||\n          (movedX && display.wheelDX && movedX / display.wheelDX);\n        display.wheelStartX = display.wheelStartY = null;\n        if (!sample) { return }\n        wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);\n        ++wheelSamples;\n      }, 200);\n    } else {\n      display.wheelDX += dx; display.wheelDY += dy;\n    }\n  }\n}\n\n// Selection objects are immutable. A new one is created every time\n// the selection changes. A selection is one or more non-overlapping\n// (and non-touching) ranges, sorted, and an integer that indicates\n// which one is the primary selection (the one that's scrolled into\n// view, that getCursor returns, etc).\nvar Selection = function(ranges, primIndex) {\n  this.ranges = ranges;\n  this.primIndex = primIndex;\n};\n\nSelection.prototype.primary = function () { return this.ranges[this.primIndex] };\n\nSelection.prototype.equals = function (other) {\n    var this$1 = this;\n\n  if (other == this) { return true }\n  if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) { return false }\n  for (var i = 0; i < this.ranges.length; i++) {\n    var here = this$1.ranges[i], there = other.ranges[i];\n    if (!equalCursorPos(here.anchor, there.anchor) || !equalCursorPos(here.head, there.head)) { return false }\n  }\n  return true\n};\n\nSelection.prototype.deepCopy = function () {\n    var this$1 = this;\n\n  var out = [];\n  for (var i = 0; i < this.ranges.length; i++)\n    { out[i] = new Range(copyPos(this$1.ranges[i].anchor), copyPos(this$1.ranges[i].head)); }\n  return new Selection(out, this.primIndex)\n};\n\nSelection.prototype.somethingSelected = function () {\n    var this$1 = this;\n\n  for (var i = 0; i < this.ranges.length; i++)\n    { if (!this$1.ranges[i].empty()) { return true } }\n  return false\n};\n\nSelection.prototype.contains = function (pos, end) {\n    var this$1 = this;\n\n  if (!end) { end = pos; }\n  for (var i = 0; i < this.ranges.length; i++) {\n    var range = this$1.ranges[i];\n    if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)\n      { return i }\n  }\n  return -1\n};\n\nvar Range = function(anchor, head) {\n  this.anchor = anchor; this.head = head;\n};\n\nRange.prototype.from = function () { return minPos(this.anchor, this.head) };\nRange.prototype.to = function () { return maxPos(this.anchor, this.head) };\nRange.prototype.empty = function () { return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch };\n\n// Take an unsorted, potentially overlapping set of ranges, and\n// build a selection out of it. 'Consumes' ranges array (modifying\n// it).\nfunction normalizeSelection(ranges, primIndex) {\n  var prim = ranges[primIndex];\n  ranges.sort(function (a, b) { return cmp(a.from(), b.from()); });\n  primIndex = indexOf(ranges, prim);\n  for (var i = 1; i < ranges.length; i++) {\n    var cur = ranges[i], prev = ranges[i - 1];\n    if (cmp(prev.to(), cur.from()) >= 0) {\n      var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());\n      var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;\n      if (i <= primIndex) { --primIndex; }\n      ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));\n    }\n  }\n  return new Selection(ranges, primIndex)\n}\n\nfunction simpleSelection(anchor, head) {\n  return new Selection([new Range(anchor, head || anchor)], 0)\n}\n\n// Compute the position of the end of a change (its 'to' property\n// refers to the pre-change end).\nfunction changeEnd(change) {\n  if (!change.text) { return change.to }\n  return Pos(change.from.line + change.text.length - 1,\n             lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0))\n}\n\n// Adjust a position to refer to the post-change position of the\n// same text, or the end of the change if the change covers it.\nfunction adjustForChange(pos, change) {\n  if (cmp(pos, change.from) < 0) { return pos }\n  if (cmp(pos, change.to) <= 0) { return changeEnd(change) }\n\n  var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;\n  if (pos.line == change.to.line) { ch += changeEnd(change).ch - change.to.ch; }\n  return Pos(line, ch)\n}\n\nfunction computeSelAfterChange(doc, change) {\n  var out = [];\n  for (var i = 0; i < doc.sel.ranges.length; i++) {\n    var range = doc.sel.ranges[i];\n    out.push(new Range(adjustForChange(range.anchor, change),\n                       adjustForChange(range.head, change)));\n  }\n  return normalizeSelection(out, doc.sel.primIndex)\n}\n\nfunction offsetPos(pos, old, nw) {\n  if (pos.line == old.line)\n    { return Pos(nw.line, pos.ch - old.ch + nw.ch) }\n  else\n    { return Pos(nw.line + (pos.line - old.line), pos.ch) }\n}\n\n// Used by replaceSelections to allow moving the selection to the\n// start or around the replaced test. Hint may be \"start\" or \"around\".\nfunction computeReplacedSel(doc, changes, hint) {\n  var out = [];\n  var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;\n  for (var i = 0; i < changes.length; i++) {\n    var change = changes[i];\n    var from = offsetPos(change.from, oldPrev, newPrev);\n    var to = offsetPos(changeEnd(change), oldPrev, newPrev);\n    oldPrev = change.to;\n    newPrev = to;\n    if (hint == \"around\") {\n      var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;\n      out[i] = new Range(inv ? to : from, inv ? from : to);\n    } else {\n      out[i] = new Range(from, from);\n    }\n  }\n  return new Selection(out, doc.sel.primIndex)\n}\n\n// Used to get the editor into a consistent state again when options change.\n\nfunction loadMode(cm) {\n  cm.doc.mode = getMode(cm.options, cm.doc.modeOption);\n  resetModeState(cm);\n}\n\nfunction resetModeState(cm) {\n  cm.doc.iter(function (line) {\n    if (line.stateAfter) { line.stateAfter = null; }\n    if (line.styles) { line.styles = null; }\n  });\n  cm.doc.frontier = cm.doc.first;\n  startWorker(cm, 100);\n  cm.state.modeGen++;\n  if (cm.curOp) { regChange(cm); }\n}\n\n// DOCUMENT DATA STRUCTURE\n\n// By default, updates that start and end at the beginning of a line\n// are treated specially, in order to make the association of line\n// widgets and marker elements with the text behave more intuitive.\nfunction isWholeLineUpdate(doc, change) {\n  return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == \"\" &&\n    (!doc.cm || doc.cm.options.wholeLineUpdateBefore)\n}\n\n// Perform a change on the document data structure.\nfunction updateDoc(doc, change, markedSpans, estimateHeight$$1) {\n  function spansFor(n) {return markedSpans ? markedSpans[n] : null}\n  function update(line, text, spans) {\n    updateLine(line, text, spans, estimateHeight$$1);\n    signalLater(line, \"change\", line, change);\n  }\n  function linesFor(start, end) {\n    var result = [];\n    for (var i = start; i < end; ++i)\n      { result.push(new Line(text[i], spansFor(i), estimateHeight$$1)); }\n    return result\n  }\n\n  var from = change.from, to = change.to, text = change.text;\n  var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);\n  var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;\n\n  // Adjust the line structure\n  if (change.full) {\n    doc.insert(0, linesFor(0, text.length));\n    doc.remove(text.length, doc.size - text.length);\n  } else if (isWholeLineUpdate(doc, change)) {\n    // This is a whole-line replace. Treated specially to make\n    // sure line objects move the way they are supposed to.\n    var added = linesFor(0, text.length - 1);\n    update(lastLine, lastLine.text, lastSpans);\n    if (nlines) { doc.remove(from.line, nlines); }\n    if (added.length) { doc.insert(from.line, added); }\n  } else if (firstLine == lastLine) {\n    if (text.length == 1) {\n      update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);\n    } else {\n      var added$1 = linesFor(1, text.length - 1);\n      added$1.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight$$1));\n      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n      doc.insert(from.line + 1, added$1);\n    }\n  } else if (text.length == 1) {\n    update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));\n    doc.remove(from.line + 1, nlines);\n  } else {\n    update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));\n    update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);\n    var added$2 = linesFor(1, text.length - 1);\n    if (nlines > 1) { doc.remove(from.line + 1, nlines - 1); }\n    doc.insert(from.line + 1, added$2);\n  }\n\n  signalLater(doc, \"change\", doc, change);\n}\n\n// Call f for all linked documents.\nfunction linkedDocs(doc, f, sharedHistOnly) {\n  function propagate(doc, skip, sharedHist) {\n    if (doc.linked) { for (var i = 0; i < doc.linked.length; ++i) {\n      var rel = doc.linked[i];\n      if (rel.doc == skip) { continue }\n      var shared = sharedHist && rel.sharedHist;\n      if (sharedHistOnly && !shared) { continue }\n      f(rel.doc, shared);\n      propagate(rel.doc, doc, shared);\n    } }\n  }\n  propagate(doc, null, true);\n}\n\n// Attach a document to an editor.\nfunction attachDoc(cm, doc) {\n  if (doc.cm) { throw new Error(\"This document is already in use.\") }\n  cm.doc = doc;\n  doc.cm = cm;\n  estimateLineHeights(cm);\n  loadMode(cm);\n  setDirectionClass(cm);\n  if (!cm.options.lineWrapping) { findMaxLine(cm); }\n  cm.options.mode = doc.modeOption;\n  regChange(cm);\n}\n\nfunction setDirectionClass(cm) {\n  (cm.doc.direction == \"rtl\" ? addClass : rmClass)(cm.display.lineDiv, \"CodeMirror-rtl\");\n}\n\nfunction directionChanged(cm) {\n  runInOp(cm, function () {\n    setDirectionClass(cm);\n    regChange(cm);\n  });\n}\n\nfunction History(startGen) {\n  // Arrays of change events and selections. Doing something adds an\n  // event to done and clears undo. Undoing moves events from done\n  // to undone, redoing moves them in the other direction.\n  this.done = []; this.undone = [];\n  this.undoDepth = Infinity;\n  // Used to track when changes can be merged into a single undo\n  // event\n  this.lastModTime = this.lastSelTime = 0;\n  this.lastOp = this.lastSelOp = null;\n  this.lastOrigin = this.lastSelOrigin = null;\n  // Used by the isClean() method\n  this.generation = this.maxGeneration = startGen || 1;\n}\n\n// Create a history change event from an updateDoc-style change\n// object.\nfunction historyChangeFromChange(doc, change) {\n  var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};\n  attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);\n  linkedDocs(doc, function (doc) { return attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1); }, true);\n  return histChange\n}\n\n// Pop all selection events off the end of a history array. Stop at\n// a change event.\nfunction clearSelectionEvents(array) {\n  while (array.length) {\n    var last = lst(array);\n    if (last.ranges) { array.pop(); }\n    else { break }\n  }\n}\n\n// Find the top change event in the history. Pop off selection\n// events that are in the way.\nfunction lastChangeEvent(hist, force) {\n  if (force) {\n    clearSelectionEvents(hist.done);\n    return lst(hist.done)\n  } else if (hist.done.length && !lst(hist.done).ranges) {\n    return lst(hist.done)\n  } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {\n    hist.done.pop();\n    return lst(hist.done)\n  }\n}\n\n// Register a change in the history. Merges changes that are within\n// a single operation, or are close together with an origin that\n// allows merging (starting with \"+\") into a single event.\nfunction addChangeToHistory(doc, change, selAfter, opId) {\n  var hist = doc.history;\n  hist.undone.length = 0;\n  var time = +new Date, cur;\n  var last;\n\n  if ((hist.lastOp == opId ||\n       hist.lastOrigin == change.origin && change.origin &&\n       ((change.origin.charAt(0) == \"+\" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||\n        change.origin.charAt(0) == \"*\")) &&\n      (cur = lastChangeEvent(hist, hist.lastOp == opId))) {\n    // Merge this change into the last event\n    last = lst(cur.changes);\n    if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {\n      // Optimized case for simple insertion -- don't want to add\n      // new changesets for every character typed\n      last.to = changeEnd(change);\n    } else {\n      // Add new sub-event\n      cur.changes.push(historyChangeFromChange(doc, change));\n    }\n  } else {\n    // Can not be merged, start a new event.\n    var before = lst(hist.done);\n    if (!before || !before.ranges)\n      { pushSelectionToHistory(doc.sel, hist.done); }\n    cur = {changes: [historyChangeFromChange(doc, change)],\n           generation: hist.generation};\n    hist.done.push(cur);\n    while (hist.done.length > hist.undoDepth) {\n      hist.done.shift();\n      if (!hist.done[0].ranges) { hist.done.shift(); }\n    }\n  }\n  hist.done.push(selAfter);\n  hist.generation = ++hist.maxGeneration;\n  hist.lastModTime = hist.lastSelTime = time;\n  hist.lastOp = hist.lastSelOp = opId;\n  hist.lastOrigin = hist.lastSelOrigin = change.origin;\n\n  if (!last) { signal(doc, \"historyAdded\"); }\n}\n\nfunction selectionEventCanBeMerged(doc, origin, prev, sel) {\n  var ch = origin.charAt(0);\n  return ch == \"*\" ||\n    ch == \"+\" &&\n    prev.ranges.length == sel.ranges.length &&\n    prev.somethingSelected() == sel.somethingSelected() &&\n    new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500)\n}\n\n// Called whenever the selection changes, sets the new selection as\n// the pending selection in the history, and pushes the old pending\n// selection into the 'done' array when it was significantly\n// different (in number of selected ranges, emptiness, or time).\nfunction addSelectionToHistory(doc, sel, opId, options) {\n  var hist = doc.history, origin = options && options.origin;\n\n  // A new event is started when the previous origin does not match\n  // the current, or the origins don't allow matching. Origins\n  // starting with * are always merged, those starting with + are\n  // merged when similar and close together in time.\n  if (opId == hist.lastSelOp ||\n      (origin && hist.lastSelOrigin == origin &&\n       (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||\n        selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))\n    { hist.done[hist.done.length - 1] = sel; }\n  else\n    { pushSelectionToHistory(sel, hist.done); }\n\n  hist.lastSelTime = +new Date;\n  hist.lastSelOrigin = origin;\n  hist.lastSelOp = opId;\n  if (options && options.clearRedo !== false)\n    { clearSelectionEvents(hist.undone); }\n}\n\nfunction pushSelectionToHistory(sel, dest) {\n  var top = lst(dest);\n  if (!(top && top.ranges && top.equals(sel)))\n    { dest.push(sel); }\n}\n\n// Used to store marked span information in the history.\nfunction attachLocalSpans(doc, change, from, to) {\n  var existing = change[\"spans_\" + doc.id], n = 0;\n  doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function (line) {\n    if (line.markedSpans)\n      { (existing || (existing = change[\"spans_\" + doc.id] = {}))[n] = line.markedSpans; }\n    ++n;\n  });\n}\n\n// When un/re-doing restores text containing marked spans, those\n// that have been explicitly cleared should not be restored.\nfunction removeClearedSpans(spans) {\n  if (!spans) { return null }\n  var out;\n  for (var i = 0; i < spans.length; ++i) {\n    if (spans[i].marker.explicitlyCleared) { if (!out) { out = spans.slice(0, i); } }\n    else if (out) { out.push(spans[i]); }\n  }\n  return !out ? spans : out.length ? out : null\n}\n\n// Retrieve and filter the old marked spans stored in a change event.\nfunction getOldSpans(doc, change) {\n  var found = change[\"spans_\" + doc.id];\n  if (!found) { return null }\n  var nw = [];\n  for (var i = 0; i < change.text.length; ++i)\n    { nw.push(removeClearedSpans(found[i])); }\n  return nw\n}\n\n// Used for un/re-doing changes from the history. Combines the\n// result of computing the existing spans with the set of spans that\n// existed in the history (so that deleting around a span and then\n// undoing brings back the span).\nfunction mergeOldSpans(doc, change) {\n  var old = getOldSpans(doc, change);\n  var stretched = stretchSpansOverChange(doc, change);\n  if (!old) { return stretched }\n  if (!stretched) { return old }\n\n  for (var i = 0; i < old.length; ++i) {\n    var oldCur = old[i], stretchCur = stretched[i];\n    if (oldCur && stretchCur) {\n      spans: for (var j = 0; j < stretchCur.length; ++j) {\n        var span = stretchCur[j];\n        for (var k = 0; k < oldCur.length; ++k)\n          { if (oldCur[k].marker == span.marker) { continue spans } }\n        oldCur.push(span);\n      }\n    } else if (stretchCur) {\n      old[i] = stretchCur;\n    }\n  }\n  return old\n}\n\n// Used both to provide a JSON-safe object in .getHistory, and, when\n// detaching a document, to split the history in two\nfunction copyHistoryArray(events, newGroup, instantiateSel) {\n  var copy = [];\n  for (var i = 0; i < events.length; ++i) {\n    var event = events[i];\n    if (event.ranges) {\n      copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);\n      continue\n    }\n    var changes = event.changes, newChanges = [];\n    copy.push({changes: newChanges});\n    for (var j = 0; j < changes.length; ++j) {\n      var change = changes[j], m = (void 0);\n      newChanges.push({from: change.from, to: change.to, text: change.text});\n      if (newGroup) { for (var prop in change) { if (m = prop.match(/^spans_(\\d+)$/)) {\n        if (indexOf(newGroup, Number(m[1])) > -1) {\n          lst(newChanges)[prop] = change[prop];\n          delete change[prop];\n        }\n      } } }\n    }\n  }\n  return copy\n}\n\n// The 'scroll' parameter given to many of these indicated whether\n// the new cursor position should be scrolled into view after\n// modifying the selection.\n\n// If shift is held or the extend flag is set, extends a range to\n// include a given position (and optionally a second position).\n// Otherwise, simply returns the range between the given positions.\n// Used for cursor motion and such.\nfunction extendRange(doc, range, head, other) {\n  if (doc.cm && doc.cm.display.shift || doc.extend) {\n    var anchor = range.anchor;\n    if (other) {\n      var posBefore = cmp(head, anchor) < 0;\n      if (posBefore != (cmp(other, anchor) < 0)) {\n        anchor = head;\n        head = other;\n      } else if (posBefore != (cmp(head, other) < 0)) {\n        head = other;\n      }\n    }\n    return new Range(anchor, head)\n  } else {\n    return new Range(other || head, head)\n  }\n}\n\n// Extend the primary selection range, discard the rest.\nfunction extendSelection(doc, head, other, options) {\n  setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);\n}\n\n// Extend all selections (pos is an array of selections with length\n// equal the number of selections)\nfunction extendSelections(doc, heads, options) {\n  var out = [];\n  for (var i = 0; i < doc.sel.ranges.length; i++)\n    { out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null); }\n  var newSel = normalizeSelection(out, doc.sel.primIndex);\n  setSelection(doc, newSel, options);\n}\n\n// Updates a single range in the selection.\nfunction replaceOneSelection(doc, i, range, options) {\n  var ranges = doc.sel.ranges.slice(0);\n  ranges[i] = range;\n  setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);\n}\n\n// Reset the selection to a single range.\nfunction setSimpleSelection(doc, anchor, head, options) {\n  setSelection(doc, simpleSelection(anchor, head), options);\n}\n\n// Give beforeSelectionChange handlers a change to influence a\n// selection update.\nfunction filterSelectionChange(doc, sel, options) {\n  var obj = {\n    ranges: sel.ranges,\n    update: function(ranges) {\n      var this$1 = this;\n\n      this.ranges = [];\n      for (var i = 0; i < ranges.length; i++)\n        { this$1.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),\n                                   clipPos(doc, ranges[i].head)); }\n    },\n    origin: options && options.origin\n  };\n  signal(doc, \"beforeSelectionChange\", doc, obj);\n  if (doc.cm) { signal(doc.cm, \"beforeSelectionChange\", doc.cm, obj); }\n  if (obj.ranges != sel.ranges) { return normalizeSelection(obj.ranges, obj.ranges.length - 1) }\n  else { return sel }\n}\n\nfunction setSelectionReplaceHistory(doc, sel, options) {\n  var done = doc.history.done, last = lst(done);\n  if (last && last.ranges) {\n    done[done.length - 1] = sel;\n    setSelectionNoUndo(doc, sel, options);\n  } else {\n    setSelection(doc, sel, options);\n  }\n}\n\n// Set a new selection.\nfunction setSelection(doc, sel, options) {\n  setSelectionNoUndo(doc, sel, options);\n  addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);\n}\n\nfunction setSelectionNoUndo(doc, sel, options) {\n  if (hasHandler(doc, \"beforeSelectionChange\") || doc.cm && hasHandler(doc.cm, \"beforeSelectionChange\"))\n    { sel = filterSelectionChange(doc, sel, options); }\n\n  var bias = options && options.bias ||\n    (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);\n  setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));\n\n  if (!(options && options.scroll === false) && doc.cm)\n    { ensureCursorVisible(doc.cm); }\n}\n\nfunction setSelectionInner(doc, sel) {\n  if (sel.equals(doc.sel)) { return }\n\n  doc.sel = sel;\n\n  if (doc.cm) {\n    doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;\n    signalCursorActivity(doc.cm);\n  }\n  signalLater(doc, \"cursorActivity\", doc);\n}\n\n// Verify that the selection does not partially select any atomic\n// marked ranges.\nfunction reCheckSelection(doc) {\n  setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false));\n}\n\n// Return a selection that does not partially select any atomic\n// ranges.\nfunction skipAtomicInSelection(doc, sel, bias, mayClear) {\n  var out;\n  for (var i = 0; i < sel.ranges.length; i++) {\n    var range = sel.ranges[i];\n    var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];\n    var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);\n    var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);\n    if (out || newAnchor != range.anchor || newHead != range.head) {\n      if (!out) { out = sel.ranges.slice(0, i); }\n      out[i] = new Range(newAnchor, newHead);\n    }\n  }\n  return out ? normalizeSelection(out, sel.primIndex) : sel\n}\n\nfunction skipAtomicInner(doc, pos, oldPos, dir, mayClear) {\n  var line = getLine(doc, pos.line);\n  if (line.markedSpans) { for (var i = 0; i < line.markedSpans.length; ++i) {\n    var sp = line.markedSpans[i], m = sp.marker;\n    if ((sp.from == null || (m.inclusiveLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&\n        (sp.to == null || (m.inclusiveRight ? sp.to >= pos.ch : sp.to > pos.ch))) {\n      if (mayClear) {\n        signal(m, \"beforeCursorEnter\");\n        if (m.explicitlyCleared) {\n          if (!line.markedSpans) { break }\n          else {--i; continue}\n        }\n      }\n      if (!m.atomic) { continue }\n\n      if (oldPos) {\n        var near = m.find(dir < 0 ? 1 : -1), diff = (void 0);\n        if (dir < 0 ? m.inclusiveRight : m.inclusiveLeft)\n          { near = movePos(doc, near, -dir, near && near.line == pos.line ? line : null); }\n        if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))\n          { return skipAtomicInner(doc, near, pos, dir, mayClear) }\n      }\n\n      var far = m.find(dir < 0 ? -1 : 1);\n      if (dir < 0 ? m.inclusiveLeft : m.inclusiveRight)\n        { far = movePos(doc, far, dir, far.line == pos.line ? line : null); }\n      return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null\n    }\n  } }\n  return pos\n}\n\n// Ensure a given position is not inside an atomic range.\nfunction skipAtomic(doc, pos, oldPos, bias, mayClear) {\n  var dir = bias || 1;\n  var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||\n      (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||\n      skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||\n      (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));\n  if (!found) {\n    doc.cantEdit = true;\n    return Pos(doc.first, 0)\n  }\n  return found\n}\n\nfunction movePos(doc, pos, dir, line) {\n  if (dir < 0 && pos.ch == 0) {\n    if (pos.line > doc.first) { return clipPos(doc, Pos(pos.line - 1)) }\n    else { return null }\n  } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {\n    if (pos.line < doc.first + doc.size - 1) { return Pos(pos.line + 1, 0) }\n    else { return null }\n  } else {\n    return new Pos(pos.line, pos.ch + dir)\n  }\n}\n\nfunction selectAll(cm) {\n  cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);\n}\n\n// UPDATING\n\n// Allow \"beforeChange\" event handlers to influence a change\nfunction filterChange(doc, change, update) {\n  var obj = {\n    canceled: false,\n    from: change.from,\n    to: change.to,\n    text: change.text,\n    origin: change.origin,\n    cancel: function () { return obj.canceled = true; }\n  };\n  if (update) { obj.update = function (from, to, text, origin) {\n    if (from) { obj.from = clipPos(doc, from); }\n    if (to) { obj.to = clipPos(doc, to); }\n    if (text) { obj.text = text; }\n    if (origin !== undefined) { obj.origin = origin; }\n  }; }\n  signal(doc, \"beforeChange\", doc, obj);\n  if (doc.cm) { signal(doc.cm, \"beforeChange\", doc.cm, obj); }\n\n  if (obj.canceled) { return null }\n  return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin}\n}\n\n// Apply a change to a document, and add it to the document's\n// history, and propagating it to all linked documents.\nfunction makeChange(doc, change, ignoreReadOnly) {\n  if (doc.cm) {\n    if (!doc.cm.curOp) { return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly) }\n    if (doc.cm.state.suppressEdits) { return }\n  }\n\n  if (hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\")) {\n    change = filterChange(doc, change, true);\n    if (!change) { return }\n  }\n\n  // Possibly split or suppress the update based on the presence\n  // of read-only spans in its range.\n  var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);\n  if (split) {\n    for (var i = split.length - 1; i >= 0; --i)\n      { makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [\"\"] : change.text}); }\n  } else {\n    makeChangeInner(doc, change);\n  }\n}\n\nfunction makeChangeInner(doc, change) {\n  if (change.text.length == 1 && change.text[0] == \"\" && cmp(change.from, change.to) == 0) { return }\n  var selAfter = computeSelAfterChange(doc, change);\n  addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);\n\n  makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));\n  var rebased = [];\n\n  linkedDocs(doc, function (doc, sharedHist) {\n    if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n      rebaseHist(doc.history, change);\n      rebased.push(doc.history);\n    }\n    makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));\n  });\n}\n\n// Revert a change stored in a document's history.\nfunction makeChangeFromHistory(doc, type, allowSelectionOnly) {\n  if (doc.cm && doc.cm.state.suppressEdits && !allowSelectionOnly) { return }\n\n  var hist = doc.history, event, selAfter = doc.sel;\n  var source = type == \"undo\" ? hist.done : hist.undone, dest = type == \"undo\" ? hist.undone : hist.done;\n\n  // Verify that there is a useable event (so that ctrl-z won't\n  // needlessly clear selection events)\n  var i = 0;\n  for (; i < source.length; i++) {\n    event = source[i];\n    if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)\n      { break }\n  }\n  if (i == source.length) { return }\n  hist.lastOrigin = hist.lastSelOrigin = null;\n\n  for (;;) {\n    event = source.pop();\n    if (event.ranges) {\n      pushSelectionToHistory(event, dest);\n      if (allowSelectionOnly && !event.equals(doc.sel)) {\n        setSelection(doc, event, {clearRedo: false});\n        return\n      }\n      selAfter = event;\n    }\n    else { break }\n  }\n\n  // Build up a reverse change object to add to the opposite history\n  // stack (redo when undoing, and vice versa).\n  var antiChanges = [];\n  pushSelectionToHistory(selAfter, dest);\n  dest.push({changes: antiChanges, generation: hist.generation});\n  hist.generation = event.generation || ++hist.maxGeneration;\n\n  var filter = hasHandler(doc, \"beforeChange\") || doc.cm && hasHandler(doc.cm, \"beforeChange\");\n\n  var loop = function ( i ) {\n    var change = event.changes[i];\n    change.origin = type;\n    if (filter && !filterChange(doc, change, false)) {\n      source.length = 0;\n      return {}\n    }\n\n    antiChanges.push(historyChangeFromChange(doc, change));\n\n    var after = i ? computeSelAfterChange(doc, change) : lst(source);\n    makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));\n    if (!i && doc.cm) { doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)}); }\n    var rebased = [];\n\n    // Propagate to the linked documents\n    linkedDocs(doc, function (doc, sharedHist) {\n      if (!sharedHist && indexOf(rebased, doc.history) == -1) {\n        rebaseHist(doc.history, change);\n        rebased.push(doc.history);\n      }\n      makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));\n    });\n  };\n\n  for (var i$1 = event.changes.length - 1; i$1 >= 0; --i$1) {\n    var returned = loop( i$1 );\n\n    if ( returned ) return returned.v;\n  }\n}\n\n// Sub-views need their line numbers shifted when text is added\n// above or below them in the parent document.\nfunction shiftDoc(doc, distance) {\n  if (distance == 0) { return }\n  doc.first += distance;\n  doc.sel = new Selection(map(doc.sel.ranges, function (range) { return new Range(\n    Pos(range.anchor.line + distance, range.anchor.ch),\n    Pos(range.head.line + distance, range.head.ch)\n  ); }), doc.sel.primIndex);\n  if (doc.cm) {\n    regChange(doc.cm, doc.first, doc.first - distance, distance);\n    for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)\n      { regLineChange(doc.cm, l, \"gutter\"); }\n  }\n}\n\n// More lower-level change function, handling only a single document\n// (not linked ones).\nfunction makeChangeSingleDoc(doc, change, selAfter, spans) {\n  if (doc.cm && !doc.cm.curOp)\n    { return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans) }\n\n  if (change.to.line < doc.first) {\n    shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));\n    return\n  }\n  if (change.from.line > doc.lastLine()) { return }\n\n  // Clip the change to the size of this doc\n  if (change.from.line < doc.first) {\n    var shift = change.text.length - 1 - (doc.first - change.from.line);\n    shiftDoc(doc, shift);\n    change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),\n              text: [lst(change.text)], origin: change.origin};\n  }\n  var last = doc.lastLine();\n  if (change.to.line > last) {\n    change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),\n              text: [change.text[0]], origin: change.origin};\n  }\n\n  change.removed = getBetween(doc, change.from, change.to);\n\n  if (!selAfter) { selAfter = computeSelAfterChange(doc, change); }\n  if (doc.cm) { makeChangeSingleDocInEditor(doc.cm, change, spans); }\n  else { updateDoc(doc, change, spans); }\n  setSelectionNoUndo(doc, selAfter, sel_dontScroll);\n}\n\n// Handle the interaction of a change to a document with the editor\n// that this document is part of.\nfunction makeChangeSingleDocInEditor(cm, change, spans) {\n  var doc = cm.doc, display = cm.display, from = change.from, to = change.to;\n\n  var recomputeMaxLength = false, checkWidthStart = from.line;\n  if (!cm.options.lineWrapping) {\n    checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));\n    doc.iter(checkWidthStart, to.line + 1, function (line) {\n      if (line == display.maxLine) {\n        recomputeMaxLength = true;\n        return true\n      }\n    });\n  }\n\n  if (doc.sel.contains(change.from, change.to) > -1)\n    { signalCursorActivity(cm); }\n\n  updateDoc(doc, change, spans, estimateHeight(cm));\n\n  if (!cm.options.lineWrapping) {\n    doc.iter(checkWidthStart, from.line + change.text.length, function (line) {\n      var len = lineLength(line);\n      if (len > display.maxLineLength) {\n        display.maxLine = line;\n        display.maxLineLength = len;\n        display.maxLineChanged = true;\n        recomputeMaxLength = false;\n      }\n    });\n    if (recomputeMaxLength) { cm.curOp.updateMaxLine = true; }\n  }\n\n  // Adjust frontier, schedule worker\n  doc.frontier = Math.min(doc.frontier, from.line);\n  startWorker(cm, 400);\n\n  var lendiff = change.text.length - (to.line - from.line) - 1;\n  // Remember that these lines changed, for updating the display\n  if (change.full)\n    { regChange(cm); }\n  else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))\n    { regLineChange(cm, from.line, \"text\"); }\n  else\n    { regChange(cm, from.line, to.line + 1, lendiff); }\n\n  var changesHandler = hasHandler(cm, \"changes\"), changeHandler = hasHandler(cm, \"change\");\n  if (changeHandler || changesHandler) {\n    var obj = {\n      from: from, to: to,\n      text: change.text,\n      removed: change.removed,\n      origin: change.origin\n    };\n    if (changeHandler) { signalLater(cm, \"change\", cm, obj); }\n    if (changesHandler) { (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj); }\n  }\n  cm.display.selForContextMenu = null;\n}\n\nfunction replaceRange(doc, code, from, to, origin) {\n  if (!to) { to = from; }\n  if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }\n  if (typeof code == \"string\") { code = doc.splitLines(code); }\n  makeChange(doc, {from: from, to: to, text: code, origin: origin});\n}\n\n// Rebasing/resetting history to deal with externally-sourced changes\n\nfunction rebaseHistSelSingle(pos, from, to, diff) {\n  if (to < pos.line) {\n    pos.line += diff;\n  } else if (from < pos.line) {\n    pos.line = from;\n    pos.ch = 0;\n  }\n}\n\n// Tries to rebase an array of history events given a change in the\n// document. If the change touches the same lines as the event, the\n// event, and everything 'behind' it, is discarded. If the change is\n// before the event, the event's positions are updated. Uses a\n// copy-on-write scheme for the positions, to avoid having to\n// reallocate them all on every rebase, but also avoid problems with\n// shared position objects being unsafely updated.\nfunction rebaseHistArray(array, from, to, diff) {\n  for (var i = 0; i < array.length; ++i) {\n    var sub = array[i], ok = true;\n    if (sub.ranges) {\n      if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }\n      for (var j = 0; j < sub.ranges.length; j++) {\n        rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);\n        rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);\n      }\n      continue\n    }\n    for (var j$1 = 0; j$1 < sub.changes.length; ++j$1) {\n      var cur = sub.changes[j$1];\n      if (to < cur.from.line) {\n        cur.from = Pos(cur.from.line + diff, cur.from.ch);\n        cur.to = Pos(cur.to.line + diff, cur.to.ch);\n      } else if (from <= cur.to.line) {\n        ok = false;\n        break\n      }\n    }\n    if (!ok) {\n      array.splice(0, i + 1);\n      i = 0;\n    }\n  }\n}\n\nfunction rebaseHist(hist, change) {\n  var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;\n  rebaseHistArray(hist.done, from, to, diff);\n  rebaseHistArray(hist.undone, from, to, diff);\n}\n\n// Utility for applying a change to a line by handle or number,\n// returning the number and optionally registering the line as\n// changed.\nfunction changeLine(doc, handle, changeType, op) {\n  var no = handle, line = handle;\n  if (typeof handle == \"number\") { line = getLine(doc, clipLine(doc, handle)); }\n  else { no = lineNo(handle); }\n  if (no == null) { return null }\n  if (op(line, no) && doc.cm) { regLineChange(doc.cm, no, changeType); }\n  return line\n}\n\n// The document is represented as a BTree consisting of leaves, with\n// chunk of lines in them, and branches, with up to ten leaves or\n// other branch nodes below them. The top node is always a branch\n// node, and is the document object itself (meaning it has\n// additional methods and properties).\n//\n// All nodes have parent links. The tree is used both to go from\n// line numbers to line objects, and to go from objects to numbers.\n// It also indexes by height, and is used to convert between height\n// and line object, and to find the total height of the document.\n//\n// See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html\n\nvar LeafChunk = function(lines) {\n  var this$1 = this;\n\n  this.lines = lines;\n  this.parent = null;\n  var height = 0;\n  for (var i = 0; i < lines.length; ++i) {\n    lines[i].parent = this$1;\n    height += lines[i].height;\n  }\n  this.height = height;\n};\n\nLeafChunk.prototype.chunkSize = function () { return this.lines.length };\n\n// Remove the n lines at offset 'at'.\nLeafChunk.prototype.removeInner = function (at, n) {\n    var this$1 = this;\n\n  for (var i = at, e = at + n; i < e; ++i) {\n    var line = this$1.lines[i];\n    this$1.height -= line.height;\n    cleanUpLine(line);\n    signalLater(line, \"delete\");\n  }\n  this.lines.splice(at, n);\n};\n\n// Helper used to collapse a small branch into a single leaf.\nLeafChunk.prototype.collapse = function (lines) {\n  lines.push.apply(lines, this.lines);\n};\n\n// Insert the given array of lines at offset 'at', count them as\n// having the given height.\nLeafChunk.prototype.insertInner = function (at, lines, height) {\n    var this$1 = this;\n\n  this.height += height;\n  this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));\n  for (var i = 0; i < lines.length; ++i) { lines[i].parent = this$1; }\n};\n\n// Used to iterate over a part of the tree.\nLeafChunk.prototype.iterN = function (at, n, op) {\n    var this$1 = this;\n\n  for (var e = at + n; at < e; ++at)\n    { if (op(this$1.lines[at])) { return true } }\n};\n\nvar BranchChunk = function(children) {\n  var this$1 = this;\n\n  this.children = children;\n  var size = 0, height = 0;\n  for (var i = 0; i < children.length; ++i) {\n    var ch = children[i];\n    size += ch.chunkSize(); height += ch.height;\n    ch.parent = this$1;\n  }\n  this.size = size;\n  this.height = height;\n  this.parent = null;\n};\n\nBranchChunk.prototype.chunkSize = function () { return this.size };\n\nBranchChunk.prototype.removeInner = function (at, n) {\n    var this$1 = this;\n\n  this.size -= n;\n  for (var i = 0; i < this.children.length; ++i) {\n    var child = this$1.children[i], sz = child.chunkSize();\n    if (at < sz) {\n      var rm = Math.min(n, sz - at), oldHeight = child.height;\n      child.removeInner(at, rm);\n      this$1.height -= oldHeight - child.height;\n      if (sz == rm) { this$1.children.splice(i--, 1); child.parent = null; }\n      if ((n -= rm) == 0) { break }\n      at = 0;\n    } else { at -= sz; }\n  }\n  // If the result is smaller than 25 lines, ensure that it is a\n  // single leaf node.\n  if (this.size - n < 25 &&\n      (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {\n    var lines = [];\n    this.collapse(lines);\n    this.children = [new LeafChunk(lines)];\n    this.children[0].parent = this;\n  }\n};\n\nBranchChunk.prototype.collapse = function (lines) {\n    var this$1 = this;\n\n  for (var i = 0; i < this.children.length; ++i) { this$1.children[i].collapse(lines); }\n};\n\nBranchChunk.prototype.insertInner = function (at, lines, height) {\n    var this$1 = this;\n\n  this.size += lines.length;\n  this.height += height;\n  for (var i = 0; i < this.children.length; ++i) {\n    var child = this$1.children[i], sz = child.chunkSize();\n    if (at <= sz) {\n      child.insertInner(at, lines, height);\n      if (child.lines && child.lines.length > 50) {\n        // To avoid memory thrashing when child.lines is huge (e.g. first view of a large file), it's never spliced.\n        // Instead, small slices are taken. They're taken in order because sequential memory accesses are fastest.\n        var remaining = child.lines.length % 25 + 25;\n        for (var pos = remaining; pos < child.lines.length;) {\n          var leaf = new LeafChunk(child.lines.slice(pos, pos += 25));\n          child.height -= leaf.height;\n          this$1.children.splice(++i, 0, leaf);\n          leaf.parent = this$1;\n        }\n        child.lines = child.lines.slice(0, remaining);\n        this$1.maybeSpill();\n      }\n      break\n    }\n    at -= sz;\n  }\n};\n\n// When a node has grown, check whether it should be split.\nBranchChunk.prototype.maybeSpill = function () {\n  if (this.children.length <= 10) { return }\n  var me = this;\n  do {\n    var spilled = me.children.splice(me.children.length - 5, 5);\n    var sibling = new BranchChunk(spilled);\n    if (!me.parent) { // Become the parent node\n      var copy = new BranchChunk(me.children);\n      copy.parent = me;\n      me.children = [copy, sibling];\n      me = copy;\n   } else {\n      me.size -= sibling.size;\n      me.height -= sibling.height;\n      var myIndex = indexOf(me.parent.children, me);\n      me.parent.children.splice(myIndex + 1, 0, sibling);\n    }\n    sibling.parent = me.parent;\n  } while (me.children.length > 10)\n  me.parent.maybeSpill();\n};\n\nBranchChunk.prototype.iterN = function (at, n, op) {\n    var this$1 = this;\n\n  for (var i = 0; i < this.children.length; ++i) {\n    var child = this$1.children[i], sz = child.chunkSize();\n    if (at < sz) {\n      var used = Math.min(n, sz - at);\n      if (child.iterN(at, used, op)) { return true }\n      if ((n -= used) == 0) { break }\n      at = 0;\n    } else { at -= sz; }\n  }\n};\n\n// Line widgets are block elements displayed above or below a line.\n\nvar LineWidget = function(doc, node, options) {\n  var this$1 = this;\n\n  if (options) { for (var opt in options) { if (options.hasOwnProperty(opt))\n    { this$1[opt] = options[opt]; } } }\n  this.doc = doc;\n  this.node = node;\n};\n\nLineWidget.prototype.clear = function () {\n    var this$1 = this;\n\n  var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);\n  if (no == null || !ws) { return }\n  for (var i = 0; i < ws.length; ++i) { if (ws[i] == this$1) { ws.splice(i--, 1); } }\n  if (!ws.length) { line.widgets = null; }\n  var height = widgetHeight(this);\n  updateLineHeight(line, Math.max(0, line.height - height));\n  if (cm) {\n    runInOp(cm, function () {\n      adjustScrollWhenAboveVisible(cm, line, -height);\n      regLineChange(cm, no, \"widget\");\n    });\n    signalLater(cm, \"lineWidgetCleared\", cm, this, no);\n  }\n};\n\nLineWidget.prototype.changed = function () {\n    var this$1 = this;\n\n  var oldH = this.height, cm = this.doc.cm, line = this.line;\n  this.height = null;\n  var diff = widgetHeight(this) - oldH;\n  if (!diff) { return }\n  updateLineHeight(line, line.height + diff);\n  if (cm) {\n    runInOp(cm, function () {\n      cm.curOp.forceUpdate = true;\n      adjustScrollWhenAboveVisible(cm, line, diff);\n      signalLater(cm, \"lineWidgetChanged\", cm, this$1, lineNo(line));\n    });\n  }\n};\neventMixin(LineWidget);\n\nfunction adjustScrollWhenAboveVisible(cm, line, diff) {\n  if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))\n    { addToScrollTop(cm, diff); }\n}\n\nfunction addLineWidget(doc, handle, node, options) {\n  var widget = new LineWidget(doc, node, options);\n  var cm = doc.cm;\n  if (cm && widget.noHScroll) { cm.display.alignWidgets = true; }\n  changeLine(doc, handle, \"widget\", function (line) {\n    var widgets = line.widgets || (line.widgets = []);\n    if (widget.insertAt == null) { widgets.push(widget); }\n    else { widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget); }\n    widget.line = line;\n    if (cm && !lineIsHidden(doc, line)) {\n      var aboveVisible = heightAtLine(line) < doc.scrollTop;\n      updateLineHeight(line, line.height + widgetHeight(widget));\n      if (aboveVisible) { addToScrollTop(cm, widget.height); }\n      cm.curOp.forceUpdate = true;\n    }\n    return true\n  });\n  signalLater(cm, \"lineWidgetAdded\", cm, widget, typeof handle == \"number\" ? handle : lineNo(handle));\n  return widget\n}\n\n// TEXTMARKERS\n\n// Created with markText and setBookmark methods. A TextMarker is a\n// handle that can be used to clear or find a marked position in the\n// document. Line objects hold arrays (markedSpans) containing\n// {from, to, marker} object pointing to such marker objects, and\n// indicating that such a marker is present on that line. Multiple\n// lines may point to the same marker when it spans across lines.\n// The spans will have null for their from/to properties when the\n// marker continues beyond the start/end of the line. Markers have\n// links back to the lines they currently touch.\n\n// Collapsed markers have unique ids, in order to be able to order\n// them, which is needed for uniquely determining an outer marker\n// when they overlap (they may nest, but not partially overlap).\nvar nextMarkerId = 0;\n\nvar TextMarker = function(doc, type) {\n  this.lines = [];\n  this.type = type;\n  this.doc = doc;\n  this.id = ++nextMarkerId;\n};\n\n// Clear the marker.\nTextMarker.prototype.clear = function () {\n    var this$1 = this;\n\n  if (this.explicitlyCleared) { return }\n  var cm = this.doc.cm, withOp = cm && !cm.curOp;\n  if (withOp) { startOperation(cm); }\n  if (hasHandler(this, \"clear\")) {\n    var found = this.find();\n    if (found) { signalLater(this, \"clear\", found.from, found.to); }\n  }\n  var min = null, max = null;\n  for (var i = 0; i < this.lines.length; ++i) {\n    var line = this$1.lines[i];\n    var span = getMarkedSpanFor(line.markedSpans, this$1);\n    if (cm && !this$1.collapsed) { regLineChange(cm, lineNo(line), \"text\"); }\n    else if (cm) {\n      if (span.to != null) { max = lineNo(line); }\n      if (span.from != null) { min = lineNo(line); }\n    }\n    line.markedSpans = removeMarkedSpan(line.markedSpans, span);\n    if (span.from == null && this$1.collapsed && !lineIsHidden(this$1.doc, line) && cm)\n      { updateLineHeight(line, textHeight(cm.display)); }\n  }\n  if (cm && this.collapsed && !cm.options.lineWrapping) { for (var i$1 = 0; i$1 < this.lines.length; ++i$1) {\n    var visual = visualLine(this$1.lines[i$1]), len = lineLength(visual);\n    if (len > cm.display.maxLineLength) {\n      cm.display.maxLine = visual;\n      cm.display.maxLineLength = len;\n      cm.display.maxLineChanged = true;\n    }\n  } }\n\n  if (min != null && cm && this.collapsed) { regChange(cm, min, max + 1); }\n  this.lines.length = 0;\n  this.explicitlyCleared = true;\n  if (this.atomic && this.doc.cantEdit) {\n    this.doc.cantEdit = false;\n    if (cm) { reCheckSelection(cm.doc); }\n  }\n  if (cm) { signalLater(cm, \"markerCleared\", cm, this, min, max); }\n  if (withOp) { endOperation(cm); }\n  if (this.parent) { this.parent.clear(); }\n};\n\n// Find the position of the marker in the document. Returns a {from,\n// to} object by default. Side can be passed to get a specific side\n// -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the\n// Pos objects returned contain a line object, rather than a line\n// number (used to prevent looking up the same line twice).\nTextMarker.prototype.find = function (side, lineObj) {\n    var this$1 = this;\n\n  if (side == null && this.type == \"bookmark\") { side = 1; }\n  var from, to;\n  for (var i = 0; i < this.lines.length; ++i) {\n    var line = this$1.lines[i];\n    var span = getMarkedSpanFor(line.markedSpans, this$1);\n    if (span.from != null) {\n      from = Pos(lineObj ? line : lineNo(line), span.from);\n      if (side == -1) { return from }\n    }\n    if (span.to != null) {\n      to = Pos(lineObj ? line : lineNo(line), span.to);\n      if (side == 1) { return to }\n    }\n  }\n  return from && {from: from, to: to}\n};\n\n// Signals that the marker's widget changed, and surrounding layout\n// should be recomputed.\nTextMarker.prototype.changed = function () {\n    var this$1 = this;\n\n  var pos = this.find(-1, true), widget = this, cm = this.doc.cm;\n  if (!pos || !cm) { return }\n  runInOp(cm, function () {\n    var line = pos.line, lineN = lineNo(pos.line);\n    var view = findViewForLine(cm, lineN);\n    if (view) {\n      clearLineMeasurementCacheFor(view);\n      cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;\n    }\n    cm.curOp.updateMaxLine = true;\n    if (!lineIsHidden(widget.doc, line) && widget.height != null) {\n      var oldHeight = widget.height;\n      widget.height = null;\n      var dHeight = widgetHeight(widget) - oldHeight;\n      if (dHeight)\n        { updateLineHeight(line, line.height + dHeight); }\n    }\n    signalLater(cm, \"markerChanged\", cm, this$1);\n  });\n};\n\nTextMarker.prototype.attachLine = function (line) {\n  if (!this.lines.length && this.doc.cm) {\n    var op = this.doc.cm.curOp;\n    if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)\n      { (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this); }\n  }\n  this.lines.push(line);\n};\n\nTextMarker.prototype.detachLine = function (line) {\n  this.lines.splice(indexOf(this.lines, line), 1);\n  if (!this.lines.length && this.doc.cm) {\n    var op = this.doc.cm.curOp;(op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);\n  }\n};\neventMixin(TextMarker);\n\n// Create a marker, wire it up to the right lines, and\nfunction markText(doc, from, to, options, type) {\n  // Shared markers (across linked documents) are handled separately\n  // (markTextShared will call out to this again, once per\n  // document).\n  if (options && options.shared) { return markTextShared(doc, from, to, options, type) }\n  // Ensure we are in an operation.\n  if (doc.cm && !doc.cm.curOp) { return operation(doc.cm, markText)(doc, from, to, options, type) }\n\n  var marker = new TextMarker(doc, type), diff = cmp(from, to);\n  if (options) { copyObj(options, marker, false); }\n  // Don't connect empty markers unless clearWhenEmpty is false\n  if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)\n    { return marker }\n  if (marker.replacedWith) {\n    // Showing up as a widget implies collapsed (widget replaces text)\n    marker.collapsed = true;\n    marker.widgetNode = eltP(\"span\", [marker.replacedWith], \"CodeMirror-widget\");\n    if (!options.handleMouseEvents) { marker.widgetNode.setAttribute(\"cm-ignore-events\", \"true\"); }\n    if (options.insertLeft) { marker.widgetNode.insertLeft = true; }\n  }\n  if (marker.collapsed) {\n    if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||\n        from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))\n      { throw new Error(\"Inserting collapsed marker partially overlapping an existing one\") }\n    seeCollapsedSpans();\n  }\n\n  if (marker.addToHistory)\n    { addChangeToHistory(doc, {from: from, to: to, origin: \"markText\"}, doc.sel, NaN); }\n\n  var curLine = from.line, cm = doc.cm, updateMaxLine;\n  doc.iter(curLine, to.line + 1, function (line) {\n    if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)\n      { updateMaxLine = true; }\n    if (marker.collapsed && curLine != from.line) { updateLineHeight(line, 0); }\n    addMarkedSpan(line, new MarkedSpan(marker,\n                                       curLine == from.line ? from.ch : null,\n                                       curLine == to.line ? to.ch : null));\n    ++curLine;\n  });\n  // lineIsHidden depends on the presence of the spans, so needs a second pass\n  if (marker.collapsed) { doc.iter(from.line, to.line + 1, function (line) {\n    if (lineIsHidden(doc, line)) { updateLineHeight(line, 0); }\n  }); }\n\n  if (marker.clearOnEnter) { on(marker, \"beforeCursorEnter\", function () { return marker.clear(); }); }\n\n  if (marker.readOnly) {\n    seeReadOnlySpans();\n    if (doc.history.done.length || doc.history.undone.length)\n      { doc.clearHistory(); }\n  }\n  if (marker.collapsed) {\n    marker.id = ++nextMarkerId;\n    marker.atomic = true;\n  }\n  if (cm) {\n    // Sync editor state\n    if (updateMaxLine) { cm.curOp.updateMaxLine = true; }\n    if (marker.collapsed)\n      { regChange(cm, from.line, to.line + 1); }\n    else if (marker.className || marker.title || marker.startStyle || marker.endStyle || marker.css)\n      { for (var i = from.line; i <= to.line; i++) { regLineChange(cm, i, \"text\"); } }\n    if (marker.atomic) { reCheckSelection(cm.doc); }\n    signalLater(cm, \"markerAdded\", cm, marker);\n  }\n  return marker\n}\n\n// SHARED TEXTMARKERS\n\n// A shared marker spans multiple linked documents. It is\n// implemented as a meta-marker-object controlling multiple normal\n// markers.\nvar SharedTextMarker = function(markers, primary) {\n  var this$1 = this;\n\n  this.markers = markers;\n  this.primary = primary;\n  for (var i = 0; i < markers.length; ++i)\n    { markers[i].parent = this$1; }\n};\n\nSharedTextMarker.prototype.clear = function () {\n    var this$1 = this;\n\n  if (this.explicitlyCleared) { return }\n  this.explicitlyCleared = true;\n  for (var i = 0; i < this.markers.length; ++i)\n    { this$1.markers[i].clear(); }\n  signalLater(this, \"clear\");\n};\n\nSharedTextMarker.prototype.find = function (side, lineObj) {\n  return this.primary.find(side, lineObj)\n};\neventMixin(SharedTextMarker);\n\nfunction markTextShared(doc, from, to, options, type) {\n  options = copyObj(options);\n  options.shared = false;\n  var markers = [markText(doc, from, to, options, type)], primary = markers[0];\n  var widget = options.widgetNode;\n  linkedDocs(doc, function (doc) {\n    if (widget) { options.widgetNode = widget.cloneNode(true); }\n    markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));\n    for (var i = 0; i < doc.linked.length; ++i)\n      { if (doc.linked[i].isParent) { return } }\n    primary = lst(markers);\n  });\n  return new SharedTextMarker(markers, primary)\n}\n\nfunction findSharedMarkers(doc) {\n  return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())), function (m) { return m.parent; })\n}\n\nfunction copySharedMarkers(doc, markers) {\n  for (var i = 0; i < markers.length; i++) {\n    var marker = markers[i], pos = marker.find();\n    var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);\n    if (cmp(mFrom, mTo)) {\n      var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);\n      marker.markers.push(subMark);\n      subMark.parent = marker;\n    }\n  }\n}\n\nfunction detachSharedMarkers(markers) {\n  var loop = function ( i ) {\n    var marker = markers[i], linked = [marker.primary.doc];\n    linkedDocs(marker.primary.doc, function (d) { return linked.push(d); });\n    for (var j = 0; j < marker.markers.length; j++) {\n      var subMarker = marker.markers[j];\n      if (indexOf(linked, subMarker.doc) == -1) {\n        subMarker.parent = null;\n        marker.markers.splice(j--, 1);\n      }\n    }\n  };\n\n  for (var i = 0; i < markers.length; i++) loop( i );\n}\n\nvar nextDocId = 0;\nvar Doc = function(text, mode, firstLine, lineSep, direction) {\n  if (!(this instanceof Doc)) { return new Doc(text, mode, firstLine, lineSep, direction) }\n  if (firstLine == null) { firstLine = 0; }\n\n  BranchChunk.call(this, [new LeafChunk([new Line(\"\", null)])]);\n  this.first = firstLine;\n  this.scrollTop = this.scrollLeft = 0;\n  this.cantEdit = false;\n  this.cleanGeneration = 1;\n  this.frontier = firstLine;\n  var start = Pos(firstLine, 0);\n  this.sel = simpleSelection(start);\n  this.history = new History(null);\n  this.id = ++nextDocId;\n  this.modeOption = mode;\n  this.lineSep = lineSep;\n  this.direction = (direction == \"rtl\") ? \"rtl\" : \"ltr\";\n  this.extend = false;\n\n  if (typeof text == \"string\") { text = this.splitLines(text); }\n  updateDoc(this, {from: start, to: start, text: text});\n  setSelection(this, simpleSelection(start), sel_dontScroll);\n};\n\nDoc.prototype = createObj(BranchChunk.prototype, {\n  constructor: Doc,\n  // Iterate over the document. Supports two forms -- with only one\n  // argument, it calls that for each line in the document. With\n  // three, it iterates over the range given by the first two (with\n  // the second being non-inclusive).\n  iter: function(from, to, op) {\n    if (op) { this.iterN(from - this.first, to - from, op); }\n    else { this.iterN(this.first, this.first + this.size, from); }\n  },\n\n  // Non-public interface for adding and removing lines.\n  insert: function(at, lines) {\n    var height = 0;\n    for (var i = 0; i < lines.length; ++i) { height += lines[i].height; }\n    this.insertInner(at - this.first, lines, height);\n  },\n  remove: function(at, n) { this.removeInner(at - this.first, n); },\n\n  // From here, the methods are part of the public interface. Most\n  // are also available from CodeMirror (editor) instances.\n\n  getValue: function(lineSep) {\n    var lines = getLines(this, this.first, this.first + this.size);\n    if (lineSep === false) { return lines }\n    return lines.join(lineSep || this.lineSeparator())\n  },\n  setValue: docMethodOp(function(code) {\n    var top = Pos(this.first, 0), last = this.first + this.size - 1;\n    makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),\n                      text: this.splitLines(code), origin: \"setValue\", full: true}, true);\n    if (this.cm) { scrollToCoords(this.cm, 0, 0); }\n    setSelection(this, simpleSelection(top), sel_dontScroll);\n  }),\n  replaceRange: function(code, from, to, origin) {\n    from = clipPos(this, from);\n    to = to ? clipPos(this, to) : from;\n    replaceRange(this, code, from, to, origin);\n  },\n  getRange: function(from, to, lineSep) {\n    var lines = getBetween(this, clipPos(this, from), clipPos(this, to));\n    if (lineSep === false) { return lines }\n    return lines.join(lineSep || this.lineSeparator())\n  },\n\n  getLine: function(line) {var l = this.getLineHandle(line); return l && l.text},\n\n  getLineHandle: function(line) {if (isLine(this, line)) { return getLine(this, line) }},\n  getLineNumber: function(line) {return lineNo(line)},\n\n  getLineHandleVisualStart: function(line) {\n    if (typeof line == \"number\") { line = getLine(this, line); }\n    return visualLine(line)\n  },\n\n  lineCount: function() {return this.size},\n  firstLine: function() {return this.first},\n  lastLine: function() {return this.first + this.size - 1},\n\n  clipPos: function(pos) {return clipPos(this, pos)},\n\n  getCursor: function(start) {\n    var range$$1 = this.sel.primary(), pos;\n    if (start == null || start == \"head\") { pos = range$$1.head; }\n    else if (start == \"anchor\") { pos = range$$1.anchor; }\n    else if (start == \"end\" || start == \"to\" || start === false) { pos = range$$1.to(); }\n    else { pos = range$$1.from(); }\n    return pos\n  },\n  listSelections: function() { return this.sel.ranges },\n  somethingSelected: function() {return this.sel.somethingSelected()},\n\n  setCursor: docMethodOp(function(line, ch, options) {\n    setSimpleSelection(this, clipPos(this, typeof line == \"number\" ? Pos(line, ch || 0) : line), null, options);\n  }),\n  setSelection: docMethodOp(function(anchor, head, options) {\n    setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);\n  }),\n  extendSelection: docMethodOp(function(head, other, options) {\n    extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);\n  }),\n  extendSelections: docMethodOp(function(heads, options) {\n    extendSelections(this, clipPosArray(this, heads), options);\n  }),\n  extendSelectionsBy: docMethodOp(function(f, options) {\n    var heads = map(this.sel.ranges, f);\n    extendSelections(this, clipPosArray(this, heads), options);\n  }),\n  setSelections: docMethodOp(function(ranges, primary, options) {\n    var this$1 = this;\n\n    if (!ranges.length) { return }\n    var out = [];\n    for (var i = 0; i < ranges.length; i++)\n      { out[i] = new Range(clipPos(this$1, ranges[i].anchor),\n                         clipPos(this$1, ranges[i].head)); }\n    if (primary == null) { primary = Math.min(ranges.length - 1, this.sel.primIndex); }\n    setSelection(this, normalizeSelection(out, primary), options);\n  }),\n  addSelection: docMethodOp(function(anchor, head, options) {\n    var ranges = this.sel.ranges.slice(0);\n    ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));\n    setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);\n  }),\n\n  getSelection: function(lineSep) {\n    var this$1 = this;\n\n    var ranges = this.sel.ranges, lines;\n    for (var i = 0; i < ranges.length; i++) {\n      var sel = getBetween(this$1, ranges[i].from(), ranges[i].to());\n      lines = lines ? lines.concat(sel) : sel;\n    }\n    if (lineSep === false) { return lines }\n    else { return lines.join(lineSep || this.lineSeparator()) }\n  },\n  getSelections: function(lineSep) {\n    var this$1 = this;\n\n    var parts = [], ranges = this.sel.ranges;\n    for (var i = 0; i < ranges.length; i++) {\n      var sel = getBetween(this$1, ranges[i].from(), ranges[i].to());\n      if (lineSep !== false) { sel = sel.join(lineSep || this$1.lineSeparator()); }\n      parts[i] = sel;\n    }\n    return parts\n  },\n  replaceSelection: function(code, collapse, origin) {\n    var dup = [];\n    for (var i = 0; i < this.sel.ranges.length; i++)\n      { dup[i] = code; }\n    this.replaceSelections(dup, collapse, origin || \"+input\");\n  },\n  replaceSelections: docMethodOp(function(code, collapse, origin) {\n    var this$1 = this;\n\n    var changes = [], sel = this.sel;\n    for (var i = 0; i < sel.ranges.length; i++) {\n      var range$$1 = sel.ranges[i];\n      changes[i] = {from: range$$1.from(), to: range$$1.to(), text: this$1.splitLines(code[i]), origin: origin};\n    }\n    var newSel = collapse && collapse != \"end\" && computeReplacedSel(this, changes, collapse);\n    for (var i$1 = changes.length - 1; i$1 >= 0; i$1--)\n      { makeChange(this$1, changes[i$1]); }\n    if (newSel) { setSelectionReplaceHistory(this, newSel); }\n    else if (this.cm) { ensureCursorVisible(this.cm); }\n  }),\n  undo: docMethodOp(function() {makeChangeFromHistory(this, \"undo\");}),\n  redo: docMethodOp(function() {makeChangeFromHistory(this, \"redo\");}),\n  undoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"undo\", true);}),\n  redoSelection: docMethodOp(function() {makeChangeFromHistory(this, \"redo\", true);}),\n\n  setExtending: function(val) {this.extend = val;},\n  getExtending: function() {return this.extend},\n\n  historySize: function() {\n    var hist = this.history, done = 0, undone = 0;\n    for (var i = 0; i < hist.done.length; i++) { if (!hist.done[i].ranges) { ++done; } }\n    for (var i$1 = 0; i$1 < hist.undone.length; i$1++) { if (!hist.undone[i$1].ranges) { ++undone; } }\n    return {undo: done, redo: undone}\n  },\n  clearHistory: function() {this.history = new History(this.history.maxGeneration);},\n\n  markClean: function() {\n    this.cleanGeneration = this.changeGeneration(true);\n  },\n  changeGeneration: function(forceSplit) {\n    if (forceSplit)\n      { this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null; }\n    return this.history.generation\n  },\n  isClean: function (gen) {\n    return this.history.generation == (gen || this.cleanGeneration)\n  },\n\n  getHistory: function() {\n    return {done: copyHistoryArray(this.history.done),\n            undone: copyHistoryArray(this.history.undone)}\n  },\n  setHistory: function(histData) {\n    var hist = this.history = new History(this.history.maxGeneration);\n    hist.done = copyHistoryArray(histData.done.slice(0), null, true);\n    hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);\n  },\n\n  setGutterMarker: docMethodOp(function(line, gutterID, value) {\n    return changeLine(this, line, \"gutter\", function (line) {\n      var markers = line.gutterMarkers || (line.gutterMarkers = {});\n      markers[gutterID] = value;\n      if (!value && isEmpty(markers)) { line.gutterMarkers = null; }\n      return true\n    })\n  }),\n\n  clearGutter: docMethodOp(function(gutterID) {\n    var this$1 = this;\n\n    this.iter(function (line) {\n      if (line.gutterMarkers && line.gutterMarkers[gutterID]) {\n        changeLine(this$1, line, \"gutter\", function () {\n          line.gutterMarkers[gutterID] = null;\n          if (isEmpty(line.gutterMarkers)) { line.gutterMarkers = null; }\n          return true\n        });\n      }\n    });\n  }),\n\n  lineInfo: function(line) {\n    var n;\n    if (typeof line == \"number\") {\n      if (!isLine(this, line)) { return null }\n      n = line;\n      line = getLine(this, line);\n      if (!line) { return null }\n    } else {\n      n = lineNo(line);\n      if (n == null) { return null }\n    }\n    return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,\n            textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,\n            widgets: line.widgets}\n  },\n\n  addLineClass: docMethodOp(function(handle, where, cls) {\n    return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function (line) {\n      var prop = where == \"text\" ? \"textClass\"\n               : where == \"background\" ? \"bgClass\"\n               : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n      if (!line[prop]) { line[prop] = cls; }\n      else if (classTest(cls).test(line[prop])) { return false }\n      else { line[prop] += \" \" + cls; }\n      return true\n    })\n  }),\n  removeLineClass: docMethodOp(function(handle, where, cls) {\n    return changeLine(this, handle, where == \"gutter\" ? \"gutter\" : \"class\", function (line) {\n      var prop = where == \"text\" ? \"textClass\"\n               : where == \"background\" ? \"bgClass\"\n               : where == \"gutter\" ? \"gutterClass\" : \"wrapClass\";\n      var cur = line[prop];\n      if (!cur) { return false }\n      else if (cls == null) { line[prop] = null; }\n      else {\n        var found = cur.match(classTest(cls));\n        if (!found) { return false }\n        var end = found.index + found[0].length;\n        line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? \"\" : \" \") + cur.slice(end) || null;\n      }\n      return true\n    })\n  }),\n\n  addLineWidget: docMethodOp(function(handle, node, options) {\n    return addLineWidget(this, handle, node, options)\n  }),\n  removeLineWidget: function(widget) { widget.clear(); },\n\n  markText: function(from, to, options) {\n    return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || \"range\")\n  },\n  setBookmark: function(pos, options) {\n    var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),\n                    insertLeft: options && options.insertLeft,\n                    clearWhenEmpty: false, shared: options && options.shared,\n                    handleMouseEvents: options && options.handleMouseEvents};\n    pos = clipPos(this, pos);\n    return markText(this, pos, pos, realOpts, \"bookmark\")\n  },\n  findMarksAt: function(pos) {\n    pos = clipPos(this, pos);\n    var markers = [], spans = getLine(this, pos.line).markedSpans;\n    if (spans) { for (var i = 0; i < spans.length; ++i) {\n      var span = spans[i];\n      if ((span.from == null || span.from <= pos.ch) &&\n          (span.to == null || span.to >= pos.ch))\n        { markers.push(span.marker.parent || span.marker); }\n    } }\n    return markers\n  },\n  findMarks: function(from, to, filter) {\n    from = clipPos(this, from); to = clipPos(this, to);\n    var found = [], lineNo$$1 = from.line;\n    this.iter(from.line, to.line + 1, function (line) {\n      var spans = line.markedSpans;\n      if (spans) { for (var i = 0; i < spans.length; i++) {\n        var span = spans[i];\n        if (!(span.to != null && lineNo$$1 == from.line && from.ch >= span.to ||\n              span.from == null && lineNo$$1 != from.line ||\n              span.from != null && lineNo$$1 == to.line && span.from >= to.ch) &&\n            (!filter || filter(span.marker)))\n          { found.push(span.marker.parent || span.marker); }\n      } }\n      ++lineNo$$1;\n    });\n    return found\n  },\n  getAllMarks: function() {\n    var markers = [];\n    this.iter(function (line) {\n      var sps = line.markedSpans;\n      if (sps) { for (var i = 0; i < sps.length; ++i)\n        { if (sps[i].from != null) { markers.push(sps[i].marker); } } }\n    });\n    return markers\n  },\n\n  posFromIndex: function(off) {\n    var ch, lineNo$$1 = this.first, sepSize = this.lineSeparator().length;\n    this.iter(function (line) {\n      var sz = line.text.length + sepSize;\n      if (sz > off) { ch = off; return true }\n      off -= sz;\n      ++lineNo$$1;\n    });\n    return clipPos(this, Pos(lineNo$$1, ch))\n  },\n  indexFromPos: function (coords) {\n    coords = clipPos(this, coords);\n    var index = coords.ch;\n    if (coords.line < this.first || coords.ch < 0) { return 0 }\n    var sepSize = this.lineSeparator().length;\n    this.iter(this.first, coords.line, function (line) { // iter aborts when callback returns a truthy value\n      index += line.text.length + sepSize;\n    });\n    return index\n  },\n\n  copy: function(copyHistory) {\n    var doc = new Doc(getLines(this, this.first, this.first + this.size),\n                      this.modeOption, this.first, this.lineSep, this.direction);\n    doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;\n    doc.sel = this.sel;\n    doc.extend = false;\n    if (copyHistory) {\n      doc.history.undoDepth = this.history.undoDepth;\n      doc.setHistory(this.getHistory());\n    }\n    return doc\n  },\n\n  linkedDoc: function(options) {\n    if (!options) { options = {}; }\n    var from = this.first, to = this.first + this.size;\n    if (options.from != null && options.from > from) { from = options.from; }\n    if (options.to != null && options.to < to) { to = options.to; }\n    var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep, this.direction);\n    if (options.sharedHist) { copy.history = this.history\n    ; }(this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});\n    copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];\n    copySharedMarkers(copy, findSharedMarkers(this));\n    return copy\n  },\n  unlinkDoc: function(other) {\n    var this$1 = this;\n\n    if (other instanceof CodeMirror$1) { other = other.doc; }\n    if (this.linked) { for (var i = 0; i < this.linked.length; ++i) {\n      var link = this$1.linked[i];\n      if (link.doc != other) { continue }\n      this$1.linked.splice(i, 1);\n      other.unlinkDoc(this$1);\n      detachSharedMarkers(findSharedMarkers(this$1));\n      break\n    } }\n    // If the histories were shared, split them again\n    if (other.history == this.history) {\n      var splitIds = [other.id];\n      linkedDocs(other, function (doc) { return splitIds.push(doc.id); }, true);\n      other.history = new History(null);\n      other.history.done = copyHistoryArray(this.history.done, splitIds);\n      other.history.undone = copyHistoryArray(this.history.undone, splitIds);\n    }\n  },\n  iterLinkedDocs: function(f) {linkedDocs(this, f);},\n\n  getMode: function() {return this.mode},\n  getEditor: function() {return this.cm},\n\n  splitLines: function(str) {\n    if (this.lineSep) { return str.split(this.lineSep) }\n    return splitLinesAuto(str)\n  },\n  lineSeparator: function() { return this.lineSep || \"\\n\" },\n\n  setDirection: docMethodOp(function (dir) {\n    if (dir != \"rtl\") { dir = \"ltr\"; }\n    if (dir == this.direction) { return }\n    this.direction = dir;\n    this.iter(function (line) { return line.order = null; });\n    if (this.cm) { directionChanged(this.cm); }\n  })\n});\n\n// Public alias.\nDoc.prototype.eachLine = Doc.prototype.iter;\n\n// Kludge to work around strange IE behavior where it'll sometimes\n// re-fire a series of drag-related events right after the drop (#1551)\nvar lastDrop = 0;\n\nfunction onDrop(e) {\n  var cm = this;\n  clearDragCursor(cm);\n  if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))\n    { return }\n  e_preventDefault(e);\n  if (ie) { lastDrop = +new Date; }\n  var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;\n  if (!pos || cm.isReadOnly()) { return }\n  // Might be a file drop, in which case we simply extract the text\n  // and insert it.\n  if (files && files.length && window.FileReader && window.File) {\n    var n = files.length, text = Array(n), read = 0;\n    var loadFile = function (file, i) {\n      if (cm.options.allowDropFileTypes &&\n          indexOf(cm.options.allowDropFileTypes, file.type) == -1)\n        { return }\n\n      var reader = new FileReader;\n      reader.onload = operation(cm, function () {\n        var content = reader.result;\n        if (/[\\x00-\\x08\\x0e-\\x1f]{2}/.test(content)) { content = \"\"; }\n        text[i] = content;\n        if (++read == n) {\n          pos = clipPos(cm.doc, pos);\n          var change = {from: pos, to: pos,\n                        text: cm.doc.splitLines(text.join(cm.doc.lineSeparator())),\n                        origin: \"paste\"};\n          makeChange(cm.doc, change);\n          setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));\n        }\n      });\n      reader.readAsText(file);\n    };\n    for (var i = 0; i < n; ++i) { loadFile(files[i], i); }\n  } else { // Normal drop\n    // Don't do a replace if the drop happened inside of the selected text.\n    if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {\n      cm.state.draggingText(e);\n      // Ensure the editor is re-focused\n      setTimeout(function () { return cm.display.input.focus(); }, 20);\n      return\n    }\n    try {\n      var text$1 = e.dataTransfer.getData(\"Text\");\n      if (text$1) {\n        var selected;\n        if (cm.state.draggingText && !cm.state.draggingText.copy)\n          { selected = cm.listSelections(); }\n        setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));\n        if (selected) { for (var i$1 = 0; i$1 < selected.length; ++i$1)\n          { replaceRange(cm.doc, \"\", selected[i$1].anchor, selected[i$1].head, \"drag\"); } }\n        cm.replaceSelection(text$1, \"around\", \"paste\");\n        cm.display.input.focus();\n      }\n    }\n    catch(e){}\n  }\n}\n\nfunction onDragStart(cm, e) {\n  if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return }\n  if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) { return }\n\n  e.dataTransfer.setData(\"Text\", cm.getSelection());\n  e.dataTransfer.effectAllowed = \"copyMove\";\n\n  // Use dummy image instead of default browsers image.\n  // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.\n  if (e.dataTransfer.setDragImage && !safari) {\n    var img = elt(\"img\", null, null, \"position: fixed; left: 0; top: 0;\");\n    img.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n    if (presto) {\n      img.width = img.height = 1;\n      cm.display.wrapper.appendChild(img);\n      // Force a relayout, or Opera won't use our image for some obscure reason\n      img._top = img.offsetTop;\n    }\n    e.dataTransfer.setDragImage(img, 0, 0);\n    if (presto) { img.parentNode.removeChild(img); }\n  }\n}\n\nfunction onDragOver(cm, e) {\n  var pos = posFromMouse(cm, e);\n  if (!pos) { return }\n  var frag = document.createDocumentFragment();\n  drawSelectionCursor(cm, pos, frag);\n  if (!cm.display.dragCursor) {\n    cm.display.dragCursor = elt(\"div\", null, \"CodeMirror-cursors CodeMirror-dragcursors\");\n    cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);\n  }\n  removeChildrenAndAdd(cm.display.dragCursor, frag);\n}\n\nfunction clearDragCursor(cm) {\n  if (cm.display.dragCursor) {\n    cm.display.lineSpace.removeChild(cm.display.dragCursor);\n    cm.display.dragCursor = null;\n  }\n}\n\n// These must be handled carefully, because naively registering a\n// handler for each editor will cause the editors to never be\n// garbage collected.\n\nfunction forEachCodeMirror(f) {\n  if (!document.body.getElementsByClassName) { return }\n  var byClass = document.body.getElementsByClassName(\"CodeMirror\");\n  for (var i = 0; i < byClass.length; i++) {\n    var cm = byClass[i].CodeMirror;\n    if (cm) { f(cm); }\n  }\n}\n\nvar globalsRegistered = false;\nfunction ensureGlobalHandlers() {\n  if (globalsRegistered) { return }\n  registerGlobalHandlers();\n  globalsRegistered = true;\n}\nfunction registerGlobalHandlers() {\n  // When the window resizes, we need to refresh active editors.\n  var resizeTimer;\n  on(window, \"resize\", function () {\n    if (resizeTimer == null) { resizeTimer = setTimeout(function () {\n      resizeTimer = null;\n      forEachCodeMirror(onResize);\n    }, 100); }\n  });\n  // When the window loses focus, we want to show the editor as blurred\n  on(window, \"blur\", function () { return forEachCodeMirror(onBlur); });\n}\n// Called when the window resizes\nfunction onResize(cm) {\n  var d = cm.display;\n  if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)\n    { return }\n  // Might be a text scaling operation, clear size caches.\n  d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;\n  d.scrollbarsClipped = false;\n  cm.setSize();\n}\n\nvar keyNames = {\n  3: \"Enter\", 8: \"Backspace\", 9: \"Tab\", 13: \"Enter\", 16: \"Shift\", 17: \"Ctrl\", 18: \"Alt\",\n  19: \"Pause\", 20: \"CapsLock\", 27: \"Esc\", 32: \"Space\", 33: \"PageUp\", 34: \"PageDown\", 35: \"End\",\n  36: \"Home\", 37: \"Left\", 38: \"Up\", 39: \"Right\", 40: \"Down\", 44: \"PrintScrn\", 45: \"Insert\",\n  46: \"Delete\", 59: \";\", 61: \"=\", 91: \"Mod\", 92: \"Mod\", 93: \"Mod\",\n  106: \"*\", 107: \"=\", 109: \"-\", 110: \".\", 111: \"/\", 127: \"Delete\",\n  173: \"-\", 186: \";\", 187: \"=\", 188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\",\n  221: \"]\", 222: \"'\", 63232: \"Up\", 63233: \"Down\", 63234: \"Left\", 63235: \"Right\", 63272: \"Delete\",\n  63273: \"Home\", 63275: \"End\", 63276: \"PageUp\", 63277: \"PageDown\", 63302: \"Insert\"\n};\n\n// Number keys\nfor (var i = 0; i < 10; i++) { keyNames[i + 48] = keyNames[i + 96] = String(i); }\n// Alphabetic keys\nfor (var i$1 = 65; i$1 <= 90; i$1++) { keyNames[i$1] = String.fromCharCode(i$1); }\n// Function keys\nfor (var i$2 = 1; i$2 <= 12; i$2++) { keyNames[i$2 + 111] = keyNames[i$2 + 63235] = \"F\" + i$2; }\n\nvar keyMap = {};\n\nkeyMap.basic = {\n  \"Left\": \"goCharLeft\", \"Right\": \"goCharRight\", \"Up\": \"goLineUp\", \"Down\": \"goLineDown\",\n  \"End\": \"goLineEnd\", \"Home\": \"goLineStartSmart\", \"PageUp\": \"goPageUp\", \"PageDown\": \"goPageDown\",\n  \"Delete\": \"delCharAfter\", \"Backspace\": \"delCharBefore\", \"Shift-Backspace\": \"delCharBefore\",\n  \"Tab\": \"defaultTab\", \"Shift-Tab\": \"indentAuto\",\n  \"Enter\": \"newlineAndIndent\", \"Insert\": \"toggleOverwrite\",\n  \"Esc\": \"singleSelection\"\n};\n// Note that the save and find-related commands aren't defined by\n// default. User code or addons can define them. Unknown commands\n// are simply ignored.\nkeyMap.pcDefault = {\n  \"Ctrl-A\": \"selectAll\", \"Ctrl-D\": \"deleteLine\", \"Ctrl-Z\": \"undo\", \"Shift-Ctrl-Z\": \"redo\", \"Ctrl-Y\": \"redo\",\n  \"Ctrl-Home\": \"goDocStart\", \"Ctrl-End\": \"goDocEnd\", \"Ctrl-Up\": \"goLineUp\", \"Ctrl-Down\": \"goLineDown\",\n  \"Ctrl-Left\": \"goGroupLeft\", \"Ctrl-Right\": \"goGroupRight\", \"Alt-Left\": \"goLineStart\", \"Alt-Right\": \"goLineEnd\",\n  \"Ctrl-Backspace\": \"delGroupBefore\", \"Ctrl-Delete\": \"delGroupAfter\", \"Ctrl-S\": \"save\", \"Ctrl-F\": \"find\",\n  \"Ctrl-G\": \"findNext\", \"Shift-Ctrl-G\": \"findPrev\", \"Shift-Ctrl-F\": \"replace\", \"Shift-Ctrl-R\": \"replaceAll\",\n  \"Ctrl-[\": \"indentLess\", \"Ctrl-]\": \"indentMore\",\n  \"Ctrl-U\": \"undoSelection\", \"Shift-Ctrl-U\": \"redoSelection\", \"Alt-U\": \"redoSelection\",\n  fallthrough: \"basic\"\n};\n// Very basic readline/emacs-style bindings, which are standard on Mac.\nkeyMap.emacsy = {\n  \"Ctrl-F\": \"goCharRight\", \"Ctrl-B\": \"goCharLeft\", \"Ctrl-P\": \"goLineUp\", \"Ctrl-N\": \"goLineDown\",\n  \"Alt-F\": \"goWordRight\", \"Alt-B\": \"goWordLeft\", \"Ctrl-A\": \"goLineStart\", \"Ctrl-E\": \"goLineEnd\",\n  \"Ctrl-V\": \"goPageDown\", \"Shift-Ctrl-V\": \"goPageUp\", \"Ctrl-D\": \"delCharAfter\", \"Ctrl-H\": \"delCharBefore\",\n  \"Alt-D\": \"delWordAfter\", \"Alt-Backspace\": \"delWordBefore\", \"Ctrl-K\": \"killLine\", \"Ctrl-T\": \"transposeChars\",\n  \"Ctrl-O\": \"openLine\"\n};\nkeyMap.macDefault = {\n  \"Cmd-A\": \"selectAll\", \"Cmd-D\": \"deleteLine\", \"Cmd-Z\": \"undo\", \"Shift-Cmd-Z\": \"redo\", \"Cmd-Y\": \"redo\",\n  \"Cmd-Home\": \"goDocStart\", \"Cmd-Up\": \"goDocStart\", \"Cmd-End\": \"goDocEnd\", \"Cmd-Down\": \"goDocEnd\", \"Alt-Left\": \"goGroupLeft\",\n  \"Alt-Right\": \"goGroupRight\", \"Cmd-Left\": \"goLineLeft\", \"Cmd-Right\": \"goLineRight\", \"Alt-Backspace\": \"delGroupBefore\",\n  \"Ctrl-Alt-Backspace\": \"delGroupAfter\", \"Alt-Delete\": \"delGroupAfter\", \"Cmd-S\": \"save\", \"Cmd-F\": \"find\",\n  \"Cmd-G\": \"findNext\", \"Shift-Cmd-G\": \"findPrev\", \"Cmd-Alt-F\": \"replace\", \"Shift-Cmd-Alt-F\": \"replaceAll\",\n  \"Cmd-[\": \"indentLess\", \"Cmd-]\": \"indentMore\", \"Cmd-Backspace\": \"delWrappedLineLeft\", \"Cmd-Delete\": \"delWrappedLineRight\",\n  \"Cmd-U\": \"undoSelection\", \"Shift-Cmd-U\": \"redoSelection\", \"Ctrl-Up\": \"goDocStart\", \"Ctrl-Down\": \"goDocEnd\",\n  fallthrough: [\"basic\", \"emacsy\"]\n};\nkeyMap[\"default\"] = mac ? keyMap.macDefault : keyMap.pcDefault;\n\n// KEYMAP DISPATCH\n\nfunction normalizeKeyName(name) {\n  var parts = name.split(/-(?!$)/);\n  name = parts[parts.length - 1];\n  var alt, ctrl, shift, cmd;\n  for (var i = 0; i < parts.length - 1; i++) {\n    var mod = parts[i];\n    if (/^(cmd|meta|m)$/i.test(mod)) { cmd = true; }\n    else if (/^a(lt)?$/i.test(mod)) { alt = true; }\n    else if (/^(c|ctrl|control)$/i.test(mod)) { ctrl = true; }\n    else if (/^s(hift)?$/i.test(mod)) { shift = true; }\n    else { throw new Error(\"Unrecognized modifier name: \" + mod) }\n  }\n  if (alt) { name = \"Alt-\" + name; }\n  if (ctrl) { name = \"Ctrl-\" + name; }\n  if (cmd) { name = \"Cmd-\" + name; }\n  if (shift) { name = \"Shift-\" + name; }\n  return name\n}\n\n// This is a kludge to keep keymaps mostly working as raw objects\n// (backwards compatibility) while at the same time support features\n// like normalization and multi-stroke key bindings. It compiles a\n// new normalized keymap, and then updates the old object to reflect\n// this.\nfunction normalizeKeyMap(keymap) {\n  var copy = {};\n  for (var keyname in keymap) { if (keymap.hasOwnProperty(keyname)) {\n    var value = keymap[keyname];\n    if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) { continue }\n    if (value == \"...\") { delete keymap[keyname]; continue }\n\n    var keys = map(keyname.split(\" \"), normalizeKeyName);\n    for (var i = 0; i < keys.length; i++) {\n      var val = (void 0), name = (void 0);\n      if (i == keys.length - 1) {\n        name = keys.join(\" \");\n        val = value;\n      } else {\n        name = keys.slice(0, i + 1).join(\" \");\n        val = \"...\";\n      }\n      var prev = copy[name];\n      if (!prev) { copy[name] = val; }\n      else if (prev != val) { throw new Error(\"Inconsistent bindings for \" + name) }\n    }\n    delete keymap[keyname];\n  } }\n  for (var prop in copy) { keymap[prop] = copy[prop]; }\n  return keymap\n}\n\nfunction lookupKey(key, map$$1, handle, context) {\n  map$$1 = getKeyMap(map$$1);\n  var found = map$$1.call ? map$$1.call(key, context) : map$$1[key];\n  if (found === false) { return \"nothing\" }\n  if (found === \"...\") { return \"multi\" }\n  if (found != null && handle(found)) { return \"handled\" }\n\n  if (map$$1.fallthrough) {\n    if (Object.prototype.toString.call(map$$1.fallthrough) != \"[object Array]\")\n      { return lookupKey(key, map$$1.fallthrough, handle, context) }\n    for (var i = 0; i < map$$1.fallthrough.length; i++) {\n      var result = lookupKey(key, map$$1.fallthrough[i], handle, context);\n      if (result) { return result }\n    }\n  }\n}\n\n// Modifier key presses don't count as 'real' key presses for the\n// purpose of keymap fallthrough.\nfunction isModifierKey(value) {\n  var name = typeof value == \"string\" ? value : keyNames[value.keyCode];\n  return name == \"Ctrl\" || name == \"Alt\" || name == \"Shift\" || name == \"Mod\"\n}\n\n// Look up the name of a key as indicated by an event object.\nfunction keyName(event, noShift) {\n  if (presto && event.keyCode == 34 && event[\"char\"]) { return false }\n  var base = keyNames[event.keyCode], name = base;\n  if (name == null || event.altGraphKey) { return false }\n  if (event.altKey && base != \"Alt\") { name = \"Alt-\" + name; }\n  if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != \"Ctrl\") { name = \"Ctrl-\" + name; }\n  if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != \"Cmd\") { name = \"Cmd-\" + name; }\n  if (!noShift && event.shiftKey && base != \"Shift\") { name = \"Shift-\" + name; }\n  return name\n}\n\nfunction getKeyMap(val) {\n  return typeof val == \"string\" ? keyMap[val] : val\n}\n\n// Helper for deleting text near the selection(s), used to implement\n// backspace, delete, and similar functionality.\nfunction deleteNearSelection(cm, compute) {\n  var ranges = cm.doc.sel.ranges, kill = [];\n  // Build up a set of ranges to kill first, merging overlapping\n  // ranges.\n  for (var i = 0; i < ranges.length; i++) {\n    var toKill = compute(ranges[i]);\n    while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {\n      var replaced = kill.pop();\n      if (cmp(replaced.from, toKill.from) < 0) {\n        toKill.from = replaced.from;\n        break\n      }\n    }\n    kill.push(toKill);\n  }\n  // Next, remove those actual ranges.\n  runInOp(cm, function () {\n    for (var i = kill.length - 1; i >= 0; i--)\n      { replaceRange(cm.doc, \"\", kill[i].from, kill[i].to, \"+delete\"); }\n    ensureCursorVisible(cm);\n  });\n}\n\n// Commands are parameter-less actions that can be performed on an\n// editor, mostly used for keybindings.\nvar commands = {\n  selectAll: selectAll,\n  singleSelection: function (cm) { return cm.setSelection(cm.getCursor(\"anchor\"), cm.getCursor(\"head\"), sel_dontScroll); },\n  killLine: function (cm) { return deleteNearSelection(cm, function (range) {\n    if (range.empty()) {\n      var len = getLine(cm.doc, range.head.line).text.length;\n      if (range.head.ch == len && range.head.line < cm.lastLine())\n        { return {from: range.head, to: Pos(range.head.line + 1, 0)} }\n      else\n        { return {from: range.head, to: Pos(range.head.line, len)} }\n    } else {\n      return {from: range.from(), to: range.to()}\n    }\n  }); },\n  deleteLine: function (cm) { return deleteNearSelection(cm, function (range) { return ({\n    from: Pos(range.from().line, 0),\n    to: clipPos(cm.doc, Pos(range.to().line + 1, 0))\n  }); }); },\n  delLineLeft: function (cm) { return deleteNearSelection(cm, function (range) { return ({\n    from: Pos(range.from().line, 0), to: range.from()\n  }); }); },\n  delWrappedLineLeft: function (cm) { return deleteNearSelection(cm, function (range) {\n    var top = cm.charCoords(range.head, \"div\").top + 5;\n    var leftPos = cm.coordsChar({left: 0, top: top}, \"div\");\n    return {from: leftPos, to: range.from()}\n  }); },\n  delWrappedLineRight: function (cm) { return deleteNearSelection(cm, function (range) {\n    var top = cm.charCoords(range.head, \"div\").top + 5;\n    var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\");\n    return {from: range.from(), to: rightPos }\n  }); },\n  undo: function (cm) { return cm.undo(); },\n  redo: function (cm) { return cm.redo(); },\n  undoSelection: function (cm) { return cm.undoSelection(); },\n  redoSelection: function (cm) { return cm.redoSelection(); },\n  goDocStart: function (cm) { return cm.extendSelection(Pos(cm.firstLine(), 0)); },\n  goDocEnd: function (cm) { return cm.extendSelection(Pos(cm.lastLine())); },\n  goLineStart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStart(cm, range.head.line); },\n    {origin: \"+move\", bias: 1}\n  ); },\n  goLineStartSmart: function (cm) { return cm.extendSelectionsBy(function (range) { return lineStartSmart(cm, range.head); },\n    {origin: \"+move\", bias: 1}\n  ); },\n  goLineEnd: function (cm) { return cm.extendSelectionsBy(function (range) { return lineEnd(cm, range.head.line); },\n    {origin: \"+move\", bias: -1}\n  ); },\n  goLineRight: function (cm) { return cm.extendSelectionsBy(function (range) {\n    var top = cm.charCoords(range.head, \"div\").top + 5;\n    return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, \"div\")\n  }, sel_move); },\n  goLineLeft: function (cm) { return cm.extendSelectionsBy(function (range) {\n    var top = cm.charCoords(range.head, \"div\").top + 5;\n    return cm.coordsChar({left: 0, top: top}, \"div\")\n  }, sel_move); },\n  goLineLeftSmart: function (cm) { return cm.extendSelectionsBy(function (range) {\n    var top = cm.charCoords(range.head, \"div\").top + 5;\n    var pos = cm.coordsChar({left: 0, top: top}, \"div\");\n    if (pos.ch < cm.getLine(pos.line).search(/\\S/)) { return lineStartSmart(cm, range.head) }\n    return pos\n  }, sel_move); },\n  goLineUp: function (cm) { return cm.moveV(-1, \"line\"); },\n  goLineDown: function (cm) { return cm.moveV(1, \"line\"); },\n  goPageUp: function (cm) { return cm.moveV(-1, \"page\"); },\n  goPageDown: function (cm) { return cm.moveV(1, \"page\"); },\n  goCharLeft: function (cm) { return cm.moveH(-1, \"char\"); },\n  goCharRight: function (cm) { return cm.moveH(1, \"char\"); },\n  goColumnLeft: function (cm) { return cm.moveH(-1, \"column\"); },\n  goColumnRight: function (cm) { return cm.moveH(1, \"column\"); },\n  goWordLeft: function (cm) { return cm.moveH(-1, \"word\"); },\n  goGroupRight: function (cm) { return cm.moveH(1, \"group\"); },\n  goGroupLeft: function (cm) { return cm.moveH(-1, \"group\"); },\n  goWordRight: function (cm) { return cm.moveH(1, \"word\"); },\n  delCharBefore: function (cm) { return cm.deleteH(-1, \"char\"); },\n  delCharAfter: function (cm) { return cm.deleteH(1, \"char\"); },\n  delWordBefore: function (cm) { return cm.deleteH(-1, \"word\"); },\n  delWordAfter: function (cm) { return cm.deleteH(1, \"word\"); },\n  delGroupBefore: function (cm) { return cm.deleteH(-1, \"group\"); },\n  delGroupAfter: function (cm) { return cm.deleteH(1, \"group\"); },\n  indentAuto: function (cm) { return cm.indentSelection(\"smart\"); },\n  indentMore: function (cm) { return cm.indentSelection(\"add\"); },\n  indentLess: function (cm) { return cm.indentSelection(\"subtract\"); },\n  insertTab: function (cm) { return cm.replaceSelection(\"\\t\"); },\n  insertSoftTab: function (cm) {\n    var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;\n    for (var i = 0; i < ranges.length; i++) {\n      var pos = ranges[i].from();\n      var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);\n      spaces.push(spaceStr(tabSize - col % tabSize));\n    }\n    cm.replaceSelections(spaces);\n  },\n  defaultTab: function (cm) {\n    if (cm.somethingSelected()) { cm.indentSelection(\"add\"); }\n    else { cm.execCommand(\"insertTab\"); }\n  },\n  // Swap the two chars left and right of each selection's head.\n  // Move cursor behind the two swapped characters afterwards.\n  //\n  // Doesn't consider line feeds a character.\n  // Doesn't scan more than one line above to find a character.\n  // Doesn't do anything on an empty line.\n  // Doesn't do anything with non-empty selections.\n  transposeChars: function (cm) { return runInOp(cm, function () {\n    var ranges = cm.listSelections(), newSel = [];\n    for (var i = 0; i < ranges.length; i++) {\n      if (!ranges[i].empty()) { continue }\n      var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;\n      if (line) {\n        if (cur.ch == line.length) { cur = new Pos(cur.line, cur.ch - 1); }\n        if (cur.ch > 0) {\n          cur = new Pos(cur.line, cur.ch + 1);\n          cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),\n                          Pos(cur.line, cur.ch - 2), cur, \"+transpose\");\n        } else if (cur.line > cm.doc.first) {\n          var prev = getLine(cm.doc, cur.line - 1).text;\n          if (prev) {\n            cur = new Pos(cur.line, 1);\n            cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +\n                            prev.charAt(prev.length - 1),\n                            Pos(cur.line - 1, prev.length - 1), cur, \"+transpose\");\n          }\n        }\n      }\n      newSel.push(new Range(cur, cur));\n    }\n    cm.setSelections(newSel);\n  }); },\n  newlineAndIndent: function (cm) { return runInOp(cm, function () {\n    var sels = cm.listSelections();\n    for (var i = sels.length - 1; i >= 0; i--)\n      { cm.replaceRange(cm.doc.lineSeparator(), sels[i].anchor, sels[i].head, \"+input\"); }\n    sels = cm.listSelections();\n    for (var i$1 = 0; i$1 < sels.length; i$1++)\n      { cm.indentLine(sels[i$1].from().line, null, true); }\n    ensureCursorVisible(cm);\n  }); },\n  openLine: function (cm) { return cm.replaceSelection(\"\\n\", \"start\"); },\n  toggleOverwrite: function (cm) { return cm.toggleOverwrite(); }\n};\n\n\nfunction lineStart(cm, lineN) {\n  var line = getLine(cm.doc, lineN);\n  var visual = visualLine(line);\n  if (visual != line) { lineN = lineNo(visual); }\n  return endOfLine(true, cm, visual, lineN, 1)\n}\nfunction lineEnd(cm, lineN) {\n  var line = getLine(cm.doc, lineN);\n  var visual = visualLineEnd(line);\n  if (visual != line) { lineN = lineNo(visual); }\n  return endOfLine(true, cm, line, lineN, -1)\n}\nfunction lineStartSmart(cm, pos) {\n  var start = lineStart(cm, pos.line);\n  var line = getLine(cm.doc, start.line);\n  var order = getOrder(line, cm.doc.direction);\n  if (!order || order[0].level == 0) {\n    var firstNonWS = Math.max(0, line.text.search(/\\S/));\n    var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;\n    return Pos(start.line, inWS ? 0 : firstNonWS, start.sticky)\n  }\n  return start\n}\n\n// Run a handler that was bound to a key.\nfunction doHandleBinding(cm, bound, dropShift) {\n  if (typeof bound == \"string\") {\n    bound = commands[bound];\n    if (!bound) { return false }\n  }\n  // Ensure previous input has been read, so that the handler sees a\n  // consistent view of the document\n  cm.display.input.ensurePolled();\n  var prevShift = cm.display.shift, done = false;\n  try {\n    if (cm.isReadOnly()) { cm.state.suppressEdits = true; }\n    if (dropShift) { cm.display.shift = false; }\n    done = bound(cm) != Pass;\n  } finally {\n    cm.display.shift = prevShift;\n    cm.state.suppressEdits = false;\n  }\n  return done\n}\n\nfunction lookupKeyForEditor(cm, name, handle) {\n  for (var i = 0; i < cm.state.keyMaps.length; i++) {\n    var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);\n    if (result) { return result }\n  }\n  return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))\n    || lookupKey(name, cm.options.keyMap, handle, cm)\n}\n\nvar stopSeq = new Delayed;\nfunction dispatchKey(cm, name, e, handle) {\n  var seq = cm.state.keySeq;\n  if (seq) {\n    if (isModifierKey(name)) { return \"handled\" }\n    stopSeq.set(50, function () {\n      if (cm.state.keySeq == seq) {\n        cm.state.keySeq = null;\n        cm.display.input.reset();\n      }\n    });\n    name = seq + \" \" + name;\n  }\n  var result = lookupKeyForEditor(cm, name, handle);\n\n  if (result == \"multi\")\n    { cm.state.keySeq = name; }\n  if (result == \"handled\")\n    { signalLater(cm, \"keyHandled\", cm, name, e); }\n\n  if (result == \"handled\" || result == \"multi\") {\n    e_preventDefault(e);\n    restartBlink(cm);\n  }\n\n  if (seq && !result && /\\'$/.test(name)) {\n    e_preventDefault(e);\n    return true\n  }\n  return !!result\n}\n\n// Handle a key from the keydown event.\nfunction handleKeyBinding(cm, e) {\n  var name = keyName(e, true);\n  if (!name) { return false }\n\n  if (e.shiftKey && !cm.state.keySeq) {\n    // First try to resolve full name (including 'Shift-'). Failing\n    // that, see if there is a cursor-motion command (starting with\n    // 'go') bound to the keyname without 'Shift-'.\n    return dispatchKey(cm, \"Shift-\" + name, e, function (b) { return doHandleBinding(cm, b, true); })\n        || dispatchKey(cm, name, e, function (b) {\n             if (typeof b == \"string\" ? /^go[A-Z]/.test(b) : b.motion)\n               { return doHandleBinding(cm, b) }\n           })\n  } else {\n    return dispatchKey(cm, name, e, function (b) { return doHandleBinding(cm, b); })\n  }\n}\n\n// Handle a key from the keypress event\nfunction handleCharBinding(cm, e, ch) {\n  return dispatchKey(cm, \"'\" + ch + \"'\", e, function (b) { return doHandleBinding(cm, b, true); })\n}\n\nvar lastStoppedKey = null;\nfunction onKeyDown(e) {\n  var cm = this;\n  cm.curOp.focus = activeElt();\n  if (signalDOMEvent(cm, e)) { return }\n  // IE does strange things with escape.\n  if (ie && ie_version < 11 && e.keyCode == 27) { e.returnValue = false; }\n  var code = e.keyCode;\n  cm.display.shift = code == 16 || e.shiftKey;\n  var handled = handleKeyBinding(cm, e);\n  if (presto) {\n    lastStoppedKey = handled ? code : null;\n    // Opera has no cut event... we try to at least catch the key combo\n    if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))\n      { cm.replaceSelection(\"\", null, \"cut\"); }\n  }\n\n  // Turn mouse into crosshair when Alt is held on Mac.\n  if (code == 18 && !/\\bCodeMirror-crosshair\\b/.test(cm.display.lineDiv.className))\n    { showCrossHair(cm); }\n}\n\nfunction showCrossHair(cm) {\n  var lineDiv = cm.display.lineDiv;\n  addClass(lineDiv, \"CodeMirror-crosshair\");\n\n  function up(e) {\n    if (e.keyCode == 18 || !e.altKey) {\n      rmClass(lineDiv, \"CodeMirror-crosshair\");\n      off(document, \"keyup\", up);\n      off(document, \"mouseover\", up);\n    }\n  }\n  on(document, \"keyup\", up);\n  on(document, \"mouseover\", up);\n}\n\nfunction onKeyUp(e) {\n  if (e.keyCode == 16) { this.doc.sel.shift = false; }\n  signalDOMEvent(this, e);\n}\n\nfunction onKeyPress(e) {\n  var cm = this;\n  if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) { return }\n  var keyCode = e.keyCode, charCode = e.charCode;\n  if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return}\n  if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) { return }\n  var ch = String.fromCharCode(charCode == null ? keyCode : charCode);\n  // Some browsers fire keypress events for backspace\n  if (ch == \"\\x08\") { return }\n  if (handleCharBinding(cm, e, ch)) { return }\n  cm.display.input.onKeyPress(e);\n}\n\n// A mouse down can be a single click, double click, triple click,\n// start of selection drag, start of text drag, new cursor\n// (ctrl-click), rectangle drag (alt-drag), or xwin\n// middle-click-paste. Or it might be a click on something we should\n// not interfere with, such as a scrollbar or widget.\nfunction onMouseDown(e) {\n  var cm = this, display = cm.display;\n  if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) { return }\n  display.input.ensurePolled();\n  display.shift = e.shiftKey;\n\n  if (eventInWidget(display, e)) {\n    if (!webkit) {\n      // Briefly turn off draggability, to allow widgets to do\n      // normal dragging things.\n      display.scroller.draggable = false;\n      setTimeout(function () { return display.scroller.draggable = true; }, 100);\n    }\n    return\n  }\n  if (clickInGutter(cm, e)) { return }\n  var start = posFromMouse(cm, e);\n  window.focus();\n\n  switch (e_button(e)) {\n  case 1:\n    // #3261: make sure, that we're not starting a second selection\n    if (cm.state.selectingText)\n      { cm.state.selectingText(e); }\n    else if (start)\n      { leftButtonDown(cm, e, start); }\n    else if (e_target(e) == display.scroller)\n      { e_preventDefault(e); }\n    break\n  case 2:\n    if (webkit) { cm.state.lastMiddleDown = +new Date; }\n    if (start) { extendSelection(cm.doc, start); }\n    setTimeout(function () { return display.input.focus(); }, 20);\n    e_preventDefault(e);\n    break\n  case 3:\n    if (captureRightClick) { onContextMenu(cm, e); }\n    else { delayBlurEvent(cm); }\n    break\n  }\n}\n\nvar lastClick;\nvar lastDoubleClick;\nfunction leftButtonDown(cm, e, start) {\n  if (ie) { setTimeout(bind(ensureFocus, cm), 0); }\n  else { cm.curOp.focus = activeElt(); }\n\n  var now = +new Date, type;\n  if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {\n    type = \"triple\";\n  } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {\n    type = \"double\";\n    lastDoubleClick = {time: now, pos: start};\n  } else {\n    type = \"single\";\n    lastClick = {time: now, pos: start};\n  }\n\n  var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey, contained;\n  if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&\n      type == \"single\" && (contained = sel.contains(start)) > -1 &&\n      (cmp((contained = sel.ranges[contained]).from(), start) < 0 || start.xRel > 0) &&\n      (cmp(contained.to(), start) > 0 || start.xRel < 0))\n    { leftButtonStartDrag(cm, e, start, modifier); }\n  else\n    { leftButtonSelect(cm, e, start, type, modifier); }\n}\n\n// Start a text drag. When it ends, see if any dragging actually\n// happen, and treat as a click if it didn't.\nfunction leftButtonStartDrag(cm, e, start, modifier) {\n  var display = cm.display, moved = false;\n  var dragEnd = operation(cm, function (e) {\n    if (webkit) { display.scroller.draggable = false; }\n    cm.state.draggingText = false;\n    off(document, \"mouseup\", dragEnd);\n    off(document, \"mousemove\", mouseMove);\n    off(display.scroller, \"dragstart\", dragStart);\n    off(display.scroller, \"drop\", dragEnd);\n    if (!moved) {\n      e_preventDefault(e);\n      if (!modifier)\n        { extendSelection(cm.doc, start); }\n      // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)\n      if (webkit || ie && ie_version == 9)\n        { setTimeout(function () {document.body.focus(); display.input.focus();}, 20); }\n      else\n        { display.input.focus(); }\n    }\n  });\n  var mouseMove = function(e2) {\n    moved = moved || Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) >= 10;\n  };\n  var dragStart = function () { return moved = true; };\n  // Let the drag handler handle this.\n  if (webkit) { display.scroller.draggable = true; }\n  cm.state.draggingText = dragEnd;\n  dragEnd.copy = mac ? e.altKey : e.ctrlKey;\n  // IE's approach to draggable\n  if (display.scroller.dragDrop) { display.scroller.dragDrop(); }\n  on(document, \"mouseup\", dragEnd);\n  on(document, \"mousemove\", mouseMove);\n  on(display.scroller, \"dragstart\", dragStart);\n  on(display.scroller, \"drop\", dragEnd);\n\n  delayBlurEvent(cm);\n  setTimeout(function () { return display.input.focus(); }, 20);\n}\n\n// Normal selection, as opposed to text dragging.\nfunction leftButtonSelect(cm, e, start, type, addNew) {\n  var display = cm.display, doc = cm.doc;\n  e_preventDefault(e);\n\n  var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;\n  if (addNew && !e.shiftKey) {\n    ourIndex = doc.sel.contains(start);\n    if (ourIndex > -1)\n      { ourRange = ranges[ourIndex]; }\n    else\n      { ourRange = new Range(start, start); }\n  } else {\n    ourRange = doc.sel.primary();\n    ourIndex = doc.sel.primIndex;\n  }\n\n  if (chromeOS ? e.shiftKey && e.metaKey : e.altKey) {\n    type = \"rect\";\n    if (!addNew) { ourRange = new Range(start, start); }\n    start = posFromMouse(cm, e, true, true);\n    ourIndex = -1;\n  } else if (type == \"double\") {\n    var word = cm.findWordAt(start);\n    if (cm.display.shift || doc.extend)\n      { ourRange = extendRange(doc, ourRange, word.anchor, word.head); }\n    else\n      { ourRange = word; }\n  } else if (type == \"triple\") {\n    var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));\n    if (cm.display.shift || doc.extend)\n      { ourRange = extendRange(doc, ourRange, line.anchor, line.head); }\n    else\n      { ourRange = line; }\n  } else {\n    ourRange = extendRange(doc, ourRange, start);\n  }\n\n  if (!addNew) {\n    ourIndex = 0;\n    setSelection(doc, new Selection([ourRange], 0), sel_mouse);\n    startSel = doc.sel;\n  } else if (ourIndex == -1) {\n    ourIndex = ranges.length;\n    setSelection(doc, normalizeSelection(ranges.concat([ourRange]), ourIndex),\n                 {scroll: false, origin: \"*mouse\"});\n  } else if (ranges.length > 1 && ranges[ourIndex].empty() && type == \"single\" && !e.shiftKey) {\n    setSelection(doc, normalizeSelection(ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),\n                 {scroll: false, origin: \"*mouse\"});\n    startSel = doc.sel;\n  } else {\n    replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);\n  }\n\n  var lastPos = start;\n  function extendTo(pos) {\n    if (cmp(lastPos, pos) == 0) { return }\n    lastPos = pos;\n\n    if (type == \"rect\") {\n      var ranges = [], tabSize = cm.options.tabSize;\n      var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);\n      var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);\n      var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);\n      for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));\n           line <= end; line++) {\n        var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);\n        if (left == right)\n          { ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos))); }\n        else if (text.length > leftPos)\n          { ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize)))); }\n      }\n      if (!ranges.length) { ranges.push(new Range(start, start)); }\n      setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),\n                   {origin: \"*mouse\", scroll: false});\n      cm.scrollIntoView(pos);\n    } else {\n      var oldRange = ourRange;\n      var anchor = oldRange.anchor, head = pos;\n      if (type != \"single\") {\n        var range$$1;\n        if (type == \"double\")\n          { range$$1 = cm.findWordAt(pos); }\n        else\n          { range$$1 = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0))); }\n        if (cmp(range$$1.anchor, anchor) > 0) {\n          head = range$$1.head;\n          anchor = minPos(oldRange.from(), range$$1.anchor);\n        } else {\n          head = range$$1.anchor;\n          anchor = maxPos(oldRange.to(), range$$1.head);\n        }\n      }\n      var ranges$1 = startSel.ranges.slice(0);\n      ranges$1[ourIndex] = new Range(clipPos(doc, anchor), head);\n      setSelection(doc, normalizeSelection(ranges$1, ourIndex), sel_mouse);\n    }\n  }\n\n  var editorSize = display.wrapper.getBoundingClientRect();\n  // Used to ensure timeout re-tries don't fire when another extend\n  // happened in the meantime (clearTimeout isn't reliable -- at\n  // least on Chrome, the timeouts still happen even when cleared,\n  // if the clear happens after their scheduled firing time).\n  var counter = 0;\n\n  function extend(e) {\n    var curCount = ++counter;\n    var cur = posFromMouse(cm, e, true, type == \"rect\");\n    if (!cur) { return }\n    if (cmp(cur, lastPos) != 0) {\n      cm.curOp.focus = activeElt();\n      extendTo(cur);\n      var visible = visibleLines(display, doc);\n      if (cur.line >= visible.to || cur.line < visible.from)\n        { setTimeout(operation(cm, function () {if (counter == curCount) { extend(e); }}), 150); }\n    } else {\n      var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;\n      if (outside) { setTimeout(operation(cm, function () {\n        if (counter != curCount) { return }\n        display.scroller.scrollTop += outside;\n        extend(e);\n      }), 50); }\n    }\n  }\n\n  function done(e) {\n    cm.state.selectingText = false;\n    counter = Infinity;\n    e_preventDefault(e);\n    display.input.focus();\n    off(document, \"mousemove\", move);\n    off(document, \"mouseup\", up);\n    doc.history.lastSelOrigin = null;\n  }\n\n  var move = operation(cm, function (e) {\n    if (!e_button(e)) { done(e); }\n    else { extend(e); }\n  });\n  var up = operation(cm, done);\n  cm.state.selectingText = up;\n  on(document, \"mousemove\", move);\n  on(document, \"mouseup\", up);\n}\n\n\n// Determines whether an event happened in the gutter, and fires the\n// handlers for the corresponding event.\nfunction gutterEvent(cm, e, type, prevent) {\n  var mX, mY;\n  try { mX = e.clientX; mY = e.clientY; }\n  catch(e) { return false }\n  if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) { return false }\n  if (prevent) { e_preventDefault(e); }\n\n  var display = cm.display;\n  var lineBox = display.lineDiv.getBoundingClientRect();\n\n  if (mY > lineBox.bottom || !hasHandler(cm, type)) { return e_defaultPrevented(e) }\n  mY -= lineBox.top - display.viewOffset;\n\n  for (var i = 0; i < cm.options.gutters.length; ++i) {\n    var g = display.gutters.childNodes[i];\n    if (g && g.getBoundingClientRect().right >= mX) {\n      var line = lineAtHeight(cm.doc, mY);\n      var gutter = cm.options.gutters[i];\n      signal(cm, type, cm, line, gutter, e);\n      return e_defaultPrevented(e)\n    }\n  }\n}\n\nfunction clickInGutter(cm, e) {\n  return gutterEvent(cm, e, \"gutterClick\", true)\n}\n\n// CONTEXT MENU HANDLING\n\n// To make the context menu work, we need to briefly unhide the\n// textarea (making it as unobtrusive as possible) to let the\n// right-click take effect on it.\nfunction onContextMenu(cm, e) {\n  if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) { return }\n  if (signalDOMEvent(cm, e, \"contextmenu\")) { return }\n  cm.display.input.onContextMenu(e);\n}\n\nfunction contextMenuInGutter(cm, e) {\n  if (!hasHandler(cm, \"gutterContextMenu\")) { return false }\n  return gutterEvent(cm, e, \"gutterContextMenu\", false)\n}\n\nfunction themeChanged(cm) {\n  cm.display.wrapper.className = cm.display.wrapper.className.replace(/\\s*cm-s-\\S+/g, \"\") +\n    cm.options.theme.replace(/(^|\\s)\\s*/g, \" cm-s-\");\n  clearCaches(cm);\n}\n\nvar Init = {toString: function(){return \"CodeMirror.Init\"}};\n\nvar defaults = {};\nvar optionHandlers = {};\n\nfunction defineOptions(CodeMirror) {\n  var optionHandlers = CodeMirror.optionHandlers;\n\n  function option(name, deflt, handle, notOnInit) {\n    CodeMirror.defaults[name] = deflt;\n    if (handle) { optionHandlers[name] =\n      notOnInit ? function (cm, val, old) {if (old != Init) { handle(cm, val, old); }} : handle; }\n  }\n\n  CodeMirror.defineOption = option;\n\n  // Passed to option handlers when there is no old value.\n  CodeMirror.Init = Init;\n\n  // These two are, on init, called from the constructor because they\n  // have to be initialized before the editor can start at all.\n  option(\"value\", \"\", function (cm, val) { return cm.setValue(val); }, true);\n  option(\"mode\", null, function (cm, val) {\n    cm.doc.modeOption = val;\n    loadMode(cm);\n  }, true);\n\n  option(\"indentUnit\", 2, loadMode, true);\n  option(\"indentWithTabs\", false);\n  option(\"smartIndent\", true);\n  option(\"tabSize\", 4, function (cm) {\n    resetModeState(cm);\n    clearCaches(cm);\n    regChange(cm);\n  }, true);\n  option(\"lineSeparator\", null, function (cm, val) {\n    cm.doc.lineSep = val;\n    if (!val) { return }\n    var newBreaks = [], lineNo = cm.doc.first;\n    cm.doc.iter(function (line) {\n      for (var pos = 0;;) {\n        var found = line.text.indexOf(val, pos);\n        if (found == -1) { break }\n        pos = found + val.length;\n        newBreaks.push(Pos(lineNo, found));\n      }\n      lineNo++;\n    });\n    for (var i = newBreaks.length - 1; i >= 0; i--)\n      { replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length)); }\n  });\n  option(\"specialChars\", /[\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u061c\\u200b-\\u200f\\u2028\\u2029\\ufeff]/g, function (cm, val, old) {\n    cm.state.specialChars = new RegExp(val.source + (val.test(\"\\t\") ? \"\" : \"|\\t\"), \"g\");\n    if (old != Init) { cm.refresh(); }\n  });\n  option(\"specialCharPlaceholder\", defaultSpecialCharPlaceholder, function (cm) { return cm.refresh(); }, true);\n  option(\"electricChars\", true);\n  option(\"inputStyle\", mobile ? \"contenteditable\" : \"textarea\", function () {\n    throw new Error(\"inputStyle can not (yet) be changed in a running editor\") // FIXME\n  }, true);\n  option(\"spellcheck\", false, function (cm, val) { return cm.getInputField().spellcheck = val; }, true);\n  option(\"rtlMoveVisually\", !windows);\n  option(\"wholeLineUpdateBefore\", true);\n\n  option(\"theme\", \"default\", function (cm) {\n    themeChanged(cm);\n    guttersChanged(cm);\n  }, true);\n  option(\"keyMap\", \"default\", function (cm, val, old) {\n    var next = getKeyMap(val);\n    var prev = old != Init && getKeyMap(old);\n    if (prev && prev.detach) { prev.detach(cm, next); }\n    if (next.attach) { next.attach(cm, prev || null); }\n  });\n  option(\"extraKeys\", null);\n\n  option(\"lineWrapping\", false, wrappingChanged, true);\n  option(\"gutters\", [], function (cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"fixedGutter\", true, function (cm, val) {\n    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + \"px\" : \"0\";\n    cm.refresh();\n  }, true);\n  option(\"coverGutterNextToScrollbar\", false, function (cm) { return updateScrollbars(cm); }, true);\n  option(\"scrollbarStyle\", \"native\", function (cm) {\n    initScrollbars(cm);\n    updateScrollbars(cm);\n    cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);\n    cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);\n  }, true);\n  option(\"lineNumbers\", false, function (cm) {\n    setGuttersForLineNumbers(cm.options);\n    guttersChanged(cm);\n  }, true);\n  option(\"firstLineNumber\", 1, guttersChanged, true);\n  option(\"lineNumberFormatter\", function (integer) { return integer; }, guttersChanged, true);\n  option(\"showCursorWhenSelecting\", false, updateSelection, true);\n\n  option(\"resetSelectionOnContextMenu\", true);\n  option(\"lineWiseCopyCut\", true);\n\n  option(\"readOnly\", false, function (cm, val) {\n    if (val == \"nocursor\") {\n      onBlur(cm);\n      cm.display.input.blur();\n      cm.display.disabled = true;\n    } else {\n      cm.display.disabled = false;\n    }\n    cm.display.input.readOnlyChanged(val);\n  });\n  option(\"disableInput\", false, function (cm, val) {if (!val) { cm.display.input.reset(); }}, true);\n  option(\"dragDrop\", true, dragDropChanged);\n  option(\"allowDropFileTypes\", null);\n\n  option(\"cursorBlinkRate\", 530);\n  option(\"cursorScrollMargin\", 0);\n  option(\"cursorHeight\", 1, updateSelection, true);\n  option(\"singleCursorHeightPerLine\", true, updateSelection, true);\n  option(\"workTime\", 100);\n  option(\"workDelay\", 100);\n  option(\"flattenSpans\", true, resetModeState, true);\n  option(\"addModeClass\", false, resetModeState, true);\n  option(\"pollInterval\", 100);\n  option(\"undoDepth\", 200, function (cm, val) { return cm.doc.history.undoDepth = val; });\n  option(\"historyEventDelay\", 1250);\n  option(\"viewportMargin\", 10, function (cm) { return cm.refresh(); }, true);\n  option(\"maxHighlightLength\", 10000, resetModeState, true);\n  option(\"moveInputWithCursor\", true, function (cm, val) {\n    if (!val) { cm.display.input.resetPosition(); }\n  });\n\n  option(\"tabindex\", null, function (cm, val) { return cm.display.input.getField().tabIndex = val || \"\"; });\n  option(\"autofocus\", null);\n  option(\"direction\", \"ltr\", function (cm, val) { return cm.doc.setDirection(val); }, true);\n}\n\nfunction guttersChanged(cm) {\n  updateGutters(cm);\n  regChange(cm);\n  alignHorizontally(cm);\n}\n\nfunction dragDropChanged(cm, value, old) {\n  var wasOn = old && old != Init;\n  if (!value != !wasOn) {\n    var funcs = cm.display.dragFunctions;\n    var toggle = value ? on : off;\n    toggle(cm.display.scroller, \"dragstart\", funcs.start);\n    toggle(cm.display.scroller, \"dragenter\", funcs.enter);\n    toggle(cm.display.scroller, \"dragover\", funcs.over);\n    toggle(cm.display.scroller, \"dragleave\", funcs.leave);\n    toggle(cm.display.scroller, \"drop\", funcs.drop);\n  }\n}\n\nfunction wrappingChanged(cm) {\n  if (cm.options.lineWrapping) {\n    addClass(cm.display.wrapper, \"CodeMirror-wrap\");\n    cm.display.sizer.style.minWidth = \"\";\n    cm.display.sizerWidth = null;\n  } else {\n    rmClass(cm.display.wrapper, \"CodeMirror-wrap\");\n    findMaxLine(cm);\n  }\n  estimateLineHeights(cm);\n  regChange(cm);\n  clearCaches(cm);\n  setTimeout(function () { return updateScrollbars(cm); }, 100);\n}\n\n// A CodeMirror instance represents an editor. This is the object\n// that user code is usually dealing with.\n\nfunction CodeMirror$1(place, options) {\n  var this$1 = this;\n\n  if (!(this instanceof CodeMirror$1)) { return new CodeMirror$1(place, options) }\n\n  this.options = options = options ? copyObj(options) : {};\n  // Determine effective options based on given values and defaults.\n  copyObj(defaults, options, false);\n  setGuttersForLineNumbers(options);\n\n  var doc = options.value;\n  if (typeof doc == \"string\") { doc = new Doc(doc, options.mode, null, options.lineSeparator, options.direction); }\n  this.doc = doc;\n\n  var input = new CodeMirror$1.inputStyles[options.inputStyle](this);\n  var display = this.display = new Display(place, doc, input);\n  display.wrapper.CodeMirror = this;\n  updateGutters(this);\n  themeChanged(this);\n  if (options.lineWrapping)\n    { this.display.wrapper.className += \" CodeMirror-wrap\"; }\n  initScrollbars(this);\n\n  this.state = {\n    keyMaps: [],  // stores maps added by addKeyMap\n    overlays: [], // highlighting overlays, as added by addOverlay\n    modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info\n    overwrite: false,\n    delayingBlurEvent: false,\n    focused: false,\n    suppressEdits: false, // used to disable editing during key handlers when in readOnly mode\n    pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in input.poll\n    selectingText: false,\n    draggingText: false,\n    highlight: new Delayed(), // stores highlight worker timeout\n    keySeq: null,  // Unfinished key sequence\n    specialChars: null\n  };\n\n  if (options.autofocus && !mobile) { display.input.focus(); }\n\n  // Override magic textarea content restore that IE sometimes does\n  // on our hidden textarea on reload\n  if (ie && ie_version < 11) { setTimeout(function () { return this$1.display.input.reset(true); }, 20); }\n\n  registerEventHandlers(this);\n  ensureGlobalHandlers();\n\n  startOperation(this);\n  this.curOp.forceUpdate = true;\n  attachDoc(this, doc);\n\n  if ((options.autofocus && !mobile) || this.hasFocus())\n    { setTimeout(bind(onFocus, this), 20); }\n  else\n    { onBlur(this); }\n\n  for (var opt in optionHandlers) { if (optionHandlers.hasOwnProperty(opt))\n    { optionHandlers[opt](this$1, options[opt], Init); } }\n  maybeUpdateLineNumberWidth(this);\n  if (options.finishInit) { options.finishInit(this); }\n  for (var i = 0; i < initHooks.length; ++i) { initHooks[i](this$1); }\n  endOperation(this);\n  // Suppress optimizelegibility in Webkit, since it breaks text\n  // measuring on line wrapping boundaries.\n  if (webkit && options.lineWrapping &&\n      getComputedStyle(display.lineDiv).textRendering == \"optimizelegibility\")\n    { display.lineDiv.style.textRendering = \"auto\"; }\n}\n\n// The default configuration options.\nCodeMirror$1.defaults = defaults;\n// Functions to run when options are changed.\nCodeMirror$1.optionHandlers = optionHandlers;\n\n// Attach the necessary event handlers when initializing the editor\nfunction registerEventHandlers(cm) {\n  var d = cm.display;\n  on(d.scroller, \"mousedown\", operation(cm, onMouseDown));\n  // Older IE's will not fire a second mousedown for a double click\n  if (ie && ie_version < 11)\n    { on(d.scroller, \"dblclick\", operation(cm, function (e) {\n      if (signalDOMEvent(cm, e)) { return }\n      var pos = posFromMouse(cm, e);\n      if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) { return }\n      e_preventDefault(e);\n      var word = cm.findWordAt(pos);\n      extendSelection(cm.doc, word.anchor, word.head);\n    })); }\n  else\n    { on(d.scroller, \"dblclick\", function (e) { return signalDOMEvent(cm, e) || e_preventDefault(e); }); }\n  // Some browsers fire contextmenu *after* opening the menu, at\n  // which point we can't mess with it anymore. Context menu is\n  // handled in onMouseDown for these browsers.\n  if (!captureRightClick) { on(d.scroller, \"contextmenu\", function (e) { return onContextMenu(cm, e); }); }\n\n  // Used to suppress mouse event handling when a touch happens\n  var touchFinished, prevTouch = {end: 0};\n  function finishTouch() {\n    if (d.activeTouch) {\n      touchFinished = setTimeout(function () { return d.activeTouch = null; }, 1000);\n      prevTouch = d.activeTouch;\n      prevTouch.end = +new Date;\n    }\n  }\n  function isMouseLikeTouchEvent(e) {\n    if (e.touches.length != 1) { return false }\n    var touch = e.touches[0];\n    return touch.radiusX <= 1 && touch.radiusY <= 1\n  }\n  function farAway(touch, other) {\n    if (other.left == null) { return true }\n    var dx = other.left - touch.left, dy = other.top - touch.top;\n    return dx * dx + dy * dy > 20 * 20\n  }\n  on(d.scroller, \"touchstart\", function (e) {\n    if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e)) {\n      d.input.ensurePolled();\n      clearTimeout(touchFinished);\n      var now = +new Date;\n      d.activeTouch = {start: now, moved: false,\n                       prev: now - prevTouch.end <= 300 ? prevTouch : null};\n      if (e.touches.length == 1) {\n        d.activeTouch.left = e.touches[0].pageX;\n        d.activeTouch.top = e.touches[0].pageY;\n      }\n    }\n  });\n  on(d.scroller, \"touchmove\", function () {\n    if (d.activeTouch) { d.activeTouch.moved = true; }\n  });\n  on(d.scroller, \"touchend\", function (e) {\n    var touch = d.activeTouch;\n    if (touch && !eventInWidget(d, e) && touch.left != null &&\n        !touch.moved && new Date - touch.start < 300) {\n      var pos = cm.coordsChar(d.activeTouch, \"page\"), range;\n      if (!touch.prev || farAway(touch, touch.prev)) // Single tap\n        { range = new Range(pos, pos); }\n      else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap\n        { range = cm.findWordAt(pos); }\n      else // Triple tap\n        { range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0))); }\n      cm.setSelection(range.anchor, range.head);\n      cm.focus();\n      e_preventDefault(e);\n    }\n    finishTouch();\n  });\n  on(d.scroller, \"touchcancel\", finishTouch);\n\n  // Sync scrolling between fake scrollbars and real scrollable\n  // area, ensure viewport is updated when scrolling.\n  on(d.scroller, \"scroll\", function () {\n    if (d.scroller.clientHeight) {\n      updateScrollTop(cm, d.scroller.scrollTop);\n      setScrollLeft(cm, d.scroller.scrollLeft, true);\n      signal(cm, \"scroll\", cm);\n    }\n  });\n\n  // Listen to wheel events in order to try and update the viewport on time.\n  on(d.scroller, \"mousewheel\", function (e) { return onScrollWheel(cm, e); });\n  on(d.scroller, \"DOMMouseScroll\", function (e) { return onScrollWheel(cm, e); });\n\n  // Prevent wrapper from ever scrolling\n  on(d.wrapper, \"scroll\", function () { return d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });\n\n  d.dragFunctions = {\n    enter: function (e) {if (!signalDOMEvent(cm, e)) { e_stop(e); }},\n    over: function (e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},\n    start: function (e) { return onDragStart(cm, e); },\n    drop: operation(cm, onDrop),\n    leave: function (e) {if (!signalDOMEvent(cm, e)) { clearDragCursor(cm); }}\n  };\n\n  var inp = d.input.getField();\n  on(inp, \"keyup\", function (e) { return onKeyUp.call(cm, e); });\n  on(inp, \"keydown\", operation(cm, onKeyDown));\n  on(inp, \"keypress\", operation(cm, onKeyPress));\n  on(inp, \"focus\", function (e) { return onFocus(cm, e); });\n  on(inp, \"blur\", function (e) { return onBlur(cm, e); });\n}\n\nvar initHooks = [];\nCodeMirror$1.defineInitHook = function (f) { return initHooks.push(f); };\n\n// Indent the given line. The how parameter can be \"smart\",\n// \"add\"/null, \"subtract\", or \"prev\". When aggressive is false\n// (typically set to true for forced single-line indents), empty\n// lines are not indented, and places where the mode returns Pass\n// are left alone.\nfunction indentLine(cm, n, how, aggressive) {\n  var doc = cm.doc, state;\n  if (how == null) { how = \"add\"; }\n  if (how == \"smart\") {\n    // Fall back to \"prev\" when the mode doesn't have an indentation\n    // method.\n    if (!doc.mode.indent) { how = \"prev\"; }\n    else { state = getStateBefore(cm, n); }\n  }\n\n  var tabSize = cm.options.tabSize;\n  var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);\n  if (line.stateAfter) { line.stateAfter = null; }\n  var curSpaceString = line.text.match(/^\\s*/)[0], indentation;\n  if (!aggressive && !/\\S/.test(line.text)) {\n    indentation = 0;\n    how = \"not\";\n  } else if (how == \"smart\") {\n    indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);\n    if (indentation == Pass || indentation > 150) {\n      if (!aggressive) { return }\n      how = \"prev\";\n    }\n  }\n  if (how == \"prev\") {\n    if (n > doc.first) { indentation = countColumn(getLine(doc, n-1).text, null, tabSize); }\n    else { indentation = 0; }\n  } else if (how == \"add\") {\n    indentation = curSpace + cm.options.indentUnit;\n  } else if (how == \"subtract\") {\n    indentation = curSpace - cm.options.indentUnit;\n  } else if (typeof how == \"number\") {\n    indentation = curSpace + how;\n  }\n  indentation = Math.max(0, indentation);\n\n  var indentString = \"\", pos = 0;\n  if (cm.options.indentWithTabs)\n    { for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += \"\\t\";} }\n  if (pos < indentation) { indentString += spaceStr(indentation - pos); }\n\n  if (indentString != curSpaceString) {\n    replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), \"+input\");\n    line.stateAfter = null;\n    return true\n  } else {\n    // Ensure that, if the cursor was in the whitespace at the start\n    // of the line, it is moved to the end of that space.\n    for (var i$1 = 0; i$1 < doc.sel.ranges.length; i$1++) {\n      var range = doc.sel.ranges[i$1];\n      if (range.head.line == n && range.head.ch < curSpaceString.length) {\n        var pos$1 = Pos(n, curSpaceString.length);\n        replaceOneSelection(doc, i$1, new Range(pos$1, pos$1));\n        break\n      }\n    }\n  }\n}\n\n// This will be set to a {lineWise: bool, text: [string]} object, so\n// that, when pasting, we know what kind of selections the copied\n// text was made out of.\nvar lastCopied = null;\n\nfunction setLastCopied(newLastCopied) {\n  lastCopied = newLastCopied;\n}\n\nfunction applyTextInput(cm, inserted, deleted, sel, origin) {\n  var doc = cm.doc;\n  cm.display.shift = false;\n  if (!sel) { sel = doc.sel; }\n\n  var paste = cm.state.pasteIncoming || origin == \"paste\";\n  var textLines = splitLinesAuto(inserted), multiPaste = null;\n  // When pasing N lines into N selections, insert one line per selection\n  if (paste && sel.ranges.length > 1) {\n    if (lastCopied && lastCopied.text.join(\"\\n\") == inserted) {\n      if (sel.ranges.length % lastCopied.text.length == 0) {\n        multiPaste = [];\n        for (var i = 0; i < lastCopied.text.length; i++)\n          { multiPaste.push(doc.splitLines(lastCopied.text[i])); }\n      }\n    } else if (textLines.length == sel.ranges.length) {\n      multiPaste = map(textLines, function (l) { return [l]; });\n    }\n  }\n\n  var updateInput;\n  // Normal behavior is to insert the new text into every selection\n  for (var i$1 = sel.ranges.length - 1; i$1 >= 0; i$1--) {\n    var range$$1 = sel.ranges[i$1];\n    var from = range$$1.from(), to = range$$1.to();\n    if (range$$1.empty()) {\n      if (deleted && deleted > 0) // Handle deletion\n        { from = Pos(from.line, from.ch - deleted); }\n      else if (cm.state.overwrite && !paste) // Handle overwrite\n        { to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length)); }\n      else if (lastCopied && lastCopied.lineWise && lastCopied.text.join(\"\\n\") == inserted)\n        { from = to = Pos(from.line, 0); }\n    }\n    updateInput = cm.curOp.updateInput;\n    var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i$1 % multiPaste.length] : textLines,\n                       origin: origin || (paste ? \"paste\" : cm.state.cutIncoming ? \"cut\" : \"+input\")};\n    makeChange(cm.doc, changeEvent);\n    signalLater(cm, \"inputRead\", cm, changeEvent);\n  }\n  if (inserted && !paste)\n    { triggerElectric(cm, inserted); }\n\n  ensureCursorVisible(cm);\n  cm.curOp.updateInput = updateInput;\n  cm.curOp.typing = true;\n  cm.state.pasteIncoming = cm.state.cutIncoming = false;\n}\n\nfunction handlePaste(e, cm) {\n  var pasted = e.clipboardData && e.clipboardData.getData(\"Text\");\n  if (pasted) {\n    e.preventDefault();\n    if (!cm.isReadOnly() && !cm.options.disableInput)\n      { runInOp(cm, function () { return applyTextInput(cm, pasted, 0, null, \"paste\"); }); }\n    return true\n  }\n}\n\nfunction triggerElectric(cm, inserted) {\n  // When an 'electric' character is inserted, immediately trigger a reindent\n  if (!cm.options.electricChars || !cm.options.smartIndent) { return }\n  var sel = cm.doc.sel;\n\n  for (var i = sel.ranges.length - 1; i >= 0; i--) {\n    var range$$1 = sel.ranges[i];\n    if (range$$1.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range$$1.head.line)) { continue }\n    var mode = cm.getModeAt(range$$1.head);\n    var indented = false;\n    if (mode.electricChars) {\n      for (var j = 0; j < mode.electricChars.length; j++)\n        { if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {\n          indented = indentLine(cm, range$$1.head.line, \"smart\");\n          break\n        } }\n    } else if (mode.electricInput) {\n      if (mode.electricInput.test(getLine(cm.doc, range$$1.head.line).text.slice(0, range$$1.head.ch)))\n        { indented = indentLine(cm, range$$1.head.line, \"smart\"); }\n    }\n    if (indented) { signalLater(cm, \"electricInput\", cm, range$$1.head.line); }\n  }\n}\n\nfunction copyableRanges(cm) {\n  var text = [], ranges = [];\n  for (var i = 0; i < cm.doc.sel.ranges.length; i++) {\n    var line = cm.doc.sel.ranges[i].head.line;\n    var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};\n    ranges.push(lineRange);\n    text.push(cm.getRange(lineRange.anchor, lineRange.head));\n  }\n  return {text: text, ranges: ranges}\n}\n\nfunction disableBrowserMagic(field, spellcheck) {\n  field.setAttribute(\"autocorrect\", \"off\");\n  field.setAttribute(\"autocapitalize\", \"off\");\n  field.setAttribute(\"spellcheck\", !!spellcheck);\n}\n\nfunction hiddenTextarea() {\n  var te = elt(\"textarea\", null, null, \"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none\");\n  var div = elt(\"div\", [te], null, \"overflow: hidden; position: relative; width: 3px; height: 0px;\");\n  // The textarea is kept positioned near the cursor to prevent the\n  // fact that it'll be scrolled into view on input from scrolling\n  // our fake cursor out of view. On webkit, when wrap=off, paste is\n  // very slow. So make the area wide instead.\n  if (webkit) { te.style.width = \"1000px\"; }\n  else { te.setAttribute(\"wrap\", \"off\"); }\n  // If border: 0; -- iOS fails to open keyboard (issue #1287)\n  if (ios) { te.style.border = \"1px solid black\"; }\n  disableBrowserMagic(te);\n  return div\n}\n\n// The publicly visible API. Note that methodOp(f) means\n// 'wrap f in an operation, performed on its `this` parameter'.\n\n// This is not the complete set of editor methods. Most of the\n// methods defined on the Doc type are also injected into\n// CodeMirror.prototype, for backwards compatibility and\n// convenience.\n\nvar addEditorMethods = function(CodeMirror) {\n  var optionHandlers = CodeMirror.optionHandlers;\n\n  var helpers = CodeMirror.helpers = {};\n\n  CodeMirror.prototype = {\n    constructor: CodeMirror,\n    focus: function(){window.focus(); this.display.input.focus();},\n\n    setOption: function(option, value) {\n      var options = this.options, old = options[option];\n      if (options[option] == value && option != \"mode\") { return }\n      options[option] = value;\n      if (optionHandlers.hasOwnProperty(option))\n        { operation(this, optionHandlers[option])(this, value, old); }\n      signal(this, \"optionChange\", this, option);\n    },\n\n    getOption: function(option) {return this.options[option]},\n    getDoc: function() {return this.doc},\n\n    addKeyMap: function(map$$1, bottom) {\n      this.state.keyMaps[bottom ? \"push\" : \"unshift\"](getKeyMap(map$$1));\n    },\n    removeKeyMap: function(map$$1) {\n      var maps = this.state.keyMaps;\n      for (var i = 0; i < maps.length; ++i)\n        { if (maps[i] == map$$1 || maps[i].name == map$$1) {\n          maps.splice(i, 1);\n          return true\n        } }\n    },\n\n    addOverlay: methodOp(function(spec, options) {\n      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);\n      if (mode.startState) { throw new Error(\"Overlays may not be stateful.\") }\n      insertSorted(this.state.overlays,\n                   {mode: mode, modeSpec: spec, opaque: options && options.opaque,\n                    priority: (options && options.priority) || 0},\n                   function (overlay) { return overlay.priority; });\n      this.state.modeGen++;\n      regChange(this);\n    }),\n    removeOverlay: methodOp(function(spec) {\n      var this$1 = this;\n\n      var overlays = this.state.overlays;\n      for (var i = 0; i < overlays.length; ++i) {\n        var cur = overlays[i].modeSpec;\n        if (cur == spec || typeof spec == \"string\" && cur.name == spec) {\n          overlays.splice(i, 1);\n          this$1.state.modeGen++;\n          regChange(this$1);\n          return\n        }\n      }\n    }),\n\n    indentLine: methodOp(function(n, dir, aggressive) {\n      if (typeof dir != \"string\" && typeof dir != \"number\") {\n        if (dir == null) { dir = this.options.smartIndent ? \"smart\" : \"prev\"; }\n        else { dir = dir ? \"add\" : \"subtract\"; }\n      }\n      if (isLine(this.doc, n)) { indentLine(this, n, dir, aggressive); }\n    }),\n    indentSelection: methodOp(function(how) {\n      var this$1 = this;\n\n      var ranges = this.doc.sel.ranges, end = -1;\n      for (var i = 0; i < ranges.length; i++) {\n        var range$$1 = ranges[i];\n        if (!range$$1.empty()) {\n          var from = range$$1.from(), to = range$$1.to();\n          var start = Math.max(end, from.line);\n          end = Math.min(this$1.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;\n          for (var j = start; j < end; ++j)\n            { indentLine(this$1, j, how); }\n          var newRanges = this$1.doc.sel.ranges;\n          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)\n            { replaceOneSelection(this$1.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll); }\n        } else if (range$$1.head.line > end) {\n          indentLine(this$1, range$$1.head.line, how, true);\n          end = range$$1.head.line;\n          if (i == this$1.doc.sel.primIndex) { ensureCursorVisible(this$1); }\n        }\n      }\n    }),\n\n    // Fetch the parser token for a given character. Useful for hacks\n    // that want to inspect the mode state (say, for completion).\n    getTokenAt: function(pos, precise) {\n      return takeToken(this, pos, precise)\n    },\n\n    getLineTokens: function(line, precise) {\n      return takeToken(this, Pos(line), precise, true)\n    },\n\n    getTokenTypeAt: function(pos) {\n      pos = clipPos(this.doc, pos);\n      var styles = getLineStyles(this, getLine(this.doc, pos.line));\n      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;\n      var type;\n      if (ch == 0) { type = styles[2]; }\n      else { for (;;) {\n        var mid = (before + after) >> 1;\n        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) { after = mid; }\n        else if (styles[mid * 2 + 1] < ch) { before = mid + 1; }\n        else { type = styles[mid * 2 + 2]; break }\n      } }\n      var cut = type ? type.indexOf(\"overlay \") : -1;\n      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1)\n    },\n\n    getModeAt: function(pos) {\n      var mode = this.doc.mode;\n      if (!mode.innerMode) { return mode }\n      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode\n    },\n\n    getHelper: function(pos, type) {\n      return this.getHelpers(pos, type)[0]\n    },\n\n    getHelpers: function(pos, type) {\n      var this$1 = this;\n\n      var found = [];\n      if (!helpers.hasOwnProperty(type)) { return found }\n      var help = helpers[type], mode = this.getModeAt(pos);\n      if (typeof mode[type] == \"string\") {\n        if (help[mode[type]]) { found.push(help[mode[type]]); }\n      } else if (mode[type]) {\n        for (var i = 0; i < mode[type].length; i++) {\n          var val = help[mode[type][i]];\n          if (val) { found.push(val); }\n        }\n      } else if (mode.helperType && help[mode.helperType]) {\n        found.push(help[mode.helperType]);\n      } else if (help[mode.name]) {\n        found.push(help[mode.name]);\n      }\n      for (var i$1 = 0; i$1 < help._global.length; i$1++) {\n        var cur = help._global[i$1];\n        if (cur.pred(mode, this$1) && indexOf(found, cur.val) == -1)\n          { found.push(cur.val); }\n      }\n      return found\n    },\n\n    getStateAfter: function(line, precise) {\n      var doc = this.doc;\n      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);\n      return getStateBefore(this, line + 1, precise)\n    },\n\n    cursorCoords: function(start, mode) {\n      var pos, range$$1 = this.doc.sel.primary();\n      if (start == null) { pos = range$$1.head; }\n      else if (typeof start == \"object\") { pos = clipPos(this.doc, start); }\n      else { pos = start ? range$$1.from() : range$$1.to(); }\n      return cursorCoords(this, pos, mode || \"page\")\n    },\n\n    charCoords: function(pos, mode) {\n      return charCoords(this, clipPos(this.doc, pos), mode || \"page\")\n    },\n\n    coordsChar: function(coords, mode) {\n      coords = fromCoordSystem(this, coords, mode || \"page\");\n      return coordsChar(this, coords.left, coords.top)\n    },\n\n    lineAtHeight: function(height, mode) {\n      height = fromCoordSystem(this, {top: height, left: 0}, mode || \"page\").top;\n      return lineAtHeight(this.doc, height + this.display.viewOffset)\n    },\n    heightAtLine: function(line, mode, includeWidgets) {\n      var end = false, lineObj;\n      if (typeof line == \"number\") {\n        var last = this.doc.first + this.doc.size - 1;\n        if (line < this.doc.first) { line = this.doc.first; }\n        else if (line > last) { line = last; end = true; }\n        lineObj = getLine(this.doc, line);\n      } else {\n        lineObj = line;\n      }\n      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || \"page\", includeWidgets || end).top +\n        (end ? this.doc.height - heightAtLine(lineObj) : 0)\n    },\n\n    defaultTextHeight: function() { return textHeight(this.display) },\n    defaultCharWidth: function() { return charWidth(this.display) },\n\n    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo}},\n\n    addWidget: function(pos, node, scroll, vert, horiz) {\n      var display = this.display;\n      pos = cursorCoords(this, clipPos(this.doc, pos));\n      var top = pos.bottom, left = pos.left;\n      node.style.position = \"absolute\";\n      node.setAttribute(\"cm-ignore-events\", \"true\");\n      this.display.input.setUneditable(node);\n      display.sizer.appendChild(node);\n      if (vert == \"over\") {\n        top = pos.top;\n      } else if (vert == \"above\" || vert == \"near\") {\n        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),\n        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);\n        // Default to positioning above (if specified and possible); otherwise default to positioning below\n        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)\n          { top = pos.top - node.offsetHeight; }\n        else if (pos.bottom + node.offsetHeight <= vspace)\n          { top = pos.bottom; }\n        if (left + node.offsetWidth > hspace)\n          { left = hspace - node.offsetWidth; }\n      }\n      node.style.top = top + \"px\";\n      node.style.left = node.style.right = \"\";\n      if (horiz == \"right\") {\n        left = display.sizer.clientWidth - node.offsetWidth;\n        node.style.right = \"0px\";\n      } else {\n        if (horiz == \"left\") { left = 0; }\n        else if (horiz == \"middle\") { left = (display.sizer.clientWidth - node.offsetWidth) / 2; }\n        node.style.left = left + \"px\";\n      }\n      if (scroll)\n        { scrollIntoView(this, {left: left, top: top, right: left + node.offsetWidth, bottom: top + node.offsetHeight}); }\n    },\n\n    triggerOnKeyDown: methodOp(onKeyDown),\n    triggerOnKeyPress: methodOp(onKeyPress),\n    triggerOnKeyUp: onKeyUp,\n\n    execCommand: function(cmd) {\n      if (commands.hasOwnProperty(cmd))\n        { return commands[cmd].call(null, this) }\n    },\n\n    triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),\n\n    findPosH: function(from, amount, unit, visually) {\n      var this$1 = this;\n\n      var dir = 1;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      var cur = clipPos(this.doc, from);\n      for (var i = 0; i < amount; ++i) {\n        cur = findPosH(this$1.doc, cur, dir, unit, visually);\n        if (cur.hitSide) { break }\n      }\n      return cur\n    },\n\n    moveH: methodOp(function(dir, unit) {\n      var this$1 = this;\n\n      this.extendSelectionsBy(function (range$$1) {\n        if (this$1.display.shift || this$1.doc.extend || range$$1.empty())\n          { return findPosH(this$1.doc, range$$1.head, dir, unit, this$1.options.rtlMoveVisually) }\n        else\n          { return dir < 0 ? range$$1.from() : range$$1.to() }\n      }, sel_move);\n    }),\n\n    deleteH: methodOp(function(dir, unit) {\n      var sel = this.doc.sel, doc = this.doc;\n      if (sel.somethingSelected())\n        { doc.replaceSelection(\"\", null, \"+delete\"); }\n      else\n        { deleteNearSelection(this, function (range$$1) {\n          var other = findPosH(doc, range$$1.head, dir, unit, false);\n          return dir < 0 ? {from: other, to: range$$1.head} : {from: range$$1.head, to: other}\n        }); }\n    }),\n\n    findPosV: function(from, amount, unit, goalColumn) {\n      var this$1 = this;\n\n      var dir = 1, x = goalColumn;\n      if (amount < 0) { dir = -1; amount = -amount; }\n      var cur = clipPos(this.doc, from);\n      for (var i = 0; i < amount; ++i) {\n        var coords = cursorCoords(this$1, cur, \"div\");\n        if (x == null) { x = coords.left; }\n        else { coords.left = x; }\n        cur = findPosV(this$1, coords, dir, unit);\n        if (cur.hitSide) { break }\n      }\n      return cur\n    },\n\n    moveV: methodOp(function(dir, unit) {\n      var this$1 = this;\n\n      var doc = this.doc, goals = [];\n      var collapse = !this.display.shift && !doc.extend && doc.sel.somethingSelected();\n      doc.extendSelectionsBy(function (range$$1) {\n        if (collapse)\n          { return dir < 0 ? range$$1.from() : range$$1.to() }\n        var headPos = cursorCoords(this$1, range$$1.head, \"div\");\n        if (range$$1.goalColumn != null) { headPos.left = range$$1.goalColumn; }\n        goals.push(headPos.left);\n        var pos = findPosV(this$1, headPos, dir, unit);\n        if (unit == \"page\" && range$$1 == doc.sel.primary())\n          { addToScrollTop(this$1, charCoords(this$1, pos, \"div\").top - headPos.top); }\n        return pos\n      }, sel_move);\n      if (goals.length) { for (var i = 0; i < doc.sel.ranges.length; i++)\n        { doc.sel.ranges[i].goalColumn = goals[i]; } }\n    }),\n\n    // Find the word at the given position (as returned by coordsChar).\n    findWordAt: function(pos) {\n      var doc = this.doc, line = getLine(doc, pos.line).text;\n      var start = pos.ch, end = pos.ch;\n      if (line) {\n        var helper = this.getHelper(pos, \"wordChars\");\n        if ((pos.sticky == \"before\" || end == line.length) && start) { --start; } else { ++end; }\n        var startChar = line.charAt(start);\n        var check = isWordChar(startChar, helper)\n          ? function (ch) { return isWordChar(ch, helper); }\n          : /\\s/.test(startChar) ? function (ch) { return /\\s/.test(ch); }\n          : function (ch) { return (!/\\s/.test(ch) && !isWordChar(ch)); };\n        while (start > 0 && check(line.charAt(start - 1))) { --start; }\n        while (end < line.length && check(line.charAt(end))) { ++end; }\n      }\n      return new Range(Pos(pos.line, start), Pos(pos.line, end))\n    },\n\n    toggleOverwrite: function(value) {\n      if (value != null && value == this.state.overwrite) { return }\n      if (this.state.overwrite = !this.state.overwrite)\n        { addClass(this.display.cursorDiv, \"CodeMirror-overwrite\"); }\n      else\n        { rmClass(this.display.cursorDiv, \"CodeMirror-overwrite\"); }\n\n      signal(this, \"overwriteToggle\", this, this.state.overwrite);\n    },\n    hasFocus: function() { return this.display.input.getField() == activeElt() },\n    isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit) },\n\n    scrollTo: methodOp(function (x, y) { scrollToCoords(this, x, y); }),\n    getScrollInfo: function() {\n      var scroller = this.display.scroller;\n      return {left: scroller.scrollLeft, top: scroller.scrollTop,\n              height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,\n              width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,\n              clientHeight: displayHeight(this), clientWidth: displayWidth(this)}\n    },\n\n    scrollIntoView: methodOp(function(range$$1, margin) {\n      if (range$$1 == null) {\n        range$$1 = {from: this.doc.sel.primary().head, to: null};\n        if (margin == null) { margin = this.options.cursorScrollMargin; }\n      } else if (typeof range$$1 == \"number\") {\n        range$$1 = {from: Pos(range$$1, 0), to: null};\n      } else if (range$$1.from == null) {\n        range$$1 = {from: range$$1, to: null};\n      }\n      if (!range$$1.to) { range$$1.to = range$$1.from; }\n      range$$1.margin = margin || 0;\n\n      if (range$$1.from.line != null) {\n        scrollToRange(this, range$$1);\n      } else {\n        scrollToCoordsRange(this, range$$1.from, range$$1.to, range$$1.margin);\n      }\n    }),\n\n    setSize: methodOp(function(width, height) {\n      var this$1 = this;\n\n      var interpret = function (val) { return typeof val == \"number\" || /^\\d+$/.test(String(val)) ? val + \"px\" : val; };\n      if (width != null) { this.display.wrapper.style.width = interpret(width); }\n      if (height != null) { this.display.wrapper.style.height = interpret(height); }\n      if (this.options.lineWrapping) { clearLineMeasurementCache(this); }\n      var lineNo$$1 = this.display.viewFrom;\n      this.doc.iter(lineNo$$1, this.display.viewTo, function (line) {\n        if (line.widgets) { for (var i = 0; i < line.widgets.length; i++)\n          { if (line.widgets[i].noHScroll) { regLineChange(this$1, lineNo$$1, \"widget\"); break } } }\n        ++lineNo$$1;\n      });\n      this.curOp.forceUpdate = true;\n      signal(this, \"refresh\", this);\n    }),\n\n    operation: function(f){return runInOp(this, f)},\n\n    refresh: methodOp(function() {\n      var oldHeight = this.display.cachedTextHeight;\n      regChange(this);\n      this.curOp.forceUpdate = true;\n      clearCaches(this);\n      scrollToCoords(this, this.doc.scrollLeft, this.doc.scrollTop);\n      updateGutterSpace(this);\n      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)\n        { estimateLineHeights(this); }\n      signal(this, \"refresh\", this);\n    }),\n\n    swapDoc: methodOp(function(doc) {\n      var old = this.doc;\n      old.cm = null;\n      attachDoc(this, doc);\n      clearCaches(this);\n      this.display.input.reset();\n      scrollToCoords(this, doc.scrollLeft, doc.scrollTop);\n      this.curOp.forceScroll = true;\n      signalLater(this, \"swapDoc\", this, old);\n      return old\n    }),\n\n    getInputField: function(){return this.display.input.getField()},\n    getWrapperElement: function(){return this.display.wrapper},\n    getScrollerElement: function(){return this.display.scroller},\n    getGutterElement: function(){return this.display.gutters}\n  };\n  eventMixin(CodeMirror);\n\n  CodeMirror.registerHelper = function(type, name, value) {\n    if (!helpers.hasOwnProperty(type)) { helpers[type] = CodeMirror[type] = {_global: []}; }\n    helpers[type][name] = value;\n  };\n  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {\n    CodeMirror.registerHelper(type, name, value);\n    helpers[type]._global.push({pred: predicate, val: value});\n  };\n};\n\n// Used for horizontal relative motion. Dir is -1 or 1 (left or\n// right), unit can be \"char\", \"column\" (like char, but doesn't\n// cross line boundaries), \"word\" (across next word), or \"group\" (to\n// the start of next group of word or non-word-non-whitespace\n// chars). The visually param controls whether, in right-to-left\n// text, direction 1 means to move towards the next index in the\n// string, or towards the character to the right of the current\n// position. The resulting position will have a hitSide=true\n// property if it reached the end of the document.\nfunction findPosH(doc, pos, dir, unit, visually) {\n  var oldPos = pos;\n  var origDir = dir;\n  var lineObj = getLine(doc, pos.line);\n  function findNextLine() {\n    var l = pos.line + dir;\n    if (l < doc.first || l >= doc.first + doc.size) { return false }\n    pos = new Pos(l, pos.ch, pos.sticky);\n    return lineObj = getLine(doc, l)\n  }\n  function moveOnce(boundToLine) {\n    var next;\n    if (visually) {\n      next = moveVisually(doc.cm, lineObj, pos, dir);\n    } else {\n      next = moveLogically(lineObj, pos, dir);\n    }\n    if (next == null) {\n      if (!boundToLine && findNextLine())\n        { pos = endOfLine(visually, doc.cm, lineObj, pos.line, dir); }\n      else\n        { return false }\n    } else {\n      pos = next;\n    }\n    return true\n  }\n\n  if (unit == \"char\") {\n    moveOnce();\n  } else if (unit == \"column\") {\n    moveOnce(true);\n  } else if (unit == \"word\" || unit == \"group\") {\n    var sawType = null, group = unit == \"group\";\n    var helper = doc.cm && doc.cm.getHelper(pos, \"wordChars\");\n    for (var first = true;; first = false) {\n      if (dir < 0 && !moveOnce(!first)) { break }\n      var cur = lineObj.text.charAt(pos.ch) || \"\\n\";\n      var type = isWordChar(cur, helper) ? \"w\"\n        : group && cur == \"\\n\" ? \"n\"\n        : !group || /\\s/.test(cur) ? null\n        : \"p\";\n      if (group && !first && !type) { type = \"s\"; }\n      if (sawType && sawType != type) {\n        if (dir < 0) {dir = 1; moveOnce(); pos.sticky = \"after\";}\n        break\n      }\n\n      if (type) { sawType = type; }\n      if (dir > 0 && !moveOnce(!first)) { break }\n    }\n  }\n  var result = skipAtomic(doc, pos, oldPos, origDir, true);\n  if (equalCursorPos(oldPos, result)) { result.hitSide = true; }\n  return result\n}\n\n// For relative vertical movement. Dir may be -1 or 1. Unit can be\n// \"page\" or \"line\". The resulting position will have a hitSide=true\n// property if it reached the end of the document.\nfunction findPosV(cm, pos, dir, unit) {\n  var doc = cm.doc, x = pos.left, y;\n  if (unit == \"page\") {\n    var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);\n    var moveAmount = Math.max(pageSize - .5 * textHeight(cm.display), 3);\n    y = (dir > 0 ? pos.bottom : pos.top) + dir * moveAmount;\n\n  } else if (unit == \"line\") {\n    y = dir > 0 ? pos.bottom + 3 : pos.top - 3;\n  }\n  var target;\n  for (;;) {\n    target = coordsChar(cm, x, y);\n    if (!target.outside) { break }\n    if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break }\n    y += dir * 5;\n  }\n  return target\n}\n\n// CONTENTEDITABLE INPUT STYLE\n\nvar ContentEditableInput = function(cm) {\n  this.cm = cm;\n  this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;\n  this.polling = new Delayed();\n  this.composing = null;\n  this.gracePeriod = false;\n  this.readDOMTimeout = null;\n};\n\nContentEditableInput.prototype.init = function (display) {\n    var this$1 = this;\n\n  var input = this, cm = input.cm;\n  var div = input.div = display.lineDiv;\n  disableBrowserMagic(div, cm.options.spellcheck);\n\n  on(div, \"paste\", function (e) {\n    if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }\n    // IE doesn't fire input events, so we schedule a read for the pasted content in this way\n    if (ie_version <= 11) { setTimeout(operation(cm, function () { return this$1.updateFromDOM(); }), 20); }\n  });\n\n  on(div, \"compositionstart\", function (e) {\n    this$1.composing = {data: e.data, done: false};\n  });\n  on(div, \"compositionupdate\", function (e) {\n    if (!this$1.composing) { this$1.composing = {data: e.data, done: false}; }\n  });\n  on(div, \"compositionend\", function (e) {\n    if (this$1.composing) {\n      if (e.data != this$1.composing.data) { this$1.readFromDOMSoon(); }\n      this$1.composing.done = true;\n    }\n  });\n\n  on(div, \"touchstart\", function () { return input.forceCompositionEnd(); });\n\n  on(div, \"input\", function () {\n    if (!this$1.composing) { this$1.readFromDOMSoon(); }\n  });\n\n  function onCopyCut(e) {\n    if (signalDOMEvent(cm, e)) { return }\n    if (cm.somethingSelected()) {\n      setLastCopied({lineWise: false, text: cm.getSelections()});\n      if (e.type == \"cut\") { cm.replaceSelection(\"\", null, \"cut\"); }\n    } else if (!cm.options.lineWiseCopyCut) {\n      return\n    } else {\n      var ranges = copyableRanges(cm);\n      setLastCopied({lineWise: true, text: ranges.text});\n      if (e.type == \"cut\") {\n        cm.operation(function () {\n          cm.setSelections(ranges.ranges, 0, sel_dontScroll);\n          cm.replaceSelection(\"\", null, \"cut\");\n        });\n      }\n    }\n    if (e.clipboardData) {\n      e.clipboardData.clearData();\n      var content = lastCopied.text.join(\"\\n\");\n      // iOS exposes the clipboard API, but seems to discard content inserted into it\n      e.clipboardData.setData(\"Text\", content);\n      if (e.clipboardData.getData(\"Text\") == content) {\n        e.preventDefault();\n        return\n      }\n    }\n    // Old-fashioned briefly-focus-a-textarea hack\n    var kludge = hiddenTextarea(), te = kludge.firstChild;\n    cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);\n    te.value = lastCopied.text.join(\"\\n\");\n    var hadFocus = document.activeElement;\n    selectInput(te);\n    setTimeout(function () {\n      cm.display.lineSpace.removeChild(kludge);\n      hadFocus.focus();\n      if (hadFocus == div) { input.showPrimarySelection(); }\n    }, 50);\n  }\n  on(div, \"copy\", onCopyCut);\n  on(div, \"cut\", onCopyCut);\n};\n\nContentEditableInput.prototype.prepareSelection = function () {\n  var result = prepareSelection(this.cm, false);\n  result.focus = this.cm.state.focused;\n  return result\n};\n\nContentEditableInput.prototype.showSelection = function (info, takeFocus) {\n  if (!info || !this.cm.display.view.length) { return }\n  if (info.focus || takeFocus) { this.showPrimarySelection(); }\n  this.showMultipleSelections(info);\n};\n\nContentEditableInput.prototype.showPrimarySelection = function () {\n  var sel = window.getSelection(), cm = this.cm, prim = cm.doc.sel.primary();\n  var from = prim.from(), to = prim.to();\n\n  if (cm.display.viewTo == cm.display.viewFrom || from.line >= cm.display.viewTo || to.line < cm.display.viewFrom) {\n    sel.removeAllRanges();\n    return\n  }\n\n  var curAnchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\n  var curFocus = domToPos(cm, sel.focusNode, sel.focusOffset);\n  if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&\n      cmp(minPos(curAnchor, curFocus), from) == 0 &&\n      cmp(maxPos(curAnchor, curFocus), to) == 0)\n    { return }\n\n  var view = cm.display.view;\n  var start = (from.line >= cm.display.viewFrom && posToDOM(cm, from)) ||\n      {node: view[0].measure.map[2], offset: 0};\n  var end = to.line < cm.display.viewTo && posToDOM(cm, to);\n  if (!end) {\n    var measure = view[view.length - 1].measure;\n    var map$$1 = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;\n    end = {node: map$$1[map$$1.length - 1], offset: map$$1[map$$1.length - 2] - map$$1[map$$1.length - 3]};\n  }\n\n  if (!start || !end) {\n    sel.removeAllRanges();\n    return\n  }\n\n  var old = sel.rangeCount && sel.getRangeAt(0), rng;\n  try { rng = range(start.node, start.offset, end.offset, end.node); }\n  catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible\n  if (rng) {\n    if (!gecko && cm.state.focused) {\n      sel.collapse(start.node, start.offset);\n      if (!rng.collapsed) {\n        sel.removeAllRanges();\n        sel.addRange(rng);\n      }\n    } else {\n      sel.removeAllRanges();\n      sel.addRange(rng);\n    }\n    if (old && sel.anchorNode == null) { sel.addRange(old); }\n    else if (gecko) { this.startGracePeriod(); }\n  }\n  this.rememberSelection();\n};\n\nContentEditableInput.prototype.startGracePeriod = function () {\n    var this$1 = this;\n\n  clearTimeout(this.gracePeriod);\n  this.gracePeriod = setTimeout(function () {\n    this$1.gracePeriod = false;\n    if (this$1.selectionChanged())\n      { this$1.cm.operation(function () { return this$1.cm.curOp.selectionChanged = true; }); }\n  }, 20);\n};\n\nContentEditableInput.prototype.showMultipleSelections = function (info) {\n  removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);\n  removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);\n};\n\nContentEditableInput.prototype.rememberSelection = function () {\n  var sel = window.getSelection();\n  this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;\n  this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;\n};\n\nContentEditableInput.prototype.selectionInEditor = function () {\n  var sel = window.getSelection();\n  if (!sel.rangeCount) { return false }\n  var node = sel.getRangeAt(0).commonAncestorContainer;\n  return contains(this.div, node)\n};\n\nContentEditableInput.prototype.focus = function () {\n  if (this.cm.options.readOnly != \"nocursor\") {\n    if (!this.selectionInEditor())\n      { this.showSelection(this.prepareSelection(), true); }\n    this.div.focus();\n  }\n};\nContentEditableInput.prototype.blur = function () { this.div.blur(); };\nContentEditableInput.prototype.getField = function () { return this.div };\n\nContentEditableInput.prototype.supportsTouch = function () { return true };\n\nContentEditableInput.prototype.receivedFocus = function () {\n  var input = this;\n  if (this.selectionInEditor())\n    { this.pollSelection(); }\n  else\n    { runInOp(this.cm, function () { return input.cm.curOp.selectionChanged = true; }); }\n\n  function poll() {\n    if (input.cm.state.focused) {\n      input.pollSelection();\n      input.polling.set(input.cm.options.pollInterval, poll);\n    }\n  }\n  this.polling.set(this.cm.options.pollInterval, poll);\n};\n\nContentEditableInput.prototype.selectionChanged = function () {\n  var sel = window.getSelection();\n  return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||\n    sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset\n};\n\nContentEditableInput.prototype.pollSelection = function () {\n  if (this.readDOMTimeout != null || this.gracePeriod || !this.selectionChanged()) { return }\n  var sel = window.getSelection(), cm = this.cm;\n  // On Android Chrome (version 56, at least), backspacing into an\n  // uneditable block element will put the cursor in that element,\n  // and then, because it's not editable, hide the virtual keyboard.\n  // Because Android doesn't allow us to actually detect backspace\n  // presses in a sane way, this code checks for when that happens\n  // and simulates a backspace press in this case.\n  if (android && chrome && this.cm.options.gutters.length && isInGutter(sel.anchorNode)) {\n    this.cm.triggerOnKeyDown({type: \"keydown\", keyCode: 8, preventDefault: Math.abs});\n    this.blur();\n    this.focus();\n    return\n  }\n  if (this.composing) { return }\n  this.rememberSelection();\n  var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);\n  var head = domToPos(cm, sel.focusNode, sel.focusOffset);\n  if (anchor && head) { runInOp(cm, function () {\n    setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);\n    if (anchor.bad || head.bad) { cm.curOp.selectionChanged = true; }\n  }); }\n};\n\nContentEditableInput.prototype.pollContent = function () {\n  if (this.readDOMTimeout != null) {\n    clearTimeout(this.readDOMTimeout);\n    this.readDOMTimeout = null;\n  }\n\n  var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();\n  var from = sel.from(), to = sel.to();\n  if (from.ch == 0 && from.line > cm.firstLine())\n    { from = Pos(from.line - 1, getLine(cm.doc, from.line - 1).length); }\n  if (to.ch == getLine(cm.doc, to.line).text.length && to.line < cm.lastLine())\n    { to = Pos(to.line + 1, 0); }\n  if (from.line < display.viewFrom || to.line > display.viewTo - 1) { return false }\n\n  var fromIndex, fromLine, fromNode;\n  if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {\n    fromLine = lineNo(display.view[0].line);\n    fromNode = display.view[0].node;\n  } else {\n    fromLine = lineNo(display.view[fromIndex].line);\n    fromNode = display.view[fromIndex - 1].node.nextSibling;\n  }\n  var toIndex = findViewIndex(cm, to.line);\n  var toLine, toNode;\n  if (toIndex == display.view.length - 1) {\n    toLine = display.viewTo - 1;\n    toNode = display.lineDiv.lastChild;\n  } else {\n    toLine = lineNo(display.view[toIndex + 1].line) - 1;\n    toNode = display.view[toIndex + 1].node.previousSibling;\n  }\n\n  if (!fromNode) { return false }\n  var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));\n  var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));\n  while (newText.length > 1 && oldText.length > 1) {\n    if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }\n    else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }\n    else { break }\n  }\n\n  var cutFront = 0, cutEnd = 0;\n  var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);\n  while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))\n    { ++cutFront; }\n  var newBot = lst(newText), oldBot = lst(oldText);\n  var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),\n                           oldBot.length - (oldText.length == 1 ? cutFront : 0));\n  while (cutEnd < maxCutEnd &&\n         newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))\n    { ++cutEnd; }\n  // Try to move start of change to start of selection if ambiguous\n  if (newText.length == 1 && oldText.length == 1 && fromLine == from.line) {\n    while (cutFront && cutFront > from.ch &&\n           newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1)) {\n      cutFront--;\n      cutEnd++;\n    }\n  }\n\n  newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd).replace(/^\\u200b+/, \"\");\n  newText[0] = newText[0].slice(cutFront).replace(/\\u200b+$/, \"\");\n\n  var chFrom = Pos(fromLine, cutFront);\n  var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);\n  if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {\n    replaceRange(cm.doc, newText, chFrom, chTo, \"+input\");\n    return true\n  }\n};\n\nContentEditableInput.prototype.ensurePolled = function () {\n  this.forceCompositionEnd();\n};\nContentEditableInput.prototype.reset = function () {\n  this.forceCompositionEnd();\n};\nContentEditableInput.prototype.forceCompositionEnd = function () {\n  if (!this.composing) { return }\n  clearTimeout(this.readDOMTimeout);\n  this.composing = null;\n  this.updateFromDOM();\n  this.div.blur();\n  this.div.focus();\n};\nContentEditableInput.prototype.readFromDOMSoon = function () {\n    var this$1 = this;\n\n  if (this.readDOMTimeout != null) { return }\n  this.readDOMTimeout = setTimeout(function () {\n    this$1.readDOMTimeout = null;\n    if (this$1.composing) {\n      if (this$1.composing.done) { this$1.composing = null; }\n      else { return }\n    }\n    this$1.updateFromDOM();\n  }, 80);\n};\n\nContentEditableInput.prototype.updateFromDOM = function () {\n    var this$1 = this;\n\n  if (this.cm.isReadOnly() || !this.pollContent())\n    { runInOp(this.cm, function () { return regChange(this$1.cm); }); }\n};\n\nContentEditableInput.prototype.setUneditable = function (node) {\n  node.contentEditable = \"false\";\n};\n\nContentEditableInput.prototype.onKeyPress = function (e) {\n  if (e.charCode == 0) { return }\n  e.preventDefault();\n  if (!this.cm.isReadOnly())\n    { operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0); }\n};\n\nContentEditableInput.prototype.readOnlyChanged = function (val) {\n  this.div.contentEditable = String(val != \"nocursor\");\n};\n\nContentEditableInput.prototype.onContextMenu = function () {};\nContentEditableInput.prototype.resetPosition = function () {};\n\nContentEditableInput.prototype.needsContentAttribute = true;\n\nfunction posToDOM(cm, pos) {\n  var view = findViewForLine(cm, pos.line);\n  if (!view || view.hidden) { return null }\n  var line = getLine(cm.doc, pos.line);\n  var info = mapFromLineView(view, line, pos.line);\n\n  var order = getOrder(line, cm.doc.direction), side = \"left\";\n  if (order) {\n    var partPos = getBidiPartAt(order, pos.ch);\n    side = partPos % 2 ? \"right\" : \"left\";\n  }\n  var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);\n  result.offset = result.collapse == \"right\" ? result.end : result.start;\n  return result\n}\n\nfunction isInGutter(node) {\n  for (var scan = node; scan; scan = scan.parentNode)\n    { if (/CodeMirror-gutter-wrapper/.test(scan.className)) { return true } }\n  return false\n}\n\nfunction badPos(pos, bad) { if (bad) { pos.bad = true; } return pos }\n\nfunction domTextBetween(cm, from, to, fromLine, toLine) {\n  var text = \"\", closing = false, lineSep = cm.doc.lineSeparator();\n  function recognizeMarker(id) { return function (marker) { return marker.id == id; } }\n  function close() {\n    if (closing) {\n      text += lineSep;\n      closing = false;\n    }\n  }\n  function addText(str) {\n    if (str) {\n      close();\n      text += str;\n    }\n  }\n  function walk(node) {\n    if (node.nodeType == 1) {\n      var cmText = node.getAttribute(\"cm-text\");\n      if (cmText != null) {\n        addText(cmText || node.textContent.replace(/\\u200b/g, \"\"));\n        return\n      }\n      var markerID = node.getAttribute(\"cm-marker\"), range$$1;\n      if (markerID) {\n        var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));\n        if (found.length && (range$$1 = found[0].find()))\n          { addText(getBetween(cm.doc, range$$1.from, range$$1.to).join(lineSep)); }\n        return\n      }\n      if (node.getAttribute(\"contenteditable\") == \"false\") { return }\n      var isBlock = /^(pre|div|p)$/i.test(node.nodeName);\n      if (isBlock) { close(); }\n      for (var i = 0; i < node.childNodes.length; i++)\n        { walk(node.childNodes[i]); }\n      if (isBlock) { closing = true; }\n    } else if (node.nodeType == 3) {\n      addText(node.nodeValue);\n    }\n  }\n  for (;;) {\n    walk(from);\n    if (from == to) { break }\n    from = from.nextSibling;\n  }\n  return text\n}\n\nfunction domToPos(cm, node, offset) {\n  var lineNode;\n  if (node == cm.display.lineDiv) {\n    lineNode = cm.display.lineDiv.childNodes[offset];\n    if (!lineNode) { return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true) }\n    node = null; offset = 0;\n  } else {\n    for (lineNode = node;; lineNode = lineNode.parentNode) {\n      if (!lineNode || lineNode == cm.display.lineDiv) { return null }\n      if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) { break }\n    }\n  }\n  for (var i = 0; i < cm.display.view.length; i++) {\n    var lineView = cm.display.view[i];\n    if (lineView.node == lineNode)\n      { return locateNodeInLineView(lineView, node, offset) }\n  }\n}\n\nfunction locateNodeInLineView(lineView, node, offset) {\n  var wrapper = lineView.text.firstChild, bad = false;\n  if (!node || !contains(wrapper, node)) { return badPos(Pos(lineNo(lineView.line), 0), true) }\n  if (node == wrapper) {\n    bad = true;\n    node = wrapper.childNodes[offset];\n    offset = 0;\n    if (!node) {\n      var line = lineView.rest ? lst(lineView.rest) : lineView.line;\n      return badPos(Pos(lineNo(line), line.text.length), bad)\n    }\n  }\n\n  var textNode = node.nodeType == 3 ? node : null, topNode = node;\n  if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {\n    textNode = node.firstChild;\n    if (offset) { offset = textNode.nodeValue.length; }\n  }\n  while (topNode.parentNode != wrapper) { topNode = topNode.parentNode; }\n  var measure = lineView.measure, maps = measure.maps;\n\n  function find(textNode, topNode, offset) {\n    for (var i = -1; i < (maps ? maps.length : 0); i++) {\n      var map$$1 = i < 0 ? measure.map : maps[i];\n      for (var j = 0; j < map$$1.length; j += 3) {\n        var curNode = map$$1[j + 2];\n        if (curNode == textNode || curNode == topNode) {\n          var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);\n          var ch = map$$1[j] + offset;\n          if (offset < 0 || curNode != textNode) { ch = map$$1[j + (offset ? 1 : 0)]; }\n          return Pos(line, ch)\n        }\n      }\n    }\n  }\n  var found = find(textNode, topNode, offset);\n  if (found) { return badPos(found, bad) }\n\n  // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems\n  for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {\n    found = find(after, after.firstChild, 0);\n    if (found)\n      { return badPos(Pos(found.line, found.ch - dist), bad) }\n    else\n      { dist += after.textContent.length; }\n  }\n  for (var before = topNode.previousSibling, dist$1 = offset; before; before = before.previousSibling) {\n    found = find(before, before.firstChild, -1);\n    if (found)\n      { return badPos(Pos(found.line, found.ch + dist$1), bad) }\n    else\n      { dist$1 += before.textContent.length; }\n  }\n}\n\n// TEXTAREA INPUT STYLE\n\nvar TextareaInput = function(cm) {\n  this.cm = cm;\n  // See input.poll and input.reset\n  this.prevInput = \"\";\n\n  // Flag that indicates whether we expect input to appear real soon\n  // now (after some event like 'keypress' or 'input') and are\n  // polling intensively.\n  this.pollingFast = false;\n  // Self-resetting timeout for the poller\n  this.polling = new Delayed();\n  // Tracks when input.reset has punted to just putting a short\n  // string into the textarea instead of the full selection.\n  this.inaccurateSelection = false;\n  // Used to work around IE issue with selection being forgotten when focus moves away from textarea\n  this.hasSelection = false;\n  this.composing = null;\n};\n\nTextareaInput.prototype.init = function (display) {\n    var this$1 = this;\n\n  var input = this, cm = this.cm;\n\n  // Wraps and hides input textarea\n  var div = this.wrapper = hiddenTextarea();\n  // The semihidden textarea that is focused when the editor is\n  // focused, and receives input.\n  var te = this.textarea = div.firstChild;\n  display.wrapper.insertBefore(div, display.wrapper.firstChild);\n\n  // Needed to hide big blue blinking cursor on Mobile Safari (doesn't seem to work in iOS 8 anymore)\n  if (ios) { te.style.width = \"0px\"; }\n\n  on(te, \"input\", function () {\n    if (ie && ie_version >= 9 && this$1.hasSelection) { this$1.hasSelection = null; }\n    input.poll();\n  });\n\n  on(te, \"paste\", function (e) {\n    if (signalDOMEvent(cm, e) || handlePaste(e, cm)) { return }\n\n    cm.state.pasteIncoming = true;\n    input.fastPoll();\n  });\n\n  function prepareCopyCut(e) {\n    if (signalDOMEvent(cm, e)) { return }\n    if (cm.somethingSelected()) {\n      setLastCopied({lineWise: false, text: cm.getSelections()});\n      if (input.inaccurateSelection) {\n        input.prevInput = \"\";\n        input.inaccurateSelection = false;\n        te.value = lastCopied.text.join(\"\\n\");\n        selectInput(te);\n      }\n    } else if (!cm.options.lineWiseCopyCut) {\n      return\n    } else {\n      var ranges = copyableRanges(cm);\n      setLastCopied({lineWise: true, text: ranges.text});\n      if (e.type == \"cut\") {\n        cm.setSelections(ranges.ranges, null, sel_dontScroll);\n      } else {\n        input.prevInput = \"\";\n        te.value = ranges.text.join(\"\\n\");\n        selectInput(te);\n      }\n    }\n    if (e.type == \"cut\") { cm.state.cutIncoming = true; }\n  }\n  on(te, \"cut\", prepareCopyCut);\n  on(te, \"copy\", prepareCopyCut);\n\n  on(display.scroller, \"paste\", function (e) {\n    if (eventInWidget(display, e) || signalDOMEvent(cm, e)) { return }\n    cm.state.pasteIncoming = true;\n    input.focus();\n  });\n\n  // Prevent normal selection in the editor (we handle our own)\n  on(display.lineSpace, \"selectstart\", function (e) {\n    if (!eventInWidget(display, e)) { e_preventDefault(e); }\n  });\n\n  on(te, \"compositionstart\", function () {\n    var start = cm.getCursor(\"from\");\n    if (input.composing) { input.composing.range.clear(); }\n    input.composing = {\n      start: start,\n      range: cm.markText(start, cm.getCursor(\"to\"), {className: \"CodeMirror-composing\"})\n    };\n  });\n  on(te, \"compositionend\", function () {\n    if (input.composing) {\n      input.poll();\n      input.composing.range.clear();\n      input.composing = null;\n    }\n  });\n};\n\nTextareaInput.prototype.prepareSelection = function () {\n  // Redraw the selection and/or cursor\n  var cm = this.cm, display = cm.display, doc = cm.doc;\n  var result = prepareSelection(cm);\n\n  // Move the hidden textarea near the cursor to prevent scrolling artifacts\n  if (cm.options.moveInputWithCursor) {\n    var headPos = cursorCoords(cm, doc.sel.primary().head, \"div\");\n    var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();\n    result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,\n                                        headPos.top + lineOff.top - wrapOff.top));\n    result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,\n                                         headPos.left + lineOff.left - wrapOff.left));\n  }\n\n  return result\n};\n\nTextareaInput.prototype.showSelection = function (drawn) {\n  var cm = this.cm, display = cm.display;\n  removeChildrenAndAdd(display.cursorDiv, drawn.cursors);\n  removeChildrenAndAdd(display.selectionDiv, drawn.selection);\n  if (drawn.teTop != null) {\n    this.wrapper.style.top = drawn.teTop + \"px\";\n    this.wrapper.style.left = drawn.teLeft + \"px\";\n  }\n};\n\n// Reset the input to correspond to the selection (or to be empty,\n// when not typing and nothing is selected)\nTextareaInput.prototype.reset = function (typing) {\n  if (this.contextMenuPending || this.composing) { return }\n  var minimal, selected, cm = this.cm, doc = cm.doc;\n  if (cm.somethingSelected()) {\n    this.prevInput = \"\";\n    var range$$1 = doc.sel.primary();\n    minimal = hasCopyEvent &&\n      (range$$1.to().line - range$$1.from().line > 100 || (selected = cm.getSelection()).length > 1000);\n    var content = minimal ? \"-\" : selected || cm.getSelection();\n    this.textarea.value = content;\n    if (cm.state.focused) { selectInput(this.textarea); }\n    if (ie && ie_version >= 9) { this.hasSelection = content; }\n  } else if (!typing) {\n    this.prevInput = this.textarea.value = \"\";\n    if (ie && ie_version >= 9) { this.hasSelection = null; }\n  }\n  this.inaccurateSelection = minimal;\n};\n\nTextareaInput.prototype.getField = function () { return this.textarea };\n\nTextareaInput.prototype.supportsTouch = function () { return false };\n\nTextareaInput.prototype.focus = function () {\n  if (this.cm.options.readOnly != \"nocursor\" && (!mobile || activeElt() != this.textarea)) {\n    try { this.textarea.focus(); }\n    catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM\n  }\n};\n\nTextareaInput.prototype.blur = function () { this.textarea.blur(); };\n\nTextareaInput.prototype.resetPosition = function () {\n  this.wrapper.style.top = this.wrapper.style.left = 0;\n};\n\nTextareaInput.prototype.receivedFocus = function () { this.slowPoll(); };\n\n// Poll for input changes, using the normal rate of polling. This\n// runs as long as the editor is focused.\nTextareaInput.prototype.slowPoll = function () {\n    var this$1 = this;\n\n  if (this.pollingFast) { return }\n  this.polling.set(this.cm.options.pollInterval, function () {\n    this$1.poll();\n    if (this$1.cm.state.focused) { this$1.slowPoll(); }\n  });\n};\n\n// When an event has just come in that is likely to add or change\n// something in the input textarea, we poll faster, to ensure that\n// the change appears on the screen quickly.\nTextareaInput.prototype.fastPoll = function () {\n  var missed = false, input = this;\n  input.pollingFast = true;\n  function p() {\n    var changed = input.poll();\n    if (!changed && !missed) {missed = true; input.polling.set(60, p);}\n    else {input.pollingFast = false; input.slowPoll();}\n  }\n  input.polling.set(20, p);\n};\n\n// Read input from the textarea, and update the document to match.\n// When something is selected, it is present in the textarea, and\n// selected (unless it is huge, in which case a placeholder is\n// used). When nothing is selected, the cursor sits after previously\n// seen text (can be empty), which is stored in prevInput (we must\n// not reset the textarea when typing, because that breaks IME).\nTextareaInput.prototype.poll = function () {\n    var this$1 = this;\n\n  var cm = this.cm, input = this.textarea, prevInput = this.prevInput;\n  // Since this is called a *lot*, try to bail out as cheaply as\n  // possible when it is clear that nothing happened. hasSelection\n  // will be the case when there is a lot of text in the textarea,\n  // in which case reading its value would be expensive.\n  if (this.contextMenuPending || !cm.state.focused ||\n      (hasSelection(input) && !prevInput && !this.composing) ||\n      cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)\n    { return false }\n\n  var text = input.value;\n  // If nothing changed, bail.\n  if (text == prevInput && !cm.somethingSelected()) { return false }\n  // Work around nonsensical selection resetting in IE9/10, and\n  // inexplicable appearance of private area unicode characters on\n  // some key combos in Mac (#2689).\n  if (ie && ie_version >= 9 && this.hasSelection === text ||\n      mac && /[\\uf700-\\uf7ff]/.test(text)) {\n    cm.display.input.reset();\n    return false\n  }\n\n  if (cm.doc.sel == cm.display.selForContextMenu) {\n    var first = text.charCodeAt(0);\n    if (first == 0x200b && !prevInput) { prevInput = \"\\u200b\"; }\n    if (first == 0x21da) { this.reset(); return this.cm.execCommand(\"undo\") }\n  }\n  // Find the part of the input that is actually new\n  var same = 0, l = Math.min(prevInput.length, text.length);\n  while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) { ++same; }\n\n  runInOp(cm, function () {\n    applyTextInput(cm, text.slice(same), prevInput.length - same,\n                   null, this$1.composing ? \"*compose\" : null);\n\n    // Don't leave long text in the textarea, since it makes further polling slow\n    if (text.length > 1000 || text.indexOf(\"\\n\") > -1) { input.value = this$1.prevInput = \"\"; }\n    else { this$1.prevInput = text; }\n\n    if (this$1.composing) {\n      this$1.composing.range.clear();\n      this$1.composing.range = cm.markText(this$1.composing.start, cm.getCursor(\"to\"),\n                                         {className: \"CodeMirror-composing\"});\n    }\n  });\n  return true\n};\n\nTextareaInput.prototype.ensurePolled = function () {\n  if (this.pollingFast && this.poll()) { this.pollingFast = false; }\n};\n\nTextareaInput.prototype.onKeyPress = function () {\n  if (ie && ie_version >= 9) { this.hasSelection = null; }\n  this.fastPoll();\n};\n\nTextareaInput.prototype.onContextMenu = function (e) {\n  var input = this, cm = input.cm, display = cm.display, te = input.textarea;\n  var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;\n  if (!pos || presto) { return } // Opera is difficult.\n\n  // Reset the current text selection only if the click is done outside of the selection\n  // and 'resetSelectionOnContextMenu' option is true.\n  var reset = cm.options.resetSelectionOnContextMenu;\n  if (reset && cm.doc.sel.contains(pos) == -1)\n    { operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll); }\n\n  var oldCSS = te.style.cssText, oldWrapperCSS = input.wrapper.style.cssText;\n  input.wrapper.style.cssText = \"position: absolute\";\n  var wrapperBox = input.wrapper.getBoundingClientRect();\n  te.style.cssText = \"position: absolute; width: 30px; height: 30px;\\n      top: \" + (e.clientY - wrapperBox.top - 5) + \"px; left: \" + (e.clientX - wrapperBox.left - 5) + \"px;\\n      z-index: 1000; background: \" + (ie ? \"rgba(255, 255, 255, .05)\" : \"transparent\") + \";\\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);\";\n  var oldScrollY;\n  if (webkit) { oldScrollY = window.scrollY; } // Work around Chrome issue (#2712)\n  display.input.focus();\n  if (webkit) { window.scrollTo(null, oldScrollY); }\n  display.input.reset();\n  // Adds \"Select all\" to context menu in FF\n  if (!cm.somethingSelected()) { te.value = input.prevInput = \" \"; }\n  input.contextMenuPending = true;\n  display.selForContextMenu = cm.doc.sel;\n  clearTimeout(display.detectingSelectAll);\n\n  // Select-all will be greyed out if there's nothing to select, so\n  // this adds a zero-width space so that we can later check whether\n  // it got selected.\n  function prepareSelectAllHack() {\n    if (te.selectionStart != null) {\n      var selected = cm.somethingSelected();\n      var extval = \"\\u200b\" + (selected ? te.value : \"\");\n      te.value = \"\\u21da\"; // Used to catch context-menu undo\n      te.value = extval;\n      input.prevInput = selected ? \"\" : \"\\u200b\";\n      te.selectionStart = 1; te.selectionEnd = extval.length;\n      // Re-set this, in case some other handler touched the\n      // selection in the meantime.\n      display.selForContextMenu = cm.doc.sel;\n    }\n  }\n  function rehide() {\n    input.contextMenuPending = false;\n    input.wrapper.style.cssText = oldWrapperCSS;\n    te.style.cssText = oldCSS;\n    if (ie && ie_version < 9) { display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos); }\n\n    // Try to detect the user choosing select-all\n    if (te.selectionStart != null) {\n      if (!ie || (ie && ie_version < 9)) { prepareSelectAllHack(); }\n      var i = 0, poll = function () {\n        if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&\n            te.selectionEnd > 0 && input.prevInput == \"\\u200b\") {\n          operation(cm, selectAll)(cm);\n        } else if (i++ < 10) {\n          display.detectingSelectAll = setTimeout(poll, 500);\n        } else {\n          display.selForContextMenu = null;\n          display.input.reset();\n        }\n      };\n      display.detectingSelectAll = setTimeout(poll, 200);\n    }\n  }\n\n  if (ie && ie_version >= 9) { prepareSelectAllHack(); }\n  if (captureRightClick) {\n    e_stop(e);\n    var mouseup = function () {\n      off(window, \"mouseup\", mouseup);\n      setTimeout(rehide, 20);\n    };\n    on(window, \"mouseup\", mouseup);\n  } else {\n    setTimeout(rehide, 50);\n  }\n};\n\nTextareaInput.prototype.readOnlyChanged = function (val) {\n  if (!val) { this.reset(); }\n};\n\nTextareaInput.prototype.setUneditable = function () {};\n\nTextareaInput.prototype.needsContentAttribute = false;\n\nfunction fromTextArea(textarea, options) {\n  options = options ? copyObj(options) : {};\n  options.value = textarea.value;\n  if (!options.tabindex && textarea.tabIndex)\n    { options.tabindex = textarea.tabIndex; }\n  if (!options.placeholder && textarea.placeholder)\n    { options.placeholder = textarea.placeholder; }\n  // Set autofocus to true if this textarea is focused, or if it has\n  // autofocus and no other element is focused.\n  if (options.autofocus == null) {\n    var hasFocus = activeElt();\n    options.autofocus = hasFocus == textarea ||\n      textarea.getAttribute(\"autofocus\") != null && hasFocus == document.body;\n  }\n\n  function save() {textarea.value = cm.getValue();}\n\n  var realSubmit;\n  if (textarea.form) {\n    on(textarea.form, \"submit\", save);\n    // Deplorable hack to make the submit method do the right thing.\n    if (!options.leaveSubmitMethodAlone) {\n      var form = textarea.form;\n      realSubmit = form.submit;\n      try {\n        var wrappedSubmit = form.submit = function () {\n          save();\n          form.submit = realSubmit;\n          form.submit();\n          form.submit = wrappedSubmit;\n        };\n      } catch(e) {}\n    }\n  }\n\n  options.finishInit = function (cm) {\n    cm.save = save;\n    cm.getTextArea = function () { return textarea; };\n    cm.toTextArea = function () {\n      cm.toTextArea = isNaN; // Prevent this from being ran twice\n      save();\n      textarea.parentNode.removeChild(cm.getWrapperElement());\n      textarea.style.display = \"\";\n      if (textarea.form) {\n        off(textarea.form, \"submit\", save);\n        if (typeof textarea.form.submit == \"function\")\n          { textarea.form.submit = realSubmit; }\n      }\n    };\n  };\n\n  textarea.style.display = \"none\";\n  var cm = CodeMirror$1(function (node) { return textarea.parentNode.insertBefore(node, textarea.nextSibling); },\n    options);\n  return cm\n}\n\nfunction addLegacyProps(CodeMirror) {\n  CodeMirror.off = off;\n  CodeMirror.on = on;\n  CodeMirror.wheelEventPixels = wheelEventPixels;\n  CodeMirror.Doc = Doc;\n  CodeMirror.splitLines = splitLinesAuto;\n  CodeMirror.countColumn = countColumn;\n  CodeMirror.findColumn = findColumn;\n  CodeMirror.isWordChar = isWordCharBasic;\n  CodeMirror.Pass = Pass;\n  CodeMirror.signal = signal;\n  CodeMirror.Line = Line;\n  CodeMirror.changeEnd = changeEnd;\n  CodeMirror.scrollbarModel = scrollbarModel;\n  CodeMirror.Pos = Pos;\n  CodeMirror.cmpPos = cmp;\n  CodeMirror.modes = modes;\n  CodeMirror.mimeModes = mimeModes;\n  CodeMirror.resolveMode = resolveMode;\n  CodeMirror.getMode = getMode;\n  CodeMirror.modeExtensions = modeExtensions;\n  CodeMirror.extendMode = extendMode;\n  CodeMirror.copyState = copyState;\n  CodeMirror.startState = startState;\n  CodeMirror.innerMode = innerMode;\n  CodeMirror.commands = commands;\n  CodeMirror.keyMap = keyMap;\n  CodeMirror.keyName = keyName;\n  CodeMirror.isModifierKey = isModifierKey;\n  CodeMirror.lookupKey = lookupKey;\n  CodeMirror.normalizeKeyMap = normalizeKeyMap;\n  CodeMirror.StringStream = StringStream;\n  CodeMirror.SharedTextMarker = SharedTextMarker;\n  CodeMirror.TextMarker = TextMarker;\n  CodeMirror.LineWidget = LineWidget;\n  CodeMirror.e_preventDefault = e_preventDefault;\n  CodeMirror.e_stopPropagation = e_stopPropagation;\n  CodeMirror.e_stop = e_stop;\n  CodeMirror.addClass = addClass;\n  CodeMirror.contains = contains;\n  CodeMirror.rmClass = rmClass;\n  CodeMirror.keyNames = keyNames;\n}\n\n// EDITOR CONSTRUCTOR\n\ndefineOptions(CodeMirror$1);\n\naddEditorMethods(CodeMirror$1);\n\n// Set up methods on CodeMirror's prototype to redirect to the editor's document.\nvar dontDelegate = \"iter insert remove copy getEditor constructor\".split(\" \");\nfor (var prop in Doc.prototype) { if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)\n  { CodeMirror$1.prototype[prop] = (function(method) {\n    return function() {return method.apply(this.doc, arguments)}\n  })(Doc.prototype[prop]); } }\n\neventMixin(Doc);\n\n// INPUT HANDLING\n\nCodeMirror$1.inputStyles = {\"textarea\": TextareaInput, \"contenteditable\": ContentEditableInput};\n\n// MODE DEFINITION AND QUERYING\n\n// Extra arguments are stored as the mode's dependencies, which is\n// used by (legacy) mechanisms like loadmode.js to automatically\n// load a mode. (Preferred mechanism is the require/define calls.)\nCodeMirror$1.defineMode = function(name/*, mode, */) {\n  if (!CodeMirror$1.defaults.mode && name != \"null\") { CodeMirror$1.defaults.mode = name; }\n  defineMode.apply(this, arguments);\n};\n\nCodeMirror$1.defineMIME = defineMIME;\n\n// Minimal default mode.\nCodeMirror$1.defineMode(\"null\", function () { return ({token: function (stream) { return stream.skipToEnd(); }}); });\nCodeMirror$1.defineMIME(\"text/plain\", \"null\");\n\n// EXTENSIONS\n\nCodeMirror$1.defineExtension = function (name, func) {\n  CodeMirror$1.prototype[name] = func;\n};\nCodeMirror$1.defineDocExtension = function (name, func) {\n  Doc.prototype[name] = func;\n};\n\nCodeMirror$1.fromTextArea = fromTextArea;\n\naddLegacyProps(CodeMirror$1);\n\nCodeMirror$1.version = \"5.26.0\";\n\nreturn CodeMirror$1;\n\n})));\n","/**\n * Super simple wysiwyg editor v0.8.2\n * http://summernote.org/\n *\n * summernote.js\n * Copyright 2013-2016 Alan Hong. and other contributors\n * summernote may be freely distributed under the MIT license./\n *\n * Date: 2016-08-07T05:11Z\n */\n(function (factory) {\n  // Browser globals\n  factory(window.jQuery);\n}(function ($) {\n  'use strict';\n\n  /**\n   * @class core.func\n   *\n   * func utils (for high-order func's arg)\n   *\n   * @singleton\n   * @alternateClassName func\n   */\n  var func = (function () {\n    var eq = function (itemA) {\n      return function (itemB) {\n        return itemA === itemB;\n      };\n    };\n\n    var eq2 = function (itemA, itemB) {\n      return itemA === itemB;\n    };\n\n    var peq2 = function (propName) {\n      return function (itemA, itemB) {\n        return itemA[propName] === itemB[propName];\n      };\n    };\n\n    var ok = function () {\n      return true;\n    };\n\n    var fail = function () {\n      return false;\n    };\n\n    var not = function (f) {\n      return function () {\n        return !f.apply(f, arguments);\n      };\n    };\n\n    var and = function (fA, fB) {\n      return function (item) {\n        return fA(item) && fB(item);\n      };\n    };\n\n    var self = function (a) {\n      return a;\n    };\n\n    var invoke = function (obj, method) {\n      return function () {\n        return obj[method].apply(obj, arguments);\n      };\n    };\n\n    var idCounter = 0;\n\n    /**\n     * generate a globally-unique id\n     *\n     * @param {String} [prefix]\n     */\n    var uniqueId = function (prefix) {\n      var id = ++idCounter + '';\n      return prefix ? prefix + id : id;\n    };\n\n    /**\n     * returns bnd (bounds) from rect\n     *\n     * - IE Compatibility Issue: http://goo.gl/sRLOAo\n     * - Scroll Issue: http://goo.gl/sNjUc\n     *\n     * @param {Rect} rect\n     * @return {Object} bounds\n     * @return {Number} bounds.top\n     * @return {Number} bounds.left\n     * @return {Number} bounds.width\n     * @return {Number} bounds.height\n     */\n    var rect2bnd = function (rect) {\n      var $document = $(document);\n      return {\n        top: rect.top + $document.scrollTop(),\n        left: rect.left + $document.scrollLeft(),\n        width: rect.right - rect.left,\n        height: rect.bottom - rect.top\n      };\n    };\n\n    /**\n     * returns a copy of the object where the keys have become the values and the values the keys.\n     * @param {Object} obj\n     * @return {Object}\n     */\n    var invertObject = function (obj) {\n      var inverted = {};\n      for (var key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          inverted[obj[key]] = key;\n        }\n      }\n      return inverted;\n    };\n\n    /**\n     * @param {String} namespace\n     * @param {String} [prefix]\n     * @return {String}\n     */\n    var namespaceToCamel = function (namespace, prefix) {\n      prefix = prefix || '';\n      return prefix + namespace.split('.').map(function (name) {\n        return name.substring(0, 1).toUpperCase() + name.substring(1);\n      }).join('');\n    };\n\n    /**\n     * Returns a function, that, as long as it continues to be invoked, will not\n     * be triggered. The function will be called after it stops being called for\n     * N milliseconds. If `immediate` is passed, trigger the function on the\n     * leading edge, instead of the trailing.\n     * @param {Function} func\n     * @param {Number} wait\n     * @param {Boolean} immediate\n     * @return {Function}\n     */\n    var debounce = function (func, wait, immediate) {\n      var timeout;\n      return function () {\n        var context = this, args = arguments;\n        var later = function () {\n          timeout = null;\n          if (!immediate) {\n            func.apply(context, args);\n          }\n        };\n        var callNow = immediate && !timeout;\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n        if (callNow) {\n          func.apply(context, args);\n        }\n      };\n    };\n\n    return {\n      eq: eq,\n      eq2: eq2,\n      peq2: peq2,\n      ok: ok,\n      fail: fail,\n      self: self,\n      not: not,\n      and: and,\n      invoke: invoke,\n      uniqueId: uniqueId,\n      rect2bnd: rect2bnd,\n      invertObject: invertObject,\n      namespaceToCamel: namespaceToCamel,\n      debounce: debounce\n    };\n  })();\n\n  /**\n   * @class core.list\n   *\n   * list utils\n   *\n   * @singleton\n   * @alternateClassName list\n   */\n  var list = (function () {\n    /**\n     * returns the first item of an array.\n     *\n     * @param {Array} array\n     */\n    var head = function (array) {\n      return array[0];\n    };\n\n    /**\n     * returns the last item of an array.\n     *\n     * @param {Array} array\n     */\n    var last = function (array) {\n      return array[array.length - 1];\n    };\n\n    /**\n     * returns everything but the last entry of the array.\n     *\n     * @param {Array} array\n     */\n    var initial = function (array) {\n      return array.slice(0, array.length - 1);\n    };\n\n    /**\n     * returns the rest of the items in an array.\n     *\n     * @param {Array} array\n     */\n    var tail = function (array) {\n      return array.slice(1);\n    };\n\n    /**\n     * returns item of array\n     */\n    var find = function (array, pred) {\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        var item = array[idx];\n        if (pred(item)) {\n          return item;\n        }\n      }\n    };\n\n    /**\n     * returns true if all of the values in the array pass the predicate truth test.\n     */\n    var all = function (array, pred) {\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        if (!pred(array[idx])) {\n          return false;\n        }\n      }\n      return true;\n    };\n\n    /**\n     * returns index of item\n     */\n    var indexOf = function (array, item) {\n      return $.inArray(item, array);\n    };\n\n    /**\n     * returns true if the value is present in the list.\n     */\n    var contains = function (array, item) {\n      return indexOf(array, item) !== -1;\n    };\n\n    /**\n     * get sum from a list\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - iterator\n     */\n    var sum = function (array, fn) {\n      fn = fn || func.self;\n      return array.reduce(function (memo, v) {\n        return memo + fn(v);\n      }, 0);\n    };\n\n    /**\n     * returns a copy of the collection with array type.\n     * @param {Collection} collection - collection eg) node.childNodes, ...\n     */\n    var from = function (collection) {\n      var result = [], idx = -1, length = collection.length;\n      while (++idx < length) {\n        result[idx] = collection[idx];\n      }\n      return result;\n    };\n\n    /**\n     * returns whether list is empty or not\n     */\n    var isEmpty = function (array) {\n      return !array || !array.length;\n    };\n\n    /**\n     * cluster elements by predicate function.\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - predicate function for cluster rule\n     * @param {Array[]}\n     */\n    var clusterBy = function (array, fn) {\n      if (!array.length) { return []; }\n      var aTail = tail(array);\n      return aTail.reduce(function (memo, v) {\n        var aLast = last(memo);\n        if (fn(last(aLast), v)) {\n          aLast[aLast.length] = v;\n        } else {\n          memo[memo.length] = [v];\n        }\n        return memo;\n      }, [[head(array)]]);\n    };\n\n    /**\n     * returns a copy of the array with all false values removed\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - predicate function for cluster rule\n     */\n    var compact = function (array) {\n      var aResult = [];\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        if (array[idx]) { aResult.push(array[idx]); }\n      }\n      return aResult;\n    };\n\n    /**\n     * produces a duplicate-free version of the array\n     *\n     * @param {Array} array\n     */\n    var unique = function (array) {\n      var results = [];\n\n      for (var idx = 0, len = array.length; idx < len; idx ++) {\n        if (!contains(results, array[idx])) {\n          results.push(array[idx]);\n        }\n      }\n\n      return results;\n    };\n\n    /**\n     * returns next item.\n     * @param {Array} array\n     */\n    var next = function (array, item) {\n      var idx = indexOf(array, item);\n      if (idx === -1) { return null; }\n\n      return array[idx + 1];\n    };\n\n    /**\n     * returns prev item.\n     * @param {Array} array\n     */\n    var prev = function (array, item) {\n      var idx = indexOf(array, item);\n      if (idx === -1) { return null; }\n\n      return array[idx - 1];\n    };\n\n    return { head: head, last: last, initial: initial, tail: tail,\n             prev: prev, next: next, find: find, contains: contains,\n             all: all, sum: sum, from: from, isEmpty: isEmpty,\n             clusterBy: clusterBy, compact: compact, unique: unique };\n  })();\n\n  var isSupportAmd = typeof define === 'function' && define.amd;\n\n  /**\n   * returns whether font is installed or not.\n   *\n   * @param {String} fontName\n   * @return {Boolean}\n   */\n  var isFontInstalled = function (fontName) {\n    var testFontName = fontName === 'Comic Sans MS' ? 'Courier New' : 'Comic Sans MS';\n    var $tester = $('<div>').css({\n      position: 'absolute',\n      left: '-9999px',\n      top: '-9999px',\n      fontSize: '200px'\n    }).text('mmmmmmmmmwwwwwww').appendTo(document.body);\n\n    var originalWidth = $tester.css('fontFamily', testFontName).width();\n    var width = $tester.css('fontFamily', fontName + ',' + testFontName).width();\n\n    $tester.remove();\n\n    return originalWidth !== width;\n  };\n\n  var userAgent = navigator.userAgent;\n  var isMSIE = /MSIE|Trident/i.test(userAgent);\n  var browserVersion;\n  if (isMSIE) {\n    var matches = /MSIE (\\d+[.]\\d+)/.exec(userAgent);\n    if (matches) {\n      browserVersion = parseFloat(matches[1]);\n    }\n    matches = /Trident\\/.*rv:([0-9]{1,}[\\.0-9]{0,})/.exec(userAgent);\n    if (matches) {\n      browserVersion = parseFloat(matches[1]);\n    }\n  }\n\n  var isEdge = /Edge\\/\\d+/.test(userAgent);\n\n  var hasCodeMirror = !!window.CodeMirror;\n  if (!hasCodeMirror && isSupportAmd) {\n    require('codemirror');\n    hasCodeMirror = true;\n  }\n\n  /**\n   * @class core.agent\n   *\n   * Object which check platform and agent\n   *\n   * @singleton\n   * @alternateClassName agent\n   */\n  var agent = {\n    isMac: navigator.appVersion.indexOf('Mac') > -1,\n    isMSIE: isMSIE,\n    isEdge: isEdge,\n    isFF: !isEdge && /firefox/i.test(userAgent),\n    isPhantom: /PhantomJS/i.test(userAgent),\n    isWebkit: !isEdge && /webkit/i.test(userAgent),\n    isChrome: !isEdge && /chrome/i.test(userAgent),\n    isSafari: !isEdge && /safari/i.test(userAgent),\n    browserVersion: browserVersion,\n    jqueryVersion: parseFloat($.fn.jquery),\n    isSupportAmd: isSupportAmd,\n    hasCodeMirror: hasCodeMirror,\n    isFontInstalled: isFontInstalled,\n    isW3CRangeSupport: !!document.createRange\n  };\n\n\n  var NBSP_CHAR = String.fromCharCode(160);\n  var ZERO_WIDTH_NBSP_CHAR = '\\ufeff';\n\n  /**\n   * @class core.dom\n   *\n   * Dom functions\n   *\n   * @singleton\n   * @alternateClassName dom\n   */\n  var dom = (function () {\n    /**\n     * @method isEditable\n     *\n     * returns whether node is `note-editable` or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */\n    var isEditable = function (node) {\n      return node && $(node).hasClass('note-editable');\n    };\n\n    /**\n     * @method isControlSizing\n     *\n     * returns whether node is `note-control-sizing` or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */\n    var isControlSizing = function (node) {\n      return node && $(node).hasClass('note-control-sizing');\n    };\n\n    /**\n     * @method makePredByNodeName\n     *\n     * returns predicate which judge whether nodeName is same\n     *\n     * @param {String} nodeName\n     * @return {Function}\n     */\n    var makePredByNodeName = function (nodeName) {\n      nodeName = nodeName.toUpperCase();\n      return function (node) {\n        return node && node.nodeName.toUpperCase() === nodeName;\n      };\n    };\n\n    /**\n     * @method isText\n     *\n     *\n     *\n     * @param {Node} node\n     * @return {Boolean} true if node's type is text(3)\n     */\n    var isText = function (node) {\n      return node && node.nodeType === 3;\n    };\n\n    /**\n     * @method isElement\n     *\n     *\n     *\n     * @param {Node} node\n     * @return {Boolean} true if node's type is element(1)\n     */\n    var isElement = function (node) {\n      return node && node.nodeType === 1;\n    };\n\n    /**\n     * ex) br, col, embed, hr, img, input, ...\n     * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\n     */\n    var isVoid = function (node) {\n      return node && /^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase());\n    };\n\n    var isPara = function (node) {\n      if (isEditable(node)) {\n        return false;\n      }\n\n      // Chrome(v31.0), FF(v25.0.1) use DIV for paragraph\n      return node && /^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());\n    };\n\n    var isHeading = function (node) {\n      return node && /^H[1-7]/.test(node.nodeName.toUpperCase());\n    };\n\n    var isPre = makePredByNodeName('PRE');\n\n    var isLi = makePredByNodeName('LI');\n\n    var isPurePara = function (node) {\n      return isPara(node) && !isLi(node);\n    };\n\n    var isTable = makePredByNodeName('TABLE');\n\n    var isData = makePredByNodeName('DATA');\n\n    var isInline = function (node) {\n      return !isBodyContainer(node) &&\n             !isList(node) &&\n             !isHr(node) &&\n             !isPara(node) &&\n             !isTable(node) &&\n             !isBlockquote(node) &&\n             !isData(node);\n    };\n\n    var isList = function (node) {\n      return node && /^UL|^OL/.test(node.nodeName.toUpperCase());\n    };\n\n    var isHr = makePredByNodeName('HR');\n\n    var isCell = function (node) {\n      return node && /^TD|^TH/.test(node.nodeName.toUpperCase());\n    };\n\n    var isBlockquote = makePredByNodeName('BLOCKQUOTE');\n\n    var isBodyContainer = function (node) {\n      return isCell(node) || isBlockquote(node) || isEditable(node);\n    };\n\n    var isAnchor = makePredByNodeName('A');\n\n    var isParaInline = function (node) {\n      return isInline(node) && !!ancestor(node, isPara);\n    };\n\n    var isBodyInline = function (node) {\n      return isInline(node) && !ancestor(node, isPara);\n    };\n\n    var isBody = makePredByNodeName('BODY');\n\n    /**\n     * returns whether nodeB is closest sibling of nodeA\n     *\n     * @param {Node} nodeA\n     * @param {Node} nodeB\n     * @return {Boolean}\n     */\n    var isClosestSibling = function (nodeA, nodeB) {\n      return nodeA.nextSibling === nodeB ||\n             nodeA.previousSibling === nodeB;\n    };\n\n    /**\n     * returns array of closest siblings with node\n     *\n     * @param {Node} node\n     * @param {function} [pred] - predicate function\n     * @return {Node[]}\n     */\n    var withClosestSiblings = function (node, pred) {\n      pred = pred || func.ok;\n\n      var siblings = [];\n      if (node.previousSibling && pred(node.previousSibling)) {\n        siblings.push(node.previousSibling);\n      }\n      siblings.push(node);\n      if (node.nextSibling && pred(node.nextSibling)) {\n        siblings.push(node.nextSibling);\n      }\n      return siblings;\n    };\n\n    /**\n     * blank HTML for cursor position\n     * - [workaround] old IE only works with &nbsp;\n     * - [workaround] IE11 and other browser works with bogus br\n     */\n    var blankHTML = agent.isMSIE && agent.browserVersion < 11 ? '&nbsp;' : '<br>';\n\n    /**\n     * @method nodeLength\n     *\n     * returns #text's text size or element's childNodes size\n     *\n     * @param {Node} node\n     */\n    var nodeLength = function (node) {\n      if (isText(node)) {\n        return node.nodeValue.length;\n      }\n\n      if (node) {\n        return node.childNodes.length;\n      }\n\n      return 0;\n\n    };\n\n    /**\n     * returns whether node is empty or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */\n    var isEmpty = function (node) {\n      var len = nodeLength(node);\n\n      if (len === 0) {\n        return true;\n      } else if (!isText(node) && len === 1 && node.innerHTML === blankHTML) {\n        // ex) <p><br></p>, <span><br></span>\n        return true;\n      } else if (list.all(node.childNodes, isText) && node.innerHTML === '') {\n        // ex) <p></p>, <span></span>\n        return true;\n      }\n\n      return false;\n    };\n\n    /**\n     * padding blankHTML if node is empty (for cursor position)\n     */\n    var paddingBlankHTML = function (node) {\n      if (!isVoid(node) && !nodeLength(node)) {\n        node.innerHTML = blankHTML;\n      }\n    };\n\n    /**\n     * find nearest ancestor predicate hit\n     *\n     * @param {Node} node\n     * @param {Function} pred - predicate function\n     */\n    var ancestor = function (node, pred) {\n      while (node) {\n        if (pred(node)) { return node; }\n        if (isEditable(node)) { break; }\n\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    /**\n     * find nearest ancestor only single child blood line and predicate hit\n     *\n     * @param {Node} node\n     * @param {Function} pred - predicate function\n     */\n    var singleChildAncestor = function (node, pred) {\n      node = node.parentNode;\n\n      while (node) {\n        if (nodeLength(node) !== 1) { break; }\n        if (pred(node)) { return node; }\n        if (isEditable(node)) { break; }\n\n        node = node.parentNode;\n      }\n      return null;\n    };\n\n    /**\n     * returns new array of ancestor nodes (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [optional] pred - predicate function\n     */\n    var listAncestor = function (node, pred) {\n      pred = pred || func.fail;\n\n      var ancestors = [];\n      ancestor(node, function (el) {\n        if (!isEditable(el)) {\n          ancestors.push(el);\n        }\n\n        return pred(el);\n      });\n      return ancestors;\n    };\n\n    /**\n     * find farthest ancestor predicate hit\n     */\n    var lastAncestor = function (node, pred) {\n      var ancestors = listAncestor(node);\n      return list.last(ancestors.filter(pred));\n    };\n\n    /**\n     * returns common ancestor node between two nodes.\n     *\n     * @param {Node} nodeA\n     * @param {Node} nodeB\n     */\n    var commonAncestor = function (nodeA, nodeB) {\n      var ancestors = listAncestor(nodeA);\n      for (var n = nodeB; n; n = n.parentNode) {\n        if ($.inArray(n, ancestors) > -1) { return n; }\n      }\n      return null; // difference document area\n    };\n\n    /**\n     * listing all previous siblings (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [optional] pred - predicate function\n     */\n    var listPrev = function (node, pred) {\n      pred = pred || func.fail;\n\n      var nodes = [];\n      while (node) {\n        if (pred(node)) { break; }\n        nodes.push(node);\n        node = node.previousSibling;\n      }\n      return nodes;\n    };\n\n    /**\n     * listing next siblings (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [pred] - predicate function\n     */\n    var listNext = function (node, pred) {\n      pred = pred || func.fail;\n\n      var nodes = [];\n      while (node) {\n        if (pred(node)) { break; }\n        nodes.push(node);\n        node = node.nextSibling;\n      }\n      return nodes;\n    };\n\n    /**\n     * listing descendant nodes\n     *\n     * @param {Node} node\n     * @param {Function} [pred] - predicate function\n     */\n    var listDescendant = function (node, pred) {\n      var descendants = [];\n      pred = pred || func.ok;\n\n      // start DFS(depth first search) with node\n      (function fnWalk(current) {\n        if (node !== current && pred(current)) {\n          descendants.push(current);\n        }\n        for (var idx = 0, len = current.childNodes.length; idx < len; idx++) {\n          fnWalk(current.childNodes[idx]);\n        }\n      })(node);\n\n      return descendants;\n    };\n\n    /**\n     * wrap node with new tag.\n     *\n     * @param {Node} node\n     * @param {Node} tagName of wrapper\n     * @return {Node} - wrapper\n     */\n    var wrap = function (node, wrapperName) {\n      var parent = node.parentNode;\n      var wrapper = $('<' + wrapperName + '>')[0];\n\n      parent.insertBefore(wrapper, node);\n      wrapper.appendChild(node);\n\n      return wrapper;\n    };\n\n    /**\n     * insert node after preceding\n     *\n     * @param {Node} node\n     * @param {Node} preceding - predicate function\n     */\n    var insertAfter = function (node, preceding) {\n      var next = preceding.nextSibling, parent = preceding.parentNode;\n      if (next) {\n        parent.insertBefore(node, next);\n      } else {\n        parent.appendChild(node);\n      }\n      return node;\n    };\n\n    /**\n     * append elements.\n     *\n     * @param {Node} node\n     * @param {Collection} aChild\n     */\n    var appendChildNodes = function (node, aChild) {\n      $.each(aChild, function (idx, child) {\n        node.appendChild(child);\n      });\n      return node;\n    };\n\n    /**\n     * returns whether boundaryPoint is left edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isLeftEdgePoint = function (point) {\n      return point.offset === 0;\n    };\n\n    /**\n     * returns whether boundaryPoint is right edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isRightEdgePoint = function (point) {\n      return point.offset === nodeLength(point.node);\n    };\n\n    /**\n     * returns whether boundaryPoint is edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isEdgePoint = function (point) {\n      return isLeftEdgePoint(point) || isRightEdgePoint(point);\n    };\n\n    /**\n     * returns whether node is left edge of ancestor or not.\n     *\n     * @param {Node} node\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isLeftEdgeOf = function (node, ancestor) {\n      while (node && node !== ancestor) {\n        if (position(node) !== 0) {\n          return false;\n        }\n        node = node.parentNode;\n      }\n\n      return true;\n    };\n\n    /**\n     * returns whether node is right edge of ancestor or not.\n     *\n     * @param {Node} node\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isRightEdgeOf = function (node, ancestor) {\n      if (!ancestor) {\n        return false;\n      }\n      while (node && node !== ancestor) {\n        if (position(node) !== nodeLength(node.parentNode) - 1) {\n          return false;\n        }\n        node = node.parentNode;\n      }\n\n      return true;\n    };\n\n    /**\n     * returns whether point is left edge of ancestor or not.\n     * @param {BoundaryPoint} point\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isLeftEdgePointOf = function (point, ancestor) {\n      return isLeftEdgePoint(point) && isLeftEdgeOf(point.node, ancestor);\n    };\n\n    /**\n     * returns whether point is right edge of ancestor or not.\n     * @param {BoundaryPoint} point\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */\n    var isRightEdgePointOf = function (point, ancestor) {\n      return isRightEdgePoint(point) && isRightEdgeOf(point.node, ancestor);\n    };\n\n    /**\n     * returns offset from parent.\n     *\n     * @param {Node} node\n     */\n    var position = function (node) {\n      var offset = 0;\n      while ((node = node.previousSibling)) {\n        offset += 1;\n      }\n      return offset;\n    };\n\n    var hasChildren = function (node) {\n      return !!(node && node.childNodes && node.childNodes.length);\n    };\n\n    /**\n     * returns previous boundaryPoint\n     *\n     * @param {BoundaryPoint} point\n     * @param {Boolean} isSkipInnerOffset\n     * @return {BoundaryPoint}\n     */\n    var prevPoint = function (point, isSkipInnerOffset) {\n      var node, offset;\n\n      if (point.offset === 0) {\n        if (isEditable(point.node)) {\n          return null;\n        }\n\n        node = point.node.parentNode;\n        offset = position(point.node);\n      } else if (hasChildren(point.node)) {\n        node = point.node.childNodes[point.offset - 1];\n        offset = nodeLength(node);\n      } else {\n        node = point.node;\n        offset = isSkipInnerOffset ? 0 : point.offset - 1;\n      }\n\n      return {\n        node: node,\n        offset: offset\n      };\n    };\n\n    /**\n     * returns next boundaryPoint\n     *\n     * @param {BoundaryPoint} point\n     * @param {Boolean} isSkipInnerOffset\n     * @return {BoundaryPoint}\n     */\n    var nextPoint = function (point, isSkipInnerOffset) {\n      var node, offset;\n\n      if (nodeLength(point.node) === point.offset) {\n        if (isEditable(point.node)) {\n          return null;\n        }\n\n        node = point.node.parentNode;\n        offset = position(point.node) + 1;\n      } else if (hasChildren(point.node)) {\n        node = point.node.childNodes[point.offset];\n        offset = 0;\n      } else {\n        node = point.node;\n        offset = isSkipInnerOffset ? nodeLength(point.node) : point.offset + 1;\n      }\n\n      return {\n        node: node,\n        offset: offset\n      };\n    };\n\n    /**\n     * returns whether pointA and pointB is same or not.\n     *\n     * @param {BoundaryPoint} pointA\n     * @param {BoundaryPoint} pointB\n     * @return {Boolean}\n     */\n    var isSamePoint = function (pointA, pointB) {\n      return pointA.node === pointB.node && pointA.offset === pointB.offset;\n    };\n\n    /**\n     * returns whether point is visible (can set cursor) or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */\n    var isVisiblePoint = function (point) {\n      if (isText(point.node) || !hasChildren(point.node) || isEmpty(point.node)) {\n        return true;\n      }\n\n      var leftNode = point.node.childNodes[point.offset - 1];\n      var rightNode = point.node.childNodes[point.offset];\n      if ((!leftNode || isVoid(leftNode)) && (!rightNode || isVoid(rightNode))) {\n        return true;\n      }\n\n      return false;\n    };\n\n    /**\n     * @method prevPointUtil\n     *\n     * @param {BoundaryPoint} point\n     * @param {Function} pred\n     * @return {BoundaryPoint}\n     */\n    var prevPointUntil = function (point, pred) {\n      while (point) {\n        if (pred(point)) {\n          return point;\n        }\n\n        point = prevPoint(point);\n      }\n\n      return null;\n    };\n\n    /**\n     * @method nextPointUntil\n     *\n     * @param {BoundaryPoint} point\n     * @param {Function} pred\n     * @return {BoundaryPoint}\n     */\n    var nextPointUntil = function (point, pred) {\n      while (point) {\n        if (pred(point)) {\n          return point;\n        }\n\n        point = nextPoint(point);\n      }\n\n      return null;\n    };\n\n    /**\n     * returns whether point has character or not.\n     *\n     * @param {Point} point\n     * @return {Boolean}\n     */\n    var isCharPoint = function (point) {\n      if (!isText(point.node)) {\n        return false;\n      }\n\n      var ch = point.node.nodeValue.charAt(point.offset - 1);\n      return ch && (ch !== ' ' && ch !== NBSP_CHAR);\n    };\n\n    /**\n     * @method walkPoint\n     *\n     * @param {BoundaryPoint} startPoint\n     * @param {BoundaryPoint} endPoint\n     * @param {Function} handler\n     * @param {Boolean} isSkipInnerOffset\n     */\n    var walkPoint = function (startPoint, endPoint, handler, isSkipInnerOffset) {\n      var point = startPoint;\n\n      while (point) {\n        handler(point);\n\n        if (isSamePoint(point, endPoint)) {\n          break;\n        }\n\n        var isSkipOffset = isSkipInnerOffset &&\n                           startPoint.node !== point.node &&\n                           endPoint.node !== point.node;\n        point = nextPoint(point, isSkipOffset);\n      }\n    };\n\n    /**\n     * @method makeOffsetPath\n     *\n     * return offsetPath(array of offset) from ancestor\n     *\n     * @param {Node} ancestor - ancestor node\n     * @param {Node} node\n     */\n    var makeOffsetPath = function (ancestor, node) {\n      var ancestors = listAncestor(node, func.eq(ancestor));\n      return ancestors.map(position).reverse();\n    };\n\n    /**\n     * @method fromOffsetPath\n     *\n     * return element from offsetPath(array of offset)\n     *\n     * @param {Node} ancestor - ancestor node\n     * @param {array} offsets - offsetPath\n     */\n    var fromOffsetPath = function (ancestor, offsets) {\n      var current = ancestor;\n      for (var i = 0, len = offsets.length; i < len; i++) {\n        if (current.childNodes.length <= offsets[i]) {\n          current = current.childNodes[current.childNodes.length - 1];\n        } else {\n          current = current.childNodes[offsets[i]];\n        }\n      }\n      return current;\n    };\n\n    /**\n     * @method splitNode\n     *\n     * split element or #text\n     *\n     * @param {BoundaryPoint} point\n     * @param {Object} [options]\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n     * @return {Node} right node of boundaryPoint\n     */\n    var splitNode = function (point, options) {\n      var isSkipPaddingBlankHTML = options && options.isSkipPaddingBlankHTML;\n      var isNotSplitEdgePoint = options && options.isNotSplitEdgePoint;\n\n      // edge case\n      if (isEdgePoint(point) && (isText(point.node) || isNotSplitEdgePoint)) {\n        if (isLeftEdgePoint(point)) {\n          return point.node;\n        } else if (isRightEdgePoint(point)) {\n          return point.node.nextSibling;\n        }\n      }\n\n      // split #text\n      if (isText(point.node)) {\n        return point.node.splitText(point.offset);\n      } else {\n        var childNode = point.node.childNodes[point.offset];\n        var clone = insertAfter(point.node.cloneNode(false), point.node);\n        appendChildNodes(clone, listNext(childNode));\n\n        if (!isSkipPaddingBlankHTML) {\n          paddingBlankHTML(point.node);\n          paddingBlankHTML(clone);\n        }\n\n        return clone;\n      }\n    };\n\n    /**\n     * @method splitTree\n     *\n     * split tree by point\n     *\n     * @param {Node} root - split root\n     * @param {BoundaryPoint} point\n     * @param {Object} [options]\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n     * @return {Node} right node of boundaryPoint\n     */\n    var splitTree = function (root, point, options) {\n      // ex) [#text, <span>, <p>]\n      var ancestors = listAncestor(point.node, func.eq(root));\n\n      if (!ancestors.length) {\n        return null;\n      } else if (ancestors.length === 1) {\n        return splitNode(point, options);\n      }\n\n      return ancestors.reduce(function (node, parent) {\n        if (node === point.node) {\n          node = splitNode(point, options);\n        }\n\n        return splitNode({\n          node: parent,\n          offset: node ? dom.position(node) : nodeLength(parent)\n        }, options);\n      });\n    };\n\n    /**\n     * split point\n     *\n     * @param {Point} point\n     * @param {Boolean} isInline\n     * @return {Object}\n     */\n    var splitPoint = function (point, isInline) {\n      // find splitRoot, container\n      //  - inline: splitRoot is a child of paragraph\n      //  - block: splitRoot is a child of bodyContainer\n      var pred = isInline ? isPara : isBodyContainer;\n      var ancestors = listAncestor(point.node, pred);\n      var topAncestor = list.last(ancestors) || point.node;\n\n      var splitRoot, container;\n      if (pred(topAncestor)) {\n        splitRoot = ancestors[ancestors.length - 2];\n        container = topAncestor;\n      } else {\n        splitRoot = topAncestor;\n        container = splitRoot.parentNode;\n      }\n\n      // if splitRoot is exists, split with splitTree\n      var pivot = splitRoot && splitTree(splitRoot, point, {\n        isSkipPaddingBlankHTML: isInline,\n        isNotSplitEdgePoint: isInline\n      });\n\n      // if container is point.node, find pivot with point.offset\n      if (!pivot && container === point.node) {\n        pivot = point.node.childNodes[point.offset];\n      }\n\n      return {\n        rightNode: pivot,\n        container: container\n      };\n    };\n\n    var create = function (nodeName) {\n      return document.createElement(nodeName);\n    };\n\n    var createText = function (text) {\n      return document.createTextNode(text);\n    };\n\n    /**\n     * @method remove\n     *\n     * remove node, (isRemoveChild: remove child or not)\n     *\n     * @param {Node} node\n     * @param {Boolean} isRemoveChild\n     */\n    var remove = function (node, isRemoveChild) {\n      if (!node || !node.parentNode) { return; }\n      if (node.removeNode) { return node.removeNode(isRemoveChild); }\n\n      var parent = node.parentNode;\n      if (!isRemoveChild) {\n        var nodes = [];\n        var i, len;\n        for (i = 0, len = node.childNodes.length; i < len; i++) {\n          nodes.push(node.childNodes[i]);\n        }\n\n        for (i = 0, len = nodes.length; i < len; i++) {\n          parent.insertBefore(nodes[i], node);\n        }\n      }\n\n      parent.removeChild(node);\n    };\n\n    /**\n     * @method removeWhile\n     *\n     * @param {Node} node\n     * @param {Function} pred\n     */\n    var removeWhile = function (node, pred) {\n      while (node) {\n        if (isEditable(node) || !pred(node)) {\n          break;\n        }\n\n        var parent = node.parentNode;\n        remove(node);\n        node = parent;\n      }\n    };\n\n    /**\n     * @method replace\n     *\n     * replace node with provided nodeName\n     *\n     * @param {Node} node\n     * @param {String} nodeName\n     * @return {Node} - new node\n     */\n    var replace = function (node, nodeName) {\n      if (node.nodeName.toUpperCase() === nodeName.toUpperCase()) {\n        return node;\n      }\n\n      var newNode = create(nodeName);\n\n      if (node.style.cssText) {\n        newNode.style.cssText = node.style.cssText;\n      }\n\n      appendChildNodes(newNode, list.from(node.childNodes));\n      insertAfter(newNode, node);\n      remove(node);\n\n      return newNode;\n    };\n\n    var isTextarea = makePredByNodeName('TEXTAREA');\n\n    /**\n     * @param {jQuery} $node\n     * @param {Boolean} [stripLinebreaks] - default: false\n     */\n    var value = function ($node, stripLinebreaks) {\n      var val = isTextarea($node[0]) ? $node.val() : $node.html();\n      if (stripLinebreaks) {\n        return val.replace(/[\\n\\r]/g, '');\n      }\n      return val;\n    };\n\n    /**\n     * @method html\n     *\n     * get the HTML contents of node\n     *\n     * @param {jQuery} $node\n     * @param {Boolean} [isNewlineOnBlock]\n     */\n    var html = function ($node, isNewlineOnBlock) {\n      var markup = value($node);\n\n      if (isNewlineOnBlock) {\n        var regexTag = /<(\\/?)(\\b(?!!)[^>\\s]*)(.*?)(\\s*\\/?>)/g;\n        markup = markup.replace(regexTag, function (match, endSlash, name) {\n          name = name.toUpperCase();\n          var isEndOfInlineContainer = /^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name) &&\n                                       !!endSlash;\n          var isBlockNode = /^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);\n\n          return match + ((isEndOfInlineContainer || isBlockNode) ? '\\n' : '');\n        });\n        markup = $.trim(markup);\n      }\n\n      return markup;\n    };\n\n    var posFromPlaceholder = function (placeholder) {\n      var $placeholder = $(placeholder);\n      var pos = $placeholder.offset();\n      var height = $placeholder.outerHeight(true); // include margin\n\n      return {\n        left: pos.left,\n        top: pos.top + height\n      };\n    };\n\n    var attachEvents = function ($node, events) {\n      Object.keys(events).forEach(function (key) {\n        $node.on(key, events[key]);\n      });\n    };\n\n    var detachEvents = function ($node, events) {\n      Object.keys(events).forEach(function (key) {\n        $node.off(key, events[key]);\n      });\n    };\n\n    return {\n      /** @property {String} NBSP_CHAR */\n      NBSP_CHAR: NBSP_CHAR,\n      /** @property {String} ZERO_WIDTH_NBSP_CHAR */\n      ZERO_WIDTH_NBSP_CHAR: ZERO_WIDTH_NBSP_CHAR,\n      /** @property {String} blank */\n      blank: blankHTML,\n      /** @property {String} emptyPara */\n      emptyPara: '<p>' + blankHTML + '</p>',\n      makePredByNodeName: makePredByNodeName,\n      isEditable: isEditable,\n      isControlSizing: isControlSizing,\n      isText: isText,\n      isElement: isElement,\n      isVoid: isVoid,\n      isPara: isPara,\n      isPurePara: isPurePara,\n      isHeading: isHeading,\n      isInline: isInline,\n      isBlock: func.not(isInline),\n      isBodyInline: isBodyInline,\n      isBody: isBody,\n      isParaInline: isParaInline,\n      isPre: isPre,\n      isList: isList,\n      isTable: isTable,\n      isData: isData,\n      isCell: isCell,\n      isBlockquote: isBlockquote,\n      isBodyContainer: isBodyContainer,\n      isAnchor: isAnchor,\n      isDiv: makePredByNodeName('DIV'),\n      isLi: isLi,\n      isBR: makePredByNodeName('BR'),\n      isSpan: makePredByNodeName('SPAN'),\n      isB: makePredByNodeName('B'),\n      isU: makePredByNodeName('U'),\n      isS: makePredByNodeName('S'),\n      isI: makePredByNodeName('I'),\n      isImg: makePredByNodeName('IMG'),\n      isTextarea: isTextarea,\n      isEmpty: isEmpty,\n      isEmptyAnchor: func.and(isAnchor, isEmpty),\n      isClosestSibling: isClosestSibling,\n      withClosestSiblings: withClosestSiblings,\n      nodeLength: nodeLength,\n      isLeftEdgePoint: isLeftEdgePoint,\n      isRightEdgePoint: isRightEdgePoint,\n      isEdgePoint: isEdgePoint,\n      isLeftEdgeOf: isLeftEdgeOf,\n      isRightEdgeOf: isRightEdgeOf,\n      isLeftEdgePointOf: isLeftEdgePointOf,\n      isRightEdgePointOf: isRightEdgePointOf,\n      prevPoint: prevPoint,\n      nextPoint: nextPoint,\n      isSamePoint: isSamePoint,\n      isVisiblePoint: isVisiblePoint,\n      prevPointUntil: prevPointUntil,\n      nextPointUntil: nextPointUntil,\n      isCharPoint: isCharPoint,\n      walkPoint: walkPoint,\n      ancestor: ancestor,\n      singleChildAncestor: singleChildAncestor,\n      listAncestor: listAncestor,\n      lastAncestor: lastAncestor,\n      listNext: listNext,\n      listPrev: listPrev,\n      listDescendant: listDescendant,\n      commonAncestor: commonAncestor,\n      wrap: wrap,\n      insertAfter: insertAfter,\n      appendChildNodes: appendChildNodes,\n      position: position,\n      hasChildren: hasChildren,\n      makeOffsetPath: makeOffsetPath,\n      fromOffsetPath: fromOffsetPath,\n      splitTree: splitTree,\n      splitPoint: splitPoint,\n      create: create,\n      createText: createText,\n      remove: remove,\n      removeWhile: removeWhile,\n      replace: replace,\n      html: html,\n      value: value,\n      posFromPlaceholder: posFromPlaceholder,\n      attachEvents: attachEvents,\n      detachEvents: detachEvents\n    };\n  })();\n\n  /**\n   * @param {jQuery} $note\n   * @param {Object} options\n   * @return {Context}\n   */\n  var Context = function ($note, options) {\n    var self = this;\n\n    var ui = $.summernote.ui;\n    this.memos = {};\n    this.modules = {};\n    this.layoutInfo = {};\n    this.options = options;\n\n    /**\n     * create layout and initialize modules and other resources\n     */\n    this.initialize = function () {\n      this.layoutInfo = ui.createLayout($note, options);\n      this._initialize();\n      $note.hide();\n      return this;\n    };\n\n    /**\n     * destroy modules and other resources and remove layout\n     */\n    this.destroy = function () {\n      this._destroy();\n      $note.removeData('summernote');\n      ui.removeLayout($note, this.layoutInfo);\n    };\n\n    /**\n     * destory modules and other resources and initialize it again\n     */\n    this.reset = function () {\n      var disabled = self.isDisabled();\n      this.code(dom.emptyPara);\n      this._destroy();\n      this._initialize();\n\n      if (disabled) {\n        self.disable();\n      }\n    };\n\n    this._initialize = function () {\n      // add optional buttons\n      var buttons = $.extend({}, this.options.buttons);\n      Object.keys(buttons).forEach(function (key) {\n        self.memo('button.' + key, buttons[key]);\n      });\n\n      var modules = $.extend({}, this.options.modules, $.summernote.plugins || {});\n\n      // add and initialize modules\n      Object.keys(modules).forEach(function (key) {\n        self.module(key, modules[key], true);\n      });\n\n      Object.keys(this.modules).forEach(function (key) {\n        self.initializeModule(key);\n      });\n    };\n\n    this._destroy = function () {\n      // destroy modules with reversed order\n      Object.keys(this.modules).reverse().forEach(function (key) {\n        self.removeModule(key);\n      });\n\n      Object.keys(this.memos).forEach(function (key) {\n        self.removeMemo(key);\n      });\n    };\n\n    this.code = function (html) {\n      var isActivated = this.invoke('codeview.isActivated');\n\n      if (html === undefined) {\n        this.invoke('codeview.sync');\n        return isActivated ? this.layoutInfo.codable.val() : this.layoutInfo.editable.html();\n      } else {\n        if (isActivated) {\n          this.layoutInfo.codable.val(html);\n        } else {\n          this.layoutInfo.editable.html(html);\n        }\n        $note.val(html);\n        this.triggerEvent('change', html);\n      }\n    };\n\n    this.isDisabled = function () {\n      return this.layoutInfo.editable.attr('contenteditable') === 'false';\n    };\n\n    this.enable = function () {\n      this.layoutInfo.editable.attr('contenteditable', true);\n      this.invoke('toolbar.activate', true);\n    };\n\n    this.disable = function () {\n      // close codeview if codeview is opend\n      if (this.invoke('codeview.isActivated')) {\n        this.invoke('codeview.deactivate');\n      }\n      this.layoutInfo.editable.attr('contenteditable', false);\n      this.invoke('toolbar.deactivate', true);\n    };\n\n    this.triggerEvent = function () {\n      var namespace = list.head(arguments);\n      var args = list.tail(list.from(arguments));\n\n      var callback = this.options.callbacks[func.namespaceToCamel(namespace, 'on')];\n      if (callback) {\n        callback.apply($note[0], args);\n      }\n      $note.trigger('summernote.' + namespace, args);\n    };\n\n    this.initializeModule = function (key) {\n      var module = this.modules[key];\n      module.shouldInitialize = module.shouldInitialize || func.ok;\n      if (!module.shouldInitialize()) {\n        return;\n      }\n\n      // initialize module\n      if (module.initialize) {\n        module.initialize();\n      }\n\n      // attach events\n      if (module.events) {\n        dom.attachEvents($note, module.events);\n      }\n    };\n\n    this.module = function (key, ModuleClass, withoutIntialize) {\n      if (arguments.length === 1) {\n        return this.modules[key];\n      }\n\n      this.modules[key] = new ModuleClass(this);\n\n      if (!withoutIntialize) {\n        this.initializeModule(key);\n      }\n    };\n\n    this.removeModule = function (key) {\n      var module = this.modules[key];\n      if (module.shouldInitialize()) {\n        if (module.events) {\n          dom.detachEvents($note, module.events);\n        }\n\n        if (module.destroy) {\n          module.destroy();\n        }\n      }\n\n      delete this.modules[key];\n    };\n\n    this.memo = function (key, obj) {\n      if (arguments.length === 1) {\n        return this.memos[key];\n      }\n      this.memos[key] = obj;\n    };\n\n    this.removeMemo = function (key) {\n      if (this.memos[key] && this.memos[key].destroy) {\n        this.memos[key].destroy();\n      }\n\n      delete this.memos[key];\n    };\n\n    this.createInvokeHandler = function (namespace, value) {\n      return function (event) {\n        event.preventDefault();\n        self.invoke(namespace, value || $(event.target).closest('[data-value]').data('value'));\n      };\n    };\n\n    this.invoke = function () {\n      var namespace = list.head(arguments);\n      var args = list.tail(list.from(arguments));\n\n      var splits = namespace.split('.');\n      var hasSeparator = splits.length > 1;\n      var moduleName = hasSeparator && list.head(splits);\n      var methodName = hasSeparator ? list.last(splits) : list.head(splits);\n\n      var module = this.modules[moduleName || 'editor'];\n      if (!moduleName && this[methodName]) {\n        return this[methodName].apply(this, args);\n      } else if (module && module[methodName] && module.shouldInitialize()) {\n        return module[methodName].apply(module, args);\n      }\n    };\n\n    return this.initialize();\n  };\n\n  $.fn.extend({\n    /**\n     * Summernote API\n     *\n     * @param {Object|String}\n     * @return {this}\n     */\n    summernote: function () {\n      var type = $.type(list.head(arguments));\n      var isExternalAPICalled = type === 'string';\n      var hasInitOptions = type === 'object';\n\n      var options = hasInitOptions ? list.head(arguments) : {};\n\n      options = $.extend({}, $.summernote.options, options);\n      options.langInfo = $.extend(true, {}, $.summernote.lang['en-US'], $.summernote.lang[options.lang]);\n      options.icons = $.extend(true, {}, $.summernote.options.icons, options.icons);\n\n      this.each(function (idx, note) {\n        var $note = $(note);\n        if (!$note.data('summernote')) {\n          var context = new Context($note, options);\n          $note.data('summernote', context);\n          $note.data('summernote').triggerEvent('init', context.layoutInfo);\n        }\n      });\n\n      var $note = this.first();\n      if ($note.length) {\n        var context = $note.data('summernote');\n        if (isExternalAPICalled) {\n          return context.invoke.apply(context, list.from(arguments));\n        } else if (options.focus) {\n          context.invoke('editor.focus');\n        }\n      }\n\n      return this;\n    }\n  });\n\n\n  var Renderer = function (markup, children, options, callback) {\n    this.render = function ($parent) {\n      var $node = $(markup);\n\n      if (options && options.contents) {\n        $node.html(options.contents);\n      }\n\n      if (options && options.className) {\n        $node.addClass(options.className);\n      }\n\n      if (options && options.data) {\n        $.each(options.data, function (k, v) {\n          $node.attr('data-' + k, v);\n        });\n      }\n\n      if (options && options.click) {\n        $node.on('click', options.click);\n      }\n\n      if (children) {\n        var $container = $node.find('.note-children-container');\n        children.forEach(function (child) {\n          child.render($container.length ? $container : $node);\n        });\n      }\n\n      if (callback) {\n        callback($node, options);\n      }\n\n      if (options && options.callback) {\n        options.callback($node);\n      }\n\n      if ($parent) {\n        $parent.append($node);\n      }\n\n      return $node;\n    };\n  };\n\n  var renderer = {\n    create: function (markup, callback) {\n      return function () {\n        var children = $.isArray(arguments[0]) ? arguments[0] : [];\n        var options = typeof arguments[1] === 'object' ? arguments[1] : arguments[0];\n        if (options && options.children) {\n          children = options.children;\n        }\n        return new Renderer(markup, children, options, callback);\n      };\n    }\n  };\n\n  var editor = renderer.create('<div class=\"note-editor note-frame\"/>');\n  var toolbar = renderer.create('<div class=\"note-toolbar\"/>');\n  var editingArea = renderer.create('<div class=\"note-editing-area\"/>');\n  var codable = renderer.create('<textarea class=\"note-codable\"/>');\n  var editable = renderer.create('<div class=\"note-editable\" contentEditable=\"true\"/>');\n  var statusbar = renderer.create([\n    '<div class=\"note-statusbar\">',\n    '  <div class=\"note-resizebar\">',\n    '    <div class=\"note-icon-bar\"/>',\n    '    <div class=\"note-icon-bar\"/>',\n    '    <div class=\"note-icon-bar\"/>',\n    '  </div>',\n    '</div>'\n  ].join(''));\n\n  var airEditor = renderer.create('<div class=\"note-editor\"/>');\n  var airEditable = renderer.create('<div class=\"note-editable\" contentEditable=\"true\"/>');\n\n  var buttonGroup = renderer.create('<div class=\"note-btn-group btn-group\">');\n  var button = renderer.create('<button type=\"button\" class=\"note-btn btn -dark btn-sm\" tabindex=\"-1\">', function ($node, options) {\n    if (options && options.tooltip) {\n      $node.attr({\n        title: options.tooltip\n      }).tooltip({\n        container: 'body',\n        trigger: 'hover',\n        placement: 'bottom'\n      });\n    }\n  });\n\n  var dropdown = renderer.create('<div class=\"dropdown-menu -dark\">', function ($node, options) {\n    var markup = $.isArray(options.items) ? options.items.map(function (item) {\n      var value = (typeof item === 'string') ? item : (item.value || '');\n      var content = options.template ? options.template(item) : item;\n      return '<li><a href=\"#\" data-value=\"' + value + '\">' + content + '</a></li>';\n    }).join('') : options.items;\n\n    $node.html(markup);\n  });\n\n  var dropdownCheck = renderer.create('<div class=\"dropdown-menu -dark note-check\">', function ($node, options) {\n    var markup = $.isArray(options.items) ? options.items.map(function (item) {\n      var value = (typeof item === 'string') ? item : (item.value || '');\n      var content = options.template ? options.template(item) : item;\n      return '<li><a href=\"#\" data-value=\"' + value + '\">' + icon(options.checkClassName) + ' ' + content + '</a></li>';\n    }).join('') : options.items;\n    $node.html(markup);\n  });\n\n  var palette = renderer.create('<div class=\"note-color-palette\"/>', function ($node, options) {\n    var contents = [];\n    for (var row = 0, rowSize = options.colors.length; row < rowSize; row++) {\n      var eventName = options.eventName;\n      var colors = options.colors[row];\n      var buttons = [];\n      for (var col = 0, colSize = colors.length; col < colSize; col++) {\n        var color = colors[col];\n        buttons.push([\n          '<button type=\"button\" class=\"note-color-btn\"',\n          'style=\"background-color:', color, '\" ',\n          'data-event=\"', eventName, '\" ',\n          'data-value=\"', color, '\" ',\n          'title=\"', color, '\" ',\n          'data-toggle=\"button\" tabindex=\"-1\"></button>'\n        ].join(''));\n      }\n      contents.push('<div class=\"note-color-row\">' + buttons.join('') + '</div>');\n    }\n    $node.html(contents.join(''));\n\n    $node.find('.note-color-btn').tooltip({\n      container: 'body',\n      trigger: 'hover',\n      placement: 'bottom'\n    });\n  });\n\n  var dialog = renderer.create('<div class=\"modal -primary\" aria-hidden=\"false\" tabindex=\"-1\"/>', function ($node, options) {\n    if (options.fade) {\n      $node.addClass('fade');\n    }\n    $node.html([\n      '<div class=\"modal-dialog\">',\n      '  <div class=\"modal-content\">',\n      (options.title ?\n      '    <div class=\"modal-header\">' +\n      '      <button type=\"button\" class=\"close _text-white\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>' +\n      '      <h4 class=\"modal-title\">' + options.title + '</h4>' +\n      '    </div>' : ''\n      ),\n      '    <div class=\"modal-body\">' + options.body + '</div>',\n      (options.footer ?\n      '    <div class=\"modal-footer\">' + options.footer + '</div>' : ''\n      ),\n      '  </div>',\n      '</div>'\n    ].join(''));\n  });\n\n  var popover = renderer.create([\n    '<div class=\"note-popover popover in\">',\n    '  <div class=\"arrow\"/>',\n    '  <div class=\"popover-content note-children-container\"/>',\n    '</div>'\n  ].join(''), function ($node, options) {\n    var direction = typeof options.direction !== 'undefined' ? options.direction : 'bottom';\n\n    $node.addClass(direction);\n\n    if (options.hideArrow) {\n      $node.find('.arrow').hide();\n    }\n  });\n\n  var icon = function (iconClassName, tagName) {\n    tagName = tagName || 'i';\n    return '<' + tagName + ' class=\"' + iconClassName + '\"/>';\n  };\n\n  var ui = {\n    editor: editor,\n    toolbar: toolbar,\n    editingArea: editingArea,\n    codable: codable,\n    editable: editable,\n    statusbar: statusbar,\n    airEditor: airEditor,\n    airEditable: airEditable,\n    buttonGroup: buttonGroup,\n    button: button,\n    dropdown: dropdown,\n    dropdownCheck: dropdownCheck,\n    palette: palette,\n    dialog: dialog,\n    popover: popover,\n    icon: icon,\n\n    toggleBtn: function ($btn, isEnable) {\n      $btn.toggleClass('disabled', !isEnable);\n      $btn.attr('disabled', !isEnable);\n    },\n\n    toggleBtnActive: function ($btn, isActive) {\n      $btn.toggleClass('active', isActive);\n    },\n\n    onDialogShown: function ($dialog, handler) {\n      $dialog.one('shown.bs.modal', handler);\n    },\n\n    onDialogHidden: function ($dialog, handler) {\n      $dialog.one('hidden.bs.modal', handler);\n    },\n\n    showDialog: function ($dialog) {\n      $dialog.modal('show');\n    },\n\n    hideDialog: function ($dialog) {\n      $dialog.modal('hide');\n    },\n\n    createLayout: function ($note, options) {\n      var $editor = (options.airMode ? ui.airEditor([\n        ui.editingArea([\n          ui.airEditable()\n        ])\n      ]) : ui.editor([\n        ui.toolbar(),\n        ui.editingArea([\n          ui.codable(),\n          ui.editable()\n        ]),\n        ui.statusbar()\n      ])).render();\n\n      $editor.insertAfter($note);\n\n      return {\n        note: $note,\n        editor: $editor,\n        toolbar: $editor.find('.note-toolbar'),\n        editingArea: $editor.find('.note-editing-area'),\n        editable: $editor.find('.note-editable'),\n        codable: $editor.find('.note-codable'),\n        statusbar: $editor.find('.note-statusbar')\n      };\n    },\n\n    removeLayout: function ($note, layoutInfo) {\n      $note.html(layoutInfo.editable.html());\n      layoutInfo.editor.remove();\n      $note.show();\n    }\n  };\n\n  $.summernote = $.summernote || {\n    lang: {}\n  };\n\n  $.extend($.summernote.lang, {\n    'en-US': {\n      font: {\n        bold: 'Bold',\n        italic: 'Italic',\n        underline: 'Underline',\n        clear: 'Remove Font Style',\n        height: 'Line Height',\n        name: 'Font Family',\n        strikethrough: 'Strikethrough',\n        subscript: 'Subscript',\n        superscript: 'Superscript',\n        size: 'Font Size'\n      },\n      image: {\n        image: 'Picture',\n        insert: 'Insert Image',\n        resizeFull: 'Resize Full',\n        resizeHalf: 'Resize Half',\n        resizeQuarter: 'Resize Quarter',\n        floatLeft: 'Float Left',\n        floatRight: 'Float Right',\n        floatNone: 'Float None',\n        shapeRounded: 'Shape: Rounded',\n        shapeCircle: 'Shape: Circle',\n        shapeThumbnail: 'Shape: Thumbnail',\n        shapeNone: 'Shape: None',\n        dragImageHere: 'Drag image or text here',\n        dropImage: 'Drop image or Text',\n        selectFromFiles: 'Select from files',\n        maximumFileSize: 'Maximum file size',\n        maximumFileSizeError: 'Maximum file size exceeded.',\n        url: 'Image URL',\n        remove: 'Remove Image'\n      },\n      video: {\n        video: 'Video',\n        videoLink: 'Video Link',\n        insert: 'Insert Video',\n        url: 'Video URL?',\n        providers: '(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)'\n      },\n      link: {\n        link: 'Link',\n        insert: 'Insert Link',\n        unlink: 'Unlink',\n        edit: 'Edit',\n        textToDisplay: 'Text to display',\n        url: 'To what URL should this link go?',\n        openInNewWindow: 'Open in new window'\n      },\n      table: {\n        table: 'Table'\n      },\n      hr: {\n        insert: 'Insert Horizontal Rule'\n      },\n      style: {\n        style: 'Style',\n        normal: 'Normal',\n        blockquote: 'Quote',\n        pre: 'Code',\n        h1: 'Header 1',\n        h2: 'Header 2',\n        h3: 'Header 3',\n        h4: 'Header 4',\n        h5: 'Header 5',\n        h6: 'Header 6'\n      },\n      lists: {\n        unordered: 'Unordered list',\n        ordered: 'Ordered list'\n      },\n      options: {\n        help: 'Help',\n        fullscreen: 'Full Screen',\n        codeview: 'Code View'\n      },\n      paragraph: {\n        paragraph: 'Paragraph',\n        outdent: 'Outdent',\n        indent: 'Indent',\n        left: 'Align left',\n        center: 'Align center',\n        right: 'Align right',\n        justify: 'Justify full'\n      },\n      color: {\n        recent: 'Recent Color',\n        more: 'More Color',\n        background: 'Background Color',\n        foreground: 'Foreground Color',\n        transparent: 'Transparent',\n        setTransparent: 'Set transparent',\n        reset: 'Reset',\n        resetToDefault: 'Reset to default'\n      },\n      shortcut: {\n        shortcuts: 'Keyboard shortcuts',\n        close: 'Close',\n        textFormatting: 'Text formatting',\n        action: 'Action',\n        paragraphFormatting: 'Paragraph formatting',\n        documentStyle: 'Document Style',\n        extraKeys: 'Extra keys'\n      },\n      help: {\n        'insertParagraph': 'Insert Paragraph',\n        'undo': 'Undoes the last command',\n        'redo': 'Redoes the last command',\n        'tab': 'Tab',\n        'untab': 'Untab',\n        'bold': 'Set a bold style',\n        'italic': 'Set a italic style',\n        'underline': 'Set a underline style',\n        'strikethrough': 'Set a strikethrough style',\n        'removeFormat': 'Clean a style',\n        'justifyLeft': 'Set left align',\n        'justifyCenter': 'Set center align',\n        'justifyRight': 'Set right align',\n        'justifyFull': 'Set full align',\n        'insertUnorderedList': 'Toggle unordered list',\n        'insertOrderedList': 'Toggle ordered list',\n        'outdent': 'Outdent on current paragraph',\n        'indent': 'Indent on current paragraph',\n        'formatPara': 'Change current block\\'s format as a paragraph(P tag)',\n        'formatH1': 'Change current block\\'s format as H1',\n        'formatH2': 'Change current block\\'s format as H2',\n        'formatH3': 'Change current block\\'s format as H3',\n        'formatH4': 'Change current block\\'s format as H4',\n        'formatH5': 'Change current block\\'s format as H5',\n        'formatH6': 'Change current block\\'s format as H6',\n        'insertHorizontalRule': 'Insert horizontal rule',\n        'linkDialog.show': 'Show Link Dialog'\n      },\n      history: {\n        undo: 'Undo',\n        redo: 'Redo'\n      },\n      specialChar: {\n        specialChar: 'SPECIAL CHARACTERS',\n        select: 'Select Special characters'\n      }\n    }\n  });\n\n\n  /**\n   * @class core.key\n   *\n   * Object for keycodes.\n   *\n   * @singleton\n   * @alternateClassName key\n   */\n  var key = (function () {\n    var keyMap = {\n      'BACKSPACE': 8,\n      'TAB': 9,\n      'ENTER': 13,\n      'SPACE': 32,\n\n      // Arrow\n      'LEFT': 37,\n      'UP': 38,\n      'RIGHT': 39,\n      'DOWN': 40,\n\n      // Number: 0-9\n      'NUM0': 48,\n      'NUM1': 49,\n      'NUM2': 50,\n      'NUM3': 51,\n      'NUM4': 52,\n      'NUM5': 53,\n      'NUM6': 54,\n      'NUM7': 55,\n      'NUM8': 56,\n\n      // Alphabet: a-z\n      'B': 66,\n      'E': 69,\n      'I': 73,\n      'J': 74,\n      'K': 75,\n      'L': 76,\n      'R': 82,\n      'S': 83,\n      'U': 85,\n      'V': 86,\n      'Y': 89,\n      'Z': 90,\n\n      'SLASH': 191,\n      'LEFTBRACKET': 219,\n      'BACKSLASH': 220,\n      'RIGHTBRACKET': 221\n    };\n\n    return {\n      /**\n       * @method isEdit\n       *\n       * @param {Number} keyCode\n       * @return {Boolean}\n       */\n      isEdit: function (keyCode) {\n        return list.contains([\n          keyMap.BACKSPACE,\n          keyMap.TAB,\n          keyMap.ENTER,\n          keyMap.SPACE\n        ], keyCode);\n      },\n      /**\n       * @method isMove\n       *\n       * @param {Number} keyCode\n       * @return {Boolean}\n       */\n      isMove: function (keyCode) {\n        return list.contains([\n          keyMap.LEFT,\n          keyMap.UP,\n          keyMap.RIGHT,\n          keyMap.DOWN\n        ], keyCode);\n      },\n      /**\n       * @property {Object} nameFromCode\n       * @property {String} nameFromCode.8 \"BACKSPACE\"\n       */\n      nameFromCode: func.invertObject(keyMap),\n      code: keyMap\n    };\n  })();\n\n  var range = (function () {\n\n    /**\n     * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js\n     *\n     * @param {TextRange} textRange\n     * @param {Boolean} isStart\n     * @return {BoundaryPoint}\n     *\n     * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx\n     */\n    var textRangeToPoint = function (textRange, isStart) {\n      var container = textRange.parentElement(), offset;\n\n      var tester = document.body.createTextRange(), prevContainer;\n      var childNodes = list.from(container.childNodes);\n      for (offset = 0; offset < childNodes.length; offset++) {\n        if (dom.isText(childNodes[offset])) {\n          continue;\n        }\n        tester.moveToElementText(childNodes[offset]);\n        if (tester.compareEndPoints('StartToStart', textRange) >= 0) {\n          break;\n        }\n        prevContainer = childNodes[offset];\n      }\n\n      if (offset !== 0 && dom.isText(childNodes[offset - 1])) {\n        var textRangeStart = document.body.createTextRange(), curTextNode = null;\n        textRangeStart.moveToElementText(prevContainer || container);\n        textRangeStart.collapse(!prevContainer);\n        curTextNode = prevContainer ? prevContainer.nextSibling : container.firstChild;\n\n        var pointTester = textRange.duplicate();\n        pointTester.setEndPoint('StartToStart', textRangeStart);\n        var textCount = pointTester.text.replace(/[\\r\\n]/g, '').length;\n\n        while (textCount > curTextNode.nodeValue.length && curTextNode.nextSibling) {\n          textCount -= curTextNode.nodeValue.length;\n          curTextNode = curTextNode.nextSibling;\n        }\n\n        /* jshint ignore:start */\n        var dummy = curTextNode.nodeValue; // enforce IE to re-reference curTextNode, hack\n        /* jshint ignore:end */\n\n        if (isStart && curTextNode.nextSibling && dom.isText(curTextNode.nextSibling) &&\n            textCount === curTextNode.nodeValue.length) {\n          textCount -= curTextNode.nodeValue.length;\n          curTextNode = curTextNode.nextSibling;\n        }\n\n        container = curTextNode;\n        offset = textCount;\n      }\n\n      return {\n        cont: container,\n        offset: offset\n      };\n    };\n\n    /**\n     * return TextRange from boundary point (inspired by google closure-library)\n     * @param {BoundaryPoint} point\n     * @return {TextRange}\n     */\n    var pointToTextRange = function (point) {\n      var textRangeInfo = function (container, offset) {\n        var node, isCollapseToStart;\n\n        if (dom.isText(container)) {\n          var prevTextNodes = dom.listPrev(container, func.not(dom.isText));\n          var prevContainer = list.last(prevTextNodes).previousSibling;\n          node =  prevContainer || container.parentNode;\n          offset += list.sum(list.tail(prevTextNodes), dom.nodeLength);\n          isCollapseToStart = !prevContainer;\n        } else {\n          node = container.childNodes[offset] || container;\n          if (dom.isText(node)) {\n            return textRangeInfo(node, 0);\n          }\n\n          offset = 0;\n          isCollapseToStart = false;\n        }\n\n        return {\n          node: node,\n          collapseToStart: isCollapseToStart,\n          offset: offset\n        };\n      };\n\n      var textRange = document.body.createTextRange();\n      var info = textRangeInfo(point.node, point.offset);\n\n      textRange.moveToElementText(info.node);\n      textRange.collapse(info.collapseToStart);\n      textRange.moveStart('character', info.offset);\n      return textRange;\n    };\n\n    /**\n     * Wrapped Range\n     *\n     * @constructor\n     * @param {Node} sc - start container\n     * @param {Number} so - start offset\n     * @param {Node} ec - end container\n     * @param {Number} eo - end offset\n     */\n    var WrappedRange = function (sc, so, ec, eo) {\n      this.sc = sc;\n      this.so = so;\n      this.ec = ec;\n      this.eo = eo;\n\n      // nativeRange: get nativeRange from sc, so, ec, eo\n      var nativeRange = function () {\n        if (agent.isW3CRangeSupport) {\n          var w3cRange = document.createRange();\n          w3cRange.setStart(sc, so);\n          w3cRange.setEnd(ec, eo);\n\n          return w3cRange;\n        } else {\n          var textRange = pointToTextRange({\n            node: sc,\n            offset: so\n          });\n\n          textRange.setEndPoint('EndToEnd', pointToTextRange({\n            node: ec,\n            offset: eo\n          }));\n\n          return textRange;\n        }\n      };\n\n      this.getPoints = function () {\n        return {\n          sc: sc,\n          so: so,\n          ec: ec,\n          eo: eo\n        };\n      };\n\n      this.getStartPoint = function () {\n        return {\n          node: sc,\n          offset: so\n        };\n      };\n\n      this.getEndPoint = function () {\n        return {\n          node: ec,\n          offset: eo\n        };\n      };\n\n      /**\n       * select update visible range\n       */\n      this.select = function () {\n        var nativeRng = nativeRange();\n        if (agent.isW3CRangeSupport) {\n          var selection = document.getSelection();\n          if (selection.rangeCount > 0) {\n            selection.removeAllRanges();\n          }\n          selection.addRange(nativeRng);\n        } else {\n          nativeRng.select();\n        }\n\n        return this;\n      };\n\n      /**\n       * Moves the scrollbar to start container(sc) of current range\n       *\n       * @return {WrappedRange}\n       */\n      this.scrollIntoView = function (container) {\n        var height = $(container).height();\n        if (container.scrollTop + height < this.sc.offsetTop) {\n          container.scrollTop += Math.abs(container.scrollTop + height - this.sc.offsetTop);\n        }\n\n        return this;\n      };\n\n      /**\n       * @return {WrappedRange}\n       */\n      this.normalize = function () {\n\n        /**\n         * @param {BoundaryPoint} point\n         * @param {Boolean} isLeftToRight\n         * @return {BoundaryPoint}\n         */\n        var getVisiblePoint = function (point, isLeftToRight) {\n          if ((dom.isVisiblePoint(point) && !dom.isEdgePoint(point)) ||\n              (dom.isVisiblePoint(point) && dom.isRightEdgePoint(point) && !isLeftToRight) ||\n              (dom.isVisiblePoint(point) && dom.isLeftEdgePoint(point) && isLeftToRight) ||\n              (dom.isVisiblePoint(point) && dom.isBlock(point.node) && dom.isEmpty(point.node))) {\n            return point;\n          }\n\n          // point on block's edge\n          var block = dom.ancestor(point.node, dom.isBlock);\n          if (((dom.isLeftEdgePointOf(point, block) || dom.isVoid(dom.prevPoint(point).node)) && !isLeftToRight) ||\n              ((dom.isRightEdgePointOf(point, block) || dom.isVoid(dom.nextPoint(point).node)) && isLeftToRight)) {\n\n            // returns point already on visible point\n            if (dom.isVisiblePoint(point)) {\n              return point;\n            }\n            // reverse direction\n            isLeftToRight = !isLeftToRight;\n          }\n\n          var nextPoint = isLeftToRight ? dom.nextPointUntil(dom.nextPoint(point), dom.isVisiblePoint) :\n                                          dom.prevPointUntil(dom.prevPoint(point), dom.isVisiblePoint);\n          return nextPoint || point;\n        };\n\n        var endPoint = getVisiblePoint(this.getEndPoint(), false);\n        var startPoint = this.isCollapsed() ? endPoint : getVisiblePoint(this.getStartPoint(), true);\n\n        return new WrappedRange(\n          startPoint.node,\n          startPoint.offset,\n          endPoint.node,\n          endPoint.offset\n        );\n      };\n\n      /**\n       * returns matched nodes on range\n       *\n       * @param {Function} [pred] - predicate function\n       * @param {Object} [options]\n       * @param {Boolean} [options.includeAncestor]\n       * @param {Boolean} [options.fullyContains]\n       * @return {Node[]}\n       */\n      this.nodes = function (pred, options) {\n        pred = pred || func.ok;\n\n        var includeAncestor = options && options.includeAncestor;\n        var fullyContains = options && options.fullyContains;\n\n        // TODO compare points and sort\n        var startPoint = this.getStartPoint();\n        var endPoint = this.getEndPoint();\n\n        var nodes = [];\n        var leftEdgeNodes = [];\n\n        dom.walkPoint(startPoint, endPoint, function (point) {\n          if (dom.isEditable(point.node)) {\n            return;\n          }\n\n          var node;\n          if (fullyContains) {\n            if (dom.isLeftEdgePoint(point)) {\n              leftEdgeNodes.push(point.node);\n            }\n            if (dom.isRightEdgePoint(point) && list.contains(leftEdgeNodes, point.node)) {\n              node = point.node;\n            }\n          } else if (includeAncestor) {\n            node = dom.ancestor(point.node, pred);\n          } else {\n            node = point.node;\n          }\n\n          if (node && pred(node)) {\n            nodes.push(node);\n          }\n        }, true);\n\n        return list.unique(nodes);\n      };\n\n      /**\n       * returns commonAncestor of range\n       * @return {Element} - commonAncestor\n       */\n      this.commonAncestor = function () {\n        return dom.commonAncestor(sc, ec);\n      };\n\n      /**\n       * returns expanded range by pred\n       *\n       * @param {Function} pred - predicate function\n       * @return {WrappedRange}\n       */\n      this.expand = function (pred) {\n        var startAncestor = dom.ancestor(sc, pred);\n        var endAncestor = dom.ancestor(ec, pred);\n\n        if (!startAncestor && !endAncestor) {\n          return new WrappedRange(sc, so, ec, eo);\n        }\n\n        var boundaryPoints = this.getPoints();\n\n        if (startAncestor) {\n          boundaryPoints.sc = startAncestor;\n          boundaryPoints.so = 0;\n        }\n\n        if (endAncestor) {\n          boundaryPoints.ec = endAncestor;\n          boundaryPoints.eo = dom.nodeLength(endAncestor);\n        }\n\n        return new WrappedRange(\n          boundaryPoints.sc,\n          boundaryPoints.so,\n          boundaryPoints.ec,\n          boundaryPoints.eo\n        );\n      };\n\n      /**\n       * @param {Boolean} isCollapseToStart\n       * @return {WrappedRange}\n       */\n      this.collapse = function (isCollapseToStart) {\n        if (isCollapseToStart) {\n          return new WrappedRange(sc, so, sc, so);\n        } else {\n          return new WrappedRange(ec, eo, ec, eo);\n        }\n      };\n\n      /**\n       * splitText on range\n       */\n      this.splitText = function () {\n        var isSameContainer = sc === ec;\n        var boundaryPoints = this.getPoints();\n\n        if (dom.isText(ec) && !dom.isEdgePoint(this.getEndPoint())) {\n          ec.splitText(eo);\n        }\n\n        if (dom.isText(sc) && !dom.isEdgePoint(this.getStartPoint())) {\n          boundaryPoints.sc = sc.splitText(so);\n          boundaryPoints.so = 0;\n\n          if (isSameContainer) {\n            boundaryPoints.ec = boundaryPoints.sc;\n            boundaryPoints.eo = eo - so;\n          }\n        }\n\n        return new WrappedRange(\n          boundaryPoints.sc,\n          boundaryPoints.so,\n          boundaryPoints.ec,\n          boundaryPoints.eo\n        );\n      };\n\n      /**\n       * delete contents on range\n       * @return {WrappedRange}\n       */\n      this.deleteContents = function () {\n        if (this.isCollapsed()) {\n          return this;\n        }\n\n        var rng = this.splitText();\n        var nodes = rng.nodes(null, {\n          fullyContains: true\n        });\n\n        // find new cursor point\n        var point = dom.prevPointUntil(rng.getStartPoint(), function (point) {\n          return !list.contains(nodes, point.node);\n        });\n\n        var emptyParents = [];\n        $.each(nodes, function (idx, node) {\n          // find empty parents\n          var parent = node.parentNode;\n          if (point.node !== parent && dom.nodeLength(parent) === 1) {\n            emptyParents.push(parent);\n          }\n          dom.remove(node, false);\n        });\n\n        // remove empty parents\n        $.each(emptyParents, function (idx, node) {\n          dom.remove(node, false);\n        });\n\n        return new WrappedRange(\n          point.node,\n          point.offset,\n          point.node,\n          point.offset\n        ).normalize();\n      };\n\n      /**\n       * makeIsOn: return isOn(pred) function\n       */\n      var makeIsOn = function (pred) {\n        return function () {\n          var ancestor = dom.ancestor(sc, pred);\n          return !!ancestor && (ancestor === dom.ancestor(ec, pred));\n        };\n      };\n\n      // isOnEditable: judge whether range is on editable or not\n      this.isOnEditable = makeIsOn(dom.isEditable);\n      // isOnList: judge whether range is on list node or not\n      this.isOnList = makeIsOn(dom.isList);\n      // isOnAnchor: judge whether range is on anchor node or not\n      this.isOnAnchor = makeIsOn(dom.isAnchor);\n      // isOnCell: judge whether range is on cell node or not\n      this.isOnCell = makeIsOn(dom.isCell);\n      // isOnData: judge whether range is on data node or not\n      this.isOnData = makeIsOn(dom.isData);\n\n      /**\n       * @param {Function} pred\n       * @return {Boolean}\n       */\n      this.isLeftEdgeOf = function (pred) {\n        if (!dom.isLeftEdgePoint(this.getStartPoint())) {\n          return false;\n        }\n\n        var node = dom.ancestor(this.sc, pred);\n        return node && dom.isLeftEdgeOf(this.sc, node);\n      };\n\n      /**\n       * returns whether range was collapsed or not\n       */\n      this.isCollapsed = function () {\n        return sc === ec && so === eo;\n      };\n\n      /**\n       * wrap inline nodes which children of body with paragraph\n       *\n       * @return {WrappedRange}\n       */\n      this.wrapBodyInlineWithPara = function () {\n        if (dom.isBodyContainer(sc) && dom.isEmpty(sc)) {\n          sc.innerHTML = dom.emptyPara;\n          return new WrappedRange(sc.firstChild, 0, sc.firstChild, 0);\n        }\n\n        /**\n         * [workaround] firefox often create range on not visible point. so normalize here.\n         *  - firefox: |<p>text</p>|\n         *  - chrome: <p>|text|</p>\n         */\n        var rng = this.normalize();\n        if (dom.isParaInline(sc) || dom.isPara(sc)) {\n          return rng;\n        }\n\n        // find inline top ancestor\n        var topAncestor;\n        if (dom.isInline(rng.sc)) {\n          var ancestors = dom.listAncestor(rng.sc, func.not(dom.isInline));\n          topAncestor = list.last(ancestors);\n          if (!dom.isInline(topAncestor)) {\n            topAncestor = ancestors[ancestors.length - 2] || rng.sc.childNodes[rng.so];\n          }\n        } else {\n          topAncestor = rng.sc.childNodes[rng.so > 0 ? rng.so - 1 : 0];\n        }\n\n        // siblings not in paragraph\n        var inlineSiblings = dom.listPrev(topAncestor, dom.isParaInline).reverse();\n        inlineSiblings = inlineSiblings.concat(dom.listNext(topAncestor.nextSibling, dom.isParaInline));\n\n        // wrap with paragraph\n        if (inlineSiblings.length) {\n          var para = dom.wrap(list.head(inlineSiblings), 'p');\n          dom.appendChildNodes(para, list.tail(inlineSiblings));\n        }\n\n        return this.normalize();\n      };\n\n      /**\n       * insert node at current cursor\n       *\n       * @param {Node} node\n       * @return {Node}\n       */\n      this.insertNode = function (node) {\n        var rng = this.wrapBodyInlineWithPara().deleteContents();\n        var info = dom.splitPoint(rng.getStartPoint(), dom.isInline(node));\n\n        if (info.rightNode) {\n          info.rightNode.parentNode.insertBefore(node, info.rightNode);\n        } else {\n          info.container.appendChild(node);\n        }\n\n        return node;\n      };\n\n      /**\n       * insert html at current cursor\n       */\n      this.pasteHTML = function (markup) {\n        var contentsContainer = $('<div></div>').html(markup)[0];\n        var childNodes = list.from(contentsContainer.childNodes);\n\n        var rng = this.wrapBodyInlineWithPara().deleteContents();\n\n        return childNodes.reverse().map(function (childNode) {\n          return rng.insertNode(childNode);\n        }).reverse();\n      };\n\n      /**\n       * returns text in range\n       *\n       * @return {String}\n       */\n      this.toString = function () {\n        var nativeRng = nativeRange();\n        return agent.isW3CRangeSupport ? nativeRng.toString() : nativeRng.text;\n      };\n\n      /**\n       * returns range for word before cursor\n       *\n       * @param {Boolean} [findAfter] - find after cursor, default: false\n       * @return {WrappedRange}\n       */\n      this.getWordRange = function (findAfter) {\n        var endPoint = this.getEndPoint();\n\n        if (!dom.isCharPoint(endPoint)) {\n          return this;\n        }\n\n        var startPoint = dom.prevPointUntil(endPoint, function (point) {\n          return !dom.isCharPoint(point);\n        });\n\n        if (findAfter) {\n          endPoint = dom.nextPointUntil(endPoint, function (point) {\n            return !dom.isCharPoint(point);\n          });\n        }\n\n        return new WrappedRange(\n          startPoint.node,\n          startPoint.offset,\n          endPoint.node,\n          endPoint.offset\n        );\n      };\n\n      /**\n       * create offsetPath bookmark\n       *\n       * @param {Node} editable\n       */\n      this.bookmark = function (editable) {\n        return {\n          s: {\n            path: dom.makeOffsetPath(editable, sc),\n            offset: so\n          },\n          e: {\n            path: dom.makeOffsetPath(editable, ec),\n            offset: eo\n          }\n        };\n      };\n\n      /**\n       * create offsetPath bookmark base on paragraph\n       *\n       * @param {Node[]} paras\n       */\n      this.paraBookmark = function (paras) {\n        return {\n          s: {\n            path: list.tail(dom.makeOffsetPath(list.head(paras), sc)),\n            offset: so\n          },\n          e: {\n            path: list.tail(dom.makeOffsetPath(list.last(paras), ec)),\n            offset: eo\n          }\n        };\n      };\n\n      /**\n       * getClientRects\n       * @return {Rect[]}\n       */\n      this.getClientRects = function () {\n        var nativeRng = nativeRange();\n        return nativeRng.getClientRects();\n      };\n    };\n\n  /**\n   * @class core.range\n   *\n   * Data structure\n   *  * BoundaryPoint: a point of dom tree\n   *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range\n   *\n   * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position\n   *\n   * @singleton\n   * @alternateClassName range\n   */\n    return {\n      /**\n       * create Range Object From arguments or Browser Selection\n       *\n       * @param {Node} sc - start container\n       * @param {Number} so - start offset\n       * @param {Node} ec - end container\n       * @param {Number} eo - end offset\n       * @return {WrappedRange}\n       */\n      create: function (sc, so, ec, eo) {\n        if (arguments.length === 4) {\n          return new WrappedRange(sc, so, ec, eo);\n        } else if (arguments.length === 2) { //collapsed\n          ec = sc;\n          eo = so;\n          return new WrappedRange(sc, so, ec, eo);\n        } else {\n          var wrappedRange = this.createFromSelection();\n          if (!wrappedRange && arguments.length === 1) {\n            wrappedRange = this.createFromNode(arguments[0]);\n            return wrappedRange.collapse(dom.emptyPara === arguments[0].innerHTML);\n          }\n          return wrappedRange;\n        }\n      },\n\n      createFromSelection: function () {\n        var sc, so, ec, eo;\n        if (agent.isW3CRangeSupport) {\n          var selection = document.getSelection();\n          if (!selection || selection.rangeCount === 0) {\n            return null;\n          } else if (dom.isBody(selection.anchorNode)) {\n            // Firefox: returns entire body as range on initialization.\n            // We won't never need it.\n            return null;\n          }\n\n          var nativeRng = selection.getRangeAt(0);\n          sc = nativeRng.startContainer;\n          so = nativeRng.startOffset;\n          ec = nativeRng.endContainer;\n          eo = nativeRng.endOffset;\n        } else { // IE8: TextRange\n          var textRange = document.selection.createRange();\n          var textRangeEnd = textRange.duplicate();\n          textRangeEnd.collapse(false);\n          var textRangeStart = textRange;\n          textRangeStart.collapse(true);\n\n          var startPoint = textRangeToPoint(textRangeStart, true),\n          endPoint = textRangeToPoint(textRangeEnd, false);\n\n          // same visible point case: range was collapsed.\n          if (dom.isText(startPoint.node) && dom.isLeftEdgePoint(startPoint) &&\n              dom.isTextNode(endPoint.node) && dom.isRightEdgePoint(endPoint) &&\n              endPoint.node.nextSibling === startPoint.node) {\n            startPoint = endPoint;\n          }\n\n          sc = startPoint.cont;\n          so = startPoint.offset;\n          ec = endPoint.cont;\n          eo = endPoint.offset;\n        }\n\n        return new WrappedRange(sc, so, ec, eo);\n      },\n\n      /**\n       * @method\n       *\n       * create WrappedRange from node\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */\n      createFromNode: function (node) {\n        var sc = node;\n        var so = 0;\n        var ec = node;\n        var eo = dom.nodeLength(ec);\n\n        // browsers can't target a picture or void node\n        if (dom.isVoid(sc)) {\n          so = dom.listPrev(sc).length - 1;\n          sc = sc.parentNode;\n        }\n        if (dom.isBR(ec)) {\n          eo = dom.listPrev(ec).length - 1;\n          ec = ec.parentNode;\n        } else if (dom.isVoid(ec)) {\n          eo = dom.listPrev(ec).length;\n          ec = ec.parentNode;\n        }\n\n        return this.create(sc, so, ec, eo);\n      },\n\n      /**\n       * create WrappedRange from node after position\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */\n      createFromNodeBefore: function (node) {\n        return this.createFromNode(node).collapse(true);\n      },\n\n      /**\n       * create WrappedRange from node after position\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */\n      createFromNodeAfter: function (node) {\n        return this.createFromNode(node).collapse();\n      },\n\n      /**\n       * @method\n       *\n       * create WrappedRange from bookmark\n       *\n       * @param {Node} editable\n       * @param {Object} bookmark\n       * @return {WrappedRange}\n       */\n      createFromBookmark: function (editable, bookmark) {\n        var sc = dom.fromOffsetPath(editable, bookmark.s.path);\n        var so = bookmark.s.offset;\n        var ec = dom.fromOffsetPath(editable, bookmark.e.path);\n        var eo = bookmark.e.offset;\n        return new WrappedRange(sc, so, ec, eo);\n      },\n\n      /**\n       * @method\n       *\n       * create WrappedRange from paraBookmark\n       *\n       * @param {Object} bookmark\n       * @param {Node[]} paras\n       * @return {WrappedRange}\n       */\n      createFromParaBookmark: function (bookmark, paras) {\n        var so = bookmark.s.offset;\n        var eo = bookmark.e.offset;\n        var sc = dom.fromOffsetPath(list.head(paras), bookmark.s.path);\n        var ec = dom.fromOffsetPath(list.last(paras), bookmark.e.path);\n\n        return new WrappedRange(sc, so, ec, eo);\n      }\n    };\n  })();\n\n  /**\n   * @class core.async\n   *\n   * Async functions which returns `Promise`\n   *\n   * @singleton\n   * @alternateClassName async\n   */\n  var async = (function () {\n    /**\n     * @method readFileAsDataURL\n     *\n     * read contents of file as representing URL\n     *\n     * @param {File} file\n     * @return {Promise} - then: dataUrl\n     */\n    var readFileAsDataURL = function (file) {\n      return $.Deferred(function (deferred) {\n        $.extend(new FileReader(), {\n          onload: function (e) {\n            var dataURL = e.target.result;\n            deferred.resolve(dataURL);\n          },\n          onerror: function () {\n            deferred.reject(this);\n          }\n        }).readAsDataURL(file);\n      }).promise();\n    };\n\n    /**\n     * @method createImage\n     *\n     * create `<image>` from url string\n     *\n     * @param {String} url\n     * @return {Promise} - then: $image\n     */\n    var createImage = function (url) {\n      return $.Deferred(function (deferred) {\n        var $img = $('<img>');\n\n        $img.one('load', function () {\n          $img.off('error abort');\n          deferred.resolve($img);\n        }).one('error abort', function () {\n          $img.off('load').detach();\n          deferred.reject($img);\n        }).css({\n          display: 'none'\n        }).appendTo(document.body).attr('src', url);\n      }).promise();\n    };\n\n    return {\n      readFileAsDataURL: readFileAsDataURL,\n      createImage: createImage\n    };\n  })();\n\n  /**\n   * @class editing.History\n   *\n   * Editor History\n   *\n   */\n  var History = function ($editable) {\n    var stack = [], stackOffset = -1;\n    var editable = $editable[0];\n\n    var makeSnapshot = function () {\n      var rng = range.create(editable);\n      var emptyBookmark = {s: {path: [], offset: 0}, e: {path: [], offset: 0}};\n\n      return {\n        contents: $editable.html(),\n        bookmark: (rng ? rng.bookmark(editable) : emptyBookmark)\n      };\n    };\n\n    var applySnapshot = function (snapshot) {\n      if (snapshot.contents !== null) {\n        $editable.html(snapshot.contents);\n      }\n      if (snapshot.bookmark !== null) {\n        range.createFromBookmark(editable, snapshot.bookmark).select();\n      }\n    };\n\n    /**\n    * @method rewind\n    * Rewinds the history stack back to the first snapshot taken.\n    * Leaves the stack intact, so that \"Redo\" can still be used.\n    */\n    this.rewind = function () {\n      // Create snap shot if not yet recorded\n      if ($editable.html() !== stack[stackOffset].contents) {\n        this.recordUndo();\n      }\n\n      // Return to the first available snapshot.\n      stackOffset = 0;\n\n      // Apply that snapshot.\n      applySnapshot(stack[stackOffset]);\n    };\n\n    /**\n    * @method reset\n    * Resets the history stack completely; reverting to an empty editor.\n    */\n    this.reset = function () {\n      // Clear the stack.\n      stack = [];\n\n      // Restore stackOffset to its original value.\n      stackOffset = -1;\n\n      // Clear the editable area.\n      $editable.html('');\n\n      // Record our first snapshot (of nothing).\n      this.recordUndo();\n    };\n\n    /**\n     * undo\n     */\n    this.undo = function () {\n      // Create snap shot if not yet recorded\n      if ($editable.html() !== stack[stackOffset].contents) {\n        this.recordUndo();\n      }\n\n      if (0 < stackOffset) {\n        stackOffset--;\n        applySnapshot(stack[stackOffset]);\n      }\n    };\n\n    /**\n     * redo\n     */\n    this.redo = function () {\n      if (stack.length - 1 > stackOffset) {\n        stackOffset++;\n        applySnapshot(stack[stackOffset]);\n      }\n    };\n\n    /**\n     * recorded undo\n     */\n    this.recordUndo = function () {\n      stackOffset++;\n\n      // Wash out stack after stackOffset\n      if (stack.length > stackOffset) {\n        stack = stack.slice(0, stackOffset);\n      }\n\n      // Create new snapshot and push it to the end\n      stack.push(makeSnapshot());\n    };\n  };\n\n  /**\n   * @class editing.Style\n   *\n   * Style\n   *\n   */\n  var Style = function () {\n    /**\n     * @method jQueryCSS\n     *\n     * [workaround] for old jQuery\n     * passing an array of style properties to .css()\n     * will result in an object of property-value pairs.\n     * (compability with version < 1.9)\n     *\n     * @private\n     * @param  {jQuery} $obj\n     * @param  {Array} propertyNames - An array of one or more CSS properties.\n     * @return {Object}\n     */\n    var jQueryCSS = function ($obj, propertyNames) {\n      if (agent.jqueryVersion < 1.9) {\n        var result = {};\n        $.each(propertyNames, function (idx, propertyName) {\n          result[propertyName] = $obj.css(propertyName);\n        });\n        return result;\n      }\n      return $obj.css.call($obj, propertyNames);\n    };\n\n    /**\n     * returns style object from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */\n    this.fromNode = function ($node) {\n      var properties = ['font-family', 'font-size', 'text-align', 'list-style-type', 'line-height'];\n      var styleInfo = jQueryCSS($node, properties) || {};\n      styleInfo['font-size'] = parseInt(styleInfo['font-size'], 10);\n      return styleInfo;\n    };\n\n    /**\n     * paragraph level style\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} styleInfo\n     */\n    this.stylePara = function (rng, styleInfo) {\n      $.each(rng.nodes(dom.isPara, {\n        includeAncestor: true\n      }), function (idx, para) {\n        $(para).css(styleInfo);\n      });\n    };\n\n    /**\n     * insert and returns styleNodes on range.\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} [options] - options for styleNodes\n     * @param {String} [options.nodeName] - default: `SPAN`\n     * @param {Boolean} [options.expandClosestSibling] - default: `false`\n     * @param {Boolean} [options.onlyPartialContains] - default: `false`\n     * @return {Node[]}\n     */\n    this.styleNodes = function (rng, options) {\n      rng = rng.splitText();\n\n      var nodeName = options && options.nodeName || 'SPAN';\n      var expandClosestSibling = !!(options && options.expandClosestSibling);\n      var onlyPartialContains = !!(options && options.onlyPartialContains);\n\n      if (rng.isCollapsed()) {\n        return [rng.insertNode(dom.create(nodeName))];\n      }\n\n      var pred = dom.makePredByNodeName(nodeName);\n      var nodes = rng.nodes(dom.isText, {\n        fullyContains: true\n      }).map(function (text) {\n        return dom.singleChildAncestor(text, pred) || dom.wrap(text, nodeName);\n      });\n\n      if (expandClosestSibling) {\n        if (onlyPartialContains) {\n          var nodesInRange = rng.nodes();\n          // compose with partial contains predication\n          pred = func.and(pred, function (node) {\n            return list.contains(nodesInRange, node);\n          });\n        }\n\n        return nodes.map(function (node) {\n          var siblings = dom.withClosestSiblings(node, pred);\n          var head = list.head(siblings);\n          var tails = list.tail(siblings);\n          $.each(tails, function (idx, elem) {\n            dom.appendChildNodes(head, elem.childNodes);\n            dom.remove(elem);\n          });\n          return list.head(siblings);\n        });\n      } else {\n        return nodes;\n      }\n    };\n\n    /**\n     * get current style on cursor\n     *\n     * @param {WrappedRange} rng\n     * @return {Object} - object contains style properties.\n     */\n    this.current = function (rng) {\n      var $cont = $(!dom.isElement(rng.sc) ? rng.sc.parentNode : rng.sc);\n      var styleInfo = this.fromNode($cont);\n\n      // document.queryCommandState for toggle state\n      // [workaround] prevent Firefox nsresult: \"0x80004005 (NS_ERROR_FAILURE)\"\n      try {\n        styleInfo = $.extend(styleInfo, {\n          'font-bold': document.queryCommandState('bold') ? 'bold' : 'normal',\n          'font-italic': document.queryCommandState('italic') ? 'italic' : 'normal',\n          'font-underline': document.queryCommandState('underline') ? 'underline' : 'normal',\n          'font-subscript': document.queryCommandState('subscript') ? 'subscript' : 'normal',\n          'font-superscript': document.queryCommandState('superscript') ? 'superscript' : 'normal',\n          'font-strikethrough': document.queryCommandState('strikethrough') ? 'strikethrough' : 'normal'\n        });\n      } catch (e) {}\n\n      // list-style-type to list-style(unordered, ordered)\n      if (!rng.isOnList()) {\n        styleInfo['list-style'] = 'none';\n      } else {\n        var orderedTypes = ['circle', 'disc', 'disc-leading-zero', 'square'];\n        var isUnordered = $.inArray(styleInfo['list-style-type'], orderedTypes) > -1;\n        styleInfo['list-style'] = isUnordered ? 'unordered' : 'ordered';\n      }\n\n      var para = dom.ancestor(rng.sc, dom.isPara);\n      if (para && para.style['line-height']) {\n        styleInfo['line-height'] = para.style.lineHeight;\n      } else {\n        var lineHeight = parseInt(styleInfo['line-height'], 10) / parseInt(styleInfo['font-size'], 10);\n        styleInfo['line-height'] = lineHeight.toFixed(1);\n      }\n\n      styleInfo.anchor = rng.isOnAnchor() && dom.ancestor(rng.sc, dom.isAnchor);\n      styleInfo.ancestors = dom.listAncestor(rng.sc, dom.isEditable);\n      styleInfo.range = rng;\n\n      return styleInfo;\n    };\n  };\n\n\n  /**\n   * @class editing.Bullet\n   *\n   * @alternateClassName Bullet\n   */\n  var Bullet = function () {\n    var self = this;\n\n    /**\n     * toggle ordered list\n     */\n    this.insertOrderedList = function (editable) {\n      this.toggleList('OL', editable);\n    };\n\n    /**\n     * toggle unordered list\n     */\n    this.insertUnorderedList = function (editable) {\n      this.toggleList('UL', editable);\n    };\n\n    /**\n     * indent\n     */\n    this.indent = function (editable) {\n      var self = this;\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n      $.each(clustereds, function (idx, paras) {\n        var head = list.head(paras);\n        if (dom.isLi(head)) {\n          self.wrapList(paras, head.parentNode.nodeName);\n        } else {\n          $.each(paras, function (idx, para) {\n            $(para).css('marginLeft', function (idx, val) {\n              return (parseInt(val, 10) || 0) + 25;\n            });\n          });\n        }\n      });\n\n      rng.select();\n    };\n\n    /**\n     * outdent\n     */\n    this.outdent = function (editable) {\n      var self = this;\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n      $.each(clustereds, function (idx, paras) {\n        var head = list.head(paras);\n        if (dom.isLi(head)) {\n          self.releaseList([paras]);\n        } else {\n          $.each(paras, function (idx, para) {\n            $(para).css('marginLeft', function (idx, val) {\n              val = (parseInt(val, 10) || 0);\n              return val > 25 ? val - 25 : '';\n            });\n          });\n        }\n      });\n\n      rng.select();\n    };\n\n    /**\n     * toggle list\n     *\n     * @param {String} listName - OL or UL\n     */\n    this.toggleList = function (listName, editable) {\n      var rng = range.create(editable).wrapBodyInlineWithPara();\n\n      var paras = rng.nodes(dom.isPara, { includeAncestor: true });\n      var bookmark = rng.paraBookmark(paras);\n      var clustereds = list.clusterBy(paras, func.peq2('parentNode'));\n\n      // paragraph to list\n      if (list.find(paras, dom.isPurePara)) {\n        var wrappedParas = [];\n        $.each(clustereds, function (idx, paras) {\n          wrappedParas = wrappedParas.concat(self.wrapList(paras, listName));\n        });\n        paras = wrappedParas;\n      // list to paragraph or change list style\n      } else {\n        var diffLists = rng.nodes(dom.isList, {\n          includeAncestor: true\n        }).filter(function (listNode) {\n          return !$.nodeName(listNode, listName);\n        });\n\n        if (diffLists.length) {\n          $.each(diffLists, function (idx, listNode) {\n            dom.replace(listNode, listName);\n          });\n        } else {\n          paras = this.releaseList(clustereds, true);\n        }\n      }\n\n      range.createFromParaBookmark(bookmark, paras).select();\n    };\n\n    /**\n     * @param {Node[]} paras\n     * @param {String} listName\n     * @return {Node[]}\n     */\n    this.wrapList = function (paras, listName) {\n      var head = list.head(paras);\n      var last = list.last(paras);\n\n      var prevList = dom.isList(head.previousSibling) && head.previousSibling;\n      var nextList = dom.isList(last.nextSibling) && last.nextSibling;\n\n      var listNode = prevList || dom.insertAfter(dom.create(listName || 'UL'), last);\n\n      // P to LI\n      paras = paras.map(function (para) {\n        return dom.isPurePara(para) ? dom.replace(para, 'LI') : para;\n      });\n\n      // append to list(<ul>, <ol>)\n      dom.appendChildNodes(listNode, paras);\n\n      if (nextList) {\n        dom.appendChildNodes(listNode, list.from(nextList.childNodes));\n        dom.remove(nextList);\n      }\n\n      return paras;\n    };\n\n    /**\n     * @method releaseList\n     *\n     * @param {Array[]} clustereds\n     * @param {Boolean} isEscapseToBody\n     * @return {Node[]}\n     */\n    this.releaseList = function (clustereds, isEscapseToBody) {\n      var releasedParas = [];\n\n      $.each(clustereds, function (idx, paras) {\n        var head = list.head(paras);\n        var last = list.last(paras);\n\n        var headList = isEscapseToBody ? dom.lastAncestor(head, dom.isList) :\n                                         head.parentNode;\n        var lastList = headList.childNodes.length > 1 ? dom.splitTree(headList, {\n          node: last.parentNode,\n          offset: dom.position(last) + 1\n        }, {\n          isSkipPaddingBlankHTML: true\n        }) : null;\n\n        var middleList = dom.splitTree(headList, {\n          node: head.parentNode,\n          offset: dom.position(head)\n        }, {\n          isSkipPaddingBlankHTML: true\n        });\n\n        paras = isEscapseToBody ? dom.listDescendant(middleList, dom.isLi) :\n                                  list.from(middleList.childNodes).filter(dom.isLi);\n\n        // LI to P\n        if (isEscapseToBody || !dom.isList(headList.parentNode)) {\n          paras = paras.map(function (para) {\n            return dom.replace(para, 'P');\n          });\n        }\n\n        $.each(list.from(paras).reverse(), function (idx, para) {\n          dom.insertAfter(para, headList);\n        });\n\n        // remove empty lists\n        var rootLists = list.compact([headList, middleList, lastList]);\n        $.each(rootLists, function (idx, rootList) {\n          var listNodes = [rootList].concat(dom.listDescendant(rootList, dom.isList));\n          $.each(listNodes.reverse(), function (idx, listNode) {\n            if (!dom.nodeLength(listNode)) {\n              dom.remove(listNode, true);\n            }\n          });\n        });\n\n        releasedParas = releasedParas.concat(paras);\n      });\n\n      return releasedParas;\n    };\n  };\n\n\n  /**\n   * @class editing.Typing\n   *\n   * Typing\n   *\n   */\n  var Typing = function () {\n\n    // a Bullet instance to toggle lists off\n    var bullet = new Bullet();\n\n    /**\n     * insert tab\n     *\n     * @param {WrappedRange} rng\n     * @param {Number} tabsize\n     */\n    this.insertTab = function (rng, tabsize) {\n      var tab = dom.createText(new Array(tabsize + 1).join(dom.NBSP_CHAR));\n      rng = rng.deleteContents();\n      rng.insertNode(tab, true);\n\n      rng = range.create(tab, tabsize);\n      rng.select();\n    };\n\n    /**\n     * insert paragraph\n     */\n    this.insertParagraph = function (editable) {\n      var rng = range.create(editable);\n\n      // deleteContents on range.\n      rng = rng.deleteContents();\n\n      // Wrap range if it needs to be wrapped by paragraph\n      rng = rng.wrapBodyInlineWithPara();\n\n      // finding paragraph\n      var splitRoot = dom.ancestor(rng.sc, dom.isPara);\n\n      var nextPara;\n      // on paragraph: split paragraph\n      if (splitRoot) {\n        // if it is an empty line with li\n        if (dom.isEmpty(splitRoot) && dom.isLi(splitRoot)) {\n          // toogle UL/OL and escape\n          bullet.toggleList(splitRoot.parentNode.nodeName);\n          return;\n        // if it is an empty line with para on blockquote\n        } else if (dom.isEmpty(splitRoot) && dom.isPara(splitRoot) && dom.isBlockquote(splitRoot.parentNode)) {\n          // escape blockquote\n          dom.insertAfter(splitRoot, splitRoot.parentNode);\n          nextPara = splitRoot;\n        // if new line has content (not a line break)\n        } else {\n          nextPara = dom.splitTree(splitRoot, rng.getStartPoint());\n\n          var emptyAnchors = dom.listDescendant(splitRoot, dom.isEmptyAnchor);\n          emptyAnchors = emptyAnchors.concat(dom.listDescendant(nextPara, dom.isEmptyAnchor));\n\n          $.each(emptyAnchors, function (idx, anchor) {\n            dom.remove(anchor);\n          });\n\n          // replace empty heading or pre with P tag\n          if ((dom.isHeading(nextPara) || dom.isPre(nextPara)) && dom.isEmpty(nextPara)) {\n            nextPara = dom.replace(nextPara, 'p');\n          }\n        }\n      // no paragraph: insert empty paragraph\n      } else {\n        var next = rng.sc.childNodes[rng.so];\n        nextPara = $(dom.emptyPara)[0];\n        if (next) {\n          rng.sc.insertBefore(nextPara, next);\n        } else {\n          rng.sc.appendChild(nextPara);\n        }\n      }\n\n      range.create(nextPara, 0).normalize().select().scrollIntoView(editable);\n    };\n  };\n\n  /**\n   * @class editing.Table\n   *\n   * Table\n   *\n   */\n  var Table = function () {\n    /**\n     * handle tab key\n     *\n     * @param {WrappedRange} rng\n     * @param {Boolean} isShift\n     */\n    this.tab = function (rng, isShift) {\n      var cell = dom.ancestor(rng.commonAncestor(), dom.isCell);\n      var table = dom.ancestor(cell, dom.isTable);\n      var cells = dom.listDescendant(table, dom.isCell);\n\n      var nextCell = list[isShift ? 'prev' : 'next'](cells, cell);\n      if (nextCell) {\n        range.create(nextCell, 0).select();\n      }\n    };\n\n    /**\n     * create empty table element\n     *\n     * @param {Number} rowCount\n     * @param {Number} colCount\n     * @return {Node}\n     */\n    this.createTable = function (colCount, rowCount, options) {\n      var tds = [], tdHTML;\n      for (var idxCol = 0; idxCol < colCount; idxCol++) {\n        tds.push('<td>' + dom.blank + '</td>');\n      }\n      tdHTML = tds.join('');\n\n      var trs = [], trHTML;\n      for (var idxRow = 0; idxRow < rowCount; idxRow++) {\n        trs.push('<tr>' + tdHTML + '</tr>');\n      }\n      trHTML = trs.join('');\n      var $table = $('<table>' + trHTML + '</table>');\n      if (options && options.tableClassName) {\n        $table.addClass(options.tableClassName);\n      }\n\n      return $table[0];\n    };\n  };\n\n\n  var KEY_BOGUS = 'bogus';\n\n  /**\n   * @class Editor\n   */\n  var Editor = function (context) {\n    var self = this;\n\n    var $note = context.layoutInfo.note;\n    var $editor = context.layoutInfo.editor;\n    var $editable = context.layoutInfo.editable;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    var editable = $editable[0];\n    var lastRange = null;\n\n    var style = new Style();\n    var table = new Table();\n    var typing = new Typing();\n    var bullet = new Bullet();\n    var history = new History($editable);\n\n    this.initialize = function () {\n      // bind custom events\n      $editable.on('keydown', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          context.triggerEvent('enter', event);\n        }\n        context.triggerEvent('keydown', event);\n\n        if (!event.isDefaultPrevented()) {\n          if (options.shortcuts) {\n            self.handleKeyMap(event);\n          } else {\n            self.preventDefaultEditableShortCuts(event);\n          }\n        }\n      }).on('keyup', function (event) {\n        context.triggerEvent('keyup', event);\n      }).on('focus', function (event) {\n        context.triggerEvent('focus', event);\n      }).on('blur', function (event) {\n        context.triggerEvent('blur', event);\n      }).on('mousedown', function (event) {\n        context.triggerEvent('mousedown', event);\n      }).on('mouseup', function (event) {\n        context.triggerEvent('mouseup', event);\n      }).on('scroll', function (event) {\n        context.triggerEvent('scroll', event);\n      }).on('paste', function (event) {\n        context.triggerEvent('paste', event);\n      });\n\n      // init content before set event\n      $editable.html(dom.html($note) || dom.emptyPara);\n\n      // [workaround] IE doesn't have input events for contentEditable\n      // - see: https://goo.gl/4bfIvA\n      var changeEventName = agent.isMSIE ? 'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted' : 'input';\n      $editable.on(changeEventName, func.debounce(function () {\n        context.triggerEvent('change', $editable.html());\n      }, 250));\n\n      $editor.on('focusin', function (event) {\n        context.triggerEvent('focusin', event);\n      }).on('focusout', function (event) {\n        context.triggerEvent('focusout', event);\n      });\n\n      if (!options.airMode) {\n        if (options.width) {\n          $editor.outerWidth(options.width);\n        }\n        if (options.height) {\n          $editable.outerHeight(options.height);\n        }\n        if (options.maxHeight) {\n          $editable.css('max-height', options.maxHeight);\n        }\n        if (options.minHeight) {\n          $editable.css('min-height', options.minHeight);\n        }\n      }\n\n      history.recordUndo();\n    };\n\n    this.destroy = function () {\n      $editable.off();\n    };\n\n    this.handleKeyMap = function (event) {\n      var keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\n      var keys = [];\n\n      if (event.metaKey) { keys.push('CMD'); }\n      if (event.ctrlKey && !event.altKey) { keys.push('CTRL'); }\n      if (event.shiftKey) { keys.push('SHIFT'); }\n\n      var keyName = key.nameFromCode[event.keyCode];\n      if (keyName) {\n        keys.push(keyName);\n      }\n\n      var eventName = keyMap[keys.join('+')];\n      if (eventName) {\n        event.preventDefault();\n        context.invoke(eventName);\n      } else if (key.isEdit(event.keyCode)) {\n        this.afterCommand();\n      }\n    };\n\n    this.preventDefaultEditableShortCuts = function (event) {\n      // B(Bold, 66) / I(Italic, 73) / U(Underline, 85)\n      if ((event.ctrlKey || event.metaKey) &&\n        list.contains([66, 73, 85], event.keyCode)) {\n        event.preventDefault();\n      }\n    };\n\n    /**\n     * create range\n     * @return {WrappedRange}\n     */\n    this.createRange = function () {\n      this.focus();\n      return range.create(editable);\n    };\n\n    /**\n     * saveRange\n     *\n     * save current range\n     *\n     * @param {Boolean} [thenCollapse=false]\n     */\n    this.saveRange = function (thenCollapse) {\n      lastRange = this.createRange();\n      if (thenCollapse) {\n        lastRange.collapse().select();\n      }\n    };\n\n    /**\n     * restoreRange\n     *\n     * restore lately range\n     */\n    this.restoreRange = function () {\n      if (lastRange) {\n        lastRange.select();\n        this.focus();\n      }\n    };\n\n    this.saveTarget = function (node) {\n      $editable.data('target', node);\n    };\n\n    this.clearTarget = function () {\n      $editable.removeData('target');\n    };\n\n    this.restoreTarget = function () {\n      return $editable.data('target');\n    };\n\n    /**\n     * currentStyle\n     *\n     * current style\n     * @return {Object|Boolean} unfocus\n     */\n    this.currentStyle = function () {\n      var rng = range.create();\n      if (rng) {\n        rng = rng.normalize();\n      }\n      return rng ? style.current(rng) : style.fromNode($editable);\n    };\n\n    /**\n     * style from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */\n    this.styleFromNode = function ($node) {\n      return style.fromNode($node);\n    };\n\n    /**\n     * undo\n     */\n    this.undo = function () {\n      context.triggerEvent('before.command', $editable.html());\n      history.undo();\n      context.triggerEvent('change', $editable.html());\n    };\n    context.memo('help.undo', lang.help.undo);\n\n    /**\n     * redo\n     */\n    this.redo = function () {\n      context.triggerEvent('before.command', $editable.html());\n      history.redo();\n      context.triggerEvent('change', $editable.html());\n    };\n    context.memo('help.redo', lang.help.redo);\n\n    /**\n     * before command\n     */\n    var beforeCommand = this.beforeCommand = function () {\n      context.triggerEvent('before.command', $editable.html());\n      // keep focus on editable before command execution\n      self.focus();\n    };\n\n    /**\n     * after command\n     * @param {Boolean} isPreventTrigger\n     */\n    var afterCommand = this.afterCommand = function (isPreventTrigger) {\n      history.recordUndo();\n      if (!isPreventTrigger) {\n        context.triggerEvent('change', $editable.html());\n      }\n    };\n\n    /* jshint ignore:start */\n    // native commands(with execCommand), generate function for execCommand\n    var commands = ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript',\n                    'justifyLeft', 'justifyCenter', 'justifyRight', 'justifyFull',\n                    'formatBlock', 'removeFormat',\n                    'backColor', 'foreColor', 'fontName'];\n\n    for (var idx = 0, len = commands.length; idx < len; idx ++) {\n      this[commands[idx]] = (function (sCmd) {\n        return function (value) {\n          beforeCommand();\n          document.execCommand(sCmd, false, value);\n          afterCommand(true);\n        };\n      })(commands[idx]);\n      context.memo('help.' + commands[idx], lang.help[commands[idx]]);\n    }\n    /* jshint ignore:end */\n\n    /**\n     * handle tab key\n     */\n    this.tab = function () {\n      var rng = this.createRange();\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        table.tab(rng);\n      } else {\n        beforeCommand();\n        typing.insertTab(rng, options.tabSize);\n        afterCommand();\n      }\n    };\n    context.memo('help.tab', lang.help.tab);\n\n    /**\n     * handle shift+tab key\n     */\n    this.untab = function () {\n      var rng = this.createRange();\n      if (rng.isCollapsed() && rng.isOnCell()) {\n        table.tab(rng, true);\n      }\n    };\n    context.memo('help.untab', lang.help.untab);\n\n    /**\n     * run given function between beforeCommand and afterCommand\n     */\n    this.wrapCommand = function (fn) {\n      return function () {\n        beforeCommand();\n        fn.apply(self, arguments);\n        afterCommand();\n      };\n    };\n\n    /**\n     * insert paragraph\n     */\n    this.insertParagraph = this.wrapCommand(function () {\n      typing.insertParagraph(editable);\n    });\n    context.memo('help.insertParagraph', lang.help.insertParagraph);\n\n    this.insertOrderedList = this.wrapCommand(function () {\n      bullet.insertOrderedList(editable);\n    });\n    context.memo('help.insertOrderedList', lang.help.insertOrderedList);\n\n    this.insertUnorderedList = this.wrapCommand(function () {\n      bullet.insertUnorderedList(editable);\n    });\n    context.memo('help.insertUnorderedList', lang.help.insertUnorderedList);\n\n    this.indent = this.wrapCommand(function () {\n      bullet.indent(editable);\n    });\n    context.memo('help.indent', lang.help.indent);\n\n    this.outdent = this.wrapCommand(function () {\n      bullet.outdent(editable);\n    });\n    context.memo('help.outdent', lang.help.outdent);\n\n    /**\n     * insert image\n     *\n     * @param {String} src\n     * @param {String|Function} param\n     * @return {Promise}\n     */\n    this.insertImage = function (src, param) {\n      return async.createImage(src, param).then(function ($image) {\n        beforeCommand();\n\n        if (typeof param === 'function') {\n          param($image);\n        } else {\n          if (typeof param === 'string') {\n            $image.attr('data-filename', param);\n          }\n          $image.css('width', Math.min($editable.width(), $image.width()));\n        }\n\n        $image.show();\n        range.create(editable).insertNode($image[0]);\n        range.createFromNodeAfter($image[0]).select();\n        afterCommand();\n      }).fail(function (e) {\n        context.triggerEvent('image.upload.error', e);\n      });\n    };\n\n    /**\n     * insertImages\n     * @param {File[]} files\n     */\n    this.insertImages = function (files) {\n      $.each(files, function (idx, file) {\n        var filename = file.name;\n        if (options.maximumImageFileSize && options.maximumImageFileSize < file.size) {\n          context.triggerEvent('image.upload.error', lang.image.maximumFileSizeError);\n        } else {\n          async.readFileAsDataURL(file).then(function (dataURL) {\n            return self.insertImage(dataURL, filename);\n          }).fail(function () {\n            context.triggerEvent('image.upload.error');\n          });\n        }\n      });\n    };\n\n    /**\n     * insertImagesOrCallback\n     * @param {File[]} files\n     */\n    this.insertImagesOrCallback = function (files) {\n      var callbacks = options.callbacks;\n\n      // If onImageUpload options setted\n      if (callbacks.onImageUpload) {\n        context.triggerEvent('image.upload', files);\n      // else insert Image as dataURL\n      } else {\n        this.insertImages(files);\n      }\n    };\n\n    /**\n     * insertNode\n     * insert node\n     * @param {Node} node\n     */\n    this.insertNode = this.wrapCommand(function (node) {\n      var rng = this.createRange();\n      rng.insertNode(node);\n      range.createFromNodeAfter(node).select();\n    });\n\n    /**\n     * insert text\n     * @param {String} text\n     */\n    this.insertText = this.wrapCommand(function (text) {\n      var rng = this.createRange();\n      var textNode = rng.insertNode(dom.createText(text));\n      range.create(textNode, dom.nodeLength(textNode)).select();\n    });\n\n    /**\n     * return selected plain text\n     * @return {String} text\n     */\n    this.getSelectedText = function () {\n      var rng = this.createRange();\n\n      // if range on anchor, expand range with anchor\n      if (rng.isOnAnchor()) {\n        rng = range.createFromNode(dom.ancestor(rng.sc, dom.isAnchor));\n      }\n\n      return rng.toString();\n    };\n\n    /**\n     * paste HTML\n     * @param {String} markup\n     */\n    this.pasteHTML = this.wrapCommand(function (markup) {\n      var contents = this.createRange().pasteHTML(markup);\n      range.createFromNodeAfter(list.last(contents)).select();\n    });\n\n    /**\n     * formatBlock\n     *\n     * @param {String} tagName\n     */\n    this.formatBlock = this.wrapCommand(function (tagName) {\n      // [workaround] for MSIE, IE need `<`\n      tagName = agent.isMSIE ? '<' + tagName + '>' : tagName;\n      document.execCommand('FormatBlock', false, tagName);\n    });\n\n    this.formatPara = function () {\n      this.formatBlock('P');\n    };\n    context.memo('help.formatPara', lang.help.formatPara);\n\n    /* jshint ignore:start */\n    for (var idx = 1; idx <= 6; idx ++) {\n      this['formatH' + idx] = function (idx) {\n        return function () {\n          this.formatBlock('H' + idx);\n        };\n      }(idx);\n      context.memo('help.formatH'+idx, lang.help['formatH' + idx]);\n    };\n    /* jshint ignore:end */\n\n    /**\n     * fontSize\n     *\n     * @param {String} value - px\n     */\n    this.fontSize = function (value) {\n      var rng = this.createRange();\n\n      if (rng && rng.isCollapsed()) {\n        var spans = style.styleNodes(rng);\n        var firstSpan = list.head(spans);\n\n        $(spans).css({\n          'font-size': value + 'px'\n        });\n\n        // [workaround] added styled bogus span for style\n        //  - also bogus character needed for cursor position\n        if (firstSpan && !dom.nodeLength(firstSpan)) {\n          firstSpan.innerHTML = dom.ZERO_WIDTH_NBSP_CHAR;\n          range.createFromNodeAfter(firstSpan.firstChild).select();\n          $editable.data(KEY_BOGUS, firstSpan);\n        }\n      } else {\n        beforeCommand();\n        $(style.styleNodes(rng)).css({\n          'font-size': value + 'px'\n        });\n        afterCommand();\n      }\n    };\n\n    /**\n     * insert horizontal rule\n     */\n    this.insertHorizontalRule = this.wrapCommand(function () {\n      var hrNode = this.createRange().insertNode(dom.create('HR'));\n      if (hrNode.nextSibling) {\n        range.create(hrNode.nextSibling, 0).normalize().select();\n      }\n    });\n    context.memo('help.insertHorizontalRule', lang.help.insertHorizontalRule);\n\n    /**\n     * remove bogus node and character\n     */\n    this.removeBogus = function () {\n      var bogusNode = $editable.data(KEY_BOGUS);\n      if (!bogusNode) {\n        return;\n      }\n\n      var textNode = list.find(list.from(bogusNode.childNodes), dom.isText);\n\n      var bogusCharIdx = textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);\n      if (bogusCharIdx !== -1) {\n        textNode.deleteData(bogusCharIdx, 1);\n      }\n\n      if (dom.isEmpty(bogusNode)) {\n        dom.remove(bogusNode);\n      }\n\n      $editable.removeData(KEY_BOGUS);\n    };\n\n    /**\n     * lineHeight\n     * @param {String} value\n     */\n    this.lineHeight = this.wrapCommand(function (value) {\n      style.stylePara(this.createRange(), {\n        lineHeight: value\n      });\n    });\n\n    /**\n     * unlink\n     *\n     * @type command\n     */\n    this.unlink = function () {\n      var rng = this.createRange();\n      if (rng.isOnAnchor()) {\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\n        rng = range.createFromNode(anchor);\n        rng.select();\n\n        beforeCommand();\n        document.execCommand('unlink');\n        afterCommand();\n      }\n    };\n\n    /**\n     * create link (command)\n     *\n     * @param {Object} linkInfo\n     */\n    this.createLink = this.wrapCommand(function (linkInfo) {\n      var linkUrl = linkInfo.url;\n      var linkText = linkInfo.text;\n      var isNewWindow = linkInfo.isNewWindow;\n      var rng = linkInfo.range || this.createRange();\n      var isTextChanged = rng.toString() !== linkText;\n\n      // handle spaced urls from input\n      if (typeof linkUrl === 'string') {\n        linkUrl = linkUrl.trim();\n      }\n\n      if (options.onCreateLink) {\n        linkUrl = options.onCreateLink(linkUrl);\n      }\n\n      var anchors = [];\n      if (isTextChanged) {\n        rng = rng.deleteContents();\n        var anchor = rng.insertNode($('<A>' + linkText + '</A>')[0]);\n        anchors.push(anchor);\n      } else {\n        anchors = style.styleNodes(rng, {\n          nodeName: 'A',\n          expandClosestSibling: true,\n          onlyPartialContains: true\n        });\n      }\n\n      $.each(anchors, function (idx, anchor) {\n        // if url doesn't match an URL schema, set http:// as default\n        linkUrl = /^[A-Za-z][A-Za-z0-9+-.]*\\:[\\/\\/]?/.test(linkUrl) ?\n          linkUrl : 'http://' + linkUrl;\n\n        $(anchor).attr('href', linkUrl);\n        if (isNewWindow) {\n          $(anchor).attr('target', '_blank');\n        } else {\n          $(anchor).removeAttr('target');\n        }\n      });\n\n      var startRange = range.createFromNodeBefore(list.head(anchors));\n      var startPoint = startRange.getStartPoint();\n      var endRange = range.createFromNodeAfter(list.last(anchors));\n      var endPoint = endRange.getEndPoint();\n\n      range.create(\n        startPoint.node,\n        startPoint.offset,\n        endPoint.node,\n        endPoint.offset\n      ).select();\n    });\n\n    /**\n     * returns link info\n     *\n     * @return {Object}\n     * @return {WrappedRange} return.range\n     * @return {String} return.text\n     * @return {Boolean} [return.isNewWindow=true]\n     * @return {String} [return.url=\"\"]\n     */\n    this.getLinkInfo = function () {\n      var rng = this.createRange().expand(dom.isAnchor);\n\n      // Get the first anchor on range(for edit).\n      var $anchor = $(list.head(rng.nodes(dom.isAnchor)));\n\n      return {\n        range: rng,\n        text: rng.toString(),\n        isNewWindow: $anchor.length ? $anchor.attr('target') === '_blank' : false,\n        url: $anchor.length ? $anchor.attr('href') : ''\n      };\n    };\n\n    /**\n     * setting color\n     *\n     * @param {Object} sObjColor  color code\n     * @param {String} sObjColor.foreColor foreground color\n     * @param {String} sObjColor.backColor background color\n     */\n    this.color = this.wrapCommand(function (colorInfo) {\n      var foreColor = colorInfo.foreColor;\n      var backColor = colorInfo.backColor;\n\n      if (foreColor) { document.execCommand('foreColor', false, foreColor); }\n      if (backColor) { document.execCommand('backColor', false, backColor); }\n    });\n\n    /**\n     * insert Table\n     *\n     * @param {String} dimension of table (ex : \"5x5\")\n     */\n    this.insertTable = this.wrapCommand(function (dim) {\n      var dimension = dim.split('x');\n\n      var rng = this.createRange().deleteContents();\n      rng.insertNode(table.createTable(dimension[0], dimension[1], options));\n    });\n\n    /**\n     * float me\n     *\n     * @param {String} value\n     */\n    this.floatMe = this.wrapCommand(function (value) {\n      var $target = $(this.restoreTarget());\n      $target.css('float', value);\n    });\n\n    /**\n     * resize overlay element\n     * @param {String} value\n     */\n    this.resize = this.wrapCommand(function (value) {\n      var $target = $(this.restoreTarget());\n      $target.css({\n        width: value * 100 + '%',\n        height: ''\n      });\n    });\n\n    /**\n     * @param {Position} pos\n     * @param {jQuery} $target - target element\n     * @param {Boolean} [bKeepRatio] - keep ratio\n     */\n    this.resizeTo = function (pos, $target, bKeepRatio) {\n      var imageSize;\n      if (bKeepRatio) {\n        var newRatio = pos.y / pos.x;\n        var ratio = $target.data('ratio');\n        imageSize = {\n          width: ratio > newRatio ? pos.x : pos.y / ratio,\n          height: ratio > newRatio ? pos.x * ratio : pos.y\n        };\n      } else {\n        imageSize = {\n          width: pos.x,\n          height: pos.y\n        };\n      }\n\n      $target.css(imageSize);\n    };\n\n    /**\n     * remove media object\n     */\n    this.removeMedia = this.wrapCommand(function () {\n      var $target = $(this.restoreTarget()).detach();\n      context.triggerEvent('media.delete', $target, $editable);\n    });\n\n    /**\n     * returns whether editable area has focus or not.\n     */\n    this.hasFocus = function () {\n      return $editable.is(':focus');\n    };\n\n    /**\n     * set focus\n     */\n    this.focus = function () {\n      // [workaround] Screen will move when page is scolled in IE.\n      //  - do focus when not focused\n      if (!this.hasFocus()) {\n        $editable.focus();\n      }\n    };\n\n    /**\n     * returns whether contents is empty or not.\n     * @return {Boolean}\n     */\n    this.isEmpty = function () {\n      return dom.isEmpty($editable[0]) || dom.emptyPara === $editable.html();\n    };\n\n    /**\n     * Removes all contents and restores the editable instance to an _emptyPara_.\n     */\n    this.empty = function () {\n      context.invoke('code', dom.emptyPara);\n    };\n  };\n\n  var Clipboard = function (context) {\n    var self = this;\n\n    var $editable = context.layoutInfo.editable;\n\n    this.events = {\n      'summernote.keydown': function (we, e) {\n        if (self.needKeydownHook()) {\n          if ((e.ctrlKey || e.metaKey) && e.keyCode === key.code.V) {\n            context.invoke('editor.saveRange');\n            self.$paste.focus();\n\n            setTimeout(function () {\n              self.pasteByHook();\n            }, 0);\n          }\n        }\n      }\n    };\n\n    this.needKeydownHook = function () {\n      return (agent.isMSIE && agent.browserVersion > 10) || agent.isFF;\n    };\n\n    this.initialize = function () {\n      // [workaround] getting image from clipboard\n      //  - IE11 and Firefox: CTRL+v hook\n      //  - Webkit: event.clipboardData\n      if (this.needKeydownHook()) {\n        this.$paste = $('<div tabindex=\"-1\" />').attr('contenteditable', true).css({\n          position: 'absolute',\n          left: -100000,\n          opacity: 0\n        });\n        $editable.before(this.$paste);\n\n        this.$paste.on('paste', function (event) {\n          context.triggerEvent('paste', event);\n        });\n      } else {\n        $editable.on('paste', this.pasteByEvent);\n      }\n    };\n\n    this.destroy = function () {\n      if (this.needKeydownHook()) {\n        this.$paste.remove();\n        this.$paste = null;\n      }\n    };\n\n    this.pasteByHook = function () {\n      var node = this.$paste[0].firstChild;\n\n      if (dom.isImg(node)) {\n        var dataURI = node.src;\n        var decodedData = atob(dataURI.split(',')[1]);\n        var array = new Uint8Array(decodedData.length);\n        for (var i = 0; i < decodedData.length; i++) {\n          array[i] = decodedData.charCodeAt(i);\n        }\n\n        var blob = new Blob([array], { type: 'image/png' });\n        blob.name = 'clipboard.png';\n\n        context.invoke('editor.restoreRange');\n        context.invoke('editor.focus');\n        context.invoke('editor.insertImagesOrCallback', [blob]);\n      } else {\n        var pasteContent = $('<div />').html(this.$paste.html()).html();\n        context.invoke('editor.restoreRange');\n        context.invoke('editor.focus');\n\n        if (pasteContent) {\n          context.invoke('editor.pasteHTML', pasteContent);\n        }\n      }\n\n      this.$paste.empty();\n    };\n\n    /**\n     * paste by clipboard event\n     *\n     * @param {Event} event\n     */\n    this.pasteByEvent = function (event) {\n      var clipboardData = event.originalEvent.clipboardData;\n      if (clipboardData && clipboardData.items && clipboardData.items.length) {\n        var item = list.head(clipboardData.items);\n        if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {\n          context.invoke('editor.insertImagesOrCallback', [item.getAsFile()]);\n        }\n        context.invoke('editor.afterCommand');\n      }\n    };\n  };\n\n  var Dropzone = function (context) {\n    var $document = $(document);\n    var $editor = context.layoutInfo.editor;\n    var $editable = context.layoutInfo.editable;\n    var options = context.options;\n    var lang = options.langInfo;\n    var documentEventHandlers = {};\n\n    var $dropzone = $([\n      '<div class=\"note-dropzone\">',\n      '  <div class=\"note-dropzone-message\"/>',\n      '</div>'\n    ].join('')).prependTo($editor);\n\n    var detachDocumentEvent = function () {\n      Object.keys(documentEventHandlers).forEach(function (key) {\n        $document.off(key.substr(2).toLowerCase(), documentEventHandlers[key]);\n      });\n      documentEventHandlers = {};\n    };\n\n    /**\n     * attach Drag and Drop Events\n     */\n    this.initialize = function () {\n      if (options.disableDragAndDrop) {\n        // prevent default drop event\n        documentEventHandlers.onDrop = function (e) {\n          e.preventDefault();\n        };\n        $document.on('drop', documentEventHandlers.onDrop);\n      } else {\n        this.attachDragAndDropEvent();\n      }\n    };\n\n    /**\n     * attach Drag and Drop Events\n     */\n    this.attachDragAndDropEvent = function () {\n      var collection = $(),\n          $dropzoneMessage = $dropzone.find('.note-dropzone-message');\n\n      documentEventHandlers.onDragenter = function (e) {\n        var isCodeview = context.invoke('codeview.isActivated');\n        var hasEditorSize = $editor.width() > 0 && $editor.height() > 0;\n        if (!isCodeview && !collection.length && hasEditorSize) {\n          $editor.addClass('dragover');\n          $dropzone.width($editor.width());\n          $dropzone.height($editor.height());\n          $dropzoneMessage.text(lang.image.dragImageHere);\n        }\n        collection = collection.add(e.target);\n      };\n\n      documentEventHandlers.onDragleave = function (e) {\n        collection = collection.not(e.target);\n        if (!collection.length) {\n          $editor.removeClass('dragover');\n        }\n      };\n\n      documentEventHandlers.onDrop = function () {\n        collection = $();\n        $editor.removeClass('dragover');\n      };\n\n      // show dropzone on dragenter when dragging a object to document\n      // -but only if the editor is visible, i.e. has a positive width and height\n      $document.on('dragenter', documentEventHandlers.onDragenter)\n        .on('dragleave', documentEventHandlers.onDragleave)\n        .on('drop', documentEventHandlers.onDrop);\n\n      // change dropzone's message on hover.\n      $dropzone.on('dragenter', function () {\n        $dropzone.addClass('hover');\n        $dropzoneMessage.text(lang.image.dropImage);\n      }).on('dragleave', function () {\n        $dropzone.removeClass('hover');\n        $dropzoneMessage.text(lang.image.dragImageHere);\n      });\n\n      // attach dropImage\n      $dropzone.on('drop', function (event) {\n        var dataTransfer = event.originalEvent.dataTransfer;\n\n        if (dataTransfer && dataTransfer.files && dataTransfer.files.length) {\n          event.preventDefault();\n          $editable.focus();\n          context.invoke('editor.insertImagesOrCallback', dataTransfer.files);\n        } else {\n          $.each(dataTransfer.types, function (idx, type) {\n            var content = dataTransfer.getData(type);\n\n            if (type.toLowerCase().indexOf('text') > -1) {\n              context.invoke('editor.pasteHTML', content);\n            } else {\n              $(content).each(function () {\n                context.invoke('editor.insertNode', this);\n              });\n            }\n          });\n        }\n      }).on('dragover', false); // prevent default dragover event\n    };\n\n    this.destroy = function () {\n      detachDocumentEvent();\n    };\n  };\n\n\n  var CodeMirror;\n  if (agent.hasCodeMirror) {\n    if (agent.isSupportAmd) {\n      require(['codemirror'], function (cm) {\n        CodeMirror = cm;\n      });\n    } else {\n      CodeMirror = window.CodeMirror;\n    }\n  }\n\n  /**\n   * @class Codeview\n   */\n  var Codeview = function (context) {\n    var $editor = context.layoutInfo.editor;\n    var $editable = context.layoutInfo.editable;\n    var $codable = context.layoutInfo.codable;\n    var options = context.options;\n\n    this.sync = function () {\n      var isCodeview = this.isActivated();\n      if (isCodeview && agent.hasCodeMirror) {\n        $codable.data('cmEditor').save();\n      }\n    };\n\n    /**\n     * @return {Boolean}\n     */\n    this.isActivated = function () {\n      return $editor.hasClass('codeview');\n    };\n\n    /**\n     * toggle codeview\n     */\n    this.toggle = function () {\n      if (this.isActivated()) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n      context.triggerEvent('codeview.toggled');\n    };\n\n    /**\n     * activate code view\n     */\n    this.activate = function () {\n      $codable.val(dom.html($editable, options.prettifyHtml));\n      $codable.height($editable.height());\n\n      context.invoke('toolbar.updateCodeview', true);\n      $editor.addClass('codeview');\n      $codable.focus();\n\n      // activate CodeMirror as codable\n      if (agent.hasCodeMirror) {\n        var cmEditor = CodeMirror.fromTextArea($codable[0], options.codemirror);\n\n        // CodeMirror TernServer\n        if (options.codemirror.tern) {\n          var server = new CodeMirror.TernServer(options.codemirror.tern);\n          cmEditor.ternServer = server;\n          cmEditor.on('cursorActivity', function (cm) {\n            server.updateArgHints(cm);\n          });\n        }\n\n        // CodeMirror hasn't Padding.\n        cmEditor.setSize(null, $editable.outerHeight());\n        $codable.data('cmEditor', cmEditor);\n      }\n    };\n\n    /**\n     * deactivate code view\n     */\n    this.deactivate = function () {\n      // deactivate CodeMirror as codable\n      if (agent.hasCodeMirror) {\n        var cmEditor = $codable.data('cmEditor');\n        $codable.val(cmEditor.getValue());\n        cmEditor.toTextArea();\n      }\n\n      var value = dom.value($codable, options.prettifyHtml) || dom.emptyPara;\n      var isChange = $editable.html() !== value;\n\n      $editable.html(value);\n      $editable.height(options.height ? $codable.height() : 'auto');\n      $editor.removeClass('codeview');\n\n      if (isChange) {\n        context.triggerEvent('change', $editable.html(), $editable);\n      }\n\n      $editable.focus();\n\n      context.invoke('toolbar.updateCodeview', false);\n    };\n\n    this.destroy = function () {\n      if (this.isActivated()) {\n        this.deactivate();\n      }\n    };\n  };\n\n  var EDITABLE_PADDING = 24;\n\n  var Statusbar = function (context) {\n    var $document = $(document);\n    var $statusbar = context.layoutInfo.statusbar;\n    var $editable = context.layoutInfo.editable;\n    var options = context.options;\n\n    this.initialize = function () {\n      if (options.airMode || options.disableResizeEditor) {\n        return;\n      }\n\n      $statusbar.on('mousedown', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        var editableTop = $editable.offset().top - $document.scrollTop();\n\n        $document.on('mousemove', function (event) {\n          var height = event.clientY - (editableTop + EDITABLE_PADDING);\n\n          height = (options.minheight > 0) ? Math.max(height, options.minheight) : height;\n          height = (options.maxHeight > 0) ? Math.min(height, options.maxHeight) : height;\n\n          $editable.height(height);\n        }).one('mouseup', function () {\n          $document.off('mousemove');\n        });\n      });\n    };\n\n    this.destroy = function () {\n      $statusbar.off();\n      $statusbar.remove();\n    };\n  };\n\n  var Fullscreen = function (context) {\n    var $editor = context.layoutInfo.editor;\n    var $toolbar = context.layoutInfo.toolbar;\n    var $editable = context.layoutInfo.editable;\n    var $codable = context.layoutInfo.codable;\n\n    var $window = $(window);\n    var $scrollbar = $('html, body');\n\n    /**\n     * toggle fullscreen\n     */\n    this.toggle = function () {\n      var resize = function (size) {\n        $editable.css('height', size.h);\n        $codable.css('height', size.h);\n        if ($codable.data('cmeditor')) {\n          $codable.data('cmeditor').setsize(null, size.h);\n        }\n      };\n\n      $editor.toggleClass('fullscreen');\n      if (this.isFullscreen()) {\n        $editable.data('orgHeight', $editable.css('height'));\n\n        $window.on('resize', function () {\n          resize({\n            h: $window.height() - $toolbar.outerHeight()\n          });\n        }).trigger('resize');\n\n        $scrollbar.css('overflow', 'hidden');\n      } else {\n        $window.off('resize');\n        resize({\n          h: $editable.data('orgHeight')\n        });\n        $scrollbar.css('overflow', 'visible');\n      }\n\n      context.invoke('toolbar.updateFullscreen', this.isFullscreen());\n    };\n\n    this.isFullscreen = function () {\n      return $editor.hasClass('fullscreen');\n    };\n  };\n\n  var Handle = function (context) {\n    var self = this;\n\n    var $document = $(document);\n    var $editingArea = context.layoutInfo.editingArea;\n    var options = context.options;\n\n    this.events = {\n      'summernote.mousedown': function (we, e) {\n        if (self.update(e.target)) {\n          e.preventDefault();\n        }\n      },\n      'summernote.keyup summernote.scroll summernote.change summernote.dialog.shown': function () {\n        self.update();\n      }\n    };\n\n    this.initialize = function () {\n      this.$handle = $([\n        '<div class=\"note-handle\">',\n        '<div class=\"note-control-selection\">',\n        '<div class=\"note-control-selection-bg\"></div>',\n        '<div class=\"note-control-holder note-control-nw\"></div>',\n        '<div class=\"note-control-holder note-control-ne\"></div>',\n        '<div class=\"note-control-holder note-control-sw\"></div>',\n        '<div class=\"',\n        (options.disableResizeImage ? 'note-control-holder' : 'note-control-sizing'),\n        ' note-control-se\"></div>',\n        (options.disableResizeImage ? '' : '<div class=\"note-control-selection-info\"></div>'),\n        '</div>',\n        '</div>'\n      ].join('')).prependTo($editingArea);\n\n      this.$handle.on('mousedown', function (event) {\n        if (dom.isControlSizing(event.target)) {\n          event.preventDefault();\n          event.stopPropagation();\n\n          var $target = self.$handle.find('.note-control-selection').data('target'),\n              posStart = $target.offset(),\n              scrollTop = $document.scrollTop();\n\n          $document.on('mousemove', function (event) {\n            context.invoke('editor.resizeTo', {\n              x: event.clientX - posStart.left,\n              y: event.clientY - (posStart.top - scrollTop)\n            }, $target, !event.shiftKey);\n\n            self.update($target[0]);\n          }).one('mouseup', function (e) {\n            e.preventDefault();\n            $document.off('mousemove');\n            context.invoke('editor.afterCommand');\n          });\n\n          if (!$target.data('ratio')) { // original ratio.\n            $target.data('ratio', $target.height() / $target.width());\n          }\n        }\n      });\n    };\n\n    this.destroy = function () {\n      this.$handle.remove();\n    };\n\n    this.update = function (target) {\n      var isImage = dom.isImg(target);\n      var $selection = this.$handle.find('.note-control-selection');\n\n      context.invoke('imagePopover.update', target);\n\n      if (isImage) {\n        var $image = $(target);\n        var pos = $image.position();\n\n        // include margin\n        var imageSize = {\n          w: $image.outerWidth(true),\n          h: $image.outerHeight(true)\n        };\n\n        $selection.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top,\n          width: imageSize.w,\n          height: imageSize.h\n        }).data('target', $image); // save current image element.\n\n        var sizingText = imageSize.w + 'x' + imageSize.h;\n        $selection.find('.note-control-selection-info').text(sizingText);\n        context.invoke('editor.saveTarget', target);\n      } else {\n        this.hide();\n      }\n\n      return isImage;\n    };\n\n    /**\n     * hide\n     *\n     * @param {jQuery} $handle\n     */\n    this.hide = function () {\n      context.invoke('editor.clearTarget');\n      this.$handle.children().hide();\n    };\n  };\n\n  var AutoLink = function (context) {\n    var self = this;\n    var defaultScheme = 'http://';\n    var linkPattern = /^([A-Za-z][A-Za-z0-9+-.]*\\:[\\/\\/]?|mailto:[A-Z0-9._%+-]+@)?(www\\.)?(.+)$/i;\n\n    this.events = {\n      'summernote.keyup': function (we, e) {\n        if (!e.isDefaultPrevented()) {\n          self.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function (we, e) {\n        self.handleKeydown(e);\n      }\n    };\n\n    this.initialize = function () {\n      this.lastWordRange = null;\n    };\n\n    this.destroy = function () {\n      this.lastWordRange = null;\n    };\n\n    this.replace = function () {\n      if (!this.lastWordRange) {\n        return;\n      }\n\n      var keyword = this.lastWordRange.toString();\n      var match = keyword.match(linkPattern);\n\n      if (match && (match[1] || match[2])) {\n        var link = match[1] ? keyword : defaultScheme + keyword;\n        var node = $('<a />').html(keyword).attr('href', link)[0];\n\n        this.lastWordRange.insertNode(node);\n        this.lastWordRange = null;\n        context.invoke('editor.focus');\n      }\n\n    };\n\n    this.handleKeydown = function (e) {\n      if (list.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {\n        var wordRange = context.invoke('editor.createRange').getWordRange();\n        this.lastWordRange = wordRange;\n      }\n    };\n\n    this.handleKeyup = function (e) {\n      if (list.contains([key.code.ENTER, key.code.SPACE], e.keyCode)) {\n        this.replace();\n      }\n    };\n  };\n\n  /**\n   * textarea auto sync.\n   */\n  var AutoSync = function (context) {\n    var $note = context.layoutInfo.note;\n\n    this.events = {\n      'summernote.change': function () {\n        $note.val(context.invoke('code'));\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return dom.isTextarea($note[0]);\n    };\n  };\n\n  var Placeholder = function (context) {\n    var self = this;\n    var $editingArea = context.layoutInfo.editingArea;\n    var options = context.options;\n\n    this.events = {\n      'summernote.init summernote.change': function () {\n        self.update();\n      },\n      'summernote.codeview.toggled': function () {\n        self.update();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return !!options.placeholder;\n    };\n\n    this.initialize = function () {\n      this.$placeholder = $('<div class=\"note-placeholder\">');\n      this.$placeholder.on('click', function () {\n        context.invoke('focus');\n      }).text(options.placeholder).prependTo($editingArea);\n    };\n\n    this.destroy = function () {\n      this.$placeholder.remove();\n    };\n\n    this.update = function () {\n      var isShow = !context.invoke('codeview.isActivated') && context.invoke('editor.isEmpty');\n      this.$placeholder.toggle(isShow);\n    };\n  };\n\n  var Buttons = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $toolbar = context.layoutInfo.toolbar;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    var invertedKeyMap = func.invertObject(options.keyMap[agent.isMac ? 'mac' : 'pc']);\n\n    var representShortcut = this.representShortcut = function (editorMethod) {\n      var shortcut = invertedKeyMap[editorMethod];\n      if (!options.shortcuts || !shortcut) {\n        return '';\n      }\n\n      if (agent.isMac) {\n        shortcut = shortcut.replace('CMD', '').replace('SHIFT', '');\n      }\n\n      shortcut = shortcut.replace('BACKSLASH', '\\\\')\n                         .replace('SLASH', '/')\n                         .replace('LEFTBRACKET', '[')\n                         .replace('RIGHTBRACKET', ']');\n\n      return ' (' + shortcut + ')';\n    };\n\n    this.initialize = function () {\n      this.addToolbarButtons();\n      this.addImagePopoverButtons();\n      this.addLinkPopoverButtons();\n      this.fontInstalledMap = {};\n    };\n\n    this.destroy = function () {\n      delete this.fontInstalledMap;\n    };\n\n    this.isFontInstalled = function (name) {\n      if (!self.fontInstalledMap.hasOwnProperty(name)) {\n        self.fontInstalledMap[name] = agent.isFontInstalled(name) ||\n          list.contains(options.fontNamesIgnoreCheck, name);\n      }\n\n      return self.fontInstalledMap[name];\n    };\n\n    this.addToolbarButtons = function () {\n      context.memo('button.style', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.icon(options.icons.magic) + ' ' + ui.icon(options.icons.caret, 'span'),\n            tooltip: lang.style.style,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdown({\n            className: 'dropdown-style',\n            items: context.options.styleTags,\n            template: function (item) {\n\n              if (typeof item === 'string') {\n                item = { tag: item, title: (lang.style.hasOwnProperty(item) ? lang.style[item] : item) };\n              }\n\n              var tag = item.tag;\n              var title = item.title;\n              var style = item.style ? ' style=\"' + item.style + '\" ' : '';\n              var className = item.className ? ' class=\"' + item.className + '\"' : '';\n\n              return '<' + tag + style + className + '>' + title + '</' + tag +  '>';\n            },\n            click: context.createInvokeHandler('editor.formatBlock')\n          })\n        ]).render();\n      });\n\n      context.memo('button.bold', function () {\n        return ui.button({\n          className: 'note-btn-bold',\n          contents: ui.icon(options.icons.bold),\n          tooltip: lang.font.bold + representShortcut('bold'),\n          click: context.createInvokeHandler('editor.bold')\n        }).render();\n      });\n\n      context.memo('button.italic', function () {\n        return ui.button({\n          className: 'note-btn-italic',\n          contents: ui.icon(options.icons.italic),\n          tooltip: lang.font.italic + representShortcut('italic'),\n          click: context.createInvokeHandler('editor.italic')\n        }).render();\n      });\n\n      context.memo('button.underline', function () {\n        return ui.button({\n          className: 'note-btn-underline',\n          contents: ui.icon(options.icons.underline),\n          tooltip: lang.font.underline + representShortcut('underline'),\n          click: context.createInvokeHandler('editor.underline')\n        }).render();\n      });\n\n      context.memo('button.clear', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.eraser),\n          tooltip: lang.font.clear + representShortcut('removeFormat'),\n          click: context.createInvokeHandler('editor.removeFormat')\n        }).render();\n      });\n\n      context.memo('button.strikethrough', function () {\n        return ui.button({\n          className: 'note-btn-strikethrough',\n          contents: ui.icon(options.icons.strikethrough),\n          tooltip: lang.font.strikethrough + representShortcut('strikethrough'),\n          click: context.createInvokeHandler('editor.strikethrough')\n        }).render();\n      });\n\n      context.memo('button.superscript', function () {\n        return ui.button({\n          className: 'note-btn-superscript',\n          contents: ui.icon(options.icons.superscript),\n          tooltip: lang.font.superscript,\n          click: context.createInvokeHandler('editor.superscript')\n        }).render();\n      });\n\n      context.memo('button.subscript', function () {\n        return ui.button({\n          className: 'note-btn-subscript',\n          contents: ui.icon(options.icons.subscript),\n          tooltip: lang.font.subscript,\n          click: context.createInvokeHandler('editor.subscript')\n        }).render();\n      });\n\n      context.memo('button.fontname', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: '<span class=\"note-current-fontname\"/> ' + ui.icon(options.icons.caret, 'span'),\n            tooltip: lang.font.name,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdownCheck({\n            className: 'dropdown-fontname',\n            checkClassName: options.icons.menuCheck,\n            items: options.fontNames.filter(self.isFontInstalled),\n            template: function (item) {\n              return '<span style=\"font-family:' + item + '\">' + item + '</span>';\n            },\n            click: context.createInvokeHandler('editor.fontName')\n          })\n        ]).render();\n      });\n\n      context.memo('button.fontsize', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: '<span class=\"note-current-fontsize\"/>' + ui.icon(options.icons.caret, 'span'),\n            tooltip: lang.font.size,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdownCheck({\n            className: 'dropdown-fontsize',\n            checkClassName: options.icons.menuCheck,\n            items: options.fontSizes,\n            click: context.createInvokeHandler('editor.fontSize')\n          })\n        ]).render();\n      });\n\n      context.memo('button.color', function () {\n        return ui.buttonGroup({\n          className: 'note-color',\n          children: [\n            ui.button({\n              className: 'note-current-color-button',\n              contents: ui.icon(options.icons.font + ' note-recent-color'),\n              tooltip: lang.color.recent,\n              click: function (e) {\n                var $button = $(e.currentTarget);\n                context.invoke('editor.color', {\n                  backColor: $button.attr('data-backColor'),\n                  foreColor: $button.attr('data-foreColor')\n                });\n              },\n              callback: function ($button) {\n                var $recentColor = $button.find('.note-recent-color');\n                $recentColor.css('background-color', '#FFFF00');\n                $button.attr('data-backColor', '#FFFF00');\n              }\n            }),\n            ui.button({\n              className: 'dropdown-toggle',\n              contents: ui.icon(options.icons.caret, 'span'),\n              tooltip: lang.color.more,\n              data: {\n                toggle: 'dropdown'\n              }\n            }),\n            ui.dropdown({\n              items: [\n                '<li>',\n                '<div class=\"btn-group\">',\n                '  <div class=\"note-palette-title\">' + lang.color.background + '</div>',\n                '  <div>',\n                '    <button type=\"button\" class=\"note-color-reset btn btn-default\" data-event=\"backColor\" data-value=\"inherit\">',\n                lang.color.transparent,\n                '    </button>',\n                '  </div>',\n                '  <div class=\"note-holder\" data-event=\"backColor\"/>',\n                '</div>',\n                '<div class=\"btn-group\">',\n                '  <div class=\"note-palette-title\">' + lang.color.foreground + '</div>',\n                '  <div>',\n                '    <button type=\"button\" class=\"note-color-reset btn btn-default\" data-event=\"removeFormat\" data-value=\"foreColor\">',\n                lang.color.resetToDefault,\n                '    </button>',\n                '  </div>',\n                '  <div class=\"note-holder\" data-event=\"foreColor\"/>',\n                '</div>',\n                '</li>'\n              ].join(''),\n              callback: function ($dropdown) {\n                $dropdown.find('.note-holder').each(function () {\n                  var $holder = $(this);\n                  $holder.append(ui.palette({\n                    colors: options.colors,\n                    eventName: $holder.data('event')\n                  }).render());\n                });\n              },\n              click: function (event) {\n                var $button = $(event.target);\n                var eventName = $button.data('event');\n                var value = $button.data('value');\n\n                if (eventName && value) {\n                  var key = eventName === 'backColor' ? 'background-color' : 'color';\n                  var $color = $button.closest('.note-color').find('.note-recent-color');\n                  var $currentButton = $button.closest('.note-color').find('.note-current-color-button');\n\n                  $color.css(key, value);\n                  $currentButton.attr('data-' + eventName, value);\n                  context.invoke('editor.' + eventName, value);\n                }\n              }\n            })\n          ]\n        }).render();\n      });\n\n      context.memo('button.ul',  function () {\n        return ui.button({\n          contents: ui.icon(options.icons.unorderedlist),\n          tooltip: lang.lists.unordered + representShortcut('insertUnorderedList'),\n          click: context.createInvokeHandler('editor.insertUnorderedList')\n        }).render();\n      });\n\n      context.memo('button.ol', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.orderedlist),\n          tooltip: lang.lists.ordered + representShortcut('insertOrderedList'),\n          click:  context.createInvokeHandler('editor.insertOrderedList')\n        }).render();\n      });\n\n      var justifyLeft = ui.button({\n        contents: ui.icon(options.icons.alignLeft),\n        tooltip: lang.paragraph.left + representShortcut('justifyLeft'),\n        click: context.createInvokeHandler('editor.justifyLeft')\n      });\n\n      var justifyCenter = ui.button({\n        contents: ui.icon(options.icons.alignCenter),\n        tooltip: lang.paragraph.center + representShortcut('justifyCenter'),\n        click: context.createInvokeHandler('editor.justifyCenter')\n      });\n\n      var justifyRight = ui.button({\n        contents: ui.icon(options.icons.alignRight),\n        tooltip: lang.paragraph.right + representShortcut('justifyRight'),\n        click: context.createInvokeHandler('editor.justifyRight')\n      });\n\n      var justifyFull = ui.button({\n        contents: ui.icon(options.icons.alignJustify),\n        tooltip: lang.paragraph.justify + representShortcut('justifyFull'),\n        click: context.createInvokeHandler('editor.justifyFull')\n      });\n\n      var outdent = ui.button({\n        contents: ui.icon(options.icons.outdent),\n        tooltip: lang.paragraph.outdent + representShortcut('outdent'),\n        click: context.createInvokeHandler('editor.outdent')\n      });\n\n      var indent = ui.button({\n        contents: ui.icon(options.icons.indent),\n        tooltip: lang.paragraph.indent + representShortcut('indent'),\n        click: context.createInvokeHandler('editor.indent')\n      });\n\n      context.memo('button.justifyLeft', func.invoke(justifyLeft, 'render'));\n      context.memo('button.justifyCenter', func.invoke(justifyCenter, 'render'));\n      context.memo('button.justifyRight', func.invoke(justifyRight, 'render'));\n      context.memo('button.justifyFull', func.invoke(justifyFull, 'render'));\n      context.memo('button.outdent', func.invoke(outdent, 'render'));\n      context.memo('button.indent', func.invoke(indent, 'render'));\n\n      context.memo('button.paragraph', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.icon(options.icons.alignLeft) + ' ' + ui.icon(options.icons.caret, 'span'),\n            tooltip: lang.paragraph.paragraph,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdown([\n            ui.buttonGroup({\n              className: 'note-align',\n              children: [justifyLeft, justifyCenter, justifyRight, justifyFull]\n            }),\n            ui.buttonGroup({\n              className: 'note-list',\n              children: [outdent, indent]\n            })\n          ])\n        ]).render();\n      });\n\n      context.memo('button.height', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.icon(options.icons.textHeight) + ' ' + ui.icon(options.icons.caret, 'span'),\n            tooltip: lang.font.height,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdownCheck({\n            items: options.lineHeights,\n            checkClassName: options.icons.menuCheck,\n            className: 'dropdown-line-height',\n            click: context.createInvokeHandler('editor.lineHeight')\n          })\n        ]).render();\n      });\n\n      context.memo('button.table', function () {\n        return ui.buttonGroup([\n          ui.button({\n            className: 'dropdown-toggle',\n            contents: ui.icon(options.icons.table) + ' ' + ui.icon(options.icons.caret, 'span'),\n            tooltip: lang.table.table,\n            data: {\n              toggle: 'dropdown'\n            }\n          }),\n          ui.dropdown({\n            className: 'note-table',\n            items: [\n              '<div class=\"note-dimension-picker\">',\n              '  <div class=\"note-dimension-picker-mousecatcher\" data-event=\"insertTable\" data-value=\"1x1\"/>',\n              '  <div class=\"note-dimension-picker-highlighted\"/>',\n              '  <div class=\"note-dimension-picker-unhighlighted\"/>',\n              '</div>',\n              '<div class=\"note-dimension-display\">1 x 1</div>'\n            ].join('')\n          })\n        ], {\n          callback: function ($node) {\n            var $catcher = $node.find('.note-dimension-picker-mousecatcher');\n            $catcher.css({\n              width: options.insertTableMaxSize.col + 'em',\n              height: options.insertTableMaxSize.row + 'em'\n            }).mousedown(context.createInvokeHandler('editor.insertTable'))\n              .on('mousemove', self.tableMoveHandler);\n          }\n        }).render();\n      });\n\n      context.memo('button.link', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.link),\n          tooltip: lang.link.link + representShortcut('linkDialog.show'),\n          click: context.createInvokeHandler('linkDialog.show')\n        }).render();\n      });\n\n      context.memo('button.picture', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.picture),\n          tooltip: lang.image.image,\n          click: context.createInvokeHandler('imageDialog.show')\n        }).render();\n      });\n\n      context.memo('button.video', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.video),\n          tooltip: lang.video.video,\n          click: context.createInvokeHandler('videoDialog.show')\n        }).render();\n      });\n\n      context.memo('button.hr', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.minus),\n          tooltip: lang.hr.insert + representShortcut('insertHorizontalRule'),\n          click: context.createInvokeHandler('editor.insertHorizontalRule')\n        }).render();\n      });\n\n      context.memo('button.fullscreen', function () {\n        return ui.button({\n          className: 'btn-fullscreen',\n          contents: ui.icon(options.icons.arrowsAlt),\n          tooltip: lang.options.fullscreen,\n          click: context.createInvokeHandler('fullscreen.toggle')\n        }).render();\n      });\n\n      context.memo('button.codeview', function () {\n        return ui.button({\n          className: 'btn-codeview',\n          contents: ui.icon(options.icons.code),\n          tooltip: lang.options.codeview,\n          click: context.createInvokeHandler('codeview.toggle')\n        }).render();\n      });\n\n      context.memo('button.redo', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.redo),\n          tooltip: lang.history.redo + representShortcut('redo'),\n          click: context.createInvokeHandler('editor.redo')\n        }).render();\n      });\n\n      context.memo('button.undo', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.undo),\n          tooltip: lang.history.undo + representShortcut('undo'),\n          click: context.createInvokeHandler('editor.undo')\n        }).render();\n      });\n\n      context.memo('button.help', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.question),\n          tooltip: lang.options.help,\n          click: context.createInvokeHandler('helpDialog.show')\n        }).render();\n      });\n    };\n\n    /**\n     * image : [\n     *   ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n     *   ['float', ['floatLeft', 'floatRight', 'floatNone' ]],\n     *   ['remove', ['removeMedia']]\n     * ],\n     */\n    this.addImagePopoverButtons = function () {\n      // Image Size Buttons\n      context.memo('button.imageSize100', function () {\n        return ui.button({\n          contents: '<span class=\"note-fontsize-10\">100%</span>',\n          tooltip: lang.image.resizeFull,\n          click: context.createInvokeHandler('editor.resize', '1')\n        }).render();\n      });\n      context.memo('button.imageSize50', function () {\n        return  ui.button({\n          contents: '<span class=\"note-fontsize-10\">50%</span>',\n          tooltip: lang.image.resizeHalf,\n          click: context.createInvokeHandler('editor.resize', '0.5')\n        }).render();\n      });\n      context.memo('button.imageSize25', function () {\n        return ui.button({\n          contents: '<span class=\"note-fontsize-10\">25%</span>',\n          tooltip: lang.image.resizeQuarter,\n          click: context.createInvokeHandler('editor.resize', '0.25')\n        }).render();\n      });\n\n      // Float Buttons\n      context.memo('button.floatLeft', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.alignLeft),\n          tooltip: lang.image.floatLeft,\n          click: context.createInvokeHandler('editor.floatMe', 'left')\n        }).render();\n      });\n\n      context.memo('button.floatRight', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.alignRight),\n          tooltip: lang.image.floatRight,\n          click: context.createInvokeHandler('editor.floatMe', 'right')\n        }).render();\n      });\n\n      context.memo('button.floatNone', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.alignJustify),\n          tooltip: lang.image.floatNone,\n          click: context.createInvokeHandler('editor.floatMe', 'none')\n        }).render();\n      });\n\n      // Remove Buttons\n      context.memo('button.removeMedia', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.trash),\n          tooltip: lang.image.remove,\n          click: context.createInvokeHandler('editor.removeMedia')\n        }).render();\n      });\n    };\n\n    this.addLinkPopoverButtons = function () {\n      context.memo('button.linkDialogShow', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.link),\n          tooltip: lang.link.edit,\n          click: context.createInvokeHandler('linkDialog.show')\n        }).render();\n      });\n\n      context.memo('button.unlink', function () {\n        return ui.button({\n          contents: ui.icon(options.icons.unlink),\n          tooltip: lang.link.unlink,\n          click: context.createInvokeHandler('editor.unlink')\n        }).render();\n      });\n    };\n\n    this.build = function ($container, groups) {\n      for (var groupIdx = 0, groupLen = groups.length; groupIdx < groupLen; groupIdx++) {\n        var group = groups[groupIdx];\n        var groupName = group[0];\n        var buttons = group[1];\n\n        var $group = ui.buttonGroup({\n          className: 'note-' + groupName\n        }).render();\n\n        for (var idx = 0, len = buttons.length; idx < len; idx++) {\n          var button = context.memo('button.' + buttons[idx]);\n          if (button) {\n            $group.append(typeof button === 'function' ? button(context) : button);\n          }\n        }\n        $group.appendTo($container);\n      }\n    };\n\n    this.updateCurrentStyle = function () {\n      var styleInfo = context.invoke('editor.currentStyle');\n      this.updateBtnStates({\n        '.note-btn-bold': function () {\n          return styleInfo['font-bold'] === 'bold';\n        },\n        '.note-btn-italic': function () {\n          return styleInfo['font-italic'] === 'italic';\n        },\n        '.note-btn-underline': function () {\n          return styleInfo['font-underline'] === 'underline';\n        },\n        '.note-btn-subscript': function () {\n          return styleInfo['font-subscript'] === 'subscript';\n        },\n        '.note-btn-superscript': function () {\n          return styleInfo['font-superscript'] === 'superscript';\n        },\n        '.note-btn-strikethrough': function () {\n          return styleInfo['font-strikethrough'] === 'strikethrough';\n        }\n      });\n\n      if (styleInfo['font-family']) {\n        var fontNames = styleInfo['font-family'].split(',').map(function (name) {\n          return name.replace(/[\\'\\\"]/g, '')\n            .replace(/\\s+$/, '')\n            .replace(/^\\s+/, '');\n        });\n        var fontName = list.find(fontNames, self.isFontInstalled);\n\n        $toolbar.find('.dropdown-fontname li a').each(function () {\n          // always compare string to avoid creating another func.\n          var isChecked = ($(this).data('value') + '') === (fontName + '');\n          this.className = isChecked ? 'checked' : '';\n        });\n        $toolbar.find('.note-current-fontname').text(fontName);\n      }\n\n      if (styleInfo['font-size']) {\n        var fontSize = styleInfo['font-size'];\n        $toolbar.find('.dropdown-fontsize li a').each(function () {\n          // always compare with string to avoid creating another func.\n          var isChecked = ($(this).data('value') + '') === (fontSize + '');\n          this.className = isChecked ? 'checked' : '';\n        });\n        $toolbar.find('.note-current-fontsize').text(fontSize);\n      }\n\n      if (styleInfo['line-height']) {\n        var lineHeight = styleInfo['line-height'];\n        $toolbar.find('.dropdown-line-height li a').each(function () {\n          // always compare with string to avoid creating another func.\n          var isChecked = ($(this).data('value') + '') === (lineHeight + '');\n          this.className = isChecked ? 'checked' : '';\n        });\n      }\n    };\n\n    this.updateBtnStates = function (infos) {\n      $.each(infos, function (selector, pred) {\n        ui.toggleBtnActive($toolbar.find(selector), pred());\n      });\n    };\n\n    this.tableMoveHandler = function (event) {\n      var PX_PER_EM = 18;\n      var $picker = $(event.target.parentNode); // target is mousecatcher\n      var $dimensionDisplay = $picker.next();\n      var $catcher = $picker.find('.note-dimension-picker-mousecatcher');\n      var $highlighted = $picker.find('.note-dimension-picker-highlighted');\n      var $unhighlighted = $picker.find('.note-dimension-picker-unhighlighted');\n\n      var posOffset;\n      // HTML5 with jQuery - e.offsetX is undefined in Firefox\n      if (event.offsetX === undefined) {\n        var posCatcher = $(event.target).offset();\n        posOffset = {\n          x: event.pageX - posCatcher.left,\n          y: event.pageY - posCatcher.top\n        };\n      } else {\n        posOffset = {\n          x: event.offsetX,\n          y: event.offsetY\n        };\n      }\n\n      var dim = {\n        c: Math.ceil(posOffset.x / PX_PER_EM) || 1,\n        r: Math.ceil(posOffset.y / PX_PER_EM) || 1\n      };\n\n      $highlighted.css({ width: dim.c + 'em', height: dim.r + 'em' });\n      $catcher.data('value', dim.c + 'x' + dim.r);\n\n      if (3 < dim.c && dim.c < options.insertTableMaxSize.col) {\n        $unhighlighted.css({ width: dim.c + 1 + 'em'});\n      }\n\n      if (3 < dim.r && dim.r < options.insertTableMaxSize.row) {\n        $unhighlighted.css({ height: dim.r + 1 + 'em'});\n      }\n\n      $dimensionDisplay.html(dim.c + ' x ' + dim.r);\n    };\n  };\n\n  var Toolbar = function (context) {\n    var ui = $.summernote.ui;\n\n    var $note = context.layoutInfo.note;\n    var $toolbar = context.layoutInfo.toolbar;\n    var options = context.options;\n\n    this.shouldInitialize = function () {\n      return !options.airMode;\n    };\n\n    this.initialize = function () {\n      options.toolbar = options.toolbar || [];\n\n      if (!options.toolbar.length) {\n        $toolbar.hide();\n      } else {\n        context.invoke('buttons.build', $toolbar, options.toolbar);\n      }\n\n      if (options.toolbarContainer) {\n        $toolbar.appendTo(options.toolbarContainer);\n      }\n\n      $note.on('summernote.keyup summernote.mouseup summernote.change', function () {\n        context.invoke('buttons.updateCurrentStyle');\n      });\n\n      context.invoke('buttons.updateCurrentStyle');\n    };\n\n    this.destroy = function () {\n      $toolbar.children().remove();\n    };\n\n    this.updateFullscreen = function (isFullscreen) {\n      ui.toggleBtnActive($toolbar.find('.btn-fullscreen'), isFullscreen);\n    };\n\n    this.updateCodeview = function (isCodeview) {\n      ui.toggleBtnActive($toolbar.find('.btn-codeview'), isCodeview);\n      if (isCodeview) {\n        this.deactivate();\n      } else {\n        this.activate();\n      }\n    };\n\n    this.activate = function (isIncludeCodeview) {\n      var $btn = $toolbar.find('button');\n      if (!isIncludeCodeview) {\n        $btn = $btn.not('.btn-codeview');\n      }\n      ui.toggleBtn($btn, true);\n    };\n\n    this.deactivate = function (isIncludeCodeview) {\n      var $btn = $toolbar.find('button');\n      if (!isIncludeCodeview) {\n        $btn = $btn.not('.btn-codeview');\n      }\n      ui.toggleBtn($btn, false);\n    };\n  };\n\n  var LinkDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var body = '<div class=\"form-group\">' +\n                   '<label>' + lang.link.textToDisplay + '</label>' +\n                   '<input class=\"note-link-text form-control\" type=\"text\" />' +\n                 '</div>' +\n                 '<div class=\"form-group\">' +\n                   '<label>' + lang.link.url + '</label>' +\n                   '<input class=\"note-link-url form-control\" type=\"text\" value=\"http://\" />' +\n                 '</div>' +\n                 (!options.disableLinkTarget ?\n                   '<div class=\"checkbox\">' +\n                     '<label>' + '<input type=\"checkbox\" checked> ' + lang.link.openInNewWindow + '</label>' +\n                   '</div>' : ''\n                 );\n      var footer = '<button href=\"#\" class=\"btn -dark note-link-btn disabled\" disabled>' + lang.link.insert + '</button>';\n\n      this.$dialog = ui.dialog({\n        className: 'link-dialog',\n        title: lang.link.insert,\n        fade: options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    this.bindEnterKey = function ($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          $btn.trigger('click');\n        }\n      });\n    };\n\n    /**\n     * toggle update button\n     */\n    this.toggleLinkBtn = function ($linkBtn, $linkText, $linkUrl) {\n      ui.toggleBtn($linkBtn, $linkText.val() && $linkUrl.val());\n    };\n\n    /**\n     * Show link dialog and set event handlers on dialog controls.\n     *\n     * @param {Object} linkInfo\n     * @return {Promise}\n     */\n    this.showLinkDialog = function (linkInfo) {\n      return $.Deferred(function (deferred) {\n        var $linkText = self.$dialog.find('.note-link-text'),\n        $linkUrl = self.$dialog.find('.note-link-url'),\n        $linkBtn = self.$dialog.find('.note-link-btn'),\n        $openInNewWindow = self.$dialog.find('input[type=checkbox]');\n\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n\n          // if no url was given, copy text to url\n          if (!linkInfo.url) {\n            linkInfo.url = linkInfo.text;\n          }\n\n          $linkText.val(linkInfo.text);\n\n          var handleLinkTextUpdate = function () {\n            self.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n            // if linktext was modified by keyup,\n            // stop cloning text from linkUrl\n            linkInfo.text = $linkText.val();\n          };\n\n          $linkText.on('input', handleLinkTextUpdate).on('paste', function () {\n            setTimeout(handleLinkTextUpdate, 0);\n          });\n\n          var handleLinkUrlUpdate = function () {\n            self.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n            // display same link on `Text to display` input\n            // when create a new link\n            if (!linkInfo.text) {\n              $linkText.val($linkUrl.val());\n            }\n          };\n\n          $linkUrl.on('input', handleLinkUrlUpdate).on('paste', function () {\n            setTimeout(handleLinkUrlUpdate, 0);\n          }).val(linkInfo.url).trigger('focus');\n\n          self.toggleLinkBtn($linkBtn, $linkText, $linkUrl);\n          self.bindEnterKey($linkUrl, $linkBtn);\n          self.bindEnterKey($linkText, $linkBtn);\n\n          $openInNewWindow.prop('checked', linkInfo.isNewWindow);\n\n          $linkBtn.one('click', function (event) {\n            event.preventDefault();\n\n            deferred.resolve({\n              range: linkInfo.range,\n              url: $linkUrl.val(),\n              text: $linkText.val(),\n              isNewWindow: $openInNewWindow.is(':checked')\n            });\n            self.$dialog.modal('hide');\n          });\n        });\n\n        ui.onDialogHidden(self.$dialog, function () {\n          // detach events\n          $linkText.off('input paste keypress');\n          $linkUrl.off('input paste keypress');\n          $linkBtn.off('click');\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        ui.showDialog(self.$dialog);\n      }).promise();\n    };\n\n    /**\n     * @param {Object} layoutInfo\n     */\n    this.show = function () {\n      var linkInfo = context.invoke('editor.getLinkInfo');\n\n      context.invoke('editor.saveRange');\n      this.showLinkDialog(linkInfo).then(function (linkInfo) {\n        context.invoke('editor.restoreRange');\n        context.invoke('editor.createLink', linkInfo);\n      }).fail(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n    context.memo('help.linkDialog.show', options.langInfo.help['linkDialog.show']);\n  };\n\n  var LinkPopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var options = context.options;\n\n    this.events = {\n      'summernote.keyup summernote.mouseup summernote.change summernote.scroll': function () {\n        self.update();\n      },\n      'summernote.dialog.shown': function () {\n        self.hide();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return !list.isEmpty(options.popover.link);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-link-popover',\n        callback: function ($node) {\n          var $content = $node.find('.popover-content');\n          $content.prepend('<span><a target=\"_blank\"></a>&nbsp;</span>');\n        }\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.link);\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function () {\n      // Prevent focusing on editable when invoke('code') is executed\n      if (!context.invoke('editor.hasFocus')) {\n        this.hide();\n        return;\n      }\n\n      var rng = context.invoke('editor.createRange');\n      if (rng.isCollapsed() && rng.isOnAnchor()) {\n        var anchor = dom.ancestor(rng.sc, dom.isAnchor);\n        var href = $(anchor).attr('href');\n        this.$popover.find('a').attr('href', href).html(href);\n\n        var pos = dom.posFromPlaceholder(anchor);\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var ImageDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var imageLimitation = '';\n      if (options.maximumImageFileSize) {\n        var unit = Math.floor(Math.log(options.maximumImageFileSize) / Math.log(1024));\n        var readableSize = (options.maximumImageFileSize / Math.pow(1024, unit)).toFixed(2) * 1 +\n                           ' ' + ' KMGTP'[unit] + 'B';\n        imageLimitation = '<small>' + lang.image.maximumFileSize + ' : ' + readableSize + '</small>';\n      }\n\n      var body = '<div class=\"form-group note-group-select-from-files\">' +\n                   '<label>' + lang.image.selectFromFiles + '</label>' +\n                   '<input class=\"note-image-input form-control\" type=\"file\" name=\"files\" accept=\"image/*\" multiple=\"multiple\" />' +\n                   imageLimitation +\n                 '</div>' +\n                 '<div class=\"form-group note-group-image-url\" style=\"overflow:auto;\">' +\n                   '<label>' + lang.image.url + '</label>' +\n                   '<input class=\"note-image-url form-control col-md-12\" type=\"text\" />' +\n                 '</div>';\n      var footer = '<button href=\"#\" class=\"btn -dark note-image-btn disabled\" disabled>' + lang.image.insert + '</button>';\n\n      this.$dialog = ui.dialog({\n        title: lang.image.insert,\n        fade: options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    this.bindEnterKey = function ($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          $btn.trigger('click');\n        }\n      });\n    };\n\n    this.show = function () {\n      context.invoke('editor.saveRange');\n      this.showImageDialog().then(function (data) {\n        // [workaround] hide dialog before restore range for IE range focus\n        ui.hideDialog(self.$dialog);\n        context.invoke('editor.restoreRange');\n\n        if (typeof data === 'string') { // image url\n          context.invoke('editor.insertImage', data);\n        } else { // array of files\n          context.invoke('editor.insertImagesOrCallback', data);\n        }\n      }).fail(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n\n    /**\n     * show image dialog\n     *\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */\n    this.showImageDialog = function () {\n      return $.Deferred(function (deferred) {\n        var $imageInput = self.$dialog.find('.note-image-input'),\n            $imageUrl = self.$dialog.find('.note-image-url'),\n            $imageBtn = self.$dialog.find('.note-image-btn');\n\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n\n          // Cloning imageInput to clear element.\n          $imageInput.replaceWith($imageInput.clone()\n            .on('change', function () {\n              deferred.resolve(this.files || this.value);\n            })\n            .val('')\n          );\n\n          $imageBtn.click(function (event) {\n            event.preventDefault();\n\n            deferred.resolve($imageUrl.val());\n          });\n\n          $imageUrl.on('keyup paste', function () {\n            var url = $imageUrl.val();\n            ui.toggleBtn($imageBtn, url);\n          }).val('').trigger('focus');\n          self.bindEnterKey($imageUrl, $imageBtn);\n        });\n\n        ui.onDialogHidden(self.$dialog, function () {\n          $imageInput.off('change');\n          $imageUrl.off('keyup paste keypress');\n          $imageBtn.off('click');\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        ui.showDialog(self.$dialog);\n      });\n    };\n  };\n\n  var ImagePopover = function (context) {\n    var ui = $.summernote.ui;\n\n    var options = context.options;\n\n    this.shouldInitialize = function () {\n      return !list.isEmpty(options.popover.image);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-image-popover'\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.image);\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function (target) {\n      if (dom.isImg(target)) {\n        var pos = dom.posFromPlaceholder(target);\n        this.$popover.css({\n          display: 'block',\n          left: pos.left,\n          top: pos.top\n        });\n      } else {\n        this.hide();\n      }\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var VideoDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var body = '<div class=\"form-group row-fluid\">' +\n          '<label>' + lang.video.url + ' <small class=\"text-muted\">' + lang.video.providers + '</small></label>' +\n          '<input class=\"note-video-url form-control span12\" type=\"text\" />' +\n          '</div>';\n      var footer = '<button href=\"#\" class=\"btn -dark note-video-btn disabled\" disabled>' + lang.video.insert + '</button>';\n\n      this.$dialog = ui.dialog({\n        title: lang.video.insert,\n        fade: options.dialogsFade,\n        body: body,\n        footer: footer\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    this.bindEnterKey = function ($input, $btn) {\n      $input.on('keypress', function (event) {\n        if (event.keyCode === key.code.ENTER) {\n          $btn.trigger('click');\n        }\n      });\n    };\n\n    this.createVideoNode = function (url) {\n      // video url patterns(youtube, instagram, vimeo, dailymotion, youku, mp4, ogg, webm)\n      var ytRegExp = /^(?:https?:\\/\\/)?(?:www\\.)?(?:youtu\\.be\\/|youtube\\.com\\/(?:embed\\/|v\\/|watch\\?v=|watch\\?.+&v=))((\\w|-){11})(?:\\S+)?$/;\n      var ytMatch = url.match(ytRegExp);\n\n      var igRegExp = /(?:www\\.|\\/\\/)instagram\\.com\\/p\\/(.[a-zA-Z0-9_-]*)/;\n      var igMatch = url.match(igRegExp);\n\n      var vRegExp = /\\/\\/vine\\.co\\/v\\/([a-zA-Z0-9]+)/;\n      var vMatch = url.match(vRegExp);\n\n      var vimRegExp = /\\/\\/(player\\.)?vimeo\\.com\\/([a-z]*\\/)*([0-9]{6,11})[?]?.*/;\n      var vimMatch = url.match(vimRegExp);\n\n      var dmRegExp = /.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/;\n      var dmMatch = url.match(dmRegExp);\n\n      var youkuRegExp = /\\/\\/v\\.youku\\.com\\/v_show\\/id_(\\w+)=*\\.html/;\n      var youkuMatch = url.match(youkuRegExp);\n\n      var mp4RegExp = /^.+.(mp4|m4v)$/;\n      var mp4Match = url.match(mp4RegExp);\n\n      var oggRegExp = /^.+.(ogg|ogv)$/;\n      var oggMatch = url.match(oggRegExp);\n\n      var webmRegExp = /^.+.(webm)$/;\n      var webmMatch = url.match(webmRegExp);\n\n      var $video;\n      if (ytMatch && ytMatch[1].length === 11) {\n        var youtubeId = ytMatch[1];\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', '//www.youtube.com/embed/' + youtubeId)\n            .attr('width', '640').attr('height', '360');\n      } else if (igMatch && igMatch[0].length) {\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', 'https://instagram.com/p/' + igMatch[1] + '/embed/')\n            .attr('width', '612').attr('height', '710')\n            .attr('scrolling', 'no')\n            .attr('allowtransparency', 'true');\n      } else if (vMatch && vMatch[0].length) {\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', vMatch[0] + '/embed/simple')\n            .attr('width', '600').attr('height', '600')\n            .attr('class', 'vine-embed');\n      } else if (vimMatch && vimMatch[3].length) {\n        $video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n            .attr('frameborder', 0)\n            .attr('src', '//player.vimeo.com/video/' + vimMatch[3])\n            .attr('width', '640').attr('height', '360');\n      } else if (dmMatch && dmMatch[2].length) {\n        $video = $('<iframe>')\n            .attr('frameborder', 0)\n            .attr('src', '//www.dailymotion.com/embed/video/' + dmMatch[2])\n            .attr('width', '640').attr('height', '360');\n      } else if (youkuMatch && youkuMatch[1].length) {\n        $video = $('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen>')\n            .attr('frameborder', 0)\n            .attr('height', '498')\n            .attr('width', '510')\n            .attr('src', '//player.youku.com/embed/' + youkuMatch[1]);\n      } else if (mp4Match || oggMatch || webmMatch) {\n        $video = $('<video controls>')\n            .attr('src', url)\n            .attr('width', '640').attr('height', '360');\n      } else {\n        // this is not a known video link. Now what, Cat? Now what?\n        return false;\n      }\n\n      $video.addClass('note-video-clip');\n\n      return $video[0];\n    };\n\n    this.show = function () {\n      var text = context.invoke('editor.getSelectedText');\n      context.invoke('editor.saveRange');\n      this.showVideoDialog(text).then(function (url) {\n        // [workaround] hide dialog before restore range for IE range focus\n        ui.hideDialog(self.$dialog);\n        context.invoke('editor.restoreRange');\n\n        // build node\n        var $node = self.createVideoNode(url);\n\n        if ($node) {\n          // insert video node\n          context.invoke('editor.insertNode', $node);\n        }\n      }).fail(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n\n    /**\n     * show image dialog\n     *\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */\n    this.showVideoDialog = function (text) {\n      return $.Deferred(function (deferred) {\n        var $videoUrl = self.$dialog.find('.note-video-url'),\n            $videoBtn = self.$dialog.find('.note-video-btn');\n\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n\n          $videoUrl.val(text).on('input', function () {\n            ui.toggleBtn($videoBtn, $videoUrl.val());\n          }).trigger('focus');\n\n          $videoBtn.click(function (event) {\n            event.preventDefault();\n\n            deferred.resolve($videoUrl.val());\n          });\n\n          self.bindEnterKey($videoUrl, $videoBtn);\n        });\n\n        ui.onDialogHidden(self.$dialog, function () {\n          $videoUrl.off('input');\n          $videoBtn.off('click');\n\n          if (deferred.state() === 'pending') {\n            deferred.reject();\n          }\n        });\n\n        ui.showDialog(self.$dialog);\n      });\n    };\n  };\n\n  var HelpDialog = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var $editor = context.layoutInfo.editor;\n    var options = context.options;\n    var lang = options.langInfo;\n\n    this.createShortCutList = function () {\n      var keyMap = options.keyMap[agent.isMac ? 'mac' : 'pc'];\n      return Object.keys(keyMap).map(function (key) {\n        var command = keyMap[key];\n        var $row = $('<div><div class=\"help-list-item\"/></div>');\n        $row.append($('<label><kbd>' + key + '</kdb></label>').css({\n          'width': 180,\n          'margin-right': 10\n        })).append($('<span/>').html(context.memo('help.' + command) || command));\n        return $row.html();\n      }).join('');\n    };\n\n    this.initialize = function () {\n      var $container = options.dialogsInBody ? $(document.body) : $editor;\n\n      var body = [\n        '<p class=\"text-center\">',\n        '<a href=\"http://summernote.org/\" target=\"_blank\">Summernote 0.8.2</a>  ',\n        '<a href=\"https://github.com/summernote/summernote\" target=\"_blank\">Project</a>  ',\n        '<a href=\"https://github.com/summernote/summernote/issues\" target=\"_blank\">Issues</a>',\n        '</p>'\n      ].join('');\n\n      this.$dialog = ui.dialog({\n        title: lang.options.help,\n        fade: options.dialogsFade,\n        body: this.createShortCutList(),\n        footer: body,\n        callback: function ($node) {\n          $node.find('.modal-body').css({\n            'max-height': 300,\n            'overflow': 'scroll'\n          });\n        }\n      }).render().appendTo($container);\n    };\n\n    this.destroy = function () {\n      ui.hideDialog(this.$dialog);\n      this.$dialog.remove();\n    };\n\n    /**\n     * show help dialog\n     *\n     * @return {Promise}\n     */\n    this.showHelpDialog = function () {\n      return $.Deferred(function (deferred) {\n        ui.onDialogShown(self.$dialog, function () {\n          context.triggerEvent('dialog.shown');\n          deferred.resolve();\n        });\n        ui.showDialog(self.$dialog);\n      }).promise();\n    };\n\n    this.show = function () {\n      context.invoke('editor.saveRange');\n      this.showHelpDialog().then(function () {\n        context.invoke('editor.restoreRange');\n      });\n    };\n  };\n\n  var AirPopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var options = context.options;\n\n    var AIR_MODE_POPOVER_X_OFFSET = 20;\n\n    this.events = {\n      'summernote.keyup summernote.mouseup summernote.scroll': function () {\n        self.update();\n      },\n      'summernote.change summernote.dialog.shown': function () {\n        self.hide();\n      },\n      'summernote.focusout': function (we, e) {\n        // [workaround] Firefox doesn't support relatedTarget on focusout\n        //  - Ignore hide action on focus out in FF.\n        if (agent.isFF) {\n          return;\n        }\n\n        if (!e.relatedTarget || !dom.ancestor(e.relatedTarget, func.eq(self.$popover[0]))) {\n          self.hide();\n        }\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return options.airMode && !list.isEmpty(options.popover.air);\n    };\n\n    this.initialize = function () {\n      this.$popover = ui.popover({\n        className: 'note-air-popover'\n      }).render().appendTo('body');\n      var $content = this.$popover.find('.popover-content');\n\n      context.invoke('buttons.build', $content, options.popover.air);\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.update = function () {\n      var styleInfo = context.invoke('editor.currentStyle');\n      if (styleInfo.range && !styleInfo.range.isCollapsed()) {\n        var rect = list.last(styleInfo.range.getClientRects());\n        if (rect) {\n          var bnd = func.rect2bnd(rect);\n          this.$popover.css({\n            display: 'block',\n            left: Math.max(bnd.left + bnd.width / 2, 0) - AIR_MODE_POPOVER_X_OFFSET,\n            top: bnd.top + bnd.height\n          });\n        }\n      } else {\n        this.hide();\n      }\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n  var HintPopover = function (context) {\n    var self = this;\n    var ui = $.summernote.ui;\n\n    var POPOVER_DIST = 5;\n    var hint = context.options.hint || [];\n    var direction = context.options.hintDirection || 'bottom';\n    var hints = $.isArray(hint) ? hint : [hint];\n\n    this.events = {\n      'summernote.keyup': function (we, e) {\n        if (!e.isDefaultPrevented()) {\n          self.handleKeyup(e);\n        }\n      },\n      'summernote.keydown': function (we, e) {\n        self.handleKeydown(e);\n      },\n      'summernote.dialog.shown': function () {\n        self.hide();\n      }\n    };\n\n    this.shouldInitialize = function () {\n      return hints.length > 0;\n    };\n\n    this.initialize = function () {\n      this.lastWordRange = null;\n      this.$popover = ui.popover({\n        className: 'note-hint-popover',\n        hideArrow: true,\n        direction: ''\n      }).render().appendTo('body');\n\n      this.$popover.hide();\n\n      this.$content = this.$popover.find('.popover-content');\n\n      this.$content.on('click', '.note-hint-item', function () {\n        self.$content.find('.active').removeClass('active');\n        $(this).addClass('active');\n        self.replace();\n      });\n    };\n\n    this.destroy = function () {\n      this.$popover.remove();\n    };\n\n    this.selectItem = function ($item) {\n      this.$content.find('.active').removeClass('active');\n      $item.addClass('active');\n\n      this.$content[0].scrollTop = $item[0].offsetTop - (this.$content.innerHeight() / 2);\n    };\n\n    this.moveDown = function () {\n      var $current = this.$content.find('.note-hint-item.active');\n      var $next = $current.next();\n\n      if ($next.length) {\n        this.selectItem($next);\n      } else {\n        var $nextGroup = $current.parent().next();\n\n        if (!$nextGroup.length) {\n          $nextGroup = this.$content.find('.note-hint-group').first();\n        }\n\n        this.selectItem($nextGroup.find('.note-hint-item').first());\n      }\n    };\n\n    this.moveUp = function () {\n      var $current = this.$content.find('.note-hint-item.active');\n      var $prev = $current.prev();\n\n      if ($prev.length) {\n        this.selectItem($prev);\n      } else {\n        var $prevGroup = $current.parent().prev();\n\n        if (!$prevGroup.length) {\n          $prevGroup = this.$content.find('.note-hint-group').last();\n        }\n\n        this.selectItem($prevGroup.find('.note-hint-item').last());\n      }\n    };\n\n    this.replace = function () {\n      var $item = this.$content.find('.note-hint-item.active');\n\n      if ($item.length) {\n        var node = this.nodeFromItem($item);\n        this.lastWordRange.insertNode(node);\n        range.createFromNode(node).collapse().select();\n\n        this.lastWordRange = null;\n        this.hide();\n        context.invoke('editor.focus');\n      }\n\n    };\n\n    this.nodeFromItem = function ($item) {\n      var hint = hints[$item.data('index')];\n      var item = $item.data('item');\n      var node = hint.content ? hint.content(item) : item;\n      if (typeof node === 'string') {\n        node = dom.createText(node);\n      }\n      return node;\n    };\n\n    this.createItemTemplates = function (hintIdx, items) {\n      var hint = hints[hintIdx];\n      return items.map(function (item, idx) {\n        var $item = $('<div class=\"note-hint-item\"/>');\n        $item.append(hint.template ? hint.template(item) : item + '');\n        $item.data({\n          'index': hintIdx,\n          'item': item\n        });\n\n        if (hintIdx === 0 && idx === 0) {\n          $item.addClass('active');\n        }\n        return $item;\n      });\n    };\n\n    this.handleKeydown = function (e) {\n      if (!this.$popover.is(':visible')) {\n        return;\n      }\n\n      if (e.keyCode === key.code.ENTER) {\n        e.preventDefault();\n        this.replace();\n      } else if (e.keyCode === key.code.UP) {\n        e.preventDefault();\n        this.moveUp();\n      } else if (e.keyCode === key.code.DOWN) {\n        e.preventDefault();\n        this.moveDown();\n      }\n    };\n\n    this.searchKeyword = function (index, keyword, callback) {\n      var hint = hints[index];\n      if (hint && hint.match.test(keyword) && hint.search) {\n        var matches = hint.match.exec(keyword);\n        hint.search(matches[1], callback);\n      } else {\n        callback();\n      }\n    };\n\n    this.createGroup = function (idx, keyword) {\n      var $group = $('<div class=\"note-hint-group note-hint-group-' + idx + '\"/>');\n      this.searchKeyword(idx, keyword, function (items) {\n        items = items || [];\n        if (items.length) {\n          $group.html(self.createItemTemplates(idx, items));\n          self.show();\n        }\n      });\n\n      return $group;\n    };\n\n    this.handleKeyup = function (e) {\n      if (list.contains([key.code.ENTER, key.code.UP, key.code.DOWN], e.keyCode)) {\n        if (e.keyCode === key.code.ENTER) {\n          if (this.$popover.is(':visible')) {\n            return;\n          }\n        }\n      } else {\n        var wordRange = context.invoke('editor.createRange').getWordRange();\n        var keyword = wordRange.toString();\n        if (hints.length && keyword) {\n          this.$content.empty();\n\n          var bnd = func.rect2bnd(list.last(wordRange.getClientRects()));\n          if (bnd) {\n\n            this.$popover.hide();\n\n            this.lastWordRange = wordRange;\n\n            hints.forEach(function (hint, idx) {\n              if (hint.match.test(keyword)) {\n                self.createGroup(idx, keyword).appendTo(self.$content);\n              }\n            });\n\n            // set position for popover after group is created\n            if (direction === 'top') {\n              this.$popover.css({\n                left: bnd.left,\n                top: bnd.top - this.$popover.outerHeight() - POPOVER_DIST\n              });\n            } else {\n              this.$popover.css({\n                left: bnd.left,\n                top: bnd.top + bnd.height + POPOVER_DIST\n              });\n            }\n\n          }\n        } else {\n          this.hide();\n        }\n      }\n    };\n\n    this.show = function () {\n      this.$popover.show();\n    };\n\n    this.hide = function () {\n      this.$popover.hide();\n    };\n  };\n\n\n  $.summernote = $.extend($.summernote, {\n    version: '0.8.2',\n    ui: ui,\n    dom: dom,\n\n    plugins: {},\n\n    options: {\n      modules: {\n        'editor': Editor,\n        'clipboard': Clipboard,\n        'dropzone': Dropzone,\n        'codeview': Codeview,\n        'statusbar': Statusbar,\n        'fullscreen': Fullscreen,\n        'handle': Handle,\n        // FIXME: HintPopover must be front of autolink\n        //  - Script error about range when Enter key is pressed on hint popover\n        'hintPopover': HintPopover,\n        'autoLink': AutoLink,\n        'autoSync': AutoSync,\n        'placeholder': Placeholder,\n        'buttons': Buttons,\n        'toolbar': Toolbar,\n        'linkDialog': LinkDialog,\n        'linkPopover': LinkPopover,\n        'imageDialog': ImageDialog,\n        'imagePopover': ImagePopover,\n        'videoDialog': VideoDialog,\n        'helpDialog': HelpDialog,\n        'airPopover': AirPopover\n      },\n\n      buttons: {},\n\n      lang: 'en-US',\n\n      // toolbar\n      toolbar: [\n        ['style', ['style']],\n        ['font', ['bold', 'underline', 'clear']],\n        ['fontname', ['fontname']],\n        ['color', ['color']],\n        ['para', ['ul', 'ol', 'paragraph']],\n        ['table', ['table']],\n        ['insert', ['link', 'picture', 'video']],\n        ['view', ['fullscreen', 'codeview', 'help']]\n      ],\n\n      // popover\n      popover: {\n        image: [\n          ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n          ['float', ['floatLeft', 'floatRight', 'floatNone']],\n          ['remove', ['removeMedia']]\n        ],\n        link: [\n          ['link', ['linkDialogShow', 'unlink']]\n        ],\n        air: [\n          ['color', ['color']],\n          ['font', ['bold', 'underline', 'clear']],\n          ['para', ['ul', 'paragraph']],\n          ['table', ['table']],\n          ['insert', ['link', 'picture']]\n        ]\n      },\n\n      // air mode: inline editor\n      airMode: false,\n\n      width: null,\n      height: null,\n\n      focus: false,\n      tabSize: 4,\n      styleWithSpan: true,\n      shortcuts: true,\n      textareaAutoSync: true,\n      direction: null,\n\n      styleTags: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\n      fontNames: [\n        'Arial', 'Arial Black', 'Comic Sans MS', 'Courier New',\n        'Helvetica Neue', 'Helvetica', 'Impact', 'Lucida Grande',\n        'Tahoma', 'Times New Roman', 'Verdana'\n      ],\n\n      fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],\n\n      // pallete colors(n x n)\n      colors: [\n        ['#000000', '#424242', '#636363', '#9C9C94', '#CEC6CE', '#EFEFEF', '#F7F7F7', '#FFFFFF'],\n        ['#FF0000', '#FF9C00', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#9C00FF', '#FF00FF'],\n        ['#F7C6CE', '#FFE7CE', '#FFEFC6', '#D6EFD6', '#CEDEE7', '#CEE7F7', '#D6D6E7', '#E7D6DE'],\n        ['#E79C9C', '#FFC69C', '#FFE79C', '#B5D6A5', '#A5C6CE', '#9CC6EF', '#B5A5D6', '#D6A5BD'],\n        ['#E76363', '#F7AD6B', '#FFD663', '#94BD7B', '#73A5AD', '#6BADDE', '#8C7BC6', '#C67BA5'],\n        ['#CE0000', '#E79439', '#EFC631', '#6BA54A', '#4A7B8C', '#3984C6', '#634AA5', '#A54A7B'],\n        ['#9C0000', '#B56308', '#BD9400', '#397B21', '#104A5A', '#085294', '#311873', '#731842'],\n        ['#630000', '#7B3900', '#846300', '#295218', '#083139', '#003163', '#21104A', '#4A1031']\n      ],\n\n      lineHeights: ['1.0', '1.2', '1.4', '1.5', '1.6', '1.8', '2.0', '3.0'],\n\n      tableClassName: 'table -bordered -dark',\n\n      insertTableMaxSize: {\n        col: 10,\n        row: 10\n      },\n\n      dialogsInBody: false,\n      dialogsFade: false,\n\n      maximumImageFileSize: null,\n\n      callbacks: {\n        onInit: null,\n        onFocus: null,\n        onBlur: null,\n        onEnter: null,\n        onKeyup: null,\n        onKeydown: null,\n        onImageUpload: null,\n        onImageUploadError: null\n      },\n\n      codemirror: {\n        mode: 'text/html',\n        htmlMode: true,\n        lineNumbers: true\n      },\n\n      keyMap: {\n        pc: {\n          'ENTER': 'insertParagraph',\n          'CTRL+Z': 'undo',\n          'CTRL+Y': 'redo',\n          'TAB': 'tab',\n          'SHIFT+TAB': 'untab',\n          'CTRL+B': 'bold',\n          'CTRL+I': 'italic',\n          'CTRL+U': 'underline',\n          'CTRL+SHIFT+S': 'strikethrough',\n          'CTRL+BACKSLASH': 'removeFormat',\n          'CTRL+SHIFT+L': 'justifyLeft',\n          'CTRL+SHIFT+E': 'justifyCenter',\n          'CTRL+SHIFT+R': 'justifyRight',\n          'CTRL+SHIFT+J': 'justifyFull',\n          'CTRL+SHIFT+NUM7': 'insertUnorderedList',\n          'CTRL+SHIFT+NUM8': 'insertOrderedList',\n          'CTRL+LEFTBRACKET': 'outdent',\n          'CTRL+RIGHTBRACKET': 'indent',\n          'CTRL+NUM0': 'formatPara',\n          'CTRL+NUM1': 'formatH1',\n          'CTRL+NUM2': 'formatH2',\n          'CTRL+NUM3': 'formatH3',\n          'CTRL+NUM4': 'formatH4',\n          'CTRL+NUM5': 'formatH5',\n          'CTRL+NUM6': 'formatH6',\n          'CTRL+ENTER': 'insertHorizontalRule',\n          'CTRL+K': 'linkDialog.show'\n        },\n\n        mac: {\n          'ENTER': 'insertParagraph',\n          'CMD+Z': 'undo',\n          'CMD+SHIFT+Z': 'redo',\n          'TAB': 'tab',\n          'SHIFT+TAB': 'untab',\n          'CMD+B': 'bold',\n          'CMD+I': 'italic',\n          'CMD+U': 'underline',\n          'CMD+SHIFT+S': 'strikethrough',\n          'CMD+BACKSLASH': 'removeFormat',\n          'CMD+SHIFT+L': 'justifyLeft',\n          'CMD+SHIFT+E': 'justifyCenter',\n          'CMD+SHIFT+R': 'justifyRight',\n          'CMD+SHIFT+J': 'justifyFull',\n          'CMD+SHIFT+NUM7': 'insertUnorderedList',\n          'CMD+SHIFT+NUM8': 'insertOrderedList',\n          'CMD+LEFTBRACKET': 'outdent',\n          'CMD+RIGHTBRACKET': 'indent',\n          'CMD+NUM0': 'formatPara',\n          'CMD+NUM1': 'formatH1',\n          'CMD+NUM2': 'formatH2',\n          'CMD+NUM3': 'formatH3',\n          'CMD+NUM4': 'formatH4',\n          'CMD+NUM5': 'formatH5',\n          'CMD+NUM6': 'formatH6',\n          'CMD+ENTER': 'insertHorizontalRule',\n          'CMD+K': 'linkDialog.show'\n        }\n      },\n      icons: {\n        'align': 'note-icon-align',\n        'alignCenter': 'note-icon-align-center',\n        'alignJustify': 'note-icon-align-justify',\n        'alignLeft': 'note-icon-align-left',\n        'alignRight': 'note-icon-align-right',\n        'indent': 'note-icon-align-indent',\n        'outdent': 'note-icon-align-outdent',\n        'arrowsAlt': 'note-icon-arrows-alt',\n        'bold': 'note-icon-bold',\n        'caret': 'note-icon-caret',\n        'circle': 'note-icon-circle',\n        'close': 'note-icon-close',\n        'code': 'note-icon-code',\n        'eraser': 'note-icon-eraser',\n        'font': 'note-icon-font',\n        'frame': 'note-icon-frame',\n        'italic': 'note-icon-italic',\n        'link': 'note-icon-link',\n        'unlink': 'note-icon-chain-broken',\n        'magic': 'note-icon-magic',\n        'menuCheck': 'note-icon-check',\n        'minus': 'note-icon-minus',\n        'orderedlist': 'note-icon-orderedlist',\n        'pencil': 'note-icon-pencil',\n        'picture': 'note-icon-picture',\n        'question': 'note-icon-question',\n        'redo': 'note-icon-redo',\n        'square': 'note-icon-square',\n        'strikethrough': 'note-icon-strikethrough',\n        'subscript': 'note-icon-subscript',\n        'superscript': 'note-icon-superscript',\n        'table': 'note-icon-table',\n        'textHeight': 'note-icon-text-height',\n        'trash': 'note-icon-trash',\n        'underline': 'note-icon-underline',\n        'undo': 'note-icon-undo',\n        'unorderedlist': 'note-icon-unorderedlist',\n        'video': 'note-icon-video'\n      }\n    }\n  });\n\n}));\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvY29kZW1pcnJvci9saWIvY29kZW1pcnJvci5qcyIsImJ1aWxkL3ZlbmRvcnMvc3VtbWVybm90ZS9zdW1tZXJub3RlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQ25wU0E7Ozs7Ozs7Ozs7QUFVQyxXQUFVLE9BQVYsRUFBbUI7QUFDbEI7QUFDQSxVQUFRLE9BQU8sTUFBZjtBQUNELENBSEEsRUFHQyxVQUFVLENBQVYsRUFBYTtBQUNiOztBQUVBOzs7Ozs7Ozs7QUFRQSxNQUFJLE9BQVEsWUFBWTtBQUN0QixRQUFJLEtBQUssU0FBTCxFQUFLLENBQVUsS0FBVixFQUFpQjtBQUN4QixhQUFPLFVBQVUsS0FBVixFQUFpQjtBQUN0QixlQUFPLFVBQVUsS0FBakI7QUFDRCxPQUZEO0FBR0QsS0FKRDs7QUFNQSxRQUFJLE1BQU0sU0FBTixHQUFNLENBQVUsS0FBVixFQUFpQixLQUFqQixFQUF3QjtBQUNoQyxhQUFPLFVBQVUsS0FBakI7QUFDRCxLQUZEOztBQUlBLFFBQUksT0FBTyxTQUFQLElBQU8sQ0FBVSxRQUFWLEVBQW9CO0FBQzdCLGFBQU8sVUFBVSxLQUFWLEVBQWlCLEtBQWpCLEVBQXdCO0FBQzdCLGVBQU8sTUFBTSxRQUFOLE1BQW9CLE1BQU0sUUFBTixDQUEzQjtBQUNELE9BRkQ7QUFHRCxLQUpEOztBQU1BLFFBQUksS0FBSyxTQUFMLEVBQUssR0FBWTtBQUNuQixhQUFPLElBQVA7QUFDRCxLQUZEOztBQUlBLFFBQUksT0FBTyxTQUFQLElBQU8sR0FBWTtBQUNyQixhQUFPLEtBQVA7QUFDRCxLQUZEOztBQUlBLFFBQUksTUFBTSxTQUFOLEdBQU0sQ0FBVSxDQUFWLEVBQWE7QUFDckIsYUFBTyxZQUFZO0FBQ2pCLGVBQU8sQ0FBQyxFQUFFLEtBQUYsQ0FBUSxDQUFSLEVBQVcsU0FBWCxDQUFSO0FBQ0QsT0FGRDtBQUdELEtBSkQ7O0FBTUEsUUFBSSxNQUFNLFNBQU4sR0FBTSxDQUFVLEVBQVYsRUFBYyxFQUFkLEVBQWtCO0FBQzFCLGFBQU8sVUFBVSxJQUFWLEVBQWdCO0FBQ3JCLGVBQU8sR0FBRyxJQUFILEtBQVksR0FBRyxJQUFILENBQW5CO0FBQ0QsT0FGRDtBQUdELEtBSkQ7O0FBTUEsUUFBSSxPQUFPLFNBQVAsSUFBTyxDQUFVLENBQVYsRUFBYTtBQUN0QixhQUFPLENBQVA7QUFDRCxLQUZEOztBQUlBLFFBQUksU0FBUyxTQUFULE1BQVMsQ0FBVSxHQUFWLEVBQWUsTUFBZixFQUF1QjtBQUNsQyxhQUFPLFlBQVk7QUFDakIsZUFBTyxJQUFJLE1BQUosRUFBWSxLQUFaLENBQWtCLEdBQWxCLEVBQXVCLFNBQXZCLENBQVA7QUFDRCxPQUZEO0FBR0QsS0FKRDs7QUFNQSxRQUFJLFlBQVksQ0FBaEI7O0FBRUE7Ozs7O0FBS0EsUUFBSSxXQUFXLFNBQVgsUUFBVyxDQUFVLE1BQVYsRUFBa0I7QUFDL0IsVUFBSSxLQUFLLEVBQUUsU0FBRixHQUFjLEVBQXZCO0FBQ0EsYUFBTyxTQUFTLFNBQVMsRUFBbEIsR0FBdUIsRUFBOUI7QUFDRCxLQUhEOztBQUtBOzs7Ozs7Ozs7Ozs7O0FBYUEsUUFBSSxXQUFXLFNBQVgsUUFBVyxDQUFVLElBQVYsRUFBZ0I7QUFDN0IsVUFBSSxZQUFZLEVBQUUsUUFBRixDQUFoQjtBQUNBLGFBQU87QUFDTCxhQUFLLEtBQUssR0FBTCxHQUFXLFVBQVUsU0FBVixFQURYO0FBRUwsY0FBTSxLQUFLLElBQUwsR0FBWSxVQUFVLFVBQVYsRUFGYjtBQUdMLGVBQU8sS0FBSyxLQUFMLEdBQWEsS0FBSyxJQUhwQjtBQUlMLGdCQUFRLEtBQUssTUFBTCxHQUFjLEtBQUs7QUFKdEIsT0FBUDtBQU1ELEtBUkQ7O0FBVUE7Ozs7O0FBS0EsUUFBSSxlQUFlLFNBQWYsWUFBZSxDQUFVLEdBQVYsRUFBZTtBQUNoQyxVQUFJLFdBQVcsRUFBZjtBQUNBLFdBQUssSUFBSSxHQUFULElBQWdCLEdBQWhCLEVBQXFCO0FBQ25CLFlBQUksSUFBSSxjQUFKLENBQW1CLEdBQW5CLENBQUosRUFBNkI7QUFDM0IsbUJBQVMsSUFBSSxHQUFKLENBQVQsSUFBcUIsR0FBckI7QUFDRDtBQUNGO0FBQ0QsYUFBTyxRQUFQO0FBQ0QsS0FSRDs7QUFVQTs7Ozs7QUFLQSxRQUFJLG1CQUFtQixTQUFuQixnQkFBbUIsQ0FBVSxTQUFWLEVBQXFCLE1BQXJCLEVBQTZCO0FBQ2xELGVBQVMsVUFBVSxFQUFuQjtBQUNBLGFBQU8sU0FBUyxVQUFVLEtBQVYsQ0FBZ0IsR0FBaEIsRUFBcUIsR0FBckIsQ0FBeUIsVUFBVSxJQUFWLEVBQWdCO0FBQ3ZELGVBQU8sS0FBSyxTQUFMLENBQWUsQ0FBZixFQUFrQixDQUFsQixFQUFxQixXQUFyQixLQUFxQyxLQUFLLFNBQUwsQ0FBZSxDQUFmLENBQTVDO0FBQ0QsT0FGZSxFQUViLElBRmEsQ0FFUixFQUZRLENBQWhCO0FBR0QsS0FMRDs7QUFPQTs7Ozs7Ozs7OztBQVVBLFFBQUksV0FBVyxTQUFYLFFBQVcsQ0FBVSxJQUFWLEVBQWdCLElBQWhCLEVBQXNCLFNBQXRCLEVBQWlDO0FBQzlDLFVBQUksT0FBSjtBQUNBLGFBQU8sWUFBWTtBQUNqQixZQUFJLFVBQVUsSUFBZDtBQUFBLFlBQW9CLE9BQU8sU0FBM0I7QUFDQSxZQUFJLFFBQVEsU0FBUixLQUFRLEdBQVk7QUFDdEIsb0JBQVUsSUFBVjtBQUNBLGNBQUksQ0FBQyxTQUFMLEVBQWdCO0FBQ2QsaUJBQUssS0FBTCxDQUFXLE9BQVgsRUFBb0IsSUFBcEI7QUFDRDtBQUNGLFNBTEQ7QUFNQSxZQUFJLFVBQVUsYUFBYSxDQUFDLE9BQTVCO0FBQ0EscUJBQWEsT0FBYjtBQUNBLGtCQUFVLFdBQVcsS0FBWCxFQUFrQixJQUFsQixDQUFWO0FBQ0EsWUFBSSxPQUFKLEVBQWE7QUFDWCxlQUFLLEtBQUwsQ0FBVyxPQUFYLEVBQW9CLElBQXBCO0FBQ0Q7QUFDRixPQWREO0FBZUQsS0FqQkQ7O0FBbUJBLFdBQU87QUFDTCxVQUFJLEVBREM7QUFFTCxXQUFLLEdBRkE7QUFHTCxZQUFNLElBSEQ7QUFJTCxVQUFJLEVBSkM7QUFLTCxZQUFNLElBTEQ7QUFNTCxZQUFNLElBTkQ7QUFPTCxXQUFLLEdBUEE7QUFRTCxXQUFLLEdBUkE7QUFTTCxjQUFRLE1BVEg7QUFVTCxnQkFBVSxRQVZMO0FBV0wsZ0JBQVUsUUFYTDtBQVlMLG9CQUFjLFlBWlQ7QUFhTCx3QkFBa0IsZ0JBYmI7QUFjTCxnQkFBVTtBQWRMLEtBQVA7QUFnQkQsR0ExSlUsRUFBWDs7QUE0SkE7Ozs7Ozs7O0FBUUEsTUFBSSxPQUFRLFlBQVk7QUFDdEI7Ozs7O0FBS0EsUUFBSSxPQUFPLFNBQVAsSUFBTyxDQUFVLEtBQVYsRUFBaUI7QUFDMUIsYUFBTyxNQUFNLENBQU4sQ0FBUDtBQUNELEtBRkQ7O0FBSUE7Ozs7O0FBS0EsUUFBSSxPQUFPLFNBQVAsSUFBTyxDQUFVLEtBQVYsRUFBaUI7QUFDMUIsYUFBTyxNQUFNLE1BQU0sTUFBTixHQUFlLENBQXJCLENBQVA7QUFDRCxLQUZEOztBQUlBOzs7OztBQUtBLFFBQUksVUFBVSxTQUFWLE9BQVUsQ0FBVSxLQUFWLEVBQWlCO0FBQzdCLGFBQU8sTUFBTSxLQUFOLENBQVksQ0FBWixFQUFlLE1BQU0sTUFBTixHQUFlLENBQTlCLENBQVA7QUFDRCxLQUZEOztBQUlBOzs7OztBQUtBLFFBQUksT0FBTyxTQUFQLElBQU8sQ0FBVSxLQUFWLEVBQWlCO0FBQzFCLGFBQU8sTUFBTSxLQUFOLENBQVksQ0FBWixDQUFQO0FBQ0QsS0FGRDs7QUFJQTs7O0FBR0EsUUFBSSxPQUFPLFNBQVAsSUFBTyxDQUFVLEtBQVYsRUFBaUIsSUFBakIsRUFBdUI7QUFDaEMsV0FBSyxJQUFJLE1BQU0sQ0FBVixFQUFhLE1BQU0sTUFBTSxNQUE5QixFQUFzQyxNQUFNLEdBQTVDLEVBQWlELEtBQWpELEVBQXlEO0FBQ3ZELFlBQUksT0FBTyxNQUFNLEdBQU4sQ0FBWDtBQUNBLFlBQUksS0FBSyxJQUFMLENBQUosRUFBZ0I7QUFDZCxpQkFBTyxJQUFQO0FBQ0Q7QUFDRjtBQUNGLEtBUEQ7O0FBU0E7OztBQUdBLFFBQUksTUFBTSxTQUFOLEdBQU0sQ0FBVSxLQUFWLEVBQWlCLElBQWpCLEVBQXVCO0FBQy9CLFdBQUssSUFBSSxNQUFNLENBQVYsRUFBYSxNQUFNLE1BQU0sTUFBOUIsRUFBc0MsTUFBTSxHQUE1QyxFQUFpRCxLQUFqRCxFQUF5RDtBQUN2RCxZQUFJLENBQUMsS0FBSyxNQUFNLEdBQU4sQ0FBTCxDQUFMLEVBQXVCO0FBQ3JCLGlCQUFPLEtBQVA7QUFDRDtBQUNGO0FBQ0QsYUFBTyxJQUFQO0FBQ0QsS0FQRDs7QUFTQTs7O0FBR0EsUUFBSSxVQUFVLFNBQVYsT0FBVSxDQUFVLEtBQVYsRUFBaUIsSUFBakIsRUFBdUI7QUFDbkMsYUFBTyxFQUFFLE9BQUYsQ0FBVSxJQUFWLEVBQWdCLEtBQWhCLENBQVA7QUFDRCxLQUZEOztBQUlBOzs7QUFHQSxRQUFJLFdBQVcsU0FBWCxRQUFXLENBQVUsS0FBVixFQUFpQixJQUFqQixFQUF1QjtBQUNwQyxhQUFPLFFBQVEsS0FBUixFQUFlLElBQWYsTUFBeUIsQ0FBQyxDQUFqQztBQUNELEtBRkQ7O0FBSUE7Ozs7OztBQU1BLFFBQUksTUFBTSxTQUFOLEdBQU0sQ0FBVSxLQUFWLEVBQWlCLEVBQWpCLEVBQXFCO0FBQzdCLFdBQUssTUFBTSxLQUFLLElBQWhCO0FBQ0EsYUFBTyxNQUFNLE1BQU4sQ0FBYSxVQUFVLElBQVYsRUFBZ0IsQ0FBaEIsRUFBbUI7QUFDckMsZUFBTyxPQUFPLEdBQUcsQ0FBSCxDQUFkO0FBQ0QsT0FGTSxFQUVKLENBRkksQ0FBUDtBQUdELEtBTEQ7O0FBT0E7Ozs7QUFJQSxRQUFJLE9BQU8sU0FBUCxJQUFPLENBQVUsVUFBVixFQUFzQjtBQUMvQixVQUFJLFNBQVMsRUFBYjtBQUFBLFVBQWlCLE1BQU0sQ0FBQyxDQUF4QjtBQUFBLFVBQTJCLFNBQVMsV0FBVyxNQUEvQztBQUNBLGFBQU8sRUFBRSxHQUFGLEdBQVEsTUFBZixFQUF1QjtBQUNyQixlQUFPLEdBQVAsSUFBYyxXQUFXLEdBQVgsQ0FBZDtBQUNEO0FBQ0QsYUFBTyxNQUFQO0FBQ0QsS0FORDs7QUFRQTs7O0FBR0EsUUFBSSxVQUFVLFNBQVYsT0FBVSxDQUFVLEtBQVYsRUFBaUI7QUFDN0IsYUFBTyxDQUFDLEtBQUQsSUFBVSxDQUFDLE1BQU0sTUFBeEI7QUFDRCxLQUZEOztBQUlBOzs7Ozs7O0FBT0EsUUFBSSxZQUFZLFNBQVosU0FBWSxDQUFVLEtBQVYsRUFBaUIsRUFBakIsRUFBcUI7QUFDbkMsVUFBSSxDQUFDLE1BQU0sTUFBWCxFQUFtQjtBQUFFLGVBQU8sRUFBUDtBQUFZO0FBQ2pDLFVBQUksUUFBUSxLQUFLLEtBQUwsQ0FBWjtBQUNBLGFBQU8sTUFBTSxNQUFOLENBQWEsVUFBVSxJQUFWLEVBQWdCLENBQWhCLEVBQW1CO0FBQ3JDLFlBQUksUUFBUSxLQUFLLElBQUwsQ0FBWjtBQUNBLFlBQUksR0FBRyxLQUFLLEtBQUwsQ0FBSCxFQUFnQixDQUFoQixDQUFKLEVBQXdCO0FBQ3RCLGdCQUFNLE1BQU0sTUFBWixJQUFzQixDQUF0QjtBQUNELFNBRkQsTUFFTztBQUNMLGVBQUssS0FBSyxNQUFWLElBQW9CLENBQUMsQ0FBRCxDQUFwQjtBQUNEO0FBQ0QsZUFBTyxJQUFQO0FBQ0QsT0FSTSxFQVFKLENBQUMsQ0FBQyxLQUFLLEtBQUwsQ0FBRCxDQUFELENBUkksQ0FBUDtBQVNELEtBWkQ7O0FBY0E7Ozs7OztBQU1BLFFBQUksVUFBVSxTQUFWLE9BQVUsQ0FBVSxLQUFWLEVBQWlCO0FBQzdCLFVBQUksVUFBVSxFQUFkO0FBQ0EsV0FBSyxJQUFJLE1BQU0sQ0FBVixFQUFhLE1BQU0sTUFBTSxNQUE5QixFQUFzQyxNQUFNLEdBQTVDLEVBQWlELEtBQWpELEVBQXlEO0FBQ3ZELFlBQUksTUFBTSxHQUFOLENBQUosRUFBZ0I7QUFBRSxrQkFBUSxJQUFSLENBQWEsTUFBTSxHQUFOLENBQWI7QUFBMkI7QUFDOUM7QUFDRCxhQUFPLE9BQVA7QUFDRCxLQU5EOztBQVFBOzs7OztBQUtBLFFBQUksU0FBUyxTQUFULE1BQVMsQ0FBVSxLQUFWLEVBQWlCO0FBQzVCLFVBQUksVUFBVSxFQUFkOztBQUVBLFdBQUssSUFBSSxNQUFNLENBQVYsRUFBYSxNQUFNLE1BQU0sTUFBOUIsRUFBc0MsTUFBTSxHQUE1QyxFQUFpRCxLQUFqRCxFQUF5RDtBQUN2RCxZQUFJLENBQUMsU0FBUyxPQUFULEVBQWtCLE1BQU0sR0FBTixDQUFsQixDQUFMLEVBQW9DO0FBQ2xDLGtCQUFRLElBQVIsQ0FBYSxNQUFNLEdBQU4sQ0FBYjtBQUNEO0FBQ0Y7O0FBRUQsYUFBTyxPQUFQO0FBQ0QsS0FWRDs7QUFZQTs7OztBQUlBLFFBQUksT0FBTyxTQUFQLElBQU8sQ0FBVSxLQUFWLEVBQWlCLElBQWpCLEVBQXVCO0FBQ2hDLFVBQUksTUFBTSxRQUFRLEtBQVIsRUFBZSxJQUFmLENBQVY7QUFDQSxVQUFJLFFBQVEsQ0FBQyxDQUFiLEVBQWdCO0FBQUUsZUFBTyxJQUFQO0FBQWM7O0FBRWhDLGFBQU8sTUFBTSxNQUFNLENBQVosQ0FBUDtBQUNELEtBTEQ7O0FBT0E7Ozs7QUFJQSxRQUFJLE9BQU8sU0FBUCxJQUFPLENBQVUsS0FBVixFQUFpQixJQUFqQixFQUF1QjtBQUNoQyxVQUFJLE1BQU0sUUFBUSxLQUFSLEVBQWUsSUFBZixDQUFWO0FBQ0EsVUFBSSxRQUFRLENBQUMsQ0FBYixFQUFnQjtBQUFFLGVBQU8sSUFBUDtBQUFjOztBQUVoQyxhQUFPLE1BQU0sTUFBTSxDQUFaLENBQVA7QUFDRCxLQUxEOztBQU9BLFdBQU8sRUFBRSxNQUFNLElBQVIsRUFBYyxNQUFNLElBQXBCLEVBQTBCLFNBQVMsT0FBbkMsRUFBNEMsTUFBTSxJQUFsRDtBQUNFLFlBQU0sSUFEUixFQUNjLE1BQU0sSUFEcEIsRUFDMEIsTUFBTSxJQURoQyxFQUNzQyxVQUFVLFFBRGhEO0FBRUUsV0FBSyxHQUZQLEVBRVksS0FBSyxHQUZqQixFQUVzQixNQUFNLElBRjVCLEVBRWtDLFNBQVMsT0FGM0M7QUFHRSxpQkFBVyxTQUhiLEVBR3dCLFNBQVMsT0FIakMsRUFHMEMsUUFBUSxNQUhsRCxFQUFQO0FBSUQsR0F6TFUsRUFBWDs7QUEyTEEsTUFBSSxlQUFlLE9BQU8sTUFBUCxLQUFrQixVQUFsQixJQUFnQyxPQUFPLEdBQTFEOztBQUVBOzs7Ozs7QUFNQSxNQUFJLGtCQUFrQixTQUFsQixlQUFrQixDQUFVLFFBQVYsRUFBb0I7QUFDeEMsUUFBSSxlQUFlLGFBQWEsZUFBYixHQUErQixhQUEvQixHQUErQyxlQUFsRTtBQUNBLFFBQUksVUFBVSxFQUFFLE9BQUYsRUFBVyxHQUFYLENBQWU7QUFDM0IsZ0JBQVUsVUFEaUI7QUFFM0IsWUFBTSxTQUZxQjtBQUczQixXQUFLLFNBSHNCO0FBSTNCLGdCQUFVO0FBSmlCLEtBQWYsRUFLWCxJQUxXLENBS04sa0JBTE0sRUFLYyxRQUxkLENBS3VCLFNBQVMsSUFMaEMsQ0FBZDs7QUFPQSxRQUFJLGdCQUFnQixRQUFRLEdBQVIsQ0FBWSxZQUFaLEVBQTBCLFlBQTFCLEVBQXdDLEtBQXhDLEVBQXBCO0FBQ0EsUUFBSSxRQUFRLFFBQVEsR0FBUixDQUFZLFlBQVosRUFBMEIsV0FBVyxHQUFYLEdBQWlCLFlBQTNDLEVBQXlELEtBQXpELEVBQVo7O0FBRUEsWUFBUSxNQUFSOztBQUVBLFdBQU8sa0JBQWtCLEtBQXpCO0FBQ0QsR0FmRDs7QUFpQkEsTUFBSSxZQUFZLFVBQVUsU0FBMUI7QUFDQSxNQUFJLFNBQVMsZ0JBQWdCLElBQWhCLENBQXFCLFNBQXJCLENBQWI7QUFDQSxNQUFJLGNBQUo7QUFDQSxNQUFJLE1BQUosRUFBWTtBQUNWLFFBQUksVUFBVSxtQkFBbUIsSUFBbkIsQ0FBd0IsU0FBeEIsQ0FBZDtBQUNBLFFBQUksT0FBSixFQUFhO0FBQ1gsdUJBQWlCLFdBQVcsUUFBUSxDQUFSLENBQVgsQ0FBakI7QUFDRDtBQUNELGNBQVUsdUNBQXVDLElBQXZDLENBQTRDLFNBQTVDLENBQVY7QUFDQSxRQUFJLE9BQUosRUFBYTtBQUNYLHVCQUFpQixXQUFXLFFBQVEsQ0FBUixDQUFYLENBQWpCO0FBQ0Q7QUFDRjs7QUFFRCxNQUFJLFNBQVMsWUFBWSxJQUFaLENBQWlCLFNBQWpCLENBQWI7O0FBRUEsTUFBSSxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sVUFBN0I7QUFDQSxNQUFJLENBQUMsYUFBRCxJQUFrQixZQUF0QixFQUFvQztBQUNsQyxZQUFRLFlBQVI7QUFDQSxvQkFBZ0IsSUFBaEI7QUFDRDs7QUFFRDs7Ozs7Ozs7QUFRQSxNQUFJLFFBQVE7QUFDVixXQUFPLFVBQVUsVUFBVixDQUFxQixPQUFyQixDQUE2QixLQUE3QixJQUFzQyxDQUFDLENBRHBDO0FBRVYsWUFBUSxNQUZFO0FBR1YsWUFBUSxNQUhFO0FBSVYsVUFBTSxDQUFDLE1BQUQsSUFBVyxXQUFXLElBQVgsQ0FBZ0IsU0FBaEIsQ0FKUDtBQUtWLGVBQVcsYUFBYSxJQUFiLENBQWtCLFNBQWxCLENBTEQ7QUFNVixjQUFVLENBQUMsTUFBRCxJQUFXLFVBQVUsSUFBVixDQUFlLFNBQWYsQ0FOWDtBQU9WLGNBQVUsQ0FBQyxNQUFELElBQVcsVUFBVSxJQUFWLENBQWUsU0FBZixDQVBYO0FBUVYsY0FBVSxDQUFDLE1BQUQsSUFBVyxVQUFVLElBQVYsQ0FBZSxTQUFmLENBUlg7QUFTVixvQkFBZ0IsY0FUTjtBQVVWLG1CQUFlLFdBQVcsRUFBRSxFQUFGLENBQUssTUFBaEIsQ0FWTDtBQVdWLGtCQUFjLFlBWEo7QUFZVixtQkFBZSxhQVpMO0FBYVYscUJBQWlCLGVBYlA7QUFjVix1QkFBbUIsQ0FBQyxDQUFDLFNBQVM7QUFkcEIsR0FBWjs7QUFrQkEsTUFBSSxZQUFZLE9BQU8sWUFBUCxDQUFvQixHQUFwQixDQUFoQjtBQUNBLE1BQUksdUJBQXVCLFFBQTNCOztBQUVBOzs7Ozs7OztBQVFBLE1BQUksTUFBTyxZQUFZO0FBQ3JCOzs7Ozs7OztBQVFBLFFBQUksYUFBYSxTQUFiLFVBQWEsQ0FBVSxJQUFWLEVBQWdCO0FBQy9CLGFBQU8sUUFBUSxFQUFFLElBQUYsRUFBUSxRQUFSLENBQWlCLGVBQWpCLENBQWY7QUFDRCxLQUZEOztBQUlBOzs7Ozs7OztBQVFBLFFBQUksa0JBQWtCLFNBQWxCLGVBQWtCLENBQVUsSUFBVixFQUFnQjtBQUNwQyxhQUFPLFFBQVEsRUFBRSxJQUFGLEVBQVEsUUFBUixDQUFpQixxQkFBakIsQ0FBZjtBQUNELEtBRkQ7O0FBSUE7Ozs7Ozs7O0FBUUEsUUFBSSxxQkFBcUIsU0FBckIsa0JBQXFCLENBQVUsUUFBVixFQUFvQjtBQUMzQyxpQkFBVyxTQUFTLFdBQVQsRUFBWDtBQUNBLGFBQU8sVUFBVSxJQUFWLEVBQWdCO0FBQ3JCLGVBQU8sUUFBUSxLQUFLLFFBQUwsQ0FBYyxXQUFkLE9BQWdDLFFBQS9DO0FBQ0QsT0FGRDtBQUdELEtBTEQ7O0FBT0E7Ozs7Ozs7O0FBUUEsUUFBSSxTQUFTLFNBQVQsTUFBUyxDQUFVLElBQVYsRUFBZ0I7QUFDM0IsYUFBTyxRQUFRLEtBQUssUUFBTCxLQUFrQixDQUFqQztBQUNELEtBRkQ7O0FBSUE7Ozs7Ozs7O0FBUUEsUUFBSSxZQUFZLFNBQVosU0FBWSxDQUFVLElBQVYsRUFBZ0I7QUFDOUIsYUFBTyxRQUFRLEtBQUssUUFBTCxLQUFrQixDQUFqQztBQUNELEtBRkQ7O0FBSUE7Ozs7QUFJQSxRQUFJLFNBQVMsU0FBVCxNQUFTLENBQVUsSUFBVixFQUFnQjtBQUMzQixhQUFPLFFBQVEsK0JBQStCLElBQS9CLENBQW9DLEtBQUssUUFBTCxDQUFjLFdBQWQsRUFBcEMsQ0FBZjtBQUNELEtBRkQ7O0FBSUEsUUFBSSxTQUFTLFNBQVQsTUFBUyxDQUFVLElBQVYsRUFBZ0I7QUFDM0IsVUFBSSxXQUFXLElBQVgsQ0FBSixFQUFzQjtBQUNwQixlQUFPLEtBQVA7QUFDRDs7QUFFRDtBQUNBLGFBQU8sUUFBUSxzQkFBc0IsSUFBdEIsQ0FBMkIsS0FBSyxRQUFMLENBQWMsV0FBZCxFQUEzQixDQUFmO0FBQ0QsS0FQRDs7QUFTQSxRQUFJLFlBQVksU0FBWixTQUFZLENBQVUsSUFBVixFQUFnQjtBQUM5QixhQUFPLFFBQVEsVUFBVSxJQUFWLENBQWUsS0FBSyxRQUFMLENBQWMsV0FBZCxFQUFmLENBQWY7QUFDRCxLQUZEOztBQUlBLFFBQUksUUFBUSxtQkFBbUIsS0FBbkIsQ0FBWjs7QUFFQSxRQUFJLE9BQU8sbUJBQW1CLElBQW5CLENBQVg7O0FBRUEsUUFBSSxhQUFhLFNBQWIsVUFBYSxDQUFVLElBQVYsRUFBZ0I7QUFDL0IsYUFBTyxPQUFPLElBQVAsS0FBZ0IsQ0FBQyxLQUFLLElBQUwsQ0FBeEI7QUFDRCxLQUZEOztBQUlBLFFBQUksVUFBVSxtQkFBbUIsT0FBbkIsQ0FBZDs7QUFFQSxRQUFJLFNBQVMsbUJBQW1CLE1BQW5CLENBQWI7O0FBRUEsUUFBSSxXQUFXLFNBQVgsUUFBVyxDQUFVLElBQVYsRUFBZ0I7QUFDN0IsYUFBTyxDQUFDLGdCQUFnQixJQUFoQixDQUFELElBQ0EsQ0FBQyxPQUFPLElBQVAsQ0FERCxJQUVBLENBQUMsS0FBSyxJQUFMLENBRkQsSUFHQSxDQUFDLE9BQU8sSUFBUCxDQUhELElBSUEsQ0FBQyxRQUFRLElBQVIsQ0FKRCxJQUtBLENBQUMsYUFBYSxJQUFiLENBTEQsSUFNQSxDQUFDLE9BQU8sSUFBUCxDQU5SO0FBT0QsS0FSRDs7QUFVQSxRQUFJLFNBQVMsU0FBVCxNQUFTLENBQVUsSUFBVixFQUFnQjtBQUMzQixhQUFPLFFBQVEsVUFBVSxJQUFWLENBQWUsS0FBSyxRQUFMLENBQWMsV0FBZCxFQUFmLENBQWY7QUFDRCxLQUZEOztBQUlBLFFBQUksT0FBTyxtQkFBbUIsSUFBbkIsQ0FBWDs7QUFFQSxRQUFJLFNBQVMsU0FBVCxNQUFTLENBQVUsSUFBVixFQUFnQjtBQUMzQixhQUFPLFFBQVEsVUFBVSxJQUFWLENBQWUsS0FBSyxRQUFMLENBQWMsV0FBZCxFQUFmLENBQWY7QUFDRCxLQUZEOztBQUlBLFFBQUksZUFBZSxtQkFBbUIsWUFBbkIsQ0FBbkI7O0FBRUEsUUFBSSxrQkFBa0IsU0FBbEIsZUFBa0IsQ0FBVSxJQUFWLEVBQWdCO0FBQ3BDLGFBQU8sT0FBTyxJQUFQLEtBQWdCLGFBQWEsSUFBYixDQUFoQixJQUFzQyxXQUFXLElBQVgsQ0FBN0M7QUFDRCxLQUZEOztBQUlBLFFBQUksV0FBVyxtQkFBbUIsR0FBbkIsQ0FBZjs7QUFFQSxRQUFJLGVBQWUsU0FBZixZQUFlLENBQVUsSUFBVixFQUFnQjtBQUNqQyxhQUFPLFNBQVMsSUFBVCxLQUFrQixDQUFDLENBQUMsU0FBUyxJQUFULEVBQWUsTUFBZixDQUEzQjtBQUNELEtBRkQ7O0FBSUEsUUFBSSxlQUFlLFNBQWYsWUFBZSxDQUFVLElBQVYsRUFBZ0I7QUFDakMsYUFBTyxTQUFTLElBQVQsS0FBa0IsQ0FBQyxTQUFTLElBQVQsRUFBZSxNQUFmLENBQTFCO0FBQ0QsS0FGRDs7QUFJQSxRQUFJLFNBQVMsbUJBQW1CLE1BQW5CLENBQWI7O0FBRUE7Ozs7Ozs7QUFPQSxRQUFJLG1CQUFtQixTQUFuQixnQkFBbUIsQ0FBVSxLQUFWLEVBQWlCLEtBQWpCLEVBQXdCO0FBQzdDLGFBQU8sTUFBTSxXQUFOLEtBQXNCLEtBQXRCLElBQ0EsTUFBTSxlQUFOLEtBQTBCLEtBRGpDO0FBRUQsS0FIRDs7QUFLQTs7Ozs7OztBQU9BLFFBQUksc0JBQXNCLFNBQXRCLG1CQUFzQixDQUFVLElBQVYsRUFBZ0IsSUFBaEIsRUFBc0I7QUFDOUMsYUFBTyxRQUFRLEtBQUssRUFBcEI7O0FBRUEsVUFBSSxXQUFXLEVBQWY7QUFDQSxVQUFJLEtBQUssZUFBTCxJQUF3QixLQUFLLEtBQUssZUFBVixDQUE1QixFQUF3RDtBQUN0RCxpQkFBUyxJQUFULENBQWMsS0FBSyxlQUFuQjtBQUNEO0FBQ0QsZUFBUyxJQUFULENBQWMsSUFBZDtBQUNBLFVBQUksS0FBSyxXQUFMLElBQW9CLEtBQUssS0FBSyxXQUFWLENBQXhCLEVBQWdEO0FBQzlDLGlCQUFTLElBQVQsQ0FBYyxLQUFLLFdBQW5CO0FBQ0Q7QUFDRCxhQUFPLFFBQVA7QUFDRCxLQVpEOztBQWNBOzs7OztBQUtBLFFBQUksWUFBWSxNQUFNLE1BQU4sSUFBZ0IsTUFBTSxjQUFOLEdBQXVCLEVBQXZDLEdBQTRDLFFBQTVDLEdBQXVELE1BQXZFOztBQUVBOzs7Ozs7O0FBT0EsUUFBSSxhQUFhLFNBQWIsVUFBYSxDQUFVLElBQVYsRUFBZ0I7QUFDL0IsVUFBSSxPQUFPLElBQVAsQ0FBSixFQUFrQjtBQUNoQixlQUFPLEtBQUssU0FBTCxDQUFlLE1BQXRCO0FBQ0Q7O0FBRUQsVUFBSSxJQUFKLEVBQVU7QUFDUixlQUFPLEtBQUssVUFBTCxDQUFnQixNQUF2QjtBQUNEOztBQUVELGFBQU8sQ0FBUDtBQUVELEtBWEQ7O0FBYUE7Ozs7OztBQU1BLFFBQUksVUFBVSxTQUFWLE9BQVUsQ0FBVSxJQUFWLEVBQWdCO0FBQzVCLFVBQUksTUFBTSxXQUFXLElBQVgsQ0FBVjs7QUFFQSxVQUFJLFFBQVEsQ0FBWixFQUFlO0FBQ2IsZUFBTyxJQUFQO0FBQ0QsT0FGRCxNQUVPLElBQUksQ0FBQyxPQUFPLElBQVAsQ0FBRCxJQUFpQixRQUFRLENBQXpCLElBQThCLEtBQUssU0FBTCxLQUFtQixTQUFyRCxFQUFnRTtBQUNyRTtBQUNBLGVBQU8sSUFBUDtBQUNELE9BSE0sTUFHQSxJQUFJLEtBQUssR0FBTCxDQUFTLEtBQUssVUFBZCxFQUEwQixNQUExQixLQUFxQyxLQUFLLFNBQUwsS0FBbUIsRUFBNUQsRUFBZ0U7QUFDckU7QUFDQSxlQUFPLElBQVA7QUFDRDs7QUFFRCxhQUFPLEtBQVA7QUFDRCxLQWREOztBQWdCQTs7O0FBR0EsUUFBSSxtQkFBbUIsU0FBbkIsZ0JBQW1CLENBQVUsSUFBVixFQUFnQjtBQUNyQyxVQUFJLENBQUMsT0FBTyxJQUFQLENBQUQsSUFBaUIsQ0FBQyxXQUFXLElBQVgsQ0FBdEIsRUFBd0M7QUFDdEMsYUFBSyxTQUFMLEdBQWlCLFNBQWpCO0FBQ0Q7QUFDRixLQUpEOztBQU1BOzs7Ozs7QUFNQSxRQUFJLFdBQVcsU0FBWCxRQUFXLENBQVUsSUFBVixFQUFnQixJQUFoQixFQUFzQjtBQUNuQyxhQUFPLElBQVAsRUFBYTtBQUNYLFlBQUksS0FBSyxJQUFMLENBQUosRUFBZ0I7QUFBRSxpQkFBTyxJQUFQO0FBQWM7QUFDaEMsWUFBSSxXQUFXLElBQVgsQ0FBSixFQUFzQjtBQUFFO0FBQVE7O0FBRWhDLGVBQU8sS0FBSyxVQUFaO0FBQ0Q7QUFDRCxhQUFPLElBQVA7QUFDRCxLQVJEOztBQVVBOzs7Ozs7QUFNQSxRQUFJLHNCQUFzQixTQUF0QixtQkFBc0IsQ0FBVSxJQUFWLEVBQWdCLElBQWhCLEVBQXNCO0FBQzlDLGFBQU8sS0FBSyxVQUFaOztBQUVBLGFBQU8sSUFBUCxFQUFhO0FBQ1gsWUFBSSxXQUFXLElBQVgsTUFBcUIsQ0FBekIsRUFBNEI7QUFBRTtBQUFRO0FBQ3RDLFlBQUksS0FBSyxJQUFMLENBQUosRUFBZ0I7QUFBRSxpQkFBTyxJQUFQO0FBQWM7QUFDaEMsWUFBSSxXQUFXLElBQVgsQ0FBSixFQUFzQjtBQUFFO0FBQVE7O0FBRWhDLGVBQU8sS0FBSyxVQUFaO0FBQ0Q7QUFDRCxhQUFPLElBQVA7QUFDRCxLQVhEOztBQWFBOzs7Ozs7QUFNQSxRQUFJLGVBQWUsU0FBZixZQUFlLENBQVUsSUFBVixFQUFnQixJQUFoQixFQUFzQjtBQUN2QyxhQUFPLFFBQVEsS0FBSyxJQUFwQjs7QUFFQSxVQUFJLFlBQVksRUFBaEI7QUFDQSxlQUFTLElBQVQsRUFBZSxVQUFVLEVBQVYsRUFBYztBQUMzQixZQUFJLENBQUMsV0FBVyxFQUFYLENBQUwsRUFBcUI7QUFDbkIsb0JBQVUsSUFBVixDQUFlLEVBQWY7QUFDRDs7QUFFRCxlQUFPLEtBQUssRUFBTCxDQUFQO0FBQ0QsT0FORDtBQU9BLGFBQU8sU0FBUDtBQUNELEtBWkQ7O0FBY0E7OztBQUdBLFFBQUksZUFBZSxTQUFmLFlBQWUsQ0FBVSxJQUFWLEVBQWdCLElBQWhCLEVBQXNCO0FBQ3ZDLFVBQUksWUFBWSxhQUFhLElBQWIsQ0FBaEI7QUFDQSxhQUFPLEtBQUssSUFBTCxDQUFVLFVBQVUsTUFBVixDQUFpQixJQUFqQixDQUFWLENBQVA7QUFDRCxLQUhEOztBQUtBOzs7Ozs7QUFNQSxRQUFJLGlCQUFpQixTQUFqQixjQUFpQixDQUFVLEtBQVYsRUFBaUIsS0FBakIsRUFBd0I7QUFDM0MsVUFBSSxZQUFZLGFBQWEsS0FBYixDQUFoQjtBQUNBLFdBQUssSUFBSSxJQUFJLEtBQWIsRUFBb0IsQ0FBcEIsRUFBdUIsSUFBSSxFQUFFLFVBQTdCLEVBQXlDO0FBQ3ZDLFlBQUksRUFBRSxPQUFGLENBQVUsQ0FBVixFQUFhLFNBQWIsSUFBMEIsQ0FBQyxDQUEvQixFQUFrQztBQUFFLGlCQUFPLENBQVA7QUFBVztBQUNoRDtBQUNELGFBQU8sSUFBUCxDQUwyQyxDQUs5QjtBQUNkLEtBTkQ7O0FBUUE7Ozs7OztBQU1BLFFBQUksV0FBVyxTQUFYLFFBQVcsQ0FBVSxJQUFWLEVBQWdCLElBQWhCLEVBQXNCO0FBQ25DLGFBQU8sUUFBUSxLQUFLLElBQXBCOztBQUVBLFVBQUksUUFBUSxFQUFaO0FBQ0EsYUFBTyxJQUFQLEVBQWE7QUFDWCxZQUFJLEtBQUssSUFBTCxDQUFKLEVBQWdCO0FBQUU7QUFBUTtBQUMxQixjQUFNLElBQU4sQ0FBVyxJQUFYO0FBQ0EsZUFBTyxLQUFLLGVBQVo7QUFDRDtBQUNELGFBQU8sS0FBUDtBQUNELEtBVkQ7O0FBWUE7Ozs7OztBQU1BLFFBQUksV0FBVyxTQUFYLFFBQVcsQ0FBVSxJQUFWLEVBQWdCLElBQWhCLEVBQXNCO0FBQ25DLGFBQU8sUUFBUSxLQUFLLElBQXBCOztBQUVBLFVBQUksUUFBUSxFQUFaO0FBQ0EsYUFBTyxJQUFQLEVBQWE7QUFDWCxZQUFJLEtBQUssSUFBTCxDQUFKLEVBQWdCO0FBQUU7QUFBUTtBQUMxQixjQUFNLElBQU4sQ0FBVyxJQUFYO0FBQ0EsZUFBTyxLQUFLLFdBQVo7QUFDRDtBQUNELGFBQU8sS0FBUDtBQUNELEtBVkQ7O0FBWUE7Ozs7OztBQU1BLFFBQUksaUJBQWlCLFNBQWpCLGNBQWlCLENBQVUsSUFBVixFQUFnQixJQUFoQixFQUFzQjtBQUN6QyxVQUFJLGNBQWMsRUFBbEI7QUFDQSxhQUFPLFFBQVEsS0FBSyxFQUFwQjs7QUFFQTtBQUNBLE9BQUMsU0FBUyxNQUFULENBQWdCLE9BQWhCLEVBQXlCO0FBQ3hCLFlBQUksU0FBUyxPQUFULElBQW9CLEtBQUssT0FBTCxDQUF4QixFQUF1QztBQUNyQyxzQkFBWSxJQUFaLENBQWlCLE9BQWpCO0FBQ0Q7QUFDRCxhQUFLLElBQUksTUFBTSxDQUFWLEVBQWEsTUFBTSxRQUFRLFVBQVIsQ0FBbUIsTUFBM0MsRUFBbUQsTUFBTSxHQUF6RCxFQUE4RCxLQUE5RCxFQUFxRTtBQUNuRSxpQkFBTyxRQUFRLFVBQVIsQ0FBbUIsR0FBbkIsQ0FBUDtBQUNEO0FBQ0YsT0FQRCxFQU9HLElBUEg7O0FBU0EsYUFBTyxXQUFQO0FBQ0QsS0FmRDs7QUFpQkE7Ozs7Ozs7QUFPQSxRQUFJLE9BQU8sU0FBUCxJQUFPLENBQVUsSUFBVixFQUFnQixXQUFoQixFQUE2QjtBQUN0QyxVQUFJLFNBQVMsS0FBSyxVQUFsQjtBQUNBLFVBQUksVUFBVSxFQUFFLE1BQU0sV0FBTixHQUFvQixHQUF0QixFQUEyQixDQUEzQixDQUFkOztBQUVBLGFBQU8sWUFBUCxDQUFvQixPQUFwQixFQUE2QixJQUE3QjtBQUNBLGNBQVEsV0FBUixDQUFvQixJQUFwQjs7QUFFQSxhQUFPLE9BQVA7QUFDRCxLQVJEOztBQVVBOzs7Ozs7QUFNQSxRQUFJLGNBQWMsU0FBZCxXQUFjLENBQVUsSUFBVixFQUFnQixTQUFoQixFQUEyQjtBQUMzQyxVQUFJLE9BQU8sVUFBVSxXQUFyQjtBQUFBLFVBQWtDLFNBQVMsVUFBVSxVQUFyRDtBQUNBLFVBQUksSUFBSixFQUFVO0FBQ1IsZUFBTyxZQUFQLENBQW9CLElBQXBCLEVBQTBCLElBQTFCO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsZUFBTyxXQUFQLENBQW1CLElBQW5CO0FBQ0Q7QUFDRCxhQUFPLElBQVA7QUFDRCxLQVJEOztBQVVBOzs7Ozs7QUFNQSxRQUFJLG1CQUFtQixTQUFuQixnQkFBbUIsQ0FBVSxJQUFWLEVBQWdCLE1BQWhCLEVBQXdCO0FBQzdDLFFBQUUsSUFBRixDQUFPLE1BQVAsRUFBZSxVQUFVLEdBQVYsRUFBZSxLQUFmLEVBQXNCO0FBQ25DLGFBQUssV0FBTCxDQUFpQixLQUFqQjtBQUNELE9BRkQ7QUFHQSxhQUFPLElBQVA7QUFDRCxLQUxEOztBQU9BOzs7Ozs7QUFNQSxRQUFJLGtCQUFrQixTQUFsQixlQUFrQixDQUFVLEtBQVYsRUFBaUI7QUFDckMsYUFBTyxNQUFNLE1BQU4sS0FBaUIsQ0FBeEI7QUFDRCxLQUZEOztBQUlBOzs7Ozs7QUFNQSxRQUFJLG1CQUFtQixTQUFuQixnQkFBbUIsQ0FBVSxLQUFWLEVBQWlCO0FBQ3RDLGFBQU8sTUFBTSxNQUFOLEtBQWlCLFdBQVcsTUFBTSxJQUFqQixDQUF4QjtBQUNELEtBRkQ7O0FBSUE7Ozs7OztBQU1BLFFBQUksY0FBYyxTQUFkLFdBQWMsQ0FBVSxLQUFWLEVBQWlCO0FBQ2pDLGFBQU8sZ0JBQWdCLEtBQWhCLEtBQTBCLGlCQUFpQixLQUFqQixDQUFqQztBQUNELEtBRkQ7O0FBSUE7Ozs7Ozs7QUFPQSxRQUFJLGVBQWUsU0FBZixZQUFlLENBQVUsSUFBVixFQUFnQixRQUFoQixFQUEwQjtBQUMzQyxhQUFPLFFBQVEsU0FBUyxRQUF4QixFQUFrQztBQUNoQyxZQUFJLFNBQVMsSUFBVCxNQUFtQixDQUF2QixFQUEwQjtBQUN4QixpQkFBTyxLQUFQO0FBQ0Q7QUFDRCxlQUFPLEtBQUssVUFBWjtBQUNEOztBQUVELGFBQU8sSUFBUDtBQUNELEtBVEQ7O0FBV0E7Ozs7Ozs7QUFPQSxRQUFJLGdCQUFnQixTQUFoQixhQUFnQixDQUFVLElBQVYsRUFBZ0IsUUFBaEIsRUFBMEI7QUFDNUMsVUFBSSxDQUFDLFFBQUwsRUFBZTtBQUNiLGVBQU8sS0FBUDtBQUNEO0FBQ0QsYUFBTyxRQUFRLFNBQVMsUUFBeEIsRUFBa0M7QUFDaEMsWUFBSSxTQUFTLElBQVQsTUFBbUIsV0FBVyxLQUFLLFVBQWhCLElBQThCLENBQXJELEVBQXdEO0FBQ3RELGlCQUFPLEtBQVA7QUFDRDtBQUNELGVBQU8sS0FBSyxVQUFaO0FBQ0Q7O0FBRUQsYUFBTyxJQUFQO0FBQ0QsS0FaRDs7QUFjQTs7Ozs7O0FBTUEsUUFBSSxvQkFBb0IsU0FBcEIsaUJBQW9CLENBQVUsS0FBVixFQUFpQixRQUFqQixFQUEyQjtBQUNqRCxhQUFPLGdCQUFnQixLQUFoQixLQUEwQixhQUFhLE1BQU0sSUFBbkIsRUFBeUIsUUFBekIsQ0FBakM7QUFDRCxLQUZEOztBQUlBOzs7Ozs7QUFNQSxRQUFJLHFCQUFxQixTQUFyQixrQkFBcUIsQ0FBVSxLQUFWLEVBQWlCLFFBQWpCLEVBQTJCO0FBQ2xELGFBQU8saUJBQWlCLEtBQWpCLEtBQTJCLGNBQWMsTUFBTSxJQUFwQixFQUEwQixRQUExQixDQUFsQztBQUNELEtBRkQ7O0FBSUE7Ozs7O0FBS0EsUUFBSSxXQUFXLFNBQVgsUUFBVyxDQUFVLElBQVYsRUFBZ0I7QUFDN0IsVUFBSSxTQUFTLENBQWI7QUFDQSxhQUFRLE9BQU8sS0FBSyxlQUFwQixFQUFzQztBQUNwQyxrQkFBVSxDQUFWO0FBQ0Q7QUFDRCxhQUFPLE1BQVA7QUFDRCxLQU5EOztBQVFBLFFBQUksY0FBYyxTQUFkLFdBQWMsQ0FBVSxJQUFWLEVBQWdCO0FBQ2hDLGFBQU8sQ0FBQyxFQUFFLFFBQVEsS0FBSyxVQUFiLElBQTJCLEtBQUssVUFBTCxDQUFnQixNQUE3QyxDQUFSO0FBQ0QsS0FGRDs7QUFJQTs7Ozs7OztBQU9BLFFBQUksWUFBWSxTQUFaLFNBQVksQ0FBVSxLQUFWLEVBQWlCLGlCQUFqQixFQUFvQztBQUNsRCxVQUFJLElBQUosRUFBVSxNQUFWOztBQUVBLFVBQUksTUFBTSxNQUFOLEtBQWlCLENBQXJCLEVBQXdCO0FBQ3RCLFlBQUksV0FBVyxNQUFNLElBQWpCLENBQUosRUFBNEI7QUFDMUIsaUJBQU8sSUFBUDtBQUNEOztBQUVELGVBQU8sTUFBTSxJQUFOLENBQVcsVUFBbEI7QUFDQSxpQkFBUyxTQUFTLE1BQU0sSUFBZixDQUFUO0FBQ0QsT0FQRCxNQU9PLElBQUksWUFBWSxNQUFNLElBQWxCLENBQUosRUFBNkI7QUFDbEMsZUFBTyxNQUFNLElBQU4sQ0FBVyxVQUFYLENBQXNCLE1BQU0sTUFBTixHQUFlLENBQXJDLENBQVA7QUFDQSxpQkFBUyxXQUFXLElBQVgsQ0FBVDtBQUNELE9BSE0sTUFHQTtBQUNMLGVBQU8sTUFBTSxJQUFiO0FBQ0EsaUJBQVMsb0JBQW9CLENBQXBCLEdBQXdCLE1BQU0sTUFBTixHQUFlLENBQWhEO0FBQ0Q7O0FBRUQsYUFBTztBQUNMLGNBQU0sSUFERDtBQUVMLGdCQUFRO0FBRkgsT0FBUDtBQUlELEtBdEJEOztBQXdCQTs7Ozs7OztBQU9BLFFBQUksWUFBWSxTQUFaLFNBQVksQ0FBVSxLQUFWLEVBQWlCLGlCQUFqQixFQUFvQztBQUNsRCxVQUFJLElBQUosRUFBVSxNQUFWOztBQUVBLFVBQUksV0FBVyxNQUFNLElBQWpCLE1BQTJCLE1BQU0sTUFBckMsRUFBNkM7QUFDM0MsWUFBSSxXQUFXLE1BQU0sSUFBakIsQ0FBSixFQUE0QjtBQUMxQixpQkFBTyxJQUFQO0FBQ0Q7O0FBRUQsZUFBTyxNQUFNLElBQU4sQ0FBVyxVQUFsQjtBQUNBLGlCQUFTLFNBQVMsTUFBTSxJQUFmLElBQXVCLENBQWhDO0FBQ0QsT0FQRCxNQU9PLElBQUksWUFBWSxNQUFNLElBQWxCLENBQUosRUFBNkI7QUFDbEMsZUFBTyxNQUFNLElBQU4sQ0FBVyxVQUFYLENBQXNCLE1BQU0sTUFBNUIsQ0FBUDtBQUNBLGlCQUFTLENBQVQ7QUFDRCxPQUhNLE1BR0E7QUFDTCxlQUFPLE1BQU0sSUFBYjtBQUNBLGlCQUFTLG9CQUFvQixXQUFXLE1BQU0sSUFBakIsQ0FBcEIsR0FBNkMsTUFBTSxNQUFOLEdBQWUsQ0FBckU7QUFDRDs7QUFFRCxhQUFPO0FBQ0wsY0FBTSxJQUREO0FBRUwsZ0JBQVE7QUFGSCxPQUFQO0FBSUQsS0F0QkQ7O0FBd0JBOzs7Ozs7O0FBT0EsUUFBSSxjQUFjLFNBQWQsV0FBYyxDQUFVLE1BQVYsRUFBa0IsTUFBbEIsRUFBMEI7QUFDMUMsYUFBTyxPQUFPLElBQVAsS0FBZ0IsT0FBTyxJQUF2QixJQUErQixPQUFPLE1BQVAsS0FBa0IsT0FBTyxNQUEvRDtBQUNELEtBRkQ7O0FBSUE7Ozs7OztBQU1BLFFBQUksaUJBQWlCLFNBQWpCLGNBQWlCLENBQVUsS0FBVixFQUFpQjtBQUNwQyxVQUFJLE9BQU8sTUFBTSxJQUFiLEtBQXNCLENBQUMsWUFBWSxNQUFNLElBQWxCLENBQXZCLElBQWtELFFBQVEsTUFBTSxJQUFkLENBQXRELEVBQTJFO0FBQ3pFLGVBQU8sSUFBUDtBQUNEOztBQUVELFVBQUksV0FBVyxNQUFNLElBQU4sQ0FBVyxVQUFYLENBQXNCLE1BQU0sTUFBTixHQUFlLENBQXJDLENBQWY7QUFDQSxVQUFJLFlBQVksTUFBTSxJQUFOLENBQVcsVUFBWCxDQUFzQixNQUFNLE1BQTVCLENBQWhCO0FBQ0EsVUFBSSxDQUFDLENBQUMsUUFBRCxJQUFhLE9BQU8sUUFBUCxDQUFkLE1BQW9DLENBQUMsU0FBRCxJQUFjLE9BQU8sU0FBUCxDQUFsRCxDQUFKLEVBQTBFO0FBQ3hFLGVBQU8sSUFBUDtBQUNEOztBQUVELGFBQU8sS0FBUDtBQUNELEtBWkQ7O0FBY0E7Ozs7Ozs7QUFPQSxRQUFJLGlCQUFpQixTQUFqQixjQUFpQixDQUFVLEtBQVYsRUFBaUIsSUFBakIsRUFBdUI7QUFDMUMsYUFBTyxLQUFQLEVBQWM7QUFDWixZQUFJLEtBQUssS0FBTCxDQUFKLEVBQWlCO0FBQ2YsaUJBQU8sS0FBUDtBQUNEOztBQUVELGdCQUFRLFVBQVUsS0FBVixDQUFSO0FBQ0Q7O0FBRUQsYUFBTyxJQUFQO0FBQ0QsS0FWRDs7QUFZQTs7Ozs7OztBQU9BLFFBQUksaUJBQWlCLFNBQWpCLGNBQWlCLENBQVUsS0FBVixFQUFpQixJQUFqQixFQUF1QjtBQUMxQyxhQUFPLEtBQVAsRUFBYztBQUNaLFlBQUksS0FBSyxLQUFMLENBQUosRUFBaUI7QUFDZixpQkFBTyxLQUFQO0FBQ0Q7O0FBRUQsZ0JBQVEsVUFBVSxLQUFWLENBQVI7QUFDRDs7QUFFRCxhQUFPLElBQVA7QUFDRCxLQVZEOztBQVlBOzs7Ozs7QUFNQSxRQUFJLGNBQWMsU0FBZCxXQUFjLENBQVUsS0FBVixFQUFpQjtBQUNqQyxVQUFJLENBQUMsT0FBTyxNQUFNLElBQWIsQ0FBTCxFQUF5QjtBQUN2QixlQUFPLEtBQVA7QUFDRDs7QUFFRCxVQUFJLEtBQUssTUFBTSxJQUFOLENBQVcsU0FBWCxDQUFxQixNQUFyQixDQUE0QixNQUFNLE1BQU4sR0FBZSxDQUEzQyxDQUFUO0FBQ0EsYUFBTyxNQUFPLE9BQU8sR0FBUCxJQUFjLE9BQU8sU0FBbkM7QUFDRCxLQVBEOztBQVNBOzs7Ozs7OztBQVFBLFFBQUksWUFBWSxTQUFaLFNBQVksQ0FBVSxVQUFWLEVBQXNCLFFBQXRCLEVBQWdDLE9BQWhDLEVBQXlDLGlCQUF6QyxFQUE0RDtBQUMxRSxVQUFJLFFBQVEsVUFBWjs7QUFFQSxhQUFPLEtBQVAsRUFBYztBQUNaLGdCQUFRLEtBQVI7O0FBRUEsWUFBSSxZQUFZLEtBQVosRUFBbUIsUUFBbkIsQ0FBSixFQUFrQztBQUNoQztBQUNEOztBQUVELFlBQUksZUFBZSxxQkFDQSxXQUFXLElBQVgsS0FBb0IsTUFBTSxJQUQxQixJQUVBLFNBQVMsSUFBVCxLQUFrQixNQUFNLElBRjNDO0FBR0EsZ0JBQVEsVUFBVSxLQUFWLEVBQWlCLFlBQWpCLENBQVI7QUFDRDtBQUNGLEtBZkQ7O0FBaUJBOzs7Ozs7OztBQVFBLFFBQUksaUJBQWlCLFNBQWpCLGNBQWlCLENBQVUsUUFBVixFQUFvQixJQUFwQixFQUEwQjtBQUM3QyxVQUFJLFlBQVksYUFBYSxJQUFiLEVBQW1CLEtBQUssRUFBTCxDQUFRLFFBQVIsQ0FBbkIsQ0FBaEI7QUFDQSxhQUFPLFVBQVUsR0FBVixDQUFjLFFBQWQsRUFBd0IsT0FBeEIsRUFBUDtBQUNELEtBSEQ7O0FBS0E7Ozs7Ozs7O0FBUUEsUUFBSSxpQkFBaUIsU0FBakIsY0FBaUIsQ0FBVSxRQUFWLEVBQW9CLE9BQXBCLEVBQTZCO0FBQ2hELFVBQUksVUFBVSxRQUFkO0FBQ0EsV0FBSyxJQUFJLElBQUksQ0FBUixFQUFXLE1BQU0sUUFBUSxNQUE5QixFQUFzQyxJQUFJLEdBQTFDLEVBQStDLEdBQS9DLEVBQW9EO0FBQ2xELFlBQUksUUFBUSxVQUFSLENBQW1CLE1BQW5CLElBQTZCLFFBQVEsQ0FBUixDQUFqQyxFQUE2QztBQUMzQyxvQkFBVSxRQUFRLFVBQVIsQ0FBbUIsUUFBUSxVQUFSLENBQW1CLE1BQW5CLEdBQTRCLENBQS9DLENBQVY7QUFDRCxTQUZELE1BRU87QUFDTCxvQkFBVSxRQUFRLFVBQVIsQ0FBbUIsUUFBUSxDQUFSLENBQW5CLENBQVY7QUFDRDtBQUNGO0FBQ0QsYUFBTyxPQUFQO0FBQ0QsS0FWRDs7QUFZQTs7Ozs7Ozs7Ozs7QUFXQSxRQUFJLFlBQVksU0FBWixTQUFZLENBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQjtBQUN4QyxVQUFJLHlCQUF5QixXQUFXLFFBQVEsc0JBQWhEO0FBQ0EsVUFBSSxzQkFBc0IsV0FBVyxRQUFRLG1CQUE3Qzs7QUFFQTtBQUNBLFVBQUksWUFBWSxLQUFaLE1BQXVCLE9BQU8sTUFBTSxJQUFiLEtBQXNCLG1CQUE3QyxDQUFKLEVBQXVFO0FBQ3JFLFlBQUksZ0JBQWdCLEtBQWhCLENBQUosRUFBNEI7QUFDMUIsaUJBQU8sTUFBTSxJQUFiO0FBQ0QsU0FGRCxNQUVPLElBQUksaUJBQWlCLEtBQWpCLENBQUosRUFBNkI7QUFDbEMsaUJBQU8sTUFBTSxJQUFOLENBQVcsV0FBbEI7QUFDRDtBQUNGOztBQUVEO0FBQ0EsVUFBSSxPQUFPLE1BQU0sSUFBYixDQUFKLEVBQXdCO0FBQ3RCLGVBQU8sTUFBTSxJQUFOLENBQVcsU0FBWCxDQUFxQixNQUFNLE1BQTNCLENBQVA7QUFDRCxPQUZELE1BRU87QUFDTCxZQUFJLFlBQVksTUFBTSxJQUFOLENBQVcsVUFBWCxDQUFzQixNQUFNLE1BQTVCLENBQWhCO0FBQ0EsWUFBSSxRQUFRLFlBQVksTUFBTSxJQUFOLENBQVcsU0FBWCxDQUFxQixLQUFyQixDQUFaLEVBQXlDLE1BQU0sSUFBL0MsQ0FBWjtBQUNBLHlCQUFpQixLQUFqQixFQUF3QixTQUFTLFNBQVQsQ0FBeEI7O0FBRUEsWUFBSSxDQUFDLHNCQUFMLEVBQTZCO0FBQzNCLDJCQUFpQixNQUFNLElBQXZCO0FBQ0EsMkJBQWlCLEtBQWpCO0FBQ0Q7O0FBRUQsZUFBTyxLQUFQO0FBQ0Q7QUFDRixLQTVCRDs7QUE4QkE7Ozs7Ozs7Ozs7OztBQVlBLFFBQUksWUFBWSxTQUFaLFNBQVksQ0FBVSxJQUFWLEVBQWdCLEtBQWhCLEVBQXVCLE9BQXZCLEVBQWdDO0FBQzlDO0FBQ0EsVUFBSSxZQUFZLGFBQWEsTUFBTSxJQUFuQixFQUF5QixLQUFLLEVBQUwsQ0FBUSxJQUFSLENBQXpCLENBQWhCOztBQUVBLFVBQUksQ0FBQyxVQUFVLE1BQWYsRUFBdUI7QUFDckIsZUFBTyxJQUFQO0FBQ0QsT0FGRCxNQUVPLElBQUksVUFBVSxNQUFWLEtBQXFCLENBQXpCLEVBQTRCO0FBQ2pDLGVBQU8sVUFBVSxLQUFWLEVBQWlCLE9BQWpCLENBQVA7QUFDRDs7QUFFRCxhQUFPLFVBQVUsTUFBVixDQUFpQixVQUFVLElBQVYsRUFBZ0IsTUFBaEIsRUFBd0I7QUFDOUMsWUFBSSxTQUFTLE1BQU0sSUFBbkIsRUFBeUI7QUFDdkIsaUJBQU8sVUFBVSxLQUFWLEVBQWlCLE9BQWpCLENBQVA7QUFDRDs7QUFFRCxlQUFPLFVBQVU7QUFDZixnQkFBTSxNQURTO0FBRWYsa0JBQVEsT0FBTyxJQUFJLFFBQUosQ0FBYSxJQUFiLENBQVAsR0FBNEIsV0FBVyxNQUFYO0FBRnJCLFNBQVYsRUFHSixPQUhJLENBQVA7QUFJRCxPQVRNLENBQVA7QUFVRCxLQXBCRDs7QUFzQkE7Ozs7Ozs7QUFPQSxRQUFJLGFBQWEsU0FBYixVQUFhLENBQVUsS0FBVixFQUFpQixRQUFqQixFQUEyQjtBQUMxQztBQUNBO0FBQ0E7QUFDQSxVQUFJLE9BQU8sV0FBVyxNQUFYLEdBQW9CLGVBQS9CO0FBQ0EsVUFBSSxZQUFZLGFBQWEsTUFBTSxJQUFuQixFQUF5QixJQUF6QixDQUFoQjtBQUNBLFVBQUksY0FBYyxLQUFLLElBQUwsQ0FBVSxTQUFWLEtBQXdCLE1BQU0sSUFBaEQ7O0FBRUEsVUFBSSxTQUFKLEVBQWUsU0FBZjtBQUNBLFVBQUksS0FBSyxXQUFMLENBQUosRUFBdUI7QUFDckIsb0JBQVksVUFBVSxVQUFVLE1BQVYsR0FBbUIsQ0FBN0IsQ0FBWjtBQUNBLG9CQUFZLFdBQVo7QUFDRCxPQUhELE1BR087QUFDTCxvQkFBWSxXQUFaO0FBQ0Esb0JBQVksVUFBVSxVQUF0QjtBQUNEOztBQUVEO0FBQ0EsVUFBSSxRQUFRLGFBQWEsVUFBVSxTQUFWLEVBQXFCLEtBQXJCLEVBQTRCO0FBQ25ELGdDQUF3QixRQUQyQjtBQUVuRCw2QkFBcUI7QUFGOEIsT0FBNUIsQ0FBekI7O0FBS0E7QUFDQSxVQUFJLENBQUMsS0FBRCxJQUFVLGNBQWMsTUFBTSxJQUFsQyxFQUF3QztBQUN0QyxnQkFBUSxNQUFNLElBQU4sQ0FBVyxVQUFYLENBQXNCLE1BQU0sTUFBNUIsQ0FBUjtBQUNEOztBQUVELGFBQU87QUFDTCxtQkFBVyxLQUROO0FBRUwsbUJBQVc7QUFGTixPQUFQO0FBSUQsS0FoQ0Q7O0FBa0NBLFFBQUksU0FBUyxTQUFULE1BQVMsQ0FBVSxRQUFWLEVBQW9CO0FBQy9CLGFBQU8sU0FBUyxhQUFULENBQXVCLFFBQXZCLENBQVA7QUFDRCxLQUZEOztBQUlBLFFBQUksYUFBYSxTQUFiLFVBQWEsQ0FBVSxJQUFWLEVBQWdCO0FBQy9CLGFBQU8sU0FBUyxjQUFULENBQXdCLElBQXhCLENBQVA7QUFDRCxLQUZEOztBQUlBOzs7Ozs7OztBQVFBLFFBQUksU0FBUyxTQUFULE1BQVMsQ0FBVSxJQUFWLEVBQWdCLGFBQWhCLEVBQStCO0FBQzFDLFVBQUksQ0FBQyxJQUFELElBQVMsQ0FBQyxLQUFLLFVBQW5CLEVBQStCO0FBQUU7QUFBUztBQUMxQyxVQUFJLEtBQUssVUFBVCxFQUFxQjtBQUFFLGVBQU8sS0FBSyxVQUFMLENBQWdCLGFBQWhCLENBQVA7QUFBd0M7O0FBRS9ELFVBQUksU0FBUyxLQUFLLFVBQWxCO0FBQ0EsVUFBSSxDQUFDLGFBQUwsRUFBb0I7QUFDbEIsWUFBSSxRQUFRLEVBQVo7QUFDQSxZQUFJLENBQUosRUFBTyxHQUFQO0FBQ0EsYUFBSyxJQUFJLENBQUosRUFBTyxNQUFNLEtBQUssVUFBTCxDQUFnQixNQUFsQyxFQUEwQyxJQUFJLEdBQTlDLEVBQW1ELEdBQW5ELEVBQXdEO0FBQ3RELGdCQUFNLElBQU4sQ0FBVyxLQUFLLFVBQUwsQ0FBZ0IsQ0FBaEIsQ0FBWDtBQUNEOztBQUVELGFBQUssSUFBSSxDQUFKLEVBQU8sTUFBTSxNQUFNLE1BQXhCLEVBQWdDLElBQUksR0FBcEMsRUFBeUMsR0FBekMsRUFBOEM7QUFDNUMsaUJBQU8sWUFBUCxDQUFvQixNQUFNLENBQU4sQ0FBcEIsRUFBOEIsSUFBOUI7QUFDRDtBQUNGOztBQUVELGFBQU8sV0FBUCxDQUFtQixJQUFuQjtBQUNELEtBbEJEOztBQW9CQTs7Ozs7O0FBTUEsUUFBSSxjQUFjLFNBQWQsV0FBYyxDQUFVLElBQVYsRUFBZ0IsSUFBaEIsRUFBc0I7QUFDdEMsYUFBTyxJQUFQLEVBQWE7QUFDWCxZQUFJLFdBQVcsSUFBWCxLQUFvQixDQUFDLEtBQUssSUFBTCxDQUF6QixFQUFxQztBQUNuQztBQUNEOztBQUVELFlBQUksU0FBUyxLQUFLLFVBQWxCO0FBQ0EsZUFBTyxJQUFQO0FBQ0EsZUFBTyxNQUFQO0FBQ0Q7QUFDRixLQVZEOztBQVlBOzs7Ozs7Ozs7QUFTQSxRQUFJLFVBQVUsU0FBVixPQUFVLENBQVUsSUFBVixFQUFnQixRQUFoQixFQUEwQjtBQUN0QyxVQUFJLEtBQUssUUFBTCxDQUFjLFdBQWQsT0FBZ0MsU0FBUyxXQUFULEVBQXBDLEVBQTREO0FBQzFELGVBQU8sSUFBUDtBQUNEOztBQUVELFVBQUksVUFBVSxPQUFPLFFBQVAsQ0FBZDs7QUFFQSxVQUFJLEtBQUssS0FBTCxDQUFXLE9BQWYsRUFBd0I7QUFDdEIsZ0JBQVEsS0FBUixDQUFjLE9BQWQsR0FBd0IsS0FBSyxLQUFMLENBQVcsT0FBbkM7QUFDRDs7QUFFRCx1QkFBaUIsT0FBakIsRUFBMEIsS0FBSyxJQUFMLENBQVUsS0FBSyxVQUFmLENBQTFCO0FBQ0Esa0JBQVksT0FBWixFQUFxQixJQUFyQjtBQUNBLGFBQU8sSUFBUDs7QUFFQSxhQUFPLE9BQVA7QUFDRCxLQWhCRDs7QUFrQkEsUUFBSSxhQUFhLG1CQUFtQixVQUFuQixDQUFqQjs7QUFFQTs7OztBQUlBLFFBQUksUUFBUSxTQUFSLEtBQVEsQ0FBVSxLQUFWLEVBQWlCLGVBQWpCLEVBQWtDO0FBQzVDLFVBQUksTUFBTSxXQUFXLE1BQU0sQ0FBTixDQUFYLElBQXVCLE1BQU0sR0FBTixFQUF2QixHQUFxQyxNQUFNLElBQU4sRUFBL0M7QUFDQSxVQUFJLGVBQUosRUFBcUI7QUFDbkIsZUFBTyxJQUFJLE9BQUosQ0FBWSxTQUFaLEVBQXVCLEVBQXZCLENBQVA7QUFDRDtBQUNELGFBQU8sR0FBUDtBQUNELEtBTkQ7O0FBUUE7Ozs7Ozs7O0FBUUEsUUFBSSxPQUFPLFNBQVAsSUFBTyxDQUFVLEtBQVYsRUFBaUIsZ0JBQWpCLEVBQW1DO0FBQzVDLFVBQUksU0FBUyxNQUFNLEtBQU4sQ0FBYjs7QUFFQSxVQUFJLGdCQUFKLEVBQXNCO0FBQ3BCLFlBQUksV0FBVyx1Q0FBZjtBQUNBLGlCQUFTLE9BQU8sT0FBUCxDQUFlLFFBQWYsRUFBeUIsVUFBVSxLQUFWLEVBQWlCLFFBQWpCLEVBQTJCLElBQTNCLEVBQWlDO0FBQ2pFLGlCQUFPLEtBQUssV0FBTCxFQUFQO0FBQ0EsY0FBSSx5QkFBeUIsOEJBQThCLElBQTlCLENBQW1DLElBQW5DLEtBQ0EsQ0FBQyxDQUFDLFFBRC9CO0FBRUEsY0FBSSxjQUFjLDRDQUE0QyxJQUE1QyxDQUFpRCxJQUFqRCxDQUFsQjs7QUFFQSxpQkFBTyxTQUFVLDBCQUEwQixXQUEzQixHQUEwQyxJQUExQyxHQUFpRCxFQUExRCxDQUFQO0FBQ0QsU0FQUSxDQUFUO0FBUUEsaUJBQVMsRUFBRSxJQUFGLENBQU8sTUFBUCxDQUFUO0FBQ0Q7O0FBRUQsYUFBTyxNQUFQO0FBQ0QsS0FqQkQ7O0FBbUJBLFFBQUkscUJBQXFCLFNBQXJCLGtCQUFxQixDQUFVLFdBQVYsRUFBdUI7QUFDOUMsVUFBSSxlQUFlLEVBQUUsV0FBRixDQUFuQjtBQUNBLFVBQUksTUFBTSxhQUFhLE1BQWIsRUFBVjtBQUNBLFVBQUksU0FBUyxhQUFhLFdBQWIsQ0FBeUIsSUFBekIsQ0FBYixDQUg4QyxDQUdEOztBQUU3QyxhQUFPO0FBQ0wsY0FBTSxJQUFJLElBREw7QUFFTCxhQUFLLElBQUksR0FBSixHQUFVO0FBRlYsT0FBUDtBQUlELEtBVEQ7O0FBV0EsUUFBSSxlQUFlLFNBQWYsWUFBZSxDQUFVLEtBQVYsRUFBaUIsTUFBakIsRUFBeUI7QUFDMUMsYUFBTyxJQUFQLENBQVksTUFBWixFQUFvQixPQUFwQixDQUE0QixVQUFVLEdBQVYsRUFBZTtBQUN6QyxjQUFNLEVBQU4sQ0FBUyxHQUFULEVBQWMsT0FBTyxHQUFQLENBQWQ7QUFDRCxPQUZEO0FBR0QsS0FKRDs7QUFNQSxRQUFJLGVBQWUsU0FBZixZQUFlLENBQVUsS0FBVixFQUFpQixNQUFqQixFQUF5QjtBQUMxQyxhQUFPLElBQVAsQ0FBWSxNQUFaLEVBQW9CLE9BQXBCLENBQTRCLFVBQVUsR0FBVixFQUFlO0FBQ3pDLGNBQU0sR0FBTixDQUFVLEdBQVYsRUFBZSxPQUFPLEdBQVAsQ0FBZjtBQUNELE9BRkQ7QUFHRCxLQUpEOztBQU1BLFdBQU87QUFDTDtBQUNBLGlCQUFXLFNBRk47QUFHTDtBQUNBLDRCQUFzQixvQkFKakI7QUFLTDtBQUNBLGFBQU8sU0FORjtBQU9MO0FBQ0EsaUJBQVcsUUFBUSxTQUFSLEdBQW9CLE1BUjFCO0FBU0wsMEJBQW9CLGtCQVRmO0FBVUwsa0JBQVksVUFWUDtBQVdMLHVCQUFpQixlQVhaO0FBWUwsY0FBUSxNQVpIO0FBYUwsaUJBQVcsU0FiTjtBQWNMLGNBQVEsTUFkSDtBQWVMLGNBQVEsTUFmSDtBQWdCTCxrQkFBWSxVQWhCUDtBQWlCTCxpQkFBVyxTQWpCTjtBQWtCTCxnQkFBVSxRQWxCTDtBQW1CTCxlQUFTLEtBQUssR0FBTCxDQUFTLFFBQVQsQ0FuQko7QUFvQkwsb0JBQWMsWUFwQlQ7QUFxQkwsY0FBUSxNQXJCSDtBQXNCTCxvQkFBYyxZQXRCVDtBQXVCTCxhQUFPLEtBdkJGO0FBd0JMLGNBQVEsTUF4Qkg7QUF5QkwsZUFBUyxPQXpCSjtBQTBCTCxjQUFRLE1BMUJIO0FBMkJMLGNBQVEsTUEzQkg7QUE0Qkwsb0JBQWMsWUE1QlQ7QUE2QkwsdUJBQWlCLGVBN0JaO0FBOEJMLGdCQUFVLFFBOUJMO0FBK0JMLGFBQU8sbUJBQW1CLEtBQW5CLENBL0JGO0FBZ0NMLFlBQU0sSUFoQ0Q7QUFpQ0wsWUFBTSxtQkFBbUIsSUFBbkIsQ0FqQ0Q7QUFrQ0wsY0FBUSxtQkFBbUIsTUFBbkIsQ0FsQ0g7QUFtQ0wsV0FBSyxtQkFBbUIsR0FBbkIsQ0FuQ0E7QUFvQ0wsV0FBSyxtQkFBbUIsR0FBbkIsQ0FwQ0E7QUFxQ0wsV0FBSyxtQkFBbUIsR0FBbkIsQ0FyQ0E7QUFzQ0wsV0FBSyxtQkFBbUIsR0FBbkIsQ0F0Q0E7QUF1Q0wsYUFBTyxtQkFBbUIsS0FBbkIsQ0F2Q0Y7QUF3Q0wsa0JBQVksVUF4Q1A7QUF5Q0wsZUFBUyxPQXpDSjtBQTBDTCxxQkFBZSxLQUFLLEdBQUwsQ0FBUyxRQUFULEVBQW1CLE9BQW5CLENBMUNWO0FBMkNMLHdCQUFrQixnQkEzQ2I7QUE0Q0wsMkJBQXFCLG1CQTVDaEI7QUE2Q0wsa0JBQVksVUE3Q1A7QUE4Q0wsdUJBQWlCLGVBOUNaO0FBK0NMLHdCQUFrQixnQkEvQ2I7QUFnREwsbUJBQWEsV0FoRFI7QUFpREwsb0JBQWMsWUFqRFQ7QUFrREwscUJBQWUsYUFsRFY7QUFtREwseUJBQW1CLGlCQW5EZDtBQW9ETCwwQkFBb0Isa0JBcERmO0FBcURMLGlCQUFXLFNBckROO0FBc0RMLGlCQUFXLFNBdEROO0FBdURMLG1CQUFhLFdBdkRSO0FBd0RMLHNCQUFnQixjQXhEWDtBQXlETCxzQkFBZ0IsY0F6RFg7QUEwREwsc0JBQWdCLGNBMURYO0FBMkRMLG1CQUFhLFdBM0RSO0FBNERMLGlCQUFXLFNBNUROO0FBNkRMLGdCQUFVLFFBN0RMO0FBOERMLDJCQUFxQixtQkE5RGhCO0FBK0RMLG9CQUFjLFlBL0RUO0FBZ0VMLG9CQUFjLFlBaEVUO0FBaUVMLGdCQUFVLFFBakVMO0FBa0VMLGdCQUFVLFFBbEVMO0FBbUVMLHNCQUFnQixjQW5FWDtBQW9FTCxzQkFBZ0IsY0FwRVg7QUFxRUwsWUFBTSxJQXJFRDtBQXNFTCxtQkFBYSxXQXRFUjtBQXVFTCx3QkFBa0IsZ0JBdkViO0FBd0VMLGdCQUFVLFFBeEVMO0FBeUVMLG1CQUFhLFdBekVSO0FBMEVMLHNCQUFnQixjQTFFWDtBQTJFTCxzQkFBZ0IsY0EzRVg7QUE0RUwsaUJBQVcsU0E1RU47QUE2RUwsa0JBQVksVUE3RVA7QUE4RUwsY0FBUSxNQTlFSDtBQStFTCxrQkFBWSxVQS9FUDtBQWdGTCxjQUFRLE1BaEZIO0FBaUZMLG1CQUFhLFdBakZSO0FBa0ZMLGVBQVMsT0FsRko7QUFtRkwsWUFBTSxJQW5GRDtBQW9GTCxhQUFPLEtBcEZGO0FBcUZMLDBCQUFvQixrQkFyRmY7QUFzRkwsb0JBQWMsWUF0RlQ7QUF1Rkwsb0JBQWM7QUF2RlQsS0FBUDtBQXlGRCxHQTVpQ1MsRUFBVjs7QUE4aUNBOzs7OztBQUtBLE1BQUksVUFBVSxTQUFWLE9BQVUsQ0FBVSxLQUFWLEVBQWlCLE9BQWpCLEVBQTBCO0FBQ3RDLFFBQUksT0FBTyxJQUFYOztBQUVBLFFBQUksS0FBSyxFQUFFLFVBQUYsQ0FBYSxFQUF0QjtBQUNBLFNBQUssS0FBTCxHQUFhLEVBQWI7QUFDQSxTQUFLLE9BQUwsR0FBZSxFQUFmO0FBQ0EsU0FBSyxVQUFMLEdBQWtCLEVBQWxCO0FBQ0EsU0FBSyxPQUFMLEdBQWUsT0FBZjs7QUFFQTs7O0FBR0EsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsV0FBSyxVQUFMLEdBQWtCLEdBQUcsWUFBSCxDQUFnQixLQUFoQixFQUF1QixPQUF2QixDQUFsQjtBQUNBLFdBQUssV0FBTDtBQUNBLFlBQU0sSUFBTjtBQUNBLGFBQU8sSUFBUDtBQUNELEtBTEQ7O0FBT0E7OztBQUdBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsV0FBSyxRQUFMO0FBQ0EsWUFBTSxVQUFOLENBQWlCLFlBQWpCO0FBQ0EsU0FBRyxZQUFILENBQWdCLEtBQWhCLEVBQXVCLEtBQUssVUFBNUI7QUFDRCxLQUpEOztBQU1BOzs7QUFHQSxTQUFLLEtBQUwsR0FBYSxZQUFZO0FBQ3ZCLFVBQUksV0FBVyxLQUFLLFVBQUwsRUFBZjtBQUNBLFdBQUssSUFBTCxDQUFVLElBQUksU0FBZDtBQUNBLFdBQUssUUFBTDtBQUNBLFdBQUssV0FBTDs7QUFFQSxVQUFJLFFBQUosRUFBYztBQUNaLGFBQUssT0FBTDtBQUNEO0FBQ0YsS0FURDs7QUFXQSxTQUFLLFdBQUwsR0FBbUIsWUFBWTtBQUM3QjtBQUNBLFVBQUksVUFBVSxFQUFFLE1BQUYsQ0FBUyxFQUFULEVBQWEsS0FBSyxPQUFMLENBQWEsT0FBMUIsQ0FBZDtBQUNBLGFBQU8sSUFBUCxDQUFZLE9BQVosRUFBcUIsT0FBckIsQ0FBNkIsVUFBVSxHQUFWLEVBQWU7QUFDMUMsYUFBSyxJQUFMLENBQVUsWUFBWSxHQUF0QixFQUEyQixRQUFRLEdBQVIsQ0FBM0I7QUFDRCxPQUZEOztBQUlBLFVBQUksVUFBVSxFQUFFLE1BQUYsQ0FBUyxFQUFULEVBQWEsS0FBSyxPQUFMLENBQWEsT0FBMUIsRUFBbUMsRUFBRSxVQUFGLENBQWEsT0FBYixJQUF3QixFQUEzRCxDQUFkOztBQUVBO0FBQ0EsYUFBTyxJQUFQLENBQVksT0FBWixFQUFxQixPQUFyQixDQUE2QixVQUFVLEdBQVYsRUFBZTtBQUMxQyxhQUFLLE1BQUwsQ0FBWSxHQUFaLEVBQWlCLFFBQVEsR0FBUixDQUFqQixFQUErQixJQUEvQjtBQUNELE9BRkQ7O0FBSUEsYUFBTyxJQUFQLENBQVksS0FBSyxPQUFqQixFQUEwQixPQUExQixDQUFrQyxVQUFVLEdBQVYsRUFBZTtBQUMvQyxhQUFLLGdCQUFMLENBQXNCLEdBQXRCO0FBQ0QsT0FGRDtBQUdELEtBakJEOztBQW1CQSxTQUFLLFFBQUwsR0FBZ0IsWUFBWTtBQUMxQjtBQUNBLGFBQU8sSUFBUCxDQUFZLEtBQUssT0FBakIsRUFBMEIsT0FBMUIsR0FBb0MsT0FBcEMsQ0FBNEMsVUFBVSxHQUFWLEVBQWU7QUFDekQsYUFBSyxZQUFMLENBQWtCLEdBQWxCO0FBQ0QsT0FGRDs7QUFJQSxhQUFPLElBQVAsQ0FBWSxLQUFLLEtBQWpCLEVBQXdCLE9BQXhCLENBQWdDLFVBQVUsR0FBVixFQUFlO0FBQzdDLGFBQUssVUFBTCxDQUFnQixHQUFoQjtBQUNELE9BRkQ7QUFHRCxLQVREOztBQVdBLFNBQUssSUFBTCxHQUFZLFVBQVUsSUFBVixFQUFnQjtBQUMxQixVQUFJLGNBQWMsS0FBSyxNQUFMLENBQVksc0JBQVosQ0FBbEI7O0FBRUEsVUFBSSxTQUFTLFNBQWIsRUFBd0I7QUFDdEIsYUFBSyxNQUFMLENBQVksZUFBWjtBQUNBLGVBQU8sY0FBYyxLQUFLLFVBQUwsQ0FBZ0IsT0FBaEIsQ0FBd0IsR0FBeEIsRUFBZCxHQUE4QyxLQUFLLFVBQUwsQ0FBZ0IsUUFBaEIsQ0FBeUIsSUFBekIsRUFBckQ7QUFDRCxPQUhELE1BR087QUFDTCxZQUFJLFdBQUosRUFBaUI7QUFDZixlQUFLLFVBQUwsQ0FBZ0IsT0FBaEIsQ0FBd0IsR0FBeEIsQ0FBNEIsSUFBNUI7QUFDRCxTQUZELE1BRU87QUFDTCxlQUFLLFVBQUwsQ0FBZ0IsUUFBaEIsQ0FBeUIsSUFBekIsQ0FBOEIsSUFBOUI7QUFDRDtBQUNELGNBQU0sR0FBTixDQUFVLElBQVY7QUFDQSxhQUFLLFlBQUwsQ0FBa0IsUUFBbEIsRUFBNEIsSUFBNUI7QUFDRDtBQUNGLEtBZkQ7O0FBaUJBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCLGFBQU8sS0FBSyxVQUFMLENBQWdCLFFBQWhCLENBQXlCLElBQXpCLENBQThCLGlCQUE5QixNQUFxRCxPQUE1RDtBQUNELEtBRkQ7O0FBSUEsU0FBSyxNQUFMLEdBQWMsWUFBWTtBQUN4QixXQUFLLFVBQUwsQ0FBZ0IsUUFBaEIsQ0FBeUIsSUFBekIsQ0FBOEIsaUJBQTlCLEVBQWlELElBQWpEO0FBQ0EsV0FBSyxNQUFMLENBQVksa0JBQVosRUFBZ0MsSUFBaEM7QUFDRCxLQUhEOztBQUtBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekI7QUFDQSxVQUFJLEtBQUssTUFBTCxDQUFZLHNCQUFaLENBQUosRUFBeUM7QUFDdkMsYUFBSyxNQUFMLENBQVkscUJBQVo7QUFDRDtBQUNELFdBQUssVUFBTCxDQUFnQixRQUFoQixDQUF5QixJQUF6QixDQUE4QixpQkFBOUIsRUFBaUQsS0FBakQ7QUFDQSxXQUFLLE1BQUwsQ0FBWSxvQkFBWixFQUFrQyxJQUFsQztBQUNELEtBUEQ7O0FBU0EsU0FBSyxZQUFMLEdBQW9CLFlBQVk7QUFDOUIsVUFBSSxZQUFZLEtBQUssSUFBTCxDQUFVLFNBQVYsQ0FBaEI7QUFDQSxVQUFJLE9BQU8sS0FBSyxJQUFMLENBQVUsS0FBSyxJQUFMLENBQVUsU0FBVixDQUFWLENBQVg7O0FBRUEsVUFBSSxXQUFXLEtBQUssT0FBTCxDQUFhLFNBQWIsQ0FBdUIsS0FBSyxnQkFBTCxDQUFzQixTQUF0QixFQUFpQyxJQUFqQyxDQUF2QixDQUFmO0FBQ0EsVUFBSSxRQUFKLEVBQWM7QUFDWixpQkFBUyxLQUFULENBQWUsTUFBTSxDQUFOLENBQWYsRUFBeUIsSUFBekI7QUFDRDtBQUNELFlBQU0sT0FBTixDQUFjLGdCQUFnQixTQUE5QixFQUF5QyxJQUF6QztBQUNELEtBVEQ7O0FBV0EsU0FBSyxnQkFBTCxHQUF3QixVQUFVLEdBQVYsRUFBZTtBQUNyQyxVQUFJLFNBQVMsS0FBSyxPQUFMLENBQWEsR0FBYixDQUFiO0FBQ0EsYUFBTyxnQkFBUCxHQUEwQixPQUFPLGdCQUFQLElBQTJCLEtBQUssRUFBMUQ7QUFDQSxVQUFJLENBQUMsT0FBTyxnQkFBUCxFQUFMLEVBQWdDO0FBQzlCO0FBQ0Q7O0FBRUQ7QUFDQSxVQUFJLE9BQU8sVUFBWCxFQUF1QjtBQUNyQixlQUFPLFVBQVA7QUFDRDs7QUFFRDtBQUNBLFVBQUksT0FBTyxNQUFYLEVBQW1CO0FBQ2pCLFlBQUksWUFBSixDQUFpQixLQUFqQixFQUF3QixPQUFPLE1BQS9CO0FBQ0Q7QUFDRixLQWhCRDs7QUFrQkEsU0FBSyxNQUFMLEdBQWMsVUFBVSxHQUFWLEVBQWUsV0FBZixFQUE0QixnQkFBNUIsRUFBOEM7QUFDMUQsVUFBSSxVQUFVLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFDMUIsZUFBTyxLQUFLLE9BQUwsQ0FBYSxHQUFiLENBQVA7QUFDRDs7QUFFRCxXQUFLLE9BQUwsQ0FBYSxHQUFiLElBQW9CLElBQUksV0FBSixDQUFnQixJQUFoQixDQUFwQjs7QUFFQSxVQUFJLENBQUMsZ0JBQUwsRUFBdUI7QUFDckIsYUFBSyxnQkFBTCxDQUFzQixHQUF0QjtBQUNEO0FBQ0YsS0FWRDs7QUFZQSxTQUFLLFlBQUwsR0FBb0IsVUFBVSxHQUFWLEVBQWU7QUFDakMsVUFBSSxTQUFTLEtBQUssT0FBTCxDQUFhLEdBQWIsQ0FBYjtBQUNBLFVBQUksT0FBTyxnQkFBUCxFQUFKLEVBQStCO0FBQzdCLFlBQUksT0FBTyxNQUFYLEVBQW1CO0FBQ2pCLGNBQUksWUFBSixDQUFpQixLQUFqQixFQUF3QixPQUFPLE1BQS9CO0FBQ0Q7O0FBRUQsWUFBSSxPQUFPLE9BQVgsRUFBb0I7QUFDbEIsaUJBQU8sT0FBUDtBQUNEO0FBQ0Y7O0FBRUQsYUFBTyxLQUFLLE9BQUwsQ0FBYSxHQUFiLENBQVA7QUFDRCxLQWJEOztBQWVBLFNBQUssSUFBTCxHQUFZLFVBQVUsR0FBVixFQUFlLEdBQWYsRUFBb0I7QUFDOUIsVUFBSSxVQUFVLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFDMUIsZUFBTyxLQUFLLEtBQUwsQ0FBVyxHQUFYLENBQVA7QUFDRDtBQUNELFdBQUssS0FBTCxDQUFXLEdBQVgsSUFBa0IsR0FBbEI7QUFDRCxLQUxEOztBQU9BLFNBQUssVUFBTCxHQUFrQixVQUFVLEdBQVYsRUFBZTtBQUMvQixVQUFJLEtBQUssS0FBTCxDQUFXLEdBQVgsS0FBbUIsS0FBSyxLQUFMLENBQVcsR0FBWCxFQUFnQixPQUF2QyxFQUFnRDtBQUM5QyxhQUFLLEtBQUwsQ0FBVyxHQUFYLEVBQWdCLE9BQWhCO0FBQ0Q7O0FBRUQsYUFBTyxLQUFLLEtBQUwsQ0FBVyxHQUFYLENBQVA7QUFDRCxLQU5EOztBQVFBLFNBQUssbUJBQUwsR0FBMkIsVUFBVSxTQUFWLEVBQXFCLEtBQXJCLEVBQTRCO0FBQ3JELGFBQU8sVUFBVSxLQUFWLEVBQWlCO0FBQ3RCLGNBQU0sY0FBTjtBQUNBLGFBQUssTUFBTCxDQUFZLFNBQVosRUFBdUIsU0FBUyxFQUFFLE1BQU0sTUFBUixFQUFnQixPQUFoQixDQUF3QixjQUF4QixFQUF3QyxJQUF4QyxDQUE2QyxPQUE3QyxDQUFoQztBQUNELE9BSEQ7QUFJRCxLQUxEOztBQU9BLFNBQUssTUFBTCxHQUFjLFlBQVk7QUFDeEIsVUFBSSxZQUFZLEtBQUssSUFBTCxDQUFVLFNBQVYsQ0FBaEI7QUFDQSxVQUFJLE9BQU8sS0FBSyxJQUFMLENBQVUsS0FBSyxJQUFMLENBQVUsU0FBVixDQUFWLENBQVg7O0FBRUEsVUFBSSxTQUFTLFVBQVUsS0FBVixDQUFnQixHQUFoQixDQUFiO0FBQ0EsVUFBSSxlQUFlLE9BQU8sTUFBUCxHQUFnQixDQUFuQztBQUNBLFVBQUksYUFBYSxnQkFBZ0IsS0FBSyxJQUFMLENBQVUsTUFBVixDQUFqQztBQUNBLFVBQUksYUFBYSxlQUFlLEtBQUssSUFBTCxDQUFVLE1BQVYsQ0FBZixHQUFtQyxLQUFLLElBQUwsQ0FBVSxNQUFWLENBQXBEOztBQUVBLFVBQUksU0FBUyxLQUFLLE9BQUwsQ0FBYSxjQUFjLFFBQTNCLENBQWI7QUFDQSxVQUFJLENBQUMsVUFBRCxJQUFlLEtBQUssVUFBTCxDQUFuQixFQUFxQztBQUNuQyxlQUFPLEtBQUssVUFBTCxFQUFpQixLQUFqQixDQUF1QixJQUF2QixFQUE2QixJQUE3QixDQUFQO0FBQ0QsT0FGRCxNQUVPLElBQUksVUFBVSxPQUFPLFVBQVAsQ0FBVixJQUFnQyxPQUFPLGdCQUFQLEVBQXBDLEVBQStEO0FBQ3BFLGVBQU8sT0FBTyxVQUFQLEVBQW1CLEtBQW5CLENBQXlCLE1BQXpCLEVBQWlDLElBQWpDLENBQVA7QUFDRDtBQUNGLEtBZkQ7O0FBaUJBLFdBQU8sS0FBSyxVQUFMLEVBQVA7QUFDRCxHQTNNRDs7QUE2TUEsSUFBRSxFQUFGLENBQUssTUFBTCxDQUFZO0FBQ1Y7Ozs7OztBQU1BLGdCQUFZLHNCQUFZO0FBQ3RCLFVBQUksT0FBTyxFQUFFLElBQUYsQ0FBTyxLQUFLLElBQUwsQ0FBVSxTQUFWLENBQVAsQ0FBWDtBQUNBLFVBQUksc0JBQXNCLFNBQVMsUUFBbkM7QUFDQSxVQUFJLGlCQUFpQixTQUFTLFFBQTlCOztBQUVBLFVBQUksVUFBVSxpQkFBaUIsS0FBSyxJQUFMLENBQVUsU0FBVixDQUFqQixHQUF3QyxFQUF0RDs7QUFFQSxnQkFBVSxFQUFFLE1BQUYsQ0FBUyxFQUFULEVBQWEsRUFBRSxVQUFGLENBQWEsT0FBMUIsRUFBbUMsT0FBbkMsQ0FBVjtBQUNBLGNBQVEsUUFBUixHQUFtQixFQUFFLE1BQUYsQ0FBUyxJQUFULEVBQWUsRUFBZixFQUFtQixFQUFFLFVBQUYsQ0FBYSxJQUFiLENBQWtCLE9BQWxCLENBQW5CLEVBQStDLEVBQUUsVUFBRixDQUFhLElBQWIsQ0FBa0IsUUFBUSxJQUExQixDQUEvQyxDQUFuQjtBQUNBLGNBQVEsS0FBUixHQUFnQixFQUFFLE1BQUYsQ0FBUyxJQUFULEVBQWUsRUFBZixFQUFtQixFQUFFLFVBQUYsQ0FBYSxPQUFiLENBQXFCLEtBQXhDLEVBQStDLFFBQVEsS0FBdkQsQ0FBaEI7O0FBRUEsV0FBSyxJQUFMLENBQVUsVUFBVSxHQUFWLEVBQWUsSUFBZixFQUFxQjtBQUM3QixZQUFJLFFBQVEsRUFBRSxJQUFGLENBQVo7QUFDQSxZQUFJLENBQUMsTUFBTSxJQUFOLENBQVcsWUFBWCxDQUFMLEVBQStCO0FBQzdCLGNBQUksVUFBVSxJQUFJLE9BQUosQ0FBWSxLQUFaLEVBQW1CLE9BQW5CLENBQWQ7QUFDQSxnQkFBTSxJQUFOLENBQVcsWUFBWCxFQUF5QixPQUF6QjtBQUNBLGdCQUFNLElBQU4sQ0FBVyxZQUFYLEVBQXlCLFlBQXpCLENBQXNDLE1BQXRDLEVBQThDLFFBQVEsVUFBdEQ7QUFDRDtBQUNGLE9BUEQ7O0FBU0EsVUFBSSxRQUFRLEtBQUssS0FBTCxFQUFaO0FBQ0EsVUFBSSxNQUFNLE1BQVYsRUFBa0I7QUFDaEIsWUFBSSxVQUFVLE1BQU0sSUFBTixDQUFXLFlBQVgsQ0FBZDtBQUNBLFlBQUksbUJBQUosRUFBeUI7QUFDdkIsaUJBQU8sUUFBUSxNQUFSLENBQWUsS0FBZixDQUFxQixPQUFyQixFQUE4QixLQUFLLElBQUwsQ0FBVSxTQUFWLENBQTlCLENBQVA7QUFDRCxTQUZELE1BRU8sSUFBSSxRQUFRLEtBQVosRUFBbUI7QUFDeEIsa0JBQVEsTUFBUixDQUFlLGNBQWY7QUFDRDtBQUNGOztBQUVELGFBQU8sSUFBUDtBQUNEO0FBdENTLEdBQVo7O0FBMENBLE1BQUksV0FBVyxTQUFYLFFBQVcsQ0FBVSxNQUFWLEVBQWtCLFFBQWxCLEVBQTRCLE9BQTVCLEVBQXFDLFFBQXJDLEVBQStDO0FBQzVELFNBQUssTUFBTCxHQUFjLFVBQVUsT0FBVixFQUFtQjtBQUMvQixVQUFJLFFBQVEsRUFBRSxNQUFGLENBQVo7O0FBRUEsVUFBSSxXQUFXLFFBQVEsUUFBdkIsRUFBaUM7QUFDL0IsY0FBTSxJQUFOLENBQVcsUUFBUSxRQUFuQjtBQUNEOztBQUVELFVBQUksV0FBVyxRQUFRLFNBQXZCLEVBQWtDO0FBQ2hDLGNBQU0sUUFBTixDQUFlLFFBQVEsU0FBdkI7QUFDRDs7QUFFRCxVQUFJLFdBQVcsUUFBUSxJQUF2QixFQUE2QjtBQUMzQixVQUFFLElBQUYsQ0FBTyxRQUFRLElBQWYsRUFBcUIsVUFBVSxDQUFWLEVBQWEsQ0FBYixFQUFnQjtBQUNuQyxnQkFBTSxJQUFOLENBQVcsVUFBVSxDQUFyQixFQUF3QixDQUF4QjtBQUNELFNBRkQ7QUFHRDs7QUFFRCxVQUFJLFdBQVcsUUFBUSxLQUF2QixFQUE4QjtBQUM1QixjQUFNLEVBQU4sQ0FBUyxPQUFULEVBQWtCLFFBQVEsS0FBMUI7QUFDRDs7QUFFRCxVQUFJLFFBQUosRUFBYztBQUNaLFlBQUksYUFBYSxNQUFNLElBQU4sQ0FBVywwQkFBWCxDQUFqQjtBQUNBLGlCQUFTLE9BQVQsQ0FBaUIsVUFBVSxLQUFWLEVBQWlCO0FBQ2hDLGdCQUFNLE1BQU4sQ0FBYSxXQUFXLE1BQVgsR0FBb0IsVUFBcEIsR0FBaUMsS0FBOUM7QUFDRCxTQUZEO0FBR0Q7O0FBRUQsVUFBSSxRQUFKLEVBQWM7QUFDWixpQkFBUyxLQUFULEVBQWdCLE9BQWhCO0FBQ0Q7O0FBRUQsVUFBSSxXQUFXLFFBQVEsUUFBdkIsRUFBaUM7QUFDL0IsZ0JBQVEsUUFBUixDQUFpQixLQUFqQjtBQUNEOztBQUVELFVBQUksT0FBSixFQUFhO0FBQ1gsZ0JBQVEsTUFBUixDQUFlLEtBQWY7QUFDRDs7QUFFRCxhQUFPLEtBQVA7QUFDRCxLQXpDRDtBQTBDRCxHQTNDRDs7QUE2Q0EsTUFBSSxXQUFXO0FBQ2IsWUFBUSxnQkFBVSxNQUFWLEVBQWtCLFFBQWxCLEVBQTRCO0FBQ2xDLGFBQU8sWUFBWTtBQUNqQixZQUFJLFdBQVcsRUFBRSxPQUFGLENBQVUsVUFBVSxDQUFWLENBQVYsSUFBMEIsVUFBVSxDQUFWLENBQTFCLEdBQXlDLEVBQXhEO0FBQ0EsWUFBSSxVQUFVLFFBQU8sVUFBVSxDQUFWLENBQVAsTUFBd0IsUUFBeEIsR0FBbUMsVUFBVSxDQUFWLENBQW5DLEdBQWtELFVBQVUsQ0FBVixDQUFoRTtBQUNBLFlBQUksV0FBVyxRQUFRLFFBQXZCLEVBQWlDO0FBQy9CLHFCQUFXLFFBQVEsUUFBbkI7QUFDRDtBQUNELGVBQU8sSUFBSSxRQUFKLENBQWEsTUFBYixFQUFxQixRQUFyQixFQUErQixPQUEvQixFQUF3QyxRQUF4QyxDQUFQO0FBQ0QsT0FQRDtBQVFEO0FBVlksR0FBZjs7QUFhQSxNQUFJLFNBQVMsU0FBUyxNQUFULENBQWdCLHVDQUFoQixDQUFiO0FBQ0EsTUFBSSxVQUFVLFNBQVMsTUFBVCxDQUFnQiw2QkFBaEIsQ0FBZDtBQUNBLE1BQUksY0FBYyxTQUFTLE1BQVQsQ0FBZ0Isa0NBQWhCLENBQWxCO0FBQ0EsTUFBSSxVQUFVLFNBQVMsTUFBVCxDQUFnQixrQ0FBaEIsQ0FBZDtBQUNBLE1BQUksV0FBVyxTQUFTLE1BQVQsQ0FBZ0IscURBQWhCLENBQWY7QUFDQSxNQUFJLFlBQVksU0FBUyxNQUFULENBQWdCLENBQzlCLDhCQUQ4QixFQUU5QixnQ0FGOEIsRUFHOUIsa0NBSDhCLEVBSTlCLGtDQUo4QixFQUs5QixrQ0FMOEIsRUFNOUIsVUFOOEIsRUFPOUIsUUFQOEIsRUFROUIsSUFSOEIsQ0FRekIsRUFSeUIsQ0FBaEIsQ0FBaEI7O0FBVUEsTUFBSSxZQUFZLFNBQVMsTUFBVCxDQUFnQiw0QkFBaEIsQ0FBaEI7QUFDQSxNQUFJLGNBQWMsU0FBUyxNQUFULENBQWdCLHFEQUFoQixDQUFsQjs7QUFFQSxNQUFJLGNBQWMsU0FBUyxNQUFULENBQWdCLHdDQUFoQixDQUFsQjtBQUNBLE1BQUksU0FBUyxTQUFTLE1BQVQsQ0FBZ0Isd0VBQWhCLEVBQTBGLFVBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQjtBQUMvSCxRQUFJLFdBQVcsUUFBUSxPQUF2QixFQUFnQztBQUM5QixZQUFNLElBQU4sQ0FBVztBQUNULGVBQU8sUUFBUTtBQUROLE9BQVgsRUFFRyxPQUZILENBRVc7QUFDVCxtQkFBVyxNQURGO0FBRVQsaUJBQVMsT0FGQTtBQUdULG1CQUFXO0FBSEYsT0FGWDtBQU9EO0FBQ0YsR0FWWSxDQUFiOztBQVlBLE1BQUksV0FBVyxTQUFTLE1BQVQsQ0FBZ0IsbUNBQWhCLEVBQXFELFVBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQjtBQUM1RixRQUFJLFNBQVMsRUFBRSxPQUFGLENBQVUsUUFBUSxLQUFsQixJQUEyQixRQUFRLEtBQVIsQ0FBYyxHQUFkLENBQWtCLFVBQVUsSUFBVixFQUFnQjtBQUN4RSxVQUFJLFFBQVMsT0FBTyxJQUFQLEtBQWdCLFFBQWpCLEdBQTZCLElBQTdCLEdBQXFDLEtBQUssS0FBTCxJQUFjLEVBQS9EO0FBQ0EsVUFBSSxVQUFVLFFBQVEsUUFBUixHQUFtQixRQUFRLFFBQVIsQ0FBaUIsSUFBakIsQ0FBbkIsR0FBNEMsSUFBMUQ7QUFDQSxhQUFPLGlDQUFpQyxLQUFqQyxHQUF5QyxJQUF6QyxHQUFnRCxPQUFoRCxHQUEwRCxXQUFqRTtBQUNELEtBSnVDLEVBSXJDLElBSnFDLENBSWhDLEVBSmdDLENBQTNCLEdBSUMsUUFBUSxLQUp0Qjs7QUFNQSxVQUFNLElBQU4sQ0FBVyxNQUFYO0FBQ0QsR0FSYyxDQUFmOztBQVVBLE1BQUksZ0JBQWdCLFNBQVMsTUFBVCxDQUFnQiw4Q0FBaEIsRUFBZ0UsVUFBVSxLQUFWLEVBQWlCLE9BQWpCLEVBQTBCO0FBQzVHLFFBQUksU0FBUyxFQUFFLE9BQUYsQ0FBVSxRQUFRLEtBQWxCLElBQTJCLFFBQVEsS0FBUixDQUFjLEdBQWQsQ0FBa0IsVUFBVSxJQUFWLEVBQWdCO0FBQ3hFLFVBQUksUUFBUyxPQUFPLElBQVAsS0FBZ0IsUUFBakIsR0FBNkIsSUFBN0IsR0FBcUMsS0FBSyxLQUFMLElBQWMsRUFBL0Q7QUFDQSxVQUFJLFVBQVUsUUFBUSxRQUFSLEdBQW1CLFFBQVEsUUFBUixDQUFpQixJQUFqQixDQUFuQixHQUE0QyxJQUExRDtBQUNBLGFBQU8saUNBQWlDLEtBQWpDLEdBQXlDLElBQXpDLEdBQWdELEtBQUssUUFBUSxjQUFiLENBQWhELEdBQStFLEdBQS9FLEdBQXFGLE9BQXJGLEdBQStGLFdBQXRHO0FBQ0QsS0FKdUMsRUFJckMsSUFKcUMsQ0FJaEMsRUFKZ0MsQ0FBM0IsR0FJQyxRQUFRLEtBSnRCO0FBS0EsVUFBTSxJQUFOLENBQVcsTUFBWDtBQUNELEdBUG1CLENBQXBCOztBQVNBLE1BQUksVUFBVSxTQUFTLE1BQVQsQ0FBZ0IsbUNBQWhCLEVBQXFELFVBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQjtBQUMzRixRQUFJLFdBQVcsRUFBZjtBQUNBLFNBQUssSUFBSSxNQUFNLENBQVYsRUFBYSxVQUFVLFFBQVEsTUFBUixDQUFlLE1BQTNDLEVBQW1ELE1BQU0sT0FBekQsRUFBa0UsS0FBbEUsRUFBeUU7QUFDdkUsVUFBSSxZQUFZLFFBQVEsU0FBeEI7QUFDQSxVQUFJLFNBQVMsUUFBUSxNQUFSLENBQWUsR0FBZixDQUFiO0FBQ0EsVUFBSSxVQUFVLEVBQWQ7QUFDQSxXQUFLLElBQUksTUFBTSxDQUFWLEVBQWEsVUFBVSxPQUFPLE1BQW5DLEVBQTJDLE1BQU0sT0FBakQsRUFBMEQsS0FBMUQsRUFBaUU7QUFDL0QsWUFBSSxRQUFRLE9BQU8sR0FBUCxDQUFaO0FBQ0EsZ0JBQVEsSUFBUixDQUFhLENBQ1gsOENBRFcsRUFFWCwwQkFGVyxFQUVpQixLQUZqQixFQUV3QixJQUZ4QixFQUdYLGNBSFcsRUFHSyxTQUhMLEVBR2dCLElBSGhCLEVBSVgsY0FKVyxFQUlLLEtBSkwsRUFJWSxJQUpaLEVBS1gsU0FMVyxFQUtBLEtBTEEsRUFLTyxJQUxQLEVBTVgsOENBTlcsRUFPWCxJQVBXLENBT04sRUFQTSxDQUFiO0FBUUQ7QUFDRCxlQUFTLElBQVQsQ0FBYyxpQ0FBaUMsUUFBUSxJQUFSLENBQWEsRUFBYixDQUFqQyxHQUFvRCxRQUFsRTtBQUNEO0FBQ0QsVUFBTSxJQUFOLENBQVcsU0FBUyxJQUFULENBQWMsRUFBZCxDQUFYOztBQUVBLFVBQU0sSUFBTixDQUFXLGlCQUFYLEVBQThCLE9BQTlCLENBQXNDO0FBQ3BDLGlCQUFXLE1BRHlCO0FBRXBDLGVBQVMsT0FGMkI7QUFHcEMsaUJBQVc7QUFIeUIsS0FBdEM7QUFLRCxHQTFCYSxDQUFkOztBQTRCQSxNQUFJLFNBQVMsU0FBUyxNQUFULENBQWdCLGlFQUFoQixFQUFtRixVQUFVLEtBQVYsRUFBaUIsT0FBakIsRUFBMEI7QUFDeEgsUUFBSSxRQUFRLElBQVosRUFBa0I7QUFDaEIsWUFBTSxRQUFOLENBQWUsTUFBZjtBQUNEO0FBQ0QsVUFBTSxJQUFOLENBQVcsQ0FDVCw0QkFEUyxFQUVULCtCQUZTLEVBR1IsUUFBUSxLQUFSLEdBQ0QsbUNBQ0EsZ0pBREEsR0FFQSxnQ0FGQSxHQUVtQyxRQUFRLEtBRjNDLEdBRW1ELE9BRm5ELEdBR0EsWUFKQyxHQUljLEVBUE4sRUFTVCxpQ0FBaUMsUUFBUSxJQUF6QyxHQUFnRCxRQVR2QyxFQVVSLFFBQVEsTUFBUixHQUNELG1DQUFtQyxRQUFRLE1BQTNDLEdBQW9ELFFBRG5ELEdBQzhELEVBWHRELEVBYVQsVUFiUyxFQWNULFFBZFMsRUFlVCxJQWZTLENBZUosRUFmSSxDQUFYO0FBZ0JELEdBcEJZLENBQWI7O0FBc0JBLE1BQUksVUFBVSxTQUFTLE1BQVQsQ0FBZ0IsQ0FDNUIsdUNBRDRCLEVBRTVCLHdCQUY0QixFQUc1QiwwREFINEIsRUFJNUIsUUFKNEIsRUFLNUIsSUFMNEIsQ0FLdkIsRUFMdUIsQ0FBaEIsRUFLRixVQUFVLEtBQVYsRUFBaUIsT0FBakIsRUFBMEI7QUFDcEMsUUFBSSxZQUFZLE9BQU8sUUFBUSxTQUFmLEtBQTZCLFdBQTdCLEdBQTJDLFFBQVEsU0FBbkQsR0FBK0QsUUFBL0U7O0FBRUEsVUFBTSxRQUFOLENBQWUsU0FBZjs7QUFFQSxRQUFJLFFBQVEsU0FBWixFQUF1QjtBQUNyQixZQUFNLElBQU4sQ0FBVyxRQUFYLEVBQXFCLElBQXJCO0FBQ0Q7QUFDRixHQWJhLENBQWQ7O0FBZUEsTUFBSSxPQUFPLFNBQVAsSUFBTyxDQUFVLGFBQVYsRUFBeUIsT0FBekIsRUFBa0M7QUFDM0MsY0FBVSxXQUFXLEdBQXJCO0FBQ0EsV0FBTyxNQUFNLE9BQU4sR0FBZ0IsVUFBaEIsR0FBNkIsYUFBN0IsR0FBNkMsS0FBcEQ7QUFDRCxHQUhEOztBQUtBLE1BQUksS0FBSztBQUNQLFlBQVEsTUFERDtBQUVQLGFBQVMsT0FGRjtBQUdQLGlCQUFhLFdBSE47QUFJUCxhQUFTLE9BSkY7QUFLUCxjQUFVLFFBTEg7QUFNUCxlQUFXLFNBTko7QUFPUCxlQUFXLFNBUEo7QUFRUCxpQkFBYSxXQVJOO0FBU1AsaUJBQWEsV0FUTjtBQVVQLFlBQVEsTUFWRDtBQVdQLGNBQVUsUUFYSDtBQVlQLG1CQUFlLGFBWlI7QUFhUCxhQUFTLE9BYkY7QUFjUCxZQUFRLE1BZEQ7QUFlUCxhQUFTLE9BZkY7QUFnQlAsVUFBTSxJQWhCQzs7QUFrQlAsZUFBVyxtQkFBVSxJQUFWLEVBQWdCLFFBQWhCLEVBQTBCO0FBQ25DLFdBQUssV0FBTCxDQUFpQixVQUFqQixFQUE2QixDQUFDLFFBQTlCO0FBQ0EsV0FBSyxJQUFMLENBQVUsVUFBVixFQUFzQixDQUFDLFFBQXZCO0FBQ0QsS0FyQk07O0FBdUJQLHFCQUFpQix5QkFBVSxJQUFWLEVBQWdCLFFBQWhCLEVBQTBCO0FBQ3pDLFdBQUssV0FBTCxDQUFpQixRQUFqQixFQUEyQixRQUEzQjtBQUNELEtBekJNOztBQTJCUCxtQkFBZSx1QkFBVSxPQUFWLEVBQW1CLE9BQW5CLEVBQTRCO0FBQ3pDLGNBQVEsR0FBUixDQUFZLGdCQUFaLEVBQThCLE9BQTlCO0FBQ0QsS0E3Qk07O0FBK0JQLG9CQUFnQix3QkFBVSxPQUFWLEVBQW1CLE9BQW5CLEVBQTRCO0FBQzFDLGNBQVEsR0FBUixDQUFZLGlCQUFaLEVBQStCLE9BQS9CO0FBQ0QsS0FqQ007O0FBbUNQLGdCQUFZLG9CQUFVLE9BQVYsRUFBbUI7QUFDN0IsY0FBUSxLQUFSLENBQWMsTUFBZDtBQUNELEtBckNNOztBQXVDUCxnQkFBWSxvQkFBVSxPQUFWLEVBQW1CO0FBQzdCLGNBQVEsS0FBUixDQUFjLE1BQWQ7QUFDRCxLQXpDTTs7QUEyQ1Asa0JBQWMsc0JBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQjtBQUN0QyxVQUFJLFVBQVUsQ0FBQyxRQUFRLE9BQVIsR0FBa0IsR0FBRyxTQUFILENBQWEsQ0FDNUMsR0FBRyxXQUFILENBQWUsQ0FDYixHQUFHLFdBQUgsRUFEYSxDQUFmLENBRDRDLENBQWIsQ0FBbEIsR0FJVixHQUFHLE1BQUgsQ0FBVSxDQUNiLEdBQUcsT0FBSCxFQURhLEVBRWIsR0FBRyxXQUFILENBQWUsQ0FDYixHQUFHLE9BQUgsRUFEYSxFQUViLEdBQUcsUUFBSCxFQUZhLENBQWYsQ0FGYSxFQU1iLEdBQUcsU0FBSCxFQU5hLENBQVYsQ0FKUyxFQVdWLE1BWFUsRUFBZDs7QUFhQSxjQUFRLFdBQVIsQ0FBb0IsS0FBcEI7O0FBRUEsYUFBTztBQUNMLGNBQU0sS0FERDtBQUVMLGdCQUFRLE9BRkg7QUFHTCxpQkFBUyxRQUFRLElBQVIsQ0FBYSxlQUFiLENBSEo7QUFJTCxxQkFBYSxRQUFRLElBQVIsQ0FBYSxvQkFBYixDQUpSO0FBS0wsa0JBQVUsUUFBUSxJQUFSLENBQWEsZ0JBQWIsQ0FMTDtBQU1MLGlCQUFTLFFBQVEsSUFBUixDQUFhLGVBQWIsQ0FOSjtBQU9MLG1CQUFXLFFBQVEsSUFBUixDQUFhLGlCQUFiO0FBUE4sT0FBUDtBQVNELEtBcEVNOztBQXNFUCxrQkFBYyxzQkFBVSxLQUFWLEVBQWlCLFVBQWpCLEVBQTZCO0FBQ3pDLFlBQU0sSUFBTixDQUFXLFdBQVcsUUFBWCxDQUFvQixJQUFwQixFQUFYO0FBQ0EsaUJBQVcsTUFBWCxDQUFrQixNQUFsQjtBQUNBLFlBQU0sSUFBTjtBQUNEO0FBMUVNLEdBQVQ7O0FBNkVBLElBQUUsVUFBRixHQUFlLEVBQUUsVUFBRixJQUFnQjtBQUM3QixVQUFNO0FBRHVCLEdBQS9COztBQUlBLElBQUUsTUFBRixDQUFTLEVBQUUsVUFBRixDQUFhLElBQXRCLEVBQTRCO0FBQzFCLGFBQVM7QUFDUCxZQUFNO0FBQ0osY0FBTSxNQURGO0FBRUosZ0JBQVEsUUFGSjtBQUdKLG1CQUFXLFdBSFA7QUFJSixlQUFPLG1CQUpIO0FBS0osZ0JBQVEsYUFMSjtBQU1KLGNBQU0sYUFORjtBQU9KLHVCQUFlLGVBUFg7QUFRSixtQkFBVyxXQVJQO0FBU0oscUJBQWEsYUFUVDtBQVVKLGNBQU07QUFWRixPQURDO0FBYVAsYUFBTztBQUNMLGVBQU8sU0FERjtBQUVMLGdCQUFRLGNBRkg7QUFHTCxvQkFBWSxhQUhQO0FBSUwsb0JBQVksYUFKUDtBQUtMLHVCQUFlLGdCQUxWO0FBTUwsbUJBQVcsWUFOTjtBQU9MLG9CQUFZLGFBUFA7QUFRTCxtQkFBVyxZQVJOO0FBU0wsc0JBQWMsZ0JBVFQ7QUFVTCxxQkFBYSxlQVZSO0FBV0wsd0JBQWdCLGtCQVhYO0FBWUwsbUJBQVcsYUFaTjtBQWFMLHVCQUFlLHlCQWJWO0FBY0wsbUJBQVcsb0JBZE47QUFlTCx5QkFBaUIsbUJBZlo7QUFnQkwseUJBQWlCLG1CQWhCWjtBQWlCTCw4QkFBc0IsNkJBakJqQjtBQWtCTCxhQUFLLFdBbEJBO0FBbUJMLGdCQUFRO0FBbkJILE9BYkE7QUFrQ1AsYUFBTztBQUNMLGVBQU8sT0FERjtBQUVMLG1CQUFXLFlBRk47QUFHTCxnQkFBUSxjQUhIO0FBSUwsYUFBSyxZQUpBO0FBS0wsbUJBQVc7QUFMTixPQWxDQTtBQXlDUCxZQUFNO0FBQ0osY0FBTSxNQURGO0FBRUosZ0JBQVEsYUFGSjtBQUdKLGdCQUFRLFFBSEo7QUFJSixjQUFNLE1BSkY7QUFLSix1QkFBZSxpQkFMWDtBQU1KLGFBQUssa0NBTkQ7QUFPSix5QkFBaUI7QUFQYixPQXpDQztBQWtEUCxhQUFPO0FBQ0wsZUFBTztBQURGLE9BbERBO0FBcURQLFVBQUk7QUFDRixnQkFBUTtBQUROLE9BckRHO0FBd0RQLGFBQU87QUFDTCxlQUFPLE9BREY7QUFFTCxnQkFBUSxRQUZIO0FBR0wsb0JBQVksT0FIUDtBQUlMLGFBQUssTUFKQTtBQUtMLFlBQUksVUFMQztBQU1MLFlBQUksVUFOQztBQU9MLFlBQUksVUFQQztBQVFMLFlBQUksVUFSQztBQVNMLFlBQUksVUFUQztBQVVMLFlBQUk7QUFWQyxPQXhEQTtBQW9FUCxhQUFPO0FBQ0wsbUJBQVcsZ0JBRE47QUFFTCxpQkFBUztBQUZKLE9BcEVBO0FBd0VQLGVBQVM7QUFDUCxjQUFNLE1BREM7QUFFUCxvQkFBWSxhQUZMO0FBR1Asa0JBQVU7QUFISCxPQXhFRjtBQTZFUCxpQkFBVztBQUNULG1CQUFXLFdBREY7QUFFVCxpQkFBUyxTQUZBO0FBR1QsZ0JBQVEsUUFIQztBQUlULGNBQU0sWUFKRztBQUtULGdCQUFRLGNBTEM7QUFNVCxlQUFPLGFBTkU7QUFPVCxpQkFBUztBQVBBLE9BN0VKO0FBc0ZQLGFBQU87QUFDTCxnQkFBUSxjQURIO0FBRUwsY0FBTSxZQUZEO0FBR0wsb0JBQVksa0JBSFA7QUFJTCxvQkFBWSxrQkFKUDtBQUtMLHFCQUFhLGFBTFI7QUFNTCx3QkFBZ0IsaUJBTlg7QUFPTCxlQUFPLE9BUEY7QUFRTCx3QkFBZ0I7QUFSWCxPQXRGQTtBQWdHUCxnQkFBVTtBQUNSLG1CQUFXLG9CQURIO0FBRVIsZUFBTyxPQUZDO0FBR1Isd0JBQWdCLGlCQUhSO0FBSVIsZ0JBQVEsUUFKQTtBQUtSLDZCQUFxQixzQkFMYjtBQU1SLHVCQUFlLGdCQU5QO0FBT1IsbUJBQVc7QUFQSCxPQWhHSDtBQXlHUCxZQUFNO0FBQ0osMkJBQW1CLGtCQURmO0FBRUosZ0JBQVEseUJBRko7QUFHSixnQkFBUSx5QkFISjtBQUlKLGVBQU8sS0FKSDtBQUtKLGlCQUFTLE9BTEw7QUFNSixnQkFBUSxrQkFOSjtBQU9KLGtCQUFVLG9CQVBOO0FBUUoscUJBQWEsdUJBUlQ7QUFTSix5QkFBaUIsMkJBVGI7QUFVSix3QkFBZ0IsZUFWWjtBQVdKLHVCQUFlLGdCQVhYO0FBWUoseUJBQWlCLGtCQVpiO0FBYUosd0JBQWdCLGlCQWJaO0FBY0osdUJBQWUsZ0JBZFg7QUFlSiwrQkFBdUIsdUJBZm5CO0FBZ0JKLDZCQUFxQixxQkFoQmpCO0FBaUJKLG1CQUFXLDhCQWpCUDtBQWtCSixrQkFBVSw2QkFsQk47QUFtQkosc0JBQWMsc0RBbkJWO0FBb0JKLG9CQUFZLHNDQXBCUjtBQXFCSixvQkFBWSxzQ0FyQlI7QUFzQkosb0JBQVksc0NBdEJSO0FBdUJKLG9CQUFZLHNDQXZCUjtBQXdCSixvQkFBWSxzQ0F4QlI7QUF5Qkosb0JBQVksc0NBekJSO0FBMEJKLGdDQUF3Qix3QkExQnBCO0FBMkJKLDJCQUFtQjtBQTNCZixPQXpHQztBQXNJUCxlQUFTO0FBQ1AsY0FBTSxNQURDO0FBRVAsY0FBTTtBQUZDLE9BdElGO0FBMElQLG1CQUFhO0FBQ1gscUJBQWEsb0JBREY7QUFFWCxnQkFBUTtBQUZHO0FBMUlOO0FBRGlCLEdBQTVCOztBQW1KQTs7Ozs7Ozs7QUFRQSxNQUFJLE1BQU8sWUFBWTtBQUNyQixRQUFJLFNBQVM7QUFDWCxtQkFBYSxDQURGO0FBRVgsYUFBTyxDQUZJO0FBR1gsZUFBUyxFQUhFO0FBSVgsZUFBUyxFQUpFOztBQU1YO0FBQ0EsY0FBUSxFQVBHO0FBUVgsWUFBTSxFQVJLO0FBU1gsZUFBUyxFQVRFO0FBVVgsY0FBUSxFQVZHOztBQVlYO0FBQ0EsY0FBUSxFQWJHO0FBY1gsY0FBUSxFQWRHO0FBZVgsY0FBUSxFQWZHO0FBZ0JYLGNBQVEsRUFoQkc7QUFpQlgsY0FBUSxFQWpCRztBQWtCWCxjQUFRLEVBbEJHO0FBbUJYLGNBQVEsRUFuQkc7QUFvQlgsY0FBUSxFQXBCRztBQXFCWCxjQUFRLEVBckJHOztBQXVCWDtBQUNBLFdBQUssRUF4Qk07QUF5QlgsV0FBSyxFQXpCTTtBQTBCWCxXQUFLLEVBMUJNO0FBMkJYLFdBQUssRUEzQk07QUE0QlgsV0FBSyxFQTVCTTtBQTZCWCxXQUFLLEVBN0JNO0FBOEJYLFdBQUssRUE5Qk07QUErQlgsV0FBSyxFQS9CTTtBQWdDWCxXQUFLLEVBaENNO0FBaUNYLFdBQUssRUFqQ007QUFrQ1gsV0FBSyxFQWxDTTtBQW1DWCxXQUFLLEVBbkNNOztBQXFDWCxlQUFTLEdBckNFO0FBc0NYLHFCQUFlLEdBdENKO0FBdUNYLG1CQUFhLEdBdkNGO0FBd0NYLHNCQUFnQjtBQXhDTCxLQUFiOztBQTJDQSxXQUFPO0FBQ0w7Ozs7OztBQU1BLGNBQVEsZ0JBQVUsT0FBVixFQUFtQjtBQUN6QixlQUFPLEtBQUssUUFBTCxDQUFjLENBQ25CLE9BQU8sU0FEWSxFQUVuQixPQUFPLEdBRlksRUFHbkIsT0FBTyxLQUhZLEVBSW5CLE9BQU8sS0FKWSxDQUFkLEVBS0osT0FMSSxDQUFQO0FBTUQsT0FkSTtBQWVMOzs7Ozs7QUFNQSxjQUFRLGdCQUFVLE9BQVYsRUFBbUI7QUFDekIsZUFBTyxLQUFLLFFBQUwsQ0FBYyxDQUNuQixPQUFPLElBRFksRUFFbkIsT0FBTyxFQUZZLEVBR25CLE9BQU8sS0FIWSxFQUluQixPQUFPLElBSlksQ0FBZCxFQUtKLE9BTEksQ0FBUDtBQU1ELE9BNUJJO0FBNkJMOzs7O0FBSUEsb0JBQWMsS0FBSyxZQUFMLENBQWtCLE1BQWxCLENBakNUO0FBa0NMLFlBQU07QUFsQ0QsS0FBUDtBQW9DRCxHQWhGUyxFQUFWOztBQWtGQSxNQUFJLFFBQVMsWUFBWTs7QUFFdkI7Ozs7Ozs7OztBQVNBLFFBQUksbUJBQW1CLFNBQW5CLGdCQUFtQixDQUFVLFNBQVYsRUFBcUIsT0FBckIsRUFBOEI7QUFDbkQsVUFBSSxZQUFZLFVBQVUsYUFBVixFQUFoQjtBQUFBLFVBQTJDLE1BQTNDOztBQUVBLFVBQUksU0FBUyxTQUFTLElBQVQsQ0FBYyxlQUFkLEVBQWI7QUFBQSxVQUE4QyxhQUE5QztBQUNBLFVBQUksYUFBYSxLQUFLLElBQUwsQ0FBVSxVQUFVLFVBQXBCLENBQWpCO0FBQ0EsV0FBSyxTQUFTLENBQWQsRUFBaUIsU0FBUyxXQUFXLE1BQXJDLEVBQTZDLFFBQTdDLEVBQXVEO0FBQ3JELFlBQUksSUFBSSxNQUFKLENBQVcsV0FBVyxNQUFYLENBQVgsQ0FBSixFQUFvQztBQUNsQztBQUNEO0FBQ0QsZUFBTyxpQkFBUCxDQUF5QixXQUFXLE1BQVgsQ0FBekI7QUFDQSxZQUFJLE9BQU8sZ0JBQVAsQ0FBd0IsY0FBeEIsRUFBd0MsU0FBeEMsS0FBc0QsQ0FBMUQsRUFBNkQ7QUFDM0Q7QUFDRDtBQUNELHdCQUFnQixXQUFXLE1BQVgsQ0FBaEI7QUFDRDs7QUFFRCxVQUFJLFdBQVcsQ0FBWCxJQUFnQixJQUFJLE1BQUosQ0FBVyxXQUFXLFNBQVMsQ0FBcEIsQ0FBWCxDQUFwQixFQUF3RDtBQUN0RCxZQUFJLGlCQUFpQixTQUFTLElBQVQsQ0FBYyxlQUFkLEVBQXJCO0FBQUEsWUFBc0QsY0FBYyxJQUFwRTtBQUNBLHVCQUFlLGlCQUFmLENBQWlDLGlCQUFpQixTQUFsRDtBQUNBLHVCQUFlLFFBQWYsQ0FBd0IsQ0FBQyxhQUF6QjtBQUNBLHNCQUFjLGdCQUFnQixjQUFjLFdBQTlCLEdBQTRDLFVBQVUsVUFBcEU7O0FBRUEsWUFBSSxjQUFjLFVBQVUsU0FBVixFQUFsQjtBQUNBLG9CQUFZLFdBQVosQ0FBd0IsY0FBeEIsRUFBd0MsY0FBeEM7QUFDQSxZQUFJLFlBQVksWUFBWSxJQUFaLENBQWlCLE9BQWpCLENBQXlCLFNBQXpCLEVBQW9DLEVBQXBDLEVBQXdDLE1BQXhEOztBQUVBLGVBQU8sWUFBWSxZQUFZLFNBQVosQ0FBc0IsTUFBbEMsSUFBNEMsWUFBWSxXQUEvRCxFQUE0RTtBQUMxRSx1QkFBYSxZQUFZLFNBQVosQ0FBc0IsTUFBbkM7QUFDQSx3QkFBYyxZQUFZLFdBQTFCO0FBQ0Q7O0FBRUQ7QUFDQSxZQUFJLFFBQVEsWUFBWSxTQUF4QixDQWhCc0QsQ0FnQm5CO0FBQ25DOztBQUVBLFlBQUksV0FBVyxZQUFZLFdBQXZCLElBQXNDLElBQUksTUFBSixDQUFXLFlBQVksV0FBdkIsQ0FBdEMsSUFDQSxjQUFjLFlBQVksU0FBWixDQUFzQixNQUR4QyxFQUNnRDtBQUM5Qyx1QkFBYSxZQUFZLFNBQVosQ0FBc0IsTUFBbkM7QUFDQSx3QkFBYyxZQUFZLFdBQTFCO0FBQ0Q7O0FBRUQsb0JBQVksV0FBWjtBQUNBLGlCQUFTLFNBQVQ7QUFDRDs7QUFFRCxhQUFPO0FBQ0wsY0FBTSxTQUREO0FBRUwsZ0JBQVE7QUFGSCxPQUFQO0FBSUQsS0FqREQ7O0FBbURBOzs7OztBQUtBLFFBQUksbUJBQW1CLFNBQW5CLGdCQUFtQixDQUFVLEtBQVYsRUFBaUI7QUFDdEMsVUFBSSxnQkFBZ0IsU0FBaEIsYUFBZ0IsQ0FBVSxTQUFWLEVBQXFCLE1BQXJCLEVBQTZCO0FBQy9DLFlBQUksSUFBSixFQUFVLGlCQUFWOztBQUVBLFlBQUksSUFBSSxNQUFKLENBQVcsU0FBWCxDQUFKLEVBQTJCO0FBQ3pCLGNBQUksZ0JBQWdCLElBQUksUUFBSixDQUFhLFNBQWIsRUFBd0IsS0FBSyxHQUFMLENBQVMsSUFBSSxNQUFiLENBQXhCLENBQXBCO0FBQ0EsY0FBSSxnQkFBZ0IsS0FBSyxJQUFMLENBQVUsYUFBVixFQUF5QixlQUE3QztBQUNBLGlCQUFRLGlCQUFpQixVQUFVLFVBQW5DO0FBQ0Esb0JBQVUsS0FBSyxHQUFMLENBQVMsS0FBSyxJQUFMLENBQVUsYUFBVixDQUFULEVBQW1DLElBQUksVUFBdkMsQ0FBVjtBQUNBLDhCQUFvQixDQUFDLGFBQXJCO0FBQ0QsU0FORCxNQU1PO0FBQ0wsaUJBQU8sVUFBVSxVQUFWLENBQXFCLE1BQXJCLEtBQWdDLFNBQXZDO0FBQ0EsY0FBSSxJQUFJLE1BQUosQ0FBVyxJQUFYLENBQUosRUFBc0I7QUFDcEIsbUJBQU8sY0FBYyxJQUFkLEVBQW9CLENBQXBCLENBQVA7QUFDRDs7QUFFRCxtQkFBUyxDQUFUO0FBQ0EsOEJBQW9CLEtBQXBCO0FBQ0Q7O0FBRUQsZUFBTztBQUNMLGdCQUFNLElBREQ7QUFFTCwyQkFBaUIsaUJBRlo7QUFHTCxrQkFBUTtBQUhILFNBQVA7QUFLRCxPQXhCRDs7QUEwQkEsVUFBSSxZQUFZLFNBQVMsSUFBVCxDQUFjLGVBQWQsRUFBaEI7QUFDQSxVQUFJLE9BQU8sY0FBYyxNQUFNLElBQXBCLEVBQTBCLE1BQU0sTUFBaEMsQ0FBWDs7QUFFQSxnQkFBVSxpQkFBVixDQUE0QixLQUFLLElBQWpDO0FBQ0EsZ0JBQVUsUUFBVixDQUFtQixLQUFLLGVBQXhCO0FBQ0EsZ0JBQVUsU0FBVixDQUFvQixXQUFwQixFQUFpQyxLQUFLLE1BQXRDO0FBQ0EsYUFBTyxTQUFQO0FBQ0QsS0FsQ0Q7O0FBb0NBOzs7Ozs7Ozs7QUFTQSxRQUFJLGVBQWUsU0FBZixZQUFlLENBQVUsRUFBVixFQUFjLEVBQWQsRUFBa0IsRUFBbEIsRUFBc0IsRUFBdEIsRUFBMEI7QUFDM0MsV0FBSyxFQUFMLEdBQVUsRUFBVjtBQUNBLFdBQUssRUFBTCxHQUFVLEVBQVY7QUFDQSxXQUFLLEVBQUwsR0FBVSxFQUFWO0FBQ0EsV0FBSyxFQUFMLEdBQVUsRUFBVjs7QUFFQTtBQUNBLFVBQUksY0FBYyxTQUFkLFdBQWMsR0FBWTtBQUM1QixZQUFJLE1BQU0saUJBQVYsRUFBNkI7QUFDM0IsY0FBSSxXQUFXLFNBQVMsV0FBVCxFQUFmO0FBQ0EsbUJBQVMsUUFBVCxDQUFrQixFQUFsQixFQUFzQixFQUF0QjtBQUNBLG1CQUFTLE1BQVQsQ0FBZ0IsRUFBaEIsRUFBb0IsRUFBcEI7O0FBRUEsaUJBQU8sUUFBUDtBQUNELFNBTkQsTUFNTztBQUNMLGNBQUksWUFBWSxpQkFBaUI7QUFDL0Isa0JBQU0sRUFEeUI7QUFFL0Isb0JBQVE7QUFGdUIsV0FBakIsQ0FBaEI7O0FBS0Esb0JBQVUsV0FBVixDQUFzQixVQUF0QixFQUFrQyxpQkFBaUI7QUFDakQsa0JBQU0sRUFEMkM7QUFFakQsb0JBQVE7QUFGeUMsV0FBakIsQ0FBbEM7O0FBS0EsaUJBQU8sU0FBUDtBQUNEO0FBQ0YsT0FwQkQ7O0FBc0JBLFdBQUssU0FBTCxHQUFpQixZQUFZO0FBQzNCLGVBQU87QUFDTCxjQUFJLEVBREM7QUFFTCxjQUFJLEVBRkM7QUFHTCxjQUFJLEVBSEM7QUFJTCxjQUFJO0FBSkMsU0FBUDtBQU1ELE9BUEQ7O0FBU0EsV0FBSyxhQUFMLEdBQXFCLFlBQVk7QUFDL0IsZUFBTztBQUNMLGdCQUFNLEVBREQ7QUFFTCxrQkFBUTtBQUZILFNBQVA7QUFJRCxPQUxEOztBQU9BLFdBQUssV0FBTCxHQUFtQixZQUFZO0FBQzdCLGVBQU87QUFDTCxnQkFBTSxFQUREO0FBRUwsa0JBQVE7QUFGSCxTQUFQO0FBSUQsT0FMRDs7QUFPQTs7O0FBR0EsV0FBSyxNQUFMLEdBQWMsWUFBWTtBQUN4QixZQUFJLFlBQVksYUFBaEI7QUFDQSxZQUFJLE1BQU0saUJBQVYsRUFBNkI7QUFDM0IsY0FBSSxZQUFZLFNBQVMsWUFBVCxFQUFoQjtBQUNBLGNBQUksVUFBVSxVQUFWLEdBQXVCLENBQTNCLEVBQThCO0FBQzVCLHNCQUFVLGVBQVY7QUFDRDtBQUNELG9CQUFVLFFBQVYsQ0FBbUIsU0FBbkI7QUFDRCxTQU5ELE1BTU87QUFDTCxvQkFBVSxNQUFWO0FBQ0Q7O0FBRUQsZUFBTyxJQUFQO0FBQ0QsT0FiRDs7QUFlQTs7Ozs7QUFLQSxXQUFLLGNBQUwsR0FBc0IsVUFBVSxTQUFWLEVBQXFCO0FBQ3pDLFlBQUksU0FBUyxFQUFFLFNBQUYsRUFBYSxNQUFiLEVBQWI7QUFDQSxZQUFJLFVBQVUsU0FBVixHQUFzQixNQUF0QixHQUErQixLQUFLLEVBQUwsQ0FBUSxTQUEzQyxFQUFzRDtBQUNwRCxvQkFBVSxTQUFWLElBQXVCLEtBQUssR0FBTCxDQUFTLFVBQVUsU0FBVixHQUFzQixNQUF0QixHQUErQixLQUFLLEVBQUwsQ0FBUSxTQUFoRCxDQUF2QjtBQUNEOztBQUVELGVBQU8sSUFBUDtBQUNELE9BUEQ7O0FBU0E7OztBQUdBLFdBQUssU0FBTCxHQUFpQixZQUFZOztBQUUzQjs7Ozs7QUFLQSxZQUFJLGtCQUFrQixTQUFsQixlQUFrQixDQUFVLEtBQVYsRUFBaUIsYUFBakIsRUFBZ0M7QUFDcEQsY0FBSyxJQUFJLGNBQUosQ0FBbUIsS0FBbkIsS0FBNkIsQ0FBQyxJQUFJLFdBQUosQ0FBZ0IsS0FBaEIsQ0FBL0IsSUFDQyxJQUFJLGNBQUosQ0FBbUIsS0FBbkIsS0FBNkIsSUFBSSxnQkFBSixDQUFxQixLQUFyQixDQUE3QixJQUE0RCxDQUFDLGFBRDlELElBRUMsSUFBSSxjQUFKLENBQW1CLEtBQW5CLEtBQTZCLElBQUksZUFBSixDQUFvQixLQUFwQixDQUE3QixJQUEyRCxhQUY1RCxJQUdDLElBQUksY0FBSixDQUFtQixLQUFuQixLQUE2QixJQUFJLE9BQUosQ0FBWSxNQUFNLElBQWxCLENBQTdCLElBQXdELElBQUksT0FBSixDQUFZLE1BQU0sSUFBbEIsQ0FIN0QsRUFHdUY7QUFDckYsbUJBQU8sS0FBUDtBQUNEOztBQUVEO0FBQ0EsY0FBSSxRQUFRLElBQUksUUFBSixDQUFhLE1BQU0sSUFBbkIsRUFBeUIsSUFBSSxPQUE3QixDQUFaO0FBQ0EsY0FBSyxDQUFDLElBQUksaUJBQUosQ0FBc0IsS0FBdEIsRUFBNkIsS0FBN0IsS0FBdUMsSUFBSSxNQUFKLENBQVcsSUFBSSxTQUFKLENBQWMsS0FBZCxFQUFxQixJQUFoQyxDQUF4QyxLQUFrRixDQUFDLGFBQXBGLElBQ0MsQ0FBQyxJQUFJLGtCQUFKLENBQXVCLEtBQXZCLEVBQThCLEtBQTlCLEtBQXdDLElBQUksTUFBSixDQUFXLElBQUksU0FBSixDQUFjLEtBQWQsRUFBcUIsSUFBaEMsQ0FBekMsS0FBbUYsYUFEeEYsRUFDd0c7O0FBRXRHO0FBQ0EsZ0JBQUksSUFBSSxjQUFKLENBQW1CLEtBQW5CLENBQUosRUFBK0I7QUFDN0IscUJBQU8sS0FBUDtBQUNEO0FBQ0Q7QUFDQSw0QkFBZ0IsQ0FBQyxhQUFqQjtBQUNEOztBQUVELGNBQUksWUFBWSxnQkFBZ0IsSUFBSSxjQUFKLENBQW1CLElBQUksU0FBSixDQUFjLEtBQWQsQ0FBbkIsRUFBeUMsSUFBSSxjQUE3QyxDQUFoQixHQUNnQixJQUFJLGNBQUosQ0FBbUIsSUFBSSxTQUFKLENBQWMsS0FBZCxDQUFuQixFQUF5QyxJQUFJLGNBQTdDLENBRGhDO0FBRUEsaUJBQU8sYUFBYSxLQUFwQjtBQUNELFNBeEJEOztBQTBCQSxZQUFJLFdBQVcsZ0JBQWdCLEtBQUssV0FBTCxFQUFoQixFQUFvQyxLQUFwQyxDQUFmO0FBQ0EsWUFBSSxhQUFhLEtBQUssV0FBTCxLQUFxQixRQUFyQixHQUFnQyxnQkFBZ0IsS0FBSyxhQUFMLEVBQWhCLEVBQXNDLElBQXRDLENBQWpEOztBQUVBLGVBQU8sSUFBSSxZQUFKLENBQ0wsV0FBVyxJQUROLEVBRUwsV0FBVyxNQUZOLEVBR0wsU0FBUyxJQUhKLEVBSUwsU0FBUyxNQUpKLENBQVA7QUFNRCxPQTFDRDs7QUE0Q0E7Ozs7Ozs7OztBQVNBLFdBQUssS0FBTCxHQUFhLFVBQVUsSUFBVixFQUFnQixPQUFoQixFQUF5QjtBQUNwQyxlQUFPLFFBQVEsS0FBSyxFQUFwQjs7QUFFQSxZQUFJLGtCQUFrQixXQUFXLFFBQVEsZUFBekM7QUFDQSxZQUFJLGdCQUFnQixXQUFXLFFBQVEsYUFBdkM7O0FBRUE7QUFDQSxZQUFJLGFBQWEsS0FBSyxhQUFMLEVBQWpCO0FBQ0EsWUFBSSxXQUFXLEtBQUssV0FBTCxFQUFmOztBQUVBLFlBQUksUUFBUSxFQUFaO0FBQ0EsWUFBSSxnQkFBZ0IsRUFBcEI7O0FBRUEsWUFBSSxTQUFKLENBQWMsVUFBZCxFQUEwQixRQUExQixFQUFvQyxVQUFVLEtBQVYsRUFBaUI7QUFDbkQsY0FBSSxJQUFJLFVBQUosQ0FBZSxNQUFNLElBQXJCLENBQUosRUFBZ0M7QUFDOUI7QUFDRDs7QUFFRCxjQUFJLElBQUo7QUFDQSxjQUFJLGFBQUosRUFBbUI7QUFDakIsZ0JBQUksSUFBSSxlQUFKLENBQW9CLEtBQXBCLENBQUosRUFBZ0M7QUFDOUIsNEJBQWMsSUFBZCxDQUFtQixNQUFNLElBQXpCO0FBQ0Q7QUFDRCxnQkFBSSxJQUFJLGdCQUFKLENBQXFCLEtBQXJCLEtBQStCLEtBQUssUUFBTCxDQUFjLGFBQWQsRUFBNkIsTUFBTSxJQUFuQyxDQUFuQyxFQUE2RTtBQUMzRSxxQkFBTyxNQUFNLElBQWI7QUFDRDtBQUNGLFdBUEQsTUFPTyxJQUFJLGVBQUosRUFBcUI7QUFDMUIsbUJBQU8sSUFBSSxRQUFKLENBQWEsTUFBTSxJQUFuQixFQUF5QixJQUF6QixDQUFQO0FBQ0QsV0FGTSxNQUVBO0FBQ0wsbUJBQU8sTUFBTSxJQUFiO0FBQ0Q7O0FBRUQsY0FBSSxRQUFRLEtBQUssSUFBTCxDQUFaLEVBQXdCO0FBQ3RCLGtCQUFNLElBQU4sQ0FBVyxJQUFYO0FBQ0Q7QUFDRixTQXRCRCxFQXNCRyxJQXRCSDs7QUF3QkEsZUFBTyxLQUFLLE1BQUwsQ0FBWSxLQUFaLENBQVA7QUFDRCxPQXRDRDs7QUF3Q0E7Ozs7QUFJQSxXQUFLLGNBQUwsR0FBc0IsWUFBWTtBQUNoQyxlQUFPLElBQUksY0FBSixDQUFtQixFQUFuQixFQUF1QixFQUF2QixDQUFQO0FBQ0QsT0FGRDs7QUFJQTs7Ozs7O0FBTUEsV0FBSyxNQUFMLEdBQWMsVUFBVSxJQUFWLEVBQWdCO0FBQzVCLFlBQUksZ0JBQWdCLElBQUksUUFBSixDQUFhLEVBQWIsRUFBaUIsSUFBakIsQ0FBcEI7QUFDQSxZQUFJLGNBQWMsSUFBSSxRQUFKLENBQWEsRUFBYixFQUFpQixJQUFqQixDQUFsQjs7QUFFQSxZQUFJLENBQUMsYUFBRCxJQUFrQixDQUFDLFdBQXZCLEVBQW9DO0FBQ2xDLGlCQUFPLElBQUksWUFBSixDQUFpQixFQUFqQixFQUFxQixFQUFyQixFQUF5QixFQUF6QixFQUE2QixFQUE3QixDQUFQO0FBQ0Q7O0FBRUQsWUFBSSxpQkFBaUIsS0FBSyxTQUFMLEVBQXJCOztBQUVBLFlBQUksYUFBSixFQUFtQjtBQUNqQix5QkFBZSxFQUFmLEdBQW9CLGFBQXBCO0FBQ0EseUJBQWUsRUFBZixHQUFvQixDQUFwQjtBQUNEOztBQUVELFlBQUksV0FBSixFQUFpQjtBQUNmLHlCQUFlLEVBQWYsR0FBb0IsV0FBcEI7QUFDQSx5QkFBZSxFQUFmLEdBQW9CLElBQUksVUFBSixDQUFlLFdBQWYsQ0FBcEI7QUFDRDs7QUFFRCxlQUFPLElBQUksWUFBSixDQUNMLGVBQWUsRUFEVixFQUVMLGVBQWUsRUFGVixFQUdMLGVBQWUsRUFIVixFQUlMLGVBQWUsRUFKVixDQUFQO0FBTUQsT0ExQkQ7O0FBNEJBOzs7O0FBSUEsV0FBSyxRQUFMLEdBQWdCLFVBQVUsaUJBQVYsRUFBNkI7QUFDM0MsWUFBSSxpQkFBSixFQUF1QjtBQUNyQixpQkFBTyxJQUFJLFlBQUosQ0FBaUIsRUFBakIsRUFBcUIsRUFBckIsRUFBeUIsRUFBekIsRUFBNkIsRUFBN0IsQ0FBUDtBQUNELFNBRkQsTUFFTztBQUNMLGlCQUFPLElBQUksWUFBSixDQUFpQixFQUFqQixFQUFxQixFQUFyQixFQUF5QixFQUF6QixFQUE2QixFQUE3QixDQUFQO0FBQ0Q7QUFDRixPQU5EOztBQVFBOzs7QUFHQSxXQUFLLFNBQUwsR0FBaUIsWUFBWTtBQUMzQixZQUFJLGtCQUFrQixPQUFPLEVBQTdCO0FBQ0EsWUFBSSxpQkFBaUIsS0FBSyxTQUFMLEVBQXJCOztBQUVBLFlBQUksSUFBSSxNQUFKLENBQVcsRUFBWCxLQUFrQixDQUFDLElBQUksV0FBSixDQUFnQixLQUFLLFdBQUwsRUFBaEIsQ0FBdkIsRUFBNEQ7QUFDMUQsYUFBRyxTQUFILENBQWEsRUFBYjtBQUNEOztBQUVELFlBQUksSUFBSSxNQUFKLENBQVcsRUFBWCxLQUFrQixDQUFDLElBQUksV0FBSixDQUFnQixLQUFLLGFBQUwsRUFBaEIsQ0FBdkIsRUFBOEQ7QUFDNUQseUJBQWUsRUFBZixHQUFvQixHQUFHLFNBQUgsQ0FBYSxFQUFiLENBQXBCO0FBQ0EseUJBQWUsRUFBZixHQUFvQixDQUFwQjs7QUFFQSxjQUFJLGVBQUosRUFBcUI7QUFDbkIsMkJBQWUsRUFBZixHQUFvQixlQUFlLEVBQW5DO0FBQ0EsMkJBQWUsRUFBZixHQUFvQixLQUFLLEVBQXpCO0FBQ0Q7QUFDRjs7QUFFRCxlQUFPLElBQUksWUFBSixDQUNMLGVBQWUsRUFEVixFQUVMLGVBQWUsRUFGVixFQUdMLGVBQWUsRUFIVixFQUlMLGVBQWUsRUFKVixDQUFQO0FBTUQsT0F4QkQ7O0FBMEJBOzs7O0FBSUEsV0FBSyxjQUFMLEdBQXNCLFlBQVk7QUFDaEMsWUFBSSxLQUFLLFdBQUwsRUFBSixFQUF3QjtBQUN0QixpQkFBTyxJQUFQO0FBQ0Q7O0FBRUQsWUFBSSxNQUFNLEtBQUssU0FBTCxFQUFWO0FBQ0EsWUFBSSxRQUFRLElBQUksS0FBSixDQUFVLElBQVYsRUFBZ0I7QUFDMUIseUJBQWU7QUFEVyxTQUFoQixDQUFaOztBQUlBO0FBQ0EsWUFBSSxRQUFRLElBQUksY0FBSixDQUFtQixJQUFJLGFBQUosRUFBbkIsRUFBd0MsVUFBVSxLQUFWLEVBQWlCO0FBQ25FLGlCQUFPLENBQUMsS0FBSyxRQUFMLENBQWMsS0FBZCxFQUFxQixNQUFNLElBQTNCLENBQVI7QUFDRCxTQUZXLENBQVo7O0FBSUEsWUFBSSxlQUFlLEVBQW5CO0FBQ0EsVUFBRSxJQUFGLENBQU8sS0FBUCxFQUFjLFVBQVUsR0FBVixFQUFlLElBQWYsRUFBcUI7QUFDakM7QUFDQSxjQUFJLFNBQVMsS0FBSyxVQUFsQjtBQUNBLGNBQUksTUFBTSxJQUFOLEtBQWUsTUFBZixJQUF5QixJQUFJLFVBQUosQ0FBZSxNQUFmLE1BQTJCLENBQXhELEVBQTJEO0FBQ3pELHlCQUFhLElBQWIsQ0FBa0IsTUFBbEI7QUFDRDtBQUNELGNBQUksTUFBSixDQUFXLElBQVgsRUFBaUIsS0FBakI7QUFDRCxTQVBEOztBQVNBO0FBQ0EsVUFBRSxJQUFGLENBQU8sWUFBUCxFQUFxQixVQUFVLEdBQVYsRUFBZSxJQUFmLEVBQXFCO0FBQ3hDLGNBQUksTUFBSixDQUFXLElBQVgsRUFBaUIsS0FBakI7QUFDRCxTQUZEOztBQUlBLGVBQU8sSUFBSSxZQUFKLENBQ0wsTUFBTSxJQURELEVBRUwsTUFBTSxNQUZELEVBR0wsTUFBTSxJQUhELEVBSUwsTUFBTSxNQUpELEVBS0wsU0FMSyxFQUFQO0FBTUQsT0FwQ0Q7O0FBc0NBOzs7QUFHQSxVQUFJLFdBQVcsU0FBWCxRQUFXLENBQVUsSUFBVixFQUFnQjtBQUM3QixlQUFPLFlBQVk7QUFDakIsY0FBSSxXQUFXLElBQUksUUFBSixDQUFhLEVBQWIsRUFBaUIsSUFBakIsQ0FBZjtBQUNBLGlCQUFPLENBQUMsQ0FBQyxRQUFGLElBQWUsYUFBYSxJQUFJLFFBQUosQ0FBYSxFQUFiLEVBQWlCLElBQWpCLENBQW5DO0FBQ0QsU0FIRDtBQUlELE9BTEQ7O0FBT0E7QUFDQSxXQUFLLFlBQUwsR0FBb0IsU0FBUyxJQUFJLFVBQWIsQ0FBcEI7QUFDQTtBQUNBLFdBQUssUUFBTCxHQUFnQixTQUFTLElBQUksTUFBYixDQUFoQjtBQUNBO0FBQ0EsV0FBSyxVQUFMLEdBQWtCLFNBQVMsSUFBSSxRQUFiLENBQWxCO0FBQ0E7QUFDQSxXQUFLLFFBQUwsR0FBZ0IsU0FBUyxJQUFJLE1BQWIsQ0FBaEI7QUFDQTtBQUNBLFdBQUssUUFBTCxHQUFnQixTQUFTLElBQUksTUFBYixDQUFoQjs7QUFFQTs7OztBQUlBLFdBQUssWUFBTCxHQUFvQixVQUFVLElBQVYsRUFBZ0I7QUFDbEMsWUFBSSxDQUFDLElBQUksZUFBSixDQUFvQixLQUFLLGFBQUwsRUFBcEIsQ0FBTCxFQUFnRDtBQUM5QyxpQkFBTyxLQUFQO0FBQ0Q7O0FBRUQsWUFBSSxPQUFPLElBQUksUUFBSixDQUFhLEtBQUssRUFBbEIsRUFBc0IsSUFBdEIsQ0FBWDtBQUNBLGVBQU8sUUFBUSxJQUFJLFlBQUosQ0FBaUIsS0FBSyxFQUF0QixFQUEwQixJQUExQixDQUFmO0FBQ0QsT0FQRDs7QUFTQTs7O0FBR0EsV0FBSyxXQUFMLEdBQW1CLFlBQVk7QUFDN0IsZUFBTyxPQUFPLEVBQVAsSUFBYSxPQUFPLEVBQTNCO0FBQ0QsT0FGRDs7QUFJQTs7Ozs7QUFLQSxXQUFLLHNCQUFMLEdBQThCLFlBQVk7QUFDeEMsWUFBSSxJQUFJLGVBQUosQ0FBb0IsRUFBcEIsS0FBMkIsSUFBSSxPQUFKLENBQVksRUFBWixDQUEvQixFQUFnRDtBQUM5QyxhQUFHLFNBQUgsR0FBZSxJQUFJLFNBQW5CO0FBQ0EsaUJBQU8sSUFBSSxZQUFKLENBQWlCLEdBQUcsVUFBcEIsRUFBZ0MsQ0FBaEMsRUFBbUMsR0FBRyxVQUF0QyxFQUFrRCxDQUFsRCxDQUFQO0FBQ0Q7O0FBRUQ7Ozs7O0FBS0EsWUFBSSxNQUFNLEtBQUssU0FBTCxFQUFWO0FBQ0EsWUFBSSxJQUFJLFlBQUosQ0FBaUIsRUFBakIsS0FBd0IsSUFBSSxNQUFKLENBQVcsRUFBWCxDQUE1QixFQUE0QztBQUMxQyxpQkFBTyxHQUFQO0FBQ0Q7O0FBRUQ7QUFDQSxZQUFJLFdBQUo7QUFDQSxZQUFJLElBQUksUUFBSixDQUFhLElBQUksRUFBakIsQ0FBSixFQUEwQjtBQUN4QixjQUFJLFlBQVksSUFBSSxZQUFKLENBQWlCLElBQUksRUFBckIsRUFBeUIsS0FBSyxHQUFMLENBQVMsSUFBSSxRQUFiLENBQXpCLENBQWhCO0FBQ0Esd0JBQWMsS0FBSyxJQUFMLENBQVUsU0FBVixDQUFkO0FBQ0EsY0FBSSxDQUFDLElBQUksUUFBSixDQUFhLFdBQWIsQ0FBTCxFQUFnQztBQUM5QiwwQkFBYyxVQUFVLFVBQVUsTUFBVixHQUFtQixDQUE3QixLQUFtQyxJQUFJLEVBQUosQ0FBTyxVQUFQLENBQWtCLElBQUksRUFBdEIsQ0FBakQ7QUFDRDtBQUNGLFNBTkQsTUFNTztBQUNMLHdCQUFjLElBQUksRUFBSixDQUFPLFVBQVAsQ0FBa0IsSUFBSSxFQUFKLEdBQVMsQ0FBVCxHQUFhLElBQUksRUFBSixHQUFTLENBQXRCLEdBQTBCLENBQTVDLENBQWQ7QUFDRDs7QUFFRDtBQUNBLFlBQUksaUJBQWlCLElBQUksUUFBSixDQUFhLFdBQWIsRUFBMEIsSUFBSSxZQUE5QixFQUE0QyxPQUE1QyxFQUFyQjtBQUNBLHlCQUFpQixlQUFlLE1BQWYsQ0FBc0IsSUFBSSxRQUFKLENBQWEsWUFBWSxXQUF6QixFQUFzQyxJQUFJLFlBQTFDLENBQXRCLENBQWpCOztBQUVBO0FBQ0EsWUFBSSxlQUFlLE1BQW5CLEVBQTJCO0FBQ3pCLGNBQUksT0FBTyxJQUFJLElBQUosQ0FBUyxLQUFLLElBQUwsQ0FBVSxjQUFWLENBQVQsRUFBb0MsR0FBcEMsQ0FBWDtBQUNBLGNBQUksZ0JBQUosQ0FBcUIsSUFBckIsRUFBMkIsS0FBSyxJQUFMLENBQVUsY0FBVixDQUEzQjtBQUNEOztBQUVELGVBQU8sS0FBSyxTQUFMLEVBQVA7QUFDRCxPQXZDRDs7QUF5Q0E7Ozs7OztBQU1BLFdBQUssVUFBTCxHQUFrQixVQUFVLElBQVYsRUFBZ0I7QUFDaEMsWUFBSSxNQUFNLEtBQUssc0JBQUwsR0FBOEIsY0FBOUIsRUFBVjtBQUNBLFlBQUksT0FBTyxJQUFJLFVBQUosQ0FBZSxJQUFJLGFBQUosRUFBZixFQUFvQyxJQUFJLFFBQUosQ0FBYSxJQUFiLENBQXBDLENBQVg7O0FBRUEsWUFBSSxLQUFLLFNBQVQsRUFBb0I7QUFDbEIsZUFBSyxTQUFMLENBQWUsVUFBZixDQUEwQixZQUExQixDQUF1QyxJQUF2QyxFQUE2QyxLQUFLLFNBQWxEO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsZUFBSyxTQUFMLENBQWUsV0FBZixDQUEyQixJQUEzQjtBQUNEOztBQUVELGVBQU8sSUFBUDtBQUNELE9BWEQ7O0FBYUE7OztBQUdBLFdBQUssU0FBTCxHQUFpQixVQUFVLE1BQVYsRUFBa0I7QUFDakMsWUFBSSxvQkFBb0IsRUFBRSxhQUFGLEVBQWlCLElBQWpCLENBQXNCLE1BQXRCLEVBQThCLENBQTlCLENBQXhCO0FBQ0EsWUFBSSxhQUFhLEtBQUssSUFBTCxDQUFVLGtCQUFrQixVQUE1QixDQUFqQjs7QUFFQSxZQUFJLE1BQU0sS0FBSyxzQkFBTCxHQUE4QixjQUE5QixFQUFWOztBQUVBLGVBQU8sV0FBVyxPQUFYLEdBQXFCLEdBQXJCLENBQXlCLFVBQVUsU0FBVixFQUFxQjtBQUNuRCxpQkFBTyxJQUFJLFVBQUosQ0FBZSxTQUFmLENBQVA7QUFDRCxTQUZNLEVBRUosT0FGSSxFQUFQO0FBR0QsT0FURDs7QUFXQTs7Ozs7QUFLQSxXQUFLLFFBQUwsR0FBZ0IsWUFBWTtBQUMxQixZQUFJLFlBQVksYUFBaEI7QUFDQSxlQUFPLE1BQU0saUJBQU4sR0FBMEIsVUFBVSxRQUFWLEVBQTFCLEdBQWlELFVBQVUsSUFBbEU7QUFDRCxPQUhEOztBQUtBOzs7Ozs7QUFNQSxXQUFLLFlBQUwsR0FBb0IsVUFBVSxTQUFWLEVBQXFCO0FBQ3ZDLFlBQUksV0FBVyxLQUFLLFdBQUwsRUFBZjs7QUFFQSxZQUFJLENBQUMsSUFBSSxXQUFKLENBQWdCLFFBQWhCLENBQUwsRUFBZ0M7QUFDOUIsaUJBQU8sSUFBUDtBQUNEOztBQUVELFlBQUksYUFBYSxJQUFJLGNBQUosQ0FBbUIsUUFBbkIsRUFBNkIsVUFBVSxLQUFWLEVBQWlCO0FBQzdELGlCQUFPLENBQUMsSUFBSSxXQUFKLENBQWdCLEtBQWhCLENBQVI7QUFDRCxTQUZnQixDQUFqQjs7QUFJQSxZQUFJLFNBQUosRUFBZTtBQUNiLHFCQUFXLElBQUksY0FBSixDQUFtQixRQUFuQixFQUE2QixVQUFVLEtBQVYsRUFBaUI7QUFDdkQsbUJBQU8sQ0FBQyxJQUFJLFdBQUosQ0FBZ0IsS0FBaEIsQ0FBUjtBQUNELFdBRlUsQ0FBWDtBQUdEOztBQUVELGVBQU8sSUFBSSxZQUFKLENBQ0wsV0FBVyxJQUROLEVBRUwsV0FBVyxNQUZOLEVBR0wsU0FBUyxJQUhKLEVBSUwsU0FBUyxNQUpKLENBQVA7QUFNRCxPQXZCRDs7QUF5QkE7Ozs7O0FBS0EsV0FBSyxRQUFMLEdBQWdCLFVBQVUsUUFBVixFQUFvQjtBQUNsQyxlQUFPO0FBQ0wsYUFBRztBQUNELGtCQUFNLElBQUksY0FBSixDQUFtQixRQUFuQixFQUE2QixFQUE3QixDQURMO0FBRUQsb0JBQVE7QUFGUCxXQURFO0FBS0wsYUFBRztBQUNELGtCQUFNLElBQUksY0FBSixDQUFtQixRQUFuQixFQUE2QixFQUE3QixDQURMO0FBRUQsb0JBQVE7QUFGUDtBQUxFLFNBQVA7QUFVRCxPQVhEOztBQWFBOzs7OztBQUtBLFdBQUssWUFBTCxHQUFvQixVQUFVLEtBQVYsRUFBaUI7QUFDbkMsZUFBTztBQUNMLGFBQUc7QUFDRCxrQkFBTSxLQUFLLElBQUwsQ0FBVSxJQUFJLGNBQUosQ0FBbUIsS0FBSyxJQUFMLENBQVUsS0FBVixDQUFuQixFQUFxQyxFQUFyQyxDQUFWLENBREw7QUFFRCxvQkFBUTtBQUZQLFdBREU7QUFLTCxhQUFHO0FBQ0Qsa0JBQU0sS0FBSyxJQUFMLENBQVUsSUFBSSxjQUFKLENBQW1CLEtBQUssSUFBTCxDQUFVLEtBQVYsQ0FBbkIsRUFBcUMsRUFBckMsQ0FBVixDQURMO0FBRUQsb0JBQVE7QUFGUDtBQUxFLFNBQVA7QUFVRCxPQVhEOztBQWFBOzs7O0FBSUEsV0FBSyxjQUFMLEdBQXNCLFlBQVk7QUFDaEMsWUFBSSxZQUFZLGFBQWhCO0FBQ0EsZUFBTyxVQUFVLGNBQVYsRUFBUDtBQUNELE9BSEQ7QUFJRCxLQTlmRDs7QUFnZ0JGOzs7Ozs7Ozs7Ozs7QUFZRSxXQUFPO0FBQ0w7Ozs7Ozs7OztBQVNBLGNBQVEsZ0JBQVUsRUFBVixFQUFjLEVBQWQsRUFBa0IsRUFBbEIsRUFBc0IsRUFBdEIsRUFBMEI7QUFDaEMsWUFBSSxVQUFVLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFDMUIsaUJBQU8sSUFBSSxZQUFKLENBQWlCLEVBQWpCLEVBQXFCLEVBQXJCLEVBQXlCLEVBQXpCLEVBQTZCLEVBQTdCLENBQVA7QUFDRCxTQUZELE1BRU8sSUFBSSxVQUFVLE1BQVYsS0FBcUIsQ0FBekIsRUFBNEI7QUFBRTtBQUNuQyxlQUFLLEVBQUw7QUFDQSxlQUFLLEVBQUw7QUFDQSxpQkFBTyxJQUFJLFlBQUosQ0FBaUIsRUFBakIsRUFBcUIsRUFBckIsRUFBeUIsRUFBekIsRUFBNkIsRUFBN0IsQ0FBUDtBQUNELFNBSk0sTUFJQTtBQUNMLGNBQUksZUFBZSxLQUFLLG1CQUFMLEVBQW5CO0FBQ0EsY0FBSSxDQUFDLFlBQUQsSUFBaUIsVUFBVSxNQUFWLEtBQXFCLENBQTFDLEVBQTZDO0FBQzNDLDJCQUFlLEtBQUssY0FBTCxDQUFvQixVQUFVLENBQVYsQ0FBcEIsQ0FBZjtBQUNBLG1CQUFPLGFBQWEsUUFBYixDQUFzQixJQUFJLFNBQUosS0FBa0IsVUFBVSxDQUFWLEVBQWEsU0FBckQsQ0FBUDtBQUNEO0FBQ0QsaUJBQU8sWUFBUDtBQUNEO0FBQ0YsT0F6Qkk7O0FBMkJMLDJCQUFxQiwrQkFBWTtBQUMvQixZQUFJLEVBQUosRUFBUSxFQUFSLEVBQVksRUFBWixFQUFnQixFQUFoQjtBQUNBLFlBQUksTUFBTSxpQkFBVixFQUE2QjtBQUMzQixjQUFJLFlBQVksU0FBUyxZQUFULEVBQWhCO0FBQ0EsY0FBSSxDQUFDLFNBQUQsSUFBYyxVQUFVLFVBQVYsS0FBeUIsQ0FBM0MsRUFBOEM7QUFDNUMsbUJBQU8sSUFBUDtBQUNELFdBRkQsTUFFTyxJQUFJLElBQUksTUFBSixDQUFXLFVBQVUsVUFBckIsQ0FBSixFQUFzQztBQUMzQztBQUNBO0FBQ0EsbUJBQU8sSUFBUDtBQUNEOztBQUVELGNBQUksWUFBWSxVQUFVLFVBQVYsQ0FBcUIsQ0FBckIsQ0FBaEI7QUFDQSxlQUFLLFVBQVUsY0FBZjtBQUNBLGVBQUssVUFBVSxXQUFmO0FBQ0EsZUFBSyxVQUFVLFlBQWY7QUFDQSxlQUFLLFVBQVUsU0FBZjtBQUNELFNBZkQsTUFlTztBQUFFO0FBQ1AsY0FBSSxZQUFZLFNBQVMsU0FBVCxDQUFtQixXQUFuQixFQUFoQjtBQUNBLGNBQUksZUFBZSxVQUFVLFNBQVYsRUFBbkI7QUFDQSx1QkFBYSxRQUFiLENBQXNCLEtBQXRCO0FBQ0EsY0FBSSxpQkFBaUIsU0FBckI7QUFDQSx5QkFBZSxRQUFmLENBQXdCLElBQXhCOztBQUVBLGNBQUksYUFBYSxpQkFBaUIsY0FBakIsRUFBaUMsSUFBakMsQ0FBakI7QUFBQSxjQUNBLFdBQVcsaUJBQWlCLFlBQWpCLEVBQStCLEtBQS9CLENBRFg7O0FBR0E7QUFDQSxjQUFJLElBQUksTUFBSixDQUFXLFdBQVcsSUFBdEIsS0FBK0IsSUFBSSxlQUFKLENBQW9CLFVBQXBCLENBQS9CLElBQ0EsSUFBSSxVQUFKLENBQWUsU0FBUyxJQUF4QixDQURBLElBQ2lDLElBQUksZ0JBQUosQ0FBcUIsUUFBckIsQ0FEakMsSUFFQSxTQUFTLElBQVQsQ0FBYyxXQUFkLEtBQThCLFdBQVcsSUFGN0MsRUFFbUQ7QUFDakQseUJBQWEsUUFBYjtBQUNEOztBQUVELGVBQUssV0FBVyxJQUFoQjtBQUNBLGVBQUssV0FBVyxNQUFoQjtBQUNBLGVBQUssU0FBUyxJQUFkO0FBQ0EsZUFBSyxTQUFTLE1BQWQ7QUFDRDs7QUFFRCxlQUFPLElBQUksWUFBSixDQUFpQixFQUFqQixFQUFxQixFQUFyQixFQUF5QixFQUF6QixFQUE2QixFQUE3QixDQUFQO0FBQ0QsT0FwRUk7O0FBc0VMOzs7Ozs7OztBQVFBLHNCQUFnQix3QkFBVSxJQUFWLEVBQWdCO0FBQzlCLFlBQUksS0FBSyxJQUFUO0FBQ0EsWUFBSSxLQUFLLENBQVQ7QUFDQSxZQUFJLEtBQUssSUFBVDtBQUNBLFlBQUksS0FBSyxJQUFJLFVBQUosQ0FBZSxFQUFmLENBQVQ7O0FBRUE7QUFDQSxZQUFJLElBQUksTUFBSixDQUFXLEVBQVgsQ0FBSixFQUFvQjtBQUNsQixlQUFLLElBQUksUUFBSixDQUFhLEVBQWIsRUFBaUIsTUFBakIsR0FBMEIsQ0FBL0I7QUFDQSxlQUFLLEdBQUcsVUFBUjtBQUNEO0FBQ0QsWUFBSSxJQUFJLElBQUosQ0FBUyxFQUFULENBQUosRUFBa0I7QUFDaEIsZUFBSyxJQUFJLFFBQUosQ0FBYSxFQUFiLEVBQWlCLE1BQWpCLEdBQTBCLENBQS9CO0FBQ0EsZUFBSyxHQUFHLFVBQVI7QUFDRCxTQUhELE1BR08sSUFBSSxJQUFJLE1BQUosQ0FBVyxFQUFYLENBQUosRUFBb0I7QUFDekIsZUFBSyxJQUFJLFFBQUosQ0FBYSxFQUFiLEVBQWlCLE1BQXRCO0FBQ0EsZUFBSyxHQUFHLFVBQVI7QUFDRDs7QUFFRCxlQUFPLEtBQUssTUFBTCxDQUFZLEVBQVosRUFBZ0IsRUFBaEIsRUFBb0IsRUFBcEIsRUFBd0IsRUFBeEIsQ0FBUDtBQUNELE9BbEdJOztBQW9HTDs7Ozs7O0FBTUEsNEJBQXNCLDhCQUFVLElBQVYsRUFBZ0I7QUFDcEMsZUFBTyxLQUFLLGNBQUwsQ0FBb0IsSUFBcEIsRUFBMEIsUUFBMUIsQ0FBbUMsSUFBbkMsQ0FBUDtBQUNELE9BNUdJOztBQThHTDs7Ozs7O0FBTUEsMkJBQXFCLDZCQUFVLElBQVYsRUFBZ0I7QUFDbkMsZUFBTyxLQUFLLGNBQUwsQ0FBb0IsSUFBcEIsRUFBMEIsUUFBMUIsRUFBUDtBQUNELE9BdEhJOztBQXdITDs7Ozs7Ozs7O0FBU0EsMEJBQW9CLDRCQUFVLFFBQVYsRUFBb0IsUUFBcEIsRUFBOEI7QUFDaEQsWUFBSSxLQUFLLElBQUksY0FBSixDQUFtQixRQUFuQixFQUE2QixTQUFTLENBQVQsQ0FBVyxJQUF4QyxDQUFUO0FBQ0EsWUFBSSxLQUFLLFNBQVMsQ0FBVCxDQUFXLE1BQXBCO0FBQ0EsWUFBSSxLQUFLLElBQUksY0FBSixDQUFtQixRQUFuQixFQUE2QixTQUFTLENBQVQsQ0FBVyxJQUF4QyxDQUFUO0FBQ0EsWUFBSSxLQUFLLFNBQVMsQ0FBVCxDQUFXLE1BQXBCO0FBQ0EsZUFBTyxJQUFJLFlBQUosQ0FBaUIsRUFBakIsRUFBcUIsRUFBckIsRUFBeUIsRUFBekIsRUFBNkIsRUFBN0IsQ0FBUDtBQUNELE9BdklJOztBQXlJTDs7Ozs7Ozs7O0FBU0EsOEJBQXdCLGdDQUFVLFFBQVYsRUFBb0IsS0FBcEIsRUFBMkI7QUFDakQsWUFBSSxLQUFLLFNBQVMsQ0FBVCxDQUFXLE1BQXBCO0FBQ0EsWUFBSSxLQUFLLFNBQVMsQ0FBVCxDQUFXLE1BQXBCO0FBQ0EsWUFBSSxLQUFLLElBQUksY0FBSixDQUFtQixLQUFLLElBQUwsQ0FBVSxLQUFWLENBQW5CLEVBQXFDLFNBQVMsQ0FBVCxDQUFXLElBQWhELENBQVQ7QUFDQSxZQUFJLEtBQUssSUFBSSxjQUFKLENBQW1CLEtBQUssSUFBTCxDQUFVLEtBQVYsQ0FBbkIsRUFBcUMsU0FBUyxDQUFULENBQVcsSUFBaEQsQ0FBVDs7QUFFQSxlQUFPLElBQUksWUFBSixDQUFpQixFQUFqQixFQUFxQixFQUFyQixFQUF5QixFQUF6QixFQUE2QixFQUE3QixDQUFQO0FBQ0Q7QUF6SkksS0FBUDtBQTJKRCxHQXZ4QlcsRUFBWjs7QUF5eEJBOzs7Ozs7OztBQVFBLE1BQUksUUFBUyxZQUFZO0FBQ3ZCOzs7Ozs7OztBQVFBLFFBQUksb0JBQW9CLFNBQXBCLGlCQUFvQixDQUFVLElBQVYsRUFBZ0I7QUFDdEMsYUFBTyxFQUFFLFFBQUYsQ0FBVyxVQUFVLFFBQVYsRUFBb0I7QUFDcEMsVUFBRSxNQUFGLENBQVMsSUFBSSxVQUFKLEVBQVQsRUFBMkI7QUFDekIsa0JBQVEsZ0JBQVUsQ0FBVixFQUFhO0FBQ25CLGdCQUFJLFVBQVUsRUFBRSxNQUFGLENBQVMsTUFBdkI7QUFDQSxxQkFBUyxPQUFULENBQWlCLE9BQWpCO0FBQ0QsV0FKd0I7QUFLekIsbUJBQVMsbUJBQVk7QUFDbkIscUJBQVMsTUFBVCxDQUFnQixJQUFoQjtBQUNEO0FBUHdCLFNBQTNCLEVBUUcsYUFSSCxDQVFpQixJQVJqQjtBQVNELE9BVk0sRUFVSixPQVZJLEVBQVA7QUFXRCxLQVpEOztBQWNBOzs7Ozs7OztBQVFBLFFBQUksY0FBYyxTQUFkLFdBQWMsQ0FBVSxHQUFWLEVBQWU7QUFDL0IsYUFBTyxFQUFFLFFBQUYsQ0FBVyxVQUFVLFFBQVYsRUFBb0I7QUFDcEMsWUFBSSxPQUFPLEVBQUUsT0FBRixDQUFYOztBQUVBLGFBQUssR0FBTCxDQUFTLE1BQVQsRUFBaUIsWUFBWTtBQUMzQixlQUFLLEdBQUwsQ0FBUyxhQUFUO0FBQ0EsbUJBQVMsT0FBVCxDQUFpQixJQUFqQjtBQUNELFNBSEQsRUFHRyxHQUhILENBR08sYUFIUCxFQUdzQixZQUFZO0FBQ2hDLGVBQUssR0FBTCxDQUFTLE1BQVQsRUFBaUIsTUFBakI7QUFDQSxtQkFBUyxNQUFULENBQWdCLElBQWhCO0FBQ0QsU0FORCxFQU1HLEdBTkgsQ0FNTztBQUNMLG1CQUFTO0FBREosU0FOUCxFQVFHLFFBUkgsQ0FRWSxTQUFTLElBUnJCLEVBUTJCLElBUjNCLENBUWdDLEtBUmhDLEVBUXVDLEdBUnZDO0FBU0QsT0FaTSxFQVlKLE9BWkksRUFBUDtBQWFELEtBZEQ7O0FBZ0JBLFdBQU87QUFDTCx5QkFBbUIsaUJBRGQ7QUFFTCxtQkFBYTtBQUZSLEtBQVA7QUFJRCxHQW5EVyxFQUFaOztBQXFEQTs7Ozs7O0FBTUEsTUFBSSxVQUFVLFNBQVYsT0FBVSxDQUFVLFNBQVYsRUFBcUI7QUFDakMsUUFBSSxRQUFRLEVBQVo7QUFBQSxRQUFnQixjQUFjLENBQUMsQ0FBL0I7QUFDQSxRQUFJLFdBQVcsVUFBVSxDQUFWLENBQWY7O0FBRUEsUUFBSSxlQUFlLFNBQWYsWUFBZSxHQUFZO0FBQzdCLFVBQUksTUFBTSxNQUFNLE1BQU4sQ0FBYSxRQUFiLENBQVY7QUFDQSxVQUFJLGdCQUFnQixFQUFDLEdBQUcsRUFBQyxNQUFNLEVBQVAsRUFBVyxRQUFRLENBQW5CLEVBQUosRUFBMkIsR0FBRyxFQUFDLE1BQU0sRUFBUCxFQUFXLFFBQVEsQ0FBbkIsRUFBOUIsRUFBcEI7O0FBRUEsYUFBTztBQUNMLGtCQUFVLFVBQVUsSUFBVixFQURMO0FBRUwsa0JBQVcsTUFBTSxJQUFJLFFBQUosQ0FBYSxRQUFiLENBQU4sR0FBK0I7QUFGckMsT0FBUDtBQUlELEtBUkQ7O0FBVUEsUUFBSSxnQkFBZ0IsU0FBaEIsYUFBZ0IsQ0FBVSxRQUFWLEVBQW9CO0FBQ3RDLFVBQUksU0FBUyxRQUFULEtBQXNCLElBQTFCLEVBQWdDO0FBQzlCLGtCQUFVLElBQVYsQ0FBZSxTQUFTLFFBQXhCO0FBQ0Q7QUFDRCxVQUFJLFNBQVMsUUFBVCxLQUFzQixJQUExQixFQUFnQztBQUM5QixjQUFNLGtCQUFOLENBQXlCLFFBQXpCLEVBQW1DLFNBQVMsUUFBNUMsRUFBc0QsTUFBdEQ7QUFDRDtBQUNGLEtBUEQ7O0FBU0E7Ozs7O0FBS0EsU0FBSyxNQUFMLEdBQWMsWUFBWTtBQUN4QjtBQUNBLFVBQUksVUFBVSxJQUFWLE9BQXFCLE1BQU0sV0FBTixFQUFtQixRQUE1QyxFQUFzRDtBQUNwRCxhQUFLLFVBQUw7QUFDRDs7QUFFRDtBQUNBLG9CQUFjLENBQWQ7O0FBRUE7QUFDQSxvQkFBYyxNQUFNLFdBQU4sQ0FBZDtBQUNELEtBWEQ7O0FBYUE7Ozs7QUFJQSxTQUFLLEtBQUwsR0FBYSxZQUFZO0FBQ3ZCO0FBQ0EsY0FBUSxFQUFSOztBQUVBO0FBQ0Esb0JBQWMsQ0FBQyxDQUFmOztBQUVBO0FBQ0EsZ0JBQVUsSUFBVixDQUFlLEVBQWY7O0FBRUE7QUFDQSxXQUFLLFVBQUw7QUFDRCxLQVpEOztBQWNBOzs7QUFHQSxTQUFLLElBQUwsR0FBWSxZQUFZO0FBQ3RCO0FBQ0EsVUFBSSxVQUFVLElBQVYsT0FBcUIsTUFBTSxXQUFOLEVBQW1CLFFBQTVDLEVBQXNEO0FBQ3BELGFBQUssVUFBTDtBQUNEOztBQUVELFVBQUksSUFBSSxXQUFSLEVBQXFCO0FBQ25CO0FBQ0Esc0JBQWMsTUFBTSxXQUFOLENBQWQ7QUFDRDtBQUNGLEtBVkQ7O0FBWUE7OztBQUdBLFNBQUssSUFBTCxHQUFZLFlBQVk7QUFDdEIsVUFBSSxNQUFNLE1BQU4sR0FBZSxDQUFmLEdBQW1CLFdBQXZCLEVBQW9DO0FBQ2xDO0FBQ0Esc0JBQWMsTUFBTSxXQUFOLENBQWQ7QUFDRDtBQUNGLEtBTEQ7O0FBT0E7OztBQUdBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCOztBQUVBO0FBQ0EsVUFBSSxNQUFNLE1BQU4sR0FBZSxXQUFuQixFQUFnQztBQUM5QixnQkFBUSxNQUFNLEtBQU4sQ0FBWSxDQUFaLEVBQWUsV0FBZixDQUFSO0FBQ0Q7O0FBRUQ7QUFDQSxZQUFNLElBQU4sQ0FBVyxjQUFYO0FBQ0QsS0FWRDtBQVdELEdBbEdEOztBQW9HQTs7Ozs7O0FBTUEsTUFBSSxRQUFRLFNBQVIsS0FBUSxHQUFZO0FBQ3RCOzs7Ozs7Ozs7Ozs7O0FBYUEsUUFBSSxZQUFZLFNBQVosU0FBWSxDQUFVLElBQVYsRUFBZ0IsYUFBaEIsRUFBK0I7QUFDN0MsVUFBSSxNQUFNLGFBQU4sR0FBc0IsR0FBMUIsRUFBK0I7QUFDN0IsWUFBSSxTQUFTLEVBQWI7QUFDQSxVQUFFLElBQUYsQ0FBTyxhQUFQLEVBQXNCLFVBQVUsR0FBVixFQUFlLFlBQWYsRUFBNkI7QUFDakQsaUJBQU8sWUFBUCxJQUF1QixLQUFLLEdBQUwsQ0FBUyxZQUFULENBQXZCO0FBQ0QsU0FGRDtBQUdBLGVBQU8sTUFBUDtBQUNEO0FBQ0QsYUFBTyxLQUFLLEdBQUwsQ0FBUyxJQUFULENBQWMsSUFBZCxFQUFvQixhQUFwQixDQUFQO0FBQ0QsS0FURDs7QUFXQTs7Ozs7O0FBTUEsU0FBSyxRQUFMLEdBQWdCLFVBQVUsS0FBVixFQUFpQjtBQUMvQixVQUFJLGFBQWEsQ0FBQyxhQUFELEVBQWdCLFdBQWhCLEVBQTZCLFlBQTdCLEVBQTJDLGlCQUEzQyxFQUE4RCxhQUE5RCxDQUFqQjtBQUNBLFVBQUksWUFBWSxVQUFVLEtBQVYsRUFBaUIsVUFBakIsS0FBZ0MsRUFBaEQ7QUFDQSxnQkFBVSxXQUFWLElBQXlCLFNBQVMsVUFBVSxXQUFWLENBQVQsRUFBaUMsRUFBakMsQ0FBekI7QUFDQSxhQUFPLFNBQVA7QUFDRCxLQUxEOztBQU9BOzs7Ozs7QUFNQSxTQUFLLFNBQUwsR0FBaUIsVUFBVSxHQUFWLEVBQWUsU0FBZixFQUEwQjtBQUN6QyxRQUFFLElBQUYsQ0FBTyxJQUFJLEtBQUosQ0FBVSxJQUFJLE1BQWQsRUFBc0I7QUFDM0IseUJBQWlCO0FBRFUsT0FBdEIsQ0FBUCxFQUVJLFVBQVUsR0FBVixFQUFlLElBQWYsRUFBcUI7QUFDdkIsVUFBRSxJQUFGLEVBQVEsR0FBUixDQUFZLFNBQVo7QUFDRCxPQUpEO0FBS0QsS0FORDs7QUFRQTs7Ozs7Ozs7OztBQVVBLFNBQUssVUFBTCxHQUFrQixVQUFVLEdBQVYsRUFBZSxPQUFmLEVBQXdCO0FBQ3hDLFlBQU0sSUFBSSxTQUFKLEVBQU47O0FBRUEsVUFBSSxXQUFXLFdBQVcsUUFBUSxRQUFuQixJQUErQixNQUE5QztBQUNBLFVBQUksdUJBQXVCLENBQUMsRUFBRSxXQUFXLFFBQVEsb0JBQXJCLENBQTVCO0FBQ0EsVUFBSSxzQkFBc0IsQ0FBQyxFQUFFLFdBQVcsUUFBUSxtQkFBckIsQ0FBM0I7O0FBRUEsVUFBSSxJQUFJLFdBQUosRUFBSixFQUF1QjtBQUNyQixlQUFPLENBQUMsSUFBSSxVQUFKLENBQWUsSUFBSSxNQUFKLENBQVcsUUFBWCxDQUFmLENBQUQsQ0FBUDtBQUNEOztBQUVELFVBQUksT0FBTyxJQUFJLGtCQUFKLENBQXVCLFFBQXZCLENBQVg7QUFDQSxVQUFJLFFBQVEsSUFBSSxLQUFKLENBQVUsSUFBSSxNQUFkLEVBQXNCO0FBQ2hDLHVCQUFlO0FBRGlCLE9BQXRCLEVBRVQsR0FGUyxDQUVMLFVBQVUsSUFBVixFQUFnQjtBQUNyQixlQUFPLElBQUksbUJBQUosQ0FBd0IsSUFBeEIsRUFBOEIsSUFBOUIsS0FBdUMsSUFBSSxJQUFKLENBQVMsSUFBVCxFQUFlLFFBQWYsQ0FBOUM7QUFDRCxPQUpXLENBQVo7O0FBTUEsVUFBSSxvQkFBSixFQUEwQjtBQUN4QixZQUFJLG1CQUFKLEVBQXlCO0FBQ3ZCLGNBQUksZUFBZSxJQUFJLEtBQUosRUFBbkI7QUFDQTtBQUNBLGlCQUFPLEtBQUssR0FBTCxDQUFTLElBQVQsRUFBZSxVQUFVLElBQVYsRUFBZ0I7QUFDcEMsbUJBQU8sS0FBSyxRQUFMLENBQWMsWUFBZCxFQUE0QixJQUE1QixDQUFQO0FBQ0QsV0FGTSxDQUFQO0FBR0Q7O0FBRUQsZUFBTyxNQUFNLEdBQU4sQ0FBVSxVQUFVLElBQVYsRUFBZ0I7QUFDL0IsY0FBSSxXQUFXLElBQUksbUJBQUosQ0FBd0IsSUFBeEIsRUFBOEIsSUFBOUIsQ0FBZjtBQUNBLGNBQUksT0FBTyxLQUFLLElBQUwsQ0FBVSxRQUFWLENBQVg7QUFDQSxjQUFJLFFBQVEsS0FBSyxJQUFMLENBQVUsUUFBVixDQUFaO0FBQ0EsWUFBRSxJQUFGLENBQU8sS0FBUCxFQUFjLFVBQVUsR0FBVixFQUFlLElBQWYsRUFBcUI7QUFDakMsZ0JBQUksZ0JBQUosQ0FBcUIsSUFBckIsRUFBMkIsS0FBSyxVQUFoQztBQUNBLGdCQUFJLE1BQUosQ0FBVyxJQUFYO0FBQ0QsV0FIRDtBQUlBLGlCQUFPLEtBQUssSUFBTCxDQUFVLFFBQVYsQ0FBUDtBQUNELFNBVE0sQ0FBUDtBQVVELE9BbkJELE1BbUJPO0FBQ0wsZUFBTyxLQUFQO0FBQ0Q7QUFDRixLQXhDRDs7QUEwQ0E7Ozs7OztBQU1BLFNBQUssT0FBTCxHQUFlLFVBQVUsR0FBVixFQUFlO0FBQzVCLFVBQUksUUFBUSxFQUFFLENBQUMsSUFBSSxTQUFKLENBQWMsSUFBSSxFQUFsQixDQUFELEdBQXlCLElBQUksRUFBSixDQUFPLFVBQWhDLEdBQTZDLElBQUksRUFBbkQsQ0FBWjtBQUNBLFVBQUksWUFBWSxLQUFLLFFBQUwsQ0FBYyxLQUFkLENBQWhCOztBQUVBO0FBQ0E7QUFDQSxVQUFJO0FBQ0Ysb0JBQVksRUFBRSxNQUFGLENBQVMsU0FBVCxFQUFvQjtBQUM5Qix1QkFBYSxTQUFTLGlCQUFULENBQTJCLE1BQTNCLElBQXFDLE1BQXJDLEdBQThDLFFBRDdCO0FBRTlCLHlCQUFlLFNBQVMsaUJBQVQsQ0FBMkIsUUFBM0IsSUFBdUMsUUFBdkMsR0FBa0QsUUFGbkM7QUFHOUIsNEJBQWtCLFNBQVMsaUJBQVQsQ0FBMkIsV0FBM0IsSUFBMEMsV0FBMUMsR0FBd0QsUUFINUM7QUFJOUIsNEJBQWtCLFNBQVMsaUJBQVQsQ0FBMkIsV0FBM0IsSUFBMEMsV0FBMUMsR0FBd0QsUUFKNUM7QUFLOUIsOEJBQW9CLFNBQVMsaUJBQVQsQ0FBMkIsYUFBM0IsSUFBNEMsYUFBNUMsR0FBNEQsUUFMbEQ7QUFNOUIsZ0NBQXNCLFNBQVMsaUJBQVQsQ0FBMkIsZUFBM0IsSUFBOEMsZUFBOUMsR0FBZ0U7QUFOeEQsU0FBcEIsQ0FBWjtBQVFELE9BVEQsQ0FTRSxPQUFPLENBQVAsRUFBVSxDQUFFOztBQUVkO0FBQ0EsVUFBSSxDQUFDLElBQUksUUFBSixFQUFMLEVBQXFCO0FBQ25CLGtCQUFVLFlBQVYsSUFBMEIsTUFBMUI7QUFDRCxPQUZELE1BRU87QUFDTCxZQUFJLGVBQWUsQ0FBQyxRQUFELEVBQVcsTUFBWCxFQUFtQixtQkFBbkIsRUFBd0MsUUFBeEMsQ0FBbkI7QUFDQSxZQUFJLGNBQWMsRUFBRSxPQUFGLENBQVUsVUFBVSxpQkFBVixDQUFWLEVBQXdDLFlBQXhDLElBQXdELENBQUMsQ0FBM0U7QUFDQSxrQkFBVSxZQUFWLElBQTBCLGNBQWMsV0FBZCxHQUE0QixTQUF0RDtBQUNEOztBQUVELFVBQUksT0FBTyxJQUFJLFFBQUosQ0FBYSxJQUFJLEVBQWpCLEVBQXFCLElBQUksTUFBekIsQ0FBWDtBQUNBLFVBQUksUUFBUSxLQUFLLEtBQUwsQ0FBVyxhQUFYLENBQVosRUFBdUM7QUFDckMsa0JBQVUsYUFBVixJQUEyQixLQUFLLEtBQUwsQ0FBVyxVQUF0QztBQUNELE9BRkQsTUFFTztBQUNMLFlBQUksYUFBYSxTQUFTLFVBQVUsYUFBVixDQUFULEVBQW1DLEVBQW5DLElBQXlDLFNBQVMsVUFBVSxXQUFWLENBQVQsRUFBaUMsRUFBakMsQ0FBMUQ7QUFDQSxrQkFBVSxhQUFWLElBQTJCLFdBQVcsT0FBWCxDQUFtQixDQUFuQixDQUEzQjtBQUNEOztBQUVELGdCQUFVLE1BQVYsR0FBbUIsSUFBSSxVQUFKLE1BQW9CLElBQUksUUFBSixDQUFhLElBQUksRUFBakIsRUFBcUIsSUFBSSxRQUF6QixDQUF2QztBQUNBLGdCQUFVLFNBQVYsR0FBc0IsSUFBSSxZQUFKLENBQWlCLElBQUksRUFBckIsRUFBeUIsSUFBSSxVQUE3QixDQUF0QjtBQUNBLGdCQUFVLEtBQVYsR0FBa0IsR0FBbEI7O0FBRUEsYUFBTyxTQUFQO0FBQ0QsS0F2Q0Q7QUF3Q0QsR0F0SkQ7O0FBeUpBOzs7OztBQUtBLE1BQUksU0FBUyxTQUFULE1BQVMsR0FBWTtBQUN2QixRQUFJLE9BQU8sSUFBWDs7QUFFQTs7O0FBR0EsU0FBSyxpQkFBTCxHQUF5QixVQUFVLFFBQVYsRUFBb0I7QUFDM0MsV0FBSyxVQUFMLENBQWdCLElBQWhCLEVBQXNCLFFBQXRCO0FBQ0QsS0FGRDs7QUFJQTs7O0FBR0EsU0FBSyxtQkFBTCxHQUEyQixVQUFVLFFBQVYsRUFBb0I7QUFDN0MsV0FBSyxVQUFMLENBQWdCLElBQWhCLEVBQXNCLFFBQXRCO0FBQ0QsS0FGRDs7QUFJQTs7O0FBR0EsU0FBSyxNQUFMLEdBQWMsVUFBVSxRQUFWLEVBQW9CO0FBQ2hDLFVBQUksT0FBTyxJQUFYO0FBQ0EsVUFBSSxNQUFNLE1BQU0sTUFBTixDQUFhLFFBQWIsRUFBdUIsc0JBQXZCLEVBQVY7O0FBRUEsVUFBSSxRQUFRLElBQUksS0FBSixDQUFVLElBQUksTUFBZCxFQUFzQixFQUFFLGlCQUFpQixJQUFuQixFQUF0QixDQUFaO0FBQ0EsVUFBSSxhQUFhLEtBQUssU0FBTCxDQUFlLEtBQWYsRUFBc0IsS0FBSyxJQUFMLENBQVUsWUFBVixDQUF0QixDQUFqQjs7QUFFQSxRQUFFLElBQUYsQ0FBTyxVQUFQLEVBQW1CLFVBQVUsR0FBVixFQUFlLEtBQWYsRUFBc0I7QUFDdkMsWUFBSSxPQUFPLEtBQUssSUFBTCxDQUFVLEtBQVYsQ0FBWDtBQUNBLFlBQUksSUFBSSxJQUFKLENBQVMsSUFBVCxDQUFKLEVBQW9CO0FBQ2xCLGVBQUssUUFBTCxDQUFjLEtBQWQsRUFBcUIsS0FBSyxVQUFMLENBQWdCLFFBQXJDO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsWUFBRSxJQUFGLENBQU8sS0FBUCxFQUFjLFVBQVUsR0FBVixFQUFlLElBQWYsRUFBcUI7QUFDakMsY0FBRSxJQUFGLEVBQVEsR0FBUixDQUFZLFlBQVosRUFBMEIsVUFBVSxHQUFWLEVBQWUsR0FBZixFQUFvQjtBQUM1QyxxQkFBTyxDQUFDLFNBQVMsR0FBVCxFQUFjLEVBQWQsS0FBcUIsQ0FBdEIsSUFBMkIsRUFBbEM7QUFDRCxhQUZEO0FBR0QsV0FKRDtBQUtEO0FBQ0YsT0FYRDs7QUFhQSxVQUFJLE1BQUo7QUFDRCxLQXJCRDs7QUF1QkE7OztBQUdBLFNBQUssT0FBTCxHQUFlLFVBQVUsUUFBVixFQUFvQjtBQUNqQyxVQUFJLE9BQU8sSUFBWDtBQUNBLFVBQUksTUFBTSxNQUFNLE1BQU4sQ0FBYSxRQUFiLEVBQXVCLHNCQUF2QixFQUFWOztBQUVBLFVBQUksUUFBUSxJQUFJLEtBQUosQ0FBVSxJQUFJLE1BQWQsRUFBc0IsRUFBRSxpQkFBaUIsSUFBbkIsRUFBdEIsQ0FBWjtBQUNBLFVBQUksYUFBYSxLQUFLLFNBQUwsQ0FBZSxLQUFmLEVBQXNCLEtBQUssSUFBTCxDQUFVLFlBQVYsQ0FBdEIsQ0FBakI7O0FBRUEsUUFBRSxJQUFGLENBQU8sVUFBUCxFQUFtQixVQUFVLEdBQVYsRUFBZSxLQUFmLEVBQXNCO0FBQ3ZDLFlBQUksT0FBTyxLQUFLLElBQUwsQ0FBVSxLQUFWLENBQVg7QUFDQSxZQUFJLElBQUksSUFBSixDQUFTLElBQVQsQ0FBSixFQUFvQjtBQUNsQixlQUFLLFdBQUwsQ0FBaUIsQ0FBQyxLQUFELENBQWpCO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsWUFBRSxJQUFGLENBQU8sS0FBUCxFQUFjLFVBQVUsR0FBVixFQUFlLElBQWYsRUFBcUI7QUFDakMsY0FBRSxJQUFGLEVBQVEsR0FBUixDQUFZLFlBQVosRUFBMEIsVUFBVSxHQUFWLEVBQWUsR0FBZixFQUFvQjtBQUM1QyxvQkFBTyxTQUFTLEdBQVQsRUFBYyxFQUFkLEtBQXFCLENBQTVCO0FBQ0EscUJBQU8sTUFBTSxFQUFOLEdBQVcsTUFBTSxFQUFqQixHQUFzQixFQUE3QjtBQUNELGFBSEQ7QUFJRCxXQUxEO0FBTUQ7QUFDRixPQVpEOztBQWNBLFVBQUksTUFBSjtBQUNELEtBdEJEOztBQXdCQTs7Ozs7QUFLQSxTQUFLLFVBQUwsR0FBa0IsVUFBVSxRQUFWLEVBQW9CLFFBQXBCLEVBQThCO0FBQzlDLFVBQUksTUFBTSxNQUFNLE1BQU4sQ0FBYSxRQUFiLEVBQXVCLHNCQUF2QixFQUFWOztBQUVBLFVBQUksUUFBUSxJQUFJLEtBQUosQ0FBVSxJQUFJLE1BQWQsRUFBc0IsRUFBRSxpQkFBaUIsSUFBbkIsRUFBdEIsQ0FBWjtBQUNBLFVBQUksV0FBVyxJQUFJLFlBQUosQ0FBaUIsS0FBakIsQ0FBZjtBQUNBLFVBQUksYUFBYSxLQUFLLFNBQUwsQ0FBZSxLQUFmLEVBQXNCLEtBQUssSUFBTCxDQUFVLFlBQVYsQ0FBdEIsQ0FBakI7O0FBRUE7QUFDQSxVQUFJLEtBQUssSUFBTCxDQUFVLEtBQVYsRUFBaUIsSUFBSSxVQUFyQixDQUFKLEVBQXNDO0FBQ3BDLFlBQUksZUFBZSxFQUFuQjtBQUNBLFVBQUUsSUFBRixDQUFPLFVBQVAsRUFBbUIsVUFBVSxHQUFWLEVBQWUsS0FBZixFQUFzQjtBQUN2Qyx5QkFBZSxhQUFhLE1BQWIsQ0FBb0IsS0FBSyxRQUFMLENBQWMsS0FBZCxFQUFxQixRQUFyQixDQUFwQixDQUFmO0FBQ0QsU0FGRDtBQUdBLGdCQUFRLFlBQVI7QUFDRjtBQUNDLE9BUEQsTUFPTztBQUNMLFlBQUksWUFBWSxJQUFJLEtBQUosQ0FBVSxJQUFJLE1BQWQsRUFBc0I7QUFDcEMsMkJBQWlCO0FBRG1CLFNBQXRCLEVBRWIsTUFGYSxDQUVOLFVBQVUsUUFBVixFQUFvQjtBQUM1QixpQkFBTyxDQUFDLEVBQUUsUUFBRixDQUFXLFFBQVgsRUFBcUIsUUFBckIsQ0FBUjtBQUNELFNBSmUsQ0FBaEI7O0FBTUEsWUFBSSxVQUFVLE1BQWQsRUFBc0I7QUFDcEIsWUFBRSxJQUFGLENBQU8sU0FBUCxFQUFrQixVQUFVLEdBQVYsRUFBZSxRQUFmLEVBQXlCO0FBQ3pDLGdCQUFJLE9BQUosQ0FBWSxRQUFaLEVBQXNCLFFBQXRCO0FBQ0QsV0FGRDtBQUdELFNBSkQsTUFJTztBQUNMLGtCQUFRLEtBQUssV0FBTCxDQUFpQixVQUFqQixFQUE2QixJQUE3QixDQUFSO0FBQ0Q7QUFDRjs7QUFFRCxZQUFNLHNCQUFOLENBQTZCLFFBQTdCLEVBQXVDLEtBQXZDLEVBQThDLE1BQTlDO0FBQ0QsS0FoQ0Q7O0FBa0NBOzs7OztBQUtBLFNBQUssUUFBTCxHQUFnQixVQUFVLEtBQVYsRUFBaUIsUUFBakIsRUFBMkI7QUFDekMsVUFBSSxPQUFPLEtBQUssSUFBTCxDQUFVLEtBQVYsQ0FBWDtBQUNBLFVBQUksT0FBTyxLQUFLLElBQUwsQ0FBVSxLQUFWLENBQVg7O0FBRUEsVUFBSSxXQUFXLElBQUksTUFBSixDQUFXLEtBQUssZUFBaEIsS0FBb0MsS0FBSyxlQUF4RDtBQUNBLFVBQUksV0FBVyxJQUFJLE1BQUosQ0FBVyxLQUFLLFdBQWhCLEtBQWdDLEtBQUssV0FBcEQ7O0FBRUEsVUFBSSxXQUFXLFlBQVksSUFBSSxXQUFKLENBQWdCLElBQUksTUFBSixDQUFXLFlBQVksSUFBdkIsQ0FBaEIsRUFBOEMsSUFBOUMsQ0FBM0I7O0FBRUE7QUFDQSxjQUFRLE1BQU0sR0FBTixDQUFVLFVBQVUsSUFBVixFQUFnQjtBQUNoQyxlQUFPLElBQUksVUFBSixDQUFlLElBQWYsSUFBdUIsSUFBSSxPQUFKLENBQVksSUFBWixFQUFrQixJQUFsQixDQUF2QixHQUFpRCxJQUF4RDtBQUNELE9BRk8sQ0FBUjs7QUFJQTtBQUNBLFVBQUksZ0JBQUosQ0FBcUIsUUFBckIsRUFBK0IsS0FBL0I7O0FBRUEsVUFBSSxRQUFKLEVBQWM7QUFDWixZQUFJLGdCQUFKLENBQXFCLFFBQXJCLEVBQStCLEtBQUssSUFBTCxDQUFVLFNBQVMsVUFBbkIsQ0FBL0I7QUFDQSxZQUFJLE1BQUosQ0FBVyxRQUFYO0FBQ0Q7O0FBRUQsYUFBTyxLQUFQO0FBQ0QsS0F2QkQ7O0FBeUJBOzs7Ozs7O0FBT0EsU0FBSyxXQUFMLEdBQW1CLFVBQVUsVUFBVixFQUFzQixlQUF0QixFQUF1QztBQUN4RCxVQUFJLGdCQUFnQixFQUFwQjs7QUFFQSxRQUFFLElBQUYsQ0FBTyxVQUFQLEVBQW1CLFVBQVUsR0FBVixFQUFlLEtBQWYsRUFBc0I7QUFDdkMsWUFBSSxPQUFPLEtBQUssSUFBTCxDQUFVLEtBQVYsQ0FBWDtBQUNBLFlBQUksT0FBTyxLQUFLLElBQUwsQ0FBVSxLQUFWLENBQVg7O0FBRUEsWUFBSSxXQUFXLGtCQUFrQixJQUFJLFlBQUosQ0FBaUIsSUFBakIsRUFBdUIsSUFBSSxNQUEzQixDQUFsQixHQUNrQixLQUFLLFVBRHRDO0FBRUEsWUFBSSxXQUFXLFNBQVMsVUFBVCxDQUFvQixNQUFwQixHQUE2QixDQUE3QixHQUFpQyxJQUFJLFNBQUosQ0FBYyxRQUFkLEVBQXdCO0FBQ3RFLGdCQUFNLEtBQUssVUFEMkQ7QUFFdEUsa0JBQVEsSUFBSSxRQUFKLENBQWEsSUFBYixJQUFxQjtBQUZ5QyxTQUF4QixFQUc3QztBQUNELGtDQUF3QjtBQUR2QixTQUg2QyxDQUFqQyxHQUtWLElBTEw7O0FBT0EsWUFBSSxhQUFhLElBQUksU0FBSixDQUFjLFFBQWQsRUFBd0I7QUFDdkMsZ0JBQU0sS0FBSyxVQUQ0QjtBQUV2QyxrQkFBUSxJQUFJLFFBQUosQ0FBYSxJQUFiO0FBRitCLFNBQXhCLEVBR2Q7QUFDRCxrQ0FBd0I7QUFEdkIsU0FIYyxDQUFqQjs7QUFPQSxnQkFBUSxrQkFBa0IsSUFBSSxjQUFKLENBQW1CLFVBQW5CLEVBQStCLElBQUksSUFBbkMsQ0FBbEIsR0FDa0IsS0FBSyxJQUFMLENBQVUsV0FBVyxVQUFyQixFQUFpQyxNQUFqQyxDQUF3QyxJQUFJLElBQTVDLENBRDFCOztBQUdBO0FBQ0EsWUFBSSxtQkFBbUIsQ0FBQyxJQUFJLE1BQUosQ0FBVyxTQUFTLFVBQXBCLENBQXhCLEVBQXlEO0FBQ3ZELGtCQUFRLE1BQU0sR0FBTixDQUFVLFVBQVUsSUFBVixFQUFnQjtBQUNoQyxtQkFBTyxJQUFJLE9BQUosQ0FBWSxJQUFaLEVBQWtCLEdBQWxCLENBQVA7QUFDRCxXQUZPLENBQVI7QUFHRDs7QUFFRCxVQUFFLElBQUYsQ0FBTyxLQUFLLElBQUwsQ0FBVSxLQUFWLEVBQWlCLE9BQWpCLEVBQVAsRUFBbUMsVUFBVSxHQUFWLEVBQWUsSUFBZixFQUFxQjtBQUN0RCxjQUFJLFdBQUosQ0FBZ0IsSUFBaEIsRUFBc0IsUUFBdEI7QUFDRCxTQUZEOztBQUlBO0FBQ0EsWUFBSSxZQUFZLEtBQUssT0FBTCxDQUFhLENBQUMsUUFBRCxFQUFXLFVBQVgsRUFBdUIsUUFBdkIsQ0FBYixDQUFoQjtBQUNBLFVBQUUsSUFBRixDQUFPLFNBQVAsRUFBa0IsVUFBVSxHQUFWLEVBQWUsUUFBZixFQUF5QjtBQUN6QyxjQUFJLFlBQVksQ0FBQyxRQUFELEVBQVcsTUFBWCxDQUFrQixJQUFJLGNBQUosQ0FBbUIsUUFBbkIsRUFBNkIsSUFBSSxNQUFqQyxDQUFsQixDQUFoQjtBQUNBLFlBQUUsSUFBRixDQUFPLFVBQVUsT0FBVixFQUFQLEVBQTRCLFVBQVUsR0FBVixFQUFlLFFBQWYsRUFBeUI7QUFDbkQsZ0JBQUksQ0FBQyxJQUFJLFVBQUosQ0FBZSxRQUFmLENBQUwsRUFBK0I7QUFDN0Isa0JBQUksTUFBSixDQUFXLFFBQVgsRUFBcUIsSUFBckI7QUFDRDtBQUNGLFdBSkQ7QUFLRCxTQVBEOztBQVNBLHdCQUFnQixjQUFjLE1BQWQsQ0FBcUIsS0FBckIsQ0FBaEI7QUFDRCxPQTlDRDs7QUFnREEsYUFBTyxhQUFQO0FBQ0QsS0FwREQ7QUFxREQsR0F2TUQ7O0FBME1BOzs7Ozs7QUFNQSxNQUFJLFNBQVMsU0FBVCxNQUFTLEdBQVk7O0FBRXZCO0FBQ0EsUUFBSSxTQUFTLElBQUksTUFBSixFQUFiOztBQUVBOzs7Ozs7QUFNQSxTQUFLLFNBQUwsR0FBaUIsVUFBVSxHQUFWLEVBQWUsT0FBZixFQUF3QjtBQUN2QyxVQUFJLE1BQU0sSUFBSSxVQUFKLENBQWUsSUFBSSxLQUFKLENBQVUsVUFBVSxDQUFwQixFQUF1QixJQUF2QixDQUE0QixJQUFJLFNBQWhDLENBQWYsQ0FBVjtBQUNBLFlBQU0sSUFBSSxjQUFKLEVBQU47QUFDQSxVQUFJLFVBQUosQ0FBZSxHQUFmLEVBQW9CLElBQXBCOztBQUVBLFlBQU0sTUFBTSxNQUFOLENBQWEsR0FBYixFQUFrQixPQUFsQixDQUFOO0FBQ0EsVUFBSSxNQUFKO0FBQ0QsS0FQRDs7QUFTQTs7O0FBR0EsU0FBSyxlQUFMLEdBQXVCLFVBQVUsUUFBVixFQUFvQjtBQUN6QyxVQUFJLE1BQU0sTUFBTSxNQUFOLENBQWEsUUFBYixDQUFWOztBQUVBO0FBQ0EsWUFBTSxJQUFJLGNBQUosRUFBTjs7QUFFQTtBQUNBLFlBQU0sSUFBSSxzQkFBSixFQUFOOztBQUVBO0FBQ0EsVUFBSSxZQUFZLElBQUksUUFBSixDQUFhLElBQUksRUFBakIsRUFBcUIsSUFBSSxNQUF6QixDQUFoQjs7QUFFQSxVQUFJLFFBQUo7QUFDQTtBQUNBLFVBQUksU0FBSixFQUFlO0FBQ2I7QUFDQSxZQUFJLElBQUksT0FBSixDQUFZLFNBQVosS0FBMEIsSUFBSSxJQUFKLENBQVMsU0FBVCxDQUE5QixFQUFtRDtBQUNqRDtBQUNBLGlCQUFPLFVBQVAsQ0FBa0IsVUFBVSxVQUFWLENBQXFCLFFBQXZDO0FBQ0E7QUFDRjtBQUNDLFNBTEQsTUFLTyxJQUFJLElBQUksT0FBSixDQUFZLFNBQVosS0FBMEIsSUFBSSxNQUFKLENBQVcsU0FBWCxDQUExQixJQUFtRCxJQUFJLFlBQUosQ0FBaUIsVUFBVSxVQUEzQixDQUF2RCxFQUErRjtBQUNwRztBQUNBLGNBQUksV0FBSixDQUFnQixTQUFoQixFQUEyQixVQUFVLFVBQXJDO0FBQ0EscUJBQVcsU0FBWDtBQUNGO0FBQ0MsU0FMTSxNQUtBO0FBQ0wscUJBQVcsSUFBSSxTQUFKLENBQWMsU0FBZCxFQUF5QixJQUFJLGFBQUosRUFBekIsQ0FBWDs7QUFFQSxjQUFJLGVBQWUsSUFBSSxjQUFKLENBQW1CLFNBQW5CLEVBQThCLElBQUksYUFBbEMsQ0FBbkI7QUFDQSx5QkFBZSxhQUFhLE1BQWIsQ0FBb0IsSUFBSSxjQUFKLENBQW1CLFFBQW5CLEVBQTZCLElBQUksYUFBakMsQ0FBcEIsQ0FBZjs7QUFFQSxZQUFFLElBQUYsQ0FBTyxZQUFQLEVBQXFCLFVBQVUsR0FBVixFQUFlLE1BQWYsRUFBdUI7QUFDMUMsZ0JBQUksTUFBSixDQUFXLE1BQVg7QUFDRCxXQUZEOztBQUlBO0FBQ0EsY0FBSSxDQUFDLElBQUksU0FBSixDQUFjLFFBQWQsS0FBMkIsSUFBSSxLQUFKLENBQVUsUUFBVixDQUE1QixLQUFvRCxJQUFJLE9BQUosQ0FBWSxRQUFaLENBQXhELEVBQStFO0FBQzdFLHVCQUFXLElBQUksT0FBSixDQUFZLFFBQVosRUFBc0IsR0FBdEIsQ0FBWDtBQUNEO0FBQ0Y7QUFDSDtBQUNDLE9BNUJELE1BNEJPO0FBQ0wsWUFBSSxPQUFPLElBQUksRUFBSixDQUFPLFVBQVAsQ0FBa0IsSUFBSSxFQUF0QixDQUFYO0FBQ0EsbUJBQVcsRUFBRSxJQUFJLFNBQU4sRUFBaUIsQ0FBakIsQ0FBWDtBQUNBLFlBQUksSUFBSixFQUFVO0FBQ1IsY0FBSSxFQUFKLENBQU8sWUFBUCxDQUFvQixRQUFwQixFQUE4QixJQUE5QjtBQUNELFNBRkQsTUFFTztBQUNMLGNBQUksRUFBSixDQUFPLFdBQVAsQ0FBbUIsUUFBbkI7QUFDRDtBQUNGOztBQUVELFlBQU0sTUFBTixDQUFhLFFBQWIsRUFBdUIsQ0FBdkIsRUFBMEIsU0FBMUIsR0FBc0MsTUFBdEMsR0FBK0MsY0FBL0MsQ0FBOEQsUUFBOUQ7QUFDRCxLQXJERDtBQXNERCxHQTdFRDs7QUErRUE7Ozs7OztBQU1BLE1BQUksUUFBUSxTQUFSLEtBQVEsR0FBWTtBQUN0Qjs7Ozs7O0FBTUEsU0FBSyxHQUFMLEdBQVcsVUFBVSxHQUFWLEVBQWUsT0FBZixFQUF3QjtBQUNqQyxVQUFJLE9BQU8sSUFBSSxRQUFKLENBQWEsSUFBSSxjQUFKLEVBQWIsRUFBbUMsSUFBSSxNQUF2QyxDQUFYO0FBQ0EsVUFBSSxRQUFRLElBQUksUUFBSixDQUFhLElBQWIsRUFBbUIsSUFBSSxPQUF2QixDQUFaO0FBQ0EsVUFBSSxRQUFRLElBQUksY0FBSixDQUFtQixLQUFuQixFQUEwQixJQUFJLE1BQTlCLENBQVo7O0FBRUEsVUFBSSxXQUFXLEtBQUssVUFBVSxNQUFWLEdBQW1CLE1BQXhCLEVBQWdDLEtBQWhDLEVBQXVDLElBQXZDLENBQWY7QUFDQSxVQUFJLFFBQUosRUFBYztBQUNaLGNBQU0sTUFBTixDQUFhLFFBQWIsRUFBdUIsQ0FBdkIsRUFBMEIsTUFBMUI7QUFDRDtBQUNGLEtBVEQ7O0FBV0E7Ozs7Ozs7QUFPQSxTQUFLLFdBQUwsR0FBbUIsVUFBVSxRQUFWLEVBQW9CLFFBQXBCLEVBQThCLE9BQTlCLEVBQXVDO0FBQ3hELFVBQUksTUFBTSxFQUFWO0FBQUEsVUFBYyxNQUFkO0FBQ0EsV0FBSyxJQUFJLFNBQVMsQ0FBbEIsRUFBcUIsU0FBUyxRQUE5QixFQUF3QyxRQUF4QyxFQUFrRDtBQUNoRCxZQUFJLElBQUosQ0FBUyxTQUFTLElBQUksS0FBYixHQUFxQixPQUE5QjtBQUNEO0FBQ0QsZUFBUyxJQUFJLElBQUosQ0FBUyxFQUFULENBQVQ7O0FBRUEsVUFBSSxNQUFNLEVBQVY7QUFBQSxVQUFjLE1BQWQ7QUFDQSxXQUFLLElBQUksU0FBUyxDQUFsQixFQUFxQixTQUFTLFFBQTlCLEVBQXdDLFFBQXhDLEVBQWtEO0FBQ2hELFlBQUksSUFBSixDQUFTLFNBQVMsTUFBVCxHQUFrQixPQUEzQjtBQUNEO0FBQ0QsZUFBUyxJQUFJLElBQUosQ0FBUyxFQUFULENBQVQ7QUFDQSxVQUFJLFNBQVMsRUFBRSxZQUFZLE1BQVosR0FBcUIsVUFBdkIsQ0FBYjtBQUNBLFVBQUksV0FBVyxRQUFRLGNBQXZCLEVBQXVDO0FBQ3JDLGVBQU8sUUFBUCxDQUFnQixRQUFRLGNBQXhCO0FBQ0Q7O0FBRUQsYUFBTyxPQUFPLENBQVAsQ0FBUDtBQUNELEtBbEJEO0FBbUJELEdBNUNEOztBQStDQSxNQUFJLFlBQVksT0FBaEI7O0FBRUE7OztBQUdBLE1BQUksU0FBUyxTQUFULE1BQVMsQ0FBVSxPQUFWLEVBQW1CO0FBQzlCLFFBQUksT0FBTyxJQUFYOztBQUVBLFFBQUksUUFBUSxRQUFRLFVBQVIsQ0FBbUIsSUFBL0I7QUFDQSxRQUFJLFVBQVUsUUFBUSxVQUFSLENBQW1CLE1BQWpDO0FBQ0EsUUFBSSxZQUFZLFFBQVEsVUFBUixDQUFtQixRQUFuQztBQUNBLFFBQUksVUFBVSxRQUFRLE9BQXRCO0FBQ0EsUUFBSSxPQUFPLFFBQVEsUUFBbkI7O0FBRUEsUUFBSSxXQUFXLFVBQVUsQ0FBVixDQUFmO0FBQ0EsUUFBSSxZQUFZLElBQWhCOztBQUVBLFFBQUksUUFBUSxJQUFJLEtBQUosRUFBWjtBQUNBLFFBQUksUUFBUSxJQUFJLEtBQUosRUFBWjtBQUNBLFFBQUksU0FBUyxJQUFJLE1BQUosRUFBYjtBQUNBLFFBQUksU0FBUyxJQUFJLE1BQUosRUFBYjtBQUNBLFFBQUksVUFBVSxJQUFJLE9BQUosQ0FBWSxTQUFaLENBQWQ7O0FBRUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUI7QUFDQSxnQkFBVSxFQUFWLENBQWEsU0FBYixFQUF3QixVQUFVLEtBQVYsRUFBaUI7QUFDdkMsWUFBSSxNQUFNLE9BQU4sS0FBa0IsSUFBSSxJQUFKLENBQVMsS0FBL0IsRUFBc0M7QUFDcEMsa0JBQVEsWUFBUixDQUFxQixPQUFyQixFQUE4QixLQUE5QjtBQUNEO0FBQ0QsZ0JBQVEsWUFBUixDQUFxQixTQUFyQixFQUFnQyxLQUFoQzs7QUFFQSxZQUFJLENBQUMsTUFBTSxrQkFBTixFQUFMLEVBQWlDO0FBQy9CLGNBQUksUUFBUSxTQUFaLEVBQXVCO0FBQ3JCLGlCQUFLLFlBQUwsQ0FBa0IsS0FBbEI7QUFDRCxXQUZELE1BRU87QUFDTCxpQkFBSywrQkFBTCxDQUFxQyxLQUFyQztBQUNEO0FBQ0Y7QUFDRixPQWJELEVBYUcsRUFiSCxDQWFNLE9BYk4sRUFhZSxVQUFVLEtBQVYsRUFBaUI7QUFDOUIsZ0JBQVEsWUFBUixDQUFxQixPQUFyQixFQUE4QixLQUE5QjtBQUNELE9BZkQsRUFlRyxFQWZILENBZU0sT0FmTixFQWVlLFVBQVUsS0FBVixFQUFpQjtBQUM5QixnQkFBUSxZQUFSLENBQXFCLE9BQXJCLEVBQThCLEtBQTlCO0FBQ0QsT0FqQkQsRUFpQkcsRUFqQkgsQ0FpQk0sTUFqQk4sRUFpQmMsVUFBVSxLQUFWLEVBQWlCO0FBQzdCLGdCQUFRLFlBQVIsQ0FBcUIsTUFBckIsRUFBNkIsS0FBN0I7QUFDRCxPQW5CRCxFQW1CRyxFQW5CSCxDQW1CTSxXQW5CTixFQW1CbUIsVUFBVSxLQUFWLEVBQWlCO0FBQ2xDLGdCQUFRLFlBQVIsQ0FBcUIsV0FBckIsRUFBa0MsS0FBbEM7QUFDRCxPQXJCRCxFQXFCRyxFQXJCSCxDQXFCTSxTQXJCTixFQXFCaUIsVUFBVSxLQUFWLEVBQWlCO0FBQ2hDLGdCQUFRLFlBQVIsQ0FBcUIsU0FBckIsRUFBZ0MsS0FBaEM7QUFDRCxPQXZCRCxFQXVCRyxFQXZCSCxDQXVCTSxRQXZCTixFQXVCZ0IsVUFBVSxLQUFWLEVBQWlCO0FBQy9CLGdCQUFRLFlBQVIsQ0FBcUIsUUFBckIsRUFBK0IsS0FBL0I7QUFDRCxPQXpCRCxFQXlCRyxFQXpCSCxDQXlCTSxPQXpCTixFQXlCZSxVQUFVLEtBQVYsRUFBaUI7QUFDOUIsZ0JBQVEsWUFBUixDQUFxQixPQUFyQixFQUE4QixLQUE5QjtBQUNELE9BM0JEOztBQTZCQTtBQUNBLGdCQUFVLElBQVYsQ0FBZSxJQUFJLElBQUosQ0FBUyxLQUFULEtBQW1CLElBQUksU0FBdEM7O0FBRUE7QUFDQTtBQUNBLFVBQUksa0JBQWtCLE1BQU0sTUFBTixHQUFlLDZEQUFmLEdBQStFLE9BQXJHO0FBQ0EsZ0JBQVUsRUFBVixDQUFhLGVBQWIsRUFBOEIsS0FBSyxRQUFMLENBQWMsWUFBWTtBQUN0RCxnQkFBUSxZQUFSLENBQXFCLFFBQXJCLEVBQStCLFVBQVUsSUFBVixFQUEvQjtBQUNELE9BRjZCLEVBRTNCLEdBRjJCLENBQTlCOztBQUlBLGNBQVEsRUFBUixDQUFXLFNBQVgsRUFBc0IsVUFBVSxLQUFWLEVBQWlCO0FBQ3JDLGdCQUFRLFlBQVIsQ0FBcUIsU0FBckIsRUFBZ0MsS0FBaEM7QUFDRCxPQUZELEVBRUcsRUFGSCxDQUVNLFVBRk4sRUFFa0IsVUFBVSxLQUFWLEVBQWlCO0FBQ2pDLGdCQUFRLFlBQVIsQ0FBcUIsVUFBckIsRUFBaUMsS0FBakM7QUFDRCxPQUpEOztBQU1BLFVBQUksQ0FBQyxRQUFRLE9BQWIsRUFBc0I7QUFDcEIsWUFBSSxRQUFRLEtBQVosRUFBbUI7QUFDakIsa0JBQVEsVUFBUixDQUFtQixRQUFRLEtBQTNCO0FBQ0Q7QUFDRCxZQUFJLFFBQVEsTUFBWixFQUFvQjtBQUNsQixvQkFBVSxXQUFWLENBQXNCLFFBQVEsTUFBOUI7QUFDRDtBQUNELFlBQUksUUFBUSxTQUFaLEVBQXVCO0FBQ3JCLG9CQUFVLEdBQVYsQ0FBYyxZQUFkLEVBQTRCLFFBQVEsU0FBcEM7QUFDRDtBQUNELFlBQUksUUFBUSxTQUFaLEVBQXVCO0FBQ3JCLG9CQUFVLEdBQVYsQ0FBYyxZQUFkLEVBQTRCLFFBQVEsU0FBcEM7QUFDRDtBQUNGOztBQUVELGNBQVEsVUFBUjtBQUNELEtBL0REOztBQWlFQSxTQUFLLE9BQUwsR0FBZSxZQUFZO0FBQ3pCLGdCQUFVLEdBQVY7QUFDRCxLQUZEOztBQUlBLFNBQUssWUFBTCxHQUFvQixVQUFVLEtBQVYsRUFBaUI7QUFDbkMsVUFBSSxTQUFTLFFBQVEsTUFBUixDQUFlLE1BQU0sS0FBTixHQUFjLEtBQWQsR0FBc0IsSUFBckMsQ0FBYjtBQUNBLFVBQUksT0FBTyxFQUFYOztBQUVBLFVBQUksTUFBTSxPQUFWLEVBQW1CO0FBQUUsYUFBSyxJQUFMLENBQVUsS0FBVjtBQUFtQjtBQUN4QyxVQUFJLE1BQU0sT0FBTixJQUFpQixDQUFDLE1BQU0sTUFBNUIsRUFBb0M7QUFBRSxhQUFLLElBQUwsQ0FBVSxNQUFWO0FBQW9CO0FBQzFELFVBQUksTUFBTSxRQUFWLEVBQW9CO0FBQUUsYUFBSyxJQUFMLENBQVUsT0FBVjtBQUFxQjs7QUFFM0MsVUFBSSxVQUFVLElBQUksWUFBSixDQUFpQixNQUFNLE9BQXZCLENBQWQ7QUFDQSxVQUFJLE9BQUosRUFBYTtBQUNYLGFBQUssSUFBTCxDQUFVLE9BQVY7QUFDRDs7QUFFRCxVQUFJLFlBQVksT0FBTyxLQUFLLElBQUwsQ0FBVSxHQUFWLENBQVAsQ0FBaEI7QUFDQSxVQUFJLFNBQUosRUFBZTtBQUNiLGNBQU0sY0FBTjtBQUNBLGdCQUFRLE1BQVIsQ0FBZSxTQUFmO0FBQ0QsT0FIRCxNQUdPLElBQUksSUFBSSxNQUFKLENBQVcsTUFBTSxPQUFqQixDQUFKLEVBQStCO0FBQ3BDLGFBQUssWUFBTDtBQUNEO0FBQ0YsS0FwQkQ7O0FBc0JBLFNBQUssK0JBQUwsR0FBdUMsVUFBVSxLQUFWLEVBQWlCO0FBQ3REO0FBQ0EsVUFBSSxDQUFDLE1BQU0sT0FBTixJQUFpQixNQUFNLE9BQXhCLEtBQ0YsS0FBSyxRQUFMLENBQWMsQ0FBQyxFQUFELEVBQUssRUFBTCxFQUFTLEVBQVQsQ0FBZCxFQUE0QixNQUFNLE9BQWxDLENBREYsRUFDOEM7QUFDNUMsY0FBTSxjQUFOO0FBQ0Q7QUFDRixLQU5EOztBQVFBOzs7O0FBSUEsU0FBSyxXQUFMLEdBQW1CLFlBQVk7QUFDN0IsV0FBSyxLQUFMO0FBQ0EsYUFBTyxNQUFNLE1BQU4sQ0FBYSxRQUFiLENBQVA7QUFDRCxLQUhEOztBQUtBOzs7Ozs7O0FBT0EsU0FBSyxTQUFMLEdBQWlCLFVBQVUsWUFBVixFQUF3QjtBQUN2QyxrQkFBWSxLQUFLLFdBQUwsRUFBWjtBQUNBLFVBQUksWUFBSixFQUFrQjtBQUNoQixrQkFBVSxRQUFWLEdBQXFCLE1BQXJCO0FBQ0Q7QUFDRixLQUxEOztBQU9BOzs7OztBQUtBLFNBQUssWUFBTCxHQUFvQixZQUFZO0FBQzlCLFVBQUksU0FBSixFQUFlO0FBQ2Isa0JBQVUsTUFBVjtBQUNBLGFBQUssS0FBTDtBQUNEO0FBQ0YsS0FMRDs7QUFPQSxTQUFLLFVBQUwsR0FBa0IsVUFBVSxJQUFWLEVBQWdCO0FBQ2hDLGdCQUFVLElBQVYsQ0FBZSxRQUFmLEVBQXlCLElBQXpCO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLFdBQUwsR0FBbUIsWUFBWTtBQUM3QixnQkFBVSxVQUFWLENBQXFCLFFBQXJCO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLGFBQUwsR0FBcUIsWUFBWTtBQUMvQixhQUFPLFVBQVUsSUFBVixDQUFlLFFBQWYsQ0FBUDtBQUNELEtBRkQ7O0FBSUE7Ozs7OztBQU1BLFNBQUssWUFBTCxHQUFvQixZQUFZO0FBQzlCLFVBQUksTUFBTSxNQUFNLE1BQU4sRUFBVjtBQUNBLFVBQUksR0FBSixFQUFTO0FBQ1AsY0FBTSxJQUFJLFNBQUosRUFBTjtBQUNEO0FBQ0QsYUFBTyxNQUFNLE1BQU0sT0FBTixDQUFjLEdBQWQsQ0FBTixHQUEyQixNQUFNLFFBQU4sQ0FBZSxTQUFmLENBQWxDO0FBQ0QsS0FORDs7QUFRQTs7Ozs7O0FBTUEsU0FBSyxhQUFMLEdBQXFCLFVBQVUsS0FBVixFQUFpQjtBQUNwQyxhQUFPLE1BQU0sUUFBTixDQUFlLEtBQWYsQ0FBUDtBQUNELEtBRkQ7O0FBSUE7OztBQUdBLFNBQUssSUFBTCxHQUFZLFlBQVk7QUFDdEIsY0FBUSxZQUFSLENBQXFCLGdCQUFyQixFQUF1QyxVQUFVLElBQVYsRUFBdkM7QUFDQSxjQUFRLElBQVI7QUFDQSxjQUFRLFlBQVIsQ0FBcUIsUUFBckIsRUFBK0IsVUFBVSxJQUFWLEVBQS9CO0FBQ0QsS0FKRDtBQUtBLFlBQVEsSUFBUixDQUFhLFdBQWIsRUFBMEIsS0FBSyxJQUFMLENBQVUsSUFBcEM7O0FBRUE7OztBQUdBLFNBQUssSUFBTCxHQUFZLFlBQVk7QUFDdEIsY0FBUSxZQUFSLENBQXFCLGdCQUFyQixFQUF1QyxVQUFVLElBQVYsRUFBdkM7QUFDQSxjQUFRLElBQVI7QUFDQSxjQUFRLFlBQVIsQ0FBcUIsUUFBckIsRUFBK0IsVUFBVSxJQUFWLEVBQS9CO0FBQ0QsS0FKRDtBQUtBLFlBQVEsSUFBUixDQUFhLFdBQWIsRUFBMEIsS0FBSyxJQUFMLENBQVUsSUFBcEM7O0FBRUE7OztBQUdBLFFBQUksZ0JBQWdCLEtBQUssYUFBTCxHQUFxQixZQUFZO0FBQ25ELGNBQVEsWUFBUixDQUFxQixnQkFBckIsRUFBdUMsVUFBVSxJQUFWLEVBQXZDO0FBQ0E7QUFDQSxXQUFLLEtBQUw7QUFDRCxLQUpEOztBQU1BOzs7O0FBSUEsUUFBSSxlQUFlLEtBQUssWUFBTCxHQUFvQixVQUFVLGdCQUFWLEVBQTRCO0FBQ2pFLGNBQVEsVUFBUjtBQUNBLFVBQUksQ0FBQyxnQkFBTCxFQUF1QjtBQUNyQixnQkFBUSxZQUFSLENBQXFCLFFBQXJCLEVBQStCLFVBQVUsSUFBVixFQUEvQjtBQUNEO0FBQ0YsS0FMRDs7QUFPQTtBQUNBO0FBQ0EsUUFBSSxXQUFXLENBQUMsTUFBRCxFQUFTLFFBQVQsRUFBbUIsV0FBbkIsRUFBZ0MsZUFBaEMsRUFBaUQsYUFBakQsRUFBZ0UsV0FBaEUsRUFDQyxhQURELEVBQ2dCLGVBRGhCLEVBQ2lDLGNBRGpDLEVBQ2lELGFBRGpELEVBRUMsYUFGRCxFQUVnQixjQUZoQixFQUdDLFdBSEQsRUFHYyxXQUhkLEVBRzJCLFVBSDNCLENBQWY7O0FBS0EsU0FBSyxJQUFJLE1BQU0sQ0FBVixFQUFhLE1BQU0sU0FBUyxNQUFqQyxFQUF5QyxNQUFNLEdBQS9DLEVBQW9ELEtBQXBELEVBQTREO0FBQzFELFdBQUssU0FBUyxHQUFULENBQUwsSUFBdUIsVUFBVSxJQUFWLEVBQWdCO0FBQ3JDLGVBQU8sVUFBVSxLQUFWLEVBQWlCO0FBQ3RCO0FBQ0EsbUJBQVMsV0FBVCxDQUFxQixJQUFyQixFQUEyQixLQUEzQixFQUFrQyxLQUFsQztBQUNBLHVCQUFhLElBQWI7QUFDRCxTQUpEO0FBS0QsT0FOcUIsQ0FNbkIsU0FBUyxHQUFULENBTm1CLENBQXRCO0FBT0EsY0FBUSxJQUFSLENBQWEsVUFBVSxTQUFTLEdBQVQsQ0FBdkIsRUFBc0MsS0FBSyxJQUFMLENBQVUsU0FBUyxHQUFULENBQVYsQ0FBdEM7QUFDRDtBQUNEOztBQUVBOzs7QUFHQSxTQUFLLEdBQUwsR0FBVyxZQUFZO0FBQ3JCLFVBQUksTUFBTSxLQUFLLFdBQUwsRUFBVjtBQUNBLFVBQUksSUFBSSxXQUFKLE1BQXFCLElBQUksUUFBSixFQUF6QixFQUF5QztBQUN2QyxjQUFNLEdBQU4sQ0FBVSxHQUFWO0FBQ0QsT0FGRCxNQUVPO0FBQ0w7QUFDQSxlQUFPLFNBQVAsQ0FBaUIsR0FBakIsRUFBc0IsUUFBUSxPQUE5QjtBQUNBO0FBQ0Q7QUFDRixLQVREO0FBVUEsWUFBUSxJQUFSLENBQWEsVUFBYixFQUF5QixLQUFLLElBQUwsQ0FBVSxHQUFuQzs7QUFFQTs7O0FBR0EsU0FBSyxLQUFMLEdBQWEsWUFBWTtBQUN2QixVQUFJLE1BQU0sS0FBSyxXQUFMLEVBQVY7QUFDQSxVQUFJLElBQUksV0FBSixNQUFxQixJQUFJLFFBQUosRUFBekIsRUFBeUM7QUFDdkMsY0FBTSxHQUFOLENBQVUsR0FBVixFQUFlLElBQWY7QUFDRDtBQUNGLEtBTEQ7QUFNQSxZQUFRLElBQVIsQ0FBYSxZQUFiLEVBQTJCLEtBQUssSUFBTCxDQUFVLEtBQXJDOztBQUVBOzs7QUFHQSxTQUFLLFdBQUwsR0FBbUIsVUFBVSxFQUFWLEVBQWM7QUFDL0IsYUFBTyxZQUFZO0FBQ2pCO0FBQ0EsV0FBRyxLQUFILENBQVMsSUFBVCxFQUFlLFNBQWY7QUFDQTtBQUNELE9BSkQ7QUFLRCxLQU5EOztBQVFBOzs7QUFHQSxTQUFLLGVBQUwsR0FBdUIsS0FBSyxXQUFMLENBQWlCLFlBQVk7QUFDbEQsYUFBTyxlQUFQLENBQXVCLFFBQXZCO0FBQ0QsS0FGc0IsQ0FBdkI7QUFHQSxZQUFRLElBQVIsQ0FBYSxzQkFBYixFQUFxQyxLQUFLLElBQUwsQ0FBVSxlQUEvQzs7QUFFQSxTQUFLLGlCQUFMLEdBQXlCLEtBQUssV0FBTCxDQUFpQixZQUFZO0FBQ3BELGFBQU8saUJBQVAsQ0FBeUIsUUFBekI7QUFDRCxLQUZ3QixDQUF6QjtBQUdBLFlBQVEsSUFBUixDQUFhLHdCQUFiLEVBQXVDLEtBQUssSUFBTCxDQUFVLGlCQUFqRDs7QUFFQSxTQUFLLG1CQUFMLEdBQTJCLEtBQUssV0FBTCxDQUFpQixZQUFZO0FBQ3RELGFBQU8sbUJBQVAsQ0FBMkIsUUFBM0I7QUFDRCxLQUYwQixDQUEzQjtBQUdBLFlBQVEsSUFBUixDQUFhLDBCQUFiLEVBQXlDLEtBQUssSUFBTCxDQUFVLG1CQUFuRDs7QUFFQSxTQUFLLE1BQUwsR0FBYyxLQUFLLFdBQUwsQ0FBaUIsWUFBWTtBQUN6QyxhQUFPLE1BQVAsQ0FBYyxRQUFkO0FBQ0QsS0FGYSxDQUFkO0FBR0EsWUFBUSxJQUFSLENBQWEsYUFBYixFQUE0QixLQUFLLElBQUwsQ0FBVSxNQUF0Qzs7QUFFQSxTQUFLLE9BQUwsR0FBZSxLQUFLLFdBQUwsQ0FBaUIsWUFBWTtBQUMxQyxhQUFPLE9BQVAsQ0FBZSxRQUFmO0FBQ0QsS0FGYyxDQUFmO0FBR0EsWUFBUSxJQUFSLENBQWEsY0FBYixFQUE2QixLQUFLLElBQUwsQ0FBVSxPQUF2Qzs7QUFFQTs7Ozs7OztBQU9BLFNBQUssV0FBTCxHQUFtQixVQUFVLEdBQVYsRUFBZSxLQUFmLEVBQXNCO0FBQ3ZDLGFBQU8sTUFBTSxXQUFOLENBQWtCLEdBQWxCLEVBQXVCLEtBQXZCLEVBQThCLElBQTlCLENBQW1DLFVBQVUsTUFBVixFQUFrQjtBQUMxRDs7QUFFQSxZQUFJLE9BQU8sS0FBUCxLQUFpQixVQUFyQixFQUFpQztBQUMvQixnQkFBTSxNQUFOO0FBQ0QsU0FGRCxNQUVPO0FBQ0wsY0FBSSxPQUFPLEtBQVAsS0FBaUIsUUFBckIsRUFBK0I7QUFDN0IsbUJBQU8sSUFBUCxDQUFZLGVBQVosRUFBNkIsS0FBN0I7QUFDRDtBQUNELGlCQUFPLEdBQVAsQ0FBVyxPQUFYLEVBQW9CLEtBQUssR0FBTCxDQUFTLFVBQVUsS0FBVixFQUFULEVBQTRCLE9BQU8sS0FBUCxFQUE1QixDQUFwQjtBQUNEOztBQUVELGVBQU8sSUFBUDtBQUNBLGNBQU0sTUFBTixDQUFhLFFBQWIsRUFBdUIsVUFBdkIsQ0FBa0MsT0FBTyxDQUFQLENBQWxDO0FBQ0EsY0FBTSxtQkFBTixDQUEwQixPQUFPLENBQVAsQ0FBMUIsRUFBcUMsTUFBckM7QUFDQTtBQUNELE9BaEJNLEVBZ0JKLElBaEJJLENBZ0JDLFVBQVUsQ0FBVixFQUFhO0FBQ25CLGdCQUFRLFlBQVIsQ0FBcUIsb0JBQXJCLEVBQTJDLENBQTNDO0FBQ0QsT0FsQk0sQ0FBUDtBQW1CRCxLQXBCRDs7QUFzQkE7Ozs7QUFJQSxTQUFLLFlBQUwsR0FBb0IsVUFBVSxLQUFWLEVBQWlCO0FBQ25DLFFBQUUsSUFBRixDQUFPLEtBQVAsRUFBYyxVQUFVLEdBQVYsRUFBZSxJQUFmLEVBQXFCO0FBQ2pDLFlBQUksV0FBVyxLQUFLLElBQXBCO0FBQ0EsWUFBSSxRQUFRLG9CQUFSLElBQWdDLFFBQVEsb0JBQVIsR0FBK0IsS0FBSyxJQUF4RSxFQUE4RTtBQUM1RSxrQkFBUSxZQUFSLENBQXFCLG9CQUFyQixFQUEyQyxLQUFLLEtBQUwsQ0FBVyxvQkFBdEQ7QUFDRCxTQUZELE1BRU87QUFDTCxnQkFBTSxpQkFBTixDQUF3QixJQUF4QixFQUE4QixJQUE5QixDQUFtQyxVQUFVLE9BQVYsRUFBbUI7QUFDcEQsbUJBQU8sS0FBSyxXQUFMLENBQWlCLE9BQWpCLEVBQTBCLFFBQTFCLENBQVA7QUFDRCxXQUZELEVBRUcsSUFGSCxDQUVRLFlBQVk7QUFDbEIsb0JBQVEsWUFBUixDQUFxQixvQkFBckI7QUFDRCxXQUpEO0FBS0Q7QUFDRixPQVhEO0FBWUQsS0FiRDs7QUFlQTs7OztBQUlBLFNBQUssc0JBQUwsR0FBOEIsVUFBVSxLQUFWLEVBQWlCO0FBQzdDLFVBQUksWUFBWSxRQUFRLFNBQXhCOztBQUVBO0FBQ0EsVUFBSSxVQUFVLGFBQWQsRUFBNkI7QUFDM0IsZ0JBQVEsWUFBUixDQUFxQixjQUFyQixFQUFxQyxLQUFyQztBQUNGO0FBQ0MsT0FIRCxNQUdPO0FBQ0wsYUFBSyxZQUFMLENBQWtCLEtBQWxCO0FBQ0Q7QUFDRixLQVZEOztBQVlBOzs7OztBQUtBLFNBQUssVUFBTCxHQUFrQixLQUFLLFdBQUwsQ0FBaUIsVUFBVSxJQUFWLEVBQWdCO0FBQ2pELFVBQUksTUFBTSxLQUFLLFdBQUwsRUFBVjtBQUNBLFVBQUksVUFBSixDQUFlLElBQWY7QUFDQSxZQUFNLG1CQUFOLENBQTBCLElBQTFCLEVBQWdDLE1BQWhDO0FBQ0QsS0FKaUIsQ0FBbEI7O0FBTUE7Ozs7QUFJQSxTQUFLLFVBQUwsR0FBa0IsS0FBSyxXQUFMLENBQWlCLFVBQVUsSUFBVixFQUFnQjtBQUNqRCxVQUFJLE1BQU0sS0FBSyxXQUFMLEVBQVY7QUFDQSxVQUFJLFdBQVcsSUFBSSxVQUFKLENBQWUsSUFBSSxVQUFKLENBQWUsSUFBZixDQUFmLENBQWY7QUFDQSxZQUFNLE1BQU4sQ0FBYSxRQUFiLEVBQXVCLElBQUksVUFBSixDQUFlLFFBQWYsQ0FBdkIsRUFBaUQsTUFBakQ7QUFDRCxLQUppQixDQUFsQjs7QUFNQTs7OztBQUlBLFNBQUssZUFBTCxHQUF1QixZQUFZO0FBQ2pDLFVBQUksTUFBTSxLQUFLLFdBQUwsRUFBVjs7QUFFQTtBQUNBLFVBQUksSUFBSSxVQUFKLEVBQUosRUFBc0I7QUFDcEIsY0FBTSxNQUFNLGNBQU4sQ0FBcUIsSUFBSSxRQUFKLENBQWEsSUFBSSxFQUFqQixFQUFxQixJQUFJLFFBQXpCLENBQXJCLENBQU47QUFDRDs7QUFFRCxhQUFPLElBQUksUUFBSixFQUFQO0FBQ0QsS0FURDs7QUFXQTs7OztBQUlBLFNBQUssU0FBTCxHQUFpQixLQUFLLFdBQUwsQ0FBaUIsVUFBVSxNQUFWLEVBQWtCO0FBQ2xELFVBQUksV0FBVyxLQUFLLFdBQUwsR0FBbUIsU0FBbkIsQ0FBNkIsTUFBN0IsQ0FBZjtBQUNBLFlBQU0sbUJBQU4sQ0FBMEIsS0FBSyxJQUFMLENBQVUsUUFBVixDQUExQixFQUErQyxNQUEvQztBQUNELEtBSGdCLENBQWpCOztBQUtBOzs7OztBQUtBLFNBQUssV0FBTCxHQUFtQixLQUFLLFdBQUwsQ0FBaUIsVUFBVSxPQUFWLEVBQW1CO0FBQ3JEO0FBQ0EsZ0JBQVUsTUFBTSxNQUFOLEdBQWUsTUFBTSxPQUFOLEdBQWdCLEdBQS9CLEdBQXFDLE9BQS9DO0FBQ0EsZUFBUyxXQUFULENBQXFCLGFBQXJCLEVBQW9DLEtBQXBDLEVBQTJDLE9BQTNDO0FBQ0QsS0FKa0IsQ0FBbkI7O0FBTUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsV0FBSyxXQUFMLENBQWlCLEdBQWpCO0FBQ0QsS0FGRDtBQUdBLFlBQVEsSUFBUixDQUFhLGlCQUFiLEVBQWdDLEtBQUssSUFBTCxDQUFVLFVBQTFDOztBQUVBO0FBQ0EsU0FBSyxJQUFJLE1BQU0sQ0FBZixFQUFrQixPQUFPLENBQXpCLEVBQTRCLEtBQTVCLEVBQW9DO0FBQ2xDLFdBQUssWUFBWSxHQUFqQixJQUF3QixVQUFVLEdBQVYsRUFBZTtBQUNyQyxlQUFPLFlBQVk7QUFDakIsZUFBSyxXQUFMLENBQWlCLE1BQU0sR0FBdkI7QUFDRCxTQUZEO0FBR0QsT0FKdUIsQ0FJdEIsR0FKc0IsQ0FBeEI7QUFLQSxjQUFRLElBQVIsQ0FBYSxpQkFBZSxHQUE1QixFQUFpQyxLQUFLLElBQUwsQ0FBVSxZQUFZLEdBQXRCLENBQWpDO0FBQ0Q7QUFDRDs7QUFFQTs7Ozs7QUFLQSxTQUFLLFFBQUwsR0FBZ0IsVUFBVSxLQUFWLEVBQWlCO0FBQy9CLFVBQUksTUFBTSxLQUFLLFdBQUwsRUFBVjs7QUFFQSxVQUFJLE9BQU8sSUFBSSxXQUFKLEVBQVgsRUFBOEI7QUFDNUIsWUFBSSxRQUFRLE1BQU0sVUFBTixDQUFpQixHQUFqQixDQUFaO0FBQ0EsWUFBSSxZQUFZLEtBQUssSUFBTCxDQUFVLEtBQVYsQ0FBaEI7O0FBRUEsVUFBRSxLQUFGLEVBQVMsR0FBVCxDQUFhO0FBQ1gsdUJBQWEsUUFBUTtBQURWLFNBQWI7O0FBSUE7QUFDQTtBQUNBLFlBQUksYUFBYSxDQUFDLElBQUksVUFBSixDQUFlLFNBQWYsQ0FBbEIsRUFBNkM7QUFDM0Msb0JBQVUsU0FBVixHQUFzQixJQUFJLG9CQUExQjtBQUNBLGdCQUFNLG1CQUFOLENBQTBCLFVBQVUsVUFBcEMsRUFBZ0QsTUFBaEQ7QUFDQSxvQkFBVSxJQUFWLENBQWUsU0FBZixFQUEwQixTQUExQjtBQUNEO0FBQ0YsT0FmRCxNQWVPO0FBQ0w7QUFDQSxVQUFFLE1BQU0sVUFBTixDQUFpQixHQUFqQixDQUFGLEVBQXlCLEdBQXpCLENBQTZCO0FBQzNCLHVCQUFhLFFBQVE7QUFETSxTQUE3QjtBQUdBO0FBQ0Q7QUFDRixLQXpCRDs7QUEyQkE7OztBQUdBLFNBQUssb0JBQUwsR0FBNEIsS0FBSyxXQUFMLENBQWlCLFlBQVk7QUFDdkQsVUFBSSxTQUFTLEtBQUssV0FBTCxHQUFtQixVQUFuQixDQUE4QixJQUFJLE1BQUosQ0FBVyxJQUFYLENBQTlCLENBQWI7QUFDQSxVQUFJLE9BQU8sV0FBWCxFQUF3QjtBQUN0QixjQUFNLE1BQU4sQ0FBYSxPQUFPLFdBQXBCLEVBQWlDLENBQWpDLEVBQW9DLFNBQXBDLEdBQWdELE1BQWhEO0FBQ0Q7QUFDRixLQUwyQixDQUE1QjtBQU1BLFlBQVEsSUFBUixDQUFhLDJCQUFiLEVBQTBDLEtBQUssSUFBTCxDQUFVLG9CQUFwRDs7QUFFQTs7O0FBR0EsU0FBSyxXQUFMLEdBQW1CLFlBQVk7QUFDN0IsVUFBSSxZQUFZLFVBQVUsSUFBVixDQUFlLFNBQWYsQ0FBaEI7QUFDQSxVQUFJLENBQUMsU0FBTCxFQUFnQjtBQUNkO0FBQ0Q7O0FBRUQsVUFBSSxXQUFXLEtBQUssSUFBTCxDQUFVLEtBQUssSUFBTCxDQUFVLFVBQVUsVUFBcEIsQ0FBVixFQUEyQyxJQUFJLE1BQS9DLENBQWY7O0FBRUEsVUFBSSxlQUFlLFNBQVMsU0FBVCxDQUFtQixPQUFuQixDQUEyQixJQUFJLG9CQUEvQixDQUFuQjtBQUNBLFVBQUksaUJBQWlCLENBQUMsQ0FBdEIsRUFBeUI7QUFDdkIsaUJBQVMsVUFBVCxDQUFvQixZQUFwQixFQUFrQyxDQUFsQztBQUNEOztBQUVELFVBQUksSUFBSSxPQUFKLENBQVksU0FBWixDQUFKLEVBQTRCO0FBQzFCLFlBQUksTUFBSixDQUFXLFNBQVg7QUFDRDs7QUFFRCxnQkFBVSxVQUFWLENBQXFCLFNBQXJCO0FBQ0QsS0FsQkQ7O0FBb0JBOzs7O0FBSUEsU0FBSyxVQUFMLEdBQWtCLEtBQUssV0FBTCxDQUFpQixVQUFVLEtBQVYsRUFBaUI7QUFDbEQsWUFBTSxTQUFOLENBQWdCLEtBQUssV0FBTCxFQUFoQixFQUFvQztBQUNsQyxvQkFBWTtBQURzQixPQUFwQztBQUdELEtBSmlCLENBQWxCOztBQU1BOzs7OztBQUtBLFNBQUssTUFBTCxHQUFjLFlBQVk7QUFDeEIsVUFBSSxNQUFNLEtBQUssV0FBTCxFQUFWO0FBQ0EsVUFBSSxJQUFJLFVBQUosRUFBSixFQUFzQjtBQUNwQixZQUFJLFNBQVMsSUFBSSxRQUFKLENBQWEsSUFBSSxFQUFqQixFQUFxQixJQUFJLFFBQXpCLENBQWI7QUFDQSxjQUFNLE1BQU0sY0FBTixDQUFxQixNQUFyQixDQUFOO0FBQ0EsWUFBSSxNQUFKOztBQUVBO0FBQ0EsaUJBQVMsV0FBVCxDQUFxQixRQUFyQjtBQUNBO0FBQ0Q7QUFDRixLQVhEOztBQWFBOzs7OztBQUtBLFNBQUssVUFBTCxHQUFrQixLQUFLLFdBQUwsQ0FBaUIsVUFBVSxRQUFWLEVBQW9CO0FBQ3JELFVBQUksVUFBVSxTQUFTLEdBQXZCO0FBQ0EsVUFBSSxXQUFXLFNBQVMsSUFBeEI7QUFDQSxVQUFJLGNBQWMsU0FBUyxXQUEzQjtBQUNBLFVBQUksTUFBTSxTQUFTLEtBQVQsSUFBa0IsS0FBSyxXQUFMLEVBQTVCO0FBQ0EsVUFBSSxnQkFBZ0IsSUFBSSxRQUFKLE9BQW1CLFFBQXZDOztBQUVBO0FBQ0EsVUFBSSxPQUFPLE9BQVAsS0FBbUIsUUFBdkIsRUFBaUM7QUFDL0Isa0JBQVUsUUFBUSxJQUFSLEVBQVY7QUFDRDs7QUFFRCxVQUFJLFFBQVEsWUFBWixFQUEwQjtBQUN4QixrQkFBVSxRQUFRLFlBQVIsQ0FBcUIsT0FBckIsQ0FBVjtBQUNEOztBQUVELFVBQUksVUFBVSxFQUFkO0FBQ0EsVUFBSSxhQUFKLEVBQW1CO0FBQ2pCLGNBQU0sSUFBSSxjQUFKLEVBQU47QUFDQSxZQUFJLFNBQVMsSUFBSSxVQUFKLENBQWUsRUFBRSxRQUFRLFFBQVIsR0FBbUIsTUFBckIsRUFBNkIsQ0FBN0IsQ0FBZixDQUFiO0FBQ0EsZ0JBQVEsSUFBUixDQUFhLE1BQWI7QUFDRCxPQUpELE1BSU87QUFDTCxrQkFBVSxNQUFNLFVBQU4sQ0FBaUIsR0FBakIsRUFBc0I7QUFDOUIsb0JBQVUsR0FEb0I7QUFFOUIsZ0NBQXNCLElBRlE7QUFHOUIsK0JBQXFCO0FBSFMsU0FBdEIsQ0FBVjtBQUtEOztBQUVELFFBQUUsSUFBRixDQUFPLE9BQVAsRUFBZ0IsVUFBVSxHQUFWLEVBQWUsTUFBZixFQUF1QjtBQUNyQztBQUNBLGtCQUFVLG9DQUFvQyxJQUFwQyxDQUF5QyxPQUF6QyxJQUNSLE9BRFEsR0FDRSxZQUFZLE9BRHhCOztBQUdBLFVBQUUsTUFBRixFQUFVLElBQVYsQ0FBZSxNQUFmLEVBQXVCLE9BQXZCO0FBQ0EsWUFBSSxXQUFKLEVBQWlCO0FBQ2YsWUFBRSxNQUFGLEVBQVUsSUFBVixDQUFlLFFBQWYsRUFBeUIsUUFBekI7QUFDRCxTQUZELE1BRU87QUFDTCxZQUFFLE1BQUYsRUFBVSxVQUFWLENBQXFCLFFBQXJCO0FBQ0Q7QUFDRixPQVhEOztBQWFBLFVBQUksYUFBYSxNQUFNLG9CQUFOLENBQTJCLEtBQUssSUFBTCxDQUFVLE9BQVYsQ0FBM0IsQ0FBakI7QUFDQSxVQUFJLGFBQWEsV0FBVyxhQUFYLEVBQWpCO0FBQ0EsVUFBSSxXQUFXLE1BQU0sbUJBQU4sQ0FBMEIsS0FBSyxJQUFMLENBQVUsT0FBVixDQUExQixDQUFmO0FBQ0EsVUFBSSxXQUFXLFNBQVMsV0FBVCxFQUFmOztBQUVBLFlBQU0sTUFBTixDQUNFLFdBQVcsSUFEYixFQUVFLFdBQVcsTUFGYixFQUdFLFNBQVMsSUFIWCxFQUlFLFNBQVMsTUFKWCxFQUtFLE1BTEY7QUFNRCxLQXJEaUIsQ0FBbEI7O0FBdURBOzs7Ozs7Ozs7QUFTQSxTQUFLLFdBQUwsR0FBbUIsWUFBWTtBQUM3QixVQUFJLE1BQU0sS0FBSyxXQUFMLEdBQW1CLE1BQW5CLENBQTBCLElBQUksUUFBOUIsQ0FBVjs7QUFFQTtBQUNBLFVBQUksVUFBVSxFQUFFLEtBQUssSUFBTCxDQUFVLElBQUksS0FBSixDQUFVLElBQUksUUFBZCxDQUFWLENBQUYsQ0FBZDs7QUFFQSxhQUFPO0FBQ0wsZUFBTyxHQURGO0FBRUwsY0FBTSxJQUFJLFFBQUosRUFGRDtBQUdMLHFCQUFhLFFBQVEsTUFBUixHQUFpQixRQUFRLElBQVIsQ0FBYSxRQUFiLE1BQTJCLFFBQTVDLEdBQXVELEtBSC9EO0FBSUwsYUFBSyxRQUFRLE1BQVIsR0FBaUIsUUFBUSxJQUFSLENBQWEsTUFBYixDQUFqQixHQUF3QztBQUp4QyxPQUFQO0FBTUQsS0FaRDs7QUFjQTs7Ozs7OztBQU9BLFNBQUssS0FBTCxHQUFhLEtBQUssV0FBTCxDQUFpQixVQUFVLFNBQVYsRUFBcUI7QUFDakQsVUFBSSxZQUFZLFVBQVUsU0FBMUI7QUFDQSxVQUFJLFlBQVksVUFBVSxTQUExQjs7QUFFQSxVQUFJLFNBQUosRUFBZTtBQUFFLGlCQUFTLFdBQVQsQ0FBcUIsV0FBckIsRUFBa0MsS0FBbEMsRUFBeUMsU0FBekM7QUFBc0Q7QUFDdkUsVUFBSSxTQUFKLEVBQWU7QUFBRSxpQkFBUyxXQUFULENBQXFCLFdBQXJCLEVBQWtDLEtBQWxDLEVBQXlDLFNBQXpDO0FBQXNEO0FBQ3hFLEtBTlksQ0FBYjs7QUFRQTs7Ozs7QUFLQSxTQUFLLFdBQUwsR0FBbUIsS0FBSyxXQUFMLENBQWlCLFVBQVUsR0FBVixFQUFlO0FBQ2pELFVBQUksWUFBWSxJQUFJLEtBQUosQ0FBVSxHQUFWLENBQWhCOztBQUVBLFVBQUksTUFBTSxLQUFLLFdBQUwsR0FBbUIsY0FBbkIsRUFBVjtBQUNBLFVBQUksVUFBSixDQUFlLE1BQU0sV0FBTixDQUFrQixVQUFVLENBQVYsQ0FBbEIsRUFBZ0MsVUFBVSxDQUFWLENBQWhDLEVBQThDLE9BQTlDLENBQWY7QUFDRCxLQUxrQixDQUFuQjs7QUFPQTs7Ozs7QUFLQSxTQUFLLE9BQUwsR0FBZSxLQUFLLFdBQUwsQ0FBaUIsVUFBVSxLQUFWLEVBQWlCO0FBQy9DLFVBQUksVUFBVSxFQUFFLEtBQUssYUFBTCxFQUFGLENBQWQ7QUFDQSxjQUFRLEdBQVIsQ0FBWSxPQUFaLEVBQXFCLEtBQXJCO0FBQ0QsS0FIYyxDQUFmOztBQUtBOzs7O0FBSUEsU0FBSyxNQUFMLEdBQWMsS0FBSyxXQUFMLENBQWlCLFVBQVUsS0FBVixFQUFpQjtBQUM5QyxVQUFJLFVBQVUsRUFBRSxLQUFLLGFBQUwsRUFBRixDQUFkO0FBQ0EsY0FBUSxHQUFSLENBQVk7QUFDVixlQUFPLFFBQVEsR0FBUixHQUFjLEdBRFg7QUFFVixnQkFBUTtBQUZFLE9BQVo7QUFJRCxLQU5hLENBQWQ7O0FBUUE7Ozs7O0FBS0EsU0FBSyxRQUFMLEdBQWdCLFVBQVUsR0FBVixFQUFlLE9BQWYsRUFBd0IsVUFBeEIsRUFBb0M7QUFDbEQsVUFBSSxTQUFKO0FBQ0EsVUFBSSxVQUFKLEVBQWdCO0FBQ2QsWUFBSSxXQUFXLElBQUksQ0FBSixHQUFRLElBQUksQ0FBM0I7QUFDQSxZQUFJLFFBQVEsUUFBUSxJQUFSLENBQWEsT0FBYixDQUFaO0FBQ0Esb0JBQVk7QUFDVixpQkFBTyxRQUFRLFFBQVIsR0FBbUIsSUFBSSxDQUF2QixHQUEyQixJQUFJLENBQUosR0FBUSxLQURoQztBQUVWLGtCQUFRLFFBQVEsUUFBUixHQUFtQixJQUFJLENBQUosR0FBUSxLQUEzQixHQUFtQyxJQUFJO0FBRnJDLFNBQVo7QUFJRCxPQVBELE1BT087QUFDTCxvQkFBWTtBQUNWLGlCQUFPLElBQUksQ0FERDtBQUVWLGtCQUFRLElBQUk7QUFGRixTQUFaO0FBSUQ7O0FBRUQsY0FBUSxHQUFSLENBQVksU0FBWjtBQUNELEtBakJEOztBQW1CQTs7O0FBR0EsU0FBSyxXQUFMLEdBQW1CLEtBQUssV0FBTCxDQUFpQixZQUFZO0FBQzlDLFVBQUksVUFBVSxFQUFFLEtBQUssYUFBTCxFQUFGLEVBQXdCLE1BQXhCLEVBQWQ7QUFDQSxjQUFRLFlBQVIsQ0FBcUIsY0FBckIsRUFBcUMsT0FBckMsRUFBOEMsU0FBOUM7QUFDRCxLQUhrQixDQUFuQjs7QUFLQTs7O0FBR0EsU0FBSyxRQUFMLEdBQWdCLFlBQVk7QUFDMUIsYUFBTyxVQUFVLEVBQVYsQ0FBYSxRQUFiLENBQVA7QUFDRCxLQUZEOztBQUlBOzs7QUFHQSxTQUFLLEtBQUwsR0FBYSxZQUFZO0FBQ3ZCO0FBQ0E7QUFDQSxVQUFJLENBQUMsS0FBSyxRQUFMLEVBQUwsRUFBc0I7QUFDcEIsa0JBQVUsS0FBVjtBQUNEO0FBQ0YsS0FORDs7QUFRQTs7OztBQUlBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsYUFBTyxJQUFJLE9BQUosQ0FBWSxVQUFVLENBQVYsQ0FBWixLQUE2QixJQUFJLFNBQUosS0FBa0IsVUFBVSxJQUFWLEVBQXREO0FBQ0QsS0FGRDs7QUFJQTs7O0FBR0EsU0FBSyxLQUFMLEdBQWEsWUFBWTtBQUN2QixjQUFRLE1BQVIsQ0FBZSxNQUFmLEVBQXVCLElBQUksU0FBM0I7QUFDRCxLQUZEO0FBR0QsR0FsdUJEOztBQW91QkEsTUFBSSxZQUFZLFNBQVosU0FBWSxDQUFVLE9BQVYsRUFBbUI7QUFDakMsUUFBSSxPQUFPLElBQVg7O0FBRUEsUUFBSSxZQUFZLFFBQVEsVUFBUixDQUFtQixRQUFuQzs7QUFFQSxTQUFLLE1BQUwsR0FBYztBQUNaLDRCQUFzQiwyQkFBVSxFQUFWLEVBQWMsQ0FBZCxFQUFpQjtBQUNyQyxZQUFJLEtBQUssZUFBTCxFQUFKLEVBQTRCO0FBQzFCLGNBQUksQ0FBQyxFQUFFLE9BQUYsSUFBYSxFQUFFLE9BQWhCLEtBQTRCLEVBQUUsT0FBRixLQUFjLElBQUksSUFBSixDQUFTLENBQXZELEVBQTBEO0FBQ3hELG9CQUFRLE1BQVIsQ0FBZSxrQkFBZjtBQUNBLGlCQUFLLE1BQUwsQ0FBWSxLQUFaOztBQUVBLHVCQUFXLFlBQVk7QUFDckIsbUJBQUssV0FBTDtBQUNELGFBRkQsRUFFRyxDQUZIO0FBR0Q7QUFDRjtBQUNGO0FBWlcsS0FBZDs7QUFlQSxTQUFLLGVBQUwsR0FBdUIsWUFBWTtBQUNqQyxhQUFRLE1BQU0sTUFBTixJQUFnQixNQUFNLGNBQU4sR0FBdUIsRUFBeEMsSUFBK0MsTUFBTSxJQUE1RDtBQUNELEtBRkQ7O0FBSUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsVUFBSSxLQUFLLGVBQUwsRUFBSixFQUE0QjtBQUMxQixhQUFLLE1BQUwsR0FBYyxFQUFFLHVCQUFGLEVBQTJCLElBQTNCLENBQWdDLGlCQUFoQyxFQUFtRCxJQUFuRCxFQUF5RCxHQUF6RCxDQUE2RDtBQUN6RSxvQkFBVSxVQUQrRDtBQUV6RSxnQkFBTSxDQUFDLE1BRmtFO0FBR3pFLG1CQUFTO0FBSGdFLFNBQTdELENBQWQ7QUFLQSxrQkFBVSxNQUFWLENBQWlCLEtBQUssTUFBdEI7O0FBRUEsYUFBSyxNQUFMLENBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsVUFBVSxLQUFWLEVBQWlCO0FBQ3ZDLGtCQUFRLFlBQVIsQ0FBcUIsT0FBckIsRUFBOEIsS0FBOUI7QUFDRCxTQUZEO0FBR0QsT0FYRCxNQVdPO0FBQ0wsa0JBQVUsRUFBVixDQUFhLE9BQWIsRUFBc0IsS0FBSyxZQUEzQjtBQUNEO0FBQ0YsS0FsQkQ7O0FBb0JBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsVUFBSSxLQUFLLGVBQUwsRUFBSixFQUE0QjtBQUMxQixhQUFLLE1BQUwsQ0FBWSxNQUFaO0FBQ0EsYUFBSyxNQUFMLEdBQWMsSUFBZDtBQUNEO0FBQ0YsS0FMRDs7QUFPQSxTQUFLLFdBQUwsR0FBbUIsWUFBWTtBQUM3QixVQUFJLE9BQU8sS0FBSyxNQUFMLENBQVksQ0FBWixFQUFlLFVBQTFCOztBQUVBLFVBQUksSUFBSSxLQUFKLENBQVUsSUFBVixDQUFKLEVBQXFCO0FBQ25CLFlBQUksVUFBVSxLQUFLLEdBQW5CO0FBQ0EsWUFBSSxjQUFjLEtBQUssUUFBUSxLQUFSLENBQWMsR0FBZCxFQUFtQixDQUFuQixDQUFMLENBQWxCO0FBQ0EsWUFBSSxRQUFRLElBQUksVUFBSixDQUFlLFlBQVksTUFBM0IsQ0FBWjtBQUNBLGFBQUssSUFBSSxJQUFJLENBQWIsRUFBZ0IsSUFBSSxZQUFZLE1BQWhDLEVBQXdDLEdBQXhDLEVBQTZDO0FBQzNDLGdCQUFNLENBQU4sSUFBVyxZQUFZLFVBQVosQ0FBdUIsQ0FBdkIsQ0FBWDtBQUNEOztBQUVELFlBQUksT0FBTyxJQUFJLElBQUosQ0FBUyxDQUFDLEtBQUQsQ0FBVCxFQUFrQixFQUFFLE1BQU0sV0FBUixFQUFsQixDQUFYO0FBQ0EsYUFBSyxJQUFMLEdBQVksZUFBWjs7QUFFQSxnQkFBUSxNQUFSLENBQWUscUJBQWY7QUFDQSxnQkFBUSxNQUFSLENBQWUsY0FBZjtBQUNBLGdCQUFRLE1BQVIsQ0FBZSwrQkFBZixFQUFnRCxDQUFDLElBQUQsQ0FBaEQ7QUFDRCxPQWRELE1BY087QUFDTCxZQUFJLGVBQWUsRUFBRSxTQUFGLEVBQWEsSUFBYixDQUFrQixLQUFLLE1BQUwsQ0FBWSxJQUFaLEVBQWxCLEVBQXNDLElBQXRDLEVBQW5CO0FBQ0EsZ0JBQVEsTUFBUixDQUFlLHFCQUFmO0FBQ0EsZ0JBQVEsTUFBUixDQUFlLGNBQWY7O0FBRUEsWUFBSSxZQUFKLEVBQWtCO0FBQ2hCLGtCQUFRLE1BQVIsQ0FBZSxrQkFBZixFQUFtQyxZQUFuQztBQUNEO0FBQ0Y7O0FBRUQsV0FBSyxNQUFMLENBQVksS0FBWjtBQUNELEtBNUJEOztBQThCQTs7Ozs7QUFLQSxTQUFLLFlBQUwsR0FBb0IsVUFBVSxLQUFWLEVBQWlCO0FBQ25DLFVBQUksZ0JBQWdCLE1BQU0sYUFBTixDQUFvQixhQUF4QztBQUNBLFVBQUksaUJBQWlCLGNBQWMsS0FBL0IsSUFBd0MsY0FBYyxLQUFkLENBQW9CLE1BQWhFLEVBQXdFO0FBQ3RFLFlBQUksT0FBTyxLQUFLLElBQUwsQ0FBVSxjQUFjLEtBQXhCLENBQVg7QUFDQSxZQUFJLEtBQUssSUFBTCxLQUFjLE1BQWQsSUFBd0IsS0FBSyxJQUFMLENBQVUsT0FBVixDQUFrQixRQUFsQixNQUFnQyxDQUFDLENBQTdELEVBQWdFO0FBQzlELGtCQUFRLE1BQVIsQ0FBZSwrQkFBZixFQUFnRCxDQUFDLEtBQUssU0FBTCxFQUFELENBQWhEO0FBQ0Q7QUFDRCxnQkFBUSxNQUFSLENBQWUscUJBQWY7QUFDRDtBQUNGLEtBVEQ7QUFVRCxHQWhHRDs7QUFrR0EsTUFBSSxXQUFXLFNBQVgsUUFBVyxDQUFVLE9BQVYsRUFBbUI7QUFDaEMsUUFBSSxZQUFZLEVBQUUsUUFBRixDQUFoQjtBQUNBLFFBQUksVUFBVSxRQUFRLFVBQVIsQ0FBbUIsTUFBakM7QUFDQSxRQUFJLFlBQVksUUFBUSxVQUFSLENBQW1CLFFBQW5DO0FBQ0EsUUFBSSxVQUFVLFFBQVEsT0FBdEI7QUFDQSxRQUFJLE9BQU8sUUFBUSxRQUFuQjtBQUNBLFFBQUksd0JBQXdCLEVBQTVCOztBQUVBLFFBQUksWUFBWSxFQUFFLENBQ2hCLDZCQURnQixFQUVoQix3Q0FGZ0IsRUFHaEIsUUFIZ0IsRUFJaEIsSUFKZ0IsQ0FJWCxFQUpXLENBQUYsRUFJSixTQUpJLENBSU0sT0FKTixDQUFoQjs7QUFNQSxRQUFJLHNCQUFzQixTQUF0QixtQkFBc0IsR0FBWTtBQUNwQyxhQUFPLElBQVAsQ0FBWSxxQkFBWixFQUFtQyxPQUFuQyxDQUEyQyxVQUFVLEdBQVYsRUFBZTtBQUN4RCxrQkFBVSxHQUFWLENBQWMsSUFBSSxNQUFKLENBQVcsQ0FBWCxFQUFjLFdBQWQsRUFBZCxFQUEyQyxzQkFBc0IsR0FBdEIsQ0FBM0M7QUFDRCxPQUZEO0FBR0EsOEJBQXdCLEVBQXhCO0FBQ0QsS0FMRDs7QUFPQTs7O0FBR0EsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsVUFBSSxRQUFRLGtCQUFaLEVBQWdDO0FBQzlCO0FBQ0EsOEJBQXNCLE1BQXRCLEdBQStCLFVBQVUsQ0FBVixFQUFhO0FBQzFDLFlBQUUsY0FBRjtBQUNELFNBRkQ7QUFHQSxrQkFBVSxFQUFWLENBQWEsTUFBYixFQUFxQixzQkFBc0IsTUFBM0M7QUFDRCxPQU5ELE1BTU87QUFDTCxhQUFLLHNCQUFMO0FBQ0Q7QUFDRixLQVZEOztBQVlBOzs7QUFHQSxTQUFLLHNCQUFMLEdBQThCLFlBQVk7QUFDeEMsVUFBSSxhQUFhLEdBQWpCO0FBQUEsVUFDSSxtQkFBbUIsVUFBVSxJQUFWLENBQWUsd0JBQWYsQ0FEdkI7O0FBR0EsNEJBQXNCLFdBQXRCLEdBQW9DLFVBQVUsQ0FBVixFQUFhO0FBQy9DLFlBQUksYUFBYSxRQUFRLE1BQVIsQ0FBZSxzQkFBZixDQUFqQjtBQUNBLFlBQUksZ0JBQWdCLFFBQVEsS0FBUixLQUFrQixDQUFsQixJQUF1QixRQUFRLE1BQVIsS0FBbUIsQ0FBOUQ7QUFDQSxZQUFJLENBQUMsVUFBRCxJQUFlLENBQUMsV0FBVyxNQUEzQixJQUFxQyxhQUF6QyxFQUF3RDtBQUN0RCxrQkFBUSxRQUFSLENBQWlCLFVBQWpCO0FBQ0Esb0JBQVUsS0FBVixDQUFnQixRQUFRLEtBQVIsRUFBaEI7QUFDQSxvQkFBVSxNQUFWLENBQWlCLFFBQVEsTUFBUixFQUFqQjtBQUNBLDJCQUFpQixJQUFqQixDQUFzQixLQUFLLEtBQUwsQ0FBVyxhQUFqQztBQUNEO0FBQ0QscUJBQWEsV0FBVyxHQUFYLENBQWUsRUFBRSxNQUFqQixDQUFiO0FBQ0QsT0FWRDs7QUFZQSw0QkFBc0IsV0FBdEIsR0FBb0MsVUFBVSxDQUFWLEVBQWE7QUFDL0MscUJBQWEsV0FBVyxHQUFYLENBQWUsRUFBRSxNQUFqQixDQUFiO0FBQ0EsWUFBSSxDQUFDLFdBQVcsTUFBaEIsRUFBd0I7QUFDdEIsa0JBQVEsV0FBUixDQUFvQixVQUFwQjtBQUNEO0FBQ0YsT0FMRDs7QUFPQSw0QkFBc0IsTUFBdEIsR0FBK0IsWUFBWTtBQUN6QyxxQkFBYSxHQUFiO0FBQ0EsZ0JBQVEsV0FBUixDQUFvQixVQUFwQjtBQUNELE9BSEQ7O0FBS0E7QUFDQTtBQUNBLGdCQUFVLEVBQVYsQ0FBYSxXQUFiLEVBQTBCLHNCQUFzQixXQUFoRCxFQUNHLEVBREgsQ0FDTSxXQUROLEVBQ21CLHNCQUFzQixXQUR6QyxFQUVHLEVBRkgsQ0FFTSxNQUZOLEVBRWMsc0JBQXNCLE1BRnBDOztBQUlBO0FBQ0EsZ0JBQVUsRUFBVixDQUFhLFdBQWIsRUFBMEIsWUFBWTtBQUNwQyxrQkFBVSxRQUFWLENBQW1CLE9BQW5CO0FBQ0EseUJBQWlCLElBQWpCLENBQXNCLEtBQUssS0FBTCxDQUFXLFNBQWpDO0FBQ0QsT0FIRCxFQUdHLEVBSEgsQ0FHTSxXQUhOLEVBR21CLFlBQVk7QUFDN0Isa0JBQVUsV0FBVixDQUFzQixPQUF0QjtBQUNBLHlCQUFpQixJQUFqQixDQUFzQixLQUFLLEtBQUwsQ0FBVyxhQUFqQztBQUNELE9BTkQ7O0FBUUE7QUFDQSxnQkFBVSxFQUFWLENBQWEsTUFBYixFQUFxQixVQUFVLEtBQVYsRUFBaUI7QUFDcEMsWUFBSSxlQUFlLE1BQU0sYUFBTixDQUFvQixZQUF2Qzs7QUFFQSxZQUFJLGdCQUFnQixhQUFhLEtBQTdCLElBQXNDLGFBQWEsS0FBYixDQUFtQixNQUE3RCxFQUFxRTtBQUNuRSxnQkFBTSxjQUFOO0FBQ0Esb0JBQVUsS0FBVjtBQUNBLGtCQUFRLE1BQVIsQ0FBZSwrQkFBZixFQUFnRCxhQUFhLEtBQTdEO0FBQ0QsU0FKRCxNQUlPO0FBQ0wsWUFBRSxJQUFGLENBQU8sYUFBYSxLQUFwQixFQUEyQixVQUFVLEdBQVYsRUFBZSxJQUFmLEVBQXFCO0FBQzlDLGdCQUFJLFVBQVUsYUFBYSxPQUFiLENBQXFCLElBQXJCLENBQWQ7O0FBRUEsZ0JBQUksS0FBSyxXQUFMLEdBQW1CLE9BQW5CLENBQTJCLE1BQTNCLElBQXFDLENBQUMsQ0FBMUMsRUFBNkM7QUFDM0Msc0JBQVEsTUFBUixDQUFlLGtCQUFmLEVBQW1DLE9BQW5DO0FBQ0QsYUFGRCxNQUVPO0FBQ0wsZ0JBQUUsT0FBRixFQUFXLElBQVgsQ0FBZ0IsWUFBWTtBQUMxQix3QkFBUSxNQUFSLENBQWUsbUJBQWYsRUFBb0MsSUFBcEM7QUFDRCxlQUZEO0FBR0Q7QUFDRixXQVZEO0FBV0Q7QUFDRixPQXBCRCxFQW9CRyxFQXBCSCxDQW9CTSxVQXBCTixFQW9Ca0IsS0FwQmxCLEVBNUN3QyxDQWdFZDtBQUMzQixLQWpFRDs7QUFtRUEsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QjtBQUNELEtBRkQ7QUFHRCxHQTdHRDs7QUFnSEEsTUFBSSxVQUFKO0FBQ0EsTUFBSSxNQUFNLGFBQVYsRUFBeUI7QUFDdkIsUUFBSSxNQUFNLFlBQVYsRUFBd0I7QUFDdEIsY0FBUSxDQUFDLFlBQUQsQ0FBUixFQUF3QixVQUFVLEVBQVYsRUFBYztBQUNwQyxxQkFBYSxFQUFiO0FBQ0QsT0FGRDtBQUdELEtBSkQsTUFJTztBQUNMLG1CQUFhLE9BQU8sVUFBcEI7QUFDRDtBQUNGOztBQUVEOzs7QUFHQSxNQUFJLFdBQVcsU0FBWCxRQUFXLENBQVUsT0FBVixFQUFtQjtBQUNoQyxRQUFJLFVBQVUsUUFBUSxVQUFSLENBQW1CLE1BQWpDO0FBQ0EsUUFBSSxZQUFZLFFBQVEsVUFBUixDQUFtQixRQUFuQztBQUNBLFFBQUksV0FBVyxRQUFRLFVBQVIsQ0FBbUIsT0FBbEM7QUFDQSxRQUFJLFVBQVUsUUFBUSxPQUF0Qjs7QUFFQSxTQUFLLElBQUwsR0FBWSxZQUFZO0FBQ3RCLFVBQUksYUFBYSxLQUFLLFdBQUwsRUFBakI7QUFDQSxVQUFJLGNBQWMsTUFBTSxhQUF4QixFQUF1QztBQUNyQyxpQkFBUyxJQUFULENBQWMsVUFBZCxFQUEwQixJQUExQjtBQUNEO0FBQ0YsS0FMRDs7QUFPQTs7O0FBR0EsU0FBSyxXQUFMLEdBQW1CLFlBQVk7QUFDN0IsYUFBTyxRQUFRLFFBQVIsQ0FBaUIsVUFBakIsQ0FBUDtBQUNELEtBRkQ7O0FBSUE7OztBQUdBLFNBQUssTUFBTCxHQUFjLFlBQVk7QUFDeEIsVUFBSSxLQUFLLFdBQUwsRUFBSixFQUF3QjtBQUN0QixhQUFLLFVBQUw7QUFDRCxPQUZELE1BRU87QUFDTCxhQUFLLFFBQUw7QUFDRDtBQUNELGNBQVEsWUFBUixDQUFxQixrQkFBckI7QUFDRCxLQVBEOztBQVNBOzs7QUFHQSxTQUFLLFFBQUwsR0FBZ0IsWUFBWTtBQUMxQixlQUFTLEdBQVQsQ0FBYSxJQUFJLElBQUosQ0FBUyxTQUFULEVBQW9CLFFBQVEsWUFBNUIsQ0FBYjtBQUNBLGVBQVMsTUFBVCxDQUFnQixVQUFVLE1BQVYsRUFBaEI7O0FBRUEsY0FBUSxNQUFSLENBQWUsd0JBQWYsRUFBeUMsSUFBekM7QUFDQSxjQUFRLFFBQVIsQ0FBaUIsVUFBakI7QUFDQSxlQUFTLEtBQVQ7O0FBRUE7QUFDQSxVQUFJLE1BQU0sYUFBVixFQUF5QjtBQUN2QixZQUFJLFdBQVcsV0FBVyxZQUFYLENBQXdCLFNBQVMsQ0FBVCxDQUF4QixFQUFxQyxRQUFRLFVBQTdDLENBQWY7O0FBRUE7QUFDQSxZQUFJLFFBQVEsVUFBUixDQUFtQixJQUF2QixFQUE2QjtBQUMzQixjQUFJLFNBQVMsSUFBSSxXQUFXLFVBQWYsQ0FBMEIsUUFBUSxVQUFSLENBQW1CLElBQTdDLENBQWI7QUFDQSxtQkFBUyxVQUFULEdBQXNCLE1BQXRCO0FBQ0EsbUJBQVMsRUFBVCxDQUFZLGdCQUFaLEVBQThCLFVBQVUsRUFBVixFQUFjO0FBQzFDLG1CQUFPLGNBQVAsQ0FBc0IsRUFBdEI7QUFDRCxXQUZEO0FBR0Q7O0FBRUQ7QUFDQSxpQkFBUyxPQUFULENBQWlCLElBQWpCLEVBQXVCLFVBQVUsV0FBVixFQUF2QjtBQUNBLGlCQUFTLElBQVQsQ0FBYyxVQUFkLEVBQTBCLFFBQTFCO0FBQ0Q7QUFDRixLQXpCRDs7QUEyQkE7OztBQUdBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCO0FBQ0EsVUFBSSxNQUFNLGFBQVYsRUFBeUI7QUFDdkIsWUFBSSxXQUFXLFNBQVMsSUFBVCxDQUFjLFVBQWQsQ0FBZjtBQUNBLGlCQUFTLEdBQVQsQ0FBYSxTQUFTLFFBQVQsRUFBYjtBQUNBLGlCQUFTLFVBQVQ7QUFDRDs7QUFFRCxVQUFJLFFBQVEsSUFBSSxLQUFKLENBQVUsUUFBVixFQUFvQixRQUFRLFlBQTVCLEtBQTZDLElBQUksU0FBN0Q7QUFDQSxVQUFJLFdBQVcsVUFBVSxJQUFWLE9BQXFCLEtBQXBDOztBQUVBLGdCQUFVLElBQVYsQ0FBZSxLQUFmO0FBQ0EsZ0JBQVUsTUFBVixDQUFpQixRQUFRLE1BQVIsR0FBaUIsU0FBUyxNQUFULEVBQWpCLEdBQXFDLE1BQXREO0FBQ0EsY0FBUSxXQUFSLENBQW9CLFVBQXBCOztBQUVBLFVBQUksUUFBSixFQUFjO0FBQ1osZ0JBQVEsWUFBUixDQUFxQixRQUFyQixFQUErQixVQUFVLElBQVYsRUFBL0IsRUFBaUQsU0FBakQ7QUFDRDs7QUFFRCxnQkFBVSxLQUFWOztBQUVBLGNBQVEsTUFBUixDQUFlLHdCQUFmLEVBQXlDLEtBQXpDO0FBQ0QsS0F0QkQ7O0FBd0JBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsVUFBSSxLQUFLLFdBQUwsRUFBSixFQUF3QjtBQUN0QixhQUFLLFVBQUw7QUFDRDtBQUNGLEtBSkQ7QUFLRCxHQTlGRDs7QUFnR0EsTUFBSSxtQkFBbUIsRUFBdkI7O0FBRUEsTUFBSSxZQUFZLFNBQVosU0FBWSxDQUFVLE9BQVYsRUFBbUI7QUFDakMsUUFBSSxZQUFZLEVBQUUsUUFBRixDQUFoQjtBQUNBLFFBQUksYUFBYSxRQUFRLFVBQVIsQ0FBbUIsU0FBcEM7QUFDQSxRQUFJLFlBQVksUUFBUSxVQUFSLENBQW1CLFFBQW5DO0FBQ0EsUUFBSSxVQUFVLFFBQVEsT0FBdEI7O0FBRUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsVUFBSSxRQUFRLE9BQVIsSUFBbUIsUUFBUSxtQkFBL0IsRUFBb0Q7QUFDbEQ7QUFDRDs7QUFFRCxpQkFBVyxFQUFYLENBQWMsV0FBZCxFQUEyQixVQUFVLEtBQVYsRUFBaUI7QUFDMUMsY0FBTSxjQUFOO0FBQ0EsY0FBTSxlQUFOOztBQUVBLFlBQUksY0FBYyxVQUFVLE1BQVYsR0FBbUIsR0FBbkIsR0FBeUIsVUFBVSxTQUFWLEVBQTNDOztBQUVBLGtCQUFVLEVBQVYsQ0FBYSxXQUFiLEVBQTBCLFVBQVUsS0FBVixFQUFpQjtBQUN6QyxjQUFJLFNBQVMsTUFBTSxPQUFOLElBQWlCLGNBQWMsZ0JBQS9CLENBQWI7O0FBRUEsbUJBQVUsUUFBUSxTQUFSLEdBQW9CLENBQXJCLEdBQTBCLEtBQUssR0FBTCxDQUFTLE1BQVQsRUFBaUIsUUFBUSxTQUF6QixDQUExQixHQUFnRSxNQUF6RTtBQUNBLG1CQUFVLFFBQVEsU0FBUixHQUFvQixDQUFyQixHQUEwQixLQUFLLEdBQUwsQ0FBUyxNQUFULEVBQWlCLFFBQVEsU0FBekIsQ0FBMUIsR0FBZ0UsTUFBekU7O0FBRUEsb0JBQVUsTUFBVixDQUFpQixNQUFqQjtBQUNELFNBUEQsRUFPRyxHQVBILENBT08sU0FQUCxFQU9rQixZQUFZO0FBQzVCLG9CQUFVLEdBQVYsQ0FBYyxXQUFkO0FBQ0QsU0FURDtBQVVELE9BaEJEO0FBaUJELEtBdEJEOztBQXdCQSxTQUFLLE9BQUwsR0FBZSxZQUFZO0FBQ3pCLGlCQUFXLEdBQVg7QUFDQSxpQkFBVyxNQUFYO0FBQ0QsS0FIRDtBQUlELEdBbENEOztBQW9DQSxNQUFJLGFBQWEsU0FBYixVQUFhLENBQVUsT0FBVixFQUFtQjtBQUNsQyxRQUFJLFVBQVUsUUFBUSxVQUFSLENBQW1CLE1BQWpDO0FBQ0EsUUFBSSxXQUFXLFFBQVEsVUFBUixDQUFtQixPQUFsQztBQUNBLFFBQUksWUFBWSxRQUFRLFVBQVIsQ0FBbUIsUUFBbkM7QUFDQSxRQUFJLFdBQVcsUUFBUSxVQUFSLENBQW1CLE9BQWxDOztBQUVBLFFBQUksVUFBVSxFQUFFLE1BQUYsQ0FBZDtBQUNBLFFBQUksYUFBYSxFQUFFLFlBQUYsQ0FBakI7O0FBRUE7OztBQUdBLFNBQUssTUFBTCxHQUFjLFlBQVk7QUFDeEIsVUFBSSxTQUFTLFNBQVQsTUFBUyxDQUFVLElBQVYsRUFBZ0I7QUFDM0Isa0JBQVUsR0FBVixDQUFjLFFBQWQsRUFBd0IsS0FBSyxDQUE3QjtBQUNBLGlCQUFTLEdBQVQsQ0FBYSxRQUFiLEVBQXVCLEtBQUssQ0FBNUI7QUFDQSxZQUFJLFNBQVMsSUFBVCxDQUFjLFVBQWQsQ0FBSixFQUErQjtBQUM3QixtQkFBUyxJQUFULENBQWMsVUFBZCxFQUEwQixPQUExQixDQUFrQyxJQUFsQyxFQUF3QyxLQUFLLENBQTdDO0FBQ0Q7QUFDRixPQU5EOztBQVFBLGNBQVEsV0FBUixDQUFvQixZQUFwQjtBQUNBLFVBQUksS0FBSyxZQUFMLEVBQUosRUFBeUI7QUFDdkIsa0JBQVUsSUFBVixDQUFlLFdBQWYsRUFBNEIsVUFBVSxHQUFWLENBQWMsUUFBZCxDQUE1Qjs7QUFFQSxnQkFBUSxFQUFSLENBQVcsUUFBWCxFQUFxQixZQUFZO0FBQy9CLGlCQUFPO0FBQ0wsZUFBRyxRQUFRLE1BQVIsS0FBbUIsU0FBUyxXQUFUO0FBRGpCLFdBQVA7QUFHRCxTQUpELEVBSUcsT0FKSCxDQUlXLFFBSlg7O0FBTUEsbUJBQVcsR0FBWCxDQUFlLFVBQWYsRUFBMkIsUUFBM0I7QUFDRCxPQVZELE1BVU87QUFDTCxnQkFBUSxHQUFSLENBQVksUUFBWjtBQUNBLGVBQU87QUFDTCxhQUFHLFVBQVUsSUFBVixDQUFlLFdBQWY7QUFERSxTQUFQO0FBR0EsbUJBQVcsR0FBWCxDQUFlLFVBQWYsRUFBMkIsU0FBM0I7QUFDRDs7QUFFRCxjQUFRLE1BQVIsQ0FBZSwwQkFBZixFQUEyQyxLQUFLLFlBQUwsRUFBM0M7QUFDRCxLQTdCRDs7QUErQkEsU0FBSyxZQUFMLEdBQW9CLFlBQVk7QUFDOUIsYUFBTyxRQUFRLFFBQVIsQ0FBaUIsWUFBakIsQ0FBUDtBQUNELEtBRkQ7QUFHRCxHQTlDRDs7QUFnREEsTUFBSSxTQUFTLFNBQVQsTUFBUyxDQUFVLE9BQVYsRUFBbUI7QUFDOUIsUUFBSSxPQUFPLElBQVg7O0FBRUEsUUFBSSxZQUFZLEVBQUUsUUFBRixDQUFoQjtBQUNBLFFBQUksZUFBZSxRQUFRLFVBQVIsQ0FBbUIsV0FBdEM7QUFDQSxRQUFJLFVBQVUsUUFBUSxPQUF0Qjs7QUFFQSxTQUFLLE1BQUwsR0FBYztBQUNaLDhCQUF3Qiw2QkFBVSxFQUFWLEVBQWMsQ0FBZCxFQUFpQjtBQUN2QyxZQUFJLEtBQUssTUFBTCxDQUFZLEVBQUUsTUFBZCxDQUFKLEVBQTJCO0FBQ3pCLFlBQUUsY0FBRjtBQUNEO0FBQ0YsT0FMVztBQU1aLHNGQUFnRixnRkFBWTtBQUMxRixhQUFLLE1BQUw7QUFDRDtBQVJXLEtBQWQ7O0FBV0EsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsV0FBSyxPQUFMLEdBQWUsRUFBRSxDQUNmLDJCQURlLEVBRWYsc0NBRmUsRUFHZiwrQ0FIZSxFQUlmLHlEQUplLEVBS2YseURBTGUsRUFNZix5REFOZSxFQU9mLGNBUGUsRUFRZCxRQUFRLGtCQUFSLEdBQTZCLHFCQUE3QixHQUFxRCxxQkFSdkMsRUFTZiwwQkFUZSxFQVVkLFFBQVEsa0JBQVIsR0FBNkIsRUFBN0IsR0FBa0MsaURBVnBCLEVBV2YsUUFYZSxFQVlmLFFBWmUsRUFhZixJQWJlLENBYVYsRUFiVSxDQUFGLEVBYUgsU0FiRyxDQWFPLFlBYlAsQ0FBZjs7QUFlQSxXQUFLLE9BQUwsQ0FBYSxFQUFiLENBQWdCLFdBQWhCLEVBQTZCLFVBQVUsS0FBVixFQUFpQjtBQUM1QyxZQUFJLElBQUksZUFBSixDQUFvQixNQUFNLE1BQTFCLENBQUosRUFBdUM7QUFDckMsZ0JBQU0sY0FBTjtBQUNBLGdCQUFNLGVBQU47O0FBRUEsY0FBSSxVQUFVLEtBQUssT0FBTCxDQUFhLElBQWIsQ0FBa0IseUJBQWxCLEVBQTZDLElBQTdDLENBQWtELFFBQWxELENBQWQ7QUFBQSxjQUNJLFdBQVcsUUFBUSxNQUFSLEVBRGY7QUFBQSxjQUVJLFlBQVksVUFBVSxTQUFWLEVBRmhCOztBQUlBLG9CQUFVLEVBQVYsQ0FBYSxXQUFiLEVBQTBCLFVBQVUsS0FBVixFQUFpQjtBQUN6QyxvQkFBUSxNQUFSLENBQWUsaUJBQWYsRUFBa0M7QUFDaEMsaUJBQUcsTUFBTSxPQUFOLEdBQWdCLFNBQVMsSUFESTtBQUVoQyxpQkFBRyxNQUFNLE9BQU4sSUFBaUIsU0FBUyxHQUFULEdBQWUsU0FBaEM7QUFGNkIsYUFBbEMsRUFHRyxPQUhILEVBR1ksQ0FBQyxNQUFNLFFBSG5COztBQUtBLGlCQUFLLE1BQUwsQ0FBWSxRQUFRLENBQVIsQ0FBWjtBQUNELFdBUEQsRUFPRyxHQVBILENBT08sU0FQUCxFQU9rQixVQUFVLENBQVYsRUFBYTtBQUM3QixjQUFFLGNBQUY7QUFDQSxzQkFBVSxHQUFWLENBQWMsV0FBZDtBQUNBLG9CQUFRLE1BQVIsQ0FBZSxxQkFBZjtBQUNELFdBWEQ7O0FBYUEsY0FBSSxDQUFDLFFBQVEsSUFBUixDQUFhLE9BQWIsQ0FBTCxFQUE0QjtBQUFFO0FBQzVCLG9CQUFRLElBQVIsQ0FBYSxPQUFiLEVBQXNCLFFBQVEsTUFBUixLQUFtQixRQUFRLEtBQVIsRUFBekM7QUFDRDtBQUNGO0FBQ0YsT0ExQkQ7QUEyQkQsS0EzQ0Q7O0FBNkNBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsV0FBSyxPQUFMLENBQWEsTUFBYjtBQUNELEtBRkQ7O0FBSUEsU0FBSyxNQUFMLEdBQWMsVUFBVSxNQUFWLEVBQWtCO0FBQzlCLFVBQUksVUFBVSxJQUFJLEtBQUosQ0FBVSxNQUFWLENBQWQ7QUFDQSxVQUFJLGFBQWEsS0FBSyxPQUFMLENBQWEsSUFBYixDQUFrQix5QkFBbEIsQ0FBakI7O0FBRUEsY0FBUSxNQUFSLENBQWUscUJBQWYsRUFBc0MsTUFBdEM7O0FBRUEsVUFBSSxPQUFKLEVBQWE7QUFDWCxZQUFJLFNBQVMsRUFBRSxNQUFGLENBQWI7QUFDQSxZQUFJLE1BQU0sT0FBTyxRQUFQLEVBQVY7O0FBRUE7QUFDQSxZQUFJLFlBQVk7QUFDZCxhQUFHLE9BQU8sVUFBUCxDQUFrQixJQUFsQixDQURXO0FBRWQsYUFBRyxPQUFPLFdBQVAsQ0FBbUIsSUFBbkI7QUFGVyxTQUFoQjs7QUFLQSxtQkFBVyxHQUFYLENBQWU7QUFDYixtQkFBUyxPQURJO0FBRWIsZ0JBQU0sSUFBSSxJQUZHO0FBR2IsZUFBSyxJQUFJLEdBSEk7QUFJYixpQkFBTyxVQUFVLENBSko7QUFLYixrQkFBUSxVQUFVO0FBTEwsU0FBZixFQU1HLElBTkgsQ0FNUSxRQU5SLEVBTWtCLE1BTmxCLEVBVlcsQ0FnQmdCOztBQUUzQixZQUFJLGFBQWEsVUFBVSxDQUFWLEdBQWMsR0FBZCxHQUFvQixVQUFVLENBQS9DO0FBQ0EsbUJBQVcsSUFBWCxDQUFnQiw4QkFBaEIsRUFBZ0QsSUFBaEQsQ0FBcUQsVUFBckQ7QUFDQSxnQkFBUSxNQUFSLENBQWUsbUJBQWYsRUFBb0MsTUFBcEM7QUFDRCxPQXJCRCxNQXFCTztBQUNMLGFBQUssSUFBTDtBQUNEOztBQUVELGFBQU8sT0FBUDtBQUNELEtBaENEOztBQWtDQTs7Ozs7QUFLQSxTQUFLLElBQUwsR0FBWSxZQUFZO0FBQ3RCLGNBQVEsTUFBUixDQUFlLG9CQUFmO0FBQ0EsV0FBSyxPQUFMLENBQWEsUUFBYixHQUF3QixJQUF4QjtBQUNELEtBSEQ7QUFJRCxHQTlHRDs7QUFnSEEsTUFBSSxXQUFXLFNBQVgsUUFBVyxDQUFVLE9BQVYsRUFBbUI7QUFDaEMsUUFBSSxPQUFPLElBQVg7QUFDQSxRQUFJLGdCQUFnQixTQUFwQjtBQUNBLFFBQUksY0FBYywyRUFBbEI7O0FBRUEsU0FBSyxNQUFMLEdBQWM7QUFDWiwwQkFBb0IseUJBQVUsRUFBVixFQUFjLENBQWQsRUFBaUI7QUFDbkMsWUFBSSxDQUFDLEVBQUUsa0JBQUYsRUFBTCxFQUE2QjtBQUMzQixlQUFLLFdBQUwsQ0FBaUIsQ0FBakI7QUFDRDtBQUNGLE9BTFc7QUFNWiw0QkFBc0IsMkJBQVUsRUFBVixFQUFjLENBQWQsRUFBaUI7QUFDckMsYUFBSyxhQUFMLENBQW1CLENBQW5CO0FBQ0Q7QUFSVyxLQUFkOztBQVdBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCLFdBQUssYUFBTCxHQUFxQixJQUFyQjtBQUNELEtBRkQ7O0FBSUEsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QixXQUFLLGFBQUwsR0FBcUIsSUFBckI7QUFDRCxLQUZEOztBQUlBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsVUFBSSxDQUFDLEtBQUssYUFBVixFQUF5QjtBQUN2QjtBQUNEOztBQUVELFVBQUksVUFBVSxLQUFLLGFBQUwsQ0FBbUIsUUFBbkIsRUFBZDtBQUNBLFVBQUksUUFBUSxRQUFRLEtBQVIsQ0FBYyxXQUFkLENBQVo7O0FBRUEsVUFBSSxVQUFVLE1BQU0sQ0FBTixLQUFZLE1BQU0sQ0FBTixDQUF0QixDQUFKLEVBQXFDO0FBQ25DLFlBQUksT0FBTyxNQUFNLENBQU4sSUFBVyxPQUFYLEdBQXFCLGdCQUFnQixPQUFoRDtBQUNBLFlBQUksT0FBTyxFQUFFLE9BQUYsRUFBVyxJQUFYLENBQWdCLE9BQWhCLEVBQXlCLElBQXpCLENBQThCLE1BQTlCLEVBQXNDLElBQXRDLEVBQTRDLENBQTVDLENBQVg7O0FBRUEsYUFBSyxhQUFMLENBQW1CLFVBQW5CLENBQThCLElBQTlCO0FBQ0EsYUFBSyxhQUFMLEdBQXFCLElBQXJCO0FBQ0EsZ0JBQVEsTUFBUixDQUFlLGNBQWY7QUFDRDtBQUVGLEtBakJEOztBQW1CQSxTQUFLLGFBQUwsR0FBcUIsVUFBVSxDQUFWLEVBQWE7QUFDaEMsVUFBSSxLQUFLLFFBQUwsQ0FBYyxDQUFDLElBQUksSUFBSixDQUFTLEtBQVYsRUFBaUIsSUFBSSxJQUFKLENBQVMsS0FBMUIsQ0FBZCxFQUFnRCxFQUFFLE9BQWxELENBQUosRUFBZ0U7QUFDOUQsWUFBSSxZQUFZLFFBQVEsTUFBUixDQUFlLG9CQUFmLEVBQXFDLFlBQXJDLEVBQWhCO0FBQ0EsYUFBSyxhQUFMLEdBQXFCLFNBQXJCO0FBQ0Q7QUFDRixLQUxEOztBQU9BLFNBQUssV0FBTCxHQUFtQixVQUFVLENBQVYsRUFBYTtBQUM5QixVQUFJLEtBQUssUUFBTCxDQUFjLENBQUMsSUFBSSxJQUFKLENBQVMsS0FBVixFQUFpQixJQUFJLElBQUosQ0FBUyxLQUExQixDQUFkLEVBQWdELEVBQUUsT0FBbEQsQ0FBSixFQUFnRTtBQUM5RCxhQUFLLE9BQUw7QUFDRDtBQUNGLEtBSkQ7QUFLRCxHQXZERDs7QUF5REE7OztBQUdBLE1BQUksV0FBVyxTQUFYLFFBQVcsQ0FBVSxPQUFWLEVBQW1CO0FBQ2hDLFFBQUksUUFBUSxRQUFRLFVBQVIsQ0FBbUIsSUFBL0I7O0FBRUEsU0FBSyxNQUFMLEdBQWM7QUFDWiwyQkFBcUIsNEJBQVk7QUFDL0IsY0FBTSxHQUFOLENBQVUsUUFBUSxNQUFSLENBQWUsTUFBZixDQUFWO0FBQ0Q7QUFIVyxLQUFkOztBQU1BLFNBQUssZ0JBQUwsR0FBd0IsWUFBWTtBQUNsQyxhQUFPLElBQUksVUFBSixDQUFlLE1BQU0sQ0FBTixDQUFmLENBQVA7QUFDRCxLQUZEO0FBR0QsR0FaRDs7QUFjQSxNQUFJLGNBQWMsU0FBZCxXQUFjLENBQVUsT0FBVixFQUFtQjtBQUNuQyxRQUFJLE9BQU8sSUFBWDtBQUNBLFFBQUksZUFBZSxRQUFRLFVBQVIsQ0FBbUIsV0FBdEM7QUFDQSxRQUFJLFVBQVUsUUFBUSxPQUF0Qjs7QUFFQSxTQUFLLE1BQUwsR0FBYztBQUNaLDJDQUFxQywwQ0FBWTtBQUMvQyxhQUFLLE1BQUw7QUFDRCxPQUhXO0FBSVoscUNBQStCLHFDQUFZO0FBQ3pDLGFBQUssTUFBTDtBQUNEO0FBTlcsS0FBZDs7QUFTQSxTQUFLLGdCQUFMLEdBQXdCLFlBQVk7QUFDbEMsYUFBTyxDQUFDLENBQUMsUUFBUSxXQUFqQjtBQUNELEtBRkQ7O0FBSUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsV0FBSyxZQUFMLEdBQW9CLEVBQUUsZ0NBQUYsQ0FBcEI7QUFDQSxXQUFLLFlBQUwsQ0FBa0IsRUFBbEIsQ0FBcUIsT0FBckIsRUFBOEIsWUFBWTtBQUN4QyxnQkFBUSxNQUFSLENBQWUsT0FBZjtBQUNELE9BRkQsRUFFRyxJQUZILENBRVEsUUFBUSxXQUZoQixFQUU2QixTQUY3QixDQUV1QyxZQUZ2QztBQUdELEtBTEQ7O0FBT0EsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QixXQUFLLFlBQUwsQ0FBa0IsTUFBbEI7QUFDRCxLQUZEOztBQUlBLFNBQUssTUFBTCxHQUFjLFlBQVk7QUFDeEIsVUFBSSxTQUFTLENBQUMsUUFBUSxNQUFSLENBQWUsc0JBQWYsQ0FBRCxJQUEyQyxRQUFRLE1BQVIsQ0FBZSxnQkFBZixDQUF4RDtBQUNBLFdBQUssWUFBTCxDQUFrQixNQUFsQixDQUF5QixNQUF6QjtBQUNELEtBSEQ7QUFJRCxHQWpDRDs7QUFtQ0EsTUFBSSxVQUFVLFNBQVYsT0FBVSxDQUFVLE9BQVYsRUFBbUI7QUFDL0IsUUFBSSxPQUFPLElBQVg7QUFDQSxRQUFJLEtBQUssRUFBRSxVQUFGLENBQWEsRUFBdEI7O0FBRUEsUUFBSSxXQUFXLFFBQVEsVUFBUixDQUFtQixPQUFsQztBQUNBLFFBQUksVUFBVSxRQUFRLE9BQXRCO0FBQ0EsUUFBSSxPQUFPLFFBQVEsUUFBbkI7O0FBRUEsUUFBSSxpQkFBaUIsS0FBSyxZQUFMLENBQWtCLFFBQVEsTUFBUixDQUFlLE1BQU0sS0FBTixHQUFjLEtBQWQsR0FBc0IsSUFBckMsQ0FBbEIsQ0FBckI7O0FBRUEsUUFBSSxvQkFBb0IsS0FBSyxpQkFBTCxHQUF5QixVQUFVLFlBQVYsRUFBd0I7QUFDdkUsVUFBSSxXQUFXLGVBQWUsWUFBZixDQUFmO0FBQ0EsVUFBSSxDQUFDLFFBQVEsU0FBVCxJQUFzQixDQUFDLFFBQTNCLEVBQXFDO0FBQ25DLGVBQU8sRUFBUDtBQUNEOztBQUVELFVBQUksTUFBTSxLQUFWLEVBQWlCO0FBQ2YsbUJBQVcsU0FBUyxPQUFULENBQWlCLEtBQWpCLEVBQXdCLEdBQXhCLEVBQTZCLE9BQTdCLENBQXFDLE9BQXJDLEVBQThDLEdBQTlDLENBQVg7QUFDRDs7QUFFRCxpQkFBVyxTQUFTLE9BQVQsQ0FBaUIsV0FBakIsRUFBOEIsSUFBOUIsRUFDUyxPQURULENBQ2lCLE9BRGpCLEVBQzBCLEdBRDFCLEVBRVMsT0FGVCxDQUVpQixhQUZqQixFQUVnQyxHQUZoQyxFQUdTLE9BSFQsQ0FHaUIsY0FIakIsRUFHaUMsR0FIakMsQ0FBWDs7QUFLQSxhQUFPLE9BQU8sUUFBUCxHQUFrQixHQUF6QjtBQUNELEtBaEJEOztBQWtCQSxTQUFLLFVBQUwsR0FBa0IsWUFBWTtBQUM1QixXQUFLLGlCQUFMO0FBQ0EsV0FBSyxzQkFBTDtBQUNBLFdBQUsscUJBQUw7QUFDQSxXQUFLLGdCQUFMLEdBQXdCLEVBQXhCO0FBQ0QsS0FMRDs7QUFPQSxTQUFLLE9BQUwsR0FBZSxZQUFZO0FBQ3pCLGFBQU8sS0FBSyxnQkFBWjtBQUNELEtBRkQ7O0FBSUEsU0FBSyxlQUFMLEdBQXVCLFVBQVUsSUFBVixFQUFnQjtBQUNyQyxVQUFJLENBQUMsS0FBSyxnQkFBTCxDQUFzQixjQUF0QixDQUFxQyxJQUFyQyxDQUFMLEVBQWlEO0FBQy9DLGFBQUssZ0JBQUwsQ0FBc0IsSUFBdEIsSUFBOEIsTUFBTSxlQUFOLENBQXNCLElBQXRCLEtBQzVCLEtBQUssUUFBTCxDQUFjLFFBQVEsb0JBQXRCLEVBQTRDLElBQTVDLENBREY7QUFFRDs7QUFFRCxhQUFPLEtBQUssZ0JBQUwsQ0FBc0IsSUFBdEIsQ0FBUDtBQUNELEtBUEQ7O0FBU0EsU0FBSyxpQkFBTCxHQUF5QixZQUFZO0FBQ25DLGNBQVEsSUFBUixDQUFhLGNBQWIsRUFBNkIsWUFBWTtBQUN2QyxlQUFPLEdBQUcsV0FBSCxDQUFlLENBQ3BCLEdBQUcsTUFBSCxDQUFVO0FBQ1IscUJBQVcsaUJBREg7QUFFUixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxLQUF0QixJQUErQixHQUEvQixHQUFxQyxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxLQUF0QixFQUE2QixNQUE3QixDQUZ2QztBQUdSLG1CQUFTLEtBQUssS0FBTCxDQUFXLEtBSFo7QUFJUixnQkFBTTtBQUNKLG9CQUFRO0FBREo7QUFKRSxTQUFWLENBRG9CLEVBU3BCLEdBQUcsUUFBSCxDQUFZO0FBQ1YscUJBQVcsZ0JBREQ7QUFFVixpQkFBTyxRQUFRLE9BQVIsQ0FBZ0IsU0FGYjtBQUdWLG9CQUFVLGtCQUFVLElBQVYsRUFBZ0I7O0FBRXhCLGdCQUFJLE9BQU8sSUFBUCxLQUFnQixRQUFwQixFQUE4QjtBQUM1QixxQkFBTyxFQUFFLEtBQUssSUFBUCxFQUFhLE9BQVEsS0FBSyxLQUFMLENBQVcsY0FBWCxDQUEwQixJQUExQixJQUFrQyxLQUFLLEtBQUwsQ0FBVyxJQUFYLENBQWxDLEdBQXFELElBQTFFLEVBQVA7QUFDRDs7QUFFRCxnQkFBSSxNQUFNLEtBQUssR0FBZjtBQUNBLGdCQUFJLFFBQVEsS0FBSyxLQUFqQjtBQUNBLGdCQUFJLFFBQVEsS0FBSyxLQUFMLEdBQWEsYUFBYSxLQUFLLEtBQWxCLEdBQTBCLElBQXZDLEdBQThDLEVBQTFEO0FBQ0EsZ0JBQUksWUFBWSxLQUFLLFNBQUwsR0FBaUIsYUFBYSxLQUFLLFNBQWxCLEdBQThCLEdBQS9DLEdBQXFELEVBQXJFOztBQUVBLG1CQUFPLE1BQU0sR0FBTixHQUFZLEtBQVosR0FBb0IsU0FBcEIsR0FBZ0MsR0FBaEMsR0FBc0MsS0FBdEMsR0FBOEMsSUFBOUMsR0FBcUQsR0FBckQsR0FBNEQsR0FBbkU7QUFDRCxXQWZTO0FBZ0JWLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsb0JBQTVCO0FBaEJHLFNBQVosQ0FUb0IsQ0FBZixFQTJCSixNQTNCSSxFQUFQO0FBNEJELE9BN0JEOztBQStCQSxjQUFRLElBQVIsQ0FBYSxhQUFiLEVBQTRCLFlBQVk7QUFDdEMsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLHFCQUFXLGVBREk7QUFFZixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxJQUF0QixDQUZLO0FBR2YsbUJBQVMsS0FBSyxJQUFMLENBQVUsSUFBVixHQUFpQixrQkFBa0IsTUFBbEIsQ0FIWDtBQUlmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsYUFBNUI7QUFKUSxTQUFWLEVBS0osTUFMSSxFQUFQO0FBTUQsT0FQRDs7QUFTQSxjQUFRLElBQVIsQ0FBYSxlQUFiLEVBQThCLFlBQVk7QUFDeEMsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLHFCQUFXLGlCQURJO0FBRWYsb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsTUFBdEIsQ0FGSztBQUdmLG1CQUFTLEtBQUssSUFBTCxDQUFVLE1BQVYsR0FBbUIsa0JBQWtCLFFBQWxCLENBSGI7QUFJZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGVBQTVCO0FBSlEsU0FBVixFQUtKLE1BTEksRUFBUDtBQU1ELE9BUEQ7O0FBU0EsY0FBUSxJQUFSLENBQWEsa0JBQWIsRUFBaUMsWUFBWTtBQUMzQyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2YscUJBQVcsb0JBREk7QUFFZixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxTQUF0QixDQUZLO0FBR2YsbUJBQVMsS0FBSyxJQUFMLENBQVUsU0FBVixHQUFzQixrQkFBa0IsV0FBbEIsQ0FIaEI7QUFJZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGtCQUE1QjtBQUpRLFNBQVYsRUFLSixNQUxJLEVBQVA7QUFNRCxPQVBEOztBQVNBLGNBQVEsSUFBUixDQUFhLGNBQWIsRUFBNkIsWUFBWTtBQUN2QyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsTUFBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssSUFBTCxDQUFVLEtBQVYsR0FBa0Isa0JBQWtCLGNBQWxCLENBRlo7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLHFCQUE1QjtBQUhRLFNBQVYsRUFJSixNQUpJLEVBQVA7QUFLRCxPQU5EOztBQVFBLGNBQVEsSUFBUixDQUFhLHNCQUFiLEVBQXFDLFlBQVk7QUFDL0MsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLHFCQUFXLHdCQURJO0FBRWYsb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsYUFBdEIsQ0FGSztBQUdmLG1CQUFTLEtBQUssSUFBTCxDQUFVLGFBQVYsR0FBMEIsa0JBQWtCLGVBQWxCLENBSHBCO0FBSWYsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixzQkFBNUI7QUFKUSxTQUFWLEVBS0osTUFMSSxFQUFQO0FBTUQsT0FQRDs7QUFTQSxjQUFRLElBQVIsQ0FBYSxvQkFBYixFQUFtQyxZQUFZO0FBQzdDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixxQkFBVyxzQkFESTtBQUVmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLFdBQXRCLENBRks7QUFHZixtQkFBUyxLQUFLLElBQUwsQ0FBVSxXQUhKO0FBSWYsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixvQkFBNUI7QUFKUSxTQUFWLEVBS0osTUFMSSxFQUFQO0FBTUQsT0FQRDs7QUFTQSxjQUFRLElBQVIsQ0FBYSxrQkFBYixFQUFpQyxZQUFZO0FBQzNDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixxQkFBVyxvQkFESTtBQUVmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLFNBQXRCLENBRks7QUFHZixtQkFBUyxLQUFLLElBQUwsQ0FBVSxTQUhKO0FBSWYsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixrQkFBNUI7QUFKUSxTQUFWLEVBS0osTUFMSSxFQUFQO0FBTUQsT0FQRDs7QUFTQSxjQUFRLElBQVIsQ0FBYSxpQkFBYixFQUFnQyxZQUFZO0FBQzFDLGVBQU8sR0FBRyxXQUFILENBQWUsQ0FDcEIsR0FBRyxNQUFILENBQVU7QUFDUixxQkFBVyxpQkFESDtBQUVSLG9CQUFVLDJDQUEyQyxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxLQUF0QixFQUE2QixNQUE3QixDQUY3QztBQUdSLG1CQUFTLEtBQUssSUFBTCxDQUFVLElBSFg7QUFJUixnQkFBTTtBQUNKLG9CQUFRO0FBREo7QUFKRSxTQUFWLENBRG9CLEVBU3BCLEdBQUcsYUFBSCxDQUFpQjtBQUNmLHFCQUFXLG1CQURJO0FBRWYsMEJBQWdCLFFBQVEsS0FBUixDQUFjLFNBRmY7QUFHZixpQkFBTyxRQUFRLFNBQVIsQ0FBa0IsTUFBbEIsQ0FBeUIsS0FBSyxlQUE5QixDQUhRO0FBSWYsb0JBQVUsa0JBQVUsSUFBVixFQUFnQjtBQUN4QixtQkFBTyw4QkFBOEIsSUFBOUIsR0FBcUMsSUFBckMsR0FBNEMsSUFBNUMsR0FBbUQsU0FBMUQ7QUFDRCxXQU5jO0FBT2YsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixpQkFBNUI7QUFQUSxTQUFqQixDQVRvQixDQUFmLEVBa0JKLE1BbEJJLEVBQVA7QUFtQkQsT0FwQkQ7O0FBc0JBLGNBQVEsSUFBUixDQUFhLGlCQUFiLEVBQWdDLFlBQVk7QUFDMUMsZUFBTyxHQUFHLFdBQUgsQ0FBZSxDQUNwQixHQUFHLE1BQUgsQ0FBVTtBQUNSLHFCQUFXLGlCQURIO0FBRVIsb0JBQVUsMENBQTBDLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLEtBQXRCLEVBQTZCLE1BQTdCLENBRjVDO0FBR1IsbUJBQVMsS0FBSyxJQUFMLENBQVUsSUFIWDtBQUlSLGdCQUFNO0FBQ0osb0JBQVE7QUFESjtBQUpFLFNBQVYsQ0FEb0IsRUFTcEIsR0FBRyxhQUFILENBQWlCO0FBQ2YscUJBQVcsbUJBREk7QUFFZiwwQkFBZ0IsUUFBUSxLQUFSLENBQWMsU0FGZjtBQUdmLGlCQUFPLFFBQVEsU0FIQTtBQUlmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsaUJBQTVCO0FBSlEsU0FBakIsQ0FUb0IsQ0FBZixFQWVKLE1BZkksRUFBUDtBQWdCRCxPQWpCRDs7QUFtQkEsY0FBUSxJQUFSLENBQWEsY0FBYixFQUE2QixZQUFZO0FBQ3ZDLGVBQU8sR0FBRyxXQUFILENBQWU7QUFDcEIscUJBQVcsWUFEUztBQUVwQixvQkFBVSxDQUNSLEdBQUcsTUFBSCxDQUFVO0FBQ1IsdUJBQVcsMkJBREg7QUFFUixzQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxJQUFkLEdBQXFCLG9CQUE3QixDQUZGO0FBR1IscUJBQVMsS0FBSyxLQUFMLENBQVcsTUFIWjtBQUlSLG1CQUFPLGVBQVUsQ0FBVixFQUFhO0FBQ2xCLGtCQUFJLFVBQVUsRUFBRSxFQUFFLGFBQUosQ0FBZDtBQUNBLHNCQUFRLE1BQVIsQ0FBZSxjQUFmLEVBQStCO0FBQzdCLDJCQUFXLFFBQVEsSUFBUixDQUFhLGdCQUFiLENBRGtCO0FBRTdCLDJCQUFXLFFBQVEsSUFBUixDQUFhLGdCQUFiO0FBRmtCLGVBQS9CO0FBSUQsYUFWTztBQVdSLHNCQUFVLGtCQUFVLE9BQVYsRUFBbUI7QUFDM0Isa0JBQUksZUFBZSxRQUFRLElBQVIsQ0FBYSxvQkFBYixDQUFuQjtBQUNBLDJCQUFhLEdBQWIsQ0FBaUIsa0JBQWpCLEVBQXFDLFNBQXJDO0FBQ0Esc0JBQVEsSUFBUixDQUFhLGdCQUFiLEVBQStCLFNBQS9CO0FBQ0Q7QUFmTyxXQUFWLENBRFEsRUFrQlIsR0FBRyxNQUFILENBQVU7QUFDUix1QkFBVyxpQkFESDtBQUVSLHNCQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLEtBQXRCLEVBQTZCLE1BQTdCLENBRkY7QUFHUixxQkFBUyxLQUFLLEtBQUwsQ0FBVyxJQUhaO0FBSVIsa0JBQU07QUFDSixzQkFBUTtBQURKO0FBSkUsV0FBVixDQWxCUSxFQTBCUixHQUFHLFFBQUgsQ0FBWTtBQUNWLG1CQUFPLENBQ0wsTUFESyxFQUVMLHlCQUZLLEVBR0wsdUNBQXVDLEtBQUssS0FBTCxDQUFXLFVBQWxELEdBQStELFFBSDFELEVBSUwsU0FKSyxFQUtMLGlIQUxLLEVBTUwsS0FBSyxLQUFMLENBQVcsV0FOTixFQU9MLGVBUEssRUFRTCxVQVJLLEVBU0wscURBVEssRUFVTCxRQVZLLEVBV0wseUJBWEssRUFZTCx1Q0FBdUMsS0FBSyxLQUFMLENBQVcsVUFBbEQsR0FBK0QsUUFaMUQsRUFhTCxTQWJLLEVBY0wsc0hBZEssRUFlTCxLQUFLLEtBQUwsQ0FBVyxjQWZOLEVBZ0JMLGVBaEJLLEVBaUJMLFVBakJLLEVBa0JMLHFEQWxCSyxFQW1CTCxRQW5CSyxFQW9CTCxPQXBCSyxFQXFCTCxJQXJCSyxDQXFCQSxFQXJCQSxDQURHO0FBdUJWLHNCQUFVLGtCQUFVLFNBQVYsRUFBcUI7QUFDN0Isd0JBQVUsSUFBVixDQUFlLGNBQWYsRUFBK0IsSUFBL0IsQ0FBb0MsWUFBWTtBQUM5QyxvQkFBSSxVQUFVLEVBQUUsSUFBRixDQUFkO0FBQ0Esd0JBQVEsTUFBUixDQUFlLEdBQUcsT0FBSCxDQUFXO0FBQ3hCLDBCQUFRLFFBQVEsTUFEUTtBQUV4Qiw2QkFBVyxRQUFRLElBQVIsQ0FBYSxPQUFiO0FBRmEsaUJBQVgsRUFHWixNQUhZLEVBQWY7QUFJRCxlQU5EO0FBT0QsYUEvQlM7QUFnQ1YsbUJBQU8sZUFBVSxLQUFWLEVBQWlCO0FBQ3RCLGtCQUFJLFVBQVUsRUFBRSxNQUFNLE1BQVIsQ0FBZDtBQUNBLGtCQUFJLFlBQVksUUFBUSxJQUFSLENBQWEsT0FBYixDQUFoQjtBQUNBLGtCQUFJLFFBQVEsUUFBUSxJQUFSLENBQWEsT0FBYixDQUFaOztBQUVBLGtCQUFJLGFBQWEsS0FBakIsRUFBd0I7QUFDdEIsb0JBQUksTUFBTSxjQUFjLFdBQWQsR0FBNEIsa0JBQTVCLEdBQWlELE9BQTNEO0FBQ0Esb0JBQUksU0FBUyxRQUFRLE9BQVIsQ0FBZ0IsYUFBaEIsRUFBK0IsSUFBL0IsQ0FBb0Msb0JBQXBDLENBQWI7QUFDQSxvQkFBSSxpQkFBaUIsUUFBUSxPQUFSLENBQWdCLGFBQWhCLEVBQStCLElBQS9CLENBQW9DLDRCQUFwQyxDQUFyQjs7QUFFQSx1QkFBTyxHQUFQLENBQVcsR0FBWCxFQUFnQixLQUFoQjtBQUNBLCtCQUFlLElBQWYsQ0FBb0IsVUFBVSxTQUE5QixFQUF5QyxLQUF6QztBQUNBLHdCQUFRLE1BQVIsQ0FBZSxZQUFZLFNBQTNCLEVBQXNDLEtBQXRDO0FBQ0Q7QUFDRjtBQTlDUyxXQUFaLENBMUJRO0FBRlUsU0FBZixFQTZFSixNQTdFSSxFQUFQO0FBOEVELE9BL0VEOztBQWlGQSxjQUFRLElBQVIsQ0FBYSxXQUFiLEVBQTJCLFlBQVk7QUFDckMsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLGFBQXRCLENBREs7QUFFZixtQkFBUyxLQUFLLEtBQUwsQ0FBVyxTQUFYLEdBQXVCLGtCQUFrQixxQkFBbEIsQ0FGakI7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLDRCQUE1QjtBQUhRLFNBQVYsRUFJSixNQUpJLEVBQVA7QUFLRCxPQU5EOztBQVFBLGNBQVEsSUFBUixDQUFhLFdBQWIsRUFBMEIsWUFBWTtBQUNwQyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsV0FBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssS0FBTCxDQUFXLE9BQVgsR0FBcUIsa0JBQWtCLG1CQUFsQixDQUZmO0FBR2YsaUJBQVEsUUFBUSxtQkFBUixDQUE0QiwwQkFBNUI7QUFITyxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDs7QUFRQSxVQUFJLGNBQWMsR0FBRyxNQUFILENBQVU7QUFDMUIsa0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsU0FBdEIsQ0FEZ0I7QUFFMUIsaUJBQVMsS0FBSyxTQUFMLENBQWUsSUFBZixHQUFzQixrQkFBa0IsYUFBbEIsQ0FGTDtBQUcxQixlQUFPLFFBQVEsbUJBQVIsQ0FBNEIsb0JBQTVCO0FBSG1CLE9BQVYsQ0FBbEI7O0FBTUEsVUFBSSxnQkFBZ0IsR0FBRyxNQUFILENBQVU7QUFDNUIsa0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsV0FBdEIsQ0FEa0I7QUFFNUIsaUJBQVMsS0FBSyxTQUFMLENBQWUsTUFBZixHQUF3QixrQkFBa0IsZUFBbEIsQ0FGTDtBQUc1QixlQUFPLFFBQVEsbUJBQVIsQ0FBNEIsc0JBQTVCO0FBSHFCLE9BQVYsQ0FBcEI7O0FBTUEsVUFBSSxlQUFlLEdBQUcsTUFBSCxDQUFVO0FBQzNCLGtCQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLFVBQXRCLENBRGlCO0FBRTNCLGlCQUFTLEtBQUssU0FBTCxDQUFlLEtBQWYsR0FBdUIsa0JBQWtCLGNBQWxCLENBRkw7QUFHM0IsZUFBTyxRQUFRLG1CQUFSLENBQTRCLHFCQUE1QjtBQUhvQixPQUFWLENBQW5COztBQU1BLFVBQUksY0FBYyxHQUFHLE1BQUgsQ0FBVTtBQUMxQixrQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxZQUF0QixDQURnQjtBQUUxQixpQkFBUyxLQUFLLFNBQUwsQ0FBZSxPQUFmLEdBQXlCLGtCQUFrQixhQUFsQixDQUZSO0FBRzFCLGVBQU8sUUFBUSxtQkFBUixDQUE0QixvQkFBNUI7QUFIbUIsT0FBVixDQUFsQjs7QUFNQSxVQUFJLFVBQVUsR0FBRyxNQUFILENBQVU7QUFDdEIsa0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsT0FBdEIsQ0FEWTtBQUV0QixpQkFBUyxLQUFLLFNBQUwsQ0FBZSxPQUFmLEdBQXlCLGtCQUFrQixTQUFsQixDQUZaO0FBR3RCLGVBQU8sUUFBUSxtQkFBUixDQUE0QixnQkFBNUI7QUFIZSxPQUFWLENBQWQ7O0FBTUEsVUFBSSxTQUFTLEdBQUcsTUFBSCxDQUFVO0FBQ3JCLGtCQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLE1BQXRCLENBRFc7QUFFckIsaUJBQVMsS0FBSyxTQUFMLENBQWUsTUFBZixHQUF3QixrQkFBa0IsUUFBbEIsQ0FGWjtBQUdyQixlQUFPLFFBQVEsbUJBQVIsQ0FBNEIsZUFBNUI7QUFIYyxPQUFWLENBQWI7O0FBTUEsY0FBUSxJQUFSLENBQWEsb0JBQWIsRUFBbUMsS0FBSyxNQUFMLENBQVksV0FBWixFQUF5QixRQUF6QixDQUFuQztBQUNBLGNBQVEsSUFBUixDQUFhLHNCQUFiLEVBQXFDLEtBQUssTUFBTCxDQUFZLGFBQVosRUFBMkIsUUFBM0IsQ0FBckM7QUFDQSxjQUFRLElBQVIsQ0FBYSxxQkFBYixFQUFvQyxLQUFLLE1BQUwsQ0FBWSxZQUFaLEVBQTBCLFFBQTFCLENBQXBDO0FBQ0EsY0FBUSxJQUFSLENBQWEsb0JBQWIsRUFBbUMsS0FBSyxNQUFMLENBQVksV0FBWixFQUF5QixRQUF6QixDQUFuQztBQUNBLGNBQVEsSUFBUixDQUFhLGdCQUFiLEVBQStCLEtBQUssTUFBTCxDQUFZLE9BQVosRUFBcUIsUUFBckIsQ0FBL0I7QUFDQSxjQUFRLElBQVIsQ0FBYSxlQUFiLEVBQThCLEtBQUssTUFBTCxDQUFZLE1BQVosRUFBb0IsUUFBcEIsQ0FBOUI7O0FBRUEsY0FBUSxJQUFSLENBQWEsa0JBQWIsRUFBaUMsWUFBWTtBQUMzQyxlQUFPLEdBQUcsV0FBSCxDQUFlLENBQ3BCLEdBQUcsTUFBSCxDQUFVO0FBQ1IscUJBQVcsaUJBREg7QUFFUixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxTQUF0QixJQUFtQyxHQUFuQyxHQUF5QyxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxLQUF0QixFQUE2QixNQUE3QixDQUYzQztBQUdSLG1CQUFTLEtBQUssU0FBTCxDQUFlLFNBSGhCO0FBSVIsZ0JBQU07QUFDSixvQkFBUTtBQURKO0FBSkUsU0FBVixDQURvQixFQVNwQixHQUFHLFFBQUgsQ0FBWSxDQUNWLEdBQUcsV0FBSCxDQUFlO0FBQ2IscUJBQVcsWUFERTtBQUViLG9CQUFVLENBQUMsV0FBRCxFQUFjLGFBQWQsRUFBNkIsWUFBN0IsRUFBMkMsV0FBM0M7QUFGRyxTQUFmLENBRFUsRUFLVixHQUFHLFdBQUgsQ0FBZTtBQUNiLHFCQUFXLFdBREU7QUFFYixvQkFBVSxDQUFDLE9BQUQsRUFBVSxNQUFWO0FBRkcsU0FBZixDQUxVLENBQVosQ0FUb0IsQ0FBZixFQW1CSixNQW5CSSxFQUFQO0FBb0JELE9BckJEOztBQXVCQSxjQUFRLElBQVIsQ0FBYSxlQUFiLEVBQThCLFlBQVk7QUFDeEMsZUFBTyxHQUFHLFdBQUgsQ0FBZSxDQUNwQixHQUFHLE1BQUgsQ0FBVTtBQUNSLHFCQUFXLGlCQURIO0FBRVIsb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsVUFBdEIsSUFBb0MsR0FBcEMsR0FBMEMsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsS0FBdEIsRUFBNkIsTUFBN0IsQ0FGNUM7QUFHUixtQkFBUyxLQUFLLElBQUwsQ0FBVSxNQUhYO0FBSVIsZ0JBQU07QUFDSixvQkFBUTtBQURKO0FBSkUsU0FBVixDQURvQixFQVNwQixHQUFHLGFBQUgsQ0FBaUI7QUFDZixpQkFBTyxRQUFRLFdBREE7QUFFZiwwQkFBZ0IsUUFBUSxLQUFSLENBQWMsU0FGZjtBQUdmLHFCQUFXLHNCQUhJO0FBSWYsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixtQkFBNUI7QUFKUSxTQUFqQixDQVRvQixDQUFmLEVBZUosTUFmSSxFQUFQO0FBZ0JELE9BakJEOztBQW1CQSxjQUFRLElBQVIsQ0FBYSxjQUFiLEVBQTZCLFlBQVk7QUFDdkMsZUFBTyxHQUFHLFdBQUgsQ0FBZSxDQUNwQixHQUFHLE1BQUgsQ0FBVTtBQUNSLHFCQUFXLGlCQURIO0FBRVIsb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsS0FBdEIsSUFBK0IsR0FBL0IsR0FBcUMsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsS0FBdEIsRUFBNkIsTUFBN0IsQ0FGdkM7QUFHUixtQkFBUyxLQUFLLEtBQUwsQ0FBVyxLQUhaO0FBSVIsZ0JBQU07QUFDSixvQkFBUTtBQURKO0FBSkUsU0FBVixDQURvQixFQVNwQixHQUFHLFFBQUgsQ0FBWTtBQUNWLHFCQUFXLFlBREQ7QUFFVixpQkFBTyxDQUNMLHFDQURLLEVBRUwsK0ZBRkssRUFHTCxvREFISyxFQUlMLHNEQUpLLEVBS0wsUUFMSyxFQU1MLGlEQU5LLEVBT0wsSUFQSyxDQU9BLEVBUEE7QUFGRyxTQUFaLENBVG9CLENBQWYsRUFvQko7QUFDRCxvQkFBVSxrQkFBVSxLQUFWLEVBQWlCO0FBQ3pCLGdCQUFJLFdBQVcsTUFBTSxJQUFOLENBQVcscUNBQVgsQ0FBZjtBQUNBLHFCQUFTLEdBQVQsQ0FBYTtBQUNYLHFCQUFPLFFBQVEsa0JBQVIsQ0FBMkIsR0FBM0IsR0FBaUMsSUFEN0I7QUFFWCxzQkFBUSxRQUFRLGtCQUFSLENBQTJCLEdBQTNCLEdBQWlDO0FBRjlCLGFBQWIsRUFHRyxTQUhILENBR2EsUUFBUSxtQkFBUixDQUE0QixvQkFBNUIsQ0FIYixFQUlHLEVBSkgsQ0FJTSxXQUpOLEVBSW1CLEtBQUssZ0JBSnhCO0FBS0Q7QUFSQSxTQXBCSSxFQTZCSixNQTdCSSxFQUFQO0FBOEJELE9BL0JEOztBQWlDQSxjQUFRLElBQVIsQ0FBYSxhQUFiLEVBQTRCLFlBQVk7QUFDdEMsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLElBQXRCLENBREs7QUFFZixtQkFBUyxLQUFLLElBQUwsQ0FBVSxJQUFWLEdBQWlCLGtCQUFrQixpQkFBbEIsQ0FGWDtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsaUJBQTVCO0FBSFEsU0FBVixFQUlKLE1BSkksRUFBUDtBQUtELE9BTkQ7O0FBUUEsY0FBUSxJQUFSLENBQWEsZ0JBQWIsRUFBK0IsWUFBWTtBQUN6QyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsT0FBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssS0FBTCxDQUFXLEtBRkw7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGtCQUE1QjtBQUhRLFNBQVYsRUFJSixNQUpJLEVBQVA7QUFLRCxPQU5EOztBQVFBLGNBQVEsSUFBUixDQUFhLGNBQWIsRUFBNkIsWUFBWTtBQUN2QyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsS0FBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssS0FBTCxDQUFXLEtBRkw7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGtCQUE1QjtBQUhRLFNBQVYsRUFJSixNQUpJLEVBQVA7QUFLRCxPQU5EOztBQVFBLGNBQVEsSUFBUixDQUFhLFdBQWIsRUFBMEIsWUFBWTtBQUNwQyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsS0FBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssRUFBTCxDQUFRLE1BQVIsR0FBaUIsa0JBQWtCLHNCQUFsQixDQUZYO0FBR2YsaUJBQU8sUUFBUSxtQkFBUixDQUE0Qiw2QkFBNUI7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDs7QUFRQSxjQUFRLElBQVIsQ0FBYSxtQkFBYixFQUFrQyxZQUFZO0FBQzVDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixxQkFBVyxnQkFESTtBQUVmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLFNBQXRCLENBRks7QUFHZixtQkFBUyxLQUFLLE9BQUwsQ0FBYSxVQUhQO0FBSWYsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixtQkFBNUI7QUFKUSxTQUFWLEVBS0osTUFMSSxFQUFQO0FBTUQsT0FQRDs7QUFTQSxjQUFRLElBQVIsQ0FBYSxpQkFBYixFQUFnQyxZQUFZO0FBQzFDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixxQkFBVyxjQURJO0FBRWYsb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsSUFBdEIsQ0FGSztBQUdmLG1CQUFTLEtBQUssT0FBTCxDQUFhLFFBSFA7QUFJZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGlCQUE1QjtBQUpRLFNBQVYsRUFLSixNQUxJLEVBQVA7QUFNRCxPQVBEOztBQVNBLGNBQVEsSUFBUixDQUFhLGFBQWIsRUFBNEIsWUFBWTtBQUN0QyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsSUFBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssT0FBTCxDQUFhLElBQWIsR0FBb0Isa0JBQWtCLE1BQWxCLENBRmQ7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGFBQTVCO0FBSFEsU0FBVixFQUlKLE1BSkksRUFBUDtBQUtELE9BTkQ7O0FBUUEsY0FBUSxJQUFSLENBQWEsYUFBYixFQUE0QixZQUFZO0FBQ3RDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxJQUF0QixDQURLO0FBRWYsbUJBQVMsS0FBSyxPQUFMLENBQWEsSUFBYixHQUFvQixrQkFBa0IsTUFBbEIsQ0FGZDtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsYUFBNUI7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDs7QUFRQSxjQUFRLElBQVIsQ0FBYSxhQUFiLEVBQTRCLFlBQVk7QUFDdEMsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLFFBQXRCLENBREs7QUFFZixtQkFBUyxLQUFLLE9BQUwsQ0FBYSxJQUZQO0FBR2YsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixpQkFBNUI7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDtBQU9ELEtBdmFEOztBQXlhQTs7Ozs7OztBQU9BLFNBQUssc0JBQUwsR0FBOEIsWUFBWTtBQUN4QztBQUNBLGNBQVEsSUFBUixDQUFhLHFCQUFiLEVBQW9DLFlBQVk7QUFDOUMsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLG9CQUFVLDRDQURLO0FBRWYsbUJBQVMsS0FBSyxLQUFMLENBQVcsVUFGTDtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsZUFBNUIsRUFBNkMsR0FBN0M7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDtBQU9BLGNBQVEsSUFBUixDQUFhLG9CQUFiLEVBQW1DLFlBQVk7QUFDN0MsZUFBUSxHQUFHLE1BQUgsQ0FBVTtBQUNoQixvQkFBVSwyQ0FETTtBQUVoQixtQkFBUyxLQUFLLEtBQUwsQ0FBVyxVQUZKO0FBR2hCLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsZUFBNUIsRUFBNkMsS0FBN0M7QUFIUyxTQUFWLEVBSUwsTUFKSyxFQUFSO0FBS0QsT0FORDtBQU9BLGNBQVEsSUFBUixDQUFhLG9CQUFiLEVBQW1DLFlBQVk7QUFDN0MsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLG9CQUFVLDJDQURLO0FBRWYsbUJBQVMsS0FBSyxLQUFMLENBQVcsYUFGTDtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsZUFBNUIsRUFBNkMsTUFBN0M7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDs7QUFRQTtBQUNBLGNBQVEsSUFBUixDQUFhLGtCQUFiLEVBQWlDLFlBQVk7QUFDM0MsZUFBTyxHQUFHLE1BQUgsQ0FBVTtBQUNmLG9CQUFVLEdBQUcsSUFBSCxDQUFRLFFBQVEsS0FBUixDQUFjLFNBQXRCLENBREs7QUFFZixtQkFBUyxLQUFLLEtBQUwsQ0FBVyxTQUZMO0FBR2YsaUJBQU8sUUFBUSxtQkFBUixDQUE0QixnQkFBNUIsRUFBOEMsTUFBOUM7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDs7QUFRQSxjQUFRLElBQVIsQ0FBYSxtQkFBYixFQUFrQyxZQUFZO0FBQzVDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxVQUF0QixDQURLO0FBRWYsbUJBQVMsS0FBSyxLQUFMLENBQVcsVUFGTDtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsZ0JBQTVCLEVBQThDLE9BQTlDO0FBSFEsU0FBVixFQUlKLE1BSkksRUFBUDtBQUtELE9BTkQ7O0FBUUEsY0FBUSxJQUFSLENBQWEsa0JBQWIsRUFBaUMsWUFBWTtBQUMzQyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsWUFBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssS0FBTCxDQUFXLFNBRkw7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLGdCQUE1QixFQUE4QyxNQUE5QztBQUhRLFNBQVYsRUFJSixNQUpJLEVBQVA7QUFLRCxPQU5EOztBQVFBO0FBQ0EsY0FBUSxJQUFSLENBQWEsb0JBQWIsRUFBbUMsWUFBWTtBQUM3QyxlQUFPLEdBQUcsTUFBSCxDQUFVO0FBQ2Ysb0JBQVUsR0FBRyxJQUFILENBQVEsUUFBUSxLQUFSLENBQWMsS0FBdEIsQ0FESztBQUVmLG1CQUFTLEtBQUssS0FBTCxDQUFXLE1BRkw7QUFHZixpQkFBTyxRQUFRLG1CQUFSLENBQTRCLG9CQUE1QjtBQUhRLFNBQVYsRUFJSixNQUpJLEVBQVA7QUFLRCxPQU5EO0FBT0QsS0F6REQ7O0FBMkRBLFNBQUsscUJBQUwsR0FBNkIsWUFBWTtBQUN2QyxjQUFRLElBQVIsQ0FBYSx1QkFBYixFQUFzQyxZQUFZO0FBQ2hELGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxJQUF0QixDQURLO0FBRWYsbUJBQVMsS0FBSyxJQUFMLENBQVUsSUFGSjtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsaUJBQTVCO0FBSFEsU0FBVixFQUlKLE1BSkksRUFBUDtBQUtELE9BTkQ7O0FBUUEsY0FBUSxJQUFSLENBQWEsZUFBYixFQUE4QixZQUFZO0FBQ3hDLGVBQU8sR0FBRyxNQUFILENBQVU7QUFDZixvQkFBVSxHQUFHLElBQUgsQ0FBUSxRQUFRLEtBQVIsQ0FBYyxNQUF0QixDQURLO0FBRWYsbUJBQVMsS0FBSyxJQUFMLENBQVUsTUFGSjtBQUdmLGlCQUFPLFFBQVEsbUJBQVIsQ0FBNEIsZUFBNUI7QUFIUSxTQUFWLEVBSUosTUFKSSxFQUFQO0FBS0QsT0FORDtBQU9ELEtBaEJEOztBQWtCQSxTQUFLLEtBQUwsR0FBYSxVQUFVLFVBQVYsRUFBc0IsTUFBdEIsRUFBOEI7QUFDekMsV0FBSyxJQUFJLFdBQVcsQ0FBZixFQUFrQixXQUFXLE9BQU8sTUFBekMsRUFBaUQsV0FBVyxRQUE1RCxFQUFzRSxVQUF0RSxFQUFrRjtBQUNoRixZQUFJLFFBQVEsT0FBTyxRQUFQLENBQVo7QUFDQSxZQUFJLFlBQVksTUFBTSxDQUFOLENBQWhCO0FBQ0EsWUFBSSxVQUFVLE1BQU0sQ0FBTixDQUFkOztBQUVBLFlBQUksU0FBUyxHQUFHLFdBQUgsQ0FBZTtBQUMxQixxQkFBVyxVQUFVO0FBREssU0FBZixFQUVWLE1BRlUsRUFBYjs7QUFJQSxhQUFLLElBQUksTUFBTSxDQUFWLEVBQWEsTUFBTSxRQUFRLE1BQWhDLEVBQXdDLE1BQU0sR0FBOUMsRUFBbUQsS0FBbkQsRUFBMEQ7QUFDeEQsY0FBSSxTQUFTLFFBQVEsSUFBUixDQUFhLFlBQVksUUFBUSxHQUFSLENBQXpCLENBQWI7QUFDQSxjQUFJLE1BQUosRUFBWTtBQUNWLG1CQUFPLE1BQVAsQ0FBYyxPQUFPLE1BQVAsS0FBa0IsVUFBbEIsR0FBK0IsT0FBTyxPQUFQLENBQS9CLEdBQWlELE1BQS9EO0FBQ0Q7QUFDRjtBQUNELGVBQU8sUUFBUCxDQUFnQixVQUFoQjtBQUNEO0FBQ0YsS0FsQkQ7O0FBb0JBLFNBQUssa0JBQUwsR0FBMEIsWUFBWTtBQUNwQyxVQUFJLFlBQVksUUFBUSxNQUFSLENBQWUscUJBQWYsQ0FBaEI7QUFDQSxXQUFLLGVBQUwsQ0FBcUI7QUFDbkIsMEJBQWtCLHVCQUFZO0FBQzVCLGlCQUFPLFVBQVUsV0FBVixNQUEyQixNQUFsQztBQUNELFNBSGtCO0FBSW5CLDRCQUFvQix5QkFBWTtBQUM5QixpQkFBTyxVQUFVLGFBQVYsTUFBNkIsUUFBcEM7QUFDRCxTQU5rQjtBQU9uQiwrQkFBdUIsNEJBQVk7QUFDakMsaUJBQU8sVUFBVSxnQkFBVixNQUFnQyxXQUF2QztBQUNELFNBVGtCO0FBVW5CLCtCQUF1Qiw0QkFBWTtBQUNqQyxpQkFBTyxVQUFVLGdCQUFWLE1BQWdDLFdBQXZDO0FBQ0QsU0Faa0I7QUFhbkIsaUNBQXlCLDhCQUFZO0FBQ25DLGlCQUFPLFVBQVUsa0JBQVYsTUFBa0MsYUFBekM7QUFDRCxTQWZrQjtBQWdCbkIsbUNBQTJCLGdDQUFZO0FBQ3JDLGlCQUFPLFVBQVUsb0JBQVYsTUFBb0MsZUFBM0M7QUFDRDtBQWxCa0IsT0FBckI7O0FBcUJBLFVBQUksVUFBVSxhQUFWLENBQUosRUFBOEI7QUFDNUIsWUFBSSxZQUFZLFVBQVUsYUFBVixFQUF5QixLQUF6QixDQUErQixHQUEvQixFQUFvQyxHQUFwQyxDQUF3QyxVQUFVLElBQVYsRUFBZ0I7QUFDdEUsaUJBQU8sS0FBSyxPQUFMLENBQWEsU0FBYixFQUF3QixFQUF4QixFQUNKLE9BREksQ0FDSSxNQURKLEVBQ1ksRUFEWixFQUVKLE9BRkksQ0FFSSxNQUZKLEVBRVksRUFGWixDQUFQO0FBR0QsU0FKZSxDQUFoQjtBQUtBLFlBQUksV0FBVyxLQUFLLElBQUwsQ0FBVSxTQUFWLEVBQXFCLEtBQUssZUFBMUIsQ0FBZjs7QUFFQSxpQkFBUyxJQUFULENBQWMseUJBQWQsRUFBeUMsSUFBekMsQ0FBOEMsWUFBWTtBQUN4RDtBQUNBLGNBQUksWUFBYSxFQUFFLElBQUYsRUFBUSxJQUFSLENBQWEsT0FBYixJQUF3QixFQUF6QixLQUFrQyxXQUFXLEVBQTdEO0FBQ0EsZUFBSyxTQUFMLEdBQWlCLFlBQVksU0FBWixHQUF3QixFQUF6QztBQUNELFNBSkQ7QUFLQSxpQkFBUyxJQUFULENBQWMsd0JBQWQsRUFBd0MsSUFBeEMsQ0FBNkMsUUFBN0M7QUFDRDs7QUFFRCxVQUFJLFVBQVUsV0FBVixDQUFKLEVBQTRCO0FBQzFCLFlBQUksV0FBVyxVQUFVLFdBQVYsQ0FBZjtBQUNBLGlCQUFTLElBQVQsQ0FBYyx5QkFBZCxFQUF5QyxJQUF6QyxDQUE4QyxZQUFZO0FBQ3hEO0FBQ0EsY0FBSSxZQUFhLEVBQUUsSUFBRixFQUFRLElBQVIsQ0FBYSxPQUFiLElBQXdCLEVBQXpCLEtBQWtDLFdBQVcsRUFBN0Q7QUFDQSxlQUFLLFNBQUwsR0FBaUIsWUFBWSxTQUFaLEdBQXdCLEVBQXpDO0FBQ0QsU0FKRDtBQUtBLGlCQUFTLElBQVQsQ0FBYyx3QkFBZCxFQUF3QyxJQUF4QyxDQUE2QyxRQUE3QztBQUNEOztBQUVELFVBQUksVUFBVSxhQUFWLENBQUosRUFBOEI7QUFDNUIsWUFBSSxhQUFhLFVBQVUsYUFBVixDQUFqQjtBQUNBLGlCQUFTLElBQVQsQ0FBYyw0QkFBZCxFQUE0QyxJQUE1QyxDQUFpRCxZQUFZO0FBQzNEO0FBQ0EsY0FBSSxZQUFhLEVBQUUsSUFBRixFQUFRLElBQVIsQ0FBYSxPQUFiLElBQXdCLEVBQXpCLEtBQWtDLGFBQWEsRUFBL0Q7QUFDQSxlQUFLLFNBQUwsR0FBaUIsWUFBWSxTQUFaLEdBQXdCLEVBQXpDO0FBQ0QsU0FKRDtBQUtEO0FBQ0YsS0F6REQ7O0FBMkRBLFNBQUssZUFBTCxHQUF1QixVQUFVLEtBQVYsRUFBaUI7QUFDdEMsUUFBRSxJQUFGLENBQU8sS0FBUCxFQUFjLFVBQVUsUUFBVixFQUFvQixJQUFwQixFQUEwQjtBQUN0QyxXQUFHLGVBQUgsQ0FBbUIsU0FBUyxJQUFULENBQWMsUUFBZCxDQUFuQixFQUE0QyxNQUE1QztBQUNELE9BRkQ7QUFHRCxLQUpEOztBQU1BLFNBQUssZ0JBQUwsR0FBd0IsVUFBVSxLQUFWLEVBQWlCO0FBQ3ZDLFVBQUksWUFBWSxFQUFoQjtBQUNBLFVBQUksVUFBVSxFQUFFLE1BQU0sTUFBTixDQUFhLFVBQWYsQ0FBZCxDQUZ1QyxDQUVHO0FBQzFDLFVBQUksb0JBQW9CLFFBQVEsSUFBUixFQUF4QjtBQUNBLFVBQUksV0FBVyxRQUFRLElBQVIsQ0FBYSxxQ0FBYixDQUFmO0FBQ0EsVUFBSSxlQUFlLFFBQVEsSUFBUixDQUFhLG9DQUFiLENBQW5CO0FBQ0EsVUFBSSxpQkFBaUIsUUFBUSxJQUFSLENBQWEsc0NBQWIsQ0FBckI7O0FBRUEsVUFBSSxTQUFKO0FBQ0E7QUFDQSxVQUFJLE1BQU0sT0FBTixLQUFrQixTQUF0QixFQUFpQztBQUMvQixZQUFJLGFBQWEsRUFBRSxNQUFNLE1BQVIsRUFBZ0IsTUFBaEIsRUFBakI7QUFDQSxvQkFBWTtBQUNWLGFBQUcsTUFBTSxLQUFOLEdBQWMsV0FBVyxJQURsQjtBQUVWLGFBQUcsTUFBTSxLQUFOLEdBQWMsV0FBVztBQUZsQixTQUFaO0FBSUQsT0FORCxNQU1PO0FBQ0wsb0JBQVk7QUFDVixhQUFHLE1BQU0sT0FEQztBQUVWLGFBQUcsTUFBTTtBQUZDLFNBQVo7QUFJRDs7QUFFRCxVQUFJLE1BQU07QUFDUixXQUFHLEtBQUssSUFBTCxDQUFVLFVBQVUsQ0FBVixHQUFjLFNBQXhCLEtBQXNDLENBRGpDO0FBRVIsV0FBRyxLQUFLLElBQUwsQ0FBVSxVQUFVLENBQVYsR0FBYyxTQUF4QixLQUFzQztBQUZqQyxPQUFWOztBQUtBLG1CQUFhLEdBQWIsQ0FBaUIsRUFBRSxPQUFPLElBQUksQ0FBSixHQUFRLElBQWpCLEVBQXVCLFFBQVEsSUFBSSxDQUFKLEdBQVEsSUFBdkMsRUFBakI7QUFDQSxlQUFTLElBQVQsQ0FBYyxPQUFkLEVBQXVCLElBQUksQ0FBSixHQUFRLEdBQVIsR0FBYyxJQUFJLENBQXpDOztBQUVBLFVBQUksSUFBSSxJQUFJLENBQVIsSUFBYSxJQUFJLENBQUosR0FBUSxRQUFRLGtCQUFSLENBQTJCLEdBQXBELEVBQXlEO0FBQ3ZELHVCQUFlLEdBQWYsQ0FBbUIsRUFBRSxPQUFPLElBQUksQ0FBSixHQUFRLENBQVIsR0FBWSxJQUFyQixFQUFuQjtBQUNEOztBQUVELFVBQUksSUFBSSxJQUFJLENBQVIsSUFBYSxJQUFJLENBQUosR0FBUSxRQUFRLGtCQUFSLENBQTJCLEdBQXBELEVBQXlEO0FBQ3ZELHVCQUFlLEdBQWYsQ0FBbUIsRUFBRSxRQUFRLElBQUksQ0FBSixHQUFRLENBQVIsR0FBWSxJQUF0QixFQUFuQjtBQUNEOztBQUVELHdCQUFrQixJQUFsQixDQUF1QixJQUFJLENBQUosR0FBUSxLQUFSLEdBQWdCLElBQUksQ0FBM0M7QUFDRCxLQXhDRDtBQXlDRCxHQTNxQkQ7O0FBNnFCQSxNQUFJLFVBQVUsU0FBVixPQUFVLENBQVUsT0FBVixFQUFtQjtBQUMvQixRQUFJLEtBQUssRUFBRSxVQUFGLENBQWEsRUFBdEI7O0FBRUEsUUFBSSxRQUFRLFFBQVEsVUFBUixDQUFtQixJQUEvQjtBQUNBLFFBQUksV0FBVyxRQUFRLFVBQVIsQ0FBbUIsT0FBbEM7QUFDQSxRQUFJLFVBQVUsUUFBUSxPQUF0Qjs7QUFFQSxTQUFLLGdCQUFMLEdBQXdCLFlBQVk7QUFDbEMsYUFBTyxDQUFDLFFBQVEsT0FBaEI7QUFDRCxLQUZEOztBQUlBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCLGNBQVEsT0FBUixHQUFrQixRQUFRLE9BQVIsSUFBbUIsRUFBckM7O0FBRUEsVUFBSSxDQUFDLFFBQVEsT0FBUixDQUFnQixNQUFyQixFQUE2QjtBQUMzQixpQkFBUyxJQUFUO0FBQ0QsT0FGRCxNQUVPO0FBQ0wsZ0JBQVEsTUFBUixDQUFlLGVBQWYsRUFBZ0MsUUFBaEMsRUFBMEMsUUFBUSxPQUFsRDtBQUNEOztBQUVELFVBQUksUUFBUSxnQkFBWixFQUE4QjtBQUM1QixpQkFBUyxRQUFULENBQWtCLFFBQVEsZ0JBQTFCO0FBQ0Q7O0FBRUQsWUFBTSxFQUFOLENBQVMsdURBQVQsRUFBa0UsWUFBWTtBQUM1RSxnQkFBUSxNQUFSLENBQWUsNEJBQWY7QUFDRCxPQUZEOztBQUlBLGNBQVEsTUFBUixDQUFlLDRCQUFmO0FBQ0QsS0FsQkQ7O0FBb0JBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsZUFBUyxRQUFULEdBQW9CLE1BQXBCO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLGdCQUFMLEdBQXdCLFVBQVUsWUFBVixFQUF3QjtBQUM5QyxTQUFHLGVBQUgsQ0FBbUIsU0FBUyxJQUFULENBQWMsaUJBQWQsQ0FBbkIsRUFBcUQsWUFBckQ7QUFDRCxLQUZEOztBQUlBLFNBQUssY0FBTCxHQUFzQixVQUFVLFVBQVYsRUFBc0I7QUFDMUMsU0FBRyxlQUFILENBQW1CLFNBQVMsSUFBVCxDQUFjLGVBQWQsQ0FBbkIsRUFBbUQsVUFBbkQ7QUFDQSxVQUFJLFVBQUosRUFBZ0I7QUFDZCxhQUFLLFVBQUw7QUFDRCxPQUZELE1BRU87QUFDTCxhQUFLLFFBQUw7QUFDRDtBQUNGLEtBUEQ7O0FBU0EsU0FBSyxRQUFMLEdBQWdCLFVBQVUsaUJBQVYsRUFBNkI7QUFDM0MsVUFBSSxPQUFPLFNBQVMsSUFBVCxDQUFjLFFBQWQsQ0FBWDtBQUNBLFVBQUksQ0FBQyxpQkFBTCxFQUF3QjtBQUN0QixlQUFPLEtBQUssR0FBTCxDQUFTLGVBQVQsQ0FBUDtBQUNEO0FBQ0QsU0FBRyxTQUFILENBQWEsSUFBYixFQUFtQixJQUFuQjtBQUNELEtBTkQ7O0FBUUEsU0FBSyxVQUFMLEdBQWtCLFVBQVUsaUJBQVYsRUFBNkI7QUFDN0MsVUFBSSxPQUFPLFNBQVMsSUFBVCxDQUFjLFFBQWQsQ0FBWDtBQUNBLFVBQUksQ0FBQyxpQkFBTCxFQUF3QjtBQUN0QixlQUFPLEtBQUssR0FBTCxDQUFTLGVBQVQsQ0FBUDtBQUNEO0FBQ0QsU0FBRyxTQUFILENBQWEsSUFBYixFQUFtQixLQUFuQjtBQUNELEtBTkQ7QUFPRCxHQS9ERDs7QUFpRUEsTUFBSSxhQUFhLFNBQWIsVUFBYSxDQUFVLE9BQVYsRUFBbUI7QUFDbEMsUUFBSSxPQUFPLElBQVg7QUFDQSxRQUFJLEtBQUssRUFBRSxVQUFGLENBQWEsRUFBdEI7O0FBRUEsUUFBSSxVQUFVLFFBQVEsVUFBUixDQUFtQixNQUFqQztBQUNBLFFBQUksVUFBVSxRQUFRLE9BQXRCO0FBQ0EsUUFBSSxPQUFPLFFBQVEsUUFBbkI7O0FBRUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsVUFBSSxhQUFhLFFBQVEsYUFBUixHQUF3QixFQUFFLFNBQVMsSUFBWCxDQUF4QixHQUEyQyxPQUE1RDs7QUFFQSxVQUFJLE9BQU8sNkJBQ0UsU0FERixHQUNjLEtBQUssSUFBTCxDQUFVLGFBRHhCLEdBQ3dDLFVBRHhDLEdBRUUsMkRBRkYsR0FHQSxRQUhBLEdBSUEsMEJBSkEsR0FLRSxTQUxGLEdBS2MsS0FBSyxJQUFMLENBQVUsR0FMeEIsR0FLOEIsVUFMOUIsR0FNRSwwRUFORixHQU9BLFFBUEEsSUFRQyxDQUFDLFFBQVEsaUJBQVQsR0FDQywyQkFDRSxTQURGLEdBQ2Msa0NBRGQsR0FDbUQsS0FBSyxJQUFMLENBQVUsZUFEN0QsR0FDK0UsVUFEL0UsR0FFQSxRQUhELEdBR1ksRUFYYixDQUFYO0FBYUEsVUFBSSxTQUFTLHdFQUF3RSxLQUFLLElBQUwsQ0FBVSxNQUFsRixHQUEyRixXQUF4Rzs7QUFFQSxXQUFLLE9BQUwsR0FBZSxHQUFHLE1BQUgsQ0FBVTtBQUN2QixtQkFBVyxhQURZO0FBRXZCLGVBQU8sS0FBSyxJQUFMLENBQVUsTUFGTTtBQUd2QixjQUFNLFFBQVEsV0FIUztBQUl2QixjQUFNLElBSmlCO0FBS3ZCLGdCQUFRO0FBTGUsT0FBVixFQU1aLE1BTlksR0FNSCxRQU5HLENBTU0sVUFOTixDQUFmO0FBT0QsS0F6QkQ7O0FBMkJBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsU0FBRyxVQUFILENBQWMsS0FBSyxPQUFuQjtBQUNBLFdBQUssT0FBTCxDQUFhLE1BQWI7QUFDRCxLQUhEOztBQUtBLFNBQUssWUFBTCxHQUFvQixVQUFVLE1BQVYsRUFBa0IsSUFBbEIsRUFBd0I7QUFDMUMsYUFBTyxFQUFQLENBQVUsVUFBVixFQUFzQixVQUFVLEtBQVYsRUFBaUI7QUFDckMsWUFBSSxNQUFNLE9BQU4sS0FBa0IsSUFBSSxJQUFKLENBQVMsS0FBL0IsRUFBc0M7QUFDcEMsZUFBSyxPQUFMLENBQWEsT0FBYjtBQUNEO0FBQ0YsT0FKRDtBQUtELEtBTkQ7O0FBUUE7OztBQUdBLFNBQUssYUFBTCxHQUFxQixVQUFVLFFBQVYsRUFBb0IsU0FBcEIsRUFBK0IsUUFBL0IsRUFBeUM7QUFDNUQsU0FBRyxTQUFILENBQWEsUUFBYixFQUF1QixVQUFVLEdBQVYsTUFBbUIsU0FBUyxHQUFULEVBQTFDO0FBQ0QsS0FGRDs7QUFJQTs7Ozs7O0FBTUEsU0FBSyxjQUFMLEdBQXNCLFVBQVUsUUFBVixFQUFvQjtBQUN4QyxhQUFPLEVBQUUsUUFBRixDQUFXLFVBQVUsUUFBVixFQUFvQjtBQUNwQyxZQUFJLFlBQVksS0FBSyxPQUFMLENBQWEsSUFBYixDQUFrQixpQkFBbEIsQ0FBaEI7QUFBQSxZQUNBLFdBQVcsS0FBSyxPQUFMLENBQWEsSUFBYixDQUFrQixnQkFBbEIsQ0FEWDtBQUFBLFlBRUEsV0FBVyxLQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWtCLGdCQUFsQixDQUZYO0FBQUEsWUFHQSxtQkFBbUIsS0FBSyxPQUFMLENBQWEsSUFBYixDQUFrQixzQkFBbEIsQ0FIbkI7O0FBS0EsV0FBRyxhQUFILENBQWlCLEtBQUssT0FBdEIsRUFBK0IsWUFBWTtBQUN6QyxrQkFBUSxZQUFSLENBQXFCLGNBQXJCOztBQUVBO0FBQ0EsY0FBSSxDQUFDLFNBQVMsR0FBZCxFQUFtQjtBQUNqQixxQkFBUyxHQUFULEdBQWUsU0FBUyxJQUF4QjtBQUNEOztBQUVELG9CQUFVLEdBQVYsQ0FBYyxTQUFTLElBQXZCOztBQUVBLGNBQUksdUJBQXVCLFNBQXZCLG9CQUF1QixHQUFZO0FBQ3JDLGlCQUFLLGFBQUwsQ0FBbUIsUUFBbkIsRUFBNkIsU0FBN0IsRUFBd0MsUUFBeEM7QUFDQTtBQUNBO0FBQ0EscUJBQVMsSUFBVCxHQUFnQixVQUFVLEdBQVYsRUFBaEI7QUFDRCxXQUxEOztBQU9BLG9CQUFVLEVBQVYsQ0FBYSxPQUFiLEVBQXNCLG9CQUF0QixFQUE0QyxFQUE1QyxDQUErQyxPQUEvQyxFQUF3RCxZQUFZO0FBQ2xFLHVCQUFXLG9CQUFYLEVBQWlDLENBQWpDO0FBQ0QsV0FGRDs7QUFJQSxjQUFJLHNCQUFzQixTQUF0QixtQkFBc0IsR0FBWTtBQUNwQyxpQkFBSyxhQUFMLENBQW1CLFFBQW5CLEVBQTZCLFNBQTdCLEVBQXdDLFFBQXhDO0FBQ0E7QUFDQTtBQUNBLGdCQUFJLENBQUMsU0FBUyxJQUFkLEVBQW9CO0FBQ2xCLHdCQUFVLEdBQVYsQ0FBYyxTQUFTLEdBQVQsRUFBZDtBQUNEO0FBQ0YsV0FQRDs7QUFTQSxtQkFBUyxFQUFULENBQVksT0FBWixFQUFxQixtQkFBckIsRUFBMEMsRUFBMUMsQ0FBNkMsT0FBN0MsRUFBc0QsWUFBWTtBQUNoRSx1QkFBVyxtQkFBWCxFQUFnQyxDQUFoQztBQUNELFdBRkQsRUFFRyxHQUZILENBRU8sU0FBUyxHQUZoQixFQUVxQixPQUZyQixDQUU2QixPQUY3Qjs7QUFJQSxlQUFLLGFBQUwsQ0FBbUIsUUFBbkIsRUFBNkIsU0FBN0IsRUFBd0MsUUFBeEM7QUFDQSxlQUFLLFlBQUwsQ0FBa0IsUUFBbEIsRUFBNEIsUUFBNUI7QUFDQSxlQUFLLFlBQUwsQ0FBa0IsU0FBbEIsRUFBNkIsUUFBN0I7O0FBRUEsMkJBQWlCLElBQWpCLENBQXNCLFNBQXRCLEVBQWlDLFNBQVMsV0FBMUM7O0FBRUEsbUJBQVMsR0FBVCxDQUFhLE9BQWIsRUFBc0IsVUFBVSxLQUFWLEVBQWlCO0FBQ3JDLGtCQUFNLGNBQU47O0FBRUEscUJBQVMsT0FBVCxDQUFpQjtBQUNmLHFCQUFPLFNBQVMsS0FERDtBQUVmLG1CQUFLLFNBQVMsR0FBVCxFQUZVO0FBR2Ysb0JBQU0sVUFBVSxHQUFWLEVBSFM7QUFJZiwyQkFBYSxpQkFBaUIsRUFBakIsQ0FBb0IsVUFBcEI7QUFKRSxhQUFqQjtBQU1BLGlCQUFLLE9BQUwsQ0FBYSxLQUFiLENBQW1CLE1BQW5CO0FBQ0QsV0FWRDtBQVdELFNBbkREOztBQXFEQSxXQUFHLGNBQUgsQ0FBa0IsS0FBSyxPQUF2QixFQUFnQyxZQUFZO0FBQzFDO0FBQ0Esb0JBQVUsR0FBVixDQUFjLHNCQUFkO0FBQ0EsbUJBQVMsR0FBVCxDQUFhLHNCQUFiO0FBQ0EsbUJBQVMsR0FBVCxDQUFhLE9BQWI7O0FBRUEsY0FBSSxTQUFTLEtBQVQsT0FBcUIsU0FBekIsRUFBb0M7QUFDbEMscUJBQVMsTUFBVDtBQUNEO0FBQ0YsU0FURDs7QUFXQSxXQUFHLFVBQUgsQ0FBYyxLQUFLLE9BQW5CO0FBQ0QsT0F2RU0sRUF1RUosT0F2RUksRUFBUDtBQXdFRCxLQXpFRDs7QUEyRUE7OztBQUdBLFNBQUssSUFBTCxHQUFZLFlBQVk7QUFDdEIsVUFBSSxXQUFXLFFBQVEsTUFBUixDQUFlLG9CQUFmLENBQWY7O0FBRUEsY0FBUSxNQUFSLENBQWUsa0JBQWY7QUFDQSxXQUFLLGNBQUwsQ0FBb0IsUUFBcEIsRUFBOEIsSUFBOUIsQ0FBbUMsVUFBVSxRQUFWLEVBQW9CO0FBQ3JELGdCQUFRLE1BQVIsQ0FBZSxxQkFBZjtBQUNBLGdCQUFRLE1BQVIsQ0FBZSxtQkFBZixFQUFvQyxRQUFwQztBQUNELE9BSEQsRUFHRyxJQUhILENBR1EsWUFBWTtBQUNsQixnQkFBUSxNQUFSLENBQWUscUJBQWY7QUFDRCxPQUxEO0FBTUQsS0FWRDtBQVdBLFlBQVEsSUFBUixDQUFhLHNCQUFiLEVBQXFDLFFBQVEsUUFBUixDQUFpQixJQUFqQixDQUFzQixpQkFBdEIsQ0FBckM7QUFDRCxHQXZKRDs7QUF5SkEsTUFBSSxjQUFjLFNBQWQsV0FBYyxDQUFVLE9BQVYsRUFBbUI7QUFDbkMsUUFBSSxPQUFPLElBQVg7QUFDQSxRQUFJLEtBQUssRUFBRSxVQUFGLENBQWEsRUFBdEI7O0FBRUEsUUFBSSxVQUFVLFFBQVEsT0FBdEI7O0FBRUEsU0FBSyxNQUFMLEdBQWM7QUFDWixpRkFBMkUsNEVBQVk7QUFDckYsYUFBSyxNQUFMO0FBQ0QsT0FIVztBQUlaLGlDQUEyQixpQ0FBWTtBQUNyQyxhQUFLLElBQUw7QUFDRDtBQU5XLEtBQWQ7O0FBU0EsU0FBSyxnQkFBTCxHQUF3QixZQUFZO0FBQ2xDLGFBQU8sQ0FBQyxLQUFLLE9BQUwsQ0FBYSxRQUFRLE9BQVIsQ0FBZ0IsSUFBN0IsQ0FBUjtBQUNELEtBRkQ7O0FBSUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsV0FBSyxRQUFMLEdBQWdCLEdBQUcsT0FBSCxDQUFXO0FBQ3pCLG1CQUFXLG1CQURjO0FBRXpCLGtCQUFVLGtCQUFVLEtBQVYsRUFBaUI7QUFDekIsY0FBSSxXQUFXLE1BQU0sSUFBTixDQUFXLGtCQUFYLENBQWY7QUFDQSxtQkFBUyxPQUFULENBQWlCLDRDQUFqQjtBQUNEO0FBTHdCLE9BQVgsRUFNYixNQU5hLEdBTUosUUFOSSxDQU1LLE1BTkwsQ0FBaEI7QUFPQSxVQUFJLFdBQVcsS0FBSyxRQUFMLENBQWMsSUFBZCxDQUFtQixrQkFBbkIsQ0FBZjs7QUFFQSxjQUFRLE1BQVIsQ0FBZSxlQUFmLEVBQWdDLFFBQWhDLEVBQTBDLFFBQVEsT0FBUixDQUFnQixJQUExRDtBQUNELEtBWEQ7O0FBYUEsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QixXQUFLLFFBQUwsQ0FBYyxNQUFkO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLE1BQUwsR0FBYyxZQUFZO0FBQ3hCO0FBQ0EsVUFBSSxDQUFDLFFBQVEsTUFBUixDQUFlLGlCQUFmLENBQUwsRUFBd0M7QUFDdEMsYUFBSyxJQUFMO0FBQ0E7QUFDRDs7QUFFRCxVQUFJLE1BQU0sUUFBUSxNQUFSLENBQWUsb0JBQWYsQ0FBVjtBQUNBLFVBQUksSUFBSSxXQUFKLE1BQXFCLElBQUksVUFBSixFQUF6QixFQUEyQztBQUN6QyxZQUFJLFNBQVMsSUFBSSxRQUFKLENBQWEsSUFBSSxFQUFqQixFQUFxQixJQUFJLFFBQXpCLENBQWI7QUFDQSxZQUFJLE9BQU8sRUFBRSxNQUFGLEVBQVUsSUFBVixDQUFlLE1BQWYsQ0FBWDtBQUNBLGFBQUssUUFBTCxDQUFjLElBQWQsQ0FBbUIsR0FBbkIsRUFBd0IsSUFBeEIsQ0FBNkIsTUFBN0IsRUFBcUMsSUFBckMsRUFBMkMsSUFBM0MsQ0FBZ0QsSUFBaEQ7O0FBRUEsWUFBSSxNQUFNLElBQUksa0JBQUosQ0FBdUIsTUFBdkIsQ0FBVjtBQUNBLGFBQUssUUFBTCxDQUFjLEdBQWQsQ0FBa0I7QUFDaEIsbUJBQVMsT0FETztBQUVoQixnQkFBTSxJQUFJLElBRk07QUFHaEIsZUFBSyxJQUFJO0FBSE8sU0FBbEI7QUFLRCxPQVhELE1BV087QUFDTCxhQUFLLElBQUw7QUFDRDtBQUNGLEtBdEJEOztBQXdCQSxTQUFLLElBQUwsR0FBWSxZQUFZO0FBQ3RCLFdBQUssUUFBTCxDQUFjLElBQWQ7QUFDRCxLQUZEO0FBR0QsR0EvREQ7O0FBaUVBLE1BQUksY0FBYyxTQUFkLFdBQWMsQ0FBVSxPQUFWLEVBQW1CO0FBQ25DLFFBQUksT0FBTyxJQUFYO0FBQ0EsUUFBSSxLQUFLLEVBQUUsVUFBRixDQUFhLEVBQXRCOztBQUVBLFFBQUksVUFBVSxRQUFRLFVBQVIsQ0FBbUIsTUFBakM7QUFDQSxRQUFJLFVBQVUsUUFBUSxPQUF0QjtBQUNBLFFBQUksT0FBTyxRQUFRLFFBQW5COztBQUVBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCLFVBQUksYUFBYSxRQUFRLGFBQVIsR0FBd0IsRUFBRSxTQUFTLElBQVgsQ0FBeEIsR0FBMkMsT0FBNUQ7O0FBRUEsVUFBSSxrQkFBa0IsRUFBdEI7QUFDQSxVQUFJLFFBQVEsb0JBQVosRUFBa0M7QUFDaEMsWUFBSSxPQUFPLEtBQUssS0FBTCxDQUFXLEtBQUssR0FBTCxDQUFTLFFBQVEsb0JBQWpCLElBQXlDLEtBQUssR0FBTCxDQUFTLElBQVQsQ0FBcEQsQ0FBWDtBQUNBLFlBQUksZUFBZSxDQUFDLFFBQVEsb0JBQVIsR0FBK0IsS0FBSyxHQUFMLENBQVMsSUFBVCxFQUFlLElBQWYsQ0FBaEMsRUFBc0QsT0FBdEQsQ0FBOEQsQ0FBOUQsSUFBbUUsQ0FBbkUsR0FDQSxHQURBLEdBQ00sU0FBUyxJQUFULENBRE4sR0FDdUIsR0FEMUM7QUFFQSwwQkFBa0IsWUFBWSxLQUFLLEtBQUwsQ0FBVyxlQUF2QixHQUF5QyxLQUF6QyxHQUFpRCxZQUFqRCxHQUFnRSxVQUFsRjtBQUNEOztBQUVELFVBQUksT0FBTywwREFDRSxTQURGLEdBQ2MsS0FBSyxLQUFMLENBQVcsZUFEekIsR0FDMkMsVUFEM0MsR0FFRSwrR0FGRixHQUdFLGVBSEYsR0FJQSxRQUpBLEdBS0Esc0VBTEEsR0FNRSxTQU5GLEdBTWMsS0FBSyxLQUFMLENBQVcsR0FOekIsR0FNK0IsVUFOL0IsR0FPRSxxRUFQRixHQVFBLFFBUlg7QUFTQSxVQUFJLFNBQVMseUVBQXlFLEtBQUssS0FBTCxDQUFXLE1BQXBGLEdBQTZGLFdBQTFHOztBQUVBLFdBQUssT0FBTCxHQUFlLEdBQUcsTUFBSCxDQUFVO0FBQ3ZCLGVBQU8sS0FBSyxLQUFMLENBQVcsTUFESztBQUV2QixjQUFNLFFBQVEsV0FGUztBQUd2QixjQUFNLElBSGlCO0FBSXZCLGdCQUFRO0FBSmUsT0FBVixFQUtaLE1BTFksR0FLSCxRQUxHLENBS00sVUFMTixDQUFmO0FBTUQsS0E1QkQ7O0FBOEJBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsU0FBRyxVQUFILENBQWMsS0FBSyxPQUFuQjtBQUNBLFdBQUssT0FBTCxDQUFhLE1BQWI7QUFDRCxLQUhEOztBQUtBLFNBQUssWUFBTCxHQUFvQixVQUFVLE1BQVYsRUFBa0IsSUFBbEIsRUFBd0I7QUFDMUMsYUFBTyxFQUFQLENBQVUsVUFBVixFQUFzQixVQUFVLEtBQVYsRUFBaUI7QUFDckMsWUFBSSxNQUFNLE9BQU4sS0FBa0IsSUFBSSxJQUFKLENBQVMsS0FBL0IsRUFBc0M7QUFDcEMsZUFBSyxPQUFMLENBQWEsT0FBYjtBQUNEO0FBQ0YsT0FKRDtBQUtELEtBTkQ7O0FBUUEsU0FBSyxJQUFMLEdBQVksWUFBWTtBQUN0QixjQUFRLE1BQVIsQ0FBZSxrQkFBZjtBQUNBLFdBQUssZUFBTCxHQUF1QixJQUF2QixDQUE0QixVQUFVLElBQVYsRUFBZ0I7QUFDMUM7QUFDQSxXQUFHLFVBQUgsQ0FBYyxLQUFLLE9BQW5CO0FBQ0EsZ0JBQVEsTUFBUixDQUFlLHFCQUFmOztBQUVBLFlBQUksT0FBTyxJQUFQLEtBQWdCLFFBQXBCLEVBQThCO0FBQUU7QUFDOUIsa0JBQVEsTUFBUixDQUFlLG9CQUFmLEVBQXFDLElBQXJDO0FBQ0QsU0FGRCxNQUVPO0FBQUU7QUFDUCxrQkFBUSxNQUFSLENBQWUsK0JBQWYsRUFBZ0QsSUFBaEQ7QUFDRDtBQUNGLE9BVkQsRUFVRyxJQVZILENBVVEsWUFBWTtBQUNsQixnQkFBUSxNQUFSLENBQWUscUJBQWY7QUFDRCxPQVpEO0FBYUQsS0FmRDs7QUFpQkE7Ozs7OztBQU1BLFNBQUssZUFBTCxHQUF1QixZQUFZO0FBQ2pDLGFBQU8sRUFBRSxRQUFGLENBQVcsVUFBVSxRQUFWLEVBQW9CO0FBQ3BDLFlBQUksY0FBYyxLQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWtCLG1CQUFsQixDQUFsQjtBQUFBLFlBQ0ksWUFBWSxLQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWtCLGlCQUFsQixDQURoQjtBQUFBLFlBRUksWUFBWSxLQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWtCLGlCQUFsQixDQUZoQjs7QUFJQSxXQUFHLGFBQUgsQ0FBaUIsS0FBSyxPQUF0QixFQUErQixZQUFZO0FBQ3pDLGtCQUFRLFlBQVIsQ0FBcUIsY0FBckI7O0FBRUE7QUFDQSxzQkFBWSxXQUFaLENBQXdCLFlBQVksS0FBWixHQUNyQixFQURxQixDQUNsQixRQURrQixFQUNSLFlBQVk7QUFDeEIscUJBQVMsT0FBVCxDQUFpQixLQUFLLEtBQUwsSUFBYyxLQUFLLEtBQXBDO0FBQ0QsV0FIcUIsRUFJckIsR0FKcUIsQ0FJakIsRUFKaUIsQ0FBeEI7O0FBT0Esb0JBQVUsS0FBVixDQUFnQixVQUFVLEtBQVYsRUFBaUI7QUFDL0Isa0JBQU0sY0FBTjs7QUFFQSxxQkFBUyxPQUFULENBQWlCLFVBQVUsR0FBVixFQUFqQjtBQUNELFdBSkQ7O0FBTUEsb0JBQVUsRUFBVixDQUFhLGFBQWIsRUFBNEIsWUFBWTtBQUN0QyxnQkFBSSxNQUFNLFVBQVUsR0FBVixFQUFWO0FBQ0EsZUFBRyxTQUFILENBQWEsU0FBYixFQUF3QixHQUF4QjtBQUNELFdBSEQsRUFHRyxHQUhILENBR08sRUFIUCxFQUdXLE9BSFgsQ0FHbUIsT0FIbkI7QUFJQSxlQUFLLFlBQUwsQ0FBa0IsU0FBbEIsRUFBNkIsU0FBN0I7QUFDRCxTQXRCRDs7QUF3QkEsV0FBRyxjQUFILENBQWtCLEtBQUssT0FBdkIsRUFBZ0MsWUFBWTtBQUMxQyxzQkFBWSxHQUFaLENBQWdCLFFBQWhCO0FBQ0Esb0JBQVUsR0FBVixDQUFjLHNCQUFkO0FBQ0Esb0JBQVUsR0FBVixDQUFjLE9BQWQ7O0FBRUEsY0FBSSxTQUFTLEtBQVQsT0FBcUIsU0FBekIsRUFBb0M7QUFDbEMscUJBQVMsTUFBVDtBQUNEO0FBQ0YsU0FSRDs7QUFVQSxXQUFHLFVBQUgsQ0FBYyxLQUFLLE9BQW5CO0FBQ0QsT0F4Q00sQ0FBUDtBQXlDRCxLQTFDRDtBQTJDRCxHQXJIRDs7QUF1SEEsTUFBSSxlQUFlLFNBQWYsWUFBZSxDQUFVLE9BQVYsRUFBbUI7QUFDcEMsUUFBSSxLQUFLLEVBQUUsVUFBRixDQUFhLEVBQXRCOztBQUVBLFFBQUksVUFBVSxRQUFRLE9BQXRCOztBQUVBLFNBQUssZ0JBQUwsR0FBd0IsWUFBWTtBQUNsQyxhQUFPLENBQUMsS0FBSyxPQUFMLENBQWEsUUFBUSxPQUFSLENBQWdCLEtBQTdCLENBQVI7QUFDRCxLQUZEOztBQUlBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCLFdBQUssUUFBTCxHQUFnQixHQUFHLE9BQUgsQ0FBVztBQUN6QixtQkFBVztBQURjLE9BQVgsRUFFYixNQUZhLEdBRUosUUFGSSxDQUVLLE1BRkwsQ0FBaEI7QUFHQSxVQUFJLFdBQVcsS0FBSyxRQUFMLENBQWMsSUFBZCxDQUFtQixrQkFBbkIsQ0FBZjs7QUFFQSxjQUFRLE1BQVIsQ0FBZSxlQUFmLEVBQWdDLFFBQWhDLEVBQTBDLFFBQVEsT0FBUixDQUFnQixLQUExRDtBQUNELEtBUEQ7O0FBU0EsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QixXQUFLLFFBQUwsQ0FBYyxNQUFkO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLE1BQUwsR0FBYyxVQUFVLE1BQVYsRUFBa0I7QUFDOUIsVUFBSSxJQUFJLEtBQUosQ0FBVSxNQUFWLENBQUosRUFBdUI7QUFDckIsWUFBSSxNQUFNLElBQUksa0JBQUosQ0FBdUIsTUFBdkIsQ0FBVjtBQUNBLGFBQUssUUFBTCxDQUFjLEdBQWQsQ0FBa0I7QUFDaEIsbUJBQVMsT0FETztBQUVoQixnQkFBTSxJQUFJLElBRk07QUFHaEIsZUFBSyxJQUFJO0FBSE8sU0FBbEI7QUFLRCxPQVBELE1BT087QUFDTCxhQUFLLElBQUw7QUFDRDtBQUNGLEtBWEQ7O0FBYUEsU0FBSyxJQUFMLEdBQVksWUFBWTtBQUN0QixXQUFLLFFBQUwsQ0FBYyxJQUFkO0FBQ0QsS0FGRDtBQUdELEdBdENEOztBQXdDQSxNQUFJLGNBQWMsU0FBZCxXQUFjLENBQVUsT0FBVixFQUFtQjtBQUNuQyxRQUFJLE9BQU8sSUFBWDtBQUNBLFFBQUksS0FBSyxFQUFFLFVBQUYsQ0FBYSxFQUF0Qjs7QUFFQSxRQUFJLFVBQVUsUUFBUSxVQUFSLENBQW1CLE1BQWpDO0FBQ0EsUUFBSSxVQUFVLFFBQVEsT0FBdEI7QUFDQSxRQUFJLE9BQU8sUUFBUSxRQUFuQjs7QUFFQSxTQUFLLFVBQUwsR0FBa0IsWUFBWTtBQUM1QixVQUFJLGFBQWEsUUFBUSxhQUFSLEdBQXdCLEVBQUUsU0FBUyxJQUFYLENBQXhCLEdBQTJDLE9BQTVEOztBQUVBLFVBQUksT0FBTyx1Q0FDUCxTQURPLEdBQ0ssS0FBSyxLQUFMLENBQVcsR0FEaEIsR0FDc0IsNkJBRHRCLEdBQ3NELEtBQUssS0FBTCxDQUFXLFNBRGpFLEdBQzZFLGtCQUQ3RSxHQUVQLGtFQUZPLEdBR1AsUUFISjtBQUlBLFVBQUksU0FBUyx5RUFBeUUsS0FBSyxLQUFMLENBQVcsTUFBcEYsR0FBNkYsV0FBMUc7O0FBRUEsV0FBSyxPQUFMLEdBQWUsR0FBRyxNQUFILENBQVU7QUFDdkIsZUFBTyxLQUFLLEtBQUwsQ0FBVyxNQURLO0FBRXZCLGNBQU0sUUFBUSxXQUZTO0FBR3ZCLGNBQU0sSUFIaUI7QUFJdkIsZ0JBQVE7QUFKZSxPQUFWLEVBS1osTUFMWSxHQUtILFFBTEcsQ0FLTSxVQUxOLENBQWY7QUFNRCxLQWZEOztBQWlCQSxTQUFLLE9BQUwsR0FBZSxZQUFZO0FBQ3pCLFNBQUcsVUFBSCxDQUFjLEtBQUssT0FBbkI7QUFDQSxXQUFLLE9BQUwsQ0FBYSxNQUFiO0FBQ0QsS0FIRDs7QUFLQSxTQUFLLFlBQUwsR0FBb0IsVUFBVSxNQUFWLEVBQWtCLElBQWxCLEVBQXdCO0FBQzFDLGFBQU8sRUFBUCxDQUFVLFVBQVYsRUFBc0IsVUFBVSxLQUFWLEVBQWlCO0FBQ3JDLFlBQUksTUFBTSxPQUFOLEtBQWtCLElBQUksSUFBSixDQUFTLEtBQS9CLEVBQXNDO0FBQ3BDLGVBQUssT0FBTCxDQUFhLE9BQWI7QUFDRDtBQUNGLE9BSkQ7QUFLRCxLQU5EOztBQVFBLFNBQUssZUFBTCxHQUF1QixVQUFVLEdBQVYsRUFBZTtBQUNwQztBQUNBLFVBQUksV0FBVyxzSEFBZjtBQUNBLFVBQUksVUFBVSxJQUFJLEtBQUosQ0FBVSxRQUFWLENBQWQ7O0FBRUEsVUFBSSxXQUFXLG9EQUFmO0FBQ0EsVUFBSSxVQUFVLElBQUksS0FBSixDQUFVLFFBQVYsQ0FBZDs7QUFFQSxVQUFJLFVBQVUsaUNBQWQ7QUFDQSxVQUFJLFNBQVMsSUFBSSxLQUFKLENBQVUsT0FBVixDQUFiOztBQUVBLFVBQUksWUFBWSwyREFBaEI7QUFDQSxVQUFJLFdBQVcsSUFBSSxLQUFKLENBQVUsU0FBVixDQUFmOztBQUVBLFVBQUksV0FBVyxnRUFBZjtBQUNBLFVBQUksVUFBVSxJQUFJLEtBQUosQ0FBVSxRQUFWLENBQWQ7O0FBRUEsVUFBSSxjQUFjLDZDQUFsQjtBQUNBLFVBQUksYUFBYSxJQUFJLEtBQUosQ0FBVSxXQUFWLENBQWpCOztBQUVBLFVBQUksWUFBWSxnQkFBaEI7QUFDQSxVQUFJLFdBQVcsSUFBSSxLQUFKLENBQVUsU0FBVixDQUFmOztBQUVBLFVBQUksWUFBWSxnQkFBaEI7QUFDQSxVQUFJLFdBQVcsSUFBSSxLQUFKLENBQVUsU0FBVixDQUFmOztBQUVBLFVBQUksYUFBYSxhQUFqQjtBQUNBLFVBQUksWUFBWSxJQUFJLEtBQUosQ0FBVSxVQUFWLENBQWhCOztBQUVBLFVBQUksTUFBSjtBQUNBLFVBQUksV0FBVyxRQUFRLENBQVIsRUFBVyxNQUFYLEtBQXNCLEVBQXJDLEVBQXlDO0FBQ3ZDLFlBQUksWUFBWSxRQUFRLENBQVIsQ0FBaEI7QUFDQSxpQkFBUyxFQUFFLFVBQUYsRUFDSixJQURJLENBQ0MsYUFERCxFQUNnQixDQURoQixFQUVKLElBRkksQ0FFQyxLQUZELEVBRVEsNkJBQTZCLFNBRnJDLEVBR0osSUFISSxDQUdDLE9BSEQsRUFHVSxLQUhWLEVBR2lCLElBSGpCLENBR3NCLFFBSHRCLEVBR2dDLEtBSGhDLENBQVQ7QUFJRCxPQU5ELE1BTU8sSUFBSSxXQUFXLFFBQVEsQ0FBUixFQUFXLE1BQTFCLEVBQWtDO0FBQ3ZDLGlCQUFTLEVBQUUsVUFBRixFQUNKLElBREksQ0FDQyxhQURELEVBQ2dCLENBRGhCLEVBRUosSUFGSSxDQUVDLEtBRkQsRUFFUSw2QkFBNkIsUUFBUSxDQUFSLENBQTdCLEdBQTBDLFNBRmxELEVBR0osSUFISSxDQUdDLE9BSEQsRUFHVSxLQUhWLEVBR2lCLElBSGpCLENBR3NCLFFBSHRCLEVBR2dDLEtBSGhDLEVBSUosSUFKSSxDQUlDLFdBSkQsRUFJYyxJQUpkLEVBS0osSUFMSSxDQUtDLG1CQUxELEVBS3NCLE1BTHRCLENBQVQ7QUFNRCxPQVBNLE1BT0EsSUFBSSxVQUFVLE9BQU8sQ0FBUCxFQUFVLE1BQXhCLEVBQWdDO0FBQ3JDLGlCQUFTLEVBQUUsVUFBRixFQUNKLElBREksQ0FDQyxhQURELEVBQ2dCLENBRGhCLEVBRUosSUFGSSxDQUVDLEtBRkQsRUFFUSxPQUFPLENBQVAsSUFBWSxlQUZwQixFQUdKLElBSEksQ0FHQyxPQUhELEVBR1UsS0FIVixFQUdpQixJQUhqQixDQUdzQixRQUh0QixFQUdnQyxLQUhoQyxFQUlKLElBSkksQ0FJQyxPQUpELEVBSVUsWUFKVixDQUFUO0FBS0QsT0FOTSxNQU1BLElBQUksWUFBWSxTQUFTLENBQVQsRUFBWSxNQUE1QixFQUFvQztBQUN6QyxpQkFBUyxFQUFFLG1FQUFGLEVBQ0osSUFESSxDQUNDLGFBREQsRUFDZ0IsQ0FEaEIsRUFFSixJQUZJLENBRUMsS0FGRCxFQUVRLDhCQUE4QixTQUFTLENBQVQsQ0FGdEMsRUFHSixJQUhJLENBR0MsT0FIRCxFQUdVLEtBSFYsRUFHaUIsSUFIakIsQ0FHc0IsUUFIdEIsRUFHZ0MsS0FIaEMsQ0FBVDtBQUlELE9BTE0sTUFLQSxJQUFJLFdBQVcsUUFBUSxDQUFSLEVBQVcsTUFBMUIsRUFBa0M7QUFDdkMsaUJBQVMsRUFBRSxVQUFGLEVBQ0osSUFESSxDQUNDLGFBREQsRUFDZ0IsQ0FEaEIsRUFFSixJQUZJLENBRUMsS0FGRCxFQUVRLHVDQUF1QyxRQUFRLENBQVIsQ0FGL0MsRUFHSixJQUhJLENBR0MsT0FIRCxFQUdVLEtBSFYsRUFHaUIsSUFIakIsQ0FHc0IsUUFIdEIsRUFHZ0MsS0FIaEMsQ0FBVDtBQUlELE9BTE0sTUFLQSxJQUFJLGNBQWMsV0FBVyxDQUFYLEVBQWMsTUFBaEMsRUFBd0M7QUFDN0MsaUJBQVMsRUFBRSxtRUFBRixFQUNKLElBREksQ0FDQyxhQURELEVBQ2dCLENBRGhCLEVBRUosSUFGSSxDQUVDLFFBRkQsRUFFVyxLQUZYLEVBR0osSUFISSxDQUdDLE9BSEQsRUFHVSxLQUhWLEVBSUosSUFKSSxDQUlDLEtBSkQsRUFJUSw4QkFBOEIsV0FBVyxDQUFYLENBSnRDLENBQVQ7QUFLRCxPQU5NLE1BTUEsSUFBSSxZQUFZLFFBQVosSUFBd0IsU0FBNUIsRUFBdUM7QUFDNUMsaUJBQVMsRUFBRSxrQkFBRixFQUNKLElBREksQ0FDQyxLQURELEVBQ1EsR0FEUixFQUVKLElBRkksQ0FFQyxPQUZELEVBRVUsS0FGVixFQUVpQixJQUZqQixDQUVzQixRQUZ0QixFQUVnQyxLQUZoQyxDQUFUO0FBR0QsT0FKTSxNQUlBO0FBQ0w7QUFDQSxlQUFPLEtBQVA7QUFDRDs7QUFFRCxhQUFPLFFBQVAsQ0FBZ0IsaUJBQWhCOztBQUVBLGFBQU8sT0FBTyxDQUFQLENBQVA7QUFDRCxLQTdFRDs7QUErRUEsU0FBSyxJQUFMLEdBQVksWUFBWTtBQUN0QixVQUFJLE9BQU8sUUFBUSxNQUFSLENBQWUsd0JBQWYsQ0FBWDtBQUNBLGNBQVEsTUFBUixDQUFlLGtCQUFmO0FBQ0EsV0FBSyxlQUFMLENBQXFCLElBQXJCLEVBQTJCLElBQTNCLENBQWdDLFVBQVUsR0FBVixFQUFlO0FBQzdDO0FBQ0EsV0FBRyxVQUFILENBQWMsS0FBSyxPQUFuQjtBQUNBLGdCQUFRLE1BQVIsQ0FBZSxxQkFBZjs7QUFFQTtBQUNBLFlBQUksUUFBUSxLQUFLLGVBQUwsQ0FBcUIsR0FBckIsQ0FBWjs7QUFFQSxZQUFJLEtBQUosRUFBVztBQUNUO0FBQ0Esa0JBQVEsTUFBUixDQUFlLG1CQUFmLEVBQW9DLEtBQXBDO0FBQ0Q7QUFDRixPQVpELEVBWUcsSUFaSCxDQVlRLFlBQVk7QUFDbEIsZ0JBQVEsTUFBUixDQUFlLHFCQUFmO0FBQ0QsT0FkRDtBQWVELEtBbEJEOztBQW9CQTs7Ozs7O0FBTUEsU0FBSyxlQUFMLEdBQXVCLFVBQVUsSUFBVixFQUFnQjtBQUNyQyxhQUFPLEVBQUUsUUFBRixDQUFXLFVBQVUsUUFBVixFQUFvQjtBQUNwQyxZQUFJLFlBQVksS0FBSyxPQUFMLENBQWEsSUFBYixDQUFrQixpQkFBbEIsQ0FBaEI7QUFBQSxZQUNJLFlBQVksS0FBSyxPQUFMLENBQWEsSUFBYixDQUFrQixpQkFBbEIsQ0FEaEI7O0FBR0EsV0FBRyxhQUFILENBQWlCLEtBQUssT0FBdEIsRUFBK0IsWUFBWTtBQUN6QyxrQkFBUSxZQUFSLENBQXFCLGNBQXJCOztBQUVBLG9CQUFVLEdBQVYsQ0FBYyxJQUFkLEVBQW9CLEVBQXBCLENBQXVCLE9BQXZCLEVBQWdDLFlBQVk7QUFDMUMsZUFBRyxTQUFILENBQWEsU0FBYixFQUF3QixVQUFVLEdBQVYsRUFBeEI7QUFDRCxXQUZELEVBRUcsT0FGSCxDQUVXLE9BRlg7O0FBSUEsb0JBQVUsS0FBVixDQUFnQixVQUFVLEtBQVYsRUFBaUI7QUFDL0Isa0JBQU0sY0FBTjs7QUFFQSxxQkFBUyxPQUFULENBQWlCLFVBQVUsR0FBVixFQUFqQjtBQUNELFdBSkQ7O0FBTUEsZUFBSyxZQUFMLENBQWtCLFNBQWxCLEVBQTZCLFNBQTdCO0FBQ0QsU0FkRDs7QUFnQkEsV0FBRyxjQUFILENBQWtCLEtBQUssT0FBdkIsRUFBZ0MsWUFBWTtBQUMxQyxvQkFBVSxHQUFWLENBQWMsT0FBZDtBQUNBLG9CQUFVLEdBQVYsQ0FBYyxPQUFkOztBQUVBLGNBQUksU0FBUyxLQUFULE9BQXFCLFNBQXpCLEVBQW9DO0FBQ2xDLHFCQUFTLE1BQVQ7QUFDRDtBQUNGLFNBUEQ7O0FBU0EsV0FBRyxVQUFILENBQWMsS0FBSyxPQUFuQjtBQUNELE9BOUJNLENBQVA7QUErQkQsS0FoQ0Q7QUFpQ0QsR0FoTEQ7O0FBa0xBLE1BQUksYUFBYSxTQUFiLFVBQWEsQ0FBVSxPQUFWLEVBQW1CO0FBQ2xDLFFBQUksT0FBTyxJQUFYO0FBQ0EsUUFBSSxLQUFLLEVBQUUsVUFBRixDQUFhLEVBQXRCOztBQUVBLFFBQUksVUFBVSxRQUFRLFVBQVIsQ0FBbUIsTUFBakM7QUFDQSxRQUFJLFVBQVUsUUFBUSxPQUF0QjtBQUNBLFFBQUksT0FBTyxRQUFRLFFBQW5COztBQUVBLFNBQUssa0JBQUwsR0FBMEIsWUFBWTtBQUNwQyxVQUFJLFNBQVMsUUFBUSxNQUFSLENBQWUsTUFBTSxLQUFOLEdBQWMsS0FBZCxHQUFzQixJQUFyQyxDQUFiO0FBQ0EsYUFBTyxPQUFPLElBQVAsQ0FBWSxNQUFaLEVBQW9CLEdBQXBCLENBQXdCLFVBQVUsR0FBVixFQUFlO0FBQzVDLFlBQUksVUFBVSxPQUFPLEdBQVAsQ0FBZDtBQUNBLFlBQUksT0FBTyxFQUFFLDBDQUFGLENBQVg7QUFDQSxhQUFLLE1BQUwsQ0FBWSxFQUFFLGlCQUFpQixHQUFqQixHQUF1QixnQkFBekIsRUFBMkMsR0FBM0MsQ0FBK0M7QUFDekQsbUJBQVMsR0FEZ0Q7QUFFekQsMEJBQWdCO0FBRnlDLFNBQS9DLENBQVosRUFHSSxNQUhKLENBR1csRUFBRSxTQUFGLEVBQWEsSUFBYixDQUFrQixRQUFRLElBQVIsQ0FBYSxVQUFVLE9BQXZCLEtBQW1DLE9BQXJELENBSFg7QUFJQSxlQUFPLEtBQUssSUFBTCxFQUFQO0FBQ0QsT0FSTSxFQVFKLElBUkksQ0FRQyxFQVJELENBQVA7QUFTRCxLQVhEOztBQWFBLFNBQUssVUFBTCxHQUFrQixZQUFZO0FBQzVCLFVBQUksYUFBYSxRQUFRLGFBQVIsR0FBd0IsRUFBRSxTQUFTLElBQVgsQ0FBeEIsR0FBMkMsT0FBNUQ7O0FBRUEsVUFBSSxPQUFPLENBQ1QseUJBRFMsRUFFVCwwRUFGUyxFQUdULG1GQUhTLEVBSVQsc0ZBSlMsRUFLVCxNQUxTLEVBTVQsSUFOUyxDQU1KLEVBTkksQ0FBWDs7QUFRQSxXQUFLLE9BQUwsR0FBZSxHQUFHLE1BQUgsQ0FBVTtBQUN2QixlQUFPLEtBQUssT0FBTCxDQUFhLElBREc7QUFFdkIsY0FBTSxRQUFRLFdBRlM7QUFHdkIsY0FBTSxLQUFLLGtCQUFMLEVBSGlCO0FBSXZCLGdCQUFRLElBSmU7QUFLdkIsa0JBQVUsa0JBQVUsS0FBVixFQUFpQjtBQUN6QixnQkFBTSxJQUFOLENBQVcsYUFBWCxFQUEwQixHQUExQixDQUE4QjtBQUM1QiwwQkFBYyxHQURjO0FBRTVCLHdCQUFZO0FBRmdCLFdBQTlCO0FBSUQ7QUFWc0IsT0FBVixFQVdaLE1BWFksR0FXSCxRQVhHLENBV00sVUFYTixDQUFmO0FBWUQsS0F2QkQ7O0FBeUJBLFNBQUssT0FBTCxHQUFlLFlBQVk7QUFDekIsU0FBRyxVQUFILENBQWMsS0FBSyxPQUFuQjtBQUNBLFdBQUssT0FBTCxDQUFhLE1BQWI7QUFDRCxLQUhEOztBQUtBOzs7OztBQUtBLFNBQUssY0FBTCxHQUFzQixZQUFZO0FBQ2hDLGFBQU8sRUFBRSxRQUFGLENBQVcsVUFBVSxRQUFWLEVBQW9CO0FBQ3BDLFdBQUcsYUFBSCxDQUFpQixLQUFLLE9BQXRCLEVBQStCLFlBQVk7QUFDekMsa0JBQVEsWUFBUixDQUFxQixjQUFyQjtBQUNBLG1CQUFTLE9BQVQ7QUFDRCxTQUhEO0FBSUEsV0FBRyxVQUFILENBQWMsS0FBSyxPQUFuQjtBQUNELE9BTk0sRUFNSixPQU5JLEVBQVA7QUFPRCxLQVJEOztBQVVBLFNBQUssSUFBTCxHQUFZLFlBQVk7QUFDdEIsY0FBUSxNQUFSLENBQWUsa0JBQWY7QUFDQSxXQUFLLGNBQUwsR0FBc0IsSUFBdEIsQ0FBMkIsWUFBWTtBQUNyQyxnQkFBUSxNQUFSLENBQWUscUJBQWY7QUFDRCxPQUZEO0FBR0QsS0FMRDtBQU1ELEdBeEVEOztBQTBFQSxNQUFJLGFBQWEsU0FBYixVQUFhLENBQVUsT0FBVixFQUFtQjtBQUNsQyxRQUFJLE9BQU8sSUFBWDtBQUNBLFFBQUksS0FBSyxFQUFFLFVBQUYsQ0FBYSxFQUF0Qjs7QUFFQSxRQUFJLFVBQVUsUUFBUSxPQUF0Qjs7QUFFQSxRQUFJLDRCQUE0QixFQUFoQzs7QUFFQSxTQUFLLE1BQUwsR0FBYztBQUNaLCtEQUF5RCw0REFBWTtBQUNuRSxhQUFLLE1BQUw7QUFDRCxPQUhXO0FBSVosbURBQTZDLGlEQUFZO0FBQ3ZELGFBQUssSUFBTDtBQUNELE9BTlc7QUFPWiw2QkFBdUIsNEJBQVUsRUFBVixFQUFjLENBQWQsRUFBaUI7QUFDdEM7QUFDQTtBQUNBLFlBQUksTUFBTSxJQUFWLEVBQWdCO0FBQ2Q7QUFDRDs7QUFFRCxZQUFJLENBQUMsRUFBRSxhQUFILElBQW9CLENBQUMsSUFBSSxRQUFKLENBQWEsRUFBRSxhQUFmLEVBQThCLEtBQUssRUFBTCxDQUFRLEtBQUssUUFBTCxDQUFjLENBQWQsQ0FBUixDQUE5QixDQUF6QixFQUFtRjtBQUNqRixlQUFLLElBQUw7QUFDRDtBQUNGO0FBakJXLEtBQWQ7O0FBb0JBLFNBQUssZ0JBQUwsR0FBd0IsWUFBWTtBQUNsQyxhQUFPLFFBQVEsT0FBUixJQUFtQixDQUFDLEtBQUssT0FBTCxDQUFhLFFBQVEsT0FBUixDQUFnQixHQUE3QixDQUEzQjtBQUNELEtBRkQ7O0FBSUEsU0FBSyxVQUFMLEdBQWtCLFlBQVk7QUFDNUIsV0FBSyxRQUFMLEdBQWdCLEdBQUcsT0FBSCxDQUFXO0FBQ3pCLG1CQUFXO0FBRGMsT0FBWCxFQUViLE1BRmEsR0FFSixRQUZJLENBRUssTUFGTCxDQUFoQjtBQUdBLFVBQUksV0FBVyxLQUFLLFFBQUwsQ0FBYyxJQUFkLENBQW1CLGtCQUFuQixDQUFmOztBQUVBLGNBQVEsTUFBUixDQUFlLGVBQWYsRUFBZ0MsUUFBaEMsRUFBMEMsUUFBUSxPQUFSLENBQWdCLEdBQTFEO0FBQ0QsS0FQRDs7QUFTQSxTQUFLLE9BQUwsR0FBZSxZQUFZO0FBQ3pCLFdBQUssUUFBTCxDQUFjLE1BQWQ7QUFDRCxLQUZEOztBQUlBLFNBQUssTUFBTCxHQUFjLFlBQVk7QUFDeEIsVUFBSSxZQUFZLFFBQVEsTUFBUixDQUFlLHFCQUFmLENBQWhCO0FBQ0EsVUFBSSxVQUFVLEtBQVYsSUFBbUIsQ0FBQyxVQUFVLEtBQVYsQ0FBZ0IsV0FBaEIsRUFBeEIsRUFBdUQ7QUFDckQsWUFBSSxPQUFPLEtBQUssSUFBTCxDQUFVLFVBQVUsS0FBVixDQUFnQixjQUFoQixFQUFWLENBQVg7QUFDQSxZQUFJLElBQUosRUFBVTtBQUNSLGNBQUksTUFBTSxLQUFLLFFBQUwsQ0FBYyxJQUFkLENBQVY7QUFDQSxlQUFLLFFBQUwsQ0FBYyxHQUFkLENBQWtCO0FBQ2hCLHFCQUFTLE9BRE87QUFFaEIsa0JBQU0sS0FBSyxHQUFMLENBQVMsSUFBSSxJQUFKLEdBQVcsSUFBSSxLQUFKLEdBQVksQ0FBaEMsRUFBbUMsQ0FBbkMsSUFBd0MseUJBRjlCO0FBR2hCLGlCQUFLLElBQUksR0FBSixHQUFVLElBQUk7QUFISCxXQUFsQjtBQUtEO0FBQ0YsT0FWRCxNQVVPO0FBQ0wsYUFBSyxJQUFMO0FBQ0Q7QUFDRixLQWZEOztBQWlCQSxTQUFLLElBQUwsR0FBWSxZQUFZO0FBQ3RCLFdBQUssUUFBTCxDQUFjLElBQWQ7QUFDRCxLQUZEO0FBR0QsR0FqRUQ7O0FBbUVBLE1BQUksY0FBYyxTQUFkLFdBQWMsQ0FBVSxPQUFWLEVBQW1CO0FBQ25DLFFBQUksT0FBTyxJQUFYO0FBQ0EsUUFBSSxLQUFLLEVBQUUsVUFBRixDQUFhLEVBQXRCOztBQUVBLFFBQUksZUFBZSxDQUFuQjtBQUNBLFFBQUksT0FBTyxRQUFRLE9BQVIsQ0FBZ0IsSUFBaEIsSUFBd0IsRUFBbkM7QUFDQSxRQUFJLFlBQVksUUFBUSxPQUFSLENBQWdCLGFBQWhCLElBQWlDLFFBQWpEO0FBQ0EsUUFBSSxRQUFRLEVBQUUsT0FBRixDQUFVLElBQVYsSUFBa0IsSUFBbEIsR0FBeUIsQ0FBQyxJQUFELENBQXJDOztBQUVBLFNBQUssTUFBTCxHQUFjO0FBQ1osMEJBQW9CLHlCQUFVLEVBQVYsRUFBYyxDQUFkLEVBQWlCO0FBQ25DLFlBQUksQ0FBQyxFQUFFLGtCQUFGLEVBQUwsRUFBNkI7QUFDM0IsZUFBSyxXQUFMLENBQWlCLENBQWpCO0FBQ0Q7QUFDRixPQUxXO0FBTVosNEJBQXNCLDJCQUFVLEVBQVYsRUFBYyxDQUFkLEVBQWlCO0FBQ3JDLGFBQUssYUFBTCxDQUFtQixDQUFuQjtBQUNELE9BUlc7QUFTWixpQ0FBMkIsaUNBQVk7QUFDckMsYUFBSyxJQUFMO0FBQ0Q7QUFYVyxLQUFkOztBQWNBLFNBQUssZ0JBQUwsR0FBd0IsWUFBWTtBQUNsQyxhQUFPLE1BQU0sTUFBTixHQUFlLENBQXRCO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLFVBQUwsR0FBa0IsWUFBWTtBQUM1QixXQUFLLGFBQUwsR0FBcUIsSUFBckI7QUFDQSxXQUFLLFFBQUwsR0FBZ0IsR0FBRyxPQUFILENBQVc7QUFDekIsbUJBQVcsbUJBRGM7QUFFekIsbUJBQVcsSUFGYztBQUd6QixtQkFBVztBQUhjLE9BQVgsRUFJYixNQUphLEdBSUosUUFKSSxDQUlLLE1BSkwsQ0FBaEI7O0FBTUEsV0FBSyxRQUFMLENBQWMsSUFBZDs7QUFFQSxXQUFLLFFBQUwsR0FBZ0IsS0FBSyxRQUFMLENBQWMsSUFBZCxDQUFtQixrQkFBbkIsQ0FBaEI7O0FBRUEsV0FBSyxRQUFMLENBQWMsRUFBZCxDQUFpQixPQUFqQixFQUEwQixpQkFBMUIsRUFBNkMsWUFBWTtBQUN2RCxhQUFLLFFBQUwsQ0FBYyxJQUFkLENBQW1CLFNBQW5CLEVBQThCLFdBQTlCLENBQTBDLFFBQTFDO0FBQ0EsVUFBRSxJQUFGLEVBQVEsUUFBUixDQUFpQixRQUFqQjtBQUNBLGFBQUssT0FBTDtBQUNELE9BSkQ7QUFLRCxLQWpCRDs7QUFtQkEsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QixXQUFLLFFBQUwsQ0FBYyxNQUFkO0FBQ0QsS0FGRDs7QUFJQSxTQUFLLFVBQUwsR0FBa0IsVUFBVSxLQUFWLEVBQWlCO0FBQ2pDLFdBQUssUUFBTCxDQUFjLElBQWQsQ0FBbUIsU0FBbkIsRUFBOEIsV0FBOUIsQ0FBMEMsUUFBMUM7QUFDQSxZQUFNLFFBQU4sQ0FBZSxRQUFmOztBQUVBLFdBQUssUUFBTCxDQUFjLENBQWQsRUFBaUIsU0FBakIsR0FBNkIsTUFBTSxDQUFOLEVBQVMsU0FBVCxHQUFzQixLQUFLLFFBQUwsQ0FBYyxXQUFkLEtBQThCLENBQWpGO0FBQ0QsS0FMRDs7QUFPQSxTQUFLLFFBQUwsR0FBZ0IsWUFBWTtBQUMxQixVQUFJLFdBQVcsS0FBSyxRQUFMLENBQWMsSUFBZCxDQUFtQix3QkFBbkIsQ0FBZjtBQUNBLFVBQUksUUFBUSxTQUFTLElBQVQsRUFBWjs7QUFFQSxVQUFJLE1BQU0sTUFBVixFQUFrQjtBQUNoQixhQUFLLFVBQUwsQ0FBZ0IsS0FBaEI7QUFDRCxPQUZELE1BRU87QUFDTCxZQUFJLGFBQWEsU0FBUyxNQUFULEdBQWtCLElBQWxCLEVBQWpCOztBQUVBLFlBQUksQ0FBQyxXQUFXLE1BQWhCLEVBQXdCO0FBQ3RCLHVCQUFhLEtBQUssUUFBTCxDQUFjLElBQWQsQ0FBbUIsa0JBQW5CLEVBQXVDLEtBQXZDLEVBQWI7QUFDRDs7QUFFRCxhQUFLLFVBQUwsQ0FBZ0IsV0FBVyxJQUFYLENBQWdCLGlCQUFoQixFQUFtQyxLQUFuQyxFQUFoQjtBQUNEO0FBQ0YsS0FmRDs7QUFpQkEsU0FBSyxNQUFMLEdBQWMsWUFBWTtBQUN4QixVQUFJLFdBQVcsS0FBSyxRQUFMLENBQWMsSUFBZCxDQUFtQix3QkFBbkIsQ0FBZjtBQUNBLFVBQUksUUFBUSxTQUFTLElBQVQsRUFBWjs7QUFFQSxVQUFJLE1BQU0sTUFBVixFQUFrQjtBQUNoQixhQUFLLFVBQUwsQ0FBZ0IsS0FBaEI7QUFDRCxPQUZELE1BRU87QUFDTCxZQUFJLGFBQWEsU0FBUyxNQUFULEdBQWtCLElBQWxCLEVBQWpCOztBQUVBLFlBQUksQ0FBQyxXQUFXLE1BQWhCLEVBQXdCO0FBQ3RCLHVCQUFhLEtBQUssUUFBTCxDQUFjLElBQWQsQ0FBbUIsa0JBQW5CLEVBQXVDLElBQXZDLEVBQWI7QUFDRDs7QUFFRCxhQUFLLFVBQUwsQ0FBZ0IsV0FBVyxJQUFYLENBQWdCLGlCQUFoQixFQUFtQyxJQUFuQyxFQUFoQjtBQUNEO0FBQ0YsS0FmRDs7QUFpQkEsU0FBSyxPQUFMLEdBQWUsWUFBWTtBQUN6QixVQUFJLFFBQVEsS0FBSyxRQUFMLENBQWMsSUFBZCxDQUFtQix3QkFBbkIsQ0FBWjs7QUFFQSxVQUFJLE1BQU0sTUFBVixFQUFrQjtBQUNoQixZQUFJLE9BQU8sS0FBSyxZQUFMLENBQWtCLEtBQWxCLENBQVg7QUFDQSxhQUFLLGFBQUwsQ0FBbUIsVUFBbkIsQ0FBOEIsSUFBOUI7QUFDQSxjQUFNLGNBQU4sQ0FBcUIsSUFBckIsRUFBMkIsUUFBM0IsR0FBc0MsTUFBdEM7O0FBRUEsYUFBSyxhQUFMLEdBQXFCLElBQXJCO0FBQ0EsYUFBSyxJQUFMO0FBQ0EsZ0JBQVEsTUFBUixDQUFlLGNBQWY7QUFDRDtBQUVGLEtBYkQ7O0FBZUEsU0FBSyxZQUFMLEdBQW9CLFVBQVUsS0FBVixFQUFpQjtBQUNuQyxVQUFJLE9BQU8sTUFBTSxNQUFNLElBQU4sQ0FBVyxPQUFYLENBQU4sQ0FBWDtBQUNBLFVBQUksT0FBTyxNQUFNLElBQU4sQ0FBVyxNQUFYLENBQVg7QUFDQSxVQUFJLE9BQU8sS0FBSyxPQUFMLEdBQWUsS0FBSyxPQUFMLENBQWEsSUFBYixDQUFmLEdBQW9DLElBQS9DO0FBQ0EsVUFBSSxPQUFPLElBQVAsS0FBZ0IsUUFBcEIsRUFBOEI7QUFDNUIsZUFBTyxJQUFJLFVBQUosQ0FBZSxJQUFmLENBQVA7QUFDRDtBQUNELGFBQU8sSUFBUDtBQUNELEtBUkQ7O0FBVUEsU0FBSyxtQkFBTCxHQUEyQixVQUFVLE9BQVYsRUFBbUIsS0FBbkIsRUFBMEI7QUFDbkQsVUFBSSxPQUFPLE1BQU0sT0FBTixDQUFYO0FBQ0EsYUFBTyxNQUFNLEdBQU4sQ0FBVSxVQUFVLElBQVYsRUFBZ0IsR0FBaEIsRUFBcUI7QUFDcEMsWUFBSSxRQUFRLEVBQUUsK0JBQUYsQ0FBWjtBQUNBLGNBQU0sTUFBTixDQUFhLEtBQUssUUFBTCxHQUFnQixLQUFLLFFBQUwsQ0FBYyxJQUFkLENBQWhCLEdBQXNDLE9BQU8sRUFBMUQ7QUFDQSxjQUFNLElBQU4sQ0FBVztBQUNULG1CQUFTLE9BREE7QUFFVCxrQkFBUTtBQUZDLFNBQVg7O0FBS0EsWUFBSSxZQUFZLENBQVosSUFBaUIsUUFBUSxDQUE3QixFQUFnQztBQUM5QixnQkFBTSxRQUFOLENBQWUsUUFBZjtBQUNEO0FBQ0QsZUFBTyxLQUFQO0FBQ0QsT0FaTSxDQUFQO0FBYUQsS0FmRDs7QUFpQkEsU0FBSyxhQUFMLEdBQXFCLFVBQVUsQ0FBVixFQUFhO0FBQ2hDLFVBQUksQ0FBQyxLQUFLLFFBQUwsQ0FBYyxFQUFkLENBQWlCLFVBQWpCLENBQUwsRUFBbUM7QUFDakM7QUFDRDs7QUFFRCxVQUFJLEVBQUUsT0FBRixLQUFjLElBQUksSUFBSixDQUFTLEtBQTNCLEVBQWtDO0FBQ2hDLFVBQUUsY0FBRjtBQUNBLGFBQUssT0FBTDtBQUNELE9BSEQsTUFHTyxJQUFJLEVBQUUsT0FBRixLQUFjLElBQUksSUFBSixDQUFTLEVBQTNCLEVBQStCO0FBQ3BDLFVBQUUsY0FBRjtBQUNBLGFBQUssTUFBTDtBQUNELE9BSE0sTUFHQSxJQUFJLEVBQUUsT0FBRixLQUFjLElBQUksSUFBSixDQUFTLElBQTNCLEVBQWlDO0FBQ3RDLFVBQUUsY0FBRjtBQUNBLGFBQUssUUFBTDtBQUNEO0FBQ0YsS0FmRDs7QUFpQkEsU0FBSyxhQUFMLEdBQXFCLFVBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQixRQUExQixFQUFvQztBQUN2RCxVQUFJLE9BQU8sTUFBTSxLQUFOLENBQVg7QUFDQSxVQUFJLFFBQVEsS0FBSyxLQUFMLENBQVcsSUFBWCxDQUFnQixPQUFoQixDQUFSLElBQW9DLEtBQUssTUFBN0MsRUFBcUQ7QUFDbkQsWUFBSSxVQUFVLEtBQUssS0FBTCxDQUFXLElBQVgsQ0FBZ0IsT0FBaEIsQ0FBZDtBQUNBLGFBQUssTUFBTCxDQUFZLFFBQVEsQ0FBUixDQUFaLEVBQXdCLFFBQXhCO0FBQ0QsT0FIRCxNQUdPO0FBQ0w7QUFDRDtBQUNGLEtBUkQ7O0FBVUEsU0FBSyxXQUFMLEdBQW1CLFVBQVUsR0FBVixFQUFlLE9BQWYsRUFBd0I7QUFDekMsVUFBSSxTQUFTLEVBQUUsaURBQWlELEdBQWpELEdBQXVELEtBQXpELENBQWI7QUFDQSxXQUFLLGFBQUwsQ0FBbUIsR0FBbkIsRUFBd0IsT0FBeEIsRUFBaUMsVUFBVSxLQUFWLEVBQWlCO0FBQ2hELGdCQUFRLFNBQVMsRUFBakI7QUFDQSxZQUFJLE1BQU0sTUFBVixFQUFrQjtBQUNoQixpQkFBTyxJQUFQLENBQVksS0FBSyxtQkFBTCxDQUF5QixHQUF6QixFQUE4QixLQUE5QixDQUFaO0FBQ0EsZUFBSyxJQUFMO0FBQ0Q7QUFDRixPQU5EOztBQVFBLGFBQU8sTUFBUDtBQUNELEtBWEQ7O0FBYUEsU0FBSyxXQUFMLEdBQW1CLFVBQVUsQ0FBVixFQUFhO0FBQzlCLFVBQUksS0FBSyxRQUFMLENBQWMsQ0FBQyxJQUFJLElBQUosQ0FBUyxLQUFWLEVBQWlCLElBQUksSUFBSixDQUFTLEVBQTFCLEVBQThCLElBQUksSUFBSixDQUFTLElBQXZDLENBQWQsRUFBNEQsRUFBRSxPQUE5RCxDQUFKLEVBQTRFO0FBQzFFLFlBQUksRUFBRSxPQUFGLEtBQWMsSUFBSSxJQUFKLENBQVMsS0FBM0IsRUFBa0M7QUFDaEMsY0FBSSxLQUFLLFFBQUwsQ0FBYyxFQUFkLENBQWlCLFVBQWpCLENBQUosRUFBa0M7QUFDaEM7QUFDRDtBQUNGO0FBQ0YsT0FORCxNQU1PO0FBQ0wsWUFBSSxZQUFZLFFBQVEsTUFBUixDQUFlLG9CQUFmLEVBQXFDLFlBQXJDLEVBQWhCO0FBQ0EsWUFBSSxVQUFVLFVBQVUsUUFBVixFQUFkO0FBQ0EsWUFBSSxNQUFNLE1BQU4sSUFBZ0IsT0FBcEIsRUFBNkI7QUFDM0IsZUFBSyxRQUFMLENBQWMsS0FBZDs7QUFFQSxjQUFJLE1BQU0sS0FBSyxRQUFMLENBQWMsS0FBSyxJQUFMLENBQVUsVUFBVSxjQUFWLEVBQVYsQ0FBZCxDQUFWO0FBQ0EsY0FBSSxHQUFKLEVBQVM7O0FBRVAsaUJBQUssUUFBTCxDQUFjLElBQWQ7O0FBRUEsaUJBQUssYUFBTCxHQUFxQixTQUFyQjs7QUFFQSxrQkFBTSxPQUFOLENBQWMsVUFBVSxJQUFWLEVBQWdCLEdBQWhCLEVBQXFCO0FBQ2pDLGtCQUFJLEtBQUssS0FBTCxDQUFXLElBQVgsQ0FBZ0IsT0FBaEIsQ0FBSixFQUE4QjtBQUM1QixxQkFBSyxXQUFMLENBQWlCLEdBQWpCLEVBQXNCLE9BQXRCLEVBQStCLFFBQS9CLENBQXdDLEtBQUssUUFBN0M7QUFDRDtBQUNGLGFBSkQ7O0FBTUE7QUFDQSxnQkFBSSxjQUFjLEtBQWxCLEVBQXlCO0FBQ3ZCLG1CQUFLLFFBQUwsQ0FBYyxHQUFkLENBQWtCO0FBQ2hCLHNCQUFNLElBQUksSUFETTtBQUVoQixxQkFBSyxJQUFJLEdBQUosR0FBVSxLQUFLLFFBQUwsQ0FBYyxXQUFkLEVBQVYsR0FBd0M7QUFGN0IsZUFBbEI7QUFJRCxhQUxELE1BS087QUFDTCxtQkFBSyxRQUFMLENBQWMsR0FBZCxDQUFrQjtBQUNoQixzQkFBTSxJQUFJLElBRE07QUFFaEIscUJBQUssSUFBSSxHQUFKLEdBQVUsSUFBSSxNQUFkLEdBQXVCO0FBRlosZUFBbEI7QUFJRDtBQUVGO0FBQ0YsU0E5QkQsTUE4Qk87QUFDTCxlQUFLLElBQUw7QUFDRDtBQUNGO0FBQ0YsS0E1Q0Q7O0FBOENBLFNBQUssSUFBTCxHQUFZLFlBQVk7QUFDdEIsV0FBSyxRQUFMLENBQWMsSUFBZDtBQUNELEtBRkQ7O0FBSUEsU0FBSyxJQUFMLEdBQVksWUFBWTtBQUN0QixXQUFLLFFBQUwsQ0FBYyxJQUFkO0FBQ0QsS0FGRDtBQUdELEdBbE9EOztBQXFPQSxJQUFFLFVBQUYsR0FBZSxFQUFFLE1BQUYsQ0FBUyxFQUFFLFVBQVgsRUFBdUI7QUFDcEMsYUFBUyxPQUQyQjtBQUVwQyxRQUFJLEVBRmdDO0FBR3BDLFNBQUssR0FIK0I7O0FBS3BDLGFBQVMsRUFMMkI7O0FBT3BDLGFBQVM7QUFDUCxlQUFTO0FBQ1Asa0JBQVUsTUFESDtBQUVQLHFCQUFhLFNBRk47QUFHUCxvQkFBWSxRQUhMO0FBSVAsb0JBQVksUUFKTDtBQUtQLHFCQUFhLFNBTE47QUFNUCxzQkFBYyxVQU5QO0FBT1Asa0JBQVUsTUFQSDtBQVFQO0FBQ0E7QUFDQSx1QkFBZSxXQVZSO0FBV1Asb0JBQVksUUFYTDtBQVlQLG9CQUFZLFFBWkw7QUFhUCx1QkFBZSxXQWJSO0FBY1AsbUJBQVcsT0FkSjtBQWVQLG1CQUFXLE9BZko7QUFnQlAsc0JBQWMsVUFoQlA7QUFpQlAsdUJBQWUsV0FqQlI7QUFrQlAsdUJBQWUsV0FsQlI7QUFtQlAsd0JBQWdCLFlBbkJUO0FBb0JQLHVCQUFlLFdBcEJSO0FBcUJQLHNCQUFjLFVBckJQO0FBc0JQLHNCQUFjO0FBdEJQLE9BREY7O0FBMEJQLGVBQVMsRUExQkY7O0FBNEJQLFlBQU0sT0E1QkM7O0FBOEJQO0FBQ0EsZUFBUyxDQUNQLENBQUMsT0FBRCxFQUFVLENBQUMsT0FBRCxDQUFWLENBRE8sRUFFUCxDQUFDLE1BQUQsRUFBUyxDQUFDLE1BQUQsRUFBUyxXQUFULEVBQXNCLE9BQXRCLENBQVQsQ0FGTyxFQUdQLENBQUMsVUFBRCxFQUFhLENBQUMsVUFBRCxDQUFiLENBSE8sRUFJUCxDQUFDLE9BQUQsRUFBVSxDQUFDLE9BQUQsQ0FBVixDQUpPLEVBS1AsQ0FBQyxNQUFELEVBQVMsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLFdBQWIsQ0FBVCxDQUxPLEVBTVAsQ0FBQyxPQUFELEVBQVUsQ0FBQyxPQUFELENBQVYsQ0FOTyxFQU9QLENBQUMsUUFBRCxFQUFXLENBQUMsTUFBRCxFQUFTLFNBQVQsRUFBb0IsT0FBcEIsQ0FBWCxDQVBPLEVBUVAsQ0FBQyxNQUFELEVBQVMsQ0FBQyxZQUFELEVBQWUsVUFBZixFQUEyQixNQUEzQixDQUFULENBUk8sQ0EvQkY7O0FBMENQO0FBQ0EsZUFBUztBQUNQLGVBQU8sQ0FDTCxDQUFDLFdBQUQsRUFBYyxDQUFDLGNBQUQsRUFBaUIsYUFBakIsRUFBZ0MsYUFBaEMsQ0FBZCxDQURLLEVBRUwsQ0FBQyxPQUFELEVBQVUsQ0FBQyxXQUFELEVBQWMsWUFBZCxFQUE0QixXQUE1QixDQUFWLENBRkssRUFHTCxDQUFDLFFBQUQsRUFBVyxDQUFDLGFBQUQsQ0FBWCxDQUhLLENBREE7QUFNUCxjQUFNLENBQ0osQ0FBQyxNQUFELEVBQVMsQ0FBQyxnQkFBRCxFQUFtQixRQUFuQixDQUFULENBREksQ0FOQztBQVNQLGFBQUssQ0FDSCxDQUFDLE9BQUQsRUFBVSxDQUFDLE9BQUQsQ0FBVixDQURHLEVBRUgsQ0FBQyxNQUFELEVBQVMsQ0FBQyxNQUFELEVBQVMsV0FBVCxFQUFzQixPQUF0QixDQUFULENBRkcsRUFHSCxDQUFDLE1BQUQsRUFBUyxDQUFDLElBQUQsRUFBTyxXQUFQLENBQVQsQ0FIRyxFQUlILENBQUMsT0FBRCxFQUFVLENBQUMsT0FBRCxDQUFWLENBSkcsRUFLSCxDQUFDLFFBQUQsRUFBVyxDQUFDLE1BQUQsRUFBUyxTQUFULENBQVgsQ0FMRztBQVRFLE9BM0NGOztBQTZEUDtBQUNBLGVBQVMsS0E5REY7O0FBZ0VQLGFBQU8sSUFoRUE7QUFpRVAsY0FBUSxJQWpFRDs7QUFtRVAsYUFBTyxLQW5FQTtBQW9FUCxlQUFTLENBcEVGO0FBcUVQLHFCQUFlLElBckVSO0FBc0VQLGlCQUFXLElBdEVKO0FBdUVQLHdCQUFrQixJQXZFWDtBQXdFUCxpQkFBVyxJQXhFSjs7QUEwRVAsaUJBQVcsQ0FBQyxHQUFELEVBQU0sWUFBTixFQUFvQixLQUFwQixFQUEyQixJQUEzQixFQUFpQyxJQUFqQyxFQUF1QyxJQUF2QyxFQUE2QyxJQUE3QyxFQUFtRCxJQUFuRCxFQUF5RCxJQUF6RCxDQTFFSjs7QUE0RVAsaUJBQVcsQ0FDVCxPQURTLEVBQ0EsYUFEQSxFQUNlLGVBRGYsRUFDZ0MsYUFEaEMsRUFFVCxnQkFGUyxFQUVTLFdBRlQsRUFFc0IsUUFGdEIsRUFFZ0MsZUFGaEMsRUFHVCxRQUhTLEVBR0MsaUJBSEQsRUFHb0IsU0FIcEIsQ0E1RUo7O0FBa0ZQLGlCQUFXLENBQUMsR0FBRCxFQUFNLEdBQU4sRUFBVyxJQUFYLEVBQWlCLElBQWpCLEVBQXVCLElBQXZCLEVBQTZCLElBQTdCLEVBQW1DLElBQW5DLEVBQXlDLElBQXpDLEVBQStDLElBQS9DLENBbEZKOztBQW9GUDtBQUNBLGNBQVEsQ0FDTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBRE0sRUFFTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBRk0sRUFHTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBSE0sRUFJTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBSk0sRUFLTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBTE0sRUFNTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBTk0sRUFPTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBUE0sRUFRTixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLFNBQXZCLEVBQWtDLFNBQWxDLEVBQTZDLFNBQTdDLEVBQXdELFNBQXhELEVBQW1FLFNBQW5FLEVBQThFLFNBQTlFLENBUk0sQ0FyRkQ7O0FBZ0dQLG1CQUFhLENBQUMsS0FBRCxFQUFRLEtBQVIsRUFBZSxLQUFmLEVBQXNCLEtBQXRCLEVBQTZCLEtBQTdCLEVBQW9DLEtBQXBDLEVBQTJDLEtBQTNDLEVBQWtELEtBQWxELENBaEdOOztBQWtHUCxzQkFBZ0IsdUJBbEdUOztBQW9HUCwwQkFBb0I7QUFDbEIsYUFBSyxFQURhO0FBRWxCLGFBQUs7QUFGYSxPQXBHYjs7QUF5R1AscUJBQWUsS0F6R1I7QUEwR1AsbUJBQWEsS0ExR047O0FBNEdQLDRCQUFzQixJQTVHZjs7QUE4R1AsaUJBQVc7QUFDVCxnQkFBUSxJQURDO0FBRVQsaUJBQVMsSUFGQTtBQUdULGdCQUFRLElBSEM7QUFJVCxpQkFBUyxJQUpBO0FBS1QsaUJBQVMsSUFMQTtBQU1ULG1CQUFXLElBTkY7QUFPVCx1QkFBZSxJQVBOO0FBUVQsNEJBQW9CO0FBUlgsT0E5R0o7O0FBeUhQLGtCQUFZO0FBQ1YsY0FBTSxXQURJO0FBRVYsa0JBQVUsSUFGQTtBQUdWLHFCQUFhO0FBSEgsT0F6SEw7O0FBK0hQLGNBQVE7QUFDTixZQUFJO0FBQ0YsbUJBQVMsaUJBRFA7QUFFRixvQkFBVSxNQUZSO0FBR0Ysb0JBQVUsTUFIUjtBQUlGLGlCQUFPLEtBSkw7QUFLRix1QkFBYSxPQUxYO0FBTUYsb0JBQVUsTUFOUjtBQU9GLG9CQUFVLFFBUFI7QUFRRixvQkFBVSxXQVJSO0FBU0YsMEJBQWdCLGVBVGQ7QUFVRiw0QkFBa0IsY0FWaEI7QUFXRiwwQkFBZ0IsYUFYZDtBQVlGLDBCQUFnQixlQVpkO0FBYUYsMEJBQWdCLGNBYmQ7QUFjRiwwQkFBZ0IsYUFkZDtBQWVGLDZCQUFtQixxQkFmakI7QUFnQkYsNkJBQW1CLG1CQWhCakI7QUFpQkYsOEJBQW9CLFNBakJsQjtBQWtCRiwrQkFBcUIsUUFsQm5CO0FBbUJGLHVCQUFhLFlBbkJYO0FBb0JGLHVCQUFhLFVBcEJYO0FBcUJGLHVCQUFhLFVBckJYO0FBc0JGLHVCQUFhLFVBdEJYO0FBdUJGLHVCQUFhLFVBdkJYO0FBd0JGLHVCQUFhLFVBeEJYO0FBeUJGLHVCQUFhLFVBekJYO0FBMEJGLHdCQUFjLHNCQTFCWjtBQTJCRixvQkFBVTtBQTNCUixTQURFOztBQStCTixhQUFLO0FBQ0gsbUJBQVMsaUJBRE47QUFFSCxtQkFBUyxNQUZOO0FBR0gseUJBQWUsTUFIWjtBQUlILGlCQUFPLEtBSko7QUFLSCx1QkFBYSxPQUxWO0FBTUgsbUJBQVMsTUFOTjtBQU9ILG1CQUFTLFFBUE47QUFRSCxtQkFBUyxXQVJOO0FBU0gseUJBQWUsZUFUWjtBQVVILDJCQUFpQixjQVZkO0FBV0gseUJBQWUsYUFYWjtBQVlILHlCQUFlLGVBWlo7QUFhSCx5QkFBZSxjQWJaO0FBY0gseUJBQWUsYUFkWjtBQWVILDRCQUFrQixxQkFmZjtBQWdCSCw0QkFBa0IsbUJBaEJmO0FBaUJILDZCQUFtQixTQWpCaEI7QUFrQkgsOEJBQW9CLFFBbEJqQjtBQW1CSCxzQkFBWSxZQW5CVDtBQW9CSCxzQkFBWSxVQXBCVDtBQXFCSCxzQkFBWSxVQXJCVDtBQXNCSCxzQkFBWSxVQXRCVDtBQXVCSCxzQkFBWSxVQXZCVDtBQXdCSCxzQkFBWSxVQXhCVDtBQXlCSCxzQkFBWSxVQXpCVDtBQTBCSCx1QkFBYSxzQkExQlY7QUEyQkgsbUJBQVM7QUEzQk47QUEvQkMsT0EvSEQ7QUE0TFAsYUFBTztBQUNMLGlCQUFTLGlCQURKO0FBRUwsdUJBQWUsd0JBRlY7QUFHTCx3QkFBZ0IseUJBSFg7QUFJTCxxQkFBYSxzQkFKUjtBQUtMLHNCQUFjLHVCQUxUO0FBTUwsa0JBQVUsd0JBTkw7QUFPTCxtQkFBVyx5QkFQTjtBQVFMLHFCQUFhLHNCQVJSO0FBU0wsZ0JBQVEsZ0JBVEg7QUFVTCxpQkFBUyxpQkFWSjtBQVdMLGtCQUFVLGtCQVhMO0FBWUwsaUJBQVMsaUJBWko7QUFhTCxnQkFBUSxnQkFiSDtBQWNMLGtCQUFVLGtCQWRMO0FBZUwsZ0JBQVEsZ0JBZkg7QUFnQkwsaUJBQVMsaUJBaEJKO0FBaUJMLGtCQUFVLGtCQWpCTDtBQWtCTCxnQkFBUSxnQkFsQkg7QUFtQkwsa0JBQVUsd0JBbkJMO0FBb0JMLGlCQUFTLGlCQXBCSjtBQXFCTCxxQkFBYSxpQkFyQlI7QUFzQkwsaUJBQVMsaUJBdEJKO0FBdUJMLHVCQUFlLHVCQXZCVjtBQXdCTCxrQkFBVSxrQkF4Qkw7QUF5QkwsbUJBQVcsbUJBekJOO0FBMEJMLG9CQUFZLG9CQTFCUDtBQTJCTCxnQkFBUSxnQkEzQkg7QUE0Qkwsa0JBQVUsa0JBNUJMO0FBNkJMLHlCQUFpQix5QkE3Qlo7QUE4QkwscUJBQWEscUJBOUJSO0FBK0JMLHVCQUFlLHVCQS9CVjtBQWdDTCxpQkFBUyxpQkFoQ0o7QUFpQ0wsc0JBQWMsdUJBakNUO0FBa0NMLGlCQUFTLGlCQWxDSjtBQW1DTCxxQkFBYSxxQkFuQ1I7QUFvQ0wsZ0JBQVEsZ0JBcENIO0FBcUNMLHlCQUFpQix5QkFyQ1o7QUFzQ0wsaUJBQVM7QUF0Q0o7QUE1TEE7QUFQMkIsR0FBdkIsQ0FBZjtBQThPRCxDQXgyTkEsQ0FBRCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBDb2RlTWlycm9yLCBjb3B5cmlnaHQgKGMpIGJ5IE1hcmlqbiBIYXZlcmJla2UgYW5kIG90aGVyc1xuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgYW4gTUlUIGxpY2Vuc2U6IGh0dHA6Ly9jb2RlbWlycm9yLm5ldC9MSUNFTlNFXG5cbi8vIFRoaXMgaXMgQ29kZU1pcnJvciAoaHR0cDovL2NvZGVtaXJyb3IubmV0KSwgYSBjb2RlIGVkaXRvclxuLy8gaW1wbGVtZW50ZWQgaW4gSmF2YVNjcmlwdCBvbiB0b3Agb2YgdGhlIGJyb3dzZXIncyBET00uXG4vL1xuLy8gWW91IGNhbiBmaW5kIHNvbWUgdGVjaG5pY2FsIGJhY2tncm91bmQgZm9yIHNvbWUgb2YgdGhlIGNvZGUgYmVsb3dcbi8vIGF0IGh0dHA6Ly9tYXJpam5oYXZlcmJla2UubmwvYmxvZy8jY20taW50ZXJuYWxzIC5cblxuKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcblx0dHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOlxuXHR0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOlxuXHQoZ2xvYmFsLkNvZGVNaXJyb3IgPSBmYWN0b3J5KCkpO1xufSh0aGlzLCAoZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7XG5cbi8vIEtsdWRnZXMgZm9yIGJ1Z3MgYW5kIGJlaGF2aW9yIGRpZmZlcmVuY2VzIHRoYXQgY2FuJ3QgYmUgZmVhdHVyZVxuLy8gZGV0ZWN0ZWQgYXJlIGVuYWJsZWQgYmFzZWQgb24gdXNlckFnZW50IGV0YyBzbmlmZmluZy5cbnZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xudmFyIHBsYXRmb3JtID0gbmF2aWdhdG9yLnBsYXRmb3JtO1xuXG52YXIgZ2Vja28gPSAvZ2Vja29cXC9cXGQvaS50ZXN0KHVzZXJBZ2VudCk7XG52YXIgaWVfdXB0bzEwID0gL01TSUUgXFxkLy50ZXN0KHVzZXJBZ2VudCk7XG52YXIgaWVfMTF1cCA9IC9UcmlkZW50XFwvKD86WzctOV18XFxkezIsfSlcXC4uKnJ2OihcXGQrKS8uZXhlYyh1c2VyQWdlbnQpO1xudmFyIGVkZ2UgPSAvRWRnZVxcLyhcXGQrKS8uZXhlYyh1c2VyQWdlbnQpO1xudmFyIGllID0gaWVfdXB0bzEwIHx8IGllXzExdXAgfHwgZWRnZTtcbnZhciBpZV92ZXJzaW9uID0gaWUgJiYgKGllX3VwdG8xMCA/IGRvY3VtZW50LmRvY3VtZW50TW9kZSB8fCA2IDogKyhlZGdlIHx8IGllXzExdXApWzFdKTtcbnZhciB3ZWJraXQgPSAhZWRnZSAmJiAvV2ViS2l0XFwvLy50ZXN0KHVzZXJBZ2VudCk7XG52YXIgcXR3ZWJraXQgPSB3ZWJraXQgJiYgL1F0XFwvXFxkK1xcLlxcZCsvLnRlc3QodXNlckFnZW50KTtcbnZhciBjaHJvbWUgPSAhZWRnZSAmJiAvQ2hyb21lXFwvLy50ZXN0KHVzZXJBZ2VudCk7XG52YXIgcHJlc3RvID0gL09wZXJhXFwvLy50ZXN0KHVzZXJBZ2VudCk7XG52YXIgc2FmYXJpID0gL0FwcGxlIENvbXB1dGVyLy50ZXN0KG5hdmlnYXRvci52ZW5kb3IpO1xudmFyIG1hY19nZU1vdW50YWluTGlvbiA9IC9NYWMgT1MgWCAxXFxkXFxEKFs4LTldfFxcZFxcZClcXEQvLnRlc3QodXNlckFnZW50KTtcbnZhciBwaGFudG9tID0gL1BoYW50b21KUy8udGVzdCh1c2VyQWdlbnQpO1xuXG52YXIgaW9zID0gIWVkZ2UgJiYgL0FwcGxlV2ViS2l0Ly50ZXN0KHVzZXJBZ2VudCkgJiYgL01vYmlsZVxcL1xcdysvLnRlc3QodXNlckFnZW50KTtcbnZhciBhbmRyb2lkID0gL0FuZHJvaWQvLnRlc3QodXNlckFnZW50KTtcbi8vIFRoaXMgaXMgd29lZnVsbHkgaW5jb21wbGV0ZS4gU3VnZ2VzdGlvbnMgZm9yIGFsdGVybmF0aXZlIG1ldGhvZHMgd2VsY29tZS5cbnZhciBtb2JpbGUgPSBpb3MgfHwgYW5kcm9pZCB8fCAvd2ViT1N8QmxhY2tCZXJyeXxPcGVyYSBNaW5pfE9wZXJhIE1vYml8SUVNb2JpbGUvaS50ZXN0KHVzZXJBZ2VudCk7XG52YXIgbWFjID0gaW9zIHx8IC9NYWMvLnRlc3QocGxhdGZvcm0pO1xudmFyIGNocm9tZU9TID0gL1xcYkNyT1NcXGIvLnRlc3QodXNlckFnZW50KTtcbnZhciB3aW5kb3dzID0gL3dpbi9pLnRlc3QocGxhdGZvcm0pO1xuXG52YXIgcHJlc3RvX3ZlcnNpb24gPSBwcmVzdG8gJiYgdXNlckFnZW50Lm1hdGNoKC9WZXJzaW9uXFwvKFxcZCpcXC5cXGQqKS8pO1xuaWYgKHByZXN0b192ZXJzaW9uKSB7IHByZXN0b192ZXJzaW9uID0gTnVtYmVyKHByZXN0b192ZXJzaW9uWzFdKTsgfVxuaWYgKHByZXN0b192ZXJzaW9uICYmIHByZXN0b192ZXJzaW9uID49IDE1KSB7IHByZXN0byA9IGZhbHNlOyB3ZWJraXQgPSB0cnVlOyB9XG4vLyBTb21lIGJyb3dzZXJzIHVzZSB0aGUgd3JvbmcgZXZlbnQgcHJvcGVydGllcyB0byBzaWduYWwgY21kL2N0cmwgb24gT1MgWFxudmFyIGZsaXBDdHJsQ21kID0gbWFjICYmIChxdHdlYmtpdCB8fCBwcmVzdG8gJiYgKHByZXN0b192ZXJzaW9uID09IG51bGwgfHwgcHJlc3RvX3ZlcnNpb24gPCAxMi4xMSkpO1xudmFyIGNhcHR1cmVSaWdodENsaWNrID0gZ2Vja28gfHwgKGllICYmIGllX3ZlcnNpb24gPj0gOSk7XG5cbmZ1bmN0aW9uIGNsYXNzVGVzdChjbHMpIHsgcmV0dXJuIG5ldyBSZWdFeHAoXCIoXnxcXFxccylcIiArIGNscyArIFwiKD86JHxcXFxccylcXFxccypcIikgfVxuXG52YXIgcm1DbGFzcyA9IGZ1bmN0aW9uKG5vZGUsIGNscykge1xuICB2YXIgY3VycmVudCA9IG5vZGUuY2xhc3NOYW1lO1xuICB2YXIgbWF0Y2ggPSBjbGFzc1Rlc3QoY2xzKS5leGVjKGN1cnJlbnQpO1xuICBpZiAobWF0Y2gpIHtcbiAgICB2YXIgYWZ0ZXIgPSBjdXJyZW50LnNsaWNlKG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoKTtcbiAgICBub2RlLmNsYXNzTmFtZSA9IGN1cnJlbnQuc2xpY2UoMCwgbWF0Y2guaW5kZXgpICsgKGFmdGVyID8gbWF0Y2hbMV0gKyBhZnRlciA6IFwiXCIpO1xuICB9XG59O1xuXG5mdW5jdGlvbiByZW1vdmVDaGlsZHJlbihlKSB7XG4gIGZvciAodmFyIGNvdW50ID0gZS5jaGlsZE5vZGVzLmxlbmd0aDsgY291bnQgPiAwOyAtLWNvdW50KVxuICAgIHsgZS5yZW1vdmVDaGlsZChlLmZpcnN0Q2hpbGQpOyB9XG4gIHJldHVybiBlXG59XG5cbmZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHBhcmVudCwgZSkge1xuICByZXR1cm4gcmVtb3ZlQ2hpbGRyZW4ocGFyZW50KS5hcHBlbmRDaGlsZChlKVxufVxuXG5mdW5jdGlvbiBlbHQodGFnLCBjb250ZW50LCBjbGFzc05hbWUsIHN0eWxlKSB7XG4gIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICBpZiAoY2xhc3NOYW1lKSB7IGUuY2xhc3NOYW1lID0gY2xhc3NOYW1lOyB9XG4gIGlmIChzdHlsZSkgeyBlLnN0eWxlLmNzc1RleHQgPSBzdHlsZTsgfVxuICBpZiAodHlwZW9mIGNvbnRlbnQgPT0gXCJzdHJpbmdcIikgeyBlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbnRlbnQpKTsgfVxuICBlbHNlIGlmIChjb250ZW50KSB7IGZvciAodmFyIGkgPSAwOyBpIDwgY29udGVudC5sZW5ndGg7ICsraSkgeyBlLmFwcGVuZENoaWxkKGNvbnRlbnRbaV0pOyB9IH1cbiAgcmV0dXJuIGVcbn1cbi8vIHdyYXBwZXIgZm9yIGVsdCwgd2hpY2ggcmVtb3ZlcyB0aGUgZWx0IGZyb20gdGhlIGFjY2Vzc2liaWxpdHkgdHJlZVxuZnVuY3Rpb24gZWx0UCh0YWcsIGNvbnRlbnQsIGNsYXNzTmFtZSwgc3R5bGUpIHtcbiAgdmFyIGUgPSBlbHQodGFnLCBjb250ZW50LCBjbGFzc05hbWUsIHN0eWxlKTtcbiAgZS5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwicHJlc2VudGF0aW9uXCIpO1xuICByZXR1cm4gZVxufVxuXG52YXIgcmFuZ2U7XG5pZiAoZG9jdW1lbnQuY3JlYXRlUmFuZ2UpIHsgcmFuZ2UgPSBmdW5jdGlvbihub2RlLCBzdGFydCwgZW5kLCBlbmROb2RlKSB7XG4gIHZhciByID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgci5zZXRFbmQoZW5kTm9kZSB8fCBub2RlLCBlbmQpO1xuICByLnNldFN0YXJ0KG5vZGUsIHN0YXJ0KTtcbiAgcmV0dXJuIHJcbn07IH1cbmVsc2UgeyByYW5nZSA9IGZ1bmN0aW9uKG5vZGUsIHN0YXJ0LCBlbmQpIHtcbiAgdmFyIHIgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpO1xuICB0cnkgeyByLm1vdmVUb0VsZW1lbnRUZXh0KG5vZGUucGFyZW50Tm9kZSk7IH1cbiAgY2F0Y2goZSkgeyByZXR1cm4gciB9XG4gIHIuY29sbGFwc2UodHJ1ZSk7XG4gIHIubW92ZUVuZChcImNoYXJhY3RlclwiLCBlbmQpO1xuICByLm1vdmVTdGFydChcImNoYXJhY3RlclwiLCBzdGFydCk7XG4gIHJldHVybiByXG59OyB9XG5cbmZ1bmN0aW9uIGNvbnRhaW5zKHBhcmVudCwgY2hpbGQpIHtcbiAgaWYgKGNoaWxkLm5vZGVUeXBlID09IDMpIC8vIEFuZHJvaWQgYnJvd3NlciBhbHdheXMgcmV0dXJucyBmYWxzZSB3aGVuIGNoaWxkIGlzIGEgdGV4dG5vZGVcbiAgICB7IGNoaWxkID0gY2hpbGQucGFyZW50Tm9kZTsgfVxuICBpZiAocGFyZW50LmNvbnRhaW5zKVxuICAgIHsgcmV0dXJuIHBhcmVudC5jb250YWlucyhjaGlsZCkgfVxuICBkbyB7XG4gICAgaWYgKGNoaWxkLm5vZGVUeXBlID09IDExKSB7IGNoaWxkID0gY2hpbGQuaG9zdDsgfVxuICAgIGlmIChjaGlsZCA9PSBwYXJlbnQpIHsgcmV0dXJuIHRydWUgfVxuICB9IHdoaWxlIChjaGlsZCA9IGNoaWxkLnBhcmVudE5vZGUpXG59XG5cbmZ1bmN0aW9uIGFjdGl2ZUVsdCgpIHtcbiAgLy8gSUUgYW5kIEVkZ2UgbWF5IHRocm93IGFuIFwiVW5zcGVjaWZpZWQgRXJyb3JcIiB3aGVuIGFjY2Vzc2luZyBkb2N1bWVudC5hY3RpdmVFbGVtZW50LlxuICAvLyBJRSA8IDEwIHdpbGwgdGhyb3cgd2hlbiBhY2Nlc3NlZCB3aGlsZSB0aGUgcGFnZSBpcyBsb2FkaW5nIG9yIGluIGFuIGlmcmFtZS5cbiAgLy8gSUUgPiA5IGFuZCBFZGdlIHdpbGwgdGhyb3cgd2hlbiBhY2Nlc3NlZCBpbiBhbiBpZnJhbWUgaWYgZG9jdW1lbnQuYm9keSBpcyB1bmF2YWlsYWJsZS5cbiAgdmFyIGFjdGl2ZUVsZW1lbnQ7XG4gIHRyeSB7XG4gICAgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gIH0gY2F0Y2goZSkge1xuICAgIGFjdGl2ZUVsZW1lbnQgPSBkb2N1bWVudC5ib2R5IHx8IG51bGw7XG4gIH1cbiAgd2hpbGUgKGFjdGl2ZUVsZW1lbnQgJiYgYWN0aXZlRWxlbWVudC5zaGFkb3dSb290ICYmIGFjdGl2ZUVsZW1lbnQuc2hhZG93Um9vdC5hY3RpdmVFbGVtZW50KVxuICAgIHsgYWN0aXZlRWxlbWVudCA9IGFjdGl2ZUVsZW1lbnQuc2hhZG93Um9vdC5hY3RpdmVFbGVtZW50OyB9XG4gIHJldHVybiBhY3RpdmVFbGVtZW50XG59XG5cbmZ1bmN0aW9uIGFkZENsYXNzKG5vZGUsIGNscykge1xuICB2YXIgY3VycmVudCA9IG5vZGUuY2xhc3NOYW1lO1xuICBpZiAoIWNsYXNzVGVzdChjbHMpLnRlc3QoY3VycmVudCkpIHsgbm9kZS5jbGFzc05hbWUgKz0gKGN1cnJlbnQgPyBcIiBcIiA6IFwiXCIpICsgY2xzOyB9XG59XG5mdW5jdGlvbiBqb2luQ2xhc3NlcyhhLCBiKSB7XG4gIHZhciBhcyA9IGEuc3BsaXQoXCIgXCIpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFzLmxlbmd0aDsgaSsrKVxuICAgIHsgaWYgKGFzW2ldICYmICFjbGFzc1Rlc3QoYXNbaV0pLnRlc3QoYikpIHsgYiArPSBcIiBcIiArIGFzW2ldOyB9IH1cbiAgcmV0dXJuIGJcbn1cblxudmFyIHNlbGVjdElucHV0ID0gZnVuY3Rpb24obm9kZSkgeyBub2RlLnNlbGVjdCgpOyB9O1xuaWYgKGlvcykgLy8gTW9iaWxlIFNhZmFyaSBhcHBhcmVudGx5IGhhcyBhIGJ1ZyB3aGVyZSBzZWxlY3QoKSBpcyBicm9rZW4uXG4gIHsgc2VsZWN0SW5wdXQgPSBmdW5jdGlvbihub2RlKSB7IG5vZGUuc2VsZWN0aW9uU3RhcnQgPSAwOyBub2RlLnNlbGVjdGlvbkVuZCA9IG5vZGUudmFsdWUubGVuZ3RoOyB9OyB9XG5lbHNlIGlmIChpZSkgLy8gU3VwcHJlc3MgbXlzdGVyaW91cyBJRTEwIGVycm9yc1xuICB7IHNlbGVjdElucHV0ID0gZnVuY3Rpb24obm9kZSkgeyB0cnkgeyBub2RlLnNlbGVjdCgpOyB9IGNhdGNoKF9lKSB7fSB9OyB9XG5cbmZ1bmN0aW9uIGJpbmQoZikge1xuICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gIHJldHVybiBmdW5jdGlvbigpe3JldHVybiBmLmFwcGx5KG51bGwsIGFyZ3MpfVxufVxuXG5mdW5jdGlvbiBjb3B5T2JqKG9iaiwgdGFyZ2V0LCBvdmVyd3JpdGUpIHtcbiAgaWYgKCF0YXJnZXQpIHsgdGFyZ2V0ID0ge307IH1cbiAgZm9yICh2YXIgcHJvcCBpbiBvYmopXG4gICAgeyBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApICYmIChvdmVyd3JpdGUgIT09IGZhbHNlIHx8ICF0YXJnZXQuaGFzT3duUHJvcGVydHkocHJvcCkpKVxuICAgICAgeyB0YXJnZXRbcHJvcF0gPSBvYmpbcHJvcF07IH0gfVxuICByZXR1cm4gdGFyZ2V0XG59XG5cbi8vIENvdW50cyB0aGUgY29sdW1uIG9mZnNldCBpbiBhIHN0cmluZywgdGFraW5nIHRhYnMgaW50byBhY2NvdW50LlxuLy8gVXNlZCBtb3N0bHkgdG8gZmluZCBpbmRlbnRhdGlvbi5cbmZ1bmN0aW9uIGNvdW50Q29sdW1uKHN0cmluZywgZW5kLCB0YWJTaXplLCBzdGFydEluZGV4LCBzdGFydFZhbHVlKSB7XG4gIGlmIChlbmQgPT0gbnVsbCkge1xuICAgIGVuZCA9IHN0cmluZy5zZWFyY2goL1teXFxzXFx1MDBhMF0vKTtcbiAgICBpZiAoZW5kID09IC0xKSB7IGVuZCA9IHN0cmluZy5sZW5ndGg7IH1cbiAgfVxuICBmb3IgKHZhciBpID0gc3RhcnRJbmRleCB8fCAwLCBuID0gc3RhcnRWYWx1ZSB8fCAwOzspIHtcbiAgICB2YXIgbmV4dFRhYiA9IHN0cmluZy5pbmRleE9mKFwiXFx0XCIsIGkpO1xuICAgIGlmIChuZXh0VGFiIDwgMCB8fCBuZXh0VGFiID49IGVuZClcbiAgICAgIHsgcmV0dXJuIG4gKyAoZW5kIC0gaSkgfVxuICAgIG4gKz0gbmV4dFRhYiAtIGk7XG4gICAgbiArPSB0YWJTaXplIC0gKG4gJSB0YWJTaXplKTtcbiAgICBpID0gbmV4dFRhYiArIDE7XG4gIH1cbn1cblxudmFyIERlbGF5ZWQgPSBmdW5jdGlvbigpIHt0aGlzLmlkID0gbnVsbDt9O1xuRGVsYXllZC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKG1zLCBmKSB7XG4gIGNsZWFyVGltZW91dCh0aGlzLmlkKTtcbiAgdGhpcy5pZCA9IHNldFRpbWVvdXQoZiwgbXMpO1xufTtcblxuZnVuY3Rpb24gaW5kZXhPZihhcnJheSwgZWx0KSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpXG4gICAgeyBpZiAoYXJyYXlbaV0gPT0gZWx0KSB7IHJldHVybiBpIH0gfVxuICByZXR1cm4gLTFcbn1cblxuLy8gTnVtYmVyIG9mIHBpeGVscyBhZGRlZCB0byBzY3JvbGxlciBhbmQgc2l6ZXIgdG8gaGlkZSBzY3JvbGxiYXJcbnZhciBzY3JvbGxlckdhcCA9IDMwO1xuXG4vLyBSZXR1cm5lZCBvciB0aHJvd24gYnkgdmFyaW91cyBwcm90b2NvbHMgdG8gc2lnbmFsICdJJ20gbm90XG4vLyBoYW5kbGluZyB0aGlzJy5cbnZhciBQYXNzID0ge3RvU3RyaW5nOiBmdW5jdGlvbigpe3JldHVybiBcIkNvZGVNaXJyb3IuUGFzc1wifX07XG5cbi8vIFJldXNlZCBvcHRpb24gb2JqZWN0cyBmb3Igc2V0U2VsZWN0aW9uICYgZnJpZW5kc1xudmFyIHNlbF9kb250U2Nyb2xsID0ge3Njcm9sbDogZmFsc2V9O1xudmFyIHNlbF9tb3VzZSA9IHtvcmlnaW46IFwiKm1vdXNlXCJ9O1xudmFyIHNlbF9tb3ZlID0ge29yaWdpbjogXCIrbW92ZVwifTtcblxuLy8gVGhlIGludmVyc2Ugb2YgY291bnRDb2x1bW4gLS0gZmluZCB0aGUgb2Zmc2V0IHRoYXQgY29ycmVzcG9uZHMgdG9cbi8vIGEgcGFydGljdWxhciBjb2x1bW4uXG5mdW5jdGlvbiBmaW5kQ29sdW1uKHN0cmluZywgZ29hbCwgdGFiU2l6ZSkge1xuICBmb3IgKHZhciBwb3MgPSAwLCBjb2wgPSAwOzspIHtcbiAgICB2YXIgbmV4dFRhYiA9IHN0cmluZy5pbmRleE9mKFwiXFx0XCIsIHBvcyk7XG4gICAgaWYgKG5leHRUYWIgPT0gLTEpIHsgbmV4dFRhYiA9IHN0cmluZy5sZW5ndGg7IH1cbiAgICB2YXIgc2tpcHBlZCA9IG5leHRUYWIgLSBwb3M7XG4gICAgaWYgKG5leHRUYWIgPT0gc3RyaW5nLmxlbmd0aCB8fCBjb2wgKyBza2lwcGVkID49IGdvYWwpXG4gICAgICB7IHJldHVybiBwb3MgKyBNYXRoLm1pbihza2lwcGVkLCBnb2FsIC0gY29sKSB9XG4gICAgY29sICs9IG5leHRUYWIgLSBwb3M7XG4gICAgY29sICs9IHRhYlNpemUgLSAoY29sICUgdGFiU2l6ZSk7XG4gICAgcG9zID0gbmV4dFRhYiArIDE7XG4gICAgaWYgKGNvbCA+PSBnb2FsKSB7IHJldHVybiBwb3MgfVxuICB9XG59XG5cbnZhciBzcGFjZVN0cnMgPSBbXCJcIl07XG5mdW5jdGlvbiBzcGFjZVN0cihuKSB7XG4gIHdoaWxlIChzcGFjZVN0cnMubGVuZ3RoIDw9IG4pXG4gICAgeyBzcGFjZVN0cnMucHVzaChsc3Qoc3BhY2VTdHJzKSArIFwiIFwiKTsgfVxuICByZXR1cm4gc3BhY2VTdHJzW25dXG59XG5cbmZ1bmN0aW9uIGxzdChhcnIpIHsgcmV0dXJuIGFyclthcnIubGVuZ3RoLTFdIH1cblxuZnVuY3Rpb24gbWFwKGFycmF5LCBmKSB7XG4gIHZhciBvdXQgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgeyBvdXRbaV0gPSBmKGFycmF5W2ldLCBpKTsgfVxuICByZXR1cm4gb3V0XG59XG5cbmZ1bmN0aW9uIGluc2VydFNvcnRlZChhcnJheSwgdmFsdWUsIHNjb3JlKSB7XG4gIHZhciBwb3MgPSAwLCBwcmlvcml0eSA9IHNjb3JlKHZhbHVlKTtcbiAgd2hpbGUgKHBvcyA8IGFycmF5Lmxlbmd0aCAmJiBzY29yZShhcnJheVtwb3NdKSA8PSBwcmlvcml0eSkgeyBwb3MrKzsgfVxuICBhcnJheS5zcGxpY2UocG9zLCAwLCB2YWx1ZSk7XG59XG5cbmZ1bmN0aW9uIG5vdGhpbmcoKSB7fVxuXG5mdW5jdGlvbiBjcmVhdGVPYmooYmFzZSwgcHJvcHMpIHtcbiAgdmFyIGluc3Q7XG4gIGlmIChPYmplY3QuY3JlYXRlKSB7XG4gICAgaW5zdCA9IE9iamVjdC5jcmVhdGUoYmFzZSk7XG4gIH0gZWxzZSB7XG4gICAgbm90aGluZy5wcm90b3R5cGUgPSBiYXNlO1xuICAgIGluc3QgPSBuZXcgbm90aGluZygpO1xuICB9XG4gIGlmIChwcm9wcykgeyBjb3B5T2JqKHByb3BzLCBpbnN0KTsgfVxuICByZXR1cm4gaW5zdFxufVxuXG52YXIgbm9uQVNDSUlTaW5nbGVDYXNlV29yZENoYXIgPSAvW1xcdTAwZGZcXHUwNTg3XFx1MDU5MC1cXHUwNWY0XFx1MDYwMC1cXHUwNmZmXFx1MzA0MC1cXHUzMDlmXFx1MzBhMC1cXHUzMGZmXFx1MzQwMC1cXHU0ZGI1XFx1NGUwMC1cXHU5ZmNjXFx1YWMwMC1cXHVkN2FmXS87XG5mdW5jdGlvbiBpc1dvcmRDaGFyQmFzaWMoY2gpIHtcbiAgcmV0dXJuIC9cXHcvLnRlc3QoY2gpIHx8IGNoID4gXCJcXHg4MFwiICYmXG4gICAgKGNoLnRvVXBwZXJDYXNlKCkgIT0gY2gudG9Mb3dlckNhc2UoKSB8fCBub25BU0NJSVNpbmdsZUNhc2VXb3JkQ2hhci50ZXN0KGNoKSlcbn1cbmZ1bmN0aW9uIGlzV29yZENoYXIoY2gsIGhlbHBlcikge1xuICBpZiAoIWhlbHBlcikgeyByZXR1cm4gaXNXb3JkQ2hhckJhc2ljKGNoKSB9XG4gIGlmIChoZWxwZXIuc291cmNlLmluZGV4T2YoXCJcXFxcd1wiKSA+IC0xICYmIGlzV29yZENoYXJCYXNpYyhjaCkpIHsgcmV0dXJuIHRydWUgfVxuICByZXR1cm4gaGVscGVyLnRlc3QoY2gpXG59XG5cbmZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7XG4gIGZvciAodmFyIG4gaW4gb2JqKSB7IGlmIChvYmouaGFzT3duUHJvcGVydHkobikgJiYgb2JqW25dKSB7IHJldHVybiBmYWxzZSB9IH1cbiAgcmV0dXJuIHRydWVcbn1cblxuLy8gRXh0ZW5kaW5nIHVuaWNvZGUgY2hhcmFjdGVycy4gQSBzZXJpZXMgb2YgYSBub24tZXh0ZW5kaW5nIGNoYXIgK1xuLy8gYW55IG51bWJlciBvZiBleHRlbmRpbmcgY2hhcnMgaXMgdHJlYXRlZCBhcyBhIHNpbmdsZSB1bml0IGFzIGZhclxuLy8gYXMgZWRpdGluZyBhbmQgbWVhc3VyaW5nIGlzIGNvbmNlcm5lZC4gVGhpcyBpcyBub3QgZnVsbHkgY29ycmVjdCxcbi8vIHNpbmNlIHNvbWUgc2NyaXB0cy9mb250cy9icm93c2VycyBhbHNvIHRyZWF0IG90aGVyIGNvbmZpZ3VyYXRpb25zXG4vLyBvZiBjb2RlIHBvaW50cyBhcyBhIGdyb3VwLlxudmFyIGV4dGVuZGluZ0NoYXJzID0gL1tcXHUwMzAwLVxcdTAzNmZcXHUwNDgzLVxcdTA0ODlcXHUwNTkxLVxcdTA1YmRcXHUwNWJmXFx1MDVjMVxcdTA1YzJcXHUwNWM0XFx1MDVjNVxcdTA1YzdcXHUwNjEwLVxcdTA2MWFcXHUwNjRiLVxcdTA2NWVcXHUwNjcwXFx1MDZkNi1cXHUwNmRjXFx1MDZkZS1cXHUwNmU0XFx1MDZlN1xcdTA2ZThcXHUwNmVhLVxcdTA2ZWRcXHUwNzExXFx1MDczMC1cXHUwNzRhXFx1MDdhNi1cXHUwN2IwXFx1MDdlYi1cXHUwN2YzXFx1MDgxNi1cXHUwODE5XFx1MDgxYi1cXHUwODIzXFx1MDgyNS1cXHUwODI3XFx1MDgyOS1cXHUwODJkXFx1MDkwMC1cXHUwOTAyXFx1MDkzY1xcdTA5NDEtXFx1MDk0OFxcdTA5NGRcXHUwOTUxLVxcdTA5NTVcXHUwOTYyXFx1MDk2M1xcdTA5ODFcXHUwOWJjXFx1MDliZVxcdTA5YzEtXFx1MDljNFxcdTA5Y2RcXHUwOWQ3XFx1MDllMlxcdTA5ZTNcXHUwYTAxXFx1MGEwMlxcdTBhM2NcXHUwYTQxXFx1MGE0MlxcdTBhNDdcXHUwYTQ4XFx1MGE0Yi1cXHUwYTRkXFx1MGE1MVxcdTBhNzBcXHUwYTcxXFx1MGE3NVxcdTBhODFcXHUwYTgyXFx1MGFiY1xcdTBhYzEtXFx1MGFjNVxcdTBhYzdcXHUwYWM4XFx1MGFjZFxcdTBhZTJcXHUwYWUzXFx1MGIwMVxcdTBiM2NcXHUwYjNlXFx1MGIzZlxcdTBiNDEtXFx1MGI0NFxcdTBiNGRcXHUwYjU2XFx1MGI1N1xcdTBiNjJcXHUwYjYzXFx1MGI4MlxcdTBiYmVcXHUwYmMwXFx1MGJjZFxcdTBiZDdcXHUwYzNlLVxcdTBjNDBcXHUwYzQ2LVxcdTBjNDhcXHUwYzRhLVxcdTBjNGRcXHUwYzU1XFx1MGM1NlxcdTBjNjJcXHUwYzYzXFx1MGNiY1xcdTBjYmZcXHUwY2MyXFx1MGNjNlxcdTBjY2NcXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyXFx1MGNlM1xcdTBkM2VcXHUwZDQxLVxcdTBkNDRcXHUwZDRkXFx1MGQ1N1xcdTBkNjJcXHUwZDYzXFx1MGRjYVxcdTBkY2ZcXHUwZGQyLVxcdTBkZDRcXHUwZGQ2XFx1MGRkZlxcdTBlMzFcXHUwZTM0LVxcdTBlM2FcXHUwZTQ3LVxcdTBlNGVcXHUwZWIxXFx1MGViNC1cXHUwZWI5XFx1MGViYlxcdTBlYmNcXHUwZWM4LVxcdTBlY2RcXHUwZjE4XFx1MGYxOVxcdTBmMzVcXHUwZjM3XFx1MGYzOVxcdTBmNzEtXFx1MGY3ZVxcdTBmODAtXFx1MGY4NFxcdTBmODZcXHUwZjg3XFx1MGY5MC1cXHUwZjk3XFx1MGY5OS1cXHUwZmJjXFx1MGZjNlxcdTEwMmQtXFx1MTAzMFxcdTEwMzItXFx1MTAzN1xcdTEwMzlcXHUxMDNhXFx1MTAzZFxcdTEwM2VcXHUxMDU4XFx1MTA1OVxcdTEwNWUtXFx1MTA2MFxcdTEwNzEtXFx1MTA3NFxcdTEwODJcXHUxMDg1XFx1MTA4NlxcdTEwOGRcXHUxMDlkXFx1MTM1ZlxcdTE3MTItXFx1MTcxNFxcdTE3MzItXFx1MTczNFxcdTE3NTJcXHUxNzUzXFx1MTc3MlxcdTE3NzNcXHUxN2I3LVxcdTE3YmRcXHUxN2M2XFx1MTdjOS1cXHUxN2QzXFx1MTdkZFxcdTE4MGItXFx1MTgwZFxcdTE4YTlcXHUxOTIwLVxcdTE5MjJcXHUxOTI3XFx1MTkyOFxcdTE5MzJcXHUxOTM5LVxcdTE5M2JcXHUxYTE3XFx1MWExOFxcdTFhNTZcXHUxYTU4LVxcdTFhNWVcXHUxYTYwXFx1MWE2MlxcdTFhNjUtXFx1MWE2Y1xcdTFhNzMtXFx1MWE3Y1xcdTFhN2ZcXHUxYjAwLVxcdTFiMDNcXHUxYjM0XFx1MWIzNi1cXHUxYjNhXFx1MWIzY1xcdTFiNDJcXHUxYjZiLVxcdTFiNzNcXHUxYjgwXFx1MWI4MVxcdTFiYTItXFx1MWJhNVxcdTFiYThcXHUxYmE5XFx1MWMyYy1cXHUxYzMzXFx1MWMzNlxcdTFjMzdcXHUxY2QwLVxcdTFjZDJcXHUxY2Q0LVxcdTFjZTBcXHUxY2UyLVxcdTFjZThcXHUxY2VkXFx1MWRjMC1cXHUxZGU2XFx1MWRmZC1cXHUxZGZmXFx1MjAwY1xcdTIwMGRcXHUyMGQwLVxcdTIwZjBcXHUyY2VmLVxcdTJjZjFcXHUyZGUwLVxcdTJkZmZcXHUzMDJhLVxcdTMwMmZcXHUzMDk5XFx1MzA5YVxcdWE2NmYtXFx1YTY3MlxcdWE2N2NcXHVhNjdkXFx1YTZmMFxcdWE2ZjFcXHVhODAyXFx1YTgwNlxcdWE4MGJcXHVhODI1XFx1YTgyNlxcdWE4YzRcXHVhOGUwLVxcdWE4ZjFcXHVhOTI2LVxcdWE5MmRcXHVhOTQ3LVxcdWE5NTFcXHVhOTgwLVxcdWE5ODJcXHVhOWIzXFx1YTliNi1cXHVhOWI5XFx1YTliY1xcdWFhMjktXFx1YWEyZVxcdWFhMzFcXHVhYTMyXFx1YWEzNVxcdWFhMzZcXHVhYTQzXFx1YWE0Y1xcdWFhYjBcXHVhYWIyLVxcdWFhYjRcXHVhYWI3XFx1YWFiOFxcdWFhYmVcXHVhYWJmXFx1YWFjMVxcdWFiZTVcXHVhYmU4XFx1YWJlZFxcdWRjMDAtXFx1ZGZmZlxcdWZiMWVcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMjZcXHVmZjllXFx1ZmY5Zl0vO1xuZnVuY3Rpb24gaXNFeHRlbmRpbmdDaGFyKGNoKSB7IHJldHVybiBjaC5jaGFyQ29kZUF0KDApID49IDc2OCAmJiBleHRlbmRpbmdDaGFycy50ZXN0KGNoKSB9XG5cbi8vIFJldHVybnMgYSBudW1iZXIgZnJvbSB0aGUgcmFuZ2UgW2AwYDsgYHN0ci5sZW5ndGhgXSB1bmxlc3MgYHBvc2AgaXMgb3V0c2lkZSB0aGF0IHJhbmdlLlxuZnVuY3Rpb24gc2tpcEV4dGVuZGluZ0NoYXJzKHN0ciwgcG9zLCBkaXIpIHtcbiAgd2hpbGUgKChkaXIgPCAwID8gcG9zID4gMCA6IHBvcyA8IHN0ci5sZW5ndGgpICYmIGlzRXh0ZW5kaW5nQ2hhcihzdHIuY2hhckF0KHBvcykpKSB7IHBvcyArPSBkaXI7IH1cbiAgcmV0dXJuIHBvc1xufVxuXG4vLyBSZXR1cm5zIHRoZSB2YWx1ZSBmcm9tIHRoZSByYW5nZSBbYGZyb21gOyBgdG9gXSB0aGF0IHNhdGlzZmllc1xuLy8gYHByZWRgIGFuZCBpcyBjbG9zZXN0IHRvIGBmcm9tYC4gQXNzdW1lcyB0aGF0IGF0IGxlYXN0IGB0b2Agc2F0aXNmaWVzIGBwcmVkYC5cbmZ1bmN0aW9uIGZpbmRGaXJzdChwcmVkLCBmcm9tLCB0bykge1xuICBmb3IgKDs7KSB7XG4gICAgaWYgKE1hdGguYWJzKGZyb20gLSB0bykgPD0gMSkgeyByZXR1cm4gcHJlZChmcm9tKSA/IGZyb20gOiB0byB9XG4gICAgdmFyIG1pZCA9IE1hdGguZmxvb3IoKGZyb20gKyB0bykgLyAyKTtcbiAgICBpZiAocHJlZChtaWQpKSB7IHRvID0gbWlkOyB9XG4gICAgZWxzZSB7IGZyb20gPSBtaWQ7IH1cbiAgfVxufVxuXG4vLyBUaGUgZGlzcGxheSBoYW5kbGVzIHRoZSBET00gaW50ZWdyYXRpb24sIGJvdGggZm9yIGlucHV0IHJlYWRpbmdcbi8vIGFuZCBjb250ZW50IGRyYXdpbmcuIEl0IGhvbGRzIHJlZmVyZW5jZXMgdG8gRE9NIG5vZGVzIGFuZFxuLy8gZGlzcGxheS1yZWxhdGVkIHN0YXRlLlxuXG5mdW5jdGlvbiBEaXNwbGF5KHBsYWNlLCBkb2MsIGlucHV0KSB7XG4gIHZhciBkID0gdGhpcztcbiAgdGhpcy5pbnB1dCA9IGlucHV0O1xuXG4gIC8vIENvdmVycyBib3R0b20tcmlnaHQgc3F1YXJlIHdoZW4gYm90aCBzY3JvbGxiYXJzIGFyZSBwcmVzZW50LlxuICBkLnNjcm9sbGJhckZpbGxlciA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3Itc2Nyb2xsYmFyLWZpbGxlclwiKTtcbiAgZC5zY3JvbGxiYXJGaWxsZXIuc2V0QXR0cmlidXRlKFwiY20tbm90LWNvbnRlbnRcIiwgXCJ0cnVlXCIpO1xuICAvLyBDb3ZlcnMgYm90dG9tIG9mIGd1dHRlciB3aGVuIGNvdmVyR3V0dGVyTmV4dFRvU2Nyb2xsYmFyIGlzIG9uXG4gIC8vIGFuZCBoIHNjcm9sbGJhciBpcyBwcmVzZW50LlxuICBkLmd1dHRlckZpbGxlciA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyLWZpbGxlclwiKTtcbiAgZC5ndXR0ZXJGaWxsZXIuc2V0QXR0cmlidXRlKFwiY20tbm90LWNvbnRlbnRcIiwgXCJ0cnVlXCIpO1xuICAvLyBXaWxsIGNvbnRhaW4gdGhlIGFjdHVhbCBjb2RlLCBwb3NpdGlvbmVkIHRvIGNvdmVyIHRoZSB2aWV3cG9ydC5cbiAgZC5saW5lRGl2ID0gZWx0UChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItY29kZVwiKTtcbiAgLy8gRWxlbWVudHMgYXJlIGFkZGVkIHRvIHRoZXNlIHRvIHJlcHJlc2VudCBzZWxlY3Rpb24gYW5kIGN1cnNvcnMuXG4gIGQuc2VsZWN0aW9uRGl2ID0gZWx0KFwiZGl2XCIsIG51bGwsIG51bGwsIFwicG9zaXRpb246IHJlbGF0aXZlOyB6LWluZGV4OiAxXCIpO1xuICBkLmN1cnNvckRpdiA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItY3Vyc29yc1wiKTtcbiAgLy8gQSB2aXNpYmlsaXR5OiBoaWRkZW4gZWxlbWVudCB1c2VkIHRvIGZpbmQgdGhlIHNpemUgb2YgdGhpbmdzLlxuICBkLm1lYXN1cmUgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLW1lYXN1cmVcIik7XG4gIC8vIFdoZW4gbGluZXMgb3V0c2lkZSBvZiB0aGUgdmlld3BvcnQgYXJlIG1lYXN1cmVkLCB0aGV5IGFyZSBkcmF3biBpbiB0aGlzLlxuICBkLmxpbmVNZWFzdXJlID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1tZWFzdXJlXCIpO1xuICAvLyBXcmFwcyBldmVyeXRoaW5nIHRoYXQgbmVlZHMgdG8gZXhpc3QgaW5zaWRlIHRoZSB2ZXJ0aWNhbGx5LXBhZGRlZCBjb29yZGluYXRlIHN5c3RlbVxuICBkLmxpbmVTcGFjZSA9IGVsdFAoXCJkaXZcIiwgW2QubWVhc3VyZSwgZC5saW5lTWVhc3VyZSwgZC5zZWxlY3Rpb25EaXYsIGQuY3Vyc29yRGl2LCBkLmxpbmVEaXZdLFxuICAgICAgICAgICAgICAgICAgICBudWxsLCBcInBvc2l0aW9uOiByZWxhdGl2ZTsgb3V0bGluZTogbm9uZVwiKTtcbiAgdmFyIGxpbmVzID0gZWx0UChcImRpdlwiLCBbZC5saW5lU3BhY2VdLCBcIkNvZGVNaXJyb3ItbGluZXNcIik7XG4gIC8vIE1vdmVkIGFyb3VuZCBpdHMgcGFyZW50IHRvIGNvdmVyIHZpc2libGUgdmlldy5cbiAgZC5tb3ZlciA9IGVsdChcImRpdlwiLCBbbGluZXNdLCBudWxsLCBcInBvc2l0aW9uOiByZWxhdGl2ZVwiKTtcbiAgLy8gU2V0IHRvIHRoZSBoZWlnaHQgb2YgdGhlIGRvY3VtZW50LCBhbGxvd2luZyBzY3JvbGxpbmcuXG4gIGQuc2l6ZXIgPSBlbHQoXCJkaXZcIiwgW2QubW92ZXJdLCBcIkNvZGVNaXJyb3Itc2l6ZXJcIik7XG4gIGQuc2l6ZXJXaWR0aCA9IG51bGw7XG4gIC8vIEJlaGF2aW9yIG9mIGVsdHMgd2l0aCBvdmVyZmxvdzogYXV0byBhbmQgcGFkZGluZyBpc1xuICAvLyBpbmNvbnNpc3RlbnQgYWNyb3NzIGJyb3dzZXJzLiBUaGlzIGlzIHVzZWQgdG8gZW5zdXJlIHRoZVxuICAvLyBzY3JvbGxhYmxlIGFyZWEgaXMgYmlnIGVub3VnaC5cbiAgZC5oZWlnaHRGb3JjZXIgPSBlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogYWJzb2x1dGU7IGhlaWdodDogXCIgKyBzY3JvbGxlckdhcCArIFwicHg7IHdpZHRoOiAxcHg7XCIpO1xuICAvLyBXaWxsIGNvbnRhaW4gdGhlIGd1dHRlcnMsIGlmIGFueS5cbiAgZC5ndXR0ZXJzID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1ndXR0ZXJzXCIpO1xuICBkLmxpbmVHdXR0ZXIgPSBudWxsO1xuICAvLyBBY3R1YWwgc2Nyb2xsYWJsZSBlbGVtZW50LlxuICBkLnNjcm9sbGVyID0gZWx0KFwiZGl2XCIsIFtkLnNpemVyLCBkLmhlaWdodEZvcmNlciwgZC5ndXR0ZXJzXSwgXCJDb2RlTWlycm9yLXNjcm9sbFwiKTtcbiAgZC5zY3JvbGxlci5zZXRBdHRyaWJ1dGUoXCJ0YWJJbmRleFwiLCBcIi0xXCIpO1xuICAvLyBUaGUgZWxlbWVudCBpbiB3aGljaCB0aGUgZWRpdG9yIGxpdmVzLlxuICBkLndyYXBwZXIgPSBlbHQoXCJkaXZcIiwgW2Quc2Nyb2xsYmFyRmlsbGVyLCBkLmd1dHRlckZpbGxlciwgZC5zY3JvbGxlcl0sIFwiQ29kZU1pcnJvclwiKTtcblxuICAvLyBXb3JrIGFyb3VuZCBJRTcgei1pbmRleCBidWcgKG5vdCBwZXJmZWN0LCBoZW5jZSBJRTcgbm90IHJlYWxseSBiZWluZyBzdXBwb3J0ZWQpXG4gIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOCkgeyBkLmd1dHRlcnMuc3R5bGUuekluZGV4ID0gLTE7IGQuc2Nyb2xsZXIuc3R5bGUucGFkZGluZ1JpZ2h0ID0gMDsgfVxuICBpZiAoIXdlYmtpdCAmJiAhKGdlY2tvICYmIG1vYmlsZSkpIHsgZC5zY3JvbGxlci5kcmFnZ2FibGUgPSB0cnVlOyB9XG5cbiAgaWYgKHBsYWNlKSB7XG4gICAgaWYgKHBsYWNlLmFwcGVuZENoaWxkKSB7IHBsYWNlLmFwcGVuZENoaWxkKGQud3JhcHBlcik7IH1cbiAgICBlbHNlIHsgcGxhY2UoZC53cmFwcGVyKTsgfVxuICB9XG5cbiAgLy8gQ3VycmVudCByZW5kZXJlZCByYW5nZSAobWF5IGJlIGJpZ2dlciB0aGFuIHRoZSB2aWV3IHdpbmRvdykuXG4gIGQudmlld0Zyb20gPSBkLnZpZXdUbyA9IGRvYy5maXJzdDtcbiAgZC5yZXBvcnRlZFZpZXdGcm9tID0gZC5yZXBvcnRlZFZpZXdUbyA9IGRvYy5maXJzdDtcbiAgLy8gSW5mb3JtYXRpb24gYWJvdXQgdGhlIHJlbmRlcmVkIGxpbmVzLlxuICBkLnZpZXcgPSBbXTtcbiAgZC5yZW5kZXJlZFZpZXcgPSBudWxsO1xuICAvLyBIb2xkcyBpbmZvIGFib3V0IGEgc2luZ2xlIHJlbmRlcmVkIGxpbmUgd2hlbiBpdCB3YXMgcmVuZGVyZWRcbiAgLy8gZm9yIG1lYXN1cmVtZW50LCB3aGlsZSBub3QgaW4gdmlldy5cbiAgZC5leHRlcm5hbE1lYXN1cmVkID0gbnVsbDtcbiAgLy8gRW1wdHkgc3BhY2UgKGluIHBpeGVscykgYWJvdmUgdGhlIHZpZXdcbiAgZC52aWV3T2Zmc2V0ID0gMDtcbiAgZC5sYXN0V3JhcEhlaWdodCA9IGQubGFzdFdyYXBXaWR0aCA9IDA7XG4gIGQudXBkYXRlTGluZU51bWJlcnMgPSBudWxsO1xuXG4gIGQubmF0aXZlQmFyV2lkdGggPSBkLmJhckhlaWdodCA9IGQuYmFyV2lkdGggPSAwO1xuICBkLnNjcm9sbGJhcnNDbGlwcGVkID0gZmFsc2U7XG5cbiAgLy8gVXNlZCB0byBvbmx5IHJlc2l6ZSB0aGUgbGluZSBudW1iZXIgZ3V0dGVyIHdoZW4gbmVjZXNzYXJ5ICh3aGVuXG4gIC8vIHRoZSBhbW91bnQgb2YgbGluZXMgY3Jvc3NlcyBhIGJvdW5kYXJ5IHRoYXQgbWFrZXMgaXRzIHdpZHRoIGNoYW5nZSlcbiAgZC5saW5lTnVtV2lkdGggPSBkLmxpbmVOdW1Jbm5lcldpZHRoID0gZC5saW5lTnVtQ2hhcnMgPSBudWxsO1xuICAvLyBTZXQgdG8gdHJ1ZSB3aGVuIGEgbm9uLWhvcml6b250YWwtc2Nyb2xsaW5nIGxpbmUgd2lkZ2V0IGlzXG4gIC8vIGFkZGVkLiBBcyBhbiBvcHRpbWl6YXRpb24sIGxpbmUgd2lkZ2V0IGFsaWduaW5nIGlzIHNraXBwZWQgd2hlblxuICAvLyB0aGlzIGlzIGZhbHNlLlxuICBkLmFsaWduV2lkZ2V0cyA9IGZhbHNlO1xuXG4gIGQuY2FjaGVkQ2hhcldpZHRoID0gZC5jYWNoZWRUZXh0SGVpZ2h0ID0gZC5jYWNoZWRQYWRkaW5nSCA9IG51bGw7XG5cbiAgLy8gVHJhY2tzIHRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoIHNvIHRoYXQgdGhlIGhvcml6b250YWwgc2Nyb2xsYmFyXG4gIC8vIGNhbiBiZSBrZXB0IHN0YXRpYyB3aGVuIHNjcm9sbGluZy5cbiAgZC5tYXhMaW5lID0gbnVsbDtcbiAgZC5tYXhMaW5lTGVuZ3RoID0gMDtcbiAgZC5tYXhMaW5lQ2hhbmdlZCA9IGZhbHNlO1xuXG4gIC8vIFVzZWQgZm9yIG1lYXN1cmluZyB3aGVlbCBzY3JvbGxpbmcgZ3JhbnVsYXJpdHlcbiAgZC53aGVlbERYID0gZC53aGVlbERZID0gZC53aGVlbFN0YXJ0WCA9IGQud2hlZWxTdGFydFkgPSBudWxsO1xuXG4gIC8vIFRydWUgd2hlbiBzaGlmdCBpcyBoZWxkIGRvd24uXG4gIGQuc2hpZnQgPSBmYWxzZTtcblxuICAvLyBVc2VkIHRvIHRyYWNrIHdoZXRoZXIgYW55dGhpbmcgaGFwcGVuZWQgc2luY2UgdGhlIGNvbnRleHQgbWVudVxuICAvLyB3YXMgb3BlbmVkLlxuICBkLnNlbEZvckNvbnRleHRNZW51ID0gbnVsbDtcblxuICBkLmFjdGl2ZVRvdWNoID0gbnVsbDtcblxuICBpbnB1dC5pbml0KGQpO1xufVxuXG4vLyBGaW5kIHRoZSBsaW5lIG9iamVjdCBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBsaW5lIG51bWJlci5cbmZ1bmN0aW9uIGdldExpbmUoZG9jLCBuKSB7XG4gIG4gLT0gZG9jLmZpcnN0O1xuICBpZiAobiA8IDAgfHwgbiA+PSBkb2Muc2l6ZSkgeyB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSBpcyBubyBsaW5lIFwiICsgKG4gKyBkb2MuZmlyc3QpICsgXCIgaW4gdGhlIGRvY3VtZW50LlwiKSB9XG4gIHZhciBjaHVuayA9IGRvYztcbiAgd2hpbGUgKCFjaHVuay5saW5lcykge1xuICAgIGZvciAodmFyIGkgPSAwOzsgKytpKSB7XG4gICAgICB2YXIgY2hpbGQgPSBjaHVuay5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICAgIGlmIChuIDwgc3opIHsgY2h1bmsgPSBjaGlsZDsgYnJlYWsgfVxuICAgICAgbiAtPSBzejtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNodW5rLmxpbmVzW25dXG59XG5cbi8vIEdldCB0aGUgcGFydCBvZiBhIGRvY3VtZW50IGJldHdlZW4gdHdvIHBvc2l0aW9ucywgYXMgYW4gYXJyYXkgb2Zcbi8vIHN0cmluZ3MuXG5mdW5jdGlvbiBnZXRCZXR3ZWVuKGRvYywgc3RhcnQsIGVuZCkge1xuICB2YXIgb3V0ID0gW10sIG4gPSBzdGFydC5saW5lO1xuICBkb2MuaXRlcihzdGFydC5saW5lLCBlbmQubGluZSArIDEsIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgdmFyIHRleHQgPSBsaW5lLnRleHQ7XG4gICAgaWYgKG4gPT0gZW5kLmxpbmUpIHsgdGV4dCA9IHRleHQuc2xpY2UoMCwgZW5kLmNoKTsgfVxuICAgIGlmIChuID09IHN0YXJ0LmxpbmUpIHsgdGV4dCA9IHRleHQuc2xpY2Uoc3RhcnQuY2gpOyB9XG4gICAgb3V0LnB1c2godGV4dCk7XG4gICAgKytuO1xuICB9KTtcbiAgcmV0dXJuIG91dFxufVxuLy8gR2V0IHRoZSBsaW5lcyBiZXR3ZWVuIGZyb20gYW5kIHRvLCBhcyBhcnJheSBvZiBzdHJpbmdzLlxuZnVuY3Rpb24gZ2V0TGluZXMoZG9jLCBmcm9tLCB0bykge1xuICB2YXIgb3V0ID0gW107XG4gIGRvYy5pdGVyKGZyb20sIHRvLCBmdW5jdGlvbiAobGluZSkgeyBvdXQucHVzaChsaW5lLnRleHQpOyB9KTsgLy8gaXRlciBhYm9ydHMgd2hlbiBjYWxsYmFjayByZXR1cm5zIHRydXRoeSB2YWx1ZVxuICByZXR1cm4gb3V0XG59XG5cbi8vIFVwZGF0ZSB0aGUgaGVpZ2h0IG9mIGEgbGluZSwgcHJvcGFnYXRpbmcgdGhlIGhlaWdodCBjaGFuZ2Vcbi8vIHVwd2FyZHMgdG8gcGFyZW50IG5vZGVzLlxuZnVuY3Rpb24gdXBkYXRlTGluZUhlaWdodChsaW5lLCBoZWlnaHQpIHtcbiAgdmFyIGRpZmYgPSBoZWlnaHQgLSBsaW5lLmhlaWdodDtcbiAgaWYgKGRpZmYpIHsgZm9yICh2YXIgbiA9IGxpbmU7IG47IG4gPSBuLnBhcmVudCkgeyBuLmhlaWdodCArPSBkaWZmOyB9IH1cbn1cblxuLy8gR2l2ZW4gYSBsaW5lIG9iamVjdCwgZmluZCBpdHMgbGluZSBudW1iZXIgYnkgd2Fsa2luZyB1cCB0aHJvdWdoXG4vLyBpdHMgcGFyZW50IGxpbmtzLlxuZnVuY3Rpb24gbGluZU5vKGxpbmUpIHtcbiAgaWYgKGxpbmUucGFyZW50ID09IG51bGwpIHsgcmV0dXJuIG51bGwgfVxuICB2YXIgY3VyID0gbGluZS5wYXJlbnQsIG5vID0gaW5kZXhPZihjdXIubGluZXMsIGxpbmUpO1xuICBmb3IgKHZhciBjaHVuayA9IGN1ci5wYXJlbnQ7IGNodW5rOyBjdXIgPSBjaHVuaywgY2h1bmsgPSBjaHVuay5wYXJlbnQpIHtcbiAgICBmb3IgKHZhciBpID0gMDs7ICsraSkge1xuICAgICAgaWYgKGNodW5rLmNoaWxkcmVuW2ldID09IGN1cikgeyBicmVhayB9XG4gICAgICBubyArPSBjaHVuay5jaGlsZHJlbltpXS5jaHVua1NpemUoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5vICsgY3VyLmZpcnN0XG59XG5cbi8vIEZpbmQgdGhlIGxpbmUgYXQgdGhlIGdpdmVuIHZlcnRpY2FsIHBvc2l0aW9uLCB1c2luZyB0aGUgaGVpZ2h0XG4vLyBpbmZvcm1hdGlvbiBpbiB0aGUgZG9jdW1lbnQgdHJlZS5cbmZ1bmN0aW9uIGxpbmVBdEhlaWdodChjaHVuaywgaCkge1xuICB2YXIgbiA9IGNodW5rLmZpcnN0O1xuICBvdXRlcjogZG8ge1xuICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGNodW5rLmNoaWxkcmVuLmxlbmd0aDsgKytpJDEpIHtcbiAgICAgIHZhciBjaGlsZCA9IGNodW5rLmNoaWxkcmVuW2kkMV0sIGNoID0gY2hpbGQuaGVpZ2h0O1xuICAgICAgaWYgKGggPCBjaCkgeyBjaHVuayA9IGNoaWxkOyBjb250aW51ZSBvdXRlciB9XG4gICAgICBoIC09IGNoO1xuICAgICAgbiArPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICB9XG4gICAgcmV0dXJuIG5cbiAgfSB3aGlsZSAoIWNodW5rLmxpbmVzKVxuICB2YXIgaSA9IDA7XG4gIGZvciAoOyBpIDwgY2h1bmsubGluZXMubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgbGluZSA9IGNodW5rLmxpbmVzW2ldLCBsaCA9IGxpbmUuaGVpZ2h0O1xuICAgIGlmIChoIDwgbGgpIHsgYnJlYWsgfVxuICAgIGggLT0gbGg7XG4gIH1cbiAgcmV0dXJuIG4gKyBpXG59XG5cbmZ1bmN0aW9uIGlzTGluZShkb2MsIGwpIHtyZXR1cm4gbCA+PSBkb2MuZmlyc3QgJiYgbCA8IGRvYy5maXJzdCArIGRvYy5zaXplfVxuXG5mdW5jdGlvbiBsaW5lTnVtYmVyRm9yKG9wdGlvbnMsIGkpIHtcbiAgcmV0dXJuIFN0cmluZyhvcHRpb25zLmxpbmVOdW1iZXJGb3JtYXR0ZXIoaSArIG9wdGlvbnMuZmlyc3RMaW5lTnVtYmVyKSlcbn1cblxuLy8gQSBQb3MgaW5zdGFuY2UgcmVwcmVzZW50cyBhIHBvc2l0aW9uIHdpdGhpbiB0aGUgdGV4dC5cbmZ1bmN0aW9uIFBvcyhsaW5lLCBjaCwgc3RpY2t5KSB7XG4gIGlmICggc3RpY2t5ID09PSB2b2lkIDAgKSBzdGlja3kgPSBudWxsO1xuXG4gIGlmICghKHRoaXMgaW5zdGFuY2VvZiBQb3MpKSB7IHJldHVybiBuZXcgUG9zKGxpbmUsIGNoLCBzdGlja3kpIH1cbiAgdGhpcy5saW5lID0gbGluZTtcbiAgdGhpcy5jaCA9IGNoO1xuICB0aGlzLnN0aWNreSA9IHN0aWNreTtcbn1cblxuLy8gQ29tcGFyZSB0d28gcG9zaXRpb25zLCByZXR1cm4gMCBpZiB0aGV5IGFyZSB0aGUgc2FtZSwgYSBuZWdhdGl2ZVxuLy8gbnVtYmVyIHdoZW4gYSBpcyBsZXNzLCBhbmQgYSBwb3NpdGl2ZSBudW1iZXIgb3RoZXJ3aXNlLlxuZnVuY3Rpb24gY21wKGEsIGIpIHsgcmV0dXJuIGEubGluZSAtIGIubGluZSB8fCBhLmNoIC0gYi5jaCB9XG5cbmZ1bmN0aW9uIGVxdWFsQ3Vyc29yUG9zKGEsIGIpIHsgcmV0dXJuIGEuc3RpY2t5ID09IGIuc3RpY2t5ICYmIGNtcChhLCBiKSA9PSAwIH1cblxuZnVuY3Rpb24gY29weVBvcyh4KSB7cmV0dXJuIFBvcyh4LmxpbmUsIHguY2gpfVxuZnVuY3Rpb24gbWF4UG9zKGEsIGIpIHsgcmV0dXJuIGNtcChhLCBiKSA8IDAgPyBiIDogYSB9XG5mdW5jdGlvbiBtaW5Qb3MoYSwgYikgeyByZXR1cm4gY21wKGEsIGIpIDwgMCA/IGEgOiBiIH1cblxuLy8gTW9zdCBvZiB0aGUgZXh0ZXJuYWwgQVBJIGNsaXBzIGdpdmVuIHBvc2l0aW9ucyB0byBtYWtlIHN1cmUgdGhleVxuLy8gYWN0dWFsbHkgZXhpc3Qgd2l0aGluIHRoZSBkb2N1bWVudC5cbmZ1bmN0aW9uIGNsaXBMaW5lKGRvYywgbikge3JldHVybiBNYXRoLm1heChkb2MuZmlyc3QsIE1hdGgubWluKG4sIGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSkpfVxuZnVuY3Rpb24gY2xpcFBvcyhkb2MsIHBvcykge1xuICBpZiAocG9zLmxpbmUgPCBkb2MuZmlyc3QpIHsgcmV0dXJuIFBvcyhkb2MuZmlyc3QsIDApIH1cbiAgdmFyIGxhc3QgPSBkb2MuZmlyc3QgKyBkb2Muc2l6ZSAtIDE7XG4gIGlmIChwb3MubGluZSA+IGxhc3QpIHsgcmV0dXJuIFBvcyhsYXN0LCBnZXRMaW5lKGRvYywgbGFzdCkudGV4dC5sZW5ndGgpIH1cbiAgcmV0dXJuIGNsaXBUb0xlbihwb3MsIGdldExpbmUoZG9jLCBwb3MubGluZSkudGV4dC5sZW5ndGgpXG59XG5mdW5jdGlvbiBjbGlwVG9MZW4ocG9zLCBsaW5lbGVuKSB7XG4gIHZhciBjaCA9IHBvcy5jaDtcbiAgaWYgKGNoID09IG51bGwgfHwgY2ggPiBsaW5lbGVuKSB7IHJldHVybiBQb3MocG9zLmxpbmUsIGxpbmVsZW4pIH1cbiAgZWxzZSBpZiAoY2ggPCAwKSB7IHJldHVybiBQb3MocG9zLmxpbmUsIDApIH1cbiAgZWxzZSB7IHJldHVybiBwb3MgfVxufVxuZnVuY3Rpb24gY2xpcFBvc0FycmF5KGRvYywgYXJyYXkpIHtcbiAgdmFyIG91dCA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7IG91dFtpXSA9IGNsaXBQb3MoZG9jLCBhcnJheVtpXSk7IH1cbiAgcmV0dXJuIG91dFxufVxuXG4vLyBPcHRpbWl6ZSBzb21lIGNvZGUgd2hlbiB0aGVzZSBmZWF0dXJlcyBhcmUgbm90IHVzZWQuXG52YXIgc2F3UmVhZE9ubHlTcGFucyA9IGZhbHNlO1xudmFyIHNhd0NvbGxhcHNlZFNwYW5zID0gZmFsc2U7XG5cbmZ1bmN0aW9uIHNlZVJlYWRPbmx5U3BhbnMoKSB7XG4gIHNhd1JlYWRPbmx5U3BhbnMgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBzZWVDb2xsYXBzZWRTcGFucygpIHtcbiAgc2F3Q29sbGFwc2VkU3BhbnMgPSB0cnVlO1xufVxuXG4vLyBURVhUTUFSS0VSIFNQQU5TXG5cbmZ1bmN0aW9uIE1hcmtlZFNwYW4obWFya2VyLCBmcm9tLCB0bykge1xuICB0aGlzLm1hcmtlciA9IG1hcmtlcjtcbiAgdGhpcy5mcm9tID0gZnJvbTsgdGhpcy50byA9IHRvO1xufVxuXG4vLyBTZWFyY2ggYW4gYXJyYXkgb2Ygc3BhbnMgZm9yIGEgc3BhbiBtYXRjaGluZyB0aGUgZ2l2ZW4gbWFya2VyLlxuZnVuY3Rpb24gZ2V0TWFya2VkU3BhbkZvcihzcGFucywgbWFya2VyKSB7XG4gIGlmIChzcGFucykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICBpZiAoc3Bhbi5tYXJrZXIgPT0gbWFya2VyKSB7IHJldHVybiBzcGFuIH1cbiAgfSB9XG59XG4vLyBSZW1vdmUgYSBzcGFuIGZyb20gYW4gYXJyYXksIHJldHVybmluZyB1bmRlZmluZWQgaWYgbm8gc3BhbnMgYXJlXG4vLyBsZWZ0ICh3ZSBkb24ndCBzdG9yZSBhcnJheXMgZm9yIGxpbmVzIHdpdGhvdXQgc3BhbnMpLlxuZnVuY3Rpb24gcmVtb3ZlTWFya2VkU3BhbihzcGFucywgc3Bhbikge1xuICB2YXIgcjtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSlcbiAgICB7IGlmIChzcGFuc1tpXSAhPSBzcGFuKSB7IChyIHx8IChyID0gW10pKS5wdXNoKHNwYW5zW2ldKTsgfSB9XG4gIHJldHVybiByXG59XG4vLyBBZGQgYSBzcGFuIHRvIGEgbGluZS5cbmZ1bmN0aW9uIGFkZE1hcmtlZFNwYW4obGluZSwgc3Bhbikge1xuICBsaW5lLm1hcmtlZFNwYW5zID0gbGluZS5tYXJrZWRTcGFucyA/IGxpbmUubWFya2VkU3BhbnMuY29uY2F0KFtzcGFuXSkgOiBbc3Bhbl07XG4gIHNwYW4ubWFya2VyLmF0dGFjaExpbmUobGluZSk7XG59XG5cbi8vIFVzZWQgZm9yIHRoZSBhbGdvcml0aG0gdGhhdCBhZGp1c3RzIG1hcmtlcnMgZm9yIGEgY2hhbmdlIGluIHRoZVxuLy8gZG9jdW1lbnQuIFRoZXNlIGZ1bmN0aW9ucyBjdXQgYW4gYXJyYXkgb2Ygc3BhbnMgYXQgYSBnaXZlblxuLy8gY2hhcmFjdGVyIHBvc2l0aW9uLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgcmVtYWluaW5nIGNodW5rcyAob3Jcbi8vIHVuZGVmaW5lZCBpZiBub3RoaW5nIHJlbWFpbnMpLlxuZnVuY3Rpb24gbWFya2VkU3BhbnNCZWZvcmUob2xkLCBzdGFydENoLCBpc0luc2VydCkge1xuICB2YXIgbnc7XG4gIGlmIChvbGQpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBvbGQubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgc3BhbiA9IG9sZFtpXSwgbWFya2VyID0gc3Bhbi5tYXJrZXI7XG4gICAgdmFyIHN0YXJ0c0JlZm9yZSA9IHNwYW4uZnJvbSA9PSBudWxsIHx8IChtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IHNwYW4uZnJvbSA8PSBzdGFydENoIDogc3Bhbi5mcm9tIDwgc3RhcnRDaCk7XG4gICAgaWYgKHN0YXJ0c0JlZm9yZSB8fCBzcGFuLmZyb20gPT0gc3RhcnRDaCAmJiBtYXJrZXIudHlwZSA9PSBcImJvb2ttYXJrXCIgJiYgKCFpc0luc2VydCB8fCAhc3Bhbi5tYXJrZXIuaW5zZXJ0TGVmdCkpIHtcbiAgICAgIHZhciBlbmRzQWZ0ZXIgPSBzcGFuLnRvID09IG51bGwgfHwgKG1hcmtlci5pbmNsdXNpdmVSaWdodCA/IHNwYW4udG8gPj0gc3RhcnRDaCA6IHNwYW4udG8gPiBzdGFydENoKTsobncgfHwgKG53ID0gW10pKS5wdXNoKG5ldyBNYXJrZWRTcGFuKG1hcmtlciwgc3Bhbi5mcm9tLCBlbmRzQWZ0ZXIgPyBudWxsIDogc3Bhbi50bykpO1xuICAgIH1cbiAgfSB9XG4gIHJldHVybiBud1xufVxuZnVuY3Rpb24gbWFya2VkU3BhbnNBZnRlcihvbGQsIGVuZENoLCBpc0luc2VydCkge1xuICB2YXIgbnc7XG4gIGlmIChvbGQpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBvbGQubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgc3BhbiA9IG9sZFtpXSwgbWFya2VyID0gc3Bhbi5tYXJrZXI7XG4gICAgdmFyIGVuZHNBZnRlciA9IHNwYW4udG8gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gc3Bhbi50byA+PSBlbmRDaCA6IHNwYW4udG8gPiBlbmRDaCk7XG4gICAgaWYgKGVuZHNBZnRlciB8fCBzcGFuLmZyb20gPT0gZW5kQ2ggJiYgbWFya2VyLnR5cGUgPT0gXCJib29rbWFya1wiICYmICghaXNJbnNlcnQgfHwgc3Bhbi5tYXJrZXIuaW5zZXJ0TGVmdCkpIHtcbiAgICAgIHZhciBzdGFydHNCZWZvcmUgPSBzcGFuLmZyb20gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZUxlZnQgPyBzcGFuLmZyb20gPD0gZW5kQ2ggOiBzcGFuLmZyb20gPCBlbmRDaCk7KG53IHx8IChudyA9IFtdKSkucHVzaChuZXcgTWFya2VkU3BhbihtYXJrZXIsIHN0YXJ0c0JlZm9yZSA/IG51bGwgOiBzcGFuLmZyb20gLSBlbmRDaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbi50byA9PSBudWxsID8gbnVsbCA6IHNwYW4udG8gLSBlbmRDaCkpO1xuICAgIH1cbiAgfSB9XG4gIHJldHVybiBud1xufVxuXG4vLyBHaXZlbiBhIGNoYW5nZSBvYmplY3QsIGNvbXB1dGUgdGhlIG5ldyBzZXQgb2YgbWFya2VyIHNwYW5zIHRoYXRcbi8vIGNvdmVyIHRoZSBsaW5lIGluIHdoaWNoIHRoZSBjaGFuZ2UgdG9vayBwbGFjZS4gUmVtb3ZlcyBzcGFuc1xuLy8gZW50aXJlbHkgd2l0aGluIHRoZSBjaGFuZ2UsIHJlY29ubmVjdHMgc3BhbnMgYmVsb25naW5nIHRvIHRoZVxuLy8gc2FtZSBtYXJrZXIgdGhhdCBhcHBlYXIgb24gYm90aCBzaWRlcyBvZiB0aGUgY2hhbmdlLCBhbmQgY3V0cyBvZmZcbi8vIHNwYW5zIHBhcnRpYWxseSB3aXRoaW4gdGhlIGNoYW5nZS4gUmV0dXJucyBhbiBhcnJheSBvZiBzcGFuXG4vLyBhcnJheXMgd2l0aCBvbmUgZWxlbWVudCBmb3IgZWFjaCBsaW5lIGluIChhZnRlcikgdGhlIGNoYW5nZS5cbmZ1bmN0aW9uIHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpIHtcbiAgaWYgKGNoYW5nZS5mdWxsKSB7IHJldHVybiBudWxsIH1cbiAgdmFyIG9sZEZpcnN0ID0gaXNMaW5lKGRvYywgY2hhbmdlLmZyb20ubGluZSkgJiYgZ2V0TGluZShkb2MsIGNoYW5nZS5mcm9tLmxpbmUpLm1hcmtlZFNwYW5zO1xuICB2YXIgb2xkTGFzdCA9IGlzTGluZShkb2MsIGNoYW5nZS50by5saW5lKSAmJiBnZXRMaW5lKGRvYywgY2hhbmdlLnRvLmxpbmUpLm1hcmtlZFNwYW5zO1xuICBpZiAoIW9sZEZpcnN0ICYmICFvbGRMYXN0KSB7IHJldHVybiBudWxsIH1cblxuICB2YXIgc3RhcnRDaCA9IGNoYW5nZS5mcm9tLmNoLCBlbmRDaCA9IGNoYW5nZS50by5jaCwgaXNJbnNlcnQgPSBjbXAoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPT0gMDtcbiAgLy8gR2V0IHRoZSBzcGFucyB0aGF0ICdzdGljayBvdXQnIG9uIGJvdGggc2lkZXNcbiAgdmFyIGZpcnN0ID0gbWFya2VkU3BhbnNCZWZvcmUob2xkRmlyc3QsIHN0YXJ0Q2gsIGlzSW5zZXJ0KTtcbiAgdmFyIGxhc3QgPSBtYXJrZWRTcGFuc0FmdGVyKG9sZExhc3QsIGVuZENoLCBpc0luc2VydCk7XG5cbiAgLy8gTmV4dCwgbWVyZ2UgdGhvc2UgdHdvIGVuZHNcbiAgdmFyIHNhbWVMaW5lID0gY2hhbmdlLnRleHQubGVuZ3RoID09IDEsIG9mZnNldCA9IGxzdChjaGFuZ2UudGV4dCkubGVuZ3RoICsgKHNhbWVMaW5lID8gc3RhcnRDaCA6IDApO1xuICBpZiAoZmlyc3QpIHtcbiAgICAvLyBGaXggdXAgLnRvIHByb3BlcnRpZXMgb2YgZmlyc3RcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpcnN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgc3BhbiA9IGZpcnN0W2ldO1xuICAgICAgaWYgKHNwYW4udG8gPT0gbnVsbCkge1xuICAgICAgICB2YXIgZm91bmQgPSBnZXRNYXJrZWRTcGFuRm9yKGxhc3QsIHNwYW4ubWFya2VyKTtcbiAgICAgICAgaWYgKCFmb3VuZCkgeyBzcGFuLnRvID0gc3RhcnRDaDsgfVxuICAgICAgICBlbHNlIGlmIChzYW1lTGluZSkgeyBzcGFuLnRvID0gZm91bmQudG8gPT0gbnVsbCA/IG51bGwgOiBmb3VuZC50byArIG9mZnNldDsgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAobGFzdCkge1xuICAgIC8vIEZpeCB1cCAuZnJvbSBpbiBsYXN0IChvciBtb3ZlIHRoZW0gaW50byBmaXJzdCBpbiBjYXNlIG9mIHNhbWVMaW5lKVxuICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGxhc3QubGVuZ3RoOyArK2kkMSkge1xuICAgICAgdmFyIHNwYW4kMSA9IGxhc3RbaSQxXTtcbiAgICAgIGlmIChzcGFuJDEudG8gIT0gbnVsbCkgeyBzcGFuJDEudG8gKz0gb2Zmc2V0OyB9XG4gICAgICBpZiAoc3BhbiQxLmZyb20gPT0gbnVsbCkge1xuICAgICAgICB2YXIgZm91bmQkMSA9IGdldE1hcmtlZFNwYW5Gb3IoZmlyc3QsIHNwYW4kMS5tYXJrZXIpO1xuICAgICAgICBpZiAoIWZvdW5kJDEpIHtcbiAgICAgICAgICBzcGFuJDEuZnJvbSA9IG9mZnNldDtcbiAgICAgICAgICBpZiAoc2FtZUxpbmUpIHsgKGZpcnN0IHx8IChmaXJzdCA9IFtdKSkucHVzaChzcGFuJDEpOyB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNwYW4kMS5mcm9tICs9IG9mZnNldDtcbiAgICAgICAgaWYgKHNhbWVMaW5lKSB7IChmaXJzdCB8fCAoZmlyc3QgPSBbXSkpLnB1c2goc3BhbiQxKTsgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBNYWtlIHN1cmUgd2UgZGlkbid0IGNyZWF0ZSBhbnkgemVyby1sZW5ndGggc3BhbnNcbiAgaWYgKGZpcnN0KSB7IGZpcnN0ID0gY2xlYXJFbXB0eVNwYW5zKGZpcnN0KTsgfVxuICBpZiAobGFzdCAmJiBsYXN0ICE9IGZpcnN0KSB7IGxhc3QgPSBjbGVhckVtcHR5U3BhbnMobGFzdCk7IH1cblxuICB2YXIgbmV3TWFya2VycyA9IFtmaXJzdF07XG4gIGlmICghc2FtZUxpbmUpIHtcbiAgICAvLyBGaWxsIGdhcCB3aXRoIHdob2xlLWxpbmUtc3BhbnNcbiAgICB2YXIgZ2FwID0gY2hhbmdlLnRleHQubGVuZ3RoIC0gMiwgZ2FwTWFya2VycztcbiAgICBpZiAoZ2FwID4gMCAmJiBmaXJzdClcbiAgICAgIHsgZm9yICh2YXIgaSQyID0gMDsgaSQyIDwgZmlyc3QubGVuZ3RoOyArK2kkMilcbiAgICAgICAgeyBpZiAoZmlyc3RbaSQyXS50byA9PSBudWxsKVxuICAgICAgICAgIHsgKGdhcE1hcmtlcnMgfHwgKGdhcE1hcmtlcnMgPSBbXSkpLnB1c2gobmV3IE1hcmtlZFNwYW4oZmlyc3RbaSQyXS5tYXJrZXIsIG51bGwsIG51bGwpKTsgfSB9IH1cbiAgICBmb3IgKHZhciBpJDMgPSAwOyBpJDMgPCBnYXA7ICsraSQzKVxuICAgICAgeyBuZXdNYXJrZXJzLnB1c2goZ2FwTWFya2Vycyk7IH1cbiAgICBuZXdNYXJrZXJzLnB1c2gobGFzdCk7XG4gIH1cbiAgcmV0dXJuIG5ld01hcmtlcnNcbn1cblxuLy8gUmVtb3ZlIHNwYW5zIHRoYXQgYXJlIGVtcHR5IGFuZCBkb24ndCBoYXZlIGEgY2xlYXJXaGVuRW1wdHlcbi8vIG9wdGlvbiBvZiBmYWxzZS5cbmZ1bmN0aW9uIGNsZWFyRW1wdHlTcGFucyhzcGFucykge1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICBpZiAoc3Bhbi5mcm9tICE9IG51bGwgJiYgc3Bhbi5mcm9tID09IHNwYW4udG8gJiYgc3Bhbi5tYXJrZXIuY2xlYXJXaGVuRW1wdHkgIT09IGZhbHNlKVxuICAgICAgeyBzcGFucy5zcGxpY2UoaS0tLCAxKTsgfVxuICB9XG4gIGlmICghc3BhbnMubGVuZ3RoKSB7IHJldHVybiBudWxsIH1cbiAgcmV0dXJuIHNwYW5zXG59XG5cbi8vIFVzZWQgdG8gJ2NsaXAnIG91dCByZWFkT25seSByYW5nZXMgd2hlbiBtYWtpbmcgYSBjaGFuZ2UuXG5mdW5jdGlvbiByZW1vdmVSZWFkT25seVJhbmdlcyhkb2MsIGZyb20sIHRvKSB7XG4gIHZhciBtYXJrZXJzID0gbnVsbDtcbiAgZG9jLml0ZXIoZnJvbS5saW5lLCB0by5saW5lICsgMSwgZnVuY3Rpb24gKGxpbmUpIHtcbiAgICBpZiAobGluZS5tYXJrZWRTcGFucykgeyBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmUubWFya2VkU3BhbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBtYXJrID0gbGluZS5tYXJrZWRTcGFuc1tpXS5tYXJrZXI7XG4gICAgICBpZiAobWFyay5yZWFkT25seSAmJiAoIW1hcmtlcnMgfHwgaW5kZXhPZihtYXJrZXJzLCBtYXJrKSA9PSAtMSkpXG4gICAgICAgIHsgKG1hcmtlcnMgfHwgKG1hcmtlcnMgPSBbXSkpLnB1c2gobWFyayk7IH1cbiAgICB9IH1cbiAgfSk7XG4gIGlmICghbWFya2VycykgeyByZXR1cm4gbnVsbCB9XG4gIHZhciBwYXJ0cyA9IFt7ZnJvbTogZnJvbSwgdG86IHRvfV07XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7ICsraSkge1xuICAgIHZhciBtayA9IG1hcmtlcnNbaV0sIG0gPSBtay5maW5kKDApO1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGFydHMubGVuZ3RoOyArK2opIHtcbiAgICAgIHZhciBwID0gcGFydHNbal07XG4gICAgICBpZiAoY21wKHAudG8sIG0uZnJvbSkgPCAwIHx8IGNtcChwLmZyb20sIG0udG8pID4gMCkgeyBjb250aW51ZSB9XG4gICAgICB2YXIgbmV3UGFydHMgPSBbaiwgMV0sIGRmcm9tID0gY21wKHAuZnJvbSwgbS5mcm9tKSwgZHRvID0gY21wKHAudG8sIG0udG8pO1xuICAgICAgaWYgKGRmcm9tIDwgMCB8fCAhbWsuaW5jbHVzaXZlTGVmdCAmJiAhZGZyb20pXG4gICAgICAgIHsgbmV3UGFydHMucHVzaCh7ZnJvbTogcC5mcm9tLCB0bzogbS5mcm9tfSk7IH1cbiAgICAgIGlmIChkdG8gPiAwIHx8ICFtay5pbmNsdXNpdmVSaWdodCAmJiAhZHRvKVxuICAgICAgICB7IG5ld1BhcnRzLnB1c2goe2Zyb206IG0udG8sIHRvOiBwLnRvfSk7IH1cbiAgICAgIHBhcnRzLnNwbGljZS5hcHBseShwYXJ0cywgbmV3UGFydHMpO1xuICAgICAgaiArPSBuZXdQYXJ0cy5sZW5ndGggLSAzO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcGFydHNcbn1cblxuLy8gQ29ubmVjdCBvciBkaXNjb25uZWN0IHNwYW5zIGZyb20gYSBsaW5lLlxuZnVuY3Rpb24gZGV0YWNoTWFya2VkU3BhbnMobGluZSkge1xuICB2YXIgc3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zO1xuICBpZiAoIXNwYW5zKSB7IHJldHVybiB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpXG4gICAgeyBzcGFuc1tpXS5tYXJrZXIuZGV0YWNoTGluZShsaW5lKTsgfVxuICBsaW5lLm1hcmtlZFNwYW5zID0gbnVsbDtcbn1cbmZ1bmN0aW9uIGF0dGFjaE1hcmtlZFNwYW5zKGxpbmUsIHNwYW5zKSB7XG4gIGlmICghc3BhbnMpIHsgcmV0dXJuIH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSlcbiAgICB7IHNwYW5zW2ldLm1hcmtlci5hdHRhY2hMaW5lKGxpbmUpOyB9XG4gIGxpbmUubWFya2VkU3BhbnMgPSBzcGFucztcbn1cblxuLy8gSGVscGVycyB1c2VkIHdoZW4gY29tcHV0aW5nIHdoaWNoIG92ZXJsYXBwaW5nIGNvbGxhcHNlZCBzcGFuXG4vLyBjb3VudHMgYXMgdGhlIGxhcmdlciBvbmUuXG5mdW5jdGlvbiBleHRyYUxlZnQobWFya2VyKSB7IHJldHVybiBtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IC0xIDogMCB9XG5mdW5jdGlvbiBleHRyYVJpZ2h0KG1hcmtlcikgeyByZXR1cm4gbWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gMSA6IDAgfVxuXG4vLyBSZXR1cm5zIGEgbnVtYmVyIGluZGljYXRpbmcgd2hpY2ggb2YgdHdvIG92ZXJsYXBwaW5nIGNvbGxhcHNlZFxuLy8gc3BhbnMgaXMgbGFyZ2VyIChhbmQgdGh1cyBpbmNsdWRlcyB0aGUgb3RoZXIpLiBGYWxscyBiYWNrIHRvXG4vLyBjb21wYXJpbmcgaWRzIHdoZW4gdGhlIHNwYW5zIGNvdmVyIGV4YWN0bHkgdGhlIHNhbWUgcmFuZ2UuXG5mdW5jdGlvbiBjb21wYXJlQ29sbGFwc2VkTWFya2VycyhhLCBiKSB7XG4gIHZhciBsZW5EaWZmID0gYS5saW5lcy5sZW5ndGggLSBiLmxpbmVzLmxlbmd0aDtcbiAgaWYgKGxlbkRpZmYgIT0gMCkgeyByZXR1cm4gbGVuRGlmZiB9XG4gIHZhciBhUG9zID0gYS5maW5kKCksIGJQb3MgPSBiLmZpbmQoKTtcbiAgdmFyIGZyb21DbXAgPSBjbXAoYVBvcy5mcm9tLCBiUG9zLmZyb20pIHx8IGV4dHJhTGVmdChhKSAtIGV4dHJhTGVmdChiKTtcbiAgaWYgKGZyb21DbXApIHsgcmV0dXJuIC1mcm9tQ21wIH1cbiAgdmFyIHRvQ21wID0gY21wKGFQb3MudG8sIGJQb3MudG8pIHx8IGV4dHJhUmlnaHQoYSkgLSBleHRyYVJpZ2h0KGIpO1xuICBpZiAodG9DbXApIHsgcmV0dXJuIHRvQ21wIH1cbiAgcmV0dXJuIGIuaWQgLSBhLmlkXG59XG5cbi8vIEZpbmQgb3V0IHdoZXRoZXIgYSBsaW5lIGVuZHMgb3Igc3RhcnRzIGluIGEgY29sbGFwc2VkIHNwYW4uIElmXG4vLyBzbywgcmV0dXJuIHRoZSBtYXJrZXIgZm9yIHRoYXQgc3Bhbi5cbmZ1bmN0aW9uIGNvbGxhcHNlZFNwYW5BdFNpZGUobGluZSwgc3RhcnQpIHtcbiAgdmFyIHNwcyA9IHNhd0NvbGxhcHNlZFNwYW5zICYmIGxpbmUubWFya2VkU3BhbnMsIGZvdW5kO1xuICBpZiAoc3BzKSB7IGZvciAodmFyIHNwID0gKHZvaWQgMCksIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKSB7XG4gICAgc3AgPSBzcHNbaV07XG4gICAgaWYgKHNwLm1hcmtlci5jb2xsYXBzZWQgJiYgKHN0YXJ0ID8gc3AuZnJvbSA6IHNwLnRvKSA9PSBudWxsICYmXG4gICAgICAgICghZm91bmQgfHwgY29tcGFyZUNvbGxhcHNlZE1hcmtlcnMoZm91bmQsIHNwLm1hcmtlcikgPCAwKSlcbiAgICAgIHsgZm91bmQgPSBzcC5tYXJrZXI7IH1cbiAgfSB9XG4gIHJldHVybiBmb3VuZFxufVxuZnVuY3Rpb24gY29sbGFwc2VkU3BhbkF0U3RhcnQobGluZSkgeyByZXR1cm4gY29sbGFwc2VkU3BhbkF0U2lkZShsaW5lLCB0cnVlKSB9XG5mdW5jdGlvbiBjb2xsYXBzZWRTcGFuQXRFbmQobGluZSkgeyByZXR1cm4gY29sbGFwc2VkU3BhbkF0U2lkZShsaW5lLCBmYWxzZSkgfVxuXG4vLyBUZXN0IHdoZXRoZXIgdGhlcmUgZXhpc3RzIGEgY29sbGFwc2VkIHNwYW4gdGhhdCBwYXJ0aWFsbHlcbi8vIG92ZXJsYXBzIChjb3ZlcnMgdGhlIHN0YXJ0IG9yIGVuZCwgYnV0IG5vdCBib3RoKSBvZiBhIG5ldyBzcGFuLlxuLy8gU3VjaCBvdmVybGFwIGlzIG5vdCBhbGxvd2VkLlxuZnVuY3Rpb24gY29uZmxpY3RpbmdDb2xsYXBzZWRSYW5nZShkb2MsIGxpbmVObyQkMSwgZnJvbSwgdG8sIG1hcmtlcikge1xuICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBsaW5lTm8kJDEpO1xuICB2YXIgc3BzID0gc2F3Q29sbGFwc2VkU3BhbnMgJiYgbGluZS5tYXJrZWRTcGFucztcbiAgaWYgKHNwcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHNwcy5sZW5ndGg7ICsraSkge1xuICAgIHZhciBzcCA9IHNwc1tpXTtcbiAgICBpZiAoIXNwLm1hcmtlci5jb2xsYXBzZWQpIHsgY29udGludWUgfVxuICAgIHZhciBmb3VuZCA9IHNwLm1hcmtlci5maW5kKDApO1xuICAgIHZhciBmcm9tQ21wID0gY21wKGZvdW5kLmZyb20sIGZyb20pIHx8IGV4dHJhTGVmdChzcC5tYXJrZXIpIC0gZXh0cmFMZWZ0KG1hcmtlcik7XG4gICAgdmFyIHRvQ21wID0gY21wKGZvdW5kLnRvLCB0bykgfHwgZXh0cmFSaWdodChzcC5tYXJrZXIpIC0gZXh0cmFSaWdodChtYXJrZXIpO1xuICAgIGlmIChmcm9tQ21wID49IDAgJiYgdG9DbXAgPD0gMCB8fCBmcm9tQ21wIDw9IDAgJiYgdG9DbXAgPj0gMCkgeyBjb250aW51ZSB9XG4gICAgaWYgKGZyb21DbXAgPD0gMCAmJiAoc3AubWFya2VyLmluY2x1c2l2ZVJpZ2h0ICYmIG1hcmtlci5pbmNsdXNpdmVMZWZ0ID8gY21wKGZvdW5kLnRvLCBmcm9tKSA+PSAwIDogY21wKGZvdW5kLnRvLCBmcm9tKSA+IDApIHx8XG4gICAgICAgIGZyb21DbXAgPj0gMCAmJiAoc3AubWFya2VyLmluY2x1c2l2ZVJpZ2h0ICYmIG1hcmtlci5pbmNsdXNpdmVMZWZ0ID8gY21wKGZvdW5kLmZyb20sIHRvKSA8PSAwIDogY21wKGZvdW5kLmZyb20sIHRvKSA8IDApKVxuICAgICAgeyByZXR1cm4gdHJ1ZSB9XG4gIH0gfVxufVxuXG4vLyBBIHZpc3VhbCBsaW5lIGlzIGEgbGluZSBhcyBkcmF3biBvbiB0aGUgc2NyZWVuLiBGb2xkaW5nLCBmb3Jcbi8vIGV4YW1wbGUsIGNhbiBjYXVzZSBtdWx0aXBsZSBsb2dpY2FsIGxpbmVzIHRvIGFwcGVhciBvbiB0aGUgc2FtZVxuLy8gdmlzdWFsIGxpbmUuIFRoaXMgZmluZHMgdGhlIHN0YXJ0IG9mIHRoZSB2aXN1YWwgbGluZSB0aGF0IHRoZVxuLy8gZ2l2ZW4gbGluZSBpcyBwYXJ0IG9mICh1c3VhbGx5IHRoYXQgaXMgdGhlIGxpbmUgaXRzZWxmKS5cbmZ1bmN0aW9uIHZpc3VhbExpbmUobGluZSkge1xuICB2YXIgbWVyZ2VkO1xuICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0U3RhcnQobGluZSkpXG4gICAgeyBsaW5lID0gbWVyZ2VkLmZpbmQoLTEsIHRydWUpLmxpbmU7IH1cbiAgcmV0dXJuIGxpbmVcbn1cblxuZnVuY3Rpb24gdmlzdWFsTGluZUVuZChsaW5lKSB7XG4gIHZhciBtZXJnZWQ7XG4gIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRFbmQobGluZSkpXG4gICAgeyBsaW5lID0gbWVyZ2VkLmZpbmQoMSwgdHJ1ZSkubGluZTsgfVxuICByZXR1cm4gbGluZVxufVxuXG4vLyBSZXR1cm5zIGFuIGFycmF5IG9mIGxvZ2ljYWwgbGluZXMgdGhhdCBjb250aW51ZSB0aGUgdmlzdWFsIGxpbmVcbi8vIHN0YXJ0ZWQgYnkgdGhlIGFyZ3VtZW50LCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG5vIHN1Y2ggbGluZXMuXG5mdW5jdGlvbiB2aXN1YWxMaW5lQ29udGludWVkKGxpbmUpIHtcbiAgdmFyIG1lcmdlZCwgbGluZXM7XG4gIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRFbmQobGluZSkpIHtcbiAgICBsaW5lID0gbWVyZ2VkLmZpbmQoMSwgdHJ1ZSkubGluZVxuICAgIDsobGluZXMgfHwgKGxpbmVzID0gW10pKS5wdXNoKGxpbmUpO1xuICB9XG4gIHJldHVybiBsaW5lc1xufVxuXG4vLyBHZXQgdGhlIGxpbmUgbnVtYmVyIG9mIHRoZSBzdGFydCBvZiB0aGUgdmlzdWFsIGxpbmUgdGhhdCB0aGVcbi8vIGdpdmVuIGxpbmUgbnVtYmVyIGlzIHBhcnQgb2YuXG5mdW5jdGlvbiB2aXN1YWxMaW5lTm8oZG9jLCBsaW5lTikge1xuICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBsaW5lTiksIHZpcyA9IHZpc3VhbExpbmUobGluZSk7XG4gIGlmIChsaW5lID09IHZpcykgeyByZXR1cm4gbGluZU4gfVxuICByZXR1cm4gbGluZU5vKHZpcylcbn1cblxuLy8gR2V0IHRoZSBsaW5lIG51bWJlciBvZiB0aGUgc3RhcnQgb2YgdGhlIG5leHQgdmlzdWFsIGxpbmUgYWZ0ZXJcbi8vIHRoZSBnaXZlbiBsaW5lLlxuZnVuY3Rpb24gdmlzdWFsTGluZUVuZE5vKGRvYywgbGluZU4pIHtcbiAgaWYgKGxpbmVOID4gZG9jLmxhc3RMaW5lKCkpIHsgcmV0dXJuIGxpbmVOIH1cbiAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgbGluZU4pLCBtZXJnZWQ7XG4gIGlmICghbGluZUlzSGlkZGVuKGRvYywgbGluZSkpIHsgcmV0dXJuIGxpbmVOIH1cbiAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSlcbiAgICB7IGxpbmUgPSBtZXJnZWQuZmluZCgxLCB0cnVlKS5saW5lOyB9XG4gIHJldHVybiBsaW5lTm8obGluZSkgKyAxXG59XG5cbi8vIENvbXB1dGUgd2hldGhlciBhIGxpbmUgaXMgaGlkZGVuLiBMaW5lcyBjb3VudCBhcyBoaWRkZW4gd2hlbiB0aGV5XG4vLyBhcmUgcGFydCBvZiBhIHZpc3VhbCBsaW5lIHRoYXQgc3RhcnRzIHdpdGggYW5vdGhlciBsaW5lLCBvciB3aGVuXG4vLyB0aGV5IGFyZSBlbnRpcmVseSBjb3ZlcmVkIGJ5IGNvbGxhcHNlZCwgbm9uLXdpZGdldCBzcGFuLlxuZnVuY3Rpb24gbGluZUlzSGlkZGVuKGRvYywgbGluZSkge1xuICB2YXIgc3BzID0gc2F3Q29sbGFwc2VkU3BhbnMgJiYgbGluZS5tYXJrZWRTcGFucztcbiAgaWYgKHNwcykgeyBmb3IgKHZhciBzcCA9ICh2b2lkIDApLCBpID0gMDsgaSA8IHNwcy5sZW5ndGg7ICsraSkge1xuICAgIHNwID0gc3BzW2ldO1xuICAgIGlmICghc3AubWFya2VyLmNvbGxhcHNlZCkgeyBjb250aW51ZSB9XG4gICAgaWYgKHNwLmZyb20gPT0gbnVsbCkgeyByZXR1cm4gdHJ1ZSB9XG4gICAgaWYgKHNwLm1hcmtlci53aWRnZXROb2RlKSB7IGNvbnRpbnVlIH1cbiAgICBpZiAoc3AuZnJvbSA9PSAwICYmIHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0ICYmIGxpbmVJc0hpZGRlbklubmVyKGRvYywgbGluZSwgc3ApKVxuICAgICAgeyByZXR1cm4gdHJ1ZSB9XG4gIH0gfVxufVxuZnVuY3Rpb24gbGluZUlzSGlkZGVuSW5uZXIoZG9jLCBsaW5lLCBzcGFuKSB7XG4gIGlmIChzcGFuLnRvID09IG51bGwpIHtcbiAgICB2YXIgZW5kID0gc3Bhbi5tYXJrZXIuZmluZCgxLCB0cnVlKTtcbiAgICByZXR1cm4gbGluZUlzSGlkZGVuSW5uZXIoZG9jLCBlbmQubGluZSwgZ2V0TWFya2VkU3BhbkZvcihlbmQubGluZS5tYXJrZWRTcGFucywgc3Bhbi5tYXJrZXIpKVxuICB9XG4gIGlmIChzcGFuLm1hcmtlci5pbmNsdXNpdmVSaWdodCAmJiBzcGFuLnRvID09IGxpbmUudGV4dC5sZW5ndGgpXG4gICAgeyByZXR1cm4gdHJ1ZSB9XG4gIGZvciAodmFyIHNwID0gKHZvaWQgMCksIGkgPSAwOyBpIDwgbGluZS5tYXJrZWRTcGFucy5sZW5ndGg7ICsraSkge1xuICAgIHNwID0gbGluZS5tYXJrZWRTcGFuc1tpXTtcbiAgICBpZiAoc3AubWFya2VyLmNvbGxhcHNlZCAmJiAhc3AubWFya2VyLndpZGdldE5vZGUgJiYgc3AuZnJvbSA9PSBzcGFuLnRvICYmXG4gICAgICAgIChzcC50byA9PSBudWxsIHx8IHNwLnRvICE9IHNwYW4uZnJvbSkgJiZcbiAgICAgICAgKHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0IHx8IHNwYW4ubWFya2VyLmluY2x1c2l2ZVJpZ2h0KSAmJlxuICAgICAgICBsaW5lSXNIaWRkZW5Jbm5lcihkb2MsIGxpbmUsIHNwKSkgeyByZXR1cm4gdHJ1ZSB9XG4gIH1cbn1cblxuLy8gRmluZCB0aGUgaGVpZ2h0IGFib3ZlIHRoZSBnaXZlbiBsaW5lLlxuZnVuY3Rpb24gaGVpZ2h0QXRMaW5lKGxpbmVPYmopIHtcbiAgbGluZU9iaiA9IHZpc3VhbExpbmUobGluZU9iaik7XG5cbiAgdmFyIGggPSAwLCBjaHVuayA9IGxpbmVPYmoucGFyZW50O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNodW5rLmxpbmVzLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGxpbmUgPSBjaHVuay5saW5lc1tpXTtcbiAgICBpZiAobGluZSA9PSBsaW5lT2JqKSB7IGJyZWFrIH1cbiAgICBlbHNlIHsgaCArPSBsaW5lLmhlaWdodDsgfVxuICB9XG4gIGZvciAodmFyIHAgPSBjaHVuay5wYXJlbnQ7IHA7IGNodW5rID0gcCwgcCA9IGNodW5rLnBhcmVudCkge1xuICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IHAuY2hpbGRyZW4ubGVuZ3RoOyArK2kkMSkge1xuICAgICAgdmFyIGN1ciA9IHAuY2hpbGRyZW5baSQxXTtcbiAgICAgIGlmIChjdXIgPT0gY2h1bmspIHsgYnJlYWsgfVxuICAgICAgZWxzZSB7IGggKz0gY3VyLmhlaWdodDsgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gaFxufVxuXG4vLyBDb21wdXRlIHRoZSBjaGFyYWN0ZXIgbGVuZ3RoIG9mIGEgbGluZSwgdGFraW5nIGludG8gYWNjb3VudFxuLy8gY29sbGFwc2VkIHJhbmdlcyAoc2VlIG1hcmtUZXh0KSB0aGF0IG1pZ2h0IGhpZGUgcGFydHMsIGFuZCBqb2luXG4vLyBvdGhlciBsaW5lcyBvbnRvIGl0LlxuZnVuY3Rpb24gbGluZUxlbmd0aChsaW5lKSB7XG4gIGlmIChsaW5lLmhlaWdodCA9PSAwKSB7IHJldHVybiAwIH1cbiAgdmFyIGxlbiA9IGxpbmUudGV4dC5sZW5ndGgsIG1lcmdlZCwgY3VyID0gbGluZTtcbiAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdFN0YXJ0KGN1cikpIHtcbiAgICB2YXIgZm91bmQgPSBtZXJnZWQuZmluZCgwLCB0cnVlKTtcbiAgICBjdXIgPSBmb3VuZC5mcm9tLmxpbmU7XG4gICAgbGVuICs9IGZvdW5kLmZyb20uY2ggLSBmb3VuZC50by5jaDtcbiAgfVxuICBjdXIgPSBsaW5lO1xuICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0RW5kKGN1cikpIHtcbiAgICB2YXIgZm91bmQkMSA9IG1lcmdlZC5maW5kKDAsIHRydWUpO1xuICAgIGxlbiAtPSBjdXIudGV4dC5sZW5ndGggLSBmb3VuZCQxLmZyb20uY2g7XG4gICAgY3VyID0gZm91bmQkMS50by5saW5lO1xuICAgIGxlbiArPSBjdXIudGV4dC5sZW5ndGggLSBmb3VuZCQxLnRvLmNoO1xuICB9XG4gIHJldHVybiBsZW5cbn1cblxuLy8gRmluZCB0aGUgbG9uZ2VzdCBsaW5lIGluIHRoZSBkb2N1bWVudC5cbmZ1bmN0aW9uIGZpbmRNYXhMaW5lKGNtKSB7XG4gIHZhciBkID0gY20uZGlzcGxheSwgZG9jID0gY20uZG9jO1xuICBkLm1heExpbmUgPSBnZXRMaW5lKGRvYywgZG9jLmZpcnN0KTtcbiAgZC5tYXhMaW5lTGVuZ3RoID0gbGluZUxlbmd0aChkLm1heExpbmUpO1xuICBkLm1heExpbmVDaGFuZ2VkID0gdHJ1ZTtcbiAgZG9jLml0ZXIoZnVuY3Rpb24gKGxpbmUpIHtcbiAgICB2YXIgbGVuID0gbGluZUxlbmd0aChsaW5lKTtcbiAgICBpZiAobGVuID4gZC5tYXhMaW5lTGVuZ3RoKSB7XG4gICAgICBkLm1heExpbmVMZW5ndGggPSBsZW47XG4gICAgICBkLm1heExpbmUgPSBsaW5lO1xuICAgIH1cbiAgfSk7XG59XG5cbi8vIEJJREkgSEVMUEVSU1xuXG5mdW5jdGlvbiBpdGVyYXRlQmlkaVNlY3Rpb25zKG9yZGVyLCBmcm9tLCB0bywgZikge1xuICBpZiAoIW9yZGVyKSB7IHJldHVybiBmKGZyb20sIHRvLCBcImx0clwiKSB9XG4gIHZhciBmb3VuZCA9IGZhbHNlO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIHBhcnQgPSBvcmRlcltpXTtcbiAgICBpZiAocGFydC5mcm9tIDwgdG8gJiYgcGFydC50byA+IGZyb20gfHwgZnJvbSA9PSB0byAmJiBwYXJ0LnRvID09IGZyb20pIHtcbiAgICAgIGYoTWF0aC5tYXgocGFydC5mcm9tLCBmcm9tKSwgTWF0aC5taW4ocGFydC50bywgdG8pLCBwYXJ0LmxldmVsID09IDEgPyBcInJ0bFwiIDogXCJsdHJcIik7XG4gICAgICBmb3VuZCA9IHRydWU7XG4gICAgfVxuICB9XG4gIGlmICghZm91bmQpIHsgZihmcm9tLCB0bywgXCJsdHJcIik7IH1cbn1cblxudmFyIGJpZGlPdGhlciA9IG51bGw7XG5mdW5jdGlvbiBnZXRCaWRpUGFydEF0KG9yZGVyLCBjaCwgc3RpY2t5KSB7XG4gIHZhciBmb3VuZDtcbiAgYmlkaU90aGVyID0gbnVsbDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcmRlci5sZW5ndGg7ICsraSkge1xuICAgIHZhciBjdXIgPSBvcmRlcltpXTtcbiAgICBpZiAoY3VyLmZyb20gPCBjaCAmJiBjdXIudG8gPiBjaCkgeyByZXR1cm4gaSB9XG4gICAgaWYgKGN1ci50byA9PSBjaCkge1xuICAgICAgaWYgKGN1ci5mcm9tICE9IGN1ci50byAmJiBzdGlja3kgPT0gXCJiZWZvcmVcIikgeyBmb3VuZCA9IGk7IH1cbiAgICAgIGVsc2UgeyBiaWRpT3RoZXIgPSBpOyB9XG4gICAgfVxuICAgIGlmIChjdXIuZnJvbSA9PSBjaCkge1xuICAgICAgaWYgKGN1ci5mcm9tICE9IGN1ci50byAmJiBzdGlja3kgIT0gXCJiZWZvcmVcIikgeyBmb3VuZCA9IGk7IH1cbiAgICAgIGVsc2UgeyBiaWRpT3RoZXIgPSBpOyB9XG4gICAgfVxuICB9XG4gIHJldHVybiBmb3VuZCAhPSBudWxsID8gZm91bmQgOiBiaWRpT3RoZXJcbn1cblxuLy8gQmlkaXJlY3Rpb25hbCBvcmRlcmluZyBhbGdvcml0aG1cbi8vIFNlZSBodHRwOi8vdW5pY29kZS5vcmcvcmVwb3J0cy90cjkvdHI5LTEzLmh0bWwgZm9yIHRoZSBhbGdvcml0aG1cbi8vIHRoYXQgdGhpcyAocGFydGlhbGx5KSBpbXBsZW1lbnRzLlxuXG4vLyBPbmUtY2hhciBjb2RlcyB1c2VkIGZvciBjaGFyYWN0ZXIgdHlwZXM6XG4vLyBMIChMKTogICBMZWZ0LXRvLVJpZ2h0XG4vLyBSIChSKTogICBSaWdodC10by1MZWZ0XG4vLyByIChBTCk6ICBSaWdodC10by1MZWZ0IEFyYWJpY1xuLy8gMSAoRU4pOiAgRXVyb3BlYW4gTnVtYmVyXG4vLyArIChFUyk6ICBFdXJvcGVhbiBOdW1iZXIgU2VwYXJhdG9yXG4vLyAlIChFVCk6ICBFdXJvcGVhbiBOdW1iZXIgVGVybWluYXRvclxuLy8gbiAoQU4pOiAgQXJhYmljIE51bWJlclxuLy8gLCAoQ1MpOiAgQ29tbW9uIE51bWJlciBTZXBhcmF0b3Jcbi8vIG0gKE5TTSk6IE5vbi1TcGFjaW5nIE1hcmtcbi8vIGIgKEJOKTogIEJvdW5kYXJ5IE5ldXRyYWxcbi8vIHMgKEIpOiAgIFBhcmFncmFwaCBTZXBhcmF0b3Jcbi8vIHQgKFMpOiAgIFNlZ21lbnQgU2VwYXJhdG9yXG4vLyB3IChXUyk6ICBXaGl0ZXNwYWNlXG4vLyBOIChPTik6ICBPdGhlciBOZXV0cmFsc1xuXG4vLyBSZXR1cm5zIG51bGwgaWYgY2hhcmFjdGVycyBhcmUgb3JkZXJlZCBhcyB0aGV5IGFwcGVhclxuLy8gKGxlZnQtdG8tcmlnaHQpLCBvciBhbiBhcnJheSBvZiBzZWN0aW9ucyAoe2Zyb20sIHRvLCBsZXZlbH1cbi8vIG9iamVjdHMpIGluIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IG9jY3VyIHZpc3VhbGx5LlxudmFyIGJpZGlPcmRlcmluZyA9IChmdW5jdGlvbigpIHtcbiAgLy8gQ2hhcmFjdGVyIHR5cGVzIGZvciBjb2RlcG9pbnRzIDAgdG8gMHhmZlxuICB2YXIgbG93VHlwZXMgPSBcImJiYmJiYmJiYnRzdHdzYmJiYmJiYmJiYmJiYmJzc3N0d05OJSUlTk5OTk5OLE4sTjExMTExMTExMTFOTk5OTk5OTExMTExMTExMTExMTExMTExMTExMTExMTExOTk5OTk5MTExMTExMTExMTExMTExMTExMTExMTExMTE5OTk5iYmJiYmJzYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmIsTiUlJSVOTk5OTE5OTk5OJSUxMU5MTk5OMUxOTk5OTkxMTExMTExMTExMTExMTExMTExMTExMTkxMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExOXCI7XG4gIC8vIENoYXJhY3RlciB0eXBlcyBmb3IgY29kZXBvaW50cyAweDYwMCB0byAweDZmOVxuICB2YXIgYXJhYmljVHlwZXMgPSBcIm5ubm5ubk5OciUlcixyTk5tbW1tbW1tbW1tbXJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycm1tbW1tbW1tbW1tbW1tbW1tbW1tbW5ubm5ubm5ubm4lbm5ycnJtcnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJtbW1tbW1tbk5tbW1tbW1ycm1tTm1tbW1ycjExMTExMTExMTFcIjtcbiAgZnVuY3Rpb24gY2hhclR5cGUoY29kZSkge1xuICAgIGlmIChjb2RlIDw9IDB4ZjcpIHsgcmV0dXJuIGxvd1R5cGVzLmNoYXJBdChjb2RlKSB9XG4gICAgZWxzZSBpZiAoMHg1OTAgPD0gY29kZSAmJiBjb2RlIDw9IDB4NWY0KSB7IHJldHVybiBcIlJcIiB9XG4gICAgZWxzZSBpZiAoMHg2MDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4NmY5KSB7IHJldHVybiBhcmFiaWNUeXBlcy5jaGFyQXQoY29kZSAtIDB4NjAwKSB9XG4gICAgZWxzZSBpZiAoMHg2ZWUgPD0gY29kZSAmJiBjb2RlIDw9IDB4OGFjKSB7IHJldHVybiBcInJcIiB9XG4gICAgZWxzZSBpZiAoMHgyMDAwIDw9IGNvZGUgJiYgY29kZSA8PSAweDIwMGIpIHsgcmV0dXJuIFwid1wiIH1cbiAgICBlbHNlIGlmIChjb2RlID09IDB4MjAwYykgeyByZXR1cm4gXCJiXCIgfVxuICAgIGVsc2UgeyByZXR1cm4gXCJMXCIgfVxuICB9XG5cbiAgdmFyIGJpZGlSRSA9IC9bXFx1MDU5MC1cXHUwNWY0XFx1MDYwMC1cXHUwNmZmXFx1MDcwMC1cXHUwOGFjXS87XG4gIHZhciBpc05ldXRyYWwgPSAvW3N0d05dLywgaXNTdHJvbmcgPSAvW0xScl0vLCBjb3VudHNBc0xlZnQgPSAvW0xiMW5dLywgY291bnRzQXNOdW0gPSAvWzFuXS87XG5cbiAgZnVuY3Rpb24gQmlkaVNwYW4obGV2ZWwsIGZyb20sIHRvKSB7XG4gICAgdGhpcy5sZXZlbCA9IGxldmVsO1xuICAgIHRoaXMuZnJvbSA9IGZyb207IHRoaXMudG8gPSB0bztcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbihzdHIsIGRpcmVjdGlvbikge1xuICAgIHZhciBvdXRlclR5cGUgPSBkaXJlY3Rpb24gPT0gXCJsdHJcIiA/IFwiTFwiIDogXCJSXCI7XG5cbiAgICBpZiAoc3RyLmxlbmd0aCA9PSAwIHx8IGRpcmVjdGlvbiA9PSBcImx0clwiICYmICFiaWRpUkUudGVzdChzdHIpKSB7IHJldHVybiBmYWxzZSB9XG4gICAgdmFyIGxlbiA9IHN0ci5sZW5ndGgsIHR5cGVzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcbiAgICAgIHsgdHlwZXMucHVzaChjaGFyVHlwZShzdHIuY2hhckNvZGVBdChpKSkpOyB9XG5cbiAgICAvLyBXMS4gRXhhbWluZSBlYWNoIG5vbi1zcGFjaW5nIG1hcmsgKE5TTSkgaW4gdGhlIGxldmVsIHJ1biwgYW5kXG4gICAgLy8gY2hhbmdlIHRoZSB0eXBlIG9mIHRoZSBOU00gdG8gdGhlIHR5cGUgb2YgdGhlIHByZXZpb3VzXG4gICAgLy8gY2hhcmFjdGVyLiBJZiB0aGUgTlNNIGlzIGF0IHRoZSBzdGFydCBvZiB0aGUgbGV2ZWwgcnVuLCBpdCB3aWxsXG4gICAgLy8gZ2V0IHRoZSB0eXBlIG9mIHNvci5cbiAgICBmb3IgKHZhciBpJDEgPSAwLCBwcmV2ID0gb3V0ZXJUeXBlOyBpJDEgPCBsZW47ICsraSQxKSB7XG4gICAgICB2YXIgdHlwZSA9IHR5cGVzW2kkMV07XG4gICAgICBpZiAodHlwZSA9PSBcIm1cIikgeyB0eXBlc1tpJDFdID0gcHJldjsgfVxuICAgICAgZWxzZSB7IHByZXYgPSB0eXBlOyB9XG4gICAgfVxuXG4gICAgLy8gVzIuIFNlYXJjaCBiYWNrd2FyZHMgZnJvbSBlYWNoIGluc3RhbmNlIG9mIGEgRXVyb3BlYW4gbnVtYmVyXG4gICAgLy8gdW50aWwgdGhlIGZpcnN0IHN0cm9uZyB0eXBlIChSLCBMLCBBTCwgb3Igc29yKSBpcyBmb3VuZC4gSWYgYW5cbiAgICAvLyBBTCBpcyBmb3VuZCwgY2hhbmdlIHRoZSB0eXBlIG9mIHRoZSBFdXJvcGVhbiBudW1iZXIgdG8gQXJhYmljXG4gICAgLy8gbnVtYmVyLlxuICAgIC8vIFczLiBDaGFuZ2UgYWxsIEFMcyB0byBSLlxuICAgIGZvciAodmFyIGkkMiA9IDAsIGN1ciA9IG91dGVyVHlwZTsgaSQyIDwgbGVuOyArK2kkMikge1xuICAgICAgdmFyIHR5cGUkMSA9IHR5cGVzW2kkMl07XG4gICAgICBpZiAodHlwZSQxID09IFwiMVwiICYmIGN1ciA9PSBcInJcIikgeyB0eXBlc1tpJDJdID0gXCJuXCI7IH1cbiAgICAgIGVsc2UgaWYgKGlzU3Ryb25nLnRlc3QodHlwZSQxKSkgeyBjdXIgPSB0eXBlJDE7IGlmICh0eXBlJDEgPT0gXCJyXCIpIHsgdHlwZXNbaSQyXSA9IFwiUlwiOyB9IH1cbiAgICB9XG5cbiAgICAvLyBXNC4gQSBzaW5nbGUgRXVyb3BlYW4gc2VwYXJhdG9yIGJldHdlZW4gdHdvIEV1cm9wZWFuIG51bWJlcnNcbiAgICAvLyBjaGFuZ2VzIHRvIGEgRXVyb3BlYW4gbnVtYmVyLiBBIHNpbmdsZSBjb21tb24gc2VwYXJhdG9yIGJldHdlZW5cbiAgICAvLyB0d28gbnVtYmVycyBvZiB0aGUgc2FtZSB0eXBlIGNoYW5nZXMgdG8gdGhhdCB0eXBlLlxuICAgIGZvciAodmFyIGkkMyA9IDEsIHByZXYkMSA9IHR5cGVzWzBdOyBpJDMgPCBsZW4gLSAxOyArK2kkMykge1xuICAgICAgdmFyIHR5cGUkMiA9IHR5cGVzW2kkM107XG4gICAgICBpZiAodHlwZSQyID09IFwiK1wiICYmIHByZXYkMSA9PSBcIjFcIiAmJiB0eXBlc1tpJDMrMV0gPT0gXCIxXCIpIHsgdHlwZXNbaSQzXSA9IFwiMVwiOyB9XG4gICAgICBlbHNlIGlmICh0eXBlJDIgPT0gXCIsXCIgJiYgcHJldiQxID09IHR5cGVzW2kkMysxXSAmJlxuICAgICAgICAgICAgICAgKHByZXYkMSA9PSBcIjFcIiB8fCBwcmV2JDEgPT0gXCJuXCIpKSB7IHR5cGVzW2kkM10gPSBwcmV2JDE7IH1cbiAgICAgIHByZXYkMSA9IHR5cGUkMjtcbiAgICB9XG5cbiAgICAvLyBXNS4gQSBzZXF1ZW5jZSBvZiBFdXJvcGVhbiB0ZXJtaW5hdG9ycyBhZGphY2VudCB0byBFdXJvcGVhblxuICAgIC8vIG51bWJlcnMgY2hhbmdlcyB0byBhbGwgRXVyb3BlYW4gbnVtYmVycy5cbiAgICAvLyBXNi4gT3RoZXJ3aXNlLCBzZXBhcmF0b3JzIGFuZCB0ZXJtaW5hdG9ycyBjaGFuZ2UgdG8gT3RoZXJcbiAgICAvLyBOZXV0cmFsLlxuICAgIGZvciAodmFyIGkkNCA9IDA7IGkkNCA8IGxlbjsgKytpJDQpIHtcbiAgICAgIHZhciB0eXBlJDMgPSB0eXBlc1tpJDRdO1xuICAgICAgaWYgKHR5cGUkMyA9PSBcIixcIikgeyB0eXBlc1tpJDRdID0gXCJOXCI7IH1cbiAgICAgIGVsc2UgaWYgKHR5cGUkMyA9PSBcIiVcIikge1xuICAgICAgICB2YXIgZW5kID0gKHZvaWQgMCk7XG4gICAgICAgIGZvciAoZW5kID0gaSQ0ICsgMTsgZW5kIDwgbGVuICYmIHR5cGVzW2VuZF0gPT0gXCIlXCI7ICsrZW5kKSB7fVxuICAgICAgICB2YXIgcmVwbGFjZSA9IChpJDQgJiYgdHlwZXNbaSQ0LTFdID09IFwiIVwiKSB8fCAoZW5kIDwgbGVuICYmIHR5cGVzW2VuZF0gPT0gXCIxXCIpID8gXCIxXCIgOiBcIk5cIjtcbiAgICAgICAgZm9yICh2YXIgaiA9IGkkNDsgaiA8IGVuZDsgKytqKSB7IHR5cGVzW2pdID0gcmVwbGFjZTsgfVxuICAgICAgICBpJDQgPSBlbmQgLSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFc3LiBTZWFyY2ggYmFja3dhcmRzIGZyb20gZWFjaCBpbnN0YW5jZSBvZiBhIEV1cm9wZWFuIG51bWJlclxuICAgIC8vIHVudGlsIHRoZSBmaXJzdCBzdHJvbmcgdHlwZSAoUiwgTCwgb3Igc29yKSBpcyBmb3VuZC4gSWYgYW4gTCBpc1xuICAgIC8vIGZvdW5kLCB0aGVuIGNoYW5nZSB0aGUgdHlwZSBvZiB0aGUgRXVyb3BlYW4gbnVtYmVyIHRvIEwuXG4gICAgZm9yICh2YXIgaSQ1ID0gMCwgY3VyJDEgPSBvdXRlclR5cGU7IGkkNSA8IGxlbjsgKytpJDUpIHtcbiAgICAgIHZhciB0eXBlJDQgPSB0eXBlc1tpJDVdO1xuICAgICAgaWYgKGN1ciQxID09IFwiTFwiICYmIHR5cGUkNCA9PSBcIjFcIikgeyB0eXBlc1tpJDVdID0gXCJMXCI7IH1cbiAgICAgIGVsc2UgaWYgKGlzU3Ryb25nLnRlc3QodHlwZSQ0KSkgeyBjdXIkMSA9IHR5cGUkNDsgfVxuICAgIH1cblxuICAgIC8vIE4xLiBBIHNlcXVlbmNlIG9mIG5ldXRyYWxzIHRha2VzIHRoZSBkaXJlY3Rpb24gb2YgdGhlXG4gICAgLy8gc3Vycm91bmRpbmcgc3Ryb25nIHRleHQgaWYgdGhlIHRleHQgb24gYm90aCBzaWRlcyBoYXMgdGhlIHNhbWVcbiAgICAvLyBkaXJlY3Rpb24uIEV1cm9wZWFuIGFuZCBBcmFiaWMgbnVtYmVycyBhY3QgYXMgaWYgdGhleSB3ZXJlIFIgaW5cbiAgICAvLyB0ZXJtcyBvZiB0aGVpciBpbmZsdWVuY2Ugb24gbmV1dHJhbHMuIFN0YXJ0LW9mLWxldmVsLXJ1biAoc29yKVxuICAgIC8vIGFuZCBlbmQtb2YtbGV2ZWwtcnVuIChlb3IpIGFyZSB1c2VkIGF0IGxldmVsIHJ1biBib3VuZGFyaWVzLlxuICAgIC8vIE4yLiBBbnkgcmVtYWluaW5nIG5ldXRyYWxzIHRha2UgdGhlIGVtYmVkZGluZyBkaXJlY3Rpb24uXG4gICAgZm9yICh2YXIgaSQ2ID0gMDsgaSQ2IDwgbGVuOyArK2kkNikge1xuICAgICAgaWYgKGlzTmV1dHJhbC50ZXN0KHR5cGVzW2kkNl0pKSB7XG4gICAgICAgIHZhciBlbmQkMSA9ICh2b2lkIDApO1xuICAgICAgICBmb3IgKGVuZCQxID0gaSQ2ICsgMTsgZW5kJDEgPCBsZW4gJiYgaXNOZXV0cmFsLnRlc3QodHlwZXNbZW5kJDFdKTsgKytlbmQkMSkge31cbiAgICAgICAgdmFyIGJlZm9yZSA9IChpJDYgPyB0eXBlc1tpJDYtMV0gOiBvdXRlclR5cGUpID09IFwiTFwiO1xuICAgICAgICB2YXIgYWZ0ZXIgPSAoZW5kJDEgPCBsZW4gPyB0eXBlc1tlbmQkMV0gOiBvdXRlclR5cGUpID09IFwiTFwiO1xuICAgICAgICB2YXIgcmVwbGFjZSQxID0gYmVmb3JlID09IGFmdGVyID8gKGJlZm9yZSA/IFwiTFwiIDogXCJSXCIpIDogb3V0ZXJUeXBlO1xuICAgICAgICBmb3IgKHZhciBqJDEgPSBpJDY7IGokMSA8IGVuZCQxOyArK2okMSkgeyB0eXBlc1tqJDFdID0gcmVwbGFjZSQxOyB9XG4gICAgICAgIGkkNiA9IGVuZCQxIC0gMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBIZXJlIHdlIGRlcGFydCBmcm9tIHRoZSBkb2N1bWVudGVkIGFsZ29yaXRobSwgaW4gb3JkZXIgdG8gYXZvaWRcbiAgICAvLyBidWlsZGluZyB1cCBhbiBhY3R1YWwgbGV2ZWxzIGFycmF5LiBTaW5jZSB0aGVyZSBhcmUgb25seSB0aHJlZVxuICAgIC8vIGxldmVscyAoMCwgMSwgMikgaW4gYW4gaW1wbGVtZW50YXRpb24gdGhhdCBkb2Vzbid0IHRha2VcbiAgICAvLyBleHBsaWNpdCBlbWJlZGRpbmcgaW50byBhY2NvdW50LCB3ZSBjYW4gYnVpbGQgdXAgdGhlIG9yZGVyIG9uXG4gICAgLy8gdGhlIGZseSwgd2l0aG91dCBmb2xsb3dpbmcgdGhlIGxldmVsLWJhc2VkIGFsZ29yaXRobS5cbiAgICB2YXIgb3JkZXIgPSBbXSwgbTtcbiAgICBmb3IgKHZhciBpJDcgPSAwOyBpJDcgPCBsZW47KSB7XG4gICAgICBpZiAoY291bnRzQXNMZWZ0LnRlc3QodHlwZXNbaSQ3XSkpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gaSQ3O1xuICAgICAgICBmb3IgKCsraSQ3OyBpJDcgPCBsZW4gJiYgY291bnRzQXNMZWZ0LnRlc3QodHlwZXNbaSQ3XSk7ICsraSQ3KSB7fVxuICAgICAgICBvcmRlci5wdXNoKG5ldyBCaWRpU3BhbigwLCBzdGFydCwgaSQ3KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcG9zID0gaSQ3LCBhdCA9IG9yZGVyLmxlbmd0aDtcbiAgICAgICAgZm9yICgrK2kkNzsgaSQ3IDwgbGVuICYmIHR5cGVzW2kkN10gIT0gXCJMXCI7ICsraSQ3KSB7fVxuICAgICAgICBmb3IgKHZhciBqJDIgPSBwb3M7IGokMiA8IGkkNzspIHtcbiAgICAgICAgICBpZiAoY291bnRzQXNOdW0udGVzdCh0eXBlc1tqJDJdKSkge1xuICAgICAgICAgICAgaWYgKHBvcyA8IGokMikgeyBvcmRlci5zcGxpY2UoYXQsIDAsIG5ldyBCaWRpU3BhbigxLCBwb3MsIGokMikpOyB9XG4gICAgICAgICAgICB2YXIgbnN0YXJ0ID0gaiQyO1xuICAgICAgICAgICAgZm9yICgrK2okMjsgaiQyIDwgaSQ3ICYmIGNvdW50c0FzTnVtLnRlc3QodHlwZXNbaiQyXSk7ICsraiQyKSB7fVxuICAgICAgICAgICAgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMiwgbnN0YXJ0LCBqJDIpKTtcbiAgICAgICAgICAgIHBvcyA9IGokMjtcbiAgICAgICAgICB9IGVsc2UgeyArK2okMjsgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwb3MgPCBpJDcpIHsgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMSwgcG9zLCBpJDcpKTsgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3JkZXJbMF0ubGV2ZWwgPT0gMSAmJiAobSA9IHN0ci5tYXRjaCgvXlxccysvKSkpIHtcbiAgICAgIG9yZGVyWzBdLmZyb20gPSBtWzBdLmxlbmd0aDtcbiAgICAgIG9yZGVyLnVuc2hpZnQobmV3IEJpZGlTcGFuKDAsIDAsIG1bMF0ubGVuZ3RoKSk7XG4gICAgfVxuICAgIGlmIChsc3Qob3JkZXIpLmxldmVsID09IDEgJiYgKG0gPSBzdHIubWF0Y2goL1xccyskLykpKSB7XG4gICAgICBsc3Qob3JkZXIpLnRvIC09IG1bMF0ubGVuZ3RoO1xuICAgICAgb3JkZXIucHVzaChuZXcgQmlkaVNwYW4oMCwgbGVuIC0gbVswXS5sZW5ndGgsIGxlbikpO1xuICAgIH1cblxuICAgIHJldHVybiBkaXJlY3Rpb24gPT0gXCJydGxcIiA/IG9yZGVyLnJldmVyc2UoKSA6IG9yZGVyXG4gIH1cbn0pKCk7XG5cbi8vIEdldCB0aGUgYmlkaSBvcmRlcmluZyBmb3IgdGhlIGdpdmVuIGxpbmUgKGFuZCBjYWNoZSBpdCkuIFJldHVybnNcbi8vIGZhbHNlIGZvciBsaW5lcyB0aGF0IGFyZSBmdWxseSBsZWZ0LXRvLXJpZ2h0LCBhbmQgYW4gYXJyYXkgb2Zcbi8vIEJpZGlTcGFuIG9iamVjdHMgb3RoZXJ3aXNlLlxuZnVuY3Rpb24gZ2V0T3JkZXIobGluZSwgZGlyZWN0aW9uKSB7XG4gIHZhciBvcmRlciA9IGxpbmUub3JkZXI7XG4gIGlmIChvcmRlciA9PSBudWxsKSB7IG9yZGVyID0gbGluZS5vcmRlciA9IGJpZGlPcmRlcmluZyhsaW5lLnRleHQsIGRpcmVjdGlvbik7IH1cbiAgcmV0dXJuIG9yZGVyXG59XG5cbmZ1bmN0aW9uIG1vdmVDaGFyTG9naWNhbGx5KGxpbmUsIGNoLCBkaXIpIHtcbiAgdmFyIHRhcmdldCA9IHNraXBFeHRlbmRpbmdDaGFycyhsaW5lLnRleHQsIGNoICsgZGlyLCBkaXIpO1xuICByZXR1cm4gdGFyZ2V0IDwgMCB8fCB0YXJnZXQgPiBsaW5lLnRleHQubGVuZ3RoID8gbnVsbCA6IHRhcmdldFxufVxuXG5mdW5jdGlvbiBtb3ZlTG9naWNhbGx5KGxpbmUsIHN0YXJ0LCBkaXIpIHtcbiAgdmFyIGNoID0gbW92ZUNoYXJMb2dpY2FsbHkobGluZSwgc3RhcnQuY2gsIGRpcik7XG4gIHJldHVybiBjaCA9PSBudWxsID8gbnVsbCA6IG5ldyBQb3Moc3RhcnQubGluZSwgY2gsIGRpciA8IDAgPyBcImFmdGVyXCIgOiBcImJlZm9yZVwiKVxufVxuXG5mdW5jdGlvbiBlbmRPZkxpbmUodmlzdWFsbHksIGNtLCBsaW5lT2JqLCBsaW5lTm8sIGRpcikge1xuICBpZiAodmlzdWFsbHkpIHtcbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lT2JqLCBjbS5kb2MuZGlyZWN0aW9uKTtcbiAgICBpZiAob3JkZXIpIHtcbiAgICAgIHZhciBwYXJ0ID0gZGlyIDwgMCA/IGxzdChvcmRlcikgOiBvcmRlclswXTtcbiAgICAgIHZhciBtb3ZlSW5TdG9yYWdlT3JkZXIgPSAoZGlyIDwgMCkgPT0gKHBhcnQubGV2ZWwgPT0gMSk7XG4gICAgICB2YXIgc3RpY2t5ID0gbW92ZUluU3RvcmFnZU9yZGVyID8gXCJhZnRlclwiIDogXCJiZWZvcmVcIjtcbiAgICAgIHZhciBjaDtcbiAgICAgIC8vIFdpdGggYSB3cmFwcGVkIHJ0bCBjaHVuayAocG9zc2libHkgc3Bhbm5pbmcgbXVsdGlwbGUgYmlkaSBwYXJ0cyksXG4gICAgICAvLyBpdCBjb3VsZCBiZSB0aGF0IHRoZSBsYXN0IGJpZGkgcGFydCBpcyBub3Qgb24gdGhlIGxhc3QgdmlzdWFsIGxpbmUsXG4gICAgICAvLyBzaW5jZSB2aXN1YWwgbGluZXMgY29udGFpbiBjb250ZW50IG9yZGVyLWNvbnNlY3V0aXZlIGNodW5rcy5cbiAgICAgIC8vIFRodXMsIGluIHJ0bCwgd2UgYXJlIGxvb2tpbmcgZm9yIHRoZSBmaXJzdCAoY29udGVudC1vcmRlcikgY2hhcmFjdGVyXG4gICAgICAvLyBpbiB0aGUgcnRsIGNodW5rIHRoYXQgaXMgb24gdGhlIGxhc3QgbGluZSAodGhhdCBpcywgdGhlIHNhbWUgbGluZVxuICAgICAgLy8gYXMgdGhlIGxhc3QgKGNvbnRlbnQtb3JkZXIpIGNoYXJhY3RlcikuXG4gICAgICBpZiAocGFydC5sZXZlbCA+IDApIHtcbiAgICAgICAgdmFyIHByZXAgPSBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmVPYmopO1xuICAgICAgICBjaCA9IGRpciA8IDAgPyBsaW5lT2JqLnRleHQubGVuZ3RoIC0gMSA6IDA7XG4gICAgICAgIHZhciB0YXJnZXRUb3AgPSBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwLCBjaCkudG9wO1xuICAgICAgICBjaCA9IGZpbmRGaXJzdChmdW5jdGlvbiAoY2gpIHsgcmV0dXJuIG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXAsIGNoKS50b3AgPT0gdGFyZ2V0VG9wOyB9LCAoZGlyIDwgMCkgPT0gKHBhcnQubGV2ZWwgPT0gMSkgPyBwYXJ0LmZyb20gOiBwYXJ0LnRvIC0gMSwgY2gpO1xuICAgICAgICBpZiAoc3RpY2t5ID09IFwiYmVmb3JlXCIpIHsgY2ggPSBtb3ZlQ2hhckxvZ2ljYWxseShsaW5lT2JqLCBjaCwgMSk7IH1cbiAgICAgIH0gZWxzZSB7IGNoID0gZGlyIDwgMCA/IHBhcnQudG8gOiBwYXJ0LmZyb207IH1cbiAgICAgIHJldHVybiBuZXcgUG9zKGxpbmVObywgY2gsIHN0aWNreSlcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG5ldyBQb3MobGluZU5vLCBkaXIgPCAwID8gbGluZU9iai50ZXh0Lmxlbmd0aCA6IDAsIGRpciA8IDAgPyBcImJlZm9yZVwiIDogXCJhZnRlclwiKVxufVxuXG5mdW5jdGlvbiBtb3ZlVmlzdWFsbHkoY20sIGxpbmUsIHN0YXJ0LCBkaXIpIHtcbiAgdmFyIGJpZGkgPSBnZXRPcmRlcihsaW5lLCBjbS5kb2MuZGlyZWN0aW9uKTtcbiAgaWYgKCFiaWRpKSB7IHJldHVybiBtb3ZlTG9naWNhbGx5KGxpbmUsIHN0YXJ0LCBkaXIpIH1cbiAgaWYgKHN0YXJ0LmNoID49IGxpbmUudGV4dC5sZW5ndGgpIHtcbiAgICBzdGFydC5jaCA9IGxpbmUudGV4dC5sZW5ndGg7XG4gICAgc3RhcnQuc3RpY2t5ID0gXCJiZWZvcmVcIjtcbiAgfSBlbHNlIGlmIChzdGFydC5jaCA8PSAwKSB7XG4gICAgc3RhcnQuY2ggPSAwO1xuICAgIHN0YXJ0LnN0aWNreSA9IFwiYWZ0ZXJcIjtcbiAgfVxuICB2YXIgcGFydFBvcyA9IGdldEJpZGlQYXJ0QXQoYmlkaSwgc3RhcnQuY2gsIHN0YXJ0LnN0aWNreSksIHBhcnQgPSBiaWRpW3BhcnRQb3NdO1xuICBpZiAoY20uZG9jLmRpcmVjdGlvbiA9PSBcImx0clwiICYmIHBhcnQubGV2ZWwgJSAyID09IDAgJiYgKGRpciA+IDAgPyBwYXJ0LnRvID4gc3RhcnQuY2ggOiBwYXJ0LmZyb20gPCBzdGFydC5jaCkpIHtcbiAgICAvLyBDYXNlIDE6IFdlIG1vdmUgd2l0aGluIGFuIGx0ciBwYXJ0IGluIGFuIGx0ciBlZGl0b3IuIEV2ZW4gd2l0aCB3cmFwcGVkIGxpbmVzLFxuICAgIC8vIG5vdGhpbmcgaW50ZXJlc3RpbmcgaGFwcGVucy5cbiAgICByZXR1cm4gbW92ZUxvZ2ljYWxseShsaW5lLCBzdGFydCwgZGlyKVxuICB9XG5cbiAgdmFyIG12ID0gZnVuY3Rpb24gKHBvcywgZGlyKSB7IHJldHVybiBtb3ZlQ2hhckxvZ2ljYWxseShsaW5lLCBwb3MgaW5zdGFuY2VvZiBQb3MgPyBwb3MuY2ggOiBwb3MsIGRpcik7IH07XG4gIHZhciBwcmVwO1xuICB2YXIgZ2V0V3JhcHBlZExpbmVFeHRlbnQgPSBmdW5jdGlvbiAoY2gpIHtcbiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7IHJldHVybiB7YmVnaW46IDAsIGVuZDogbGluZS50ZXh0Lmxlbmd0aH0gfVxuICAgIHByZXAgPSBwcmVwIHx8IHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZSk7XG4gICAgcmV0dXJuIHdyYXBwZWRMaW5lRXh0ZW50Q2hhcihjbSwgbGluZSwgcHJlcCwgY2gpXG4gIH07XG4gIHZhciB3cmFwcGVkTGluZUV4dGVudCA9IGdldFdyYXBwZWRMaW5lRXh0ZW50KHN0YXJ0LnN0aWNreSA9PSBcImJlZm9yZVwiID8gbXYoc3RhcnQsIC0xKSA6IHN0YXJ0LmNoKTtcblxuICBpZiAoY20uZG9jLmRpcmVjdGlvbiA9PSBcInJ0bFwiIHx8IHBhcnQubGV2ZWwgPT0gMSkge1xuICAgIHZhciBtb3ZlSW5TdG9yYWdlT3JkZXIgPSAocGFydC5sZXZlbCA9PSAxKSA9PSAoZGlyIDwgMCk7XG4gICAgdmFyIGNoID0gbXYoc3RhcnQsIG1vdmVJblN0b3JhZ2VPcmRlciA/IDEgOiAtMSk7XG4gICAgaWYgKGNoICE9IG51bGwgJiYgKCFtb3ZlSW5TdG9yYWdlT3JkZXIgPyBjaCA+PSBwYXJ0LmZyb20gJiYgY2ggPj0gd3JhcHBlZExpbmVFeHRlbnQuYmVnaW4gOiBjaCA8PSBwYXJ0LnRvICYmIGNoIDw9IHdyYXBwZWRMaW5lRXh0ZW50LmVuZCkpIHtcbiAgICAgIC8vIENhc2UgMjogV2UgbW92ZSB3aXRoaW4gYW4gcnRsIHBhcnQgb3IgaW4gYW4gcnRsIGVkaXRvciBvbiB0aGUgc2FtZSB2aXN1YWwgbGluZVxuICAgICAgdmFyIHN0aWNreSA9IG1vdmVJblN0b3JhZ2VPcmRlciA/IFwiYmVmb3JlXCIgOiBcImFmdGVyXCI7XG4gICAgICByZXR1cm4gbmV3IFBvcyhzdGFydC5saW5lLCBjaCwgc3RpY2t5KVxuICAgIH1cbiAgfVxuXG4gIC8vIENhc2UgMzogQ291bGQgbm90IG1vdmUgd2l0aGluIHRoaXMgYmlkaSBwYXJ0IGluIHRoaXMgdmlzdWFsIGxpbmUsIHNvIGxlYXZlXG4gIC8vIHRoZSBjdXJyZW50IGJpZGkgcGFydFxuXG4gIHZhciBzZWFyY2hJblZpc3VhbExpbmUgPSBmdW5jdGlvbiAocGFydFBvcywgZGlyLCB3cmFwcGVkTGluZUV4dGVudCkge1xuICAgIHZhciBnZXRSZXMgPSBmdW5jdGlvbiAoY2gsIG1vdmVJblN0b3JhZ2VPcmRlcikgeyByZXR1cm4gbW92ZUluU3RvcmFnZU9yZGVyXG4gICAgICA/IG5ldyBQb3Moc3RhcnQubGluZSwgbXYoY2gsIDEpLCBcImJlZm9yZVwiKVxuICAgICAgOiBuZXcgUG9zKHN0YXJ0LmxpbmUsIGNoLCBcImFmdGVyXCIpOyB9O1xuXG4gICAgZm9yICg7IHBhcnRQb3MgPj0gMCAmJiBwYXJ0UG9zIDwgYmlkaS5sZW5ndGg7IHBhcnRQb3MgKz0gZGlyKSB7XG4gICAgICB2YXIgcGFydCA9IGJpZGlbcGFydFBvc107XG4gICAgICB2YXIgbW92ZUluU3RvcmFnZU9yZGVyID0gKGRpciA+IDApID09IChwYXJ0LmxldmVsICE9IDEpO1xuICAgICAgdmFyIGNoID0gbW92ZUluU3RvcmFnZU9yZGVyID8gd3JhcHBlZExpbmVFeHRlbnQuYmVnaW4gOiBtdih3cmFwcGVkTGluZUV4dGVudC5lbmQsIC0xKTtcbiAgICAgIGlmIChwYXJ0LmZyb20gPD0gY2ggJiYgY2ggPCBwYXJ0LnRvKSB7IHJldHVybiBnZXRSZXMoY2gsIG1vdmVJblN0b3JhZ2VPcmRlcikgfVxuICAgICAgY2ggPSBtb3ZlSW5TdG9yYWdlT3JkZXIgPyBwYXJ0LmZyb20gOiBtdihwYXJ0LnRvLCAtMSk7XG4gICAgICBpZiAod3JhcHBlZExpbmVFeHRlbnQuYmVnaW4gPD0gY2ggJiYgY2ggPCB3cmFwcGVkTGluZUV4dGVudC5lbmQpIHsgcmV0dXJuIGdldFJlcyhjaCwgbW92ZUluU3RvcmFnZU9yZGVyKSB9XG4gICAgfVxuICB9O1xuXG4gIC8vIENhc2UgM2E6IExvb2sgZm9yIG90aGVyIGJpZGkgcGFydHMgb24gdGhlIHNhbWUgdmlzdWFsIGxpbmVcbiAgdmFyIHJlcyA9IHNlYXJjaEluVmlzdWFsTGluZShwYXJ0UG9zICsgZGlyLCBkaXIsIHdyYXBwZWRMaW5lRXh0ZW50KTtcbiAgaWYgKHJlcykgeyByZXR1cm4gcmVzIH1cblxuICAvLyBDYXNlIDNiOiBMb29rIGZvciBvdGhlciBiaWRpIHBhcnRzIG9uIHRoZSBuZXh0IHZpc3VhbCBsaW5lXG4gIHZhciBuZXh0Q2ggPSBkaXIgPiAwID8gd3JhcHBlZExpbmVFeHRlbnQuZW5kIDogbXYod3JhcHBlZExpbmVFeHRlbnQuYmVnaW4sIC0xKTtcbiAgaWYgKG5leHRDaCAhPSBudWxsICYmICEoZGlyID4gMCAmJiBuZXh0Q2ggPT0gbGluZS50ZXh0Lmxlbmd0aCkpIHtcbiAgICByZXMgPSBzZWFyY2hJblZpc3VhbExpbmUoZGlyID4gMCA/IDAgOiBiaWRpLmxlbmd0aCAtIDEsIGRpciwgZ2V0V3JhcHBlZExpbmVFeHRlbnQobmV4dENoKSk7XG4gICAgaWYgKHJlcykgeyByZXR1cm4gcmVzIH1cbiAgfVxuXG4gIC8vIENhc2UgNDogTm93aGVyZSB0byBtb3ZlXG4gIHJldHVybiBudWxsXG59XG5cbi8vIEVWRU5UIEhBTkRMSU5HXG5cbi8vIExpZ2h0d2VpZ2h0IGV2ZW50IGZyYW1ld29yay4gb24vb2ZmIGFsc28gd29yayBvbiBET00gbm9kZXMsXG4vLyByZWdpc3RlcmluZyBuYXRpdmUgRE9NIGhhbmRsZXJzLlxuXG52YXIgbm9IYW5kbGVycyA9IFtdO1xuXG52YXIgb24gPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlLCBmKSB7XG4gIGlmIChlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIpIHtcbiAgICBlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZiwgZmFsc2UpO1xuICB9IGVsc2UgaWYgKGVtaXR0ZXIuYXR0YWNoRXZlbnQpIHtcbiAgICBlbWl0dGVyLmF0dGFjaEV2ZW50KFwib25cIiArIHR5cGUsIGYpO1xuICB9IGVsc2Uge1xuICAgIHZhciBtYXAkJDEgPSBlbWl0dGVyLl9oYW5kbGVycyB8fCAoZW1pdHRlci5faGFuZGxlcnMgPSB7fSk7XG4gICAgbWFwJCQxW3R5cGVdID0gKG1hcCQkMVt0eXBlXSB8fCBub0hhbmRsZXJzKS5jb25jYXQoZik7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUpIHtcbiAgcmV0dXJuIGVtaXR0ZXIuX2hhbmRsZXJzICYmIGVtaXR0ZXIuX2hhbmRsZXJzW3R5cGVdIHx8IG5vSGFuZGxlcnNcbn1cblxuZnVuY3Rpb24gb2ZmKGVtaXR0ZXIsIHR5cGUsIGYpIHtcbiAgaWYgKGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcikge1xuICAgIGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmLCBmYWxzZSk7XG4gIH0gZWxzZSBpZiAoZW1pdHRlci5kZXRhY2hFdmVudCkge1xuICAgIGVtaXR0ZXIuZGV0YWNoRXZlbnQoXCJvblwiICsgdHlwZSwgZik7XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1hcCQkMSA9IGVtaXR0ZXIuX2hhbmRsZXJzLCBhcnIgPSBtYXAkJDEgJiYgbWFwJCQxW3R5cGVdO1xuICAgIGlmIChhcnIpIHtcbiAgICAgIHZhciBpbmRleCA9IGluZGV4T2YoYXJyLCBmKTtcbiAgICAgIGlmIChpbmRleCA+IC0xKVxuICAgICAgICB7IG1hcCQkMVt0eXBlXSA9IGFyci5zbGljZSgwLCBpbmRleCkuY29uY2F0KGFyci5zbGljZShpbmRleCArIDEpKTsgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBzaWduYWwoZW1pdHRlciwgdHlwZSAvKiwgdmFsdWVzLi4uKi8pIHtcbiAgdmFyIGhhbmRsZXJzID0gZ2V0SGFuZGxlcnMoZW1pdHRlciwgdHlwZSk7XG4gIGlmICghaGFuZGxlcnMubGVuZ3RoKSB7IHJldHVybiB9XG4gIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBoYW5kbGVycy5sZW5ndGg7ICsraSkgeyBoYW5kbGVyc1tpXS5hcHBseShudWxsLCBhcmdzKTsgfVxufVxuXG4vLyBUaGUgRE9NIGV2ZW50cyB0aGF0IENvZGVNaXJyb3IgaGFuZGxlcyBjYW4gYmUgb3ZlcnJpZGRlbiBieVxuLy8gcmVnaXN0ZXJpbmcgYSAobm9uLURPTSkgaGFuZGxlciBvbiB0aGUgZWRpdG9yIGZvciB0aGUgZXZlbnQgbmFtZSxcbi8vIGFuZCBwcmV2ZW50RGVmYXVsdC1pbmcgdGhlIGV2ZW50IGluIHRoYXQgaGFuZGxlci5cbmZ1bmN0aW9uIHNpZ25hbERPTUV2ZW50KGNtLCBlLCBvdmVycmlkZSkge1xuICBpZiAodHlwZW9mIGUgPT0gXCJzdHJpbmdcIilcbiAgICB7IGUgPSB7dHlwZTogZSwgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkgeyB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOyB9fTsgfVxuICBzaWduYWwoY20sIG92ZXJyaWRlIHx8IGUudHlwZSwgY20sIGUpO1xuICByZXR1cm4gZV9kZWZhdWx0UHJldmVudGVkKGUpIHx8IGUuY29kZW1pcnJvcklnbm9yZVxufVxuXG5mdW5jdGlvbiBzaWduYWxDdXJzb3JBY3Rpdml0eShjbSkge1xuICB2YXIgYXJyID0gY20uX2hhbmRsZXJzICYmIGNtLl9oYW5kbGVycy5jdXJzb3JBY3Rpdml0eTtcbiAgaWYgKCFhcnIpIHsgcmV0dXJuIH1cbiAgdmFyIHNldCA9IGNtLmN1ck9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMgfHwgKGNtLmN1ck9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMgPSBbXSk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgKytpKSB7IGlmIChpbmRleE9mKHNldCwgYXJyW2ldKSA9PSAtMSlcbiAgICB7IHNldC5wdXNoKGFycltpXSk7IH0gfVxufVxuXG5mdW5jdGlvbiBoYXNIYW5kbGVyKGVtaXR0ZXIsIHR5cGUpIHtcbiAgcmV0dXJuIGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUpLmxlbmd0aCA+IDBcbn1cblxuLy8gQWRkIG9uIGFuZCBvZmYgbWV0aG9kcyB0byBhIGNvbnN0cnVjdG9yJ3MgcHJvdG90eXBlLCB0byBtYWtlXG4vLyByZWdpc3RlcmluZyBldmVudHMgb24gc3VjaCBvYmplY3RzIG1vcmUgY29udmVuaWVudC5cbmZ1bmN0aW9uIGV2ZW50TWl4aW4oY3Rvcikge1xuICBjdG9yLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKHR5cGUsIGYpIHtvbih0aGlzLCB0eXBlLCBmKTt9O1xuICBjdG9yLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbih0eXBlLCBmKSB7b2ZmKHRoaXMsIHR5cGUsIGYpO307XG59XG5cbi8vIER1ZSB0byB0aGUgZmFjdCB0aGF0IHdlIHN0aWxsIHN1cHBvcnQganVyYXNzaWMgSUUgdmVyc2lvbnMsIHNvbWVcbi8vIGNvbXBhdGliaWxpdHkgd3JhcHBlcnMgYXJlIG5lZWRlZC5cblxuZnVuY3Rpb24gZV9wcmV2ZW50RGVmYXVsdChlKSB7XG4gIGlmIChlLnByZXZlbnREZWZhdWx0KSB7IGUucHJldmVudERlZmF1bHQoKTsgfVxuICBlbHNlIHsgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOyB9XG59XG5mdW5jdGlvbiBlX3N0b3BQcm9wYWdhdGlvbihlKSB7XG4gIGlmIChlLnN0b3BQcm9wYWdhdGlvbikgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyB9XG4gIGVsc2UgeyBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7IH1cbn1cbmZ1bmN0aW9uIGVfZGVmYXVsdFByZXZlbnRlZChlKSB7XG4gIHJldHVybiBlLmRlZmF1bHRQcmV2ZW50ZWQgIT0gbnVsbCA/IGUuZGVmYXVsdFByZXZlbnRlZCA6IGUucmV0dXJuVmFsdWUgPT0gZmFsc2Vcbn1cbmZ1bmN0aW9uIGVfc3RvcChlKSB7ZV9wcmV2ZW50RGVmYXVsdChlKTsgZV9zdG9wUHJvcGFnYXRpb24oZSk7fVxuXG5mdW5jdGlvbiBlX3RhcmdldChlKSB7cmV0dXJuIGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudH1cbmZ1bmN0aW9uIGVfYnV0dG9uKGUpIHtcbiAgdmFyIGIgPSBlLndoaWNoO1xuICBpZiAoYiA9PSBudWxsKSB7XG4gICAgaWYgKGUuYnV0dG9uICYgMSkgeyBiID0gMTsgfVxuICAgIGVsc2UgaWYgKGUuYnV0dG9uICYgMikgeyBiID0gMzsgfVxuICAgIGVsc2UgaWYgKGUuYnV0dG9uICYgNCkgeyBiID0gMjsgfVxuICB9XG4gIGlmIChtYWMgJiYgZS5jdHJsS2V5ICYmIGIgPT0gMSkgeyBiID0gMzsgfVxuICByZXR1cm4gYlxufVxuXG4vLyBEZXRlY3QgZHJhZy1hbmQtZHJvcFxudmFyIGRyYWdBbmREcm9wID0gZnVuY3Rpb24oKSB7XG4gIC8vIFRoZXJlIGlzICpzb21lKiBraW5kIG9mIGRyYWctYW5kLWRyb3Agc3VwcG9ydCBpbiBJRTYtOCwgYnV0IElcbiAgLy8gY291bGRuJ3QgZ2V0IGl0IHRvIHdvcmsgeWV0LlxuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIHsgcmV0dXJuIGZhbHNlIH1cbiAgdmFyIGRpdiA9IGVsdCgnZGl2Jyk7XG4gIHJldHVybiBcImRyYWdnYWJsZVwiIGluIGRpdiB8fCBcImRyYWdEcm9wXCIgaW4gZGl2XG59KCk7XG5cbnZhciB6d3NwU3VwcG9ydGVkO1xuZnVuY3Rpb24gemVyb1dpZHRoRWxlbWVudChtZWFzdXJlKSB7XG4gIGlmICh6d3NwU3VwcG9ydGVkID09IG51bGwpIHtcbiAgICB2YXIgdGVzdCA9IGVsdChcInNwYW5cIiwgXCJcXHUyMDBiXCIpO1xuICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKG1lYXN1cmUsIGVsdChcInNwYW5cIiwgW3Rlc3QsIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwieFwiKV0pKTtcbiAgICBpZiAobWVhc3VyZS5maXJzdENoaWxkLm9mZnNldEhlaWdodCAhPSAwKVxuICAgICAgeyB6d3NwU3VwcG9ydGVkID0gdGVzdC5vZmZzZXRXaWR0aCA8PSAxICYmIHRlc3Qub2Zmc2V0SGVpZ2h0ID4gMiAmJiAhKGllICYmIGllX3ZlcnNpb24gPCA4KTsgfVxuICB9XG4gIHZhciBub2RlID0gendzcFN1cHBvcnRlZCA/IGVsdChcInNwYW5cIiwgXCJcXHUyMDBiXCIpIDpcbiAgICBlbHQoXCJzcGFuXCIsIFwiXFx1MDBhMFwiLCBudWxsLCBcImRpc3BsYXk6IGlubGluZS1ibG9jazsgd2lkdGg6IDFweDsgbWFyZ2luLXJpZ2h0OiAtMXB4XCIpO1xuICBub2RlLnNldEF0dHJpYnV0ZShcImNtLXRleHRcIiwgXCJcIik7XG4gIHJldHVybiBub2RlXG59XG5cbi8vIEZlYXR1cmUtZGV0ZWN0IElFJ3MgY3J1bW15IGNsaWVudCByZWN0IHJlcG9ydGluZyBmb3IgYmlkaSB0ZXh0XG52YXIgYmFkQmlkaVJlY3RzO1xuZnVuY3Rpb24gaGFzQmFkQmlkaVJlY3RzKG1lYXN1cmUpIHtcbiAgaWYgKGJhZEJpZGlSZWN0cyAhPSBudWxsKSB7IHJldHVybiBiYWRCaWRpUmVjdHMgfVxuICB2YXIgdHh0ID0gcmVtb3ZlQ2hpbGRyZW5BbmRBZGQobWVhc3VyZSwgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJBXFx1MDYyZUFcIikpO1xuICB2YXIgcjAgPSByYW5nZSh0eHQsIDAsIDEpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICB2YXIgcjEgPSByYW5nZSh0eHQsIDEsIDIpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICByZW1vdmVDaGlsZHJlbihtZWFzdXJlKTtcbiAgaWYgKCFyMCB8fCByMC5sZWZ0ID09IHIwLnJpZ2h0KSB7IHJldHVybiBmYWxzZSB9IC8vIFNhZmFyaSByZXR1cm5zIG51bGwgaW4gc29tZSBjYXNlcyAoIzI3ODApXG4gIHJldHVybiBiYWRCaWRpUmVjdHMgPSAocjEucmlnaHQgLSByMC5yaWdodCA8IDMpXG59XG5cbi8vIFNlZSBpZiBcIlwiLnNwbGl0IGlzIHRoZSBicm9rZW4gSUUgdmVyc2lvbiwgaWYgc28sIHByb3ZpZGUgYW5cbi8vIGFsdGVybmF0aXZlIHdheSB0byBzcGxpdCBsaW5lcy5cbnZhciBzcGxpdExpbmVzQXV0byA9IFwiXFxuXFxuYlwiLnNwbGl0KC9cXG4vKS5sZW5ndGggIT0gMyA/IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgdmFyIHBvcyA9IDAsIHJlc3VsdCA9IFtdLCBsID0gc3RyaW5nLmxlbmd0aDtcbiAgd2hpbGUgKHBvcyA8PSBsKSB7XG4gICAgdmFyIG5sID0gc3RyaW5nLmluZGV4T2YoXCJcXG5cIiwgcG9zKTtcbiAgICBpZiAobmwgPT0gLTEpIHsgbmwgPSBzdHJpbmcubGVuZ3RoOyB9XG4gICAgdmFyIGxpbmUgPSBzdHJpbmcuc2xpY2UocG9zLCBzdHJpbmcuY2hhckF0KG5sIC0gMSkgPT0gXCJcXHJcIiA/IG5sIC0gMSA6IG5sKTtcbiAgICB2YXIgcnQgPSBsaW5lLmluZGV4T2YoXCJcXHJcIik7XG4gICAgaWYgKHJ0ICE9IC0xKSB7XG4gICAgICByZXN1bHQucHVzaChsaW5lLnNsaWNlKDAsIHJ0KSk7XG4gICAgICBwb3MgKz0gcnQgKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHQucHVzaChsaW5lKTtcbiAgICAgIHBvcyA9IG5sICsgMTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufSA6IGZ1bmN0aW9uIChzdHJpbmcpIHsgcmV0dXJuIHN0cmluZy5zcGxpdCgvXFxyXFxuP3xcXG4vKTsgfTtcblxudmFyIGhhc1NlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyBmdW5jdGlvbiAodGUpIHtcbiAgdHJ5IHsgcmV0dXJuIHRlLnNlbGVjdGlvblN0YXJ0ICE9IHRlLnNlbGVjdGlvbkVuZCB9XG4gIGNhdGNoKGUpIHsgcmV0dXJuIGZhbHNlIH1cbn0gOiBmdW5jdGlvbiAodGUpIHtcbiAgdmFyIHJhbmdlJCQxO1xuICB0cnkge3JhbmdlJCQxID0gdGUub3duZXJEb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTt9XG4gIGNhdGNoKGUpIHt9XG4gIGlmICghcmFuZ2UkJDEgfHwgcmFuZ2UkJDEucGFyZW50RWxlbWVudCgpICE9IHRlKSB7IHJldHVybiBmYWxzZSB9XG4gIHJldHVybiByYW5nZSQkMS5jb21wYXJlRW5kUG9pbnRzKFwiU3RhcnRUb0VuZFwiLCByYW5nZSQkMSkgIT0gMFxufTtcblxudmFyIGhhc0NvcHlFdmVudCA9IChmdW5jdGlvbiAoKSB7XG4gIHZhciBlID0gZWx0KFwiZGl2XCIpO1xuICBpZiAoXCJvbmNvcHlcIiBpbiBlKSB7IHJldHVybiB0cnVlIH1cbiAgZS5zZXRBdHRyaWJ1dGUoXCJvbmNvcHlcIiwgXCJyZXR1cm47XCIpO1xuICByZXR1cm4gdHlwZW9mIGUub25jb3B5ID09IFwiZnVuY3Rpb25cIlxufSkoKTtcblxudmFyIGJhZFpvb21lZFJlY3RzID0gbnVsbDtcbmZ1bmN0aW9uIGhhc0JhZFpvb21lZFJlY3RzKG1lYXN1cmUpIHtcbiAgaWYgKGJhZFpvb21lZFJlY3RzICE9IG51bGwpIHsgcmV0dXJuIGJhZFpvb21lZFJlY3RzIH1cbiAgdmFyIG5vZGUgPSByZW1vdmVDaGlsZHJlbkFuZEFkZChtZWFzdXJlLCBlbHQoXCJzcGFuXCIsIFwieFwiKSk7XG4gIHZhciBub3JtYWwgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICB2YXIgZnJvbVJhbmdlID0gcmFuZ2Uobm9kZSwgMCwgMSkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIHJldHVybiBiYWRab29tZWRSZWN0cyA9IE1hdGguYWJzKG5vcm1hbC5sZWZ0IC0gZnJvbVJhbmdlLmxlZnQpID4gMVxufVxuXG4vLyBLbm93biBtb2RlcywgYnkgbmFtZSBhbmQgYnkgTUlNRVxudmFyIG1vZGVzID0ge307XG52YXIgbWltZU1vZGVzID0ge307XG5cbi8vIEV4dHJhIGFyZ3VtZW50cyBhcmUgc3RvcmVkIGFzIHRoZSBtb2RlJ3MgZGVwZW5kZW5jaWVzLCB3aGljaCBpc1xuLy8gdXNlZCBieSAobGVnYWN5KSBtZWNoYW5pc21zIGxpa2UgbG9hZG1vZGUuanMgdG8gYXV0b21hdGljYWxseVxuLy8gbG9hZCBhIG1vZGUuIChQcmVmZXJyZWQgbWVjaGFuaXNtIGlzIHRoZSByZXF1aXJlL2RlZmluZSBjYWxscy4pXG5mdW5jdGlvbiBkZWZpbmVNb2RlKG5hbWUsIG1vZGUpIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKVxuICAgIHsgbW9kZS5kZXBlbmRlbmNpZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOyB9XG4gIG1vZGVzW25hbWVdID0gbW9kZTtcbn1cblxuZnVuY3Rpb24gZGVmaW5lTUlNRShtaW1lLCBzcGVjKSB7XG4gIG1pbWVNb2Rlc1ttaW1lXSA9IHNwZWM7XG59XG5cbi8vIEdpdmVuIGEgTUlNRSB0eXBlLCBhIHtuYW1lLCAuLi5vcHRpb25zfSBjb25maWcgb2JqZWN0LCBvciBhIG5hbWVcbi8vIHN0cmluZywgcmV0dXJuIGEgbW9kZSBjb25maWcgb2JqZWN0LlxuZnVuY3Rpb24gcmVzb2x2ZU1vZGUoc3BlYykge1xuICBpZiAodHlwZW9mIHNwZWMgPT0gXCJzdHJpbmdcIiAmJiBtaW1lTW9kZXMuaGFzT3duUHJvcGVydHkoc3BlYykpIHtcbiAgICBzcGVjID0gbWltZU1vZGVzW3NwZWNdO1xuICB9IGVsc2UgaWYgKHNwZWMgJiYgdHlwZW9mIHNwZWMubmFtZSA9PSBcInN0cmluZ1wiICYmIG1pbWVNb2Rlcy5oYXNPd25Qcm9wZXJ0eShzcGVjLm5hbWUpKSB7XG4gICAgdmFyIGZvdW5kID0gbWltZU1vZGVzW3NwZWMubmFtZV07XG4gICAgaWYgKHR5cGVvZiBmb3VuZCA9PSBcInN0cmluZ1wiKSB7IGZvdW5kID0ge25hbWU6IGZvdW5kfTsgfVxuICAgIHNwZWMgPSBjcmVhdGVPYmooZm91bmQsIHNwZWMpO1xuICAgIHNwZWMubmFtZSA9IGZvdW5kLm5hbWU7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHNwZWMgPT0gXCJzdHJpbmdcIiAmJiAvXltcXHdcXC1dK1xcL1tcXHdcXC1dK1xcK3htbCQvLnRlc3Qoc3BlYykpIHtcbiAgICByZXR1cm4gcmVzb2x2ZU1vZGUoXCJhcHBsaWNhdGlvbi94bWxcIilcbiAgfSBlbHNlIGlmICh0eXBlb2Ygc3BlYyA9PSBcInN0cmluZ1wiICYmIC9eW1xcd1xcLV0rXFwvW1xcd1xcLV0rXFwranNvbiQvLnRlc3Qoc3BlYykpIHtcbiAgICByZXR1cm4gcmVzb2x2ZU1vZGUoXCJhcHBsaWNhdGlvbi9qc29uXCIpXG4gIH1cbiAgaWYgKHR5cGVvZiBzcGVjID09IFwic3RyaW5nXCIpIHsgcmV0dXJuIHtuYW1lOiBzcGVjfSB9XG4gIGVsc2UgeyByZXR1cm4gc3BlYyB8fCB7bmFtZTogXCJudWxsXCJ9IH1cbn1cblxuLy8gR2l2ZW4gYSBtb2RlIHNwZWMgKGFueXRoaW5nIHRoYXQgcmVzb2x2ZU1vZGUgYWNjZXB0cyksIGZpbmQgYW5kXG4vLyBpbml0aWFsaXplIGFuIGFjdHVhbCBtb2RlIG9iamVjdC5cbmZ1bmN0aW9uIGdldE1vZGUob3B0aW9ucywgc3BlYykge1xuICBzcGVjID0gcmVzb2x2ZU1vZGUoc3BlYyk7XG4gIHZhciBtZmFjdG9yeSA9IG1vZGVzW3NwZWMubmFtZV07XG4gIGlmICghbWZhY3RvcnkpIHsgcmV0dXJuIGdldE1vZGUob3B0aW9ucywgXCJ0ZXh0L3BsYWluXCIpIH1cbiAgdmFyIG1vZGVPYmogPSBtZmFjdG9yeShvcHRpb25zLCBzcGVjKTtcbiAgaWYgKG1vZGVFeHRlbnNpb25zLmhhc093blByb3BlcnR5KHNwZWMubmFtZSkpIHtcbiAgICB2YXIgZXh0cyA9IG1vZGVFeHRlbnNpb25zW3NwZWMubmFtZV07XG4gICAgZm9yICh2YXIgcHJvcCBpbiBleHRzKSB7XG4gICAgICBpZiAoIWV4dHMuaGFzT3duUHJvcGVydHkocHJvcCkpIHsgY29udGludWUgfVxuICAgICAgaWYgKG1vZGVPYmouaGFzT3duUHJvcGVydHkocHJvcCkpIHsgbW9kZU9ialtcIl9cIiArIHByb3BdID0gbW9kZU9ialtwcm9wXTsgfVxuICAgICAgbW9kZU9ialtwcm9wXSA9IGV4dHNbcHJvcF07XG4gICAgfVxuICB9XG4gIG1vZGVPYmoubmFtZSA9IHNwZWMubmFtZTtcbiAgaWYgKHNwZWMuaGVscGVyVHlwZSkgeyBtb2RlT2JqLmhlbHBlclR5cGUgPSBzcGVjLmhlbHBlclR5cGU7IH1cbiAgaWYgKHNwZWMubW9kZVByb3BzKSB7IGZvciAodmFyIHByb3AkMSBpbiBzcGVjLm1vZGVQcm9wcylcbiAgICB7IG1vZGVPYmpbcHJvcCQxXSA9IHNwZWMubW9kZVByb3BzW3Byb3AkMV07IH0gfVxuXG4gIHJldHVybiBtb2RlT2JqXG59XG5cbi8vIFRoaXMgY2FuIGJlIHVzZWQgdG8gYXR0YWNoIHByb3BlcnRpZXMgdG8gbW9kZSBvYmplY3RzIGZyb21cbi8vIG91dHNpZGUgdGhlIGFjdHVhbCBtb2RlIGRlZmluaXRpb24uXG52YXIgbW9kZUV4dGVuc2lvbnMgPSB7fTtcbmZ1bmN0aW9uIGV4dGVuZE1vZGUobW9kZSwgcHJvcGVydGllcykge1xuICB2YXIgZXh0cyA9IG1vZGVFeHRlbnNpb25zLmhhc093blByb3BlcnR5KG1vZGUpID8gbW9kZUV4dGVuc2lvbnNbbW9kZV0gOiAobW9kZUV4dGVuc2lvbnNbbW9kZV0gPSB7fSk7XG4gIGNvcHlPYmoocHJvcGVydGllcywgZXh0cyk7XG59XG5cbmZ1bmN0aW9uIGNvcHlTdGF0ZShtb2RlLCBzdGF0ZSkge1xuICBpZiAoc3RhdGUgPT09IHRydWUpIHsgcmV0dXJuIHN0YXRlIH1cbiAgaWYgKG1vZGUuY29weVN0YXRlKSB7IHJldHVybiBtb2RlLmNvcHlTdGF0ZShzdGF0ZSkgfVxuICB2YXIgbnN0YXRlID0ge307XG4gIGZvciAodmFyIG4gaW4gc3RhdGUpIHtcbiAgICB2YXIgdmFsID0gc3RhdGVbbl07XG4gICAgaWYgKHZhbCBpbnN0YW5jZW9mIEFycmF5KSB7IHZhbCA9IHZhbC5jb25jYXQoW10pOyB9XG4gICAgbnN0YXRlW25dID0gdmFsO1xuICB9XG4gIHJldHVybiBuc3RhdGVcbn1cblxuLy8gR2l2ZW4gYSBtb2RlIGFuZCBhIHN0YXRlIChmb3IgdGhhdCBtb2RlKSwgZmluZCB0aGUgaW5uZXIgbW9kZSBhbmRcbi8vIHN0YXRlIGF0IHRoZSBwb3NpdGlvbiB0aGF0IHRoZSBzdGF0ZSByZWZlcnMgdG8uXG5mdW5jdGlvbiBpbm5lck1vZGUobW9kZSwgc3RhdGUpIHtcbiAgdmFyIGluZm87XG4gIHdoaWxlIChtb2RlLmlubmVyTW9kZSkge1xuICAgIGluZm8gPSBtb2RlLmlubmVyTW9kZShzdGF0ZSk7XG4gICAgaWYgKCFpbmZvIHx8IGluZm8ubW9kZSA9PSBtb2RlKSB7IGJyZWFrIH1cbiAgICBzdGF0ZSA9IGluZm8uc3RhdGU7XG4gICAgbW9kZSA9IGluZm8ubW9kZTtcbiAgfVxuICByZXR1cm4gaW5mbyB8fCB7bW9kZTogbW9kZSwgc3RhdGU6IHN0YXRlfVxufVxuXG5mdW5jdGlvbiBzdGFydFN0YXRlKG1vZGUsIGExLCBhMikge1xuICByZXR1cm4gbW9kZS5zdGFydFN0YXRlID8gbW9kZS5zdGFydFN0YXRlKGExLCBhMikgOiB0cnVlXG59XG5cbi8vIFNUUklORyBTVFJFQU1cblxuLy8gRmVkIHRvIHRoZSBtb2RlIHBhcnNlcnMsIHByb3ZpZGVzIGhlbHBlciBmdW5jdGlvbnMgdG8gbWFrZVxuLy8gcGFyc2VycyBtb3JlIHN1Y2NpbmN0LlxuXG52YXIgU3RyaW5nU3RyZWFtID0gZnVuY3Rpb24oc3RyaW5nLCB0YWJTaXplKSB7XG4gIHRoaXMucG9zID0gdGhpcy5zdGFydCA9IDA7XG4gIHRoaXMuc3RyaW5nID0gc3RyaW5nO1xuICB0aGlzLnRhYlNpemUgPSB0YWJTaXplIHx8IDg7XG4gIHRoaXMubGFzdENvbHVtblBvcyA9IHRoaXMubGFzdENvbHVtblZhbHVlID0gMDtcbiAgdGhpcy5saW5lU3RhcnQgPSAwO1xufTtcblxuU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5lb2wgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXMucG9zID49IHRoaXMuc3RyaW5nLmxlbmd0aH07XG5TdHJpbmdTdHJlYW0ucHJvdG90eXBlLnNvbCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpcy5wb3MgPT0gdGhpcy5saW5lU3RhcnR9O1xuU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5wZWVrID0gZnVuY3Rpb24gKCkge3JldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpIHx8IHVuZGVmaW5lZH07XG5TdHJpbmdTdHJlYW0ucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICh0aGlzLnBvcyA8IHRoaXMuc3RyaW5nLmxlbmd0aClcbiAgICB7IHJldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MrKykgfVxufTtcblN0cmluZ1N0cmVhbS5wcm90b3R5cGUuZWF0ID0gZnVuY3Rpb24gKG1hdGNoKSB7XG4gIHZhciBjaCA9IHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcyk7XG4gIHZhciBvaztcbiAgaWYgKHR5cGVvZiBtYXRjaCA9PSBcInN0cmluZ1wiKSB7IG9rID0gY2ggPT0gbWF0Y2g7IH1cbiAgZWxzZSB7IG9rID0gY2ggJiYgKG1hdGNoLnRlc3QgPyBtYXRjaC50ZXN0KGNoKSA6IG1hdGNoKGNoKSk7IH1cbiAgaWYgKG9rKSB7Kyt0aGlzLnBvczsgcmV0dXJuIGNofVxufTtcblN0cmluZ1N0cmVhbS5wcm90b3R5cGUuZWF0V2hpbGUgPSBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgdmFyIHN0YXJ0ID0gdGhpcy5wb3M7XG4gIHdoaWxlICh0aGlzLmVhdChtYXRjaCkpe31cbiAgcmV0dXJuIHRoaXMucG9zID4gc3RhcnRcbn07XG5TdHJpbmdTdHJlYW0ucHJvdG90eXBlLmVhdFNwYWNlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBzdGFydCA9IHRoaXMucG9zO1xuICB3aGlsZSAoL1tcXHNcXHUwMGEwXS8udGVzdCh0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpKSkgeyArK3RoaXMkMS5wb3M7IH1cbiAgcmV0dXJuIHRoaXMucG9zID4gc3RhcnRcbn07XG5TdHJpbmdTdHJlYW0ucHJvdG90eXBlLnNraXBUb0VuZCA9IGZ1bmN0aW9uICgpIHt0aGlzLnBvcyA9IHRoaXMuc3RyaW5nLmxlbmd0aDt9O1xuU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5za2lwVG8gPSBmdW5jdGlvbiAoY2gpIHtcbiAgdmFyIGZvdW5kID0gdGhpcy5zdHJpbmcuaW5kZXhPZihjaCwgdGhpcy5wb3MpO1xuICBpZiAoZm91bmQgPiAtMSkge3RoaXMucG9zID0gZm91bmQ7IHJldHVybiB0cnVlfVxufTtcblN0cmluZ1N0cmVhbS5wcm90b3R5cGUuYmFja1VwID0gZnVuY3Rpb24gKG4pIHt0aGlzLnBvcyAtPSBuO307XG5TdHJpbmdTdHJlYW0ucHJvdG90eXBlLmNvbHVtbiA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMubGFzdENvbHVtblBvcyA8IHRoaXMuc3RhcnQpIHtcbiAgICB0aGlzLmxhc3RDb2x1bW5WYWx1ZSA9IGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCB0aGlzLnN0YXJ0LCB0aGlzLnRhYlNpemUsIHRoaXMubGFzdENvbHVtblBvcywgdGhpcy5sYXN0Q29sdW1uVmFsdWUpO1xuICAgIHRoaXMubGFzdENvbHVtblBvcyA9IHRoaXMuc3RhcnQ7XG4gIH1cbiAgcmV0dXJuIHRoaXMubGFzdENvbHVtblZhbHVlIC0gKHRoaXMubGluZVN0YXJ0ID8gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsIHRoaXMubGluZVN0YXJ0LCB0aGlzLnRhYlNpemUpIDogMClcbn07XG5TdHJpbmdTdHJlYW0ucHJvdG90eXBlLmluZGVudGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsIG51bGwsIHRoaXMudGFiU2l6ZSkgLVxuICAgICh0aGlzLmxpbmVTdGFydCA/IGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCB0aGlzLmxpbmVTdGFydCwgdGhpcy50YWJTaXplKSA6IDApXG59O1xuU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5tYXRjaCA9IGZ1bmN0aW9uIChwYXR0ZXJuLCBjb25zdW1lLCBjYXNlSW5zZW5zaXRpdmUpIHtcbiAgaWYgKHR5cGVvZiBwYXR0ZXJuID09IFwic3RyaW5nXCIpIHtcbiAgICB2YXIgY2FzZWQgPSBmdW5jdGlvbiAoc3RyKSB7IHJldHVybiBjYXNlSW5zZW5zaXRpdmUgPyBzdHIudG9Mb3dlckNhc2UoKSA6IHN0cjsgfTtcbiAgICB2YXIgc3Vic3RyID0gdGhpcy5zdHJpbmcuc3Vic3RyKHRoaXMucG9zLCBwYXR0ZXJuLmxlbmd0aCk7XG4gICAgaWYgKGNhc2VkKHN1YnN0cikgPT0gY2FzZWQocGF0dGVybikpIHtcbiAgICAgIGlmIChjb25zdW1lICE9PSBmYWxzZSkgeyB0aGlzLnBvcyArPSBwYXR0ZXJuLmxlbmd0aDsgfVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1hdGNoID0gdGhpcy5zdHJpbmcuc2xpY2UodGhpcy5wb3MpLm1hdGNoKHBhdHRlcm4pO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaC5pbmRleCA+IDApIHsgcmV0dXJuIG51bGwgfVxuICAgIGlmIChtYXRjaCAmJiBjb25zdW1lICE9PSBmYWxzZSkgeyB0aGlzLnBvcyArPSBtYXRjaFswXS5sZW5ndGg7IH1cbiAgICByZXR1cm4gbWF0Y2hcbiAgfVxufTtcblN0cmluZ1N0cmVhbS5wcm90b3R5cGUuY3VycmVudCA9IGZ1bmN0aW9uICgpe3JldHVybiB0aGlzLnN0cmluZy5zbGljZSh0aGlzLnN0YXJ0LCB0aGlzLnBvcyl9O1xuU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5oaWRlRmlyc3RDaGFycyA9IGZ1bmN0aW9uIChuLCBpbm5lcikge1xuICB0aGlzLmxpbmVTdGFydCArPSBuO1xuICB0cnkgeyByZXR1cm4gaW5uZXIoKSB9XG4gIGZpbmFsbHkgeyB0aGlzLmxpbmVTdGFydCAtPSBuOyB9XG59O1xuXG4vLyBDb21wdXRlIGEgc3R5bGUgYXJyYXkgKGFuIGFycmF5IHN0YXJ0aW5nIHdpdGggYSBtb2RlIGdlbmVyYXRpb25cbi8vIC0tIGZvciBpbnZhbGlkYXRpb24gLS0gZm9sbG93ZWQgYnkgcGFpcnMgb2YgZW5kIHBvc2l0aW9ucyBhbmRcbi8vIHN0eWxlIHN0cmluZ3MpLCB3aGljaCBpcyB1c2VkIHRvIGhpZ2hsaWdodCB0aGUgdG9rZW5zIG9uIHRoZVxuLy8gbGluZS5cbmZ1bmN0aW9uIGhpZ2hsaWdodExpbmUoY20sIGxpbmUsIHN0YXRlLCBmb3JjZVRvRW5kKSB7XG4gIC8vIEEgc3R5bGVzIGFycmF5IGFsd2F5cyBzdGFydHMgd2l0aCBhIG51bWJlciBpZGVudGlmeWluZyB0aGVcbiAgLy8gbW9kZS9vdmVybGF5cyB0aGF0IGl0IGlzIGJhc2VkIG9uIChmb3IgZWFzeSBpbnZhbGlkYXRpb24pLlxuICB2YXIgc3QgPSBbY20uc3RhdGUubW9kZUdlbl0sIGxpbmVDbGFzc2VzID0ge307XG4gIC8vIENvbXB1dGUgdGhlIGJhc2UgYXJyYXkgb2Ygc3R5bGVzXG4gIHJ1bk1vZGUoY20sIGxpbmUudGV4dCwgY20uZG9jLm1vZGUsIHN0YXRlLCBmdW5jdGlvbiAoZW5kLCBzdHlsZSkgeyByZXR1cm4gc3QucHVzaChlbmQsIHN0eWxlKTsgfSxcbiAgICBsaW5lQ2xhc3NlcywgZm9yY2VUb0VuZCk7XG5cbiAgLy8gUnVuIG92ZXJsYXlzLCBhZGp1c3Qgc3R5bGUgYXJyYXkuXG4gIHZhciBsb29wID0gZnVuY3Rpb24gKCBvICkge1xuICAgIHZhciBvdmVybGF5ID0gY20uc3RhdGUub3ZlcmxheXNbb10sIGkgPSAxLCBhdCA9IDA7XG4gICAgcnVuTW9kZShjbSwgbGluZS50ZXh0LCBvdmVybGF5Lm1vZGUsIHRydWUsIGZ1bmN0aW9uIChlbmQsIHN0eWxlKSB7XG4gICAgICB2YXIgc3RhcnQgPSBpO1xuICAgICAgLy8gRW5zdXJlIHRoZXJlJ3MgYSB0b2tlbiBlbmQgYXQgdGhlIGN1cnJlbnQgcG9zaXRpb24sIGFuZCB0aGF0IGkgcG9pbnRzIGF0IGl0XG4gICAgICB3aGlsZSAoYXQgPCBlbmQpIHtcbiAgICAgICAgdmFyIGlfZW5kID0gc3RbaV07XG4gICAgICAgIGlmIChpX2VuZCA+IGVuZClcbiAgICAgICAgICB7IHN0LnNwbGljZShpLCAxLCBlbmQsIHN0W2krMV0sIGlfZW5kKTsgfVxuICAgICAgICBpICs9IDI7XG4gICAgICAgIGF0ID0gTWF0aC5taW4oZW5kLCBpX2VuZCk7XG4gICAgICB9XG4gICAgICBpZiAoIXN0eWxlKSB7IHJldHVybiB9XG4gICAgICBpZiAob3ZlcmxheS5vcGFxdWUpIHtcbiAgICAgICAgc3Quc3BsaWNlKHN0YXJ0LCBpIC0gc3RhcnQsIGVuZCwgXCJvdmVybGF5IFwiICsgc3R5bGUpO1xuICAgICAgICBpID0gc3RhcnQgKyAyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yICg7IHN0YXJ0IDwgaTsgc3RhcnQgKz0gMikge1xuICAgICAgICAgIHZhciBjdXIgPSBzdFtzdGFydCsxXTtcbiAgICAgICAgICBzdFtzdGFydCsxXSA9IChjdXIgPyBjdXIgKyBcIiBcIiA6IFwiXCIpICsgXCJvdmVybGF5IFwiICsgc3R5bGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCBsaW5lQ2xhc3Nlcyk7XG4gIH07XG5cbiAgZm9yICh2YXIgbyA9IDA7IG8gPCBjbS5zdGF0ZS5vdmVybGF5cy5sZW5ndGg7ICsrbykgbG9vcCggbyApO1xuXG4gIHJldHVybiB7c3R5bGVzOiBzdCwgY2xhc3NlczogbGluZUNsYXNzZXMuYmdDbGFzcyB8fCBsaW5lQ2xhc3Nlcy50ZXh0Q2xhc3MgPyBsaW5lQ2xhc3NlcyA6IG51bGx9XG59XG5cbmZ1bmN0aW9uIGdldExpbmVTdHlsZXMoY20sIGxpbmUsIHVwZGF0ZUZyb250aWVyKSB7XG4gIGlmICghbGluZS5zdHlsZXMgfHwgbGluZS5zdHlsZXNbMF0gIT0gY20uc3RhdGUubW9kZUdlbikge1xuICAgIHZhciBzdGF0ZSA9IGdldFN0YXRlQmVmb3JlKGNtLCBsaW5lTm8obGluZSkpO1xuICAgIHZhciByZXN1bHQgPSBoaWdobGlnaHRMaW5lKGNtLCBsaW5lLCBsaW5lLnRleHQubGVuZ3RoID4gY20ub3B0aW9ucy5tYXhIaWdobGlnaHRMZW5ndGggPyBjb3B5U3RhdGUoY20uZG9jLm1vZGUsIHN0YXRlKSA6IHN0YXRlKTtcbiAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBzdGF0ZTtcbiAgICBsaW5lLnN0eWxlcyA9IHJlc3VsdC5zdHlsZXM7XG4gICAgaWYgKHJlc3VsdC5jbGFzc2VzKSB7IGxpbmUuc3R5bGVDbGFzc2VzID0gcmVzdWx0LmNsYXNzZXM7IH1cbiAgICBlbHNlIGlmIChsaW5lLnN0eWxlQ2xhc3NlcykgeyBsaW5lLnN0eWxlQ2xhc3NlcyA9IG51bGw7IH1cbiAgICBpZiAodXBkYXRlRnJvbnRpZXIgPT09IGNtLmRvYy5mcm9udGllcikgeyBjbS5kb2MuZnJvbnRpZXIrKzsgfVxuICB9XG4gIHJldHVybiBsaW5lLnN0eWxlc1xufVxuXG5mdW5jdGlvbiBnZXRTdGF0ZUJlZm9yZShjbSwgbiwgcHJlY2lzZSkge1xuICB2YXIgZG9jID0gY20uZG9jLCBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgaWYgKCFkb2MubW9kZS5zdGFydFN0YXRlKSB7IHJldHVybiB0cnVlIH1cbiAgdmFyIHBvcyA9IGZpbmRTdGFydExpbmUoY20sIG4sIHByZWNpc2UpLCBzdGF0ZSA9IHBvcyA+IGRvYy5maXJzdCAmJiBnZXRMaW5lKGRvYywgcG9zLTEpLnN0YXRlQWZ0ZXI7XG4gIGlmICghc3RhdGUpIHsgc3RhdGUgPSBzdGFydFN0YXRlKGRvYy5tb2RlKTsgfVxuICBlbHNlIHsgc3RhdGUgPSBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKTsgfVxuICBkb2MuaXRlcihwb3MsIG4sIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgcHJvY2Vzc0xpbmUoY20sIGxpbmUudGV4dCwgc3RhdGUpO1xuICAgIHZhciBzYXZlID0gcG9zID09IG4gLSAxIHx8IHBvcyAlIDUgPT0gMCB8fCBwb3MgPj0gZGlzcGxheS52aWV3RnJvbSAmJiBwb3MgPCBkaXNwbGF5LnZpZXdUbztcbiAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBzYXZlID8gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSkgOiBudWxsO1xuICAgICsrcG9zO1xuICB9KTtcbiAgaWYgKHByZWNpc2UpIHsgZG9jLmZyb250aWVyID0gcG9zOyB9XG4gIHJldHVybiBzdGF0ZVxufVxuXG4vLyBMaWdodHdlaWdodCBmb3JtIG9mIGhpZ2hsaWdodCAtLSBwcm9jZWVkIG92ZXIgdGhpcyBsaW5lIGFuZFxuLy8gdXBkYXRlIHN0YXRlLCBidXQgZG9uJ3Qgc2F2ZSBhIHN0eWxlIGFycmF5LiBVc2VkIGZvciBsaW5lcyB0aGF0XG4vLyBhcmVuJ3QgY3VycmVudGx5IHZpc2libGUuXG5mdW5jdGlvbiBwcm9jZXNzTGluZShjbSwgdGV4dCwgc3RhdGUsIHN0YXJ0QXQpIHtcbiAgdmFyIG1vZGUgPSBjbS5kb2MubW9kZTtcbiAgdmFyIHN0cmVhbSA9IG5ldyBTdHJpbmdTdHJlYW0odGV4dCwgY20ub3B0aW9ucy50YWJTaXplKTtcbiAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvcyA9IHN0YXJ0QXQgfHwgMDtcbiAgaWYgKHRleHQgPT0gXCJcIikgeyBjYWxsQmxhbmtMaW5lKG1vZGUsIHN0YXRlKTsgfVxuICB3aGlsZSAoIXN0cmVhbS5lb2woKSkge1xuICAgIHJlYWRUb2tlbihtb2RlLCBzdHJlYW0sIHN0YXRlKTtcbiAgICBzdHJlYW0uc3RhcnQgPSBzdHJlYW0ucG9zO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNhbGxCbGFua0xpbmUobW9kZSwgc3RhdGUpIHtcbiAgaWYgKG1vZGUuYmxhbmtMaW5lKSB7IHJldHVybiBtb2RlLmJsYW5rTGluZShzdGF0ZSkgfVxuICBpZiAoIW1vZGUuaW5uZXJNb2RlKSB7IHJldHVybiB9XG4gIHZhciBpbm5lciA9IGlubmVyTW9kZShtb2RlLCBzdGF0ZSk7XG4gIGlmIChpbm5lci5tb2RlLmJsYW5rTGluZSkgeyByZXR1cm4gaW5uZXIubW9kZS5ibGFua0xpbmUoaW5uZXIuc3RhdGUpIH1cbn1cblxuZnVuY3Rpb24gcmVhZFRva2VuKG1vZGUsIHN0cmVhbSwgc3RhdGUsIGlubmVyKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgIGlmIChpbm5lcikgeyBpbm5lclswXSA9IGlubmVyTW9kZShtb2RlLCBzdGF0ZSkubW9kZTsgfVxuICAgIHZhciBzdHlsZSA9IG1vZGUudG9rZW4oc3RyZWFtLCBzdGF0ZSk7XG4gICAgaWYgKHN0cmVhbS5wb3MgPiBzdHJlYW0uc3RhcnQpIHsgcmV0dXJuIHN0eWxlIH1cbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoXCJNb2RlIFwiICsgbW9kZS5uYW1lICsgXCIgZmFpbGVkIHRvIGFkdmFuY2Ugc3RyZWFtLlwiKVxufVxuXG4vLyBVdGlsaXR5IGZvciBnZXRUb2tlbkF0IGFuZCBnZXRMaW5lVG9rZW5zXG5mdW5jdGlvbiB0YWtlVG9rZW4oY20sIHBvcywgcHJlY2lzZSwgYXNBcnJheSkge1xuICB2YXIgZ2V0T2JqID0gZnVuY3Rpb24gKGNvcHkpIHsgcmV0dXJuICh7XG4gICAgc3RhcnQ6IHN0cmVhbS5zdGFydCwgZW5kOiBzdHJlYW0ucG9zLFxuICAgIHN0cmluZzogc3RyZWFtLmN1cnJlbnQoKSxcbiAgICB0eXBlOiBzdHlsZSB8fCBudWxsLFxuICAgIHN0YXRlOiBjb3B5ID8gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSkgOiBzdGF0ZVxuICB9KTsgfTtcblxuICB2YXIgZG9jID0gY20uZG9jLCBtb2RlID0gZG9jLm1vZGUsIHN0eWxlO1xuICBwb3MgPSBjbGlwUG9zKGRvYywgcG9zKTtcbiAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgcG9zLmxpbmUpLCBzdGF0ZSA9IGdldFN0YXRlQmVmb3JlKGNtLCBwb3MubGluZSwgcHJlY2lzZSk7XG4gIHZhciBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKGxpbmUudGV4dCwgY20ub3B0aW9ucy50YWJTaXplKSwgdG9rZW5zO1xuICBpZiAoYXNBcnJheSkgeyB0b2tlbnMgPSBbXTsgfVxuICB3aGlsZSAoKGFzQXJyYXkgfHwgc3RyZWFtLnBvcyA8IHBvcy5jaCkgJiYgIXN0cmVhbS5lb2woKSkge1xuICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3M7XG4gICAgc3R5bGUgPSByZWFkVG9rZW4obW9kZSwgc3RyZWFtLCBzdGF0ZSk7XG4gICAgaWYgKGFzQXJyYXkpIHsgdG9rZW5zLnB1c2goZ2V0T2JqKHRydWUpKTsgfVxuICB9XG4gIHJldHVybiBhc0FycmF5ID8gdG9rZW5zIDogZ2V0T2JqKClcbn1cblxuZnVuY3Rpb24gZXh0cmFjdExpbmVDbGFzc2VzKHR5cGUsIG91dHB1dCkge1xuICBpZiAodHlwZSkgeyBmb3IgKDs7KSB7XG4gICAgdmFyIGxpbmVDbGFzcyA9IHR5cGUubWF0Y2goLyg/Ol58XFxzKylsaW5lLShiYWNrZ3JvdW5kLSk/KFxcUyspLyk7XG4gICAgaWYgKCFsaW5lQ2xhc3MpIHsgYnJlYWsgfVxuICAgIHR5cGUgPSB0eXBlLnNsaWNlKDAsIGxpbmVDbGFzcy5pbmRleCkgKyB0eXBlLnNsaWNlKGxpbmVDbGFzcy5pbmRleCArIGxpbmVDbGFzc1swXS5sZW5ndGgpO1xuICAgIHZhciBwcm9wID0gbGluZUNsYXNzWzFdID8gXCJiZ0NsYXNzXCIgOiBcInRleHRDbGFzc1wiO1xuICAgIGlmIChvdXRwdXRbcHJvcF0gPT0gbnVsbClcbiAgICAgIHsgb3V0cHV0W3Byb3BdID0gbGluZUNsYXNzWzJdOyB9XG4gICAgZWxzZSBpZiAoIShuZXcgUmVnRXhwKFwiKD86XnxcXHMpXCIgKyBsaW5lQ2xhc3NbMl0gKyBcIig/OiR8XFxzKVwiKSkudGVzdChvdXRwdXRbcHJvcF0pKVxuICAgICAgeyBvdXRwdXRbcHJvcF0gKz0gXCIgXCIgKyBsaW5lQ2xhc3NbMl07IH1cbiAgfSB9XG4gIHJldHVybiB0eXBlXG59XG5cbi8vIFJ1biB0aGUgZ2l2ZW4gbW9kZSdzIHBhcnNlciBvdmVyIGEgbGluZSwgY2FsbGluZyBmIGZvciBlYWNoIHRva2VuLlxuZnVuY3Rpb24gcnVuTW9kZShjbSwgdGV4dCwgbW9kZSwgc3RhdGUsIGYsIGxpbmVDbGFzc2VzLCBmb3JjZVRvRW5kKSB7XG4gIHZhciBmbGF0dGVuU3BhbnMgPSBtb2RlLmZsYXR0ZW5TcGFucztcbiAgaWYgKGZsYXR0ZW5TcGFucyA9PSBudWxsKSB7IGZsYXR0ZW5TcGFucyA9IGNtLm9wdGlvbnMuZmxhdHRlblNwYW5zOyB9XG4gIHZhciBjdXJTdGFydCA9IDAsIGN1clN0eWxlID0gbnVsbDtcbiAgdmFyIHN0cmVhbSA9IG5ldyBTdHJpbmdTdHJlYW0odGV4dCwgY20ub3B0aW9ucy50YWJTaXplKSwgc3R5bGU7XG4gIHZhciBpbm5lciA9IGNtLm9wdGlvbnMuYWRkTW9kZUNsYXNzICYmIFtudWxsXTtcbiAgaWYgKHRleHQgPT0gXCJcIikgeyBleHRyYWN0TGluZUNsYXNzZXMoY2FsbEJsYW5rTGluZShtb2RlLCBzdGF0ZSksIGxpbmVDbGFzc2VzKTsgfVxuICB3aGlsZSAoIXN0cmVhbS5lb2woKSkge1xuICAgIGlmIChzdHJlYW0ucG9zID4gY20ub3B0aW9ucy5tYXhIaWdobGlnaHRMZW5ndGgpIHtcbiAgICAgIGZsYXR0ZW5TcGFucyA9IGZhbHNlO1xuICAgICAgaWYgKGZvcmNlVG9FbmQpIHsgcHJvY2Vzc0xpbmUoY20sIHRleHQsIHN0YXRlLCBzdHJlYW0ucG9zKTsgfVxuICAgICAgc3RyZWFtLnBvcyA9IHRleHQubGVuZ3RoO1xuICAgICAgc3R5bGUgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdHlsZSA9IGV4dHJhY3RMaW5lQ2xhc3NlcyhyZWFkVG9rZW4obW9kZSwgc3RyZWFtLCBzdGF0ZSwgaW5uZXIpLCBsaW5lQ2xhc3Nlcyk7XG4gICAgfVxuICAgIGlmIChpbm5lcikge1xuICAgICAgdmFyIG1OYW1lID0gaW5uZXJbMF0ubmFtZTtcbiAgICAgIGlmIChtTmFtZSkgeyBzdHlsZSA9IFwibS1cIiArIChzdHlsZSA/IG1OYW1lICsgXCIgXCIgKyBzdHlsZSA6IG1OYW1lKTsgfVxuICAgIH1cbiAgICBpZiAoIWZsYXR0ZW5TcGFucyB8fCBjdXJTdHlsZSAhPSBzdHlsZSkge1xuICAgICAgd2hpbGUgKGN1clN0YXJ0IDwgc3RyZWFtLnN0YXJ0KSB7XG4gICAgICAgIGN1clN0YXJ0ID0gTWF0aC5taW4oc3RyZWFtLnN0YXJ0LCBjdXJTdGFydCArIDUwMDApO1xuICAgICAgICBmKGN1clN0YXJ0LCBjdXJTdHlsZSk7XG4gICAgICB9XG4gICAgICBjdXJTdHlsZSA9IHN0eWxlO1xuICAgIH1cbiAgICBzdHJlYW0uc3RhcnQgPSBzdHJlYW0ucG9zO1xuICB9XG4gIHdoaWxlIChjdXJTdGFydCA8IHN0cmVhbS5wb3MpIHtcbiAgICAvLyBXZWJraXQgc2VlbXMgdG8gcmVmdXNlIHRvIHJlbmRlciB0ZXh0IG5vZGVzIGxvbmdlciB0aGFuIDU3NDQ0XG4gICAgLy8gY2hhcmFjdGVycywgYW5kIHJldHVybnMgaW5hY2N1cmF0ZSBtZWFzdXJlbWVudHMgaW4gbm9kZXNcbiAgICAvLyBzdGFydGluZyBhcm91bmQgNTAwMCBjaGFycy5cbiAgICB2YXIgcG9zID0gTWF0aC5taW4oc3RyZWFtLnBvcywgY3VyU3RhcnQgKyA1MDAwKTtcbiAgICBmKHBvcywgY3VyU3R5bGUpO1xuICAgIGN1clN0YXJ0ID0gcG9zO1xuICB9XG59XG5cbi8vIEZpbmRzIHRoZSBsaW5lIHRvIHN0YXJ0IHdpdGggd2hlbiBzdGFydGluZyBhIHBhcnNlLiBUcmllcyB0b1xuLy8gZmluZCBhIGxpbmUgd2l0aCBhIHN0YXRlQWZ0ZXIsIHNvIHRoYXQgaXQgY2FuIHN0YXJ0IHdpdGggYVxuLy8gdmFsaWQgc3RhdGUuIElmIHRoYXQgZmFpbHMsIGl0IHJldHVybnMgdGhlIGxpbmUgd2l0aCB0aGVcbi8vIHNtYWxsZXN0IGluZGVudGF0aW9uLCB3aGljaCB0ZW5kcyB0byBuZWVkIHRoZSBsZWFzdCBjb250ZXh0IHRvXG4vLyBwYXJzZSBjb3JyZWN0bHkuXG5mdW5jdGlvbiBmaW5kU3RhcnRMaW5lKGNtLCBuLCBwcmVjaXNlKSB7XG4gIHZhciBtaW5pbmRlbnQsIG1pbmxpbmUsIGRvYyA9IGNtLmRvYztcbiAgdmFyIGxpbSA9IHByZWNpc2UgPyAtMSA6IG4gLSAoY20uZG9jLm1vZGUuaW5uZXJNb2RlID8gMTAwMCA6IDEwMCk7XG4gIGZvciAodmFyIHNlYXJjaCA9IG47IHNlYXJjaCA+IGxpbTsgLS1zZWFyY2gpIHtcbiAgICBpZiAoc2VhcmNoIDw9IGRvYy5maXJzdCkgeyByZXR1cm4gZG9jLmZpcnN0IH1cbiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBzZWFyY2ggLSAxKTtcbiAgICBpZiAobGluZS5zdGF0ZUFmdGVyICYmICghcHJlY2lzZSB8fCBzZWFyY2ggPD0gZG9jLmZyb250aWVyKSkgeyByZXR1cm4gc2VhcmNoIH1cbiAgICB2YXIgaW5kZW50ZWQgPSBjb3VudENvbHVtbihsaW5lLnRleHQsIG51bGwsIGNtLm9wdGlvbnMudGFiU2l6ZSk7XG4gICAgaWYgKG1pbmxpbmUgPT0gbnVsbCB8fCBtaW5pbmRlbnQgPiBpbmRlbnRlZCkge1xuICAgICAgbWlubGluZSA9IHNlYXJjaCAtIDE7XG4gICAgICBtaW5pbmRlbnQgPSBpbmRlbnRlZDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1pbmxpbmVcbn1cblxuLy8gTElORSBEQVRBIFNUUlVDVFVSRVxuXG4vLyBMaW5lIG9iamVjdHMuIFRoZXNlIGhvbGQgc3RhdGUgcmVsYXRlZCB0byBhIGxpbmUsIGluY2x1ZGluZ1xuLy8gaGlnaGxpZ2h0aW5nIGluZm8gKHRoZSBzdHlsZXMgYXJyYXkpLlxudmFyIExpbmUgPSBmdW5jdGlvbih0ZXh0LCBtYXJrZWRTcGFucywgZXN0aW1hdGVIZWlnaHQpIHtcbiAgdGhpcy50ZXh0ID0gdGV4dDtcbiAgYXR0YWNoTWFya2VkU3BhbnModGhpcywgbWFya2VkU3BhbnMpO1xuICB0aGlzLmhlaWdodCA9IGVzdGltYXRlSGVpZ2h0ID8gZXN0aW1hdGVIZWlnaHQodGhpcykgOiAxO1xufTtcblxuTGluZS5wcm90b3R5cGUubGluZU5vID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbGluZU5vKHRoaXMpIH07XG5ldmVudE1peGluKExpbmUpO1xuXG4vLyBDaGFuZ2UgdGhlIGNvbnRlbnQgKHRleHQsIG1hcmtlcnMpIG9mIGEgbGluZS4gQXV0b21hdGljYWxseVxuLy8gaW52YWxpZGF0ZXMgY2FjaGVkIGluZm9ybWF0aW9uIGFuZCB0cmllcyB0byByZS1lc3RpbWF0ZSB0aGVcbi8vIGxpbmUncyBoZWlnaHQuXG5mdW5jdGlvbiB1cGRhdGVMaW5lKGxpbmUsIHRleHQsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkge1xuICBsaW5lLnRleHQgPSB0ZXh0O1xuICBpZiAobGluZS5zdGF0ZUFmdGVyKSB7IGxpbmUuc3RhdGVBZnRlciA9IG51bGw7IH1cbiAgaWYgKGxpbmUuc3R5bGVzKSB7IGxpbmUuc3R5bGVzID0gbnVsbDsgfVxuICBpZiAobGluZS5vcmRlciAhPSBudWxsKSB7IGxpbmUub3JkZXIgPSBudWxsOyB9XG4gIGRldGFjaE1hcmtlZFNwYW5zKGxpbmUpO1xuICBhdHRhY2hNYXJrZWRTcGFucyhsaW5lLCBtYXJrZWRTcGFucyk7XG4gIHZhciBlc3RIZWlnaHQgPSBlc3RpbWF0ZUhlaWdodCA/IGVzdGltYXRlSGVpZ2h0KGxpbmUpIDogMTtcbiAgaWYgKGVzdEhlaWdodCAhPSBsaW5lLmhlaWdodCkgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGVzdEhlaWdodCk7IH1cbn1cblxuLy8gRGV0YWNoIGEgbGluZSBmcm9tIHRoZSBkb2N1bWVudCB0cmVlIGFuZCBpdHMgbWFya2Vycy5cbmZ1bmN0aW9uIGNsZWFuVXBMaW5lKGxpbmUpIHtcbiAgbGluZS5wYXJlbnQgPSBudWxsO1xuICBkZXRhY2hNYXJrZWRTcGFucyhsaW5lKTtcbn1cblxuLy8gQ29udmVydCBhIHN0eWxlIGFzIHJldHVybmVkIGJ5IGEgbW9kZSAoZWl0aGVyIG51bGwsIG9yIGEgc3RyaW5nXG4vLyBjb250YWluaW5nIG9uZSBvciBtb3JlIHN0eWxlcykgdG8gYSBDU1Mgc3R5bGUuIFRoaXMgaXMgY2FjaGVkLFxuLy8gYW5kIGFsc28gbG9va3MgZm9yIGxpbmUtd2lkZSBzdHlsZXMuXG52YXIgc3R5bGVUb0NsYXNzQ2FjaGUgPSB7fTtcbnZhciBzdHlsZVRvQ2xhc3NDYWNoZVdpdGhNb2RlID0ge307XG5mdW5jdGlvbiBpbnRlcnByZXRUb2tlblN0eWxlKHN0eWxlLCBvcHRpb25zKSB7XG4gIGlmICghc3R5bGUgfHwgL15cXHMqJC8udGVzdChzdHlsZSkpIHsgcmV0dXJuIG51bGwgfVxuICB2YXIgY2FjaGUgPSBvcHRpb25zLmFkZE1vZGVDbGFzcyA/IHN0eWxlVG9DbGFzc0NhY2hlV2l0aE1vZGUgOiBzdHlsZVRvQ2xhc3NDYWNoZTtcbiAgcmV0dXJuIGNhY2hlW3N0eWxlXSB8fFxuICAgIChjYWNoZVtzdHlsZV0gPSBzdHlsZS5yZXBsYWNlKC9cXFMrL2csIFwiY20tJCZcIikpXG59XG5cbi8vIFJlbmRlciB0aGUgRE9NIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0ZXh0IG9mIGEgbGluZS4gQWxzbyBidWlsZHNcbi8vIHVwIGEgJ2xpbmUgbWFwJywgd2hpY2ggcG9pbnRzIGF0IHRoZSBET00gbm9kZXMgdGhhdCByZXByZXNlbnRcbi8vIHNwZWNpZmljIHN0cmV0Y2hlcyBvZiB0ZXh0LCBhbmQgaXMgdXNlZCBieSB0aGUgbWVhc3VyaW5nIGNvZGUuXG4vLyBUaGUgcmV0dXJuZWQgb2JqZWN0IGNvbnRhaW5zIHRoZSBET00gbm9kZSwgdGhpcyBtYXAsIGFuZFxuLy8gaW5mb3JtYXRpb24gYWJvdXQgbGluZS13aWRlIHN0eWxlcyB0aGF0IHdlcmUgc2V0IGJ5IHRoZSBtb2RlLlxuZnVuY3Rpb24gYnVpbGRMaW5lQ29udGVudChjbSwgbGluZVZpZXcpIHtcbiAgLy8gVGhlIHBhZGRpbmctcmlnaHQgZm9yY2VzIHRoZSBlbGVtZW50IHRvIGhhdmUgYSAnYm9yZGVyJywgd2hpY2hcbiAgLy8gaXMgbmVlZGVkIG9uIFdlYmtpdCB0byBiZSBhYmxlIHRvIGdldCBsaW5lLWxldmVsIGJvdW5kaW5nXG4gIC8vIHJlY3RhbmdsZXMgZm9yIGl0IChpbiBtZWFzdXJlQ2hhcikuXG4gIHZhciBjb250ZW50ID0gZWx0UChcInNwYW5cIiwgbnVsbCwgbnVsbCwgd2Via2l0ID8gXCJwYWRkaW5nLXJpZ2h0OiAuMXB4XCIgOiBudWxsKTtcbiAgdmFyIGJ1aWxkZXIgPSB7cHJlOiBlbHRQKFwicHJlXCIsIFtjb250ZW50XSwgXCJDb2RlTWlycm9yLWxpbmVcIiksIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgIGNvbDogMCwgcG9zOiAwLCBjbTogY20sXG4gICAgICAgICAgICAgICAgIHRyYWlsaW5nU3BhY2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICBzcGxpdFNwYWNlczogKGllIHx8IHdlYmtpdCkgJiYgY20uZ2V0T3B0aW9uKFwibGluZVdyYXBwaW5nXCIpfTtcbiAgbGluZVZpZXcubWVhc3VyZSA9IHt9O1xuXG4gIC8vIEl0ZXJhdGUgb3ZlciB0aGUgbG9naWNhbCBsaW5lcyB0aGF0IG1ha2UgdXAgdGhpcyB2aXN1YWwgbGluZS5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPD0gKGxpbmVWaWV3LnJlc3QgPyBsaW5lVmlldy5yZXN0Lmxlbmd0aCA6IDApOyBpKyspIHtcbiAgICB2YXIgbGluZSA9IGkgPyBsaW5lVmlldy5yZXN0W2kgLSAxXSA6IGxpbmVWaWV3LmxpbmUsIG9yZGVyID0gKHZvaWQgMCk7XG4gICAgYnVpbGRlci5wb3MgPSAwO1xuICAgIGJ1aWxkZXIuYWRkVG9rZW4gPSBidWlsZFRva2VuO1xuICAgIC8vIE9wdGlvbmFsbHkgd2lyZSBpbiBzb21lIGhhY2tzIGludG8gdGhlIHRva2VuLXJlbmRlcmluZ1xuICAgIC8vIGFsZ29yaXRobSwgdG8gZGVhbCB3aXRoIGJyb3dzZXIgcXVpcmtzLlxuICAgIGlmIChoYXNCYWRCaWRpUmVjdHMoY20uZGlzcGxheS5tZWFzdXJlKSAmJiAob3JkZXIgPSBnZXRPcmRlcihsaW5lLCBjbS5kb2MuZGlyZWN0aW9uKSkpXG4gICAgICB7IGJ1aWxkZXIuYWRkVG9rZW4gPSBidWlsZFRva2VuQmFkQmlkaShidWlsZGVyLmFkZFRva2VuLCBvcmRlcik7IH1cbiAgICBidWlsZGVyLm1hcCA9IFtdO1xuICAgIHZhciBhbGxvd0Zyb250aWVyVXBkYXRlID0gbGluZVZpZXcgIT0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkICYmIGxpbmVObyhsaW5lKTtcbiAgICBpbnNlcnRMaW5lQ29udGVudChsaW5lLCBidWlsZGVyLCBnZXRMaW5lU3R5bGVzKGNtLCBsaW5lLCBhbGxvd0Zyb250aWVyVXBkYXRlKSk7XG4gICAgaWYgKGxpbmUuc3R5bGVDbGFzc2VzKSB7XG4gICAgICBpZiAobGluZS5zdHlsZUNsYXNzZXMuYmdDbGFzcylcbiAgICAgICAgeyBidWlsZGVyLmJnQ2xhc3MgPSBqb2luQ2xhc3NlcyhsaW5lLnN0eWxlQ2xhc3Nlcy5iZ0NsYXNzLCBidWlsZGVyLmJnQ2xhc3MgfHwgXCJcIik7IH1cbiAgICAgIGlmIChsaW5lLnN0eWxlQ2xhc3Nlcy50ZXh0Q2xhc3MpXG4gICAgICAgIHsgYnVpbGRlci50ZXh0Q2xhc3MgPSBqb2luQ2xhc3NlcyhsaW5lLnN0eWxlQ2xhc3Nlcy50ZXh0Q2xhc3MsIGJ1aWxkZXIudGV4dENsYXNzIHx8IFwiXCIpOyB9XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIGF0IGxlYXN0IGEgc2luZ2xlIG5vZGUgaXMgcHJlc2VudCwgZm9yIG1lYXN1cmluZy5cbiAgICBpZiAoYnVpbGRlci5tYXAubGVuZ3RoID09IDApXG4gICAgICB7IGJ1aWxkZXIubWFwLnB1c2goMCwgMCwgYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKHplcm9XaWR0aEVsZW1lbnQoY20uZGlzcGxheS5tZWFzdXJlKSkpOyB9XG5cbiAgICAvLyBTdG9yZSB0aGUgbWFwIGFuZCBhIGNhY2hlIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgbG9naWNhbCBsaW5lXG4gICAgaWYgKGkgPT0gMCkge1xuICAgICAgbGluZVZpZXcubWVhc3VyZS5tYXAgPSBidWlsZGVyLm1hcDtcbiAgICAgIGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGUgPSB7fTtcbiAgICB9IGVsc2Uge1xuICAgICAgKGxpbmVWaWV3Lm1lYXN1cmUubWFwcyB8fCAobGluZVZpZXcubWVhc3VyZS5tYXBzID0gW10pKS5wdXNoKGJ1aWxkZXIubWFwKVxuICAgICAgOyhsaW5lVmlldy5tZWFzdXJlLmNhY2hlcyB8fCAobGluZVZpZXcubWVhc3VyZS5jYWNoZXMgPSBbXSkpLnB1c2goe30pO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNlZSBpc3N1ZSAjMjkwMVxuICBpZiAod2Via2l0KSB7XG4gICAgdmFyIGxhc3QgPSBidWlsZGVyLmNvbnRlbnQubGFzdENoaWxkO1xuICAgIGlmICgvXFxiY20tdGFiXFxiLy50ZXN0KGxhc3QuY2xhc3NOYW1lKSB8fCAobGFzdC5xdWVyeVNlbGVjdG9yICYmIGxhc3QucXVlcnlTZWxlY3RvcihcIi5jbS10YWJcIikpKVxuICAgICAgeyBidWlsZGVyLmNvbnRlbnQuY2xhc3NOYW1lID0gXCJjbS10YWItd3JhcC1oYWNrXCI7IH1cbiAgfVxuXG4gIHNpZ25hbChjbSwgXCJyZW5kZXJMaW5lXCIsIGNtLCBsaW5lVmlldy5saW5lLCBidWlsZGVyLnByZSk7XG4gIGlmIChidWlsZGVyLnByZS5jbGFzc05hbWUpXG4gICAgeyBidWlsZGVyLnRleHRDbGFzcyA9IGpvaW5DbGFzc2VzKGJ1aWxkZXIucHJlLmNsYXNzTmFtZSwgYnVpbGRlci50ZXh0Q2xhc3MgfHwgXCJcIik7IH1cblxuICByZXR1cm4gYnVpbGRlclxufVxuXG5mdW5jdGlvbiBkZWZhdWx0U3BlY2lhbENoYXJQbGFjZWhvbGRlcihjaCkge1xuICB2YXIgdG9rZW4gPSBlbHQoXCJzcGFuXCIsIFwiXFx1MjAyMlwiLCBcImNtLWludmFsaWRjaGFyXCIpO1xuICB0b2tlbi50aXRsZSA9IFwiXFxcXHVcIiArIGNoLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpO1xuICB0b2tlbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRva2VuLnRpdGxlKTtcbiAgcmV0dXJuIHRva2VuXG59XG5cbi8vIEJ1aWxkIHVwIHRoZSBET00gcmVwcmVzZW50YXRpb24gZm9yIGEgc2luZ2xlIHRva2VuLCBhbmQgYWRkIGl0IHRvXG4vLyB0aGUgbGluZSBtYXAuIFRha2VzIGNhcmUgdG8gcmVuZGVyIHNwZWNpYWwgY2hhcmFjdGVycyBzZXBhcmF0ZWx5LlxuZnVuY3Rpb24gYnVpbGRUb2tlbihidWlsZGVyLCB0ZXh0LCBzdHlsZSwgc3RhcnRTdHlsZSwgZW5kU3R5bGUsIHRpdGxlLCBjc3MpIHtcbiAgaWYgKCF0ZXh0KSB7IHJldHVybiB9XG4gIHZhciBkaXNwbGF5VGV4dCA9IGJ1aWxkZXIuc3BsaXRTcGFjZXMgPyBzcGxpdFNwYWNlcyh0ZXh0LCBidWlsZGVyLnRyYWlsaW5nU3BhY2UpIDogdGV4dDtcbiAgdmFyIHNwZWNpYWwgPSBidWlsZGVyLmNtLnN0YXRlLnNwZWNpYWxDaGFycywgbXVzdFdyYXAgPSBmYWxzZTtcbiAgdmFyIGNvbnRlbnQ7XG4gIGlmICghc3BlY2lhbC50ZXN0KHRleHQpKSB7XG4gICAgYnVpbGRlci5jb2wgKz0gdGV4dC5sZW5ndGg7XG4gICAgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRpc3BsYXlUZXh0KTtcbiAgICBidWlsZGVyLm1hcC5wdXNoKGJ1aWxkZXIucG9zLCBidWlsZGVyLnBvcyArIHRleHQubGVuZ3RoLCBjb250ZW50KTtcbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIHsgbXVzdFdyYXAgPSB0cnVlOyB9XG4gICAgYnVpbGRlci5wb3MgKz0gdGV4dC5sZW5ndGg7XG4gIH0gZWxzZSB7XG4gICAgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB2YXIgcG9zID0gMDtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgc3BlY2lhbC5sYXN0SW5kZXggPSBwb3M7XG4gICAgICB2YXIgbSA9IHNwZWNpYWwuZXhlYyh0ZXh0KTtcbiAgICAgIHZhciBza2lwcGVkID0gbSA/IG0uaW5kZXggLSBwb3MgOiB0ZXh0Lmxlbmd0aCAtIHBvcztcbiAgICAgIGlmIChza2lwcGVkKSB7XG4gICAgICAgIHZhciB0eHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkaXNwbGF5VGV4dC5zbGljZShwb3MsIHBvcyArIHNraXBwZWQpKTtcbiAgICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA5KSB7IGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWx0KFwic3BhblwiLCBbdHh0XSkpOyB9XG4gICAgICAgIGVsc2UgeyBjb250ZW50LmFwcGVuZENoaWxkKHR4dCk7IH1cbiAgICAgICAgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyBza2lwcGVkLCB0eHQpO1xuICAgICAgICBidWlsZGVyLmNvbCArPSBza2lwcGVkO1xuICAgICAgICBidWlsZGVyLnBvcyArPSBza2lwcGVkO1xuICAgICAgfVxuICAgICAgaWYgKCFtKSB7IGJyZWFrIH1cbiAgICAgIHBvcyArPSBza2lwcGVkICsgMTtcbiAgICAgIHZhciB0eHQkMSA9ICh2b2lkIDApO1xuICAgICAgaWYgKG1bMF0gPT0gXCJcXHRcIikge1xuICAgICAgICB2YXIgdGFiU2l6ZSA9IGJ1aWxkZXIuY20ub3B0aW9ucy50YWJTaXplLCB0YWJXaWR0aCA9IHRhYlNpemUgLSBidWlsZGVyLmNvbCAlIHRhYlNpemU7XG4gICAgICAgIHR4dCQxID0gY29udGVudC5hcHBlbmRDaGlsZChlbHQoXCJzcGFuXCIsIHNwYWNlU3RyKHRhYldpZHRoKSwgXCJjbS10YWJcIikpO1xuICAgICAgICB0eHQkMS5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwicHJlc2VudGF0aW9uXCIpO1xuICAgICAgICB0eHQkMS5zZXRBdHRyaWJ1dGUoXCJjbS10ZXh0XCIsIFwiXFx0XCIpO1xuICAgICAgICBidWlsZGVyLmNvbCArPSB0YWJXaWR0aDtcbiAgICAgIH0gZWxzZSBpZiAobVswXSA9PSBcIlxcclwiIHx8IG1bMF0gPT0gXCJcXG5cIikge1xuICAgICAgICB0eHQkMSA9IGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWx0KFwic3BhblwiLCBtWzBdID09IFwiXFxyXCIgPyBcIlxcdTI0MGRcIiA6IFwiXFx1MjQyNFwiLCBcImNtLWludmFsaWRjaGFyXCIpKTtcbiAgICAgICAgdHh0JDEuc2V0QXR0cmlidXRlKFwiY20tdGV4dFwiLCBtWzBdKTtcbiAgICAgICAgYnVpbGRlci5jb2wgKz0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHR4dCQxID0gYnVpbGRlci5jbS5vcHRpb25zLnNwZWNpYWxDaGFyUGxhY2Vob2xkZXIobVswXSk7XG4gICAgICAgIHR4dCQxLnNldEF0dHJpYnV0ZShcImNtLXRleHRcIiwgbVswXSk7XG4gICAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgeyBjb250ZW50LmFwcGVuZENoaWxkKGVsdChcInNwYW5cIiwgW3R4dCQxXSkpOyB9XG4gICAgICAgIGVsc2UgeyBjb250ZW50LmFwcGVuZENoaWxkKHR4dCQxKTsgfVxuICAgICAgICBidWlsZGVyLmNvbCArPSAxO1xuICAgICAgfVxuICAgICAgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyAxLCB0eHQkMSk7XG4gICAgICBidWlsZGVyLnBvcysrO1xuICAgIH1cbiAgfVxuICBidWlsZGVyLnRyYWlsaW5nU3BhY2UgPSBkaXNwbGF5VGV4dC5jaGFyQ29kZUF0KHRleHQubGVuZ3RoIC0gMSkgPT0gMzI7XG4gIGlmIChzdHlsZSB8fCBzdGFydFN0eWxlIHx8IGVuZFN0eWxlIHx8IG11c3RXcmFwIHx8IGNzcykge1xuICAgIHZhciBmdWxsU3R5bGUgPSBzdHlsZSB8fCBcIlwiO1xuICAgIGlmIChzdGFydFN0eWxlKSB7IGZ1bGxTdHlsZSArPSBzdGFydFN0eWxlOyB9XG4gICAgaWYgKGVuZFN0eWxlKSB7IGZ1bGxTdHlsZSArPSBlbmRTdHlsZTsgfVxuICAgIHZhciB0b2tlbiA9IGVsdChcInNwYW5cIiwgW2NvbnRlbnRdLCBmdWxsU3R5bGUsIGNzcyk7XG4gICAgaWYgKHRpdGxlKSB7IHRva2VuLnRpdGxlID0gdGl0bGU7IH1cbiAgICByZXR1cm4gYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKHRva2VuKVxuICB9XG4gIGJ1aWxkZXIuY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50KTtcbn1cblxuZnVuY3Rpb24gc3BsaXRTcGFjZXModGV4dCwgdHJhaWxpbmdCZWZvcmUpIHtcbiAgaWYgKHRleHQubGVuZ3RoID4gMSAmJiAhLyAgLy50ZXN0KHRleHQpKSB7IHJldHVybiB0ZXh0IH1cbiAgdmFyIHNwYWNlQmVmb3JlID0gdHJhaWxpbmdCZWZvcmUsIHJlc3VsdCA9IFwiXCI7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgIHZhciBjaCA9IHRleHQuY2hhckF0KGkpO1xuICAgIGlmIChjaCA9PSBcIiBcIiAmJiBzcGFjZUJlZm9yZSAmJiAoaSA9PSB0ZXh0Lmxlbmd0aCAtIDEgfHwgdGV4dC5jaGFyQ29kZUF0KGkgKyAxKSA9PSAzMikpXG4gICAgICB7IGNoID0gXCJcXHUwMGEwXCI7IH1cbiAgICByZXN1bHQgKz0gY2g7XG4gICAgc3BhY2VCZWZvcmUgPSBjaCA9PSBcIiBcIjtcbiAgfVxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8vIFdvcmsgYXJvdW5kIG5vbnNlbnNlIGRpbWVuc2lvbnMgYmVpbmcgcmVwb3J0ZWQgZm9yIHN0cmV0Y2hlcyBvZlxuLy8gcmlnaHQtdG8tbGVmdCB0ZXh0LlxuZnVuY3Rpb24gYnVpbGRUb2tlbkJhZEJpZGkoaW5uZXIsIG9yZGVyKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoYnVpbGRlciwgdGV4dCwgc3R5bGUsIHN0YXJ0U3R5bGUsIGVuZFN0eWxlLCB0aXRsZSwgY3NzKSB7XG4gICAgc3R5bGUgPSBzdHlsZSA/IHN0eWxlICsgXCIgY20tZm9yY2UtYm9yZGVyXCIgOiBcImNtLWZvcmNlLWJvcmRlclwiO1xuICAgIHZhciBzdGFydCA9IGJ1aWxkZXIucG9zLCBlbmQgPSBzdGFydCArIHRleHQubGVuZ3RoO1xuICAgIGZvciAoOzspIHtcbiAgICAgIC8vIEZpbmQgdGhlIHBhcnQgdGhhdCBvdmVybGFwcyB3aXRoIHRoZSBzdGFydCBvZiB0aGlzIHRleHRcbiAgICAgIHZhciBwYXJ0ID0gKHZvaWQgMCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHBhcnQgPSBvcmRlcltpXTtcbiAgICAgICAgaWYgKHBhcnQudG8gPiBzdGFydCAmJiBwYXJ0LmZyb20gPD0gc3RhcnQpIHsgYnJlYWsgfVxuICAgICAgfVxuICAgICAgaWYgKHBhcnQudG8gPj0gZW5kKSB7IHJldHVybiBpbm5lcihidWlsZGVyLCB0ZXh0LCBzdHlsZSwgc3RhcnRTdHlsZSwgZW5kU3R5bGUsIHRpdGxlLCBjc3MpIH1cbiAgICAgIGlubmVyKGJ1aWxkZXIsIHRleHQuc2xpY2UoMCwgcGFydC50byAtIHN0YXJ0KSwgc3R5bGUsIHN0YXJ0U3R5bGUsIG51bGwsIHRpdGxlLCBjc3MpO1xuICAgICAgc3RhcnRTdHlsZSA9IG51bGw7XG4gICAgICB0ZXh0ID0gdGV4dC5zbGljZShwYXJ0LnRvIC0gc3RhcnQpO1xuICAgICAgc3RhcnQgPSBwYXJ0LnRvO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZENvbGxhcHNlZFNwYW4oYnVpbGRlciwgc2l6ZSwgbWFya2VyLCBpZ25vcmVXaWRnZXQpIHtcbiAgdmFyIHdpZGdldCA9ICFpZ25vcmVXaWRnZXQgJiYgbWFya2VyLndpZGdldE5vZGU7XG4gIGlmICh3aWRnZXQpIHsgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyBzaXplLCB3aWRnZXQpOyB9XG4gIGlmICghaWdub3JlV2lkZ2V0ICYmIGJ1aWxkZXIuY20uZGlzcGxheS5pbnB1dC5uZWVkc0NvbnRlbnRBdHRyaWJ1dGUpIHtcbiAgICBpZiAoIXdpZGdldClcbiAgICAgIHsgd2lkZ2V0ID0gYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpKTsgfVxuICAgIHdpZGdldC5zZXRBdHRyaWJ1dGUoXCJjbS1tYXJrZXJcIiwgbWFya2VyLmlkKTtcbiAgfVxuICBpZiAod2lkZ2V0KSB7XG4gICAgYnVpbGRlci5jbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUod2lkZ2V0KTtcbiAgICBidWlsZGVyLmNvbnRlbnQuYXBwZW5kQ2hpbGQod2lkZ2V0KTtcbiAgfVxuICBidWlsZGVyLnBvcyArPSBzaXplO1xuICBidWlsZGVyLnRyYWlsaW5nU3BhY2UgPSBmYWxzZTtcbn1cblxuLy8gT3V0cHV0cyBhIG51bWJlciBvZiBzcGFucyB0byBtYWtlIHVwIGEgbGluZSwgdGFraW5nIGhpZ2hsaWdodGluZ1xuLy8gYW5kIG1hcmtlZCB0ZXh0IGludG8gYWNjb3VudC5cbmZ1bmN0aW9uIGluc2VydExpbmVDb250ZW50KGxpbmUsIGJ1aWxkZXIsIHN0eWxlcykge1xuICB2YXIgc3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zLCBhbGxUZXh0ID0gbGluZS50ZXh0LCBhdCA9IDA7XG4gIGlmICghc3BhbnMpIHtcbiAgICBmb3IgKHZhciBpJDEgPSAxOyBpJDEgPCBzdHlsZXMubGVuZ3RoOyBpJDErPTIpXG4gICAgICB7IGJ1aWxkZXIuYWRkVG9rZW4oYnVpbGRlciwgYWxsVGV4dC5zbGljZShhdCwgYXQgPSBzdHlsZXNbaSQxXSksIGludGVycHJldFRva2VuU3R5bGUoc3R5bGVzW2kkMSsxXSwgYnVpbGRlci5jbS5vcHRpb25zKSk7IH1cbiAgICByZXR1cm5cbiAgfVxuXG4gIHZhciBsZW4gPSBhbGxUZXh0Lmxlbmd0aCwgcG9zID0gMCwgaSA9IDEsIHRleHQgPSBcIlwiLCBzdHlsZSwgY3NzO1xuICB2YXIgbmV4dENoYW5nZSA9IDAsIHNwYW5TdHlsZSwgc3BhbkVuZFN0eWxlLCBzcGFuU3RhcnRTdHlsZSwgdGl0bGUsIGNvbGxhcHNlZDtcbiAgZm9yICg7Oykge1xuICAgIGlmIChuZXh0Q2hhbmdlID09IHBvcykgeyAvLyBVcGRhdGUgY3VycmVudCBtYXJrZXIgc2V0XG4gICAgICBzcGFuU3R5bGUgPSBzcGFuRW5kU3R5bGUgPSBzcGFuU3RhcnRTdHlsZSA9IHRpdGxlID0gY3NzID0gXCJcIjtcbiAgICAgIGNvbGxhcHNlZCA9IG51bGw7IG5leHRDaGFuZ2UgPSBJbmZpbml0eTtcbiAgICAgIHZhciBmb3VuZEJvb2ttYXJrcyA9IFtdLCBlbmRTdHlsZXMgPSAodm9pZCAwKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3BhbnMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgdmFyIHNwID0gc3BhbnNbal0sIG0gPSBzcC5tYXJrZXI7XG4gICAgICAgIGlmIChtLnR5cGUgPT0gXCJib29rbWFya1wiICYmIHNwLmZyb20gPT0gcG9zICYmIG0ud2lkZ2V0Tm9kZSkge1xuICAgICAgICAgIGZvdW5kQm9va21hcmtzLnB1c2gobSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc3AuZnJvbSA8PSBwb3MgJiYgKHNwLnRvID09IG51bGwgfHwgc3AudG8gPiBwb3MgfHwgbS5jb2xsYXBzZWQgJiYgc3AudG8gPT0gcG9zICYmIHNwLmZyb20gPT0gcG9zKSkge1xuICAgICAgICAgIGlmIChzcC50byAhPSBudWxsICYmIHNwLnRvICE9IHBvcyAmJiBuZXh0Q2hhbmdlID4gc3AudG8pIHtcbiAgICAgICAgICAgIG5leHRDaGFuZ2UgPSBzcC50bztcbiAgICAgICAgICAgIHNwYW5FbmRTdHlsZSA9IFwiXCI7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtLmNsYXNzTmFtZSkgeyBzcGFuU3R5bGUgKz0gXCIgXCIgKyBtLmNsYXNzTmFtZTsgfVxuICAgICAgICAgIGlmIChtLmNzcykgeyBjc3MgPSAoY3NzID8gY3NzICsgXCI7XCIgOiBcIlwiKSArIG0uY3NzOyB9XG4gICAgICAgICAgaWYgKG0uc3RhcnRTdHlsZSAmJiBzcC5mcm9tID09IHBvcykgeyBzcGFuU3RhcnRTdHlsZSArPSBcIiBcIiArIG0uc3RhcnRTdHlsZTsgfVxuICAgICAgICAgIGlmIChtLmVuZFN0eWxlICYmIHNwLnRvID09IG5leHRDaGFuZ2UpIHsgKGVuZFN0eWxlcyB8fCAoZW5kU3R5bGVzID0gW10pKS5wdXNoKG0uZW5kU3R5bGUsIHNwLnRvKTsgfVxuICAgICAgICAgIGlmIChtLnRpdGxlICYmICF0aXRsZSkgeyB0aXRsZSA9IG0udGl0bGU7IH1cbiAgICAgICAgICBpZiAobS5jb2xsYXBzZWQgJiYgKCFjb2xsYXBzZWQgfHwgY29tcGFyZUNvbGxhcHNlZE1hcmtlcnMoY29sbGFwc2VkLm1hcmtlciwgbSkgPCAwKSlcbiAgICAgICAgICAgIHsgY29sbGFwc2VkID0gc3A7IH1cbiAgICAgICAgfSBlbHNlIGlmIChzcC5mcm9tID4gcG9zICYmIG5leHRDaGFuZ2UgPiBzcC5mcm9tKSB7XG4gICAgICAgICAgbmV4dENoYW5nZSA9IHNwLmZyb207XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChlbmRTdHlsZXMpIHsgZm9yICh2YXIgaiQxID0gMDsgaiQxIDwgZW5kU3R5bGVzLmxlbmd0aDsgaiQxICs9IDIpXG4gICAgICAgIHsgaWYgKGVuZFN0eWxlc1tqJDEgKyAxXSA9PSBuZXh0Q2hhbmdlKSB7IHNwYW5FbmRTdHlsZSArPSBcIiBcIiArIGVuZFN0eWxlc1tqJDFdOyB9IH0gfVxuXG4gICAgICBpZiAoIWNvbGxhcHNlZCB8fCBjb2xsYXBzZWQuZnJvbSA9PSBwb3MpIHsgZm9yICh2YXIgaiQyID0gMDsgaiQyIDwgZm91bmRCb29rbWFya3MubGVuZ3RoOyArK2okMilcbiAgICAgICAgeyBidWlsZENvbGxhcHNlZFNwYW4oYnVpbGRlciwgMCwgZm91bmRCb29rbWFya3NbaiQyXSk7IH0gfVxuICAgICAgaWYgKGNvbGxhcHNlZCAmJiAoY29sbGFwc2VkLmZyb20gfHwgMCkgPT0gcG9zKSB7XG4gICAgICAgIGJ1aWxkQ29sbGFwc2VkU3BhbihidWlsZGVyLCAoY29sbGFwc2VkLnRvID09IG51bGwgPyBsZW4gKyAxIDogY29sbGFwc2VkLnRvKSAtIHBvcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxhcHNlZC5tYXJrZXIsIGNvbGxhcHNlZC5mcm9tID09IG51bGwpO1xuICAgICAgICBpZiAoY29sbGFwc2VkLnRvID09IG51bGwpIHsgcmV0dXJuIH1cbiAgICAgICAgaWYgKGNvbGxhcHNlZC50byA9PSBwb3MpIHsgY29sbGFwc2VkID0gZmFsc2U7IH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHBvcyA+PSBsZW4pIHsgYnJlYWsgfVxuXG4gICAgdmFyIHVwdG8gPSBNYXRoLm1pbihsZW4sIG5leHRDaGFuZ2UpO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICB2YXIgZW5kID0gcG9zICsgdGV4dC5sZW5ndGg7XG4gICAgICAgIGlmICghY29sbGFwc2VkKSB7XG4gICAgICAgICAgdmFyIHRva2VuVGV4dCA9IGVuZCA+IHVwdG8gPyB0ZXh0LnNsaWNlKDAsIHVwdG8gLSBwb3MpIDogdGV4dDtcbiAgICAgICAgICBidWlsZGVyLmFkZFRva2VuKGJ1aWxkZXIsIHRva2VuVGV4dCwgc3R5bGUgPyBzdHlsZSArIHNwYW5TdHlsZSA6IHNwYW5TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW5TdGFydFN0eWxlLCBwb3MgKyB0b2tlblRleHQubGVuZ3RoID09IG5leHRDaGFuZ2UgPyBzcGFuRW5kU3R5bGUgOiBcIlwiLCB0aXRsZSwgY3NzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kID49IHVwdG8pIHt0ZXh0ID0gdGV4dC5zbGljZSh1cHRvIC0gcG9zKTsgcG9zID0gdXB0bzsgYnJlYWt9XG4gICAgICAgIHBvcyA9IGVuZDtcbiAgICAgICAgc3BhblN0YXJ0U3R5bGUgPSBcIlwiO1xuICAgICAgfVxuICAgICAgdGV4dCA9IGFsbFRleHQuc2xpY2UoYXQsIGF0ID0gc3R5bGVzW2krK10pO1xuICAgICAgc3R5bGUgPSBpbnRlcnByZXRUb2tlblN0eWxlKHN0eWxlc1tpKytdLCBidWlsZGVyLmNtLm9wdGlvbnMpO1xuICAgIH1cbiAgfVxufVxuXG5cbi8vIFRoZXNlIG9iamVjdHMgYXJlIHVzZWQgdG8gcmVwcmVzZW50IHRoZSB2aXNpYmxlIChjdXJyZW50bHkgZHJhd24pXG4vLyBwYXJ0IG9mIHRoZSBkb2N1bWVudC4gQSBMaW5lVmlldyBtYXkgY29ycmVzcG9uZCB0byBtdWx0aXBsZVxuLy8gbG9naWNhbCBsaW5lcywgaWYgdGhvc2UgYXJlIGNvbm5lY3RlZCBieSBjb2xsYXBzZWQgcmFuZ2VzLlxuZnVuY3Rpb24gTGluZVZpZXcoZG9jLCBsaW5lLCBsaW5lTikge1xuICAvLyBUaGUgc3RhcnRpbmcgbGluZVxuICB0aGlzLmxpbmUgPSBsaW5lO1xuICAvLyBDb250aW51aW5nIGxpbmVzLCBpZiBhbnlcbiAgdGhpcy5yZXN0ID0gdmlzdWFsTGluZUNvbnRpbnVlZChsaW5lKTtcbiAgLy8gTnVtYmVyIG9mIGxvZ2ljYWwgbGluZXMgaW4gdGhpcyB2aXN1YWwgbGluZVxuICB0aGlzLnNpemUgPSB0aGlzLnJlc3QgPyBsaW5lTm8obHN0KHRoaXMucmVzdCkpIC0gbGluZU4gKyAxIDogMTtcbiAgdGhpcy5ub2RlID0gdGhpcy50ZXh0ID0gbnVsbDtcbiAgdGhpcy5oaWRkZW4gPSBsaW5lSXNIaWRkZW4oZG9jLCBsaW5lKTtcbn1cblxuLy8gQ3JlYXRlIGEgcmFuZ2Ugb2YgTGluZVZpZXcgb2JqZWN0cyBmb3IgdGhlIGdpdmVuIGxpbmVzLlxuZnVuY3Rpb24gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIHRvKSB7XG4gIHZhciBhcnJheSA9IFtdLCBuZXh0UG9zO1xuICBmb3IgKHZhciBwb3MgPSBmcm9tOyBwb3MgPCB0bzsgcG9zID0gbmV4dFBvcykge1xuICAgIHZhciB2aWV3ID0gbmV3IExpbmVWaWV3KGNtLmRvYywgZ2V0TGluZShjbS5kb2MsIHBvcyksIHBvcyk7XG4gICAgbmV4dFBvcyA9IHBvcyArIHZpZXcuc2l6ZTtcbiAgICBhcnJheS5wdXNoKHZpZXcpO1xuICB9XG4gIHJldHVybiBhcnJheVxufVxuXG52YXIgb3BlcmF0aW9uR3JvdXAgPSBudWxsO1xuXG5mdW5jdGlvbiBwdXNoT3BlcmF0aW9uKG9wKSB7XG4gIGlmIChvcGVyYXRpb25Hcm91cCkge1xuICAgIG9wZXJhdGlvbkdyb3VwLm9wcy5wdXNoKG9wKTtcbiAgfSBlbHNlIHtcbiAgICBvcC5vd25zR3JvdXAgPSBvcGVyYXRpb25Hcm91cCA9IHtcbiAgICAgIG9wczogW29wXSxcbiAgICAgIGRlbGF5ZWRDYWxsYmFja3M6IFtdXG4gICAgfTtcbiAgfVxufVxuXG5mdW5jdGlvbiBmaXJlQ2FsbGJhY2tzRm9yT3BzKGdyb3VwKSB7XG4gIC8vIENhbGxzIGRlbGF5ZWQgY2FsbGJhY2tzIGFuZCBjdXJzb3JBY3Rpdml0eSBoYW5kbGVycyB1bnRpbCBub1xuICAvLyBuZXcgb25lcyBhcHBlYXJcbiAgdmFyIGNhbGxiYWNrcyA9IGdyb3VwLmRlbGF5ZWRDYWxsYmFja3MsIGkgPSAwO1xuICBkbyB7XG4gICAgZm9yICg7IGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpKyspXG4gICAgICB7IGNhbGxiYWNrc1tpXS5jYWxsKG51bGwpOyB9XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBncm91cC5vcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIHZhciBvcCA9IGdyb3VwLm9wc1tqXTtcbiAgICAgIGlmIChvcC5jdXJzb3JBY3Rpdml0eUhhbmRsZXJzKVxuICAgICAgICB7IHdoaWxlIChvcC5jdXJzb3JBY3Rpdml0eUNhbGxlZCA8IG9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMubGVuZ3RoKVxuICAgICAgICAgIHsgb3AuY3Vyc29yQWN0aXZpdHlIYW5kbGVyc1tvcC5jdXJzb3JBY3Rpdml0eUNhbGxlZCsrXS5jYWxsKG51bGwsIG9wLmNtKTsgfSB9XG4gICAgfVxuICB9IHdoaWxlIChpIDwgY2FsbGJhY2tzLmxlbmd0aClcbn1cblxuZnVuY3Rpb24gZmluaXNoT3BlcmF0aW9uKG9wLCBlbmRDYikge1xuICB2YXIgZ3JvdXAgPSBvcC5vd25zR3JvdXA7XG4gIGlmICghZ3JvdXApIHsgcmV0dXJuIH1cblxuICB0cnkgeyBmaXJlQ2FsbGJhY2tzRm9yT3BzKGdyb3VwKTsgfVxuICBmaW5hbGx5IHtcbiAgICBvcGVyYXRpb25Hcm91cCA9IG51bGw7XG4gICAgZW5kQ2IoZ3JvdXApO1xuICB9XG59XG5cbnZhciBvcnBoYW5EZWxheWVkQ2FsbGJhY2tzID0gbnVsbDtcblxuLy8gT2Z0ZW4sIHdlIHdhbnQgdG8gc2lnbmFsIGV2ZW50cyBhdCBhIHBvaW50IHdoZXJlIHdlIGFyZSBpbiB0aGVcbi8vIG1pZGRsZSBvZiBzb21lIHdvcmssIGJ1dCBkb24ndCB3YW50IHRoZSBoYW5kbGVyIHRvIHN0YXJ0IGNhbGxpbmdcbi8vIG90aGVyIG1ldGhvZHMgb24gdGhlIGVkaXRvciwgd2hpY2ggbWlnaHQgYmUgaW4gYW4gaW5jb25zaXN0ZW50XG4vLyBzdGF0ZSBvciBzaW1wbHkgbm90IGV4cGVjdCBhbnkgb3RoZXIgZXZlbnRzIHRvIGhhcHBlbi5cbi8vIHNpZ25hbExhdGVyIGxvb2tzIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBoYW5kbGVycywgYW5kIHNjaGVkdWxlc1xuLy8gdGhlbSB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBsYXN0IG9wZXJhdGlvbiBlbmRzLCBvciwgaWYgbm9cbi8vIG9wZXJhdGlvbiBpcyBhY3RpdmUsIHdoZW4gYSB0aW1lb3V0IGZpcmVzLlxuZnVuY3Rpb24gc2lnbmFsTGF0ZXIoZW1pdHRlciwgdHlwZSAvKiwgdmFsdWVzLi4uKi8pIHtcbiAgdmFyIGFyciA9IGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUpO1xuICBpZiAoIWFyci5sZW5ndGgpIHsgcmV0dXJuIH1cbiAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpLCBsaXN0O1xuICBpZiAob3BlcmF0aW9uR3JvdXApIHtcbiAgICBsaXN0ID0gb3BlcmF0aW9uR3JvdXAuZGVsYXllZENhbGxiYWNrcztcbiAgfSBlbHNlIGlmIChvcnBoYW5EZWxheWVkQ2FsbGJhY2tzKSB7XG4gICAgbGlzdCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3M7XG4gIH0gZWxzZSB7XG4gICAgbGlzdCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3MgPSBbXTtcbiAgICBzZXRUaW1lb3V0KGZpcmVPcnBoYW5EZWxheWVkLCAwKTtcbiAgfVxuICB2YXIgbG9vcCA9IGZ1bmN0aW9uICggaSApIHtcbiAgICBsaXN0LnB1c2goZnVuY3Rpb24gKCkgeyByZXR1cm4gYXJyW2ldLmFwcGx5KG51bGwsIGFyZ3MpOyB9KTtcbiAgfTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSlcbiAgICBsb29wKCBpICk7XG59XG5cbmZ1bmN0aW9uIGZpcmVPcnBoYW5EZWxheWVkKCkge1xuICB2YXIgZGVsYXllZCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3M7XG4gIG9ycGhhbkRlbGF5ZWRDYWxsYmFja3MgPSBudWxsO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGRlbGF5ZWQubGVuZ3RoOyArK2kpIHsgZGVsYXllZFtpXSgpOyB9XG59XG5cbi8vIFdoZW4gYW4gYXNwZWN0IG9mIGEgbGluZSBjaGFuZ2VzLCBhIHN0cmluZyBpcyBhZGRlZCB0b1xuLy8gbGluZVZpZXcuY2hhbmdlcy4gVGhpcyB1cGRhdGVzIHRoZSByZWxldmFudCBwYXJ0IG9mIHRoZSBsaW5lJ3Ncbi8vIERPTSBzdHJ1Y3R1cmUuXG5mdW5jdGlvbiB1cGRhdGVMaW5lRm9yQ2hhbmdlcyhjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKSB7XG4gIGZvciAodmFyIGogPSAwOyBqIDwgbGluZVZpZXcuY2hhbmdlcy5sZW5ndGg7IGorKykge1xuICAgIHZhciB0eXBlID0gbGluZVZpZXcuY2hhbmdlc1tqXTtcbiAgICBpZiAodHlwZSA9PSBcInRleHRcIikgeyB1cGRhdGVMaW5lVGV4dChjbSwgbGluZVZpZXcpOyB9XG4gICAgZWxzZSBpZiAodHlwZSA9PSBcImd1dHRlclwiKSB7IHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7IH1cbiAgICBlbHNlIGlmICh0eXBlID09IFwiY2xhc3NcIikgeyB1cGRhdGVMaW5lQ2xhc3NlcyhjbSwgbGluZVZpZXcpOyB9XG4gICAgZWxzZSBpZiAodHlwZSA9PSBcIndpZGdldFwiKSB7IHVwZGF0ZUxpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcyk7IH1cbiAgfVxuICBsaW5lVmlldy5jaGFuZ2VzID0gbnVsbDtcbn1cblxuLy8gTGluZXMgd2l0aCBndXR0ZXIgZWxlbWVudHMsIHdpZGdldHMgb3IgYSBiYWNrZ3JvdW5kIGNsYXNzIG5lZWQgdG9cbi8vIGJlIHdyYXBwZWQsIGFuZCBoYXZlIHRoZSBleHRyYSBlbGVtZW50cyBhZGRlZCB0byB0aGUgd3JhcHBlciBkaXZcbmZ1bmN0aW9uIGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KSB7XG4gIGlmIChsaW5lVmlldy5ub2RlID09IGxpbmVWaWV3LnRleHQpIHtcbiAgICBsaW5lVmlldy5ub2RlID0gZWx0KFwiZGl2XCIsIG51bGwsIG51bGwsIFwicG9zaXRpb246IHJlbGF0aXZlXCIpO1xuICAgIGlmIChsaW5lVmlldy50ZXh0LnBhcmVudE5vZGUpXG4gICAgICB7IGxpbmVWaWV3LnRleHQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobGluZVZpZXcubm9kZSwgbGluZVZpZXcudGV4dCk7IH1cbiAgICBsaW5lVmlldy5ub2RlLmFwcGVuZENoaWxkKGxpbmVWaWV3LnRleHQpO1xuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOCkgeyBsaW5lVmlldy5ub2RlLnN0eWxlLnpJbmRleCA9IDI7IH1cbiAgfVxuICByZXR1cm4gbGluZVZpZXcubm9kZVxufVxuXG5mdW5jdGlvbiB1cGRhdGVMaW5lQmFja2dyb3VuZChjbSwgbGluZVZpZXcpIHtcbiAgdmFyIGNscyA9IGxpbmVWaWV3LmJnQ2xhc3MgPyBsaW5lVmlldy5iZ0NsYXNzICsgXCIgXCIgKyAobGluZVZpZXcubGluZS5iZ0NsYXNzIHx8IFwiXCIpIDogbGluZVZpZXcubGluZS5iZ0NsYXNzO1xuICBpZiAoY2xzKSB7IGNscyArPSBcIiBDb2RlTWlycm9yLWxpbmViYWNrZ3JvdW5kXCI7IH1cbiAgaWYgKGxpbmVWaWV3LmJhY2tncm91bmQpIHtcbiAgICBpZiAoY2xzKSB7IGxpbmVWaWV3LmJhY2tncm91bmQuY2xhc3NOYW1lID0gY2xzOyB9XG4gICAgZWxzZSB7IGxpbmVWaWV3LmJhY2tncm91bmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsaW5lVmlldy5iYWNrZ3JvdW5kKTsgbGluZVZpZXcuYmFja2dyb3VuZCA9IG51bGw7IH1cbiAgfSBlbHNlIGlmIChjbHMpIHtcbiAgICB2YXIgd3JhcCA9IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KTtcbiAgICBsaW5lVmlldy5iYWNrZ3JvdW5kID0gd3JhcC5pbnNlcnRCZWZvcmUoZWx0KFwiZGl2XCIsIG51bGwsIGNscyksIHdyYXAuZmlyc3RDaGlsZCk7XG4gICAgY20uZGlzcGxheS5pbnB1dC5zZXRVbmVkaXRhYmxlKGxpbmVWaWV3LmJhY2tncm91bmQpO1xuICB9XG59XG5cbi8vIFdyYXBwZXIgYXJvdW5kIGJ1aWxkTGluZUNvbnRlbnQgd2hpY2ggd2lsbCByZXVzZSB0aGUgc3RydWN0dXJlXG4vLyBpbiBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgd2hlbiBwb3NzaWJsZS5cbmZ1bmN0aW9uIGdldExpbmVDb250ZW50KGNtLCBsaW5lVmlldykge1xuICB2YXIgZXh0ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkO1xuICBpZiAoZXh0ICYmIGV4dC5saW5lID09IGxpbmVWaWV3LmxpbmUpIHtcbiAgICBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBudWxsO1xuICAgIGxpbmVWaWV3Lm1lYXN1cmUgPSBleHQubWVhc3VyZTtcbiAgICByZXR1cm4gZXh0LmJ1aWx0XG4gIH1cbiAgcmV0dXJuIGJ1aWxkTGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KVxufVxuXG4vLyBSZWRyYXcgdGhlIGxpbmUncyB0ZXh0LiBJbnRlcmFjdHMgd2l0aCB0aGUgYmFja2dyb3VuZCBhbmQgdGV4dFxuLy8gY2xhc3NlcyBiZWNhdXNlIHRoZSBtb2RlIG1heSBvdXRwdXQgdG9rZW5zIHRoYXQgaW5mbHVlbmNlIHRoZXNlXG4vLyBjbGFzc2VzLlxuZnVuY3Rpb24gdXBkYXRlTGluZVRleHQoY20sIGxpbmVWaWV3KSB7XG4gIHZhciBjbHMgPSBsaW5lVmlldy50ZXh0LmNsYXNzTmFtZTtcbiAgdmFyIGJ1aWx0ID0gZ2V0TGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KTtcbiAgaWYgKGxpbmVWaWV3LnRleHQgPT0gbGluZVZpZXcubm9kZSkgeyBsaW5lVmlldy5ub2RlID0gYnVpbHQucHJlOyB9XG4gIGxpbmVWaWV3LnRleHQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoYnVpbHQucHJlLCBsaW5lVmlldy50ZXh0KTtcbiAgbGluZVZpZXcudGV4dCA9IGJ1aWx0LnByZTtcbiAgaWYgKGJ1aWx0LmJnQ2xhc3MgIT0gbGluZVZpZXcuYmdDbGFzcyB8fCBidWlsdC50ZXh0Q2xhc3MgIT0gbGluZVZpZXcudGV4dENsYXNzKSB7XG4gICAgbGluZVZpZXcuYmdDbGFzcyA9IGJ1aWx0LmJnQ2xhc3M7XG4gICAgbGluZVZpZXcudGV4dENsYXNzID0gYnVpbHQudGV4dENsYXNzO1xuICAgIHVwZGF0ZUxpbmVDbGFzc2VzKGNtLCBsaW5lVmlldyk7XG4gIH0gZWxzZSBpZiAoY2xzKSB7XG4gICAgbGluZVZpZXcudGV4dC5jbGFzc05hbWUgPSBjbHM7XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlTGluZUNsYXNzZXMoY20sIGxpbmVWaWV3KSB7XG4gIHVwZGF0ZUxpbmVCYWNrZ3JvdW5kKGNtLCBsaW5lVmlldyk7XG4gIGlmIChsaW5lVmlldy5saW5lLndyYXBDbGFzcylcbiAgICB7IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KS5jbGFzc05hbWUgPSBsaW5lVmlldy5saW5lLndyYXBDbGFzczsgfVxuICBlbHNlIGlmIChsaW5lVmlldy5ub2RlICE9IGxpbmVWaWV3LnRleHQpXG4gICAgeyBsaW5lVmlldy5ub2RlLmNsYXNzTmFtZSA9IFwiXCI7IH1cbiAgdmFyIHRleHRDbGFzcyA9IGxpbmVWaWV3LnRleHRDbGFzcyA/IGxpbmVWaWV3LnRleHRDbGFzcyArIFwiIFwiICsgKGxpbmVWaWV3LmxpbmUudGV4dENsYXNzIHx8IFwiXCIpIDogbGluZVZpZXcubGluZS50ZXh0Q2xhc3M7XG4gIGxpbmVWaWV3LnRleHQuY2xhc3NOYW1lID0gdGV4dENsYXNzIHx8IFwiXCI7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcykge1xuICBpZiAobGluZVZpZXcuZ3V0dGVyKSB7XG4gICAgbGluZVZpZXcubm9kZS5yZW1vdmVDaGlsZChsaW5lVmlldy5ndXR0ZXIpO1xuICAgIGxpbmVWaWV3Lmd1dHRlciA9IG51bGw7XG4gIH1cbiAgaWYgKGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQpIHtcbiAgICBsaW5lVmlldy5ub2RlLnJlbW92ZUNoaWxkKGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQpO1xuICAgIGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQgPSBudWxsO1xuICB9XG4gIGlmIChsaW5lVmlldy5saW5lLmd1dHRlckNsYXNzKSB7XG4gICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7XG4gICAgbGluZVZpZXcuZ3V0dGVyQmFja2dyb3VuZCA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyLWJhY2tncm91bmQgXCIgKyBsaW5lVmlldy5saW5lLmd1dHRlckNsYXNzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFwibGVmdDogXCIgKyAoY20ub3B0aW9ucy5maXhlZEd1dHRlciA/IGRpbXMuZml4ZWRQb3MgOiAtZGltcy5ndXR0ZXJUb3RhbFdpZHRoKSArIFwicHg7IHdpZHRoOiBcIiArIChkaW1zLmd1dHRlclRvdGFsV2lkdGgpICsgXCJweFwiKSk7XG4gICAgY20uZGlzcGxheS5pbnB1dC5zZXRVbmVkaXRhYmxlKGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQpO1xuICAgIHdyYXAuaW5zZXJ0QmVmb3JlKGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQsIGxpbmVWaWV3LnRleHQpO1xuICB9XG4gIHZhciBtYXJrZXJzID0gbGluZVZpZXcubGluZS5ndXR0ZXJNYXJrZXJzO1xuICBpZiAoY20ub3B0aW9ucy5saW5lTnVtYmVycyB8fCBtYXJrZXJzKSB7XG4gICAgdmFyIHdyYXAkMSA9IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KTtcbiAgICB2YXIgZ3V0dGVyV3JhcCA9IGxpbmVWaWV3Lmd1dHRlciA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyLXdyYXBwZXJcIiwgKFwibGVmdDogXCIgKyAoY20ub3B0aW9ucy5maXhlZEd1dHRlciA/IGRpbXMuZml4ZWRQb3MgOiAtZGltcy5ndXR0ZXJUb3RhbFdpZHRoKSArIFwicHhcIikpO1xuICAgIGNtLmRpc3BsYXkuaW5wdXQuc2V0VW5lZGl0YWJsZShndXR0ZXJXcmFwKTtcbiAgICB3cmFwJDEuaW5zZXJ0QmVmb3JlKGd1dHRlcldyYXAsIGxpbmVWaWV3LnRleHQpO1xuICAgIGlmIChsaW5lVmlldy5saW5lLmd1dHRlckNsYXNzKVxuICAgICAgeyBndXR0ZXJXcmFwLmNsYXNzTmFtZSArPSBcIiBcIiArIGxpbmVWaWV3LmxpbmUuZ3V0dGVyQ2xhc3M7IH1cbiAgICBpZiAoY20ub3B0aW9ucy5saW5lTnVtYmVycyAmJiAoIW1hcmtlcnMgfHwgIW1hcmtlcnNbXCJDb2RlTWlycm9yLWxpbmVudW1iZXJzXCJdKSlcbiAgICAgIHsgbGluZVZpZXcubGluZU51bWJlciA9IGd1dHRlcldyYXAuYXBwZW5kQ2hpbGQoXG4gICAgICAgIGVsdChcImRpdlwiLCBsaW5lTnVtYmVyRm9yKGNtLm9wdGlvbnMsIGxpbmVOKSxcbiAgICAgICAgICAgIFwiQ29kZU1pcnJvci1saW5lbnVtYmVyIENvZGVNaXJyb3ItZ3V0dGVyLWVsdFwiLFxuICAgICAgICAgICAgKFwibGVmdDogXCIgKyAoZGltcy5ndXR0ZXJMZWZ0W1wiQ29kZU1pcnJvci1saW5lbnVtYmVyc1wiXSkgKyBcInB4OyB3aWR0aDogXCIgKyAoY20uZGlzcGxheS5saW5lTnVtSW5uZXJXaWR0aCkgKyBcInB4XCIpKSk7IH1cbiAgICBpZiAobWFya2VycykgeyBmb3IgKHZhciBrID0gMDsgayA8IGNtLm9wdGlvbnMuZ3V0dGVycy5sZW5ndGg7ICsraykge1xuICAgICAgdmFyIGlkID0gY20ub3B0aW9ucy5ndXR0ZXJzW2tdLCBmb3VuZCA9IG1hcmtlcnMuaGFzT3duUHJvcGVydHkoaWQpICYmIG1hcmtlcnNbaWRdO1xuICAgICAgaWYgKGZvdW5kKVxuICAgICAgICB7IGd1dHRlcldyYXAuYXBwZW5kQ2hpbGQoZWx0KFwiZGl2XCIsIFtmb3VuZF0sIFwiQ29kZU1pcnJvci1ndXR0ZXItZWx0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChcImxlZnQ6IFwiICsgKGRpbXMuZ3V0dGVyTGVmdFtpZF0pICsgXCJweDsgd2lkdGg6IFwiICsgKGRpbXMuZ3V0dGVyV2lkdGhbaWRdKSArIFwicHhcIikpKTsgfVxuICAgIH0gfVxuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUxpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcykge1xuICBpZiAobGluZVZpZXcuYWxpZ25hYmxlKSB7IGxpbmVWaWV3LmFsaWduYWJsZSA9IG51bGw7IH1cbiAgZm9yICh2YXIgbm9kZSA9IGxpbmVWaWV3Lm5vZGUuZmlyc3RDaGlsZCwgbmV4dCA9ICh2b2lkIDApOyBub2RlOyBub2RlID0gbmV4dCkge1xuICAgIG5leHQgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgIGlmIChub2RlLmNsYXNzTmFtZSA9PSBcIkNvZGVNaXJyb3ItbGluZXdpZGdldFwiKVxuICAgICAgeyBsaW5lVmlldy5ub2RlLnJlbW92ZUNoaWxkKG5vZGUpOyB9XG4gIH1cbiAgaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKTtcbn1cblxuLy8gQnVpbGQgYSBsaW5lJ3MgRE9NIHJlcHJlc2VudGF0aW9uIGZyb20gc2NyYXRjaFxuZnVuY3Rpb24gYnVpbGRMaW5lRWxlbWVudChjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKSB7XG4gIHZhciBidWlsdCA9IGdldExpbmVDb250ZW50KGNtLCBsaW5lVmlldyk7XG4gIGxpbmVWaWV3LnRleHQgPSBsaW5lVmlldy5ub2RlID0gYnVpbHQucHJlO1xuICBpZiAoYnVpbHQuYmdDbGFzcykgeyBsaW5lVmlldy5iZ0NsYXNzID0gYnVpbHQuYmdDbGFzczsgfVxuICBpZiAoYnVpbHQudGV4dENsYXNzKSB7IGxpbmVWaWV3LnRleHRDbGFzcyA9IGJ1aWx0LnRleHRDbGFzczsgfVxuXG4gIHVwZGF0ZUxpbmVDbGFzc2VzKGNtLCBsaW5lVmlldyk7XG4gIHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7XG4gIGluc2VydExpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcyk7XG4gIHJldHVybiBsaW5lVmlldy5ub2RlXG59XG5cbi8vIEEgbGluZVZpZXcgbWF5IGNvbnRhaW4gbXVsdGlwbGUgbG9naWNhbCBsaW5lcyAod2hlbiBtZXJnZWQgYnlcbi8vIGNvbGxhcHNlZCBzcGFucykuIFRoZSB3aWRnZXRzIGZvciBhbGwgb2YgdGhlbSBuZWVkIHRvIGJlIGRyYXduLlxuZnVuY3Rpb24gaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKSB7XG4gIGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lVmlldy5saW5lLCBsaW5lVmlldywgZGltcywgdHJ1ZSk7XG4gIGlmIChsaW5lVmlldy5yZXN0KSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICB7IGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lVmlldy5yZXN0W2ldLCBsaW5lVmlldywgZGltcywgZmFsc2UpOyB9IH1cbn1cblxuZnVuY3Rpb24gaW5zZXJ0TGluZVdpZGdldHNGb3IoY20sIGxpbmUsIGxpbmVWaWV3LCBkaW1zLCBhbGxvd0Fib3ZlKSB7XG4gIGlmICghbGluZS53aWRnZXRzKSB7IHJldHVybiB9XG4gIHZhciB3cmFwID0gZW5zdXJlTGluZVdyYXBwZWQobGluZVZpZXcpO1xuICBmb3IgKHZhciBpID0gMCwgd3MgPSBsaW5lLndpZGdldHM7IGkgPCB3cy5sZW5ndGg7ICsraSkge1xuICAgIHZhciB3aWRnZXQgPSB3c1tpXSwgbm9kZSA9IGVsdChcImRpdlwiLCBbd2lkZ2V0Lm5vZGVdLCBcIkNvZGVNaXJyb3ItbGluZXdpZGdldFwiKTtcbiAgICBpZiAoIXdpZGdldC5oYW5kbGVNb3VzZUV2ZW50cykgeyBub2RlLnNldEF0dHJpYnV0ZShcImNtLWlnbm9yZS1ldmVudHNcIiwgXCJ0cnVlXCIpOyB9XG4gICAgcG9zaXRpb25MaW5lV2lkZ2V0KHdpZGdldCwgbm9kZSwgbGluZVZpZXcsIGRpbXMpO1xuICAgIGNtLmRpc3BsYXkuaW5wdXQuc2V0VW5lZGl0YWJsZShub2RlKTtcbiAgICBpZiAoYWxsb3dBYm92ZSAmJiB3aWRnZXQuYWJvdmUpXG4gICAgICB7IHdyYXAuaW5zZXJ0QmVmb3JlKG5vZGUsIGxpbmVWaWV3Lmd1dHRlciB8fCBsaW5lVmlldy50ZXh0KTsgfVxuICAgIGVsc2VcbiAgICAgIHsgd3JhcC5hcHBlbmRDaGlsZChub2RlKTsgfVxuICAgIHNpZ25hbExhdGVyKHdpZGdldCwgXCJyZWRyYXdcIik7XG4gIH1cbn1cblxuZnVuY3Rpb24gcG9zaXRpb25MaW5lV2lkZ2V0KHdpZGdldCwgbm9kZSwgbGluZVZpZXcsIGRpbXMpIHtcbiAgaWYgKHdpZGdldC5ub0hTY3JvbGwpIHtcbiAgICAobGluZVZpZXcuYWxpZ25hYmxlIHx8IChsaW5lVmlldy5hbGlnbmFibGUgPSBbXSkpLnB1c2gobm9kZSk7XG4gICAgdmFyIHdpZHRoID0gZGltcy53cmFwcGVyV2lkdGg7XG4gICAgbm9kZS5zdHlsZS5sZWZ0ID0gZGltcy5maXhlZFBvcyArIFwicHhcIjtcbiAgICBpZiAoIXdpZGdldC5jb3Zlckd1dHRlcikge1xuICAgICAgd2lkdGggLT0gZGltcy5ndXR0ZXJUb3RhbFdpZHRoO1xuICAgICAgbm9kZS5zdHlsZS5wYWRkaW5nTGVmdCA9IGRpbXMuZ3V0dGVyVG90YWxXaWR0aCArIFwicHhcIjtcbiAgICB9XG4gICAgbm9kZS5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCJweFwiO1xuICB9XG4gIGlmICh3aWRnZXQuY292ZXJHdXR0ZXIpIHtcbiAgICBub2RlLnN0eWxlLnpJbmRleCA9IDU7XG4gICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcbiAgICBpZiAoIXdpZGdldC5ub0hTY3JvbGwpIHsgbm9kZS5zdHlsZS5tYXJnaW5MZWZ0ID0gLWRpbXMuZ3V0dGVyVG90YWxXaWR0aCArIFwicHhcIjsgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHdpZGdldEhlaWdodCh3aWRnZXQpIHtcbiAgaWYgKHdpZGdldC5oZWlnaHQgIT0gbnVsbCkgeyByZXR1cm4gd2lkZ2V0LmhlaWdodCB9XG4gIHZhciBjbSA9IHdpZGdldC5kb2MuY207XG4gIGlmICghY20pIHsgcmV0dXJuIDAgfVxuICBpZiAoIWNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHdpZGdldC5ub2RlKSkge1xuICAgIHZhciBwYXJlbnRTdHlsZSA9IFwicG9zaXRpb246IHJlbGF0aXZlO1wiO1xuICAgIGlmICh3aWRnZXQuY292ZXJHdXR0ZXIpXG4gICAgICB7IHBhcmVudFN0eWxlICs9IFwibWFyZ2luLWxlZnQ6IC1cIiArIGNtLmRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aCArIFwicHg7XCI7IH1cbiAgICBpZiAod2lkZ2V0Lm5vSFNjcm9sbClcbiAgICAgIHsgcGFyZW50U3R5bGUgKz0gXCJ3aWR0aDogXCIgKyBjbS5kaXNwbGF5LndyYXBwZXIuY2xpZW50V2lkdGggKyBcInB4O1wiOyB9XG4gICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoY20uZGlzcGxheS5tZWFzdXJlLCBlbHQoXCJkaXZcIiwgW3dpZGdldC5ub2RlXSwgbnVsbCwgcGFyZW50U3R5bGUpKTtcbiAgfVxuICByZXR1cm4gd2lkZ2V0LmhlaWdodCA9IHdpZGdldC5ub2RlLnBhcmVudE5vZGUub2Zmc2V0SGVpZ2h0XG59XG5cbi8vIFJldHVybiB0cnVlIHdoZW4gdGhlIGdpdmVuIG1vdXNlIGV2ZW50IGhhcHBlbmVkIGluIGEgd2lkZ2V0XG5mdW5jdGlvbiBldmVudEluV2lkZ2V0KGRpc3BsYXksIGUpIHtcbiAgZm9yICh2YXIgbiA9IGVfdGFyZ2V0KGUpOyBuICE9IGRpc3BsYXkud3JhcHBlcjsgbiA9IG4ucGFyZW50Tm9kZSkge1xuICAgIGlmICghbiB8fCAobi5ub2RlVHlwZSA9PSAxICYmIG4uZ2V0QXR0cmlidXRlKFwiY20taWdub3JlLWV2ZW50c1wiKSA9PSBcInRydWVcIikgfHxcbiAgICAgICAgKG4ucGFyZW50Tm9kZSA9PSBkaXNwbGF5LnNpemVyICYmIG4gIT0gZGlzcGxheS5tb3ZlcikpXG4gICAgICB7IHJldHVybiB0cnVlIH1cbiAgfVxufVxuXG4vLyBQT1NJVElPTiBNRUFTVVJFTUVOVFxuXG5mdW5jdGlvbiBwYWRkaW5nVG9wKGRpc3BsYXkpIHtyZXR1cm4gZGlzcGxheS5saW5lU3BhY2Uub2Zmc2V0VG9wfVxuZnVuY3Rpb24gcGFkZGluZ1ZlcnQoZGlzcGxheSkge3JldHVybiBkaXNwbGF5Lm1vdmVyLm9mZnNldEhlaWdodCAtIGRpc3BsYXkubGluZVNwYWNlLm9mZnNldEhlaWdodH1cbmZ1bmN0aW9uIHBhZGRpbmdIKGRpc3BsYXkpIHtcbiAgaWYgKGRpc3BsYXkuY2FjaGVkUGFkZGluZ0gpIHsgcmV0dXJuIGRpc3BsYXkuY2FjaGVkUGFkZGluZ0ggfVxuICB2YXIgZSA9IHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkubWVhc3VyZSwgZWx0KFwicHJlXCIsIFwieFwiKSk7XG4gIHZhciBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlID8gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZSkgOiBlLmN1cnJlbnRTdHlsZTtcbiAgdmFyIGRhdGEgPSB7bGVmdDogcGFyc2VJbnQoc3R5bGUucGFkZGluZ0xlZnQpLCByaWdodDogcGFyc2VJbnQoc3R5bGUucGFkZGluZ1JpZ2h0KX07XG4gIGlmICghaXNOYU4oZGF0YS5sZWZ0KSAmJiAhaXNOYU4oZGF0YS5yaWdodCkpIHsgZGlzcGxheS5jYWNoZWRQYWRkaW5nSCA9IGRhdGE7IH1cbiAgcmV0dXJuIGRhdGFcbn1cblxuZnVuY3Rpb24gc2Nyb2xsR2FwKGNtKSB7IHJldHVybiBzY3JvbGxlckdhcCAtIGNtLmRpc3BsYXkubmF0aXZlQmFyV2lkdGggfVxuZnVuY3Rpb24gZGlzcGxheVdpZHRoKGNtKSB7XG4gIHJldHVybiBjbS5kaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoIC0gc2Nyb2xsR2FwKGNtKSAtIGNtLmRpc3BsYXkuYmFyV2lkdGhcbn1cbmZ1bmN0aW9uIGRpc3BsYXlIZWlnaHQoY20pIHtcbiAgcmV0dXJuIGNtLmRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50SGVpZ2h0IC0gc2Nyb2xsR2FwKGNtKSAtIGNtLmRpc3BsYXkuYmFySGVpZ2h0XG59XG5cbi8vIEVuc3VyZSB0aGUgbGluZVZpZXcud3JhcHBpbmcuaGVpZ2h0cyBhcnJheSBpcyBwb3B1bGF0ZWQuIFRoaXMgaXNcbi8vIGFuIGFycmF5IG9mIGJvdHRvbSBvZmZzZXRzIGZvciB0aGUgbGluZXMgdGhhdCBtYWtlIHVwIGEgZHJhd25cbi8vIGxpbmUuIFdoZW4gbGluZVdyYXBwaW5nIGlzIG9uLCB0aGVyZSBtaWdodCBiZSBtb3JlIHRoYW4gb25lXG4vLyBoZWlnaHQuXG5mdW5jdGlvbiBlbnN1cmVMaW5lSGVpZ2h0cyhjbSwgbGluZVZpZXcsIHJlY3QpIHtcbiAgdmFyIHdyYXBwaW5nID0gY20ub3B0aW9ucy5saW5lV3JhcHBpbmc7XG4gIHZhciBjdXJXaWR0aCA9IHdyYXBwaW5nICYmIGRpc3BsYXlXaWR0aChjbSk7XG4gIGlmICghbGluZVZpZXcubWVhc3VyZS5oZWlnaHRzIHx8IHdyYXBwaW5nICYmIGxpbmVWaWV3Lm1lYXN1cmUud2lkdGggIT0gY3VyV2lkdGgpIHtcbiAgICB2YXIgaGVpZ2h0cyA9IGxpbmVWaWV3Lm1lYXN1cmUuaGVpZ2h0cyA9IFtdO1xuICAgIGlmICh3cmFwcGluZykge1xuICAgICAgbGluZVZpZXcubWVhc3VyZS53aWR0aCA9IGN1cldpZHRoO1xuICAgICAgdmFyIHJlY3RzID0gbGluZVZpZXcudGV4dC5maXJzdENoaWxkLmdldENsaWVudFJlY3RzKCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlY3RzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICB2YXIgY3VyID0gcmVjdHNbaV0sIG5leHQgPSByZWN0c1tpICsgMV07XG4gICAgICAgIGlmIChNYXRoLmFicyhjdXIuYm90dG9tIC0gbmV4dC5ib3R0b20pID4gMilcbiAgICAgICAgICB7IGhlaWdodHMucHVzaCgoY3VyLmJvdHRvbSArIG5leHQudG9wKSAvIDIgLSByZWN0LnRvcCk7IH1cbiAgICAgIH1cbiAgICB9XG4gICAgaGVpZ2h0cy5wdXNoKHJlY3QuYm90dG9tIC0gcmVjdC50b3ApO1xuICB9XG59XG5cbi8vIEZpbmQgYSBsaW5lIG1hcCAobWFwcGluZyBjaGFyYWN0ZXIgb2Zmc2V0cyB0byB0ZXh0IG5vZGVzKSBhbmQgYVxuLy8gbWVhc3VyZW1lbnQgY2FjaGUgZm9yIHRoZSBnaXZlbiBsaW5lIG51bWJlci4gKEEgbGluZSB2aWV3IG1pZ2h0XG4vLyBjb250YWluIG11bHRpcGxlIGxpbmVzIHdoZW4gY29sbGFwc2VkIHJhbmdlcyBhcmUgcHJlc2VudC4pXG5mdW5jdGlvbiBtYXBGcm9tTGluZVZpZXcobGluZVZpZXcsIGxpbmUsIGxpbmVOKSB7XG4gIGlmIChsaW5lVmlldy5saW5lID09IGxpbmUpXG4gICAgeyByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXAsIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlfSB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICB7IGlmIChsaW5lVmlldy5yZXN0W2ldID09IGxpbmUpXG4gICAgICB7IHJldHVybiB7bWFwOiBsaW5lVmlldy5tZWFzdXJlLm1hcHNbaV0sIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlc1tpXX0gfSB9XG4gIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGxpbmVWaWV3LnJlc3QubGVuZ3RoOyBpJDErKylcbiAgICB7IGlmIChsaW5lTm8obGluZVZpZXcucmVzdFtpJDFdKSA+IGxpbmVOKVxuICAgICAgeyByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXBzW2kkMV0sIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlc1tpJDFdLCBiZWZvcmU6IHRydWV9IH0gfVxufVxuXG4vLyBSZW5kZXIgYSBsaW5lIGludG8gdGhlIGhpZGRlbiBub2RlIGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZC4gVXNlZFxuLy8gd2hlbiBtZWFzdXJlbWVudCBpcyBuZWVkZWQgZm9yIGEgbGluZSB0aGF0J3Mgbm90IGluIHRoZSB2aWV3cG9ydC5cbmZ1bmN0aW9uIHVwZGF0ZUV4dGVybmFsTWVhc3VyZW1lbnQoY20sIGxpbmUpIHtcbiAgbGluZSA9IHZpc3VhbExpbmUobGluZSk7XG4gIHZhciBsaW5lTiA9IGxpbmVObyhsaW5lKTtcbiAgdmFyIHZpZXcgPSBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBuZXcgTGluZVZpZXcoY20uZG9jLCBsaW5lLCBsaW5lTik7XG4gIHZpZXcubGluZU4gPSBsaW5lTjtcbiAgdmFyIGJ1aWx0ID0gdmlldy5idWlsdCA9IGJ1aWxkTGluZUNvbnRlbnQoY20sIHZpZXcpO1xuICB2aWV3LnRleHQgPSBidWlsdC5wcmU7XG4gIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGNtLmRpc3BsYXkubGluZU1lYXN1cmUsIGJ1aWx0LnByZSk7XG4gIHJldHVybiB2aWV3XG59XG5cbi8vIEdldCBhIHt0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHR9IGJveCAoaW4gbGluZS1sb2NhbCBjb29yZGluYXRlcylcbi8vIGZvciBhIGdpdmVuIGNoYXJhY3Rlci5cbmZ1bmN0aW9uIG1lYXN1cmVDaGFyKGNtLCBsaW5lLCBjaCwgYmlhcykge1xuICByZXR1cm4gbWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZU1lYXN1cmVGb3JMaW5lKGNtLCBsaW5lKSwgY2gsIGJpYXMpXG59XG5cbi8vIEZpbmQgYSBsaW5lIHZpZXcgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgZ2l2ZW4gbGluZSBudW1iZXIuXG5mdW5jdGlvbiBmaW5kVmlld0ZvckxpbmUoY20sIGxpbmVOKSB7XG4gIGlmIChsaW5lTiA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tICYmIGxpbmVOIDwgY20uZGlzcGxheS52aWV3VG8pXG4gICAgeyByZXR1cm4gY20uZGlzcGxheS52aWV3W2ZpbmRWaWV3SW5kZXgoY20sIGxpbmVOKV0gfVxuICB2YXIgZXh0ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkO1xuICBpZiAoZXh0ICYmIGxpbmVOID49IGV4dC5saW5lTiAmJiBsaW5lTiA8IGV4dC5saW5lTiArIGV4dC5zaXplKVxuICAgIHsgcmV0dXJuIGV4dCB9XG59XG5cbi8vIE1lYXN1cmVtZW50IGNhbiBiZSBzcGxpdCBpbiB0d28gc3RlcHMsIHRoZSBzZXQtdXAgd29yayB0aGF0XG4vLyBhcHBsaWVzIHRvIHRoZSB3aG9sZSBsaW5lLCBhbmQgdGhlIG1lYXN1cmVtZW50IG9mIHRoZSBhY3R1YWxcbi8vIGNoYXJhY3Rlci4gRnVuY3Rpb25zIGxpa2UgY29vcmRzQ2hhciwgdGhhdCBuZWVkIHRvIGRvIGEgbG90IG9mXG4vLyBtZWFzdXJlbWVudHMgaW4gYSByb3csIGNhbiB0aHVzIGVuc3VyZSB0aGF0IHRoZSBzZXQtdXAgd29yayBpc1xuLy8gb25seSBkb25lIG9uY2UuXG5mdW5jdGlvbiBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmUpIHtcbiAgdmFyIGxpbmVOID0gbGluZU5vKGxpbmUpO1xuICB2YXIgdmlldyA9IGZpbmRWaWV3Rm9yTGluZShjbSwgbGluZU4pO1xuICBpZiAodmlldyAmJiAhdmlldy50ZXh0KSB7XG4gICAgdmlldyA9IG51bGw7XG4gIH0gZWxzZSBpZiAodmlldyAmJiB2aWV3LmNoYW5nZXMpIHtcbiAgICB1cGRhdGVMaW5lRm9yQ2hhbmdlcyhjbSwgdmlldywgbGluZU4sIGdldERpbWVuc2lvbnMoY20pKTtcbiAgICBjbS5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7XG4gIH1cbiAgaWYgKCF2aWV3KVxuICAgIHsgdmlldyA9IHVwZGF0ZUV4dGVybmFsTWVhc3VyZW1lbnQoY20sIGxpbmUpOyB9XG5cbiAgdmFyIGluZm8gPSBtYXBGcm9tTGluZVZpZXcodmlldywgbGluZSwgbGluZU4pO1xuICByZXR1cm4ge1xuICAgIGxpbmU6IGxpbmUsIHZpZXc6IHZpZXcsIHJlY3Q6IG51bGwsXG4gICAgbWFwOiBpbmZvLm1hcCwgY2FjaGU6IGluZm8uY2FjaGUsIGJlZm9yZTogaW5mby5iZWZvcmUsXG4gICAgaGFzSGVpZ2h0czogZmFsc2VcbiAgfVxufVxuXG4vLyBHaXZlbiBhIHByZXBhcmVkIG1lYXN1cmVtZW50IG9iamVjdCwgbWVhc3VyZXMgdGhlIHBvc2l0aW9uIG9mIGFuXG4vLyBhY3R1YWwgY2hhcmFjdGVyIChvciBmZXRjaGVzIGl0IGZyb20gdGhlIGNhY2hlKS5cbmZ1bmN0aW9uIG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXBhcmVkLCBjaCwgYmlhcywgdmFySGVpZ2h0KSB7XG4gIGlmIChwcmVwYXJlZC5iZWZvcmUpIHsgY2ggPSAtMTsgfVxuICB2YXIga2V5ID0gY2ggKyAoYmlhcyB8fCBcIlwiKSwgZm91bmQ7XG4gIGlmIChwcmVwYXJlZC5jYWNoZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgZm91bmQgPSBwcmVwYXJlZC5jYWNoZVtrZXldO1xuICB9IGVsc2Uge1xuICAgIGlmICghcHJlcGFyZWQucmVjdClcbiAgICAgIHsgcHJlcGFyZWQucmVjdCA9IHByZXBhcmVkLnZpZXcudGV4dC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgfVxuICAgIGlmICghcHJlcGFyZWQuaGFzSGVpZ2h0cykge1xuICAgICAgZW5zdXJlTGluZUhlaWdodHMoY20sIHByZXBhcmVkLnZpZXcsIHByZXBhcmVkLnJlY3QpO1xuICAgICAgcHJlcGFyZWQuaGFzSGVpZ2h0cyA9IHRydWU7XG4gICAgfVxuICAgIGZvdW5kID0gbWVhc3VyZUNoYXJJbm5lcihjbSwgcHJlcGFyZWQsIGNoLCBiaWFzKTtcbiAgICBpZiAoIWZvdW5kLmJvZ3VzKSB7IHByZXBhcmVkLmNhY2hlW2tleV0gPSBmb3VuZDsgfVxuICB9XG4gIHJldHVybiB7bGVmdDogZm91bmQubGVmdCwgcmlnaHQ6IGZvdW5kLnJpZ2h0LFxuICAgICAgICAgIHRvcDogdmFySGVpZ2h0ID8gZm91bmQucnRvcCA6IGZvdW5kLnRvcCxcbiAgICAgICAgICBib3R0b206IHZhckhlaWdodCA/IGZvdW5kLnJib3R0b20gOiBmb3VuZC5ib3R0b219XG59XG5cbnZhciBudWxsUmVjdCA9IHtsZWZ0OiAwLCByaWdodDogMCwgdG9wOiAwLCBib3R0b206IDB9O1xuXG5mdW5jdGlvbiBub2RlQW5kT2Zmc2V0SW5MaW5lTWFwKG1hcCQkMSwgY2gsIGJpYXMpIHtcbiAgdmFyIG5vZGUsIHN0YXJ0LCBlbmQsIGNvbGxhcHNlLCBtU3RhcnQsIG1FbmQ7XG4gIC8vIEZpcnN0LCBzZWFyY2ggdGhlIGxpbmUgbWFwIGZvciB0aGUgdGV4dCBub2RlIGNvcnJlc3BvbmRpbmcgdG8sXG4gIC8vIG9yIGNsb3Nlc3QgdG8sIHRoZSB0YXJnZXQgY2hhcmFjdGVyLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcCQkMS5sZW5ndGg7IGkgKz0gMykge1xuICAgIG1TdGFydCA9IG1hcCQkMVtpXTtcbiAgICBtRW5kID0gbWFwJCQxW2kgKyAxXTtcbiAgICBpZiAoY2ggPCBtU3RhcnQpIHtcbiAgICAgIHN0YXJ0ID0gMDsgZW5kID0gMTtcbiAgICAgIGNvbGxhcHNlID0gXCJsZWZ0XCI7XG4gICAgfSBlbHNlIGlmIChjaCA8IG1FbmQpIHtcbiAgICAgIHN0YXJ0ID0gY2ggLSBtU3RhcnQ7XG4gICAgICBlbmQgPSBzdGFydCArIDE7XG4gICAgfSBlbHNlIGlmIChpID09IG1hcCQkMS5sZW5ndGggLSAzIHx8IGNoID09IG1FbmQgJiYgbWFwJCQxW2kgKyAzXSA+IGNoKSB7XG4gICAgICBlbmQgPSBtRW5kIC0gbVN0YXJ0O1xuICAgICAgc3RhcnQgPSBlbmQgLSAxO1xuICAgICAgaWYgKGNoID49IG1FbmQpIHsgY29sbGFwc2UgPSBcInJpZ2h0XCI7IH1cbiAgICB9XG4gICAgaWYgKHN0YXJ0ICE9IG51bGwpIHtcbiAgICAgIG5vZGUgPSBtYXAkJDFbaSArIDJdO1xuICAgICAgaWYgKG1TdGFydCA9PSBtRW5kICYmIGJpYXMgPT0gKG5vZGUuaW5zZXJ0TGVmdCA/IFwibGVmdFwiIDogXCJyaWdodFwiKSlcbiAgICAgICAgeyBjb2xsYXBzZSA9IGJpYXM7IH1cbiAgICAgIGlmIChiaWFzID09IFwibGVmdFwiICYmIHN0YXJ0ID09IDApXG4gICAgICAgIHsgd2hpbGUgKGkgJiYgbWFwJCQxW2kgLSAyXSA9PSBtYXAkJDFbaSAtIDNdICYmIG1hcCQkMVtpIC0gMV0uaW5zZXJ0TGVmdCkge1xuICAgICAgICAgIG5vZGUgPSBtYXAkJDFbKGkgLT0gMykgKyAyXTtcbiAgICAgICAgICBjb2xsYXBzZSA9IFwibGVmdFwiO1xuICAgICAgICB9IH1cbiAgICAgIGlmIChiaWFzID09IFwicmlnaHRcIiAmJiBzdGFydCA9PSBtRW5kIC0gbVN0YXJ0KVxuICAgICAgICB7IHdoaWxlIChpIDwgbWFwJCQxLmxlbmd0aCAtIDMgJiYgbWFwJCQxW2kgKyAzXSA9PSBtYXAkJDFbaSArIDRdICYmICFtYXAkJDFbaSArIDVdLmluc2VydExlZnQpIHtcbiAgICAgICAgICBub2RlID0gbWFwJCQxWyhpICs9IDMpICsgMl07XG4gICAgICAgICAgY29sbGFwc2UgPSBcInJpZ2h0XCI7XG4gICAgICAgIH0gfVxuICAgICAgYnJlYWtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtub2RlOiBub2RlLCBzdGFydDogc3RhcnQsIGVuZDogZW5kLCBjb2xsYXBzZTogY29sbGFwc2UsIGNvdmVyU3RhcnQ6IG1TdGFydCwgY292ZXJFbmQ6IG1FbmR9XG59XG5cbmZ1bmN0aW9uIGdldFVzZWZ1bFJlY3QocmVjdHMsIGJpYXMpIHtcbiAgdmFyIHJlY3QgPSBudWxsUmVjdDtcbiAgaWYgKGJpYXMgPT0gXCJsZWZ0XCIpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCByZWN0cy5sZW5ndGg7IGkrKykge1xuICAgIGlmICgocmVjdCA9IHJlY3RzW2ldKS5sZWZ0ICE9IHJlY3QucmlnaHQpIHsgYnJlYWsgfVxuICB9IH0gZWxzZSB7IGZvciAodmFyIGkkMSA9IHJlY3RzLmxlbmd0aCAtIDE7IGkkMSA+PSAwOyBpJDEtLSkge1xuICAgIGlmICgocmVjdCA9IHJlY3RzW2kkMV0pLmxlZnQgIT0gcmVjdC5yaWdodCkgeyBicmVhayB9XG4gIH0gfVxuICByZXR1cm4gcmVjdFxufVxuXG5mdW5jdGlvbiBtZWFzdXJlQ2hhcklubmVyKGNtLCBwcmVwYXJlZCwgY2gsIGJpYXMpIHtcbiAgdmFyIHBsYWNlID0gbm9kZUFuZE9mZnNldEluTGluZU1hcChwcmVwYXJlZC5tYXAsIGNoLCBiaWFzKTtcbiAgdmFyIG5vZGUgPSBwbGFjZS5ub2RlLCBzdGFydCA9IHBsYWNlLnN0YXJ0LCBlbmQgPSBwbGFjZS5lbmQsIGNvbGxhcHNlID0gcGxhY2UuY29sbGFwc2U7XG5cbiAgdmFyIHJlY3Q7XG4gIGlmIChub2RlLm5vZGVUeXBlID09IDMpIHsgLy8gSWYgaXQgaXMgYSB0ZXh0IG5vZGUsIHVzZSBhIHJhbmdlIHRvIHJldHJpZXZlIHRoZSBjb29yZGluYXRlcy5cbiAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCA0OyBpJDErKykgeyAvLyBSZXRyeSBhIG1heGltdW0gb2YgNCB0aW1lcyB3aGVuIG5vbnNlbnNlIHJlY3RhbmdsZXMgYXJlIHJldHVybmVkXG4gICAgICB3aGlsZSAoc3RhcnQgJiYgaXNFeHRlbmRpbmdDaGFyKHByZXBhcmVkLmxpbmUudGV4dC5jaGFyQXQocGxhY2UuY292ZXJTdGFydCArIHN0YXJ0KSkpIHsgLS1zdGFydDsgfVxuICAgICAgd2hpbGUgKHBsYWNlLmNvdmVyU3RhcnQgKyBlbmQgPCBwbGFjZS5jb3ZlckVuZCAmJiBpc0V4dGVuZGluZ0NoYXIocHJlcGFyZWQubGluZS50ZXh0LmNoYXJBdChwbGFjZS5jb3ZlclN0YXJ0ICsgZW5kKSkpIHsgKytlbmQ7IH1cbiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSAmJiBzdGFydCA9PSAwICYmIGVuZCA9PSBwbGFjZS5jb3ZlckVuZCAtIHBsYWNlLmNvdmVyU3RhcnQpXG4gICAgICAgIHsgcmVjdCA9IG5vZGUucGFyZW50Tm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgfVxuICAgICAgZWxzZVxuICAgICAgICB7IHJlY3QgPSBnZXRVc2VmdWxSZWN0KHJhbmdlKG5vZGUsIHN0YXJ0LCBlbmQpLmdldENsaWVudFJlY3RzKCksIGJpYXMpOyB9XG4gICAgICBpZiAocmVjdC5sZWZ0IHx8IHJlY3QucmlnaHQgfHwgc3RhcnQgPT0gMCkgeyBicmVhayB9XG4gICAgICBlbmQgPSBzdGFydDtcbiAgICAgIHN0YXJ0ID0gc3RhcnQgLSAxO1xuICAgICAgY29sbGFwc2UgPSBcInJpZ2h0XCI7XG4gICAgfVxuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgMTEpIHsgcmVjdCA9IG1heWJlVXBkYXRlUmVjdEZvclpvb21pbmcoY20uZGlzcGxheS5tZWFzdXJlLCByZWN0KTsgfVxuICB9IGVsc2UgeyAvLyBJZiBpdCBpcyBhIHdpZGdldCwgc2ltcGx5IGdldCB0aGUgYm94IGZvciB0aGUgd2hvbGUgd2lkZ2V0LlxuICAgIGlmIChzdGFydCA+IDApIHsgY29sbGFwc2UgPSBiaWFzID0gXCJyaWdodFwiOyB9XG4gICAgdmFyIHJlY3RzO1xuICAgIGlmIChjbS5vcHRpb25zLmxpbmVXcmFwcGluZyAmJiAocmVjdHMgPSBub2RlLmdldENsaWVudFJlY3RzKCkpLmxlbmd0aCA+IDEpXG4gICAgICB7IHJlY3QgPSByZWN0c1tiaWFzID09IFwicmlnaHRcIiA/IHJlY3RzLmxlbmd0aCAtIDEgOiAwXTsgfVxuICAgIGVsc2VcbiAgICAgIHsgcmVjdCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7IH1cbiAgfVxuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkgJiYgIXN0YXJ0ICYmICghcmVjdCB8fCAhcmVjdC5sZWZ0ICYmICFyZWN0LnJpZ2h0KSkge1xuICAgIHZhciByU3BhbiA9IG5vZGUucGFyZW50Tm9kZS5nZXRDbGllbnRSZWN0cygpWzBdO1xuICAgIGlmIChyU3BhbilcbiAgICAgIHsgcmVjdCA9IHtsZWZ0OiByU3Bhbi5sZWZ0LCByaWdodDogclNwYW4ubGVmdCArIGNoYXJXaWR0aChjbS5kaXNwbGF5KSwgdG9wOiByU3Bhbi50b3AsIGJvdHRvbTogclNwYW4uYm90dG9tfTsgfVxuICAgIGVsc2VcbiAgICAgIHsgcmVjdCA9IG51bGxSZWN0OyB9XG4gIH1cblxuICB2YXIgcnRvcCA9IHJlY3QudG9wIC0gcHJlcGFyZWQucmVjdC50b3AsIHJib3QgPSByZWN0LmJvdHRvbSAtIHByZXBhcmVkLnJlY3QudG9wO1xuICB2YXIgbWlkID0gKHJ0b3AgKyByYm90KSAvIDI7XG4gIHZhciBoZWlnaHRzID0gcHJlcGFyZWQudmlldy5tZWFzdXJlLmhlaWdodHM7XG4gIHZhciBpID0gMDtcbiAgZm9yICg7IGkgPCBoZWlnaHRzLmxlbmd0aCAtIDE7IGkrKylcbiAgICB7IGlmIChtaWQgPCBoZWlnaHRzW2ldKSB7IGJyZWFrIH0gfVxuICB2YXIgdG9wID0gaSA/IGhlaWdodHNbaSAtIDFdIDogMCwgYm90ID0gaGVpZ2h0c1tpXTtcbiAgdmFyIHJlc3VsdCA9IHtsZWZ0OiAoY29sbGFwc2UgPT0gXCJyaWdodFwiID8gcmVjdC5yaWdodCA6IHJlY3QubGVmdCkgLSBwcmVwYXJlZC5yZWN0LmxlZnQsXG4gICAgICAgICAgICAgICAgcmlnaHQ6IChjb2xsYXBzZSA9PSBcImxlZnRcIiA/IHJlY3QubGVmdCA6IHJlY3QucmlnaHQpIC0gcHJlcGFyZWQucmVjdC5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcDogdG9wLCBib3R0b206IGJvdH07XG4gIGlmICghcmVjdC5sZWZ0ICYmICFyZWN0LnJpZ2h0KSB7IHJlc3VsdC5ib2d1cyA9IHRydWU7IH1cbiAgaWYgKCFjbS5vcHRpb25zLnNpbmdsZUN1cnNvckhlaWdodFBlckxpbmUpIHsgcmVzdWx0LnJ0b3AgPSBydG9wOyByZXN1bHQucmJvdHRvbSA9IHJib3Q7IH1cblxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8vIFdvcmsgYXJvdW5kIHByb2JsZW0gd2l0aCBib3VuZGluZyBjbGllbnQgcmVjdHMgb24gcmFuZ2VzIGJlaW5nXG4vLyByZXR1cm5lZCBpbmNvcnJlY3RseSB3aGVuIHpvb21lZCBvbiBJRTEwIGFuZCBiZWxvdy5cbmZ1bmN0aW9uIG1heWJlVXBkYXRlUmVjdEZvclpvb21pbmcobWVhc3VyZSwgcmVjdCkge1xuICBpZiAoIXdpbmRvdy5zY3JlZW4gfHwgc2NyZWVuLmxvZ2ljYWxYRFBJID09IG51bGwgfHxcbiAgICAgIHNjcmVlbi5sb2dpY2FsWERQSSA9PSBzY3JlZW4uZGV2aWNlWERQSSB8fCAhaGFzQmFkWm9vbWVkUmVjdHMobWVhc3VyZSkpXG4gICAgeyByZXR1cm4gcmVjdCB9XG4gIHZhciBzY2FsZVggPSBzY3JlZW4ubG9naWNhbFhEUEkgLyBzY3JlZW4uZGV2aWNlWERQSTtcbiAgdmFyIHNjYWxlWSA9IHNjcmVlbi5sb2dpY2FsWURQSSAvIHNjcmVlbi5kZXZpY2VZRFBJO1xuICByZXR1cm4ge2xlZnQ6IHJlY3QubGVmdCAqIHNjYWxlWCwgcmlnaHQ6IHJlY3QucmlnaHQgKiBzY2FsZVgsXG4gICAgICAgICAgdG9wOiByZWN0LnRvcCAqIHNjYWxlWSwgYm90dG9tOiByZWN0LmJvdHRvbSAqIHNjYWxlWX1cbn1cblxuZnVuY3Rpb24gY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZUZvcihsaW5lVmlldykge1xuICBpZiAobGluZVZpZXcubWVhc3VyZSkge1xuICAgIGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGUgPSB7fTtcbiAgICBsaW5lVmlldy5tZWFzdXJlLmhlaWdodHMgPSBudWxsO1xuICAgIGlmIChsaW5lVmlldy5yZXN0KSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICAgIHsgbGluZVZpZXcubWVhc3VyZS5jYWNoZXNbaV0gPSB7fTsgfSB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZShjbSkge1xuICBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZSA9IG51bGw7XG4gIHJlbW92ZUNoaWxkcmVuKGNtLmRpc3BsYXkubGluZU1lYXN1cmUpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRpc3BsYXkudmlldy5sZW5ndGg7IGkrKylcbiAgICB7IGNsZWFyTGluZU1lYXN1cmVtZW50Q2FjaGVGb3IoY20uZGlzcGxheS52aWV3W2ldKTsgfVxufVxuXG5mdW5jdGlvbiBjbGVhckNhY2hlcyhjbSkge1xuICBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlKGNtKTtcbiAgY20uZGlzcGxheS5jYWNoZWRDaGFyV2lkdGggPSBjbS5kaXNwbGF5LmNhY2hlZFRleHRIZWlnaHQgPSBjbS5kaXNwbGF5LmNhY2hlZFBhZGRpbmdIID0gbnVsbDtcbiAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgeyBjbS5kaXNwbGF5Lm1heExpbmVDaGFuZ2VkID0gdHJ1ZTsgfVxuICBjbS5kaXNwbGF5LmxpbmVOdW1DaGFycyA9IG51bGw7XG59XG5cbmZ1bmN0aW9uIHBhZ2VTY3JvbGxYKCkge1xuICAvLyBXb3JrIGFyb3VuZCBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD00ODkyMDZcbiAgLy8gd2hpY2ggY2F1c2VzIHBhZ2VfT2Zmc2V0IGFuZCBib3VuZGluZyBjbGllbnQgcmVjdHMgdG8gdXNlXG4gIC8vIGRpZmZlcmVudCByZWZlcmVuY2Ugdmlld3BvcnRzIGFuZCBpbnZhbGlkYXRlIG91ciBjYWxjdWxhdGlvbnMuXG4gIGlmIChjaHJvbWUgJiYgYW5kcm9pZCkgeyByZXR1cm4gLShkb2N1bWVudC5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBwYXJzZUludChnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpLm1hcmdpbkxlZnQpKSB9XG4gIHJldHVybiB3aW5kb3cucGFnZVhPZmZzZXQgfHwgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5KS5zY3JvbGxMZWZ0XG59XG5mdW5jdGlvbiBwYWdlU2Nyb2xsWSgpIHtcbiAgaWYgKGNocm9tZSAmJiBhbmRyb2lkKSB7IHJldHVybiAtKGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIC0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5ib2R5KS5tYXJnaW5Ub3ApKSB9XG4gIHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQgfHwgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5KS5zY3JvbGxUb3Bcbn1cblxuLy8gQ29udmVydHMgYSB7dG9wLCBib3R0b20sIGxlZnQsIHJpZ2h0fSBib3ggZnJvbSBsaW5lLWxvY2FsXG4vLyBjb29yZGluYXRlcyBpbnRvIGFub3RoZXIgY29vcmRpbmF0ZSBzeXN0ZW0uIENvbnRleHQgbWF5IGJlIG9uZSBvZlxuLy8gXCJsaW5lXCIsIFwiZGl2XCIgKGRpc3BsYXkubGluZURpdiksIFwibG9jYWxcIi4vbnVsbCAoZWRpdG9yKSwgXCJ3aW5kb3dcIixcbi8vIG9yIFwicGFnZVwiLlxuZnVuY3Rpb24gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCByZWN0LCBjb250ZXh0LCBpbmNsdWRlV2lkZ2V0cykge1xuICBpZiAoIWluY2x1ZGVXaWRnZXRzICYmIGxpbmVPYmoud2lkZ2V0cykgeyBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVPYmoud2lkZ2V0cy5sZW5ndGg7ICsraSkgeyBpZiAobGluZU9iai53aWRnZXRzW2ldLmFib3ZlKSB7XG4gICAgdmFyIHNpemUgPSB3aWRnZXRIZWlnaHQobGluZU9iai53aWRnZXRzW2ldKTtcbiAgICByZWN0LnRvcCArPSBzaXplOyByZWN0LmJvdHRvbSArPSBzaXplO1xuICB9IH0gfVxuICBpZiAoY29udGV4dCA9PSBcImxpbmVcIikgeyByZXR1cm4gcmVjdCB9XG4gIGlmICghY29udGV4dCkgeyBjb250ZXh0ID0gXCJsb2NhbFwiOyB9XG4gIHZhciB5T2ZmID0gaGVpZ2h0QXRMaW5lKGxpbmVPYmopO1xuICBpZiAoY29udGV4dCA9PSBcImxvY2FsXCIpIHsgeU9mZiArPSBwYWRkaW5nVG9wKGNtLmRpc3BsYXkpOyB9XG4gIGVsc2UgeyB5T2ZmIC09IGNtLmRpc3BsYXkudmlld09mZnNldDsgfVxuICBpZiAoY29udGV4dCA9PSBcInBhZ2VcIiB8fCBjb250ZXh0ID09IFwid2luZG93XCIpIHtcbiAgICB2YXIgbE9mZiA9IGNtLmRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHlPZmYgKz0gbE9mZi50b3AgKyAoY29udGV4dCA9PSBcIndpbmRvd1wiID8gMCA6IHBhZ2VTY3JvbGxZKCkpO1xuICAgIHZhciB4T2ZmID0gbE9mZi5sZWZ0ICsgKGNvbnRleHQgPT0gXCJ3aW5kb3dcIiA/IDAgOiBwYWdlU2Nyb2xsWCgpKTtcbiAgICByZWN0LmxlZnQgKz0geE9mZjsgcmVjdC5yaWdodCArPSB4T2ZmO1xuICB9XG4gIHJlY3QudG9wICs9IHlPZmY7IHJlY3QuYm90dG9tICs9IHlPZmY7XG4gIHJldHVybiByZWN0XG59XG5cbi8vIENvdmVydHMgYSBib3ggZnJvbSBcImRpdlwiIGNvb3JkcyB0byBhbm90aGVyIGNvb3JkaW5hdGUgc3lzdGVtLlxuLy8gQ29udGV4dCBtYXkgYmUgXCJ3aW5kb3dcIiwgXCJwYWdlXCIsIFwiZGl2XCIsIG9yIFwibG9jYWxcIi4vbnVsbC5cbmZ1bmN0aW9uIGZyb21Db29yZFN5c3RlbShjbSwgY29vcmRzLCBjb250ZXh0KSB7XG4gIGlmIChjb250ZXh0ID09IFwiZGl2XCIpIHsgcmV0dXJuIGNvb3JkcyB9XG4gIHZhciBsZWZ0ID0gY29vcmRzLmxlZnQsIHRvcCA9IGNvb3Jkcy50b3A7XG4gIC8vIEZpcnN0IG1vdmUgaW50byBcInBhZ2VcIiBjb29yZGluYXRlIHN5c3RlbVxuICBpZiAoY29udGV4dCA9PSBcInBhZ2VcIikge1xuICAgIGxlZnQgLT0gcGFnZVNjcm9sbFgoKTtcbiAgICB0b3AgLT0gcGFnZVNjcm9sbFkoKTtcbiAgfSBlbHNlIGlmIChjb250ZXh0ID09IFwibG9jYWxcIiB8fCAhY29udGV4dCkge1xuICAgIHZhciBsb2NhbEJveCA9IGNtLmRpc3BsYXkuc2l6ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbGVmdCArPSBsb2NhbEJveC5sZWZ0O1xuICAgIHRvcCArPSBsb2NhbEJveC50b3A7XG4gIH1cblxuICB2YXIgbGluZVNwYWNlQm94ID0gY20uZGlzcGxheS5saW5lU3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIHJldHVybiB7bGVmdDogbGVmdCAtIGxpbmVTcGFjZUJveC5sZWZ0LCB0b3A6IHRvcCAtIGxpbmVTcGFjZUJveC50b3B9XG59XG5cbmZ1bmN0aW9uIGNoYXJDb29yZHMoY20sIHBvcywgY29udGV4dCwgbGluZU9iaiwgYmlhcykge1xuICBpZiAoIWxpbmVPYmopIHsgbGluZU9iaiA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7IH1cbiAgcmV0dXJuIGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbWVhc3VyZUNoYXIoY20sIGxpbmVPYmosIHBvcy5jaCwgYmlhcyksIGNvbnRleHQpXG59XG5cbi8vIFJldHVybnMgYSBib3ggZm9yIGEgZ2l2ZW4gY3Vyc29yIHBvc2l0aW9uLCB3aGljaCBtYXkgaGF2ZSBhblxuLy8gJ290aGVyJyBwcm9wZXJ0eSBjb250YWluaW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgc2Vjb25kYXJ5IGN1cnNvclxuLy8gb24gYSBiaWRpIGJvdW5kYXJ5LlxuLy8gQSBjdXJzb3IgUG9zKGxpbmUsIGNoYXIsIFwiYmVmb3JlXCIpIGlzIG9uIHRoZSBzYW1lIHZpc3VhbCBsaW5lIGFzIGBjaGFyIC0gMWBcbi8vIGFuZCBhZnRlciBgY2hhciAtIDFgIGluIHdyaXRpbmcgb3JkZXIgb2YgYGNoYXIgLSAxYFxuLy8gQSBjdXJzb3IgUG9zKGxpbmUsIGNoYXIsIFwiYWZ0ZXJcIikgaXMgb24gdGhlIHNhbWUgdmlzdWFsIGxpbmUgYXMgYGNoYXJgXG4vLyBhbmQgYmVmb3JlIGBjaGFyYCBpbiB3cml0aW5nIG9yZGVyIG9mIGBjaGFyYFxuLy8gRXhhbXBsZXMgKHVwcGVyLWNhc2UgbGV0dGVycyBhcmUgUlRMLCBsb3dlci1jYXNlIGFyZSBMVFIpOlxuLy8gICAgIFBvcygwLCAxLCAuLi4pXG4vLyAgICAgYmVmb3JlICAgYWZ0ZXJcbi8vIGFiICAgICBhfGIgICAgIGF8YlxuLy8gYUIgICAgIGF8QiAgICAgYUJ8XG4vLyBBYiAgICAgfEFiICAgICBBfGJcbi8vIEFCICAgICBCfEEgICAgIEJ8QVxuLy8gRXZlcnkgcG9zaXRpb24gYWZ0ZXIgdGhlIGxhc3QgY2hhcmFjdGVyIG9uIGEgbGluZSBpcyBjb25zaWRlcmVkIHRvIHN0aWNrXG4vLyB0byB0aGUgbGFzdCBjaGFyYWN0ZXIgb24gdGhlIGxpbmUuXG5mdW5jdGlvbiBjdXJzb3JDb29yZHMoY20sIHBvcywgY29udGV4dCwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlLCB2YXJIZWlnaHQpIHtcbiAgbGluZU9iaiA9IGxpbmVPYmogfHwgZ2V0TGluZShjbS5kb2MsIHBvcy5saW5lKTtcbiAgaWYgKCFwcmVwYXJlZE1lYXN1cmUpIHsgcHJlcGFyZWRNZWFzdXJlID0gcHJlcGFyZU1lYXN1cmVGb3JMaW5lKGNtLCBsaW5lT2JqKTsgfVxuICBmdW5jdGlvbiBnZXQoY2gsIHJpZ2h0KSB7XG4gICAgdmFyIG0gPSBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZE1lYXN1cmUsIGNoLCByaWdodCA/IFwicmlnaHRcIiA6IFwibGVmdFwiLCB2YXJIZWlnaHQpO1xuICAgIGlmIChyaWdodCkgeyBtLmxlZnQgPSBtLnJpZ2h0OyB9IGVsc2UgeyBtLnJpZ2h0ID0gbS5sZWZ0OyB9XG4gICAgcmV0dXJuIGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbSwgY29udGV4dClcbiAgfVxuICB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lT2JqLCBjbS5kb2MuZGlyZWN0aW9uKSwgY2ggPSBwb3MuY2gsIHN0aWNreSA9IHBvcy5zdGlja3k7XG4gIGlmIChjaCA+PSBsaW5lT2JqLnRleHQubGVuZ3RoKSB7XG4gICAgY2ggPSBsaW5lT2JqLnRleHQubGVuZ3RoO1xuICAgIHN0aWNreSA9IFwiYmVmb3JlXCI7XG4gIH0gZWxzZSBpZiAoY2ggPD0gMCkge1xuICAgIGNoID0gMDtcbiAgICBzdGlja3kgPSBcImFmdGVyXCI7XG4gIH1cbiAgaWYgKCFvcmRlcikgeyByZXR1cm4gZ2V0KHN0aWNreSA9PSBcImJlZm9yZVwiID8gY2ggLSAxIDogY2gsIHN0aWNreSA9PSBcImJlZm9yZVwiKSB9XG5cbiAgZnVuY3Rpb24gZ2V0QmlkaShjaCwgcGFydFBvcywgaW52ZXJ0KSB7XG4gICAgdmFyIHBhcnQgPSBvcmRlcltwYXJ0UG9zXSwgcmlnaHQgPSAocGFydC5sZXZlbCAlIDIpICE9IDA7XG4gICAgcmV0dXJuIGdldChpbnZlcnQgPyBjaCAtIDEgOiBjaCwgcmlnaHQgIT0gaW52ZXJ0KVxuICB9XG4gIHZhciBwYXJ0UG9zID0gZ2V0QmlkaVBhcnRBdChvcmRlciwgY2gsIHN0aWNreSk7XG4gIHZhciBvdGhlciA9IGJpZGlPdGhlcjtcbiAgdmFyIHZhbCA9IGdldEJpZGkoY2gsIHBhcnRQb3MsIHN0aWNreSA9PSBcImJlZm9yZVwiKTtcbiAgaWYgKG90aGVyICE9IG51bGwpIHsgdmFsLm90aGVyID0gZ2V0QmlkaShjaCwgb3RoZXIsIHN0aWNreSAhPSBcImJlZm9yZVwiKTsgfVxuICByZXR1cm4gdmFsXG59XG5cbi8vIFVzZWQgdG8gY2hlYXBseSBlc3RpbWF0ZSB0aGUgY29vcmRpbmF0ZXMgZm9yIGEgcG9zaXRpb24uIFVzZWQgZm9yXG4vLyBpbnRlcm1lZGlhdGUgc2Nyb2xsIHVwZGF0ZXMuXG5mdW5jdGlvbiBlc3RpbWF0ZUNvb3JkcyhjbSwgcG9zKSB7XG4gIHZhciBsZWZ0ID0gMDtcbiAgcG9zID0gY2xpcFBvcyhjbS5kb2MsIHBvcyk7XG4gIGlmICghY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHsgbGVmdCA9IGNoYXJXaWR0aChjbS5kaXNwbGF5KSAqIHBvcy5jaDsgfVxuICB2YXIgbGluZU9iaiA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7XG4gIHZhciB0b3AgPSBoZWlnaHRBdExpbmUobGluZU9iaikgKyBwYWRkaW5nVG9wKGNtLmRpc3BsYXkpO1xuICByZXR1cm4ge2xlZnQ6IGxlZnQsIHJpZ2h0OiBsZWZ0LCB0b3A6IHRvcCwgYm90dG9tOiB0b3AgKyBsaW5lT2JqLmhlaWdodH1cbn1cblxuLy8gUG9zaXRpb25zIHJldHVybmVkIGJ5IGNvb3Jkc0NoYXIgY29udGFpbiBzb21lIGV4dHJhIGluZm9ybWF0aW9uLlxuLy8geFJlbCBpcyB0aGUgcmVsYXRpdmUgeCBwb3NpdGlvbiBvZiB0aGUgaW5wdXQgY29vcmRpbmF0ZXMgY29tcGFyZWRcbi8vIHRvIHRoZSBmb3VuZCBwb3NpdGlvbiAoc28geFJlbCA+IDAgbWVhbnMgdGhlIGNvb3JkaW5hdGVzIGFyZSB0b1xuLy8gdGhlIHJpZ2h0IG9mIHRoZSBjaGFyYWN0ZXIgcG9zaXRpb24sIGZvciBleGFtcGxlKS4gV2hlbiBvdXRzaWRlXG4vLyBpcyB0cnVlLCB0aGF0IG1lYW5zIHRoZSBjb29yZGluYXRlcyBsaWUgb3V0c2lkZSB0aGUgbGluZSdzXG4vLyB2ZXJ0aWNhbCByYW5nZS5cbmZ1bmN0aW9uIFBvc1dpdGhJbmZvKGxpbmUsIGNoLCBzdGlja3ksIG91dHNpZGUsIHhSZWwpIHtcbiAgdmFyIHBvcyA9IFBvcyhsaW5lLCBjaCwgc3RpY2t5KTtcbiAgcG9zLnhSZWwgPSB4UmVsO1xuICBpZiAob3V0c2lkZSkgeyBwb3Mub3V0c2lkZSA9IHRydWU7IH1cbiAgcmV0dXJuIHBvc1xufVxuXG4vLyBDb21wdXRlIHRoZSBjaGFyYWN0ZXIgcG9zaXRpb24gY2xvc2VzdCB0byB0aGUgZ2l2ZW4gY29vcmRpbmF0ZXMuXG4vLyBJbnB1dCBtdXN0IGJlIGxpbmVTcGFjZS1sb2NhbCAoXCJkaXZcIiBjb29yZGluYXRlIHN5c3RlbSkuXG5mdW5jdGlvbiBjb29yZHNDaGFyKGNtLCB4LCB5KSB7XG4gIHZhciBkb2MgPSBjbS5kb2M7XG4gIHkgKz0gY20uZGlzcGxheS52aWV3T2Zmc2V0O1xuICBpZiAoeSA8IDApIHsgcmV0dXJuIFBvc1dpdGhJbmZvKGRvYy5maXJzdCwgMCwgbnVsbCwgdHJ1ZSwgLTEpIH1cbiAgdmFyIGxpbmVOID0gbGluZUF0SGVpZ2h0KGRvYywgeSksIGxhc3QgPSBkb2MuZmlyc3QgKyBkb2Muc2l6ZSAtIDE7XG4gIGlmIChsaW5lTiA+IGxhc3QpXG4gICAgeyByZXR1cm4gUG9zV2l0aEluZm8oZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxLCBnZXRMaW5lKGRvYywgbGFzdCkudGV4dC5sZW5ndGgsIG51bGwsIHRydWUsIDEpIH1cbiAgaWYgKHggPCAwKSB7IHggPSAwOyB9XG5cbiAgdmFyIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZU4pO1xuICBmb3IgKDs7KSB7XG4gICAgdmFyIGZvdW5kID0gY29vcmRzQ2hhcklubmVyKGNtLCBsaW5lT2JqLCBsaW5lTiwgeCwgeSk7XG4gICAgdmFyIG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lT2JqKTtcbiAgICB2YXIgbWVyZ2VkUG9zID0gbWVyZ2VkICYmIG1lcmdlZC5maW5kKDAsIHRydWUpO1xuICAgIGlmIChtZXJnZWQgJiYgKGZvdW5kLmNoID4gbWVyZ2VkUG9zLmZyb20uY2ggfHwgZm91bmQuY2ggPT0gbWVyZ2VkUG9zLmZyb20uY2ggJiYgZm91bmQueFJlbCA+IDApKVxuICAgICAgeyBsaW5lTiA9IGxpbmVObyhsaW5lT2JqID0gbWVyZ2VkUG9zLnRvLmxpbmUpOyB9XG4gICAgZWxzZVxuICAgICAgeyByZXR1cm4gZm91bmQgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHdyYXBwZWRMaW5lRXh0ZW50KGNtLCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUsIHkpIHtcbiAgdmFyIG1lYXN1cmUgPSBmdW5jdGlvbiAoY2gpIHsgcmV0dXJuIGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZWRNZWFzdXJlLCBjaCksIFwibGluZVwiKTsgfTtcbiAgdmFyIGVuZCA9IGxpbmVPYmoudGV4dC5sZW5ndGg7XG4gIHZhciBiZWdpbiA9IGZpbmRGaXJzdChmdW5jdGlvbiAoY2gpIHsgcmV0dXJuIG1lYXN1cmUoY2ggLSAxKS5ib3R0b20gPD0geTsgfSwgZW5kLCAwKTtcbiAgZW5kID0gZmluZEZpcnN0KGZ1bmN0aW9uIChjaCkgeyByZXR1cm4gbWVhc3VyZShjaCkudG9wID4geTsgfSwgYmVnaW4sIGVuZCk7XG4gIHJldHVybiB7YmVnaW46IGJlZ2luLCBlbmQ6IGVuZH1cbn1cblxuZnVuY3Rpb24gd3JhcHBlZExpbmVFeHRlbnRDaGFyKGNtLCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUsIHRhcmdldCkge1xuICB2YXIgdGFyZ2V0VG9wID0gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZE1lYXN1cmUsIHRhcmdldCksIFwibGluZVwiKS50b3A7XG4gIHJldHVybiB3cmFwcGVkTGluZUV4dGVudChjbSwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlLCB0YXJnZXRUb3ApXG59XG5cbmZ1bmN0aW9uIGNvb3Jkc0NoYXJJbm5lcihjbSwgbGluZU9iaiwgbGluZU5vJCQxLCB4LCB5KSB7XG4gIHkgLT0gaGVpZ2h0QXRMaW5lKGxpbmVPYmopO1xuICB2YXIgYmVnaW4gPSAwLCBlbmQgPSBsaW5lT2JqLnRleHQubGVuZ3RoO1xuICB2YXIgcHJlcGFyZWRNZWFzdXJlID0gcHJlcGFyZU1lYXN1cmVGb3JMaW5lKGNtLCBsaW5lT2JqKTtcbiAgdmFyIHBvcztcbiAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZU9iaiwgY20uZG9jLmRpcmVjdGlvbik7XG4gIGlmIChvcmRlcikge1xuICAgIGlmIChjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgICAgdmFyIGFzc2lnbjtcbiAgICAgICgoYXNzaWduID0gd3JhcHBlZExpbmVFeHRlbnQoY20sIGxpbmVPYmosIHByZXBhcmVkTWVhc3VyZSwgeSksIGJlZ2luID0gYXNzaWduLmJlZ2luLCBlbmQgPSBhc3NpZ24uZW5kLCBhc3NpZ24pKTtcbiAgICB9XG4gICAgcG9zID0gbmV3IFBvcyhsaW5lTm8kJDEsIGJlZ2luKTtcbiAgICB2YXIgYmVnaW5MZWZ0ID0gY3Vyc29yQ29vcmRzKGNtLCBwb3MsIFwibGluZVwiLCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUpLmxlZnQ7XG4gICAgdmFyIGRpciA9IGJlZ2luTGVmdCA8IHggPyAxIDogLTE7XG4gICAgdmFyIHByZXZEaWZmLCBkaWZmID0gYmVnaW5MZWZ0IC0geCwgcHJldlBvcztcbiAgICBkbyB7XG4gICAgICBwcmV2RGlmZiA9IGRpZmY7XG4gICAgICBwcmV2UG9zID0gcG9zO1xuICAgICAgcG9zID0gbW92ZVZpc3VhbGx5KGNtLCBsaW5lT2JqLCBwb3MsIGRpcik7XG4gICAgICBpZiAocG9zID09IG51bGwgfHwgcG9zLmNoIDwgYmVnaW4gfHwgZW5kIDw9IChwb3Muc3RpY2t5ID09IFwiYmVmb3JlXCIgPyBwb3MuY2ggLSAxIDogcG9zLmNoKSkge1xuICAgICAgICBwb3MgPSBwcmV2UG9zO1xuICAgICAgICBicmVha1xuICAgICAgfVxuICAgICAgZGlmZiA9IGN1cnNvckNvb3JkcyhjbSwgcG9zLCBcImxpbmVcIiwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlKS5sZWZ0IC0geDtcbiAgICB9IHdoaWxlICgoZGlyIDwgMCkgIT0gKGRpZmYgPCAwKSAmJiAoTWF0aC5hYnMoZGlmZikgPD0gTWF0aC5hYnMocHJldkRpZmYpKSlcbiAgICBpZiAoTWF0aC5hYnMoZGlmZikgPiBNYXRoLmFicyhwcmV2RGlmZikpIHtcbiAgICAgIGlmICgoZGlmZiA8IDApID09IChwcmV2RGlmZiA8IDApKSB7IHRocm93IG5ldyBFcnJvcihcIkJyb2tlIG91dCBvZiBpbmZpbml0ZSBsb29wIGluIGNvb3Jkc0NoYXJJbm5lclwiKSB9XG4gICAgICBwb3MgPSBwcmV2UG9zO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB2YXIgY2ggPSBmaW5kRmlyc3QoZnVuY3Rpb24gKGNoKSB7XG4gICAgICB2YXIgYm94ID0gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZE1lYXN1cmUsIGNoKSwgXCJsaW5lXCIpO1xuICAgICAgaWYgKGJveC50b3AgPiB5KSB7XG4gICAgICAgIC8vIEZvciB0aGUgY3Vyc29yIHN0aWNraW5lc3NcbiAgICAgICAgZW5kID0gTWF0aC5taW4oY2gsIGVuZCk7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICBlbHNlIGlmIChib3guYm90dG9tIDw9IHkpIHsgcmV0dXJuIGZhbHNlIH1cbiAgICAgIGVsc2UgaWYgKGJveC5sZWZ0ID4geCkgeyByZXR1cm4gdHJ1ZSB9XG4gICAgICBlbHNlIGlmIChib3gucmlnaHQgPCB4KSB7IHJldHVybiBmYWxzZSB9XG4gICAgICBlbHNlIHsgcmV0dXJuICh4IC0gYm94LmxlZnQgPCBib3gucmlnaHQgLSB4KSB9XG4gICAgfSwgYmVnaW4sIGVuZCk7XG4gICAgY2ggPSBza2lwRXh0ZW5kaW5nQ2hhcnMobGluZU9iai50ZXh0LCBjaCwgMSk7XG4gICAgcG9zID0gbmV3IFBvcyhsaW5lTm8kJDEsIGNoLCBjaCA9PSBlbmQgPyBcImJlZm9yZVwiIDogXCJhZnRlclwiKTtcbiAgfVxuICB2YXIgY29vcmRzID0gY3Vyc29yQ29vcmRzKGNtLCBwb3MsIFwibGluZVwiLCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUpO1xuICBpZiAoeSA8IGNvb3Jkcy50b3AgfHwgY29vcmRzLmJvdHRvbSA8IHkpIHsgcG9zLm91dHNpZGUgPSB0cnVlOyB9XG4gIHBvcy54UmVsID0geCA8IGNvb3Jkcy5sZWZ0ID8gLTEgOiAoeCA+IGNvb3Jkcy5yaWdodCA/IDEgOiAwKTtcbiAgcmV0dXJuIHBvc1xufVxuXG52YXIgbWVhc3VyZVRleHQ7XG4vLyBDb21wdXRlIHRoZSBkZWZhdWx0IHRleHQgaGVpZ2h0LlxuZnVuY3Rpb24gdGV4dEhlaWdodChkaXNwbGF5KSB7XG4gIGlmIChkaXNwbGF5LmNhY2hlZFRleHRIZWlnaHQgIT0gbnVsbCkgeyByZXR1cm4gZGlzcGxheS5jYWNoZWRUZXh0SGVpZ2h0IH1cbiAgaWYgKG1lYXN1cmVUZXh0ID09IG51bGwpIHtcbiAgICBtZWFzdXJlVGV4dCA9IGVsdChcInByZVwiKTtcbiAgICAvLyBNZWFzdXJlIGEgYnVuY2ggb2YgbGluZXMsIGZvciBicm93c2VycyB0aGF0IGNvbXB1dGVcbiAgICAvLyBmcmFjdGlvbmFsIGhlaWdodHMuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OTsgKytpKSB7XG4gICAgICBtZWFzdXJlVGV4dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcInhcIikpO1xuICAgICAgbWVhc3VyZVRleHQuYXBwZW5kQ2hpbGQoZWx0KFwiYnJcIikpO1xuICAgIH1cbiAgICBtZWFzdXJlVGV4dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcInhcIikpO1xuICB9XG4gIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkubWVhc3VyZSwgbWVhc3VyZVRleHQpO1xuICB2YXIgaGVpZ2h0ID0gbWVhc3VyZVRleHQub2Zmc2V0SGVpZ2h0IC8gNTA7XG4gIGlmIChoZWlnaHQgPiAzKSB7IGRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodCA9IGhlaWdodDsgfVxuICByZW1vdmVDaGlsZHJlbihkaXNwbGF5Lm1lYXN1cmUpO1xuICByZXR1cm4gaGVpZ2h0IHx8IDFcbn1cblxuLy8gQ29tcHV0ZSB0aGUgZGVmYXVsdCBjaGFyYWN0ZXIgd2lkdGguXG5mdW5jdGlvbiBjaGFyV2lkdGgoZGlzcGxheSkge1xuICBpZiAoZGlzcGxheS5jYWNoZWRDaGFyV2lkdGggIT0gbnVsbCkgeyByZXR1cm4gZGlzcGxheS5jYWNoZWRDaGFyV2lkdGggfVxuICB2YXIgYW5jaG9yID0gZWx0KFwic3BhblwiLCBcInh4eHh4eHh4eHhcIik7XG4gIHZhciBwcmUgPSBlbHQoXCJwcmVcIiwgW2FuY2hvcl0pO1xuICByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5Lm1lYXN1cmUsIHByZSk7XG4gIHZhciByZWN0ID0gYW5jaG9yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCB3aWR0aCA9IChyZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0KSAvIDEwO1xuICBpZiAod2lkdGggPiAyKSB7IGRpc3BsYXkuY2FjaGVkQ2hhcldpZHRoID0gd2lkdGg7IH1cbiAgcmV0dXJuIHdpZHRoIHx8IDEwXG59XG5cbi8vIERvIGEgYnVsay1yZWFkIG9mIHRoZSBET00gcG9zaXRpb25zIGFuZCBzaXplcyBuZWVkZWQgdG8gZHJhdyB0aGVcbi8vIHZpZXcsIHNvIHRoYXQgd2UgZG9uJ3QgaW50ZXJsZWF2ZSByZWFkaW5nIGFuZCB3cml0aW5nIHRvIHRoZSBET00uXG5mdW5jdGlvbiBnZXREaW1lbnNpb25zKGNtKSB7XG4gIHZhciBkID0gY20uZGlzcGxheSwgbGVmdCA9IHt9LCB3aWR0aCA9IHt9O1xuICB2YXIgZ3V0dGVyTGVmdCA9IGQuZ3V0dGVycy5jbGllbnRMZWZ0O1xuICBmb3IgKHZhciBuID0gZC5ndXR0ZXJzLmZpcnN0Q2hpbGQsIGkgPSAwOyBuOyBuID0gbi5uZXh0U2libGluZywgKytpKSB7XG4gICAgbGVmdFtjbS5vcHRpb25zLmd1dHRlcnNbaV1dID0gbi5vZmZzZXRMZWZ0ICsgbi5jbGllbnRMZWZ0ICsgZ3V0dGVyTGVmdDtcbiAgICB3aWR0aFtjbS5vcHRpb25zLmd1dHRlcnNbaV1dID0gbi5jbGllbnRXaWR0aDtcbiAgfVxuICByZXR1cm4ge2ZpeGVkUG9zOiBjb21wZW5zYXRlRm9ySFNjcm9sbChkKSxcbiAgICAgICAgICBndXR0ZXJUb3RhbFdpZHRoOiBkLmd1dHRlcnMub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgZ3V0dGVyTGVmdDogbGVmdCxcbiAgICAgICAgICBndXR0ZXJXaWR0aDogd2lkdGgsXG4gICAgICAgICAgd3JhcHBlcldpZHRoOiBkLndyYXBwZXIuY2xpZW50V2lkdGh9XG59XG5cbi8vIENvbXB1dGVzIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCArIGRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aCxcbi8vIGJ1dCB1c2luZyBnZXRCb3VuZGluZ0NsaWVudFJlY3QgdG8gZ2V0IGEgc3ViLXBpeGVsLWFjY3VyYXRlXG4vLyByZXN1bHQuXG5mdW5jdGlvbiBjb21wZW5zYXRlRm9ySFNjcm9sbChkaXNwbGF5KSB7XG4gIHJldHVybiBkaXNwbGF5LnNjcm9sbGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBkaXNwbGF5LnNpemVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnRcbn1cblxuLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgZXN0aW1hdGVzIHRoZSBoZWlnaHQgb2YgYSBsaW5lLCB0byB1c2UgYXNcbi8vIGZpcnN0IGFwcHJveGltYXRpb24gdW50aWwgdGhlIGxpbmUgYmVjb21lcyB2aXNpYmxlIChhbmQgaXMgdGh1c1xuLy8gcHJvcGVybHkgbWVhc3VyYWJsZSkuXG5mdW5jdGlvbiBlc3RpbWF0ZUhlaWdodChjbSkge1xuICB2YXIgdGggPSB0ZXh0SGVpZ2h0KGNtLmRpc3BsYXkpLCB3cmFwcGluZyA9IGNtLm9wdGlvbnMubGluZVdyYXBwaW5nO1xuICB2YXIgcGVyTGluZSA9IHdyYXBwaW5nICYmIE1hdGgubWF4KDUsIGNtLmRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50V2lkdGggLyBjaGFyV2lkdGgoY20uZGlzcGxheSkgLSAzKTtcbiAgcmV0dXJuIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgaWYgKGxpbmVJc0hpZGRlbihjbS5kb2MsIGxpbmUpKSB7IHJldHVybiAwIH1cblxuICAgIHZhciB3aWRnZXRzSGVpZ2h0ID0gMDtcbiAgICBpZiAobGluZS53aWRnZXRzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS53aWRnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAobGluZS53aWRnZXRzW2ldLmhlaWdodCkgeyB3aWRnZXRzSGVpZ2h0ICs9IGxpbmUud2lkZ2V0c1tpXS5oZWlnaHQ7IH1cbiAgICB9IH1cblxuICAgIGlmICh3cmFwcGluZylcbiAgICAgIHsgcmV0dXJuIHdpZGdldHNIZWlnaHQgKyAoTWF0aC5jZWlsKGxpbmUudGV4dC5sZW5ndGggLyBwZXJMaW5lKSB8fCAxKSAqIHRoIH1cbiAgICBlbHNlXG4gICAgICB7IHJldHVybiB3aWRnZXRzSGVpZ2h0ICsgdGggfVxuICB9XG59XG5cbmZ1bmN0aW9uIGVzdGltYXRlTGluZUhlaWdodHMoY20pIHtcbiAgdmFyIGRvYyA9IGNtLmRvYywgZXN0ID0gZXN0aW1hdGVIZWlnaHQoY20pO1xuICBkb2MuaXRlcihmdW5jdGlvbiAobGluZSkge1xuICAgIHZhciBlc3RIZWlnaHQgPSBlc3QobGluZSk7XG4gICAgaWYgKGVzdEhlaWdodCAhPSBsaW5lLmhlaWdodCkgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGVzdEhlaWdodCk7IH1cbiAgfSk7XG59XG5cbi8vIEdpdmVuIGEgbW91c2UgZXZlbnQsIGZpbmQgdGhlIGNvcnJlc3BvbmRpbmcgcG9zaXRpb24uIElmIGxpYmVyYWxcbi8vIGlzIGZhbHNlLCBpdCBjaGVja3Mgd2hldGhlciBhIGd1dHRlciBvciBzY3JvbGxiYXIgd2FzIGNsaWNrZWQsXG4vLyBhbmQgcmV0dXJucyBudWxsIGlmIGl0IHdhcy4gZm9yUmVjdCBpcyB1c2VkIGJ5IHJlY3Rhbmd1bGFyXG4vLyBzZWxlY3Rpb25zLCBhbmQgdHJpZXMgdG8gZXN0aW1hdGUgYSBjaGFyYWN0ZXIgcG9zaXRpb24gZXZlbiBmb3Jcbi8vIGNvb3JkaW5hdGVzIGJleW9uZCB0aGUgcmlnaHQgb2YgdGhlIHRleHQuXG5mdW5jdGlvbiBwb3NGcm9tTW91c2UoY20sIGUsIGxpYmVyYWwsIGZvclJlY3QpIHtcbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICBpZiAoIWxpYmVyYWwgJiYgZV90YXJnZXQoZSkuZ2V0QXR0cmlidXRlKFwiY20tbm90LWNvbnRlbnRcIikgPT0gXCJ0cnVlXCIpIHsgcmV0dXJuIG51bGwgfVxuXG4gIHZhciB4LCB5LCBzcGFjZSA9IGRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAvLyBGYWlscyB1bnByZWRpY3RhYmx5IG9uIElFWzY3XSB3aGVuIG1vdXNlIGlzIGRyYWdnZWQgYXJvdW5kIHF1aWNrbHkuXG4gIHRyeSB7IHggPSBlLmNsaWVudFggLSBzcGFjZS5sZWZ0OyB5ID0gZS5jbGllbnRZIC0gc3BhY2UudG9wOyB9XG4gIGNhdGNoIChlKSB7IHJldHVybiBudWxsIH1cbiAgdmFyIGNvb3JkcyA9IGNvb3Jkc0NoYXIoY20sIHgsIHkpLCBsaW5lO1xuICBpZiAoZm9yUmVjdCAmJiBjb29yZHMueFJlbCA9PSAxICYmIChsaW5lID0gZ2V0TGluZShjbS5kb2MsIGNvb3Jkcy5saW5lKS50ZXh0KS5sZW5ndGggPT0gY29vcmRzLmNoKSB7XG4gICAgdmFyIGNvbERpZmYgPSBjb3VudENvbHVtbihsaW5lLCBsaW5lLmxlbmd0aCwgY20ub3B0aW9ucy50YWJTaXplKSAtIGxpbmUubGVuZ3RoO1xuICAgIGNvb3JkcyA9IFBvcyhjb29yZHMubGluZSwgTWF0aC5tYXgoMCwgTWF0aC5yb3VuZCgoeCAtIHBhZGRpbmdIKGNtLmRpc3BsYXkpLmxlZnQpIC8gY2hhcldpZHRoKGNtLmRpc3BsYXkpKSAtIGNvbERpZmYpKTtcbiAgfVxuICByZXR1cm4gY29vcmRzXG59XG5cbi8vIEZpbmQgdGhlIHZpZXcgZWxlbWVudCBjb3JyZXNwb25kaW5nIHRvIGEgZ2l2ZW4gbGluZS4gUmV0dXJuIG51bGxcbi8vIHdoZW4gdGhlIGxpbmUgaXNuJ3QgdmlzaWJsZS5cbmZ1bmN0aW9uIGZpbmRWaWV3SW5kZXgoY20sIG4pIHtcbiAgaWYgKG4gPj0gY20uZGlzcGxheS52aWV3VG8pIHsgcmV0dXJuIG51bGwgfVxuICBuIC09IGNtLmRpc3BsYXkudmlld0Zyb207XG4gIGlmIChuIDwgMCkgeyByZXR1cm4gbnVsbCB9XG4gIHZhciB2aWV3ID0gY20uZGlzcGxheS52aWV3O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICBuIC09IHZpZXdbaV0uc2l6ZTtcbiAgICBpZiAobiA8IDApIHsgcmV0dXJuIGkgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGlvbihjbSkge1xuICBjbS5kaXNwbGF5LmlucHV0LnNob3dTZWxlY3Rpb24oY20uZGlzcGxheS5pbnB1dC5wcmVwYXJlU2VsZWN0aW9uKCkpO1xufVxuXG5mdW5jdGlvbiBwcmVwYXJlU2VsZWN0aW9uKGNtLCBwcmltYXJ5KSB7XG4gIHZhciBkb2MgPSBjbS5kb2MsIHJlc3VsdCA9IHt9O1xuICB2YXIgY3VyRnJhZ21lbnQgPSByZXN1bHQuY3Vyc29ycyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgdmFyIHNlbEZyYWdtZW50ID0gcmVzdWx0LnNlbGVjdGlvbiA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHByaW1hcnkgPT09IGZhbHNlICYmIGkgPT0gZG9jLnNlbC5wcmltSW5kZXgpIHsgY29udGludWUgfVxuICAgIHZhciByYW5nZSQkMSA9IGRvYy5zZWwucmFuZ2VzW2ldO1xuICAgIGlmIChyYW5nZSQkMS5mcm9tKCkubGluZSA+PSBjbS5kaXNwbGF5LnZpZXdUbyB8fCByYW5nZSQkMS50bygpLmxpbmUgPCBjbS5kaXNwbGF5LnZpZXdGcm9tKSB7IGNvbnRpbnVlIH1cbiAgICB2YXIgY29sbGFwc2VkID0gcmFuZ2UkJDEuZW1wdHkoKTtcbiAgICBpZiAoY29sbGFwc2VkIHx8IGNtLm9wdGlvbnMuc2hvd0N1cnNvcldoZW5TZWxlY3RpbmcpXG4gICAgICB7IGRyYXdTZWxlY3Rpb25DdXJzb3IoY20sIHJhbmdlJCQxLmhlYWQsIGN1ckZyYWdtZW50KTsgfVxuICAgIGlmICghY29sbGFwc2VkKVxuICAgICAgeyBkcmF3U2VsZWN0aW9uUmFuZ2UoY20sIHJhbmdlJCQxLCBzZWxGcmFnbWVudCk7IH1cbiAgfVxuICByZXR1cm4gcmVzdWx0XG59XG5cbi8vIERyYXdzIGEgY3Vyc29yIGZvciB0aGUgZ2l2ZW4gcmFuZ2VcbmZ1bmN0aW9uIGRyYXdTZWxlY3Rpb25DdXJzb3IoY20sIGhlYWQsIG91dHB1dCkge1xuICB2YXIgcG9zID0gY3Vyc29yQ29vcmRzKGNtLCBoZWFkLCBcImRpdlwiLCBudWxsLCBudWxsLCAhY20ub3B0aW9ucy5zaW5nbGVDdXJzb3JIZWlnaHRQZXJMaW5lKTtcblxuICB2YXIgY3Vyc29yID0gb3V0cHV0LmFwcGVuZENoaWxkKGVsdChcImRpdlwiLCBcIlxcdTAwYTBcIiwgXCJDb2RlTWlycm9yLWN1cnNvclwiKSk7XG4gIGN1cnNvci5zdHlsZS5sZWZ0ID0gcG9zLmxlZnQgKyBcInB4XCI7XG4gIGN1cnNvci5zdHlsZS50b3AgPSBwb3MudG9wICsgXCJweFwiO1xuICBjdXJzb3Iuc3R5bGUuaGVpZ2h0ID0gTWF0aC5tYXgoMCwgcG9zLmJvdHRvbSAtIHBvcy50b3ApICogY20ub3B0aW9ucy5jdXJzb3JIZWlnaHQgKyBcInB4XCI7XG5cbiAgaWYgKHBvcy5vdGhlcikge1xuICAgIC8vIFNlY29uZGFyeSBjdXJzb3IsIHNob3duIHdoZW4gb24gYSAnanVtcCcgaW4gYmktZGlyZWN0aW9uYWwgdGV4dFxuICAgIHZhciBvdGhlckN1cnNvciA9IG91dHB1dC5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgXCJcXHUwMGEwXCIsIFwiQ29kZU1pcnJvci1jdXJzb3IgQ29kZU1pcnJvci1zZWNvbmRhcnljdXJzb3JcIikpO1xuICAgIG90aGVyQ3Vyc29yLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgIG90aGVyQ3Vyc29yLnN0eWxlLmxlZnQgPSBwb3Mub3RoZXIubGVmdCArIFwicHhcIjtcbiAgICBvdGhlckN1cnNvci5zdHlsZS50b3AgPSBwb3Mub3RoZXIudG9wICsgXCJweFwiO1xuICAgIG90aGVyQ3Vyc29yLnN0eWxlLmhlaWdodCA9IChwb3Mub3RoZXIuYm90dG9tIC0gcG9zLm90aGVyLnRvcCkgKiAuODUgKyBcInB4XCI7XG4gIH1cbn1cblxuLy8gRHJhd3MgdGhlIGdpdmVuIHJhbmdlIGFzIGEgaGlnaGxpZ2h0ZWQgc2VsZWN0aW9uXG5mdW5jdGlvbiBkcmF3U2VsZWN0aW9uUmFuZ2UoY20sIHJhbmdlJCQxLCBvdXRwdXQpIHtcbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG4gIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgdmFyIHBhZGRpbmcgPSBwYWRkaW5nSChjbS5kaXNwbGF5KSwgbGVmdFNpZGUgPSBwYWRkaW5nLmxlZnQ7XG4gIHZhciByaWdodFNpZGUgPSBNYXRoLm1heChkaXNwbGF5LnNpemVyV2lkdGgsIGRpc3BsYXlXaWR0aChjbSkgLSBkaXNwbGF5LnNpemVyLm9mZnNldExlZnQpIC0gcGFkZGluZy5yaWdodDtcblxuICBmdW5jdGlvbiBhZGQobGVmdCwgdG9wLCB3aWR0aCwgYm90dG9tKSB7XG4gICAgaWYgKHRvcCA8IDApIHsgdG9wID0gMDsgfVxuICAgIHRvcCA9IE1hdGgucm91bmQodG9wKTtcbiAgICBib3R0b20gPSBNYXRoLnJvdW5kKGJvdHRvbSk7XG4gICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1zZWxlY3RlZFwiLCAoXCJwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IFwiICsgbGVmdCArIFwicHg7XFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6IFwiICsgdG9wICsgXCJweDsgd2lkdGg6IFwiICsgKHdpZHRoID09IG51bGwgPyByaWdodFNpZGUgLSBsZWZ0IDogd2lkdGgpICsgXCJweDtcXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogXCIgKyAoYm90dG9tIC0gdG9wKSArIFwicHhcIikpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRyYXdGb3JMaW5lKGxpbmUsIGZyb21BcmcsIHRvQXJnKSB7XG4gICAgdmFyIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZSk7XG4gICAgdmFyIGxpbmVMZW4gPSBsaW5lT2JqLnRleHQubGVuZ3RoO1xuICAgIHZhciBzdGFydCwgZW5kO1xuICAgIGZ1bmN0aW9uIGNvb3JkcyhjaCwgYmlhcykge1xuICAgICAgcmV0dXJuIGNoYXJDb29yZHMoY20sIFBvcyhsaW5lLCBjaCksIFwiZGl2XCIsIGxpbmVPYmosIGJpYXMpXG4gICAgfVxuXG4gICAgaXRlcmF0ZUJpZGlTZWN0aW9ucyhnZXRPcmRlcihsaW5lT2JqLCBkb2MuZGlyZWN0aW9uKSwgZnJvbUFyZyB8fCAwLCB0b0FyZyA9PSBudWxsID8gbGluZUxlbiA6IHRvQXJnLCBmdW5jdGlvbiAoZnJvbSwgdG8sIGRpcikge1xuICAgICAgdmFyIGxlZnRQb3MgPSBjb29yZHMoZnJvbSwgXCJsZWZ0XCIpLCByaWdodFBvcywgbGVmdCwgcmlnaHQ7XG4gICAgICBpZiAoZnJvbSA9PSB0bykge1xuICAgICAgICByaWdodFBvcyA9IGxlZnRQb3M7XG4gICAgICAgIGxlZnQgPSByaWdodCA9IGxlZnRQb3MubGVmdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJpZ2h0UG9zID0gY29vcmRzKHRvIC0gMSwgXCJyaWdodFwiKTtcbiAgICAgICAgaWYgKGRpciA9PSBcInJ0bFwiKSB7IHZhciB0bXAgPSBsZWZ0UG9zOyBsZWZ0UG9zID0gcmlnaHRQb3M7IHJpZ2h0UG9zID0gdG1wOyB9XG4gICAgICAgIGxlZnQgPSBsZWZ0UG9zLmxlZnQ7XG4gICAgICAgIHJpZ2h0ID0gcmlnaHRQb3MucmlnaHQ7XG4gICAgICB9XG4gICAgICBpZiAoZnJvbUFyZyA9PSBudWxsICYmIGZyb20gPT0gMCkgeyBsZWZ0ID0gbGVmdFNpZGU7IH1cbiAgICAgIGlmIChyaWdodFBvcy50b3AgLSBsZWZ0UG9zLnRvcCA+IDMpIHsgLy8gRGlmZmVyZW50IGxpbmVzLCBkcmF3IHRvcCBwYXJ0XG4gICAgICAgIGFkZChsZWZ0LCBsZWZ0UG9zLnRvcCwgbnVsbCwgbGVmdFBvcy5ib3R0b20pO1xuICAgICAgICBsZWZ0ID0gbGVmdFNpZGU7XG4gICAgICAgIGlmIChsZWZ0UG9zLmJvdHRvbSA8IHJpZ2h0UG9zLnRvcCkgeyBhZGQobGVmdCwgbGVmdFBvcy5ib3R0b20sIG51bGwsIHJpZ2h0UG9zLnRvcCk7IH1cbiAgICAgIH1cbiAgICAgIGlmICh0b0FyZyA9PSBudWxsICYmIHRvID09IGxpbmVMZW4pIHsgcmlnaHQgPSByaWdodFNpZGU7IH1cbiAgICAgIGlmICghc3RhcnQgfHwgbGVmdFBvcy50b3AgPCBzdGFydC50b3AgfHwgbGVmdFBvcy50b3AgPT0gc3RhcnQudG9wICYmIGxlZnRQb3MubGVmdCA8IHN0YXJ0LmxlZnQpXG4gICAgICAgIHsgc3RhcnQgPSBsZWZ0UG9zOyB9XG4gICAgICBpZiAoIWVuZCB8fCByaWdodFBvcy5ib3R0b20gPiBlbmQuYm90dG9tIHx8IHJpZ2h0UG9zLmJvdHRvbSA9PSBlbmQuYm90dG9tICYmIHJpZ2h0UG9zLnJpZ2h0ID4gZW5kLnJpZ2h0KVxuICAgICAgICB7IGVuZCA9IHJpZ2h0UG9zOyB9XG4gICAgICBpZiAobGVmdCA8IGxlZnRTaWRlICsgMSkgeyBsZWZ0ID0gbGVmdFNpZGU7IH1cbiAgICAgIGFkZChsZWZ0LCByaWdodFBvcy50b3AsIHJpZ2h0IC0gbGVmdCwgcmlnaHRQb3MuYm90dG9tKTtcbiAgICB9KTtcbiAgICByZXR1cm4ge3N0YXJ0OiBzdGFydCwgZW5kOiBlbmR9XG4gIH1cblxuICB2YXIgc0Zyb20gPSByYW5nZSQkMS5mcm9tKCksIHNUbyA9IHJhbmdlJCQxLnRvKCk7XG4gIGlmIChzRnJvbS5saW5lID09IHNUby5saW5lKSB7XG4gICAgZHJhd0ZvckxpbmUoc0Zyb20ubGluZSwgc0Zyb20uY2gsIHNUby5jaCk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGZyb21MaW5lID0gZ2V0TGluZShkb2MsIHNGcm9tLmxpbmUpLCB0b0xpbmUgPSBnZXRMaW5lKGRvYywgc1RvLmxpbmUpO1xuICAgIHZhciBzaW5nbGVWTGluZSA9IHZpc3VhbExpbmUoZnJvbUxpbmUpID09IHZpc3VhbExpbmUodG9MaW5lKTtcbiAgICB2YXIgbGVmdEVuZCA9IGRyYXdGb3JMaW5lKHNGcm9tLmxpbmUsIHNGcm9tLmNoLCBzaW5nbGVWTGluZSA/IGZyb21MaW5lLnRleHQubGVuZ3RoICsgMSA6IG51bGwpLmVuZDtcbiAgICB2YXIgcmlnaHRTdGFydCA9IGRyYXdGb3JMaW5lKHNUby5saW5lLCBzaW5nbGVWTGluZSA/IDAgOiBudWxsLCBzVG8uY2gpLnN0YXJ0O1xuICAgIGlmIChzaW5nbGVWTGluZSkge1xuICAgICAgaWYgKGxlZnRFbmQudG9wIDwgcmlnaHRTdGFydC50b3AgLSAyKSB7XG4gICAgICAgIGFkZChsZWZ0RW5kLnJpZ2h0LCBsZWZ0RW5kLnRvcCwgbnVsbCwgbGVmdEVuZC5ib3R0b20pO1xuICAgICAgICBhZGQobGVmdFNpZGUsIHJpZ2h0U3RhcnQudG9wLCByaWdodFN0YXJ0LmxlZnQsIHJpZ2h0U3RhcnQuYm90dG9tKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFkZChsZWZ0RW5kLnJpZ2h0LCBsZWZ0RW5kLnRvcCwgcmlnaHRTdGFydC5sZWZ0IC0gbGVmdEVuZC5yaWdodCwgbGVmdEVuZC5ib3R0b20pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAobGVmdEVuZC5ib3R0b20gPCByaWdodFN0YXJ0LnRvcClcbiAgICAgIHsgYWRkKGxlZnRTaWRlLCBsZWZ0RW5kLmJvdHRvbSwgbnVsbCwgcmlnaHRTdGFydC50b3ApOyB9XG4gIH1cblxuICBvdXRwdXQuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xufVxuXG4vLyBDdXJzb3ItYmxpbmtpbmdcbmZ1bmN0aW9uIHJlc3RhcnRCbGluayhjbSkge1xuICBpZiAoIWNtLnN0YXRlLmZvY3VzZWQpIHsgcmV0dXJuIH1cbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICBjbGVhckludGVydmFsKGRpc3BsYXkuYmxpbmtlcik7XG4gIHZhciBvbiA9IHRydWU7XG4gIGRpc3BsYXkuY3Vyc29yRGl2LnN0eWxlLnZpc2liaWxpdHkgPSBcIlwiO1xuICBpZiAoY20ub3B0aW9ucy5jdXJzb3JCbGlua1JhdGUgPiAwKVxuICAgIHsgZGlzcGxheS5ibGlua2VyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyByZXR1cm4gZGlzcGxheS5jdXJzb3JEaXYuc3R5bGUudmlzaWJpbGl0eSA9IChvbiA9ICFvbikgPyBcIlwiIDogXCJoaWRkZW5cIjsgfSxcbiAgICAgIGNtLm9wdGlvbnMuY3Vyc29yQmxpbmtSYXRlKTsgfVxuICBlbHNlIGlmIChjbS5vcHRpb25zLmN1cnNvckJsaW5rUmF0ZSA8IDApXG4gICAgeyBkaXNwbGF5LmN1cnNvckRpdi5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjsgfVxufVxuXG5mdW5jdGlvbiBlbnN1cmVGb2N1cyhjbSkge1xuICBpZiAoIWNtLnN0YXRlLmZvY3VzZWQpIHsgY20uZGlzcGxheS5pbnB1dC5mb2N1cygpOyBvbkZvY3VzKGNtKTsgfVxufVxuXG5mdW5jdGlvbiBkZWxheUJsdXJFdmVudChjbSkge1xuICBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IHRydWU7XG4gIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBpZiAoY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQpIHtcbiAgICBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IGZhbHNlO1xuICAgIG9uQmx1cihjbSk7XG4gIH0gfSwgMTAwKTtcbn1cblxuZnVuY3Rpb24gb25Gb2N1cyhjbSwgZSkge1xuICBpZiAoY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQpIHsgY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQgPSBmYWxzZTsgfVxuXG4gIGlmIChjbS5vcHRpb25zLnJlYWRPbmx5ID09IFwibm9jdXJzb3JcIikgeyByZXR1cm4gfVxuICBpZiAoIWNtLnN0YXRlLmZvY3VzZWQpIHtcbiAgICBzaWduYWwoY20sIFwiZm9jdXNcIiwgY20sIGUpO1xuICAgIGNtLnN0YXRlLmZvY3VzZWQgPSB0cnVlO1xuICAgIGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgXCJDb2RlTWlycm9yLWZvY3VzZWRcIik7XG4gICAgLy8gVGhpcyB0ZXN0IHByZXZlbnRzIHRoaXMgZnJvbSBmaXJpbmcgd2hlbiBhIGNvbnRleHRcbiAgICAvLyBtZW51IGlzIGNsb3NlZCAoc2luY2UgdGhlIGlucHV0IHJlc2V0IHdvdWxkIGtpbGwgdGhlXG4gICAgLy8gc2VsZWN0LWFsbCBkZXRlY3Rpb24gaGFjaylcbiAgICBpZiAoIWNtLmN1ck9wICYmIGNtLmRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgIT0gY20uZG9jLnNlbCkge1xuICAgICAgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpO1xuICAgICAgaWYgKHdlYmtpdCkgeyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNtLmRpc3BsYXkuaW5wdXQucmVzZXQodHJ1ZSk7IH0sIDIwKTsgfSAvLyBJc3N1ZSAjMTczMFxuICAgIH1cbiAgICBjbS5kaXNwbGF5LmlucHV0LnJlY2VpdmVkRm9jdXMoKTtcbiAgfVxuICByZXN0YXJ0QmxpbmsoY20pO1xufVxuZnVuY3Rpb24gb25CbHVyKGNtLCBlKSB7XG4gIGlmIChjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCkgeyByZXR1cm4gfVxuXG4gIGlmIChjbS5zdGF0ZS5mb2N1c2VkKSB7XG4gICAgc2lnbmFsKGNtLCBcImJsdXJcIiwgY20sIGUpO1xuICAgIGNtLnN0YXRlLmZvY3VzZWQgPSBmYWxzZTtcbiAgICBybUNsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgXCJDb2RlTWlycm9yLWZvY3VzZWRcIik7XG4gIH1cbiAgY2xlYXJJbnRlcnZhbChjbS5kaXNwbGF5LmJsaW5rZXIpO1xuICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgaWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSB7IGNtLmRpc3BsYXkuc2hpZnQgPSBmYWxzZTsgfSB9LCAxNTApO1xufVxuXG4vLyBSZWFkIHRoZSBhY3R1YWwgaGVpZ2h0cyBvZiB0aGUgcmVuZGVyZWQgbGluZXMsIGFuZCB1cGRhdGUgdGhlaXJcbi8vIHN0b3JlZCBoZWlnaHRzIHRvIG1hdGNoLlxuZnVuY3Rpb24gdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pIHtcbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICB2YXIgcHJldkJvdHRvbSA9IGRpc3BsYXkubGluZURpdi5vZmZzZXRUb3A7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZGlzcGxheS52aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGN1ciA9IGRpc3BsYXkudmlld1tpXSwgaGVpZ2h0ID0gKHZvaWQgMCk7XG4gICAgaWYgKGN1ci5oaWRkZW4pIHsgY29udGludWUgfVxuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOCkge1xuICAgICAgdmFyIGJvdCA9IGN1ci5ub2RlLm9mZnNldFRvcCArIGN1ci5ub2RlLm9mZnNldEhlaWdodDtcbiAgICAgIGhlaWdodCA9IGJvdCAtIHByZXZCb3R0b207XG4gICAgICBwcmV2Qm90dG9tID0gYm90O1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgYm94ID0gY3VyLm5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBoZWlnaHQgPSBib3guYm90dG9tIC0gYm94LnRvcDtcbiAgICB9XG4gICAgdmFyIGRpZmYgPSBjdXIubGluZS5oZWlnaHQgLSBoZWlnaHQ7XG4gICAgaWYgKGhlaWdodCA8IDIpIHsgaGVpZ2h0ID0gdGV4dEhlaWdodChkaXNwbGF5KTsgfVxuICAgIGlmIChkaWZmID4gLjAwMSB8fCBkaWZmIDwgLS4wMDEpIHtcbiAgICAgIHVwZGF0ZUxpbmVIZWlnaHQoY3VyLmxpbmUsIGhlaWdodCk7XG4gICAgICB1cGRhdGVXaWRnZXRIZWlnaHQoY3VyLmxpbmUpO1xuICAgICAgaWYgKGN1ci5yZXN0KSB7IGZvciAodmFyIGogPSAwOyBqIDwgY3VyLnJlc3QubGVuZ3RoOyBqKyspXG4gICAgICAgIHsgdXBkYXRlV2lkZ2V0SGVpZ2h0KGN1ci5yZXN0W2pdKTsgfSB9XG4gICAgfVxuICB9XG59XG5cbi8vIFJlYWQgYW5kIHN0b3JlIHRoZSBoZWlnaHQgb2YgbGluZSB3aWRnZXRzIGFzc29jaWF0ZWQgd2l0aCB0aGVcbi8vIGdpdmVuIGxpbmUuXG5mdW5jdGlvbiB1cGRhdGVXaWRnZXRIZWlnaHQobGluZSkge1xuICBpZiAobGluZS53aWRnZXRzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS53aWRnZXRzLmxlbmd0aDsgKytpKVxuICAgIHsgbGluZS53aWRnZXRzW2ldLmhlaWdodCA9IGxpbmUud2lkZ2V0c1tpXS5ub2RlLnBhcmVudE5vZGUub2Zmc2V0SGVpZ2h0OyB9IH1cbn1cblxuLy8gQ29tcHV0ZSB0aGUgbGluZXMgdGhhdCBhcmUgdmlzaWJsZSBpbiBhIGdpdmVuIHZpZXdwb3J0IChkZWZhdWx0c1xuLy8gdGhlIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbikuIHZpZXdwb3J0IG1heSBjb250YWluIHRvcCxcbi8vIGhlaWdodCwgYW5kIGVuc3VyZSAoc2VlIG9wLnNjcm9sbFRvUG9zKSBwcm9wZXJ0aWVzLlxuZnVuY3Rpb24gdmlzaWJsZUxpbmVzKGRpc3BsYXksIGRvYywgdmlld3BvcnQpIHtcbiAgdmFyIHRvcCA9IHZpZXdwb3J0ICYmIHZpZXdwb3J0LnRvcCAhPSBudWxsID8gTWF0aC5tYXgoMCwgdmlld3BvcnQudG9wKSA6IGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wO1xuICB0b3AgPSBNYXRoLmZsb29yKHRvcCAtIHBhZGRpbmdUb3AoZGlzcGxheSkpO1xuICB2YXIgYm90dG9tID0gdmlld3BvcnQgJiYgdmlld3BvcnQuYm90dG9tICE9IG51bGwgPyB2aWV3cG9ydC5ib3R0b20gOiB0b3AgKyBkaXNwbGF5LndyYXBwZXIuY2xpZW50SGVpZ2h0O1xuXG4gIHZhciBmcm9tID0gbGluZUF0SGVpZ2h0KGRvYywgdG9wKSwgdG8gPSBsaW5lQXRIZWlnaHQoZG9jLCBib3R0b20pO1xuICAvLyBFbnN1cmUgaXMgYSB7ZnJvbToge2xpbmUsIGNofSwgdG86IHtsaW5lLCBjaH19IG9iamVjdCwgYW5kXG4gIC8vIGZvcmNlcyB0aG9zZSBsaW5lcyBpbnRvIHRoZSB2aWV3cG9ydCAoaWYgcG9zc2libGUpLlxuICBpZiAodmlld3BvcnQgJiYgdmlld3BvcnQuZW5zdXJlKSB7XG4gICAgdmFyIGVuc3VyZUZyb20gPSB2aWV3cG9ydC5lbnN1cmUuZnJvbS5saW5lLCBlbnN1cmVUbyA9IHZpZXdwb3J0LmVuc3VyZS50by5saW5lO1xuICAgIGlmIChlbnN1cmVGcm9tIDwgZnJvbSkge1xuICAgICAgZnJvbSA9IGVuc3VyZUZyb207XG4gICAgICB0byA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlRnJvbSkpICsgZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCk7XG4gICAgfSBlbHNlIGlmIChNYXRoLm1pbihlbnN1cmVUbywgZG9jLmxhc3RMaW5lKCkpID49IHRvKSB7XG4gICAgICBmcm9tID0gbGluZUF0SGVpZ2h0KGRvYywgaGVpZ2h0QXRMaW5lKGdldExpbmUoZG9jLCBlbnN1cmVUbykpIC0gZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCk7XG4gICAgICB0byA9IGVuc3VyZVRvO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge2Zyb206IGZyb20sIHRvOiBNYXRoLm1heCh0bywgZnJvbSArIDEpfVxufVxuXG4vLyBSZS1hbGlnbiBsaW5lIG51bWJlcnMgYW5kIGd1dHRlciBtYXJrcyB0byBjb21wZW5zYXRlIGZvclxuLy8gaG9yaXpvbnRhbCBzY3JvbGxpbmcuXG5mdW5jdGlvbiBhbGlnbkhvcml6b250YWxseShjbSkge1xuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHZpZXcgPSBkaXNwbGF5LnZpZXc7XG4gIGlmICghZGlzcGxheS5hbGlnbldpZGdldHMgJiYgKCFkaXNwbGF5Lmd1dHRlcnMuZmlyc3RDaGlsZCB8fCAhY20ub3B0aW9ucy5maXhlZEd1dHRlcikpIHsgcmV0dXJuIH1cbiAgdmFyIGNvbXAgPSBjb21wZW5zYXRlRm9ySFNjcm9sbChkaXNwbGF5KSAtIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCArIGNtLmRvYy5zY3JvbGxMZWZ0O1xuICB2YXIgZ3V0dGVyVyA9IGRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aCwgbGVmdCA9IGNvbXAgKyBcInB4XCI7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykgeyBpZiAoIXZpZXdbaV0uaGlkZGVuKSB7XG4gICAgaWYgKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIpIHtcbiAgICAgIGlmICh2aWV3W2ldLmd1dHRlcilcbiAgICAgICAgeyB2aWV3W2ldLmd1dHRlci5zdHlsZS5sZWZ0ID0gbGVmdDsgfVxuICAgICAgaWYgKHZpZXdbaV0uZ3V0dGVyQmFja2dyb3VuZClcbiAgICAgICAgeyB2aWV3W2ldLmd1dHRlckJhY2tncm91bmQuc3R5bGUubGVmdCA9IGxlZnQ7IH1cbiAgICB9XG4gICAgdmFyIGFsaWduID0gdmlld1tpXS5hbGlnbmFibGU7XG4gICAgaWYgKGFsaWduKSB7IGZvciAodmFyIGogPSAwOyBqIDwgYWxpZ24ubGVuZ3RoOyBqKyspXG4gICAgICB7IGFsaWduW2pdLnN0eWxlLmxlZnQgPSBsZWZ0OyB9IH1cbiAgfSB9XG4gIGlmIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyKVxuICAgIHsgZGlzcGxheS5ndXR0ZXJzLnN0eWxlLmxlZnQgPSAoY29tcCArIGd1dHRlclcpICsgXCJweFwiOyB9XG59XG5cbi8vIFVzZWQgdG8gZW5zdXJlIHRoYXQgdGhlIGxpbmUgbnVtYmVyIGd1dHRlciBpcyBzdGlsbCB0aGUgcmlnaHRcbi8vIHNpemUgZm9yIHRoZSBjdXJyZW50IGRvY3VtZW50IHNpemUuIFJldHVybnMgdHJ1ZSB3aGVuIGFuIHVwZGF0ZVxuLy8gaXMgbmVlZGVkLlxuZnVuY3Rpb24gbWF5YmVVcGRhdGVMaW5lTnVtYmVyV2lkdGgoY20pIHtcbiAgaWYgKCFjbS5vcHRpb25zLmxpbmVOdW1iZXJzKSB7IHJldHVybiBmYWxzZSB9XG4gIHZhciBkb2MgPSBjbS5kb2MsIGxhc3QgPSBsaW5lTnVtYmVyRm9yKGNtLm9wdGlvbnMsIGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSksIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICBpZiAobGFzdC5sZW5ndGggIT0gZGlzcGxheS5saW5lTnVtQ2hhcnMpIHtcbiAgICB2YXIgdGVzdCA9IGRpc3BsYXkubWVhc3VyZS5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgW2VsdChcImRpdlwiLCBsYXN0KV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQ29kZU1pcnJvci1saW5lbnVtYmVyIENvZGVNaXJyb3ItZ3V0dGVyLWVsdFwiKSk7XG4gICAgdmFyIGlubmVyVyA9IHRlc3QuZmlyc3RDaGlsZC5vZmZzZXRXaWR0aCwgcGFkZGluZyA9IHRlc3Qub2Zmc2V0V2lkdGggLSBpbm5lclc7XG4gICAgZGlzcGxheS5saW5lR3V0dGVyLnN0eWxlLndpZHRoID0gXCJcIjtcbiAgICBkaXNwbGF5LmxpbmVOdW1Jbm5lcldpZHRoID0gTWF0aC5tYXgoaW5uZXJXLCBkaXNwbGF5LmxpbmVHdXR0ZXIub2Zmc2V0V2lkdGggLSBwYWRkaW5nKSArIDE7XG4gICAgZGlzcGxheS5saW5lTnVtV2lkdGggPSBkaXNwbGF5LmxpbmVOdW1Jbm5lcldpZHRoICsgcGFkZGluZztcbiAgICBkaXNwbGF5LmxpbmVOdW1DaGFycyA9IGRpc3BsYXkubGluZU51bUlubmVyV2lkdGggPyBsYXN0Lmxlbmd0aCA6IC0xO1xuICAgIGRpc3BsYXkubGluZUd1dHRlci5zdHlsZS53aWR0aCA9IGRpc3BsYXkubGluZU51bVdpZHRoICsgXCJweFwiO1xuICAgIHVwZGF0ZUd1dHRlclNwYWNlKGNtKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG4vLyBTQ1JPTExJTkcgVEhJTkdTIElOVE8gVklFV1xuXG4vLyBJZiBhbiBlZGl0b3Igc2l0cyBvbiB0aGUgdG9wIG9yIGJvdHRvbSBvZiB0aGUgd2luZG93LCBwYXJ0aWFsbHlcbi8vIHNjcm9sbGVkIG91dCBvZiB2aWV3LCB0aGlzIGVuc3VyZXMgdGhhdCB0aGUgY3Vyc29yIGlzIHZpc2libGUuXG5mdW5jdGlvbiBtYXliZVNjcm9sbFdpbmRvdyhjbSwgcmVjdCkge1xuICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIFwic2Nyb2xsQ3Vyc29ySW50b1ZpZXdcIikpIHsgcmV0dXJuIH1cblxuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGJveCA9IGRpc3BsYXkuc2l6ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGRvU2Nyb2xsID0gbnVsbDtcbiAgaWYgKHJlY3QudG9wICsgYm94LnRvcCA8IDApIHsgZG9TY3JvbGwgPSB0cnVlOyB9XG4gIGVsc2UgaWYgKHJlY3QuYm90dG9tICsgYm94LnRvcCA+ICh3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCkpIHsgZG9TY3JvbGwgPSBmYWxzZTsgfVxuICBpZiAoZG9TY3JvbGwgIT0gbnVsbCAmJiAhcGhhbnRvbSkge1xuICAgIHZhciBzY3JvbGxOb2RlID0gZWx0KFwiZGl2XCIsIFwiXFx1MjAwYlwiLCBudWxsLCAoXCJwb3NpdGlvbjogYWJzb2x1dGU7XFxuICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogXCIgKyAocmVjdC50b3AgLSBkaXNwbGF5LnZpZXdPZmZzZXQgLSBwYWRkaW5nVG9wKGNtLmRpc3BsYXkpKSArIFwicHg7XFxuICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogXCIgKyAocmVjdC5ib3R0b20gLSByZWN0LnRvcCArIHNjcm9sbEdhcChjbSkgKyBkaXNwbGF5LmJhckhlaWdodCkgKyBcInB4O1xcbiAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiBcIiArIChyZWN0LmxlZnQpICsgXCJweDsgd2lkdGg6IFwiICsgKE1hdGgubWF4KDIsIHJlY3QucmlnaHQgLSByZWN0LmxlZnQpKSArIFwicHg7XCIpKTtcbiAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5hcHBlbmRDaGlsZChzY3JvbGxOb2RlKTtcbiAgICBzY3JvbGxOb2RlLnNjcm9sbEludG9WaWV3KGRvU2Nyb2xsKTtcbiAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5yZW1vdmVDaGlsZChzY3JvbGxOb2RlKTtcbiAgfVxufVxuXG4vLyBTY3JvbGwgYSBnaXZlbiBwb3NpdGlvbiBpbnRvIHZpZXcgKGltbWVkaWF0ZWx5KSwgdmVyaWZ5aW5nIHRoYXRcbi8vIGl0IGFjdHVhbGx5IGJlY2FtZSB2aXNpYmxlIChhcyBsaW5lIGhlaWdodHMgYXJlIGFjY3VyYXRlbHlcbi8vIG1lYXN1cmVkLCB0aGUgcG9zaXRpb24gb2Ygc29tZXRoaW5nIG1heSAnZHJpZnQnIGR1cmluZyBkcmF3aW5nKS5cbmZ1bmN0aW9uIHNjcm9sbFBvc0ludG9WaWV3KGNtLCBwb3MsIGVuZCwgbWFyZ2luKSB7XG4gIGlmIChtYXJnaW4gPT0gbnVsbCkgeyBtYXJnaW4gPSAwOyB9XG4gIHZhciByZWN0O1xuICBmb3IgKHZhciBsaW1pdCA9IDA7IGxpbWl0IDwgNTsgbGltaXQrKykge1xuICAgIHZhciBjaGFuZ2VkID0gZmFsc2U7XG4gICAgdmFyIGNvb3JkcyA9IGN1cnNvckNvb3JkcyhjbSwgcG9zKTtcbiAgICB2YXIgZW5kQ29vcmRzID0gIWVuZCB8fCBlbmQgPT0gcG9zID8gY29vcmRzIDogY3Vyc29yQ29vcmRzKGNtLCBlbmQpO1xuICAgIHJlY3QgPSB7bGVmdDogTWF0aC5taW4oY29vcmRzLmxlZnQsIGVuZENvb3Jkcy5sZWZ0KSxcbiAgICAgICAgICAgIHRvcDogTWF0aC5taW4oY29vcmRzLnRvcCwgZW5kQ29vcmRzLnRvcCkgLSBtYXJnaW4sXG4gICAgICAgICAgICByaWdodDogTWF0aC5tYXgoY29vcmRzLmxlZnQsIGVuZENvb3Jkcy5sZWZ0KSxcbiAgICAgICAgICAgIGJvdHRvbTogTWF0aC5tYXgoY29vcmRzLmJvdHRvbSwgZW5kQ29vcmRzLmJvdHRvbSkgKyBtYXJnaW59O1xuICAgIHZhciBzY3JvbGxQb3MgPSBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIHJlY3QpO1xuICAgIHZhciBzdGFydFRvcCA9IGNtLmRvYy5zY3JvbGxUb3AsIHN0YXJ0TGVmdCA9IGNtLmRvYy5zY3JvbGxMZWZ0O1xuICAgIGlmIChzY3JvbGxQb3Muc2Nyb2xsVG9wICE9IG51bGwpIHtcbiAgICAgIHVwZGF0ZVNjcm9sbFRvcChjbSwgc2Nyb2xsUG9zLnNjcm9sbFRvcCk7XG4gICAgICBpZiAoTWF0aC5hYnMoY20uZG9jLnNjcm9sbFRvcCAtIHN0YXJ0VG9wKSA+IDEpIHsgY2hhbmdlZCA9IHRydWU7IH1cbiAgICB9XG4gICAgaWYgKHNjcm9sbFBvcy5zY3JvbGxMZWZ0ICE9IG51bGwpIHtcbiAgICAgIHNldFNjcm9sbExlZnQoY20sIHNjcm9sbFBvcy5zY3JvbGxMZWZ0KTtcbiAgICAgIGlmIChNYXRoLmFicyhjbS5kb2Muc2Nyb2xsTGVmdCAtIHN0YXJ0TGVmdCkgPiAxKSB7IGNoYW5nZWQgPSB0cnVlOyB9XG4gICAgfVxuICAgIGlmICghY2hhbmdlZCkgeyBicmVhayB9XG4gIH1cbiAgcmV0dXJuIHJlY3Rcbn1cblxuLy8gU2Nyb2xsIGEgZ2l2ZW4gc2V0IG9mIGNvb3JkaW5hdGVzIGludG8gdmlldyAoaW1tZWRpYXRlbHkpLlxuZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoY20sIHJlY3QpIHtcbiAgdmFyIHNjcm9sbFBvcyA9IGNhbGN1bGF0ZVNjcm9sbFBvcyhjbSwgcmVjdCk7XG4gIGlmIChzY3JvbGxQb3Muc2Nyb2xsVG9wICE9IG51bGwpIHsgdXBkYXRlU2Nyb2xsVG9wKGNtLCBzY3JvbGxQb3Muc2Nyb2xsVG9wKTsgfVxuICBpZiAoc2Nyb2xsUG9zLnNjcm9sbExlZnQgIT0gbnVsbCkgeyBzZXRTY3JvbGxMZWZ0KGNtLCBzY3JvbGxQb3Muc2Nyb2xsTGVmdCk7IH1cbn1cblxuLy8gQ2FsY3VsYXRlIGEgbmV3IHNjcm9sbCBwb3NpdGlvbiBuZWVkZWQgdG8gc2Nyb2xsIHRoZSBnaXZlblxuLy8gcmVjdGFuZ2xlIGludG8gdmlldy4gUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBzY3JvbGxUb3AgYW5kXG4vLyBzY3JvbGxMZWZ0IHByb3BlcnRpZXMuIFdoZW4gdGhlc2UgYXJlIHVuZGVmaW5lZCwgdGhlXG4vLyB2ZXJ0aWNhbC9ob3Jpem9udGFsIHBvc2l0aW9uIGRvZXMgbm90IG5lZWQgdG8gYmUgYWRqdXN0ZWQuXG5mdW5jdGlvbiBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIHJlY3QpIHtcbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBzbmFwTWFyZ2luID0gdGV4dEhlaWdodChjbS5kaXNwbGF5KTtcbiAgaWYgKHJlY3QudG9wIDwgMCkgeyByZWN0LnRvcCA9IDA7IH1cbiAgdmFyIHNjcmVlbnRvcCA9IGNtLmN1ck9wICYmIGNtLmN1ck9wLnNjcm9sbFRvcCAhPSBudWxsID8gY20uY3VyT3Auc2Nyb2xsVG9wIDogZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3A7XG4gIHZhciBzY3JlZW4gPSBkaXNwbGF5SGVpZ2h0KGNtKSwgcmVzdWx0ID0ge307XG4gIGlmIChyZWN0LmJvdHRvbSAtIHJlY3QudG9wID4gc2NyZWVuKSB7IHJlY3QuYm90dG9tID0gcmVjdC50b3AgKyBzY3JlZW47IH1cbiAgdmFyIGRvY0JvdHRvbSA9IGNtLmRvYy5oZWlnaHQgKyBwYWRkaW5nVmVydChkaXNwbGF5KTtcbiAgdmFyIGF0VG9wID0gcmVjdC50b3AgPCBzbmFwTWFyZ2luLCBhdEJvdHRvbSA9IHJlY3QuYm90dG9tID4gZG9jQm90dG9tIC0gc25hcE1hcmdpbjtcbiAgaWYgKHJlY3QudG9wIDwgc2NyZWVudG9wKSB7XG4gICAgcmVzdWx0LnNjcm9sbFRvcCA9IGF0VG9wID8gMCA6IHJlY3QudG9wO1xuICB9IGVsc2UgaWYgKHJlY3QuYm90dG9tID4gc2NyZWVudG9wICsgc2NyZWVuKSB7XG4gICAgdmFyIG5ld1RvcCA9IE1hdGgubWluKHJlY3QudG9wLCAoYXRCb3R0b20gPyBkb2NCb3R0b20gOiByZWN0LmJvdHRvbSkgLSBzY3JlZW4pO1xuICAgIGlmIChuZXdUb3AgIT0gc2NyZWVudG9wKSB7IHJlc3VsdC5zY3JvbGxUb3AgPSBuZXdUb3A7IH1cbiAgfVxuXG4gIHZhciBzY3JlZW5sZWZ0ID0gY20uY3VyT3AgJiYgY20uY3VyT3Auc2Nyb2xsTGVmdCAhPSBudWxsID8gY20uY3VyT3Auc2Nyb2xsTGVmdCA6IGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdDtcbiAgdmFyIHNjcmVlbncgPSBkaXNwbGF5V2lkdGgoY20pIC0gKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBkaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGggOiAwKTtcbiAgdmFyIHRvb1dpZGUgPSByZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0ID4gc2NyZWVudztcbiAgaWYgKHRvb1dpZGUpIHsgcmVjdC5yaWdodCA9IHJlY3QubGVmdCArIHNjcmVlbnc7IH1cbiAgaWYgKHJlY3QubGVmdCA8IDEwKVxuICAgIHsgcmVzdWx0LnNjcm9sbExlZnQgPSAwOyB9XG4gIGVsc2UgaWYgKHJlY3QubGVmdCA8IHNjcmVlbmxlZnQpXG4gICAgeyByZXN1bHQuc2Nyb2xsTGVmdCA9IE1hdGgubWF4KDAsIHJlY3QubGVmdCAtICh0b29XaWRlID8gMCA6IDEwKSk7IH1cbiAgZWxzZSBpZiAocmVjdC5yaWdodCA+IHNjcmVlbncgKyBzY3JlZW5sZWZ0IC0gMylcbiAgICB7IHJlc3VsdC5zY3JvbGxMZWZ0ID0gcmVjdC5yaWdodCArICh0b29XaWRlID8gMCA6IDEwKSAtIHNjcmVlbnc7IH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG4vLyBTdG9yZSBhIHJlbGF0aXZlIGFkanVzdG1lbnQgdG8gdGhlIHNjcm9sbCBwb3NpdGlvbiBpbiB0aGUgY3VycmVudFxuLy8gb3BlcmF0aW9uICh0byBiZSBhcHBsaWVkIHdoZW4gdGhlIG9wZXJhdGlvbiBmaW5pc2hlcykuXG5mdW5jdGlvbiBhZGRUb1Njcm9sbFRvcChjbSwgdG9wKSB7XG4gIGlmICh0b3AgPT0gbnVsbCkgeyByZXR1cm4gfVxuICByZXNvbHZlU2Nyb2xsVG9Qb3MoY20pO1xuICBjbS5jdXJPcC5zY3JvbGxUb3AgPSAoY20uY3VyT3Auc2Nyb2xsVG9wID09IG51bGwgPyBjbS5kb2Muc2Nyb2xsVG9wIDogY20uY3VyT3Auc2Nyb2xsVG9wKSArIHRvcDtcbn1cblxuLy8gTWFrZSBzdXJlIHRoYXQgYXQgdGhlIGVuZCBvZiB0aGUgb3BlcmF0aW9uIHRoZSBjdXJyZW50IGN1cnNvciBpc1xuLy8gc2hvd24uXG5mdW5jdGlvbiBlbnN1cmVDdXJzb3JWaXNpYmxlKGNtKSB7XG4gIHJlc29sdmVTY3JvbGxUb1BvcyhjbSk7XG4gIHZhciBjdXIgPSBjbS5nZXRDdXJzb3IoKSwgZnJvbSA9IGN1ciwgdG8gPSBjdXI7XG4gIGlmICghY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHtcbiAgICBmcm9tID0gY3VyLmNoID8gUG9zKGN1ci5saW5lLCBjdXIuY2ggLSAxKSA6IGN1cjtcbiAgICB0byA9IFBvcyhjdXIubGluZSwgY3VyLmNoICsgMSk7XG4gIH1cbiAgY20uY3VyT3Auc2Nyb2xsVG9Qb3MgPSB7ZnJvbTogZnJvbSwgdG86IHRvLCBtYXJnaW46IGNtLm9wdGlvbnMuY3Vyc29yU2Nyb2xsTWFyZ2lufTtcbn1cblxuZnVuY3Rpb24gc2Nyb2xsVG9Db29yZHMoY20sIHgsIHkpIHtcbiAgaWYgKHggIT0gbnVsbCB8fCB5ICE9IG51bGwpIHsgcmVzb2x2ZVNjcm9sbFRvUG9zKGNtKTsgfVxuICBpZiAoeCAhPSBudWxsKSB7IGNtLmN1ck9wLnNjcm9sbExlZnQgPSB4OyB9XG4gIGlmICh5ICE9IG51bGwpIHsgY20uY3VyT3Auc2Nyb2xsVG9wID0geTsgfVxufVxuXG5mdW5jdGlvbiBzY3JvbGxUb1JhbmdlKGNtLCByYW5nZSQkMSkge1xuICByZXNvbHZlU2Nyb2xsVG9Qb3MoY20pO1xuICBjbS5jdXJPcC5zY3JvbGxUb1BvcyA9IHJhbmdlJCQxO1xufVxuXG4vLyBXaGVuIGFuIG9wZXJhdGlvbiBoYXMgaXRzIHNjcm9sbFRvUG9zIHByb3BlcnR5IHNldCwgYW5kIGFub3RoZXJcbi8vIHNjcm9sbCBhY3Rpb24gaXMgYXBwbGllZCBiZWZvcmUgdGhlIGVuZCBvZiB0aGUgb3BlcmF0aW9uLCB0aGlzXG4vLyAnc2ltdWxhdGVzJyBzY3JvbGxpbmcgdGhhdCBwb3NpdGlvbiBpbnRvIHZpZXcgaW4gYSBjaGVhcCB3YXksIHNvXG4vLyB0aGF0IHRoZSBlZmZlY3Qgb2YgaW50ZXJtZWRpYXRlIHNjcm9sbCBjb21tYW5kcyBpcyBub3QgaWdub3JlZC5cbmZ1bmN0aW9uIHJlc29sdmVTY3JvbGxUb1BvcyhjbSkge1xuICB2YXIgcmFuZ2UkJDEgPSBjbS5jdXJPcC5zY3JvbGxUb1BvcztcbiAgaWYgKHJhbmdlJCQxKSB7XG4gICAgY20uY3VyT3Auc2Nyb2xsVG9Qb3MgPSBudWxsO1xuICAgIHZhciBmcm9tID0gZXN0aW1hdGVDb29yZHMoY20sIHJhbmdlJCQxLmZyb20pLCB0byA9IGVzdGltYXRlQ29vcmRzKGNtLCByYW5nZSQkMS50byk7XG4gICAgc2Nyb2xsVG9Db29yZHNSYW5nZShjbSwgZnJvbSwgdG8sIHJhbmdlJCQxLm1hcmdpbik7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2Nyb2xsVG9Db29yZHNSYW5nZShjbSwgZnJvbSwgdG8sIG1hcmdpbikge1xuICB2YXIgc1BvcyA9IGNhbGN1bGF0ZVNjcm9sbFBvcyhjbSwge1xuICAgIGxlZnQ6IE1hdGgubWluKGZyb20ubGVmdCwgdG8ubGVmdCksXG4gICAgdG9wOiBNYXRoLm1pbihmcm9tLnRvcCwgdG8udG9wKSAtIG1hcmdpbixcbiAgICByaWdodDogTWF0aC5tYXgoZnJvbS5yaWdodCwgdG8ucmlnaHQpLFxuICAgIGJvdHRvbTogTWF0aC5tYXgoZnJvbS5ib3R0b20sIHRvLmJvdHRvbSkgKyBtYXJnaW5cbiAgfSk7XG4gIHNjcm9sbFRvQ29vcmRzKGNtLCBzUG9zLnNjcm9sbExlZnQsIHNQb3Muc2Nyb2xsVG9wKTtcbn1cblxuLy8gU3luYyB0aGUgc2Nyb2xsYWJsZSBhcmVhIGFuZCBzY3JvbGxiYXJzLCBlbnN1cmUgdGhlIHZpZXdwb3J0XG4vLyBjb3ZlcnMgdGhlIHZpc2libGUgYXJlYS5cbmZ1bmN0aW9uIHVwZGF0ZVNjcm9sbFRvcChjbSwgdmFsKSB7XG4gIGlmIChNYXRoLmFicyhjbS5kb2Muc2Nyb2xsVG9wIC0gdmFsKSA8IDIpIHsgcmV0dXJuIH1cbiAgaWYgKCFnZWNrbykgeyB1cGRhdGVEaXNwbGF5U2ltcGxlKGNtLCB7dG9wOiB2YWx9KTsgfVxuICBzZXRTY3JvbGxUb3AoY20sIHZhbCwgdHJ1ZSk7XG4gIGlmIChnZWNrbykgeyB1cGRhdGVEaXNwbGF5U2ltcGxlKGNtKTsgfVxuICBzdGFydFdvcmtlcihjbSwgMTAwKTtcbn1cblxuZnVuY3Rpb24gc2V0U2Nyb2xsVG9wKGNtLCB2YWwsIGZvcmNlU2Nyb2xsKSB7XG4gIHZhbCA9IE1hdGgubWluKGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsSGVpZ2h0IC0gY20uZGlzcGxheS5zY3JvbGxlci5jbGllbnRIZWlnaHQsIHZhbCk7XG4gIGlmIChjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcCA9PSB2YWwgJiYgIWZvcmNlU2Nyb2xsKSB7IHJldHVybiB9XG4gIGNtLmRvYy5zY3JvbGxUb3AgPSB2YWw7XG4gIGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxUb3AodmFsKTtcbiAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wICE9IHZhbCkgeyBjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcCA9IHZhbDsgfVxufVxuXG4vLyBTeW5jIHNjcm9sbGVyIGFuZCBzY3JvbGxiYXIsIGVuc3VyZSB0aGUgZ3V0dGVyIGVsZW1lbnRzIGFyZVxuLy8gYWxpZ25lZC5cbmZ1bmN0aW9uIHNldFNjcm9sbExlZnQoY20sIHZhbCwgaXNTY3JvbGxlciwgZm9yY2VTY3JvbGwpIHtcbiAgdmFsID0gTWF0aC5taW4odmFsLCBjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFdpZHRoIC0gY20uZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aCk7XG4gIGlmICgoaXNTY3JvbGxlciA/IHZhbCA9PSBjbS5kb2Muc2Nyb2xsTGVmdCA6IE1hdGguYWJzKGNtLmRvYy5zY3JvbGxMZWZ0IC0gdmFsKSA8IDIpICYmICFmb3JjZVNjcm9sbCkgeyByZXR1cm4gfVxuICBjbS5kb2Muc2Nyb2xsTGVmdCA9IHZhbDtcbiAgYWxpZ25Ib3Jpem9udGFsbHkoY20pO1xuICBpZiAoY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxMZWZ0ICE9IHZhbCkgeyBjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgPSB2YWw7IH1cbiAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbExlZnQodmFsKTtcbn1cblxuLy8gU0NST0xMQkFSU1xuXG4vLyBQcmVwYXJlIERPTSByZWFkcyBuZWVkZWQgdG8gdXBkYXRlIHRoZSBzY3JvbGxiYXJzLiBEb25lIGluIG9uZVxuLy8gc2hvdCB0byBtaW5pbWl6ZSB1cGRhdGUvbWVhc3VyZSByb3VuZHRyaXBzLlxuZnVuY3Rpb24gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pIHtcbiAgdmFyIGQgPSBjbS5kaXNwbGF5LCBndXR0ZXJXID0gZC5ndXR0ZXJzLm9mZnNldFdpZHRoO1xuICB2YXIgZG9jSCA9IE1hdGgucm91bmQoY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGNtLmRpc3BsYXkpKTtcbiAgcmV0dXJuIHtcbiAgICBjbGllbnRIZWlnaHQ6IGQuc2Nyb2xsZXIuY2xpZW50SGVpZ2h0LFxuICAgIHZpZXdIZWlnaHQ6IGQud3JhcHBlci5jbGllbnRIZWlnaHQsXG4gICAgc2Nyb2xsV2lkdGg6IGQuc2Nyb2xsZXIuc2Nyb2xsV2lkdGgsIGNsaWVudFdpZHRoOiBkLnNjcm9sbGVyLmNsaWVudFdpZHRoLFxuICAgIHZpZXdXaWR0aDogZC53cmFwcGVyLmNsaWVudFdpZHRoLFxuICAgIGJhckxlZnQ6IGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBndXR0ZXJXIDogMCxcbiAgICBkb2NIZWlnaHQ6IGRvY0gsXG4gICAgc2Nyb2xsSGVpZ2h0OiBkb2NIICsgc2Nyb2xsR2FwKGNtKSArIGQuYmFySGVpZ2h0LFxuICAgIG5hdGl2ZUJhcldpZHRoOiBkLm5hdGl2ZUJhcldpZHRoLFxuICAgIGd1dHRlcldpZHRoOiBndXR0ZXJXXG4gIH1cbn1cblxudmFyIE5hdGl2ZVNjcm9sbGJhcnMgPSBmdW5jdGlvbihwbGFjZSwgc2Nyb2xsLCBjbSkge1xuICB0aGlzLmNtID0gY207XG4gIHZhciB2ZXJ0ID0gdGhpcy52ZXJ0ID0gZWx0KFwiZGl2XCIsIFtlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJtaW4td2lkdGg6IDFweFwiKV0sIFwiQ29kZU1pcnJvci12c2Nyb2xsYmFyXCIpO1xuICB2YXIgaG9yaXogPSB0aGlzLmhvcml6ID0gZWx0KFwiZGl2XCIsIFtlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJoZWlnaHQ6IDEwMCU7IG1pbi1oZWlnaHQ6IDFweFwiKV0sIFwiQ29kZU1pcnJvci1oc2Nyb2xsYmFyXCIpO1xuICBwbGFjZSh2ZXJ0KTsgcGxhY2UoaG9yaXopO1xuXG4gIG9uKHZlcnQsIFwic2Nyb2xsXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodmVydC5jbGllbnRIZWlnaHQpIHsgc2Nyb2xsKHZlcnQuc2Nyb2xsVG9wLCBcInZlcnRpY2FsXCIpOyB9XG4gIH0pO1xuICBvbihob3JpeiwgXCJzY3JvbGxcIiwgZnVuY3Rpb24gKCkge1xuICAgIGlmIChob3Jpei5jbGllbnRXaWR0aCkgeyBzY3JvbGwoaG9yaXouc2Nyb2xsTGVmdCwgXCJob3Jpem9udGFsXCIpOyB9XG4gIH0pO1xuXG4gIHRoaXMuY2hlY2tlZFplcm9XaWR0aCA9IGZhbHNlO1xuICAvLyBOZWVkIHRvIHNldCBhIG1pbmltdW0gd2lkdGggdG8gc2VlIHRoZSBzY3JvbGxiYXIgb24gSUU3IChidXQgbXVzdCBub3Qgc2V0IGl0IG9uIElFOCkuXG4gIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOCkgeyB0aGlzLmhvcml6LnN0eWxlLm1pbkhlaWdodCA9IHRoaXMudmVydC5zdHlsZS5taW5XaWR0aCA9IFwiMThweFwiOyB9XG59O1xuXG5OYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAobWVhc3VyZSkge1xuICB2YXIgbmVlZHNIID0gbWVhc3VyZS5zY3JvbGxXaWR0aCA+IG1lYXN1cmUuY2xpZW50V2lkdGggKyAxO1xuICB2YXIgbmVlZHNWID0gbWVhc3VyZS5zY3JvbGxIZWlnaHQgPiBtZWFzdXJlLmNsaWVudEhlaWdodCArIDE7XG4gIHZhciBzV2lkdGggPSBtZWFzdXJlLm5hdGl2ZUJhcldpZHRoO1xuXG4gIGlmIChuZWVkc1YpIHtcbiAgICB0aGlzLnZlcnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICB0aGlzLnZlcnQuc3R5bGUuYm90dG9tID0gbmVlZHNIID8gc1dpZHRoICsgXCJweFwiIDogXCIwXCI7XG4gICAgdmFyIHRvdGFsSGVpZ2h0ID0gbWVhc3VyZS52aWV3SGVpZ2h0IC0gKG5lZWRzSCA/IHNXaWR0aCA6IDApO1xuICAgIC8vIEEgYnVnIGluIElFOCBjYW4gY2F1c2UgdGhpcyB2YWx1ZSB0byBiZSBuZWdhdGl2ZSwgc28gZ3VhcmQgaXQuXG4gICAgdGhpcy52ZXJ0LmZpcnN0Q2hpbGQuc3R5bGUuaGVpZ2h0ID1cbiAgICAgIE1hdGgubWF4KDAsIG1lYXN1cmUuc2Nyb2xsSGVpZ2h0IC0gbWVhc3VyZS5jbGllbnRIZWlnaHQgKyB0b3RhbEhlaWdodCkgKyBcInB4XCI7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy52ZXJ0LnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgIHRoaXMudmVydC5maXJzdENoaWxkLnN0eWxlLmhlaWdodCA9IFwiMFwiO1xuICB9XG5cbiAgaWYgKG5lZWRzSCkge1xuICAgIHRoaXMuaG9yaXouc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICB0aGlzLmhvcml6LnN0eWxlLnJpZ2h0ID0gbmVlZHNWID8gc1dpZHRoICsgXCJweFwiIDogXCIwXCI7XG4gICAgdGhpcy5ob3Jpei5zdHlsZS5sZWZ0ID0gbWVhc3VyZS5iYXJMZWZ0ICsgXCJweFwiO1xuICAgIHZhciB0b3RhbFdpZHRoID0gbWVhc3VyZS52aWV3V2lkdGggLSBtZWFzdXJlLmJhckxlZnQgLSAobmVlZHNWID8gc1dpZHRoIDogMCk7XG4gICAgdGhpcy5ob3Jpei5maXJzdENoaWxkLnN0eWxlLndpZHRoID1cbiAgICAgIE1hdGgubWF4KDAsIG1lYXN1cmUuc2Nyb2xsV2lkdGggLSBtZWFzdXJlLmNsaWVudFdpZHRoICsgdG90YWxXaWR0aCkgKyBcInB4XCI7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy5ob3Jpei5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICB0aGlzLmhvcml6LmZpcnN0Q2hpbGQuc3R5bGUud2lkdGggPSBcIjBcIjtcbiAgfVxuXG4gIGlmICghdGhpcy5jaGVja2VkWmVyb1dpZHRoICYmIG1lYXN1cmUuY2xpZW50SGVpZ2h0ID4gMCkge1xuICAgIGlmIChzV2lkdGggPT0gMCkgeyB0aGlzLnplcm9XaWR0aEhhY2soKTsgfVxuICAgIHRoaXMuY2hlY2tlZFplcm9XaWR0aCA9IHRydWU7XG4gIH1cblxuICByZXR1cm4ge3JpZ2h0OiBuZWVkc1YgPyBzV2lkdGggOiAwLCBib3R0b206IG5lZWRzSCA/IHNXaWR0aCA6IDB9XG59O1xuXG5OYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS5zZXRTY3JvbGxMZWZ0ID0gZnVuY3Rpb24gKHBvcykge1xuICBpZiAodGhpcy5ob3Jpei5zY3JvbGxMZWZ0ICE9IHBvcykgeyB0aGlzLmhvcml6LnNjcm9sbExlZnQgPSBwb3M7IH1cbiAgaWYgKHRoaXMuZGlzYWJsZUhvcml6KSB7IHRoaXMuZW5hYmxlWmVyb1dpZHRoQmFyKHRoaXMuaG9yaXosIHRoaXMuZGlzYWJsZUhvcml6LCBcImhvcml6XCIpOyB9XG59O1xuXG5OYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS5zZXRTY3JvbGxUb3AgPSBmdW5jdGlvbiAocG9zKSB7XG4gIGlmICh0aGlzLnZlcnQuc2Nyb2xsVG9wICE9IHBvcykgeyB0aGlzLnZlcnQuc2Nyb2xsVG9wID0gcG9zOyB9XG4gIGlmICh0aGlzLmRpc2FibGVWZXJ0KSB7IHRoaXMuZW5hYmxlWmVyb1dpZHRoQmFyKHRoaXMudmVydCwgdGhpcy5kaXNhYmxlVmVydCwgXCJ2ZXJ0XCIpOyB9XG59O1xuXG5OYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS56ZXJvV2lkdGhIYWNrID0gZnVuY3Rpb24gKCkge1xuICB2YXIgdyA9IG1hYyAmJiAhbWFjX2dlTW91bnRhaW5MaW9uID8gXCIxMnB4XCIgOiBcIjE4cHhcIjtcbiAgdGhpcy5ob3Jpei5zdHlsZS5oZWlnaHQgPSB0aGlzLnZlcnQuc3R5bGUud2lkdGggPSB3O1xuICB0aGlzLmhvcml6LnN0eWxlLnBvaW50ZXJFdmVudHMgPSB0aGlzLnZlcnQuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICB0aGlzLmRpc2FibGVIb3JpeiA9IG5ldyBEZWxheWVkO1xuICB0aGlzLmRpc2FibGVWZXJ0ID0gbmV3IERlbGF5ZWQ7XG59O1xuXG5OYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS5lbmFibGVaZXJvV2lkdGhCYXIgPSBmdW5jdGlvbiAoYmFyLCBkZWxheSwgdHlwZSkge1xuICBiYXIuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYXV0b1wiO1xuICBmdW5jdGlvbiBtYXliZURpc2FibGUoKSB7XG4gICAgLy8gVG8gZmluZCBvdXQgd2hldGhlciB0aGUgc2Nyb2xsYmFyIGlzIHN0aWxsIHZpc2libGUsIHdlXG4gICAgLy8gY2hlY2sgd2hldGhlciB0aGUgZWxlbWVudCB1bmRlciB0aGUgcGl4ZWwgaW4gdGhlIGJvdHRvbVxuICAgIC8vIHJpZ2h0IGNvcm5lciBvZiB0aGUgc2Nyb2xsYmFyIGJveCBpcyB0aGUgc2Nyb2xsYmFyIGJveFxuICAgIC8vIGl0c2VsZiAod2hlbiB0aGUgYmFyIGlzIHN0aWxsIHZpc2libGUpIG9yIGl0cyBmaWxsZXIgY2hpbGRcbiAgICAvLyAod2hlbiB0aGUgYmFyIGlzIGhpZGRlbikuIElmIGl0IGlzIHN0aWxsIHZpc2libGUsIHdlIGtlZXBcbiAgICAvLyBpdCBlbmFibGVkLCBpZiBpdCdzIGhpZGRlbiwgd2UgZGlzYWJsZSBwb2ludGVyIGV2ZW50cy5cbiAgICB2YXIgYm94ID0gYmFyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHZhciBlbHQkJDEgPSB0eXBlID09IFwidmVydFwiID8gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChib3gucmlnaHQgLSAxLCAoYm94LnRvcCArIGJveC5ib3R0b20pIC8gMilcbiAgICAgICAgOiBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KChib3gucmlnaHQgKyBib3gubGVmdCkgLyAyLCBib3guYm90dG9tIC0gMSk7XG4gICAgaWYgKGVsdCQkMSAhPSBiYXIpIHsgYmFyLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjsgfVxuICAgIGVsc2UgeyBkZWxheS5zZXQoMTAwMCwgbWF5YmVEaXNhYmxlKTsgfVxuICB9XG4gIGRlbGF5LnNldCgxMDAwLCBtYXliZURpc2FibGUpO1xufTtcblxuTmF0aXZlU2Nyb2xsYmFycy5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBwYXJlbnQgPSB0aGlzLmhvcml6LnBhcmVudE5vZGU7XG4gIHBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLmhvcml6KTtcbiAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMudmVydCk7XG59O1xuXG52YXIgTnVsbFNjcm9sbGJhcnMgPSBmdW5jdGlvbiAoKSB7fTtcblxuTnVsbFNjcm9sbGJhcnMucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHtib3R0b206IDAsIHJpZ2h0OiAwfSB9O1xuTnVsbFNjcm9sbGJhcnMucHJvdG90eXBlLnNldFNjcm9sbExlZnQgPSBmdW5jdGlvbiAoKSB7fTtcbk51bGxTY3JvbGxiYXJzLnByb3RvdHlwZS5zZXRTY3JvbGxUb3AgPSBmdW5jdGlvbiAoKSB7fTtcbk51bGxTY3JvbGxiYXJzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHt9O1xuXG5mdW5jdGlvbiB1cGRhdGVTY3JvbGxiYXJzKGNtLCBtZWFzdXJlKSB7XG4gIGlmICghbWVhc3VyZSkgeyBtZWFzdXJlID0gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pOyB9XG4gIHZhciBzdGFydFdpZHRoID0gY20uZGlzcGxheS5iYXJXaWR0aCwgc3RhcnRIZWlnaHQgPSBjbS5kaXNwbGF5LmJhckhlaWdodDtcbiAgdXBkYXRlU2Nyb2xsYmFyc0lubmVyKGNtLCBtZWFzdXJlKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCA0ICYmIHN0YXJ0V2lkdGggIT0gY20uZGlzcGxheS5iYXJXaWR0aCB8fCBzdGFydEhlaWdodCAhPSBjbS5kaXNwbGF5LmJhckhlaWdodDsgaSsrKSB7XG4gICAgaWYgKHN0YXJ0V2lkdGggIT0gY20uZGlzcGxheS5iYXJXaWR0aCAmJiBjbS5vcHRpb25zLmxpbmVXcmFwcGluZylcbiAgICAgIHsgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pOyB9XG4gICAgdXBkYXRlU2Nyb2xsYmFyc0lubmVyKGNtLCBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSkpO1xuICAgIHN0YXJ0V2lkdGggPSBjbS5kaXNwbGF5LmJhcldpZHRoOyBzdGFydEhlaWdodCA9IGNtLmRpc3BsYXkuYmFySGVpZ2h0O1xuICB9XG59XG5cbi8vIFJlLXN5bmNocm9uaXplIHRoZSBmYWtlIHNjcm9sbGJhcnMgd2l0aCB0aGUgYWN0dWFsIHNpemUgb2YgdGhlXG4vLyBjb250ZW50LlxuZnVuY3Rpb24gdXBkYXRlU2Nyb2xsYmFyc0lubmVyKGNtLCBtZWFzdXJlKSB7XG4gIHZhciBkID0gY20uZGlzcGxheTtcbiAgdmFyIHNpemVzID0gZC5zY3JvbGxiYXJzLnVwZGF0ZShtZWFzdXJlKTtcblxuICBkLnNpemVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IChkLmJhcldpZHRoID0gc2l6ZXMucmlnaHQpICsgXCJweFwiO1xuICBkLnNpemVyLnN0eWxlLnBhZGRpbmdCb3R0b20gPSAoZC5iYXJIZWlnaHQgPSBzaXplcy5ib3R0b20pICsgXCJweFwiO1xuICBkLmhlaWdodEZvcmNlci5zdHlsZS5ib3JkZXJCb3R0b20gPSBzaXplcy5ib3R0b20gKyBcInB4IHNvbGlkIHRyYW5zcGFyZW50XCI7XG5cbiAgaWYgKHNpemVzLnJpZ2h0ICYmIHNpemVzLmJvdHRvbSkge1xuICAgIGQuc2Nyb2xsYmFyRmlsbGVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgZC5zY3JvbGxiYXJGaWxsZXIuc3R5bGUuaGVpZ2h0ID0gc2l6ZXMuYm90dG9tICsgXCJweFwiO1xuICAgIGQuc2Nyb2xsYmFyRmlsbGVyLnN0eWxlLndpZHRoID0gc2l6ZXMucmlnaHQgKyBcInB4XCI7XG4gIH0gZWxzZSB7IGQuc2Nyb2xsYmFyRmlsbGVyLnN0eWxlLmRpc3BsYXkgPSBcIlwiOyB9XG4gIGlmIChzaXplcy5ib3R0b20gJiYgY20ub3B0aW9ucy5jb3Zlckd1dHRlck5leHRUb1Njcm9sbGJhciAmJiBjbS5vcHRpb25zLmZpeGVkR3V0dGVyKSB7XG4gICAgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICBkLmd1dHRlckZpbGxlci5zdHlsZS5oZWlnaHQgPSBzaXplcy5ib3R0b20gKyBcInB4XCI7XG4gICAgZC5ndXR0ZXJGaWxsZXIuc3R5bGUud2lkdGggPSBtZWFzdXJlLmd1dHRlcldpZHRoICsgXCJweFwiO1xuICB9IGVsc2UgeyBkLmd1dHRlckZpbGxlci5zdHlsZS5kaXNwbGF5ID0gXCJcIjsgfVxufVxuXG52YXIgc2Nyb2xsYmFyTW9kZWwgPSB7XCJuYXRpdmVcIjogTmF0aXZlU2Nyb2xsYmFycywgXCJudWxsXCI6IE51bGxTY3JvbGxiYXJzfTtcblxuZnVuY3Rpb24gaW5pdFNjcm9sbGJhcnMoY20pIHtcbiAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsYmFycykge1xuICAgIGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5jbGVhcigpO1xuICAgIGlmIChjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpXG4gICAgICB7IHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpOyB9XG4gIH1cblxuICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMgPSBuZXcgc2Nyb2xsYmFyTW9kZWxbY20ub3B0aW9ucy5zY3JvbGxiYXJTdHlsZV0oZnVuY3Rpb24gKG5vZGUpIHtcbiAgICBjbS5kaXNwbGF5LndyYXBwZXIuaW5zZXJ0QmVmb3JlKG5vZGUsIGNtLmRpc3BsYXkuc2Nyb2xsYmFyRmlsbGVyKTtcbiAgICAvLyBQcmV2ZW50IGNsaWNrcyBpbiB0aGUgc2Nyb2xsYmFycyBmcm9tIGtpbGxpbmcgZm9jdXNcbiAgICBvbihub2RlLCBcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoY20uc3RhdGUuZm9jdXNlZCkgeyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgfSwgMCk7IH1cbiAgICB9KTtcbiAgICBub2RlLnNldEF0dHJpYnV0ZShcImNtLW5vdC1jb250ZW50XCIsIFwidHJ1ZVwiKTtcbiAgfSwgZnVuY3Rpb24gKHBvcywgYXhpcykge1xuICAgIGlmIChheGlzID09IFwiaG9yaXpvbnRhbFwiKSB7IHNldFNjcm9sbExlZnQoY20sIHBvcyk7IH1cbiAgICBlbHNlIHsgdXBkYXRlU2Nyb2xsVG9wKGNtLCBwb3MpOyB9XG4gIH0sIGNtKTtcbiAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5hZGRDbGFzcylcbiAgICB7IGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgY20uZGlzcGxheS5zY3JvbGxiYXJzLmFkZENsYXNzKTsgfVxufVxuXG4vLyBPcGVyYXRpb25zIGFyZSB1c2VkIHRvIHdyYXAgYSBzZXJpZXMgb2YgY2hhbmdlcyB0byB0aGUgZWRpdG9yXG4vLyBzdGF0ZSBpbiBzdWNoIGEgd2F5IHRoYXQgZWFjaCBjaGFuZ2Ugd29uJ3QgaGF2ZSB0byB1cGRhdGUgdGhlXG4vLyBjdXJzb3IgYW5kIGRpc3BsYXkgKHdoaWNoIHdvdWxkIGJlIGF3a3dhcmQsIHNsb3csIGFuZFxuLy8gZXJyb3ItcHJvbmUpLiBJbnN0ZWFkLCBkaXNwbGF5IHVwZGF0ZXMgYXJlIGJhdGNoZWQgYW5kIHRoZW4gYWxsXG4vLyBjb21iaW5lZCBhbmQgZXhlY3V0ZWQgYXQgb25jZS5cblxudmFyIG5leHRPcElkID0gMDtcbi8vIFN0YXJ0IGEgbmV3IG9wZXJhdGlvbi5cbmZ1bmN0aW9uIHN0YXJ0T3BlcmF0aW9uKGNtKSB7XG4gIGNtLmN1ck9wID0ge1xuICAgIGNtOiBjbSxcbiAgICB2aWV3Q2hhbmdlZDogZmFsc2UsICAgICAgLy8gRmxhZyB0aGF0IGluZGljYXRlcyB0aGF0IGxpbmVzIG1pZ2h0IG5lZWQgdG8gYmUgcmVkcmF3blxuICAgIHN0YXJ0SGVpZ2h0OiBjbS5kb2MuaGVpZ2h0LCAvLyBVc2VkIHRvIGRldGVjdCBuZWVkIHRvIHVwZGF0ZSBzY3JvbGxiYXJcbiAgICBmb3JjZVVwZGF0ZTogZmFsc2UsICAgICAgLy8gVXNlZCB0byBmb3JjZSBhIHJlZHJhd1xuICAgIHVwZGF0ZUlucHV0OiBudWxsLCAgICAgICAvLyBXaGV0aGVyIHRvIHJlc2V0IHRoZSBpbnB1dCB0ZXh0YXJlYVxuICAgIHR5cGluZzogZmFsc2UsICAgICAgICAgICAvLyBXaGV0aGVyIHRoaXMgcmVzZXQgc2hvdWxkIGJlIGNhcmVmdWwgdG8gbGVhdmUgZXhpc3RpbmcgdGV4dCAoZm9yIGNvbXBvc2l0aW5nKVxuICAgIGNoYW5nZU9ianM6IG51bGwsICAgICAgICAvLyBBY2N1bXVsYXRlZCBjaGFuZ2VzLCBmb3IgZmlyaW5nIGNoYW5nZSBldmVudHNcbiAgICBjdXJzb3JBY3Rpdml0eUhhbmRsZXJzOiBudWxsLCAvLyBTZXQgb2YgaGFuZGxlcnMgdG8gZmlyZSBjdXJzb3JBY3Rpdml0eSBvblxuICAgIGN1cnNvckFjdGl2aXR5Q2FsbGVkOiAwLCAvLyBUcmFja3Mgd2hpY2ggY3Vyc29yQWN0aXZpdHkgaGFuZGxlcnMgaGF2ZSBiZWVuIGNhbGxlZCBhbHJlYWR5XG4gICAgc2VsZWN0aW9uQ2hhbmdlZDogZmFsc2UsIC8vIFdoZXRoZXIgdGhlIHNlbGVjdGlvbiBuZWVkcyB0byBiZSByZWRyYXduXG4gICAgdXBkYXRlTWF4TGluZTogZmFsc2UsICAgIC8vIFNldCB3aGVuIHRoZSB3aWRlc3QgbGluZSBuZWVkcyB0byBiZSBkZXRlcm1pbmVkIGFuZXdcbiAgICBzY3JvbGxMZWZ0OiBudWxsLCBzY3JvbGxUb3A6IG51bGwsIC8vIEludGVybWVkaWF0ZSBzY3JvbGwgcG9zaXRpb24sIG5vdCBwdXNoZWQgdG8gRE9NIHlldFxuICAgIHNjcm9sbFRvUG9zOiBudWxsLCAgICAgICAvLyBVc2VkIHRvIHNjcm9sbCB0byBhIHNwZWNpZmljIHBvc2l0aW9uXG4gICAgZm9jdXM6IGZhbHNlLFxuICAgIGlkOiArK25leHRPcElkICAgICAgICAgICAvLyBVbmlxdWUgSURcbiAgfTtcbiAgcHVzaE9wZXJhdGlvbihjbS5jdXJPcCk7XG59XG5cbi8vIEZpbmlzaCBhbiBvcGVyYXRpb24sIHVwZGF0aW5nIHRoZSBkaXNwbGF5IGFuZCBzaWduYWxsaW5nIGRlbGF5ZWQgZXZlbnRzXG5mdW5jdGlvbiBlbmRPcGVyYXRpb24oY20pIHtcbiAgdmFyIG9wID0gY20uY3VyT3A7XG4gIGZpbmlzaE9wZXJhdGlvbihvcCwgZnVuY3Rpb24gKGdyb3VwKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cC5vcHMubGVuZ3RoOyBpKyspXG4gICAgICB7IGdyb3VwLm9wc1tpXS5jbS5jdXJPcCA9IG51bGw7IH1cbiAgICBlbmRPcGVyYXRpb25zKGdyb3VwKTtcbiAgfSk7XG59XG5cbi8vIFRoZSBET00gdXBkYXRlcyBkb25lIHdoZW4gYW4gb3BlcmF0aW9uIGZpbmlzaGVzIGFyZSBiYXRjaGVkIHNvXG4vLyB0aGF0IHRoZSBtaW5pbXVtIG51bWJlciBvZiByZWxheW91dHMgYXJlIHJlcXVpcmVkLlxuZnVuY3Rpb24gZW5kT3BlcmF0aW9ucyhncm91cCkge1xuICB2YXIgb3BzID0gZ3JvdXAub3BzO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IG9wcy5sZW5ndGg7IGkrKykgLy8gUmVhZCBET01cbiAgICB7IGVuZE9wZXJhdGlvbl9SMShvcHNbaV0pOyB9XG4gIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IG9wcy5sZW5ndGg7IGkkMSsrKSAvLyBXcml0ZSBET00gKG1heWJlKVxuICAgIHsgZW5kT3BlcmF0aW9uX1cxKG9wc1tpJDFdKTsgfVxuICBmb3IgKHZhciBpJDIgPSAwOyBpJDIgPCBvcHMubGVuZ3RoOyBpJDIrKykgLy8gUmVhZCBET01cbiAgICB7IGVuZE9wZXJhdGlvbl9SMihvcHNbaSQyXSk7IH1cbiAgZm9yICh2YXIgaSQzID0gMDsgaSQzIDwgb3BzLmxlbmd0aDsgaSQzKyspIC8vIFdyaXRlIERPTSAobWF5YmUpXG4gICAgeyBlbmRPcGVyYXRpb25fVzIob3BzW2kkM10pOyB9XG4gIGZvciAodmFyIGkkNCA9IDA7IGkkNCA8IG9wcy5sZW5ndGg7IGkkNCsrKSAvLyBSZWFkIERPTVxuICAgIHsgZW5kT3BlcmF0aW9uX2ZpbmlzaChvcHNbaSQ0XSk7IH1cbn1cblxuZnVuY3Rpb24gZW5kT3BlcmF0aW9uX1IxKG9wKSB7XG4gIHZhciBjbSA9IG9wLmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgbWF5YmVDbGlwU2Nyb2xsYmFycyhjbSk7XG4gIGlmIChvcC51cGRhdGVNYXhMaW5lKSB7IGZpbmRNYXhMaW5lKGNtKTsgfVxuXG4gIG9wLm11c3RVcGRhdGUgPSBvcC52aWV3Q2hhbmdlZCB8fCBvcC5mb3JjZVVwZGF0ZSB8fCBvcC5zY3JvbGxUb3AgIT0gbnVsbCB8fFxuICAgIG9wLnNjcm9sbFRvUG9zICYmIChvcC5zY3JvbGxUb1Bvcy5mcm9tLmxpbmUgPCBkaXNwbGF5LnZpZXdGcm9tIHx8XG4gICAgICAgICAgICAgICAgICAgICAgIG9wLnNjcm9sbFRvUG9zLnRvLmxpbmUgPj0gZGlzcGxheS52aWV3VG8pIHx8XG4gICAgZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCAmJiBjbS5vcHRpb25zLmxpbmVXcmFwcGluZztcbiAgb3AudXBkYXRlID0gb3AubXVzdFVwZGF0ZSAmJlxuICAgIG5ldyBEaXNwbGF5VXBkYXRlKGNtLCBvcC5tdXN0VXBkYXRlICYmIHt0b3A6IG9wLnNjcm9sbFRvcCwgZW5zdXJlOiBvcC5zY3JvbGxUb1Bvc30sIG9wLmZvcmNlVXBkYXRlKTtcbn1cblxuZnVuY3Rpb24gZW5kT3BlcmF0aW9uX1cxKG9wKSB7XG4gIG9wLnVwZGF0ZWREaXNwbGF5ID0gb3AubXVzdFVwZGF0ZSAmJiB1cGRhdGVEaXNwbGF5SWZOZWVkZWQob3AuY20sIG9wLnVwZGF0ZSk7XG59XG5cbmZ1bmN0aW9uIGVuZE9wZXJhdGlvbl9SMihvcCkge1xuICB2YXIgY20gPSBvcC5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gIGlmIChvcC51cGRhdGVkRGlzcGxheSkgeyB1cGRhdGVIZWlnaHRzSW5WaWV3cG9ydChjbSk7IH1cblxuICBvcC5iYXJNZWFzdXJlID0gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pO1xuXG4gIC8vIElmIHRoZSBtYXggbGluZSBjaGFuZ2VkIHNpbmNlIGl0IHdhcyBsYXN0IG1lYXN1cmVkLCBtZWFzdXJlIGl0LFxuICAvLyBhbmQgZW5zdXJlIHRoZSBkb2N1bWVudCdzIHdpZHRoIG1hdGNoZXMgaXQuXG4gIC8vIHVwZGF0ZURpc3BsYXlfVzIgd2lsbCB1c2UgdGhlc2UgcHJvcGVydGllcyB0byBkbyB0aGUgYWN0dWFsIHJlc2l6aW5nXG4gIGlmIChkaXNwbGF5Lm1heExpbmVDaGFuZ2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgIG9wLmFkanVzdFdpZHRoVG8gPSBtZWFzdXJlQ2hhcihjbSwgZGlzcGxheS5tYXhMaW5lLCBkaXNwbGF5Lm1heExpbmUudGV4dC5sZW5ndGgpLmxlZnQgKyAzO1xuICAgIGNtLmRpc3BsYXkuc2l6ZXJXaWR0aCA9IG9wLmFkanVzdFdpZHRoVG87XG4gICAgb3AuYmFyTWVhc3VyZS5zY3JvbGxXaWR0aCA9XG4gICAgICBNYXRoLm1heChkaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoLCBkaXNwbGF5LnNpemVyLm9mZnNldExlZnQgKyBvcC5hZGp1c3RXaWR0aFRvICsgc2Nyb2xsR2FwKGNtKSArIGNtLmRpc3BsYXkuYmFyV2lkdGgpO1xuICAgIG9wLm1heFNjcm9sbExlZnQgPSBNYXRoLm1heCgwLCBkaXNwbGF5LnNpemVyLm9mZnNldExlZnQgKyBvcC5hZGp1c3RXaWR0aFRvIC0gZGlzcGxheVdpZHRoKGNtKSk7XG4gIH1cblxuICBpZiAob3AudXBkYXRlZERpc3BsYXkgfHwgb3Auc2VsZWN0aW9uQ2hhbmdlZClcbiAgICB7IG9wLnByZXBhcmVkU2VsZWN0aW9uID0gZGlzcGxheS5pbnB1dC5wcmVwYXJlU2VsZWN0aW9uKG9wLmZvY3VzKTsgfVxufVxuXG5mdW5jdGlvbiBlbmRPcGVyYXRpb25fVzIob3ApIHtcbiAgdmFyIGNtID0gb3AuY207XG5cbiAgaWYgKG9wLmFkanVzdFdpZHRoVG8gIT0gbnVsbCkge1xuICAgIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWluV2lkdGggPSBvcC5hZGp1c3RXaWR0aFRvICsgXCJweFwiO1xuICAgIGlmIChvcC5tYXhTY3JvbGxMZWZ0IDwgY20uZG9jLnNjcm9sbExlZnQpXG4gICAgICB7IHNldFNjcm9sbExlZnQoY20sIE1hdGgubWluKGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCwgb3AubWF4U2Nyb2xsTGVmdCksIHRydWUpOyB9XG4gICAgY20uZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCA9IGZhbHNlO1xuICB9XG5cbiAgdmFyIHRha2VGb2N1cyA9IG9wLmZvY3VzICYmIG9wLmZvY3VzID09IGFjdGl2ZUVsdCgpICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSk7XG4gIGlmIChvcC5wcmVwYXJlZFNlbGVjdGlvbilcbiAgICB7IGNtLmRpc3BsYXkuaW5wdXQuc2hvd1NlbGVjdGlvbihvcC5wcmVwYXJlZFNlbGVjdGlvbiwgdGFrZUZvY3VzKTsgfVxuICBpZiAob3AudXBkYXRlZERpc3BsYXkgfHwgb3Auc3RhcnRIZWlnaHQgIT0gY20uZG9jLmhlaWdodClcbiAgICB7IHVwZGF0ZVNjcm9sbGJhcnMoY20sIG9wLmJhck1lYXN1cmUpOyB9XG4gIGlmIChvcC51cGRhdGVkRGlzcGxheSlcbiAgICB7IHNldERvY3VtZW50SGVpZ2h0KGNtLCBvcC5iYXJNZWFzdXJlKTsgfVxuXG4gIGlmIChvcC5zZWxlY3Rpb25DaGFuZ2VkKSB7IHJlc3RhcnRCbGluayhjbSk7IH1cblxuICBpZiAoY20uc3RhdGUuZm9jdXNlZCAmJiBvcC51cGRhdGVJbnB1dClcbiAgICB7IGNtLmRpc3BsYXkuaW5wdXQucmVzZXQob3AudHlwaW5nKTsgfVxuICBpZiAodGFrZUZvY3VzKSB7IGVuc3VyZUZvY3VzKG9wLmNtKTsgfVxufVxuXG5mdW5jdGlvbiBlbmRPcGVyYXRpb25fZmluaXNoKG9wKSB7XG4gIHZhciBjbSA9IG9wLmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheSwgZG9jID0gY20uZG9jO1xuXG4gIGlmIChvcC51cGRhdGVkRGlzcGxheSkgeyBwb3N0VXBkYXRlRGlzcGxheShjbSwgb3AudXBkYXRlKTsgfVxuXG4gIC8vIEFib3J0IG1vdXNlIHdoZWVsIGRlbHRhIG1lYXN1cmVtZW50LCB3aGVuIHNjcm9sbGluZyBleHBsaWNpdGx5XG4gIGlmIChkaXNwbGF5LndoZWVsU3RhcnRYICE9IG51bGwgJiYgKG9wLnNjcm9sbFRvcCAhPSBudWxsIHx8IG9wLnNjcm9sbExlZnQgIT0gbnVsbCB8fCBvcC5zY3JvbGxUb1BvcykpXG4gICAgeyBkaXNwbGF5LndoZWVsU3RhcnRYID0gZGlzcGxheS53aGVlbFN0YXJ0WSA9IG51bGw7IH1cblxuICAvLyBQcm9wYWdhdGUgdGhlIHNjcm9sbCBwb3NpdGlvbiB0byB0aGUgYWN0dWFsIERPTSBzY3JvbGxlclxuICBpZiAob3Auc2Nyb2xsVG9wICE9IG51bGwpIHsgc2V0U2Nyb2xsVG9wKGNtLCBvcC5zY3JvbGxUb3AsIG9wLmZvcmNlU2Nyb2xsKTsgfVxuXG4gIGlmIChvcC5zY3JvbGxMZWZ0ICE9IG51bGwpIHsgc2V0U2Nyb2xsTGVmdChjbSwgb3Auc2Nyb2xsTGVmdCwgdHJ1ZSwgdHJ1ZSk7IH1cbiAgLy8gSWYgd2UgbmVlZCB0byBzY3JvbGwgYSBzcGVjaWZpYyBwb3NpdGlvbiBpbnRvIHZpZXcsIGRvIHNvLlxuICBpZiAob3Auc2Nyb2xsVG9Qb3MpIHtcbiAgICB2YXIgcmVjdCA9IHNjcm9sbFBvc0ludG9WaWV3KGNtLCBjbGlwUG9zKGRvYywgb3Auc2Nyb2xsVG9Qb3MuZnJvbSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwUG9zKGRvYywgb3Auc2Nyb2xsVG9Qb3MudG8pLCBvcC5zY3JvbGxUb1Bvcy5tYXJnaW4pO1xuICAgIG1heWJlU2Nyb2xsV2luZG93KGNtLCByZWN0KTtcbiAgfVxuXG4gIC8vIEZpcmUgZXZlbnRzIGZvciBtYXJrZXJzIHRoYXQgYXJlIGhpZGRlbi91bmlkZGVuIGJ5IGVkaXRpbmcgb3JcbiAgLy8gdW5kb2luZ1xuICB2YXIgaGlkZGVuID0gb3AubWF5YmVIaWRkZW5NYXJrZXJzLCB1bmhpZGRlbiA9IG9wLm1heWJlVW5oaWRkZW5NYXJrZXJzO1xuICBpZiAoaGlkZGVuKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuLmxlbmd0aDsgKytpKVxuICAgIHsgaWYgKCFoaWRkZW5baV0ubGluZXMubGVuZ3RoKSB7IHNpZ25hbChoaWRkZW5baV0sIFwiaGlkZVwiKTsgfSB9IH1cbiAgaWYgKHVuaGlkZGVuKSB7IGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IHVuaGlkZGVuLmxlbmd0aDsgKytpJDEpXG4gICAgeyBpZiAodW5oaWRkZW5baSQxXS5saW5lcy5sZW5ndGgpIHsgc2lnbmFsKHVuaGlkZGVuW2kkMV0sIFwidW5oaWRlXCIpOyB9IH0gfVxuXG4gIGlmIChkaXNwbGF5LndyYXBwZXIub2Zmc2V0SGVpZ2h0KVxuICAgIHsgZG9jLnNjcm9sbFRvcCA9IGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wOyB9XG5cbiAgLy8gRmlyZSBjaGFuZ2UgZXZlbnRzLCBhbmQgZGVsYXllZCBldmVudCBoYW5kbGVyc1xuICBpZiAob3AuY2hhbmdlT2JqcylcbiAgICB7IHNpZ25hbChjbSwgXCJjaGFuZ2VzXCIsIGNtLCBvcC5jaGFuZ2VPYmpzKTsgfVxuICBpZiAob3AudXBkYXRlKVxuICAgIHsgb3AudXBkYXRlLmZpbmlzaCgpOyB9XG59XG5cbi8vIFJ1biB0aGUgZ2l2ZW4gZnVuY3Rpb24gaW4gYW4gb3BlcmF0aW9uXG5mdW5jdGlvbiBydW5Jbk9wKGNtLCBmKSB7XG4gIGlmIChjbS5jdXJPcCkgeyByZXR1cm4gZigpIH1cbiAgc3RhcnRPcGVyYXRpb24oY20pO1xuICB0cnkgeyByZXR1cm4gZigpIH1cbiAgZmluYWxseSB7IGVuZE9wZXJhdGlvbihjbSk7IH1cbn1cbi8vIFdyYXBzIGEgZnVuY3Rpb24gaW4gYW4gb3BlcmF0aW9uLiBSZXR1cm5zIHRoZSB3cmFwcGVkIGZ1bmN0aW9uLlxuZnVuY3Rpb24gb3BlcmF0aW9uKGNtLCBmKSB7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICBpZiAoY20uY3VyT3ApIHsgcmV0dXJuIGYuYXBwbHkoY20sIGFyZ3VtZW50cykgfVxuICAgIHN0YXJ0T3BlcmF0aW9uKGNtKTtcbiAgICB0cnkgeyByZXR1cm4gZi5hcHBseShjbSwgYXJndW1lbnRzKSB9XG4gICAgZmluYWxseSB7IGVuZE9wZXJhdGlvbihjbSk7IH1cbiAgfVxufVxuLy8gVXNlZCB0byBhZGQgbWV0aG9kcyB0byBlZGl0b3IgYW5kIGRvYyBpbnN0YW5jZXMsIHdyYXBwaW5nIHRoZW0gaW5cbi8vIG9wZXJhdGlvbnMuXG5mdW5jdGlvbiBtZXRob2RPcChmKSB7XG4gIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5jdXJPcCkgeyByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH1cbiAgICBzdGFydE9wZXJhdGlvbih0aGlzKTtcbiAgICB0cnkgeyByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH1cbiAgICBmaW5hbGx5IHsgZW5kT3BlcmF0aW9uKHRoaXMpOyB9XG4gIH1cbn1cbmZ1bmN0aW9uIGRvY01ldGhvZE9wKGYpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgIHZhciBjbSA9IHRoaXMuY207XG4gICAgaWYgKCFjbSB8fCBjbS5jdXJPcCkgeyByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH1cbiAgICBzdGFydE9wZXJhdGlvbihjbSk7XG4gICAgdHJ5IHsgcmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9XG4gICAgZmluYWxseSB7IGVuZE9wZXJhdGlvbihjbSk7IH1cbiAgfVxufVxuXG4vLyBVcGRhdGVzIHRoZSBkaXNwbGF5LnZpZXcgZGF0YSBzdHJ1Y3R1cmUgZm9yIGEgZ2l2ZW4gY2hhbmdlIHRvIHRoZVxuLy8gZG9jdW1lbnQuIEZyb20gYW5kIHRvIGFyZSBpbiBwcmUtY2hhbmdlIGNvb3JkaW5hdGVzLiBMZW5kaWZmIGlzXG4vLyB0aGUgYW1vdW50IG9mIGxpbmVzIGFkZGVkIG9yIHN1YnRyYWN0ZWQgYnkgdGhlIGNoYW5nZS4gVGhpcyBpc1xuLy8gdXNlZCBmb3IgY2hhbmdlcyB0aGF0IHNwYW4gbXVsdGlwbGUgbGluZXMsIG9yIGNoYW5nZSB0aGUgd2F5XG4vLyBsaW5lcyBhcmUgZGl2aWRlZCBpbnRvIHZpc3VhbCBsaW5lcy4gcmVnTGluZUNoYW5nZSAoYmVsb3cpXG4vLyByZWdpc3RlcnMgc2luZ2xlLWxpbmUgY2hhbmdlcy5cbmZ1bmN0aW9uIHJlZ0NoYW5nZShjbSwgZnJvbSwgdG8sIGxlbmRpZmYpIHtcbiAgaWYgKGZyb20gPT0gbnVsbCkgeyBmcm9tID0gY20uZG9jLmZpcnN0OyB9XG4gIGlmICh0byA9PSBudWxsKSB7IHRvID0gY20uZG9jLmZpcnN0ICsgY20uZG9jLnNpemU7IH1cbiAgaWYgKCFsZW5kaWZmKSB7IGxlbmRpZmYgPSAwOyB9XG5cbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICBpZiAobGVuZGlmZiAmJiB0byA8IGRpc3BsYXkudmlld1RvICYmXG4gICAgICAoZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA9PSBudWxsIHx8IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPiBmcm9tKSlcbiAgICB7IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPSBmcm9tOyB9XG5cbiAgY20uY3VyT3Audmlld0NoYW5nZWQgPSB0cnVlO1xuXG4gIGlmIChmcm9tID49IGRpc3BsYXkudmlld1RvKSB7IC8vIENoYW5nZSBhZnRlclxuICAgIGlmIChzYXdDb2xsYXBzZWRTcGFucyAmJiB2aXN1YWxMaW5lTm8oY20uZG9jLCBmcm9tKSA8IGRpc3BsYXkudmlld1RvKVxuICAgICAgeyByZXNldFZpZXcoY20pOyB9XG4gIH0gZWxzZSBpZiAodG8gPD0gZGlzcGxheS52aWV3RnJvbSkgeyAvLyBDaGFuZ2UgYmVmb3JlXG4gICAgaWYgKHNhd0NvbGxhcHNlZFNwYW5zICYmIHZpc3VhbExpbmVFbmRObyhjbS5kb2MsIHRvICsgbGVuZGlmZikgPiBkaXNwbGF5LnZpZXdGcm9tKSB7XG4gICAgICByZXNldFZpZXcoY20pO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXNwbGF5LnZpZXdGcm9tICs9IGxlbmRpZmY7XG4gICAgICBkaXNwbGF5LnZpZXdUbyArPSBsZW5kaWZmO1xuICAgIH1cbiAgfSBlbHNlIGlmIChmcm9tIDw9IGRpc3BsYXkudmlld0Zyb20gJiYgdG8gPj0gZGlzcGxheS52aWV3VG8pIHsgLy8gRnVsbCBvdmVybGFwXG4gICAgcmVzZXRWaWV3KGNtKTtcbiAgfSBlbHNlIGlmIChmcm9tIDw9IGRpc3BsYXkudmlld0Zyb20pIHsgLy8gVG9wIG92ZXJsYXBcbiAgICB2YXIgY3V0ID0gdmlld0N1dHRpbmdQb2ludChjbSwgdG8sIHRvICsgbGVuZGlmZiwgMSk7XG4gICAgaWYgKGN1dCkge1xuICAgICAgZGlzcGxheS52aWV3ID0gZGlzcGxheS52aWV3LnNsaWNlKGN1dC5pbmRleCk7XG4gICAgICBkaXNwbGF5LnZpZXdGcm9tID0gY3V0LmxpbmVOO1xuICAgICAgZGlzcGxheS52aWV3VG8gKz0gbGVuZGlmZjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAodG8gPj0gZGlzcGxheS52aWV3VG8pIHsgLy8gQm90dG9tIG92ZXJsYXBcbiAgICB2YXIgY3V0JDEgPSB2aWV3Q3V0dGluZ1BvaW50KGNtLCBmcm9tLCBmcm9tLCAtMSk7XG4gICAgaWYgKGN1dCQxKSB7XG4gICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoMCwgY3V0JDEuaW5kZXgpO1xuICAgICAgZGlzcGxheS52aWV3VG8gPSBjdXQkMS5saW5lTjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICB9XG4gIH0gZWxzZSB7IC8vIEdhcCBpbiB0aGUgbWlkZGxlXG4gICAgdmFyIGN1dFRvcCA9IHZpZXdDdXR0aW5nUG9pbnQoY20sIGZyb20sIGZyb20sIC0xKTtcbiAgICB2YXIgY3V0Qm90ID0gdmlld0N1dHRpbmdQb2ludChjbSwgdG8sIHRvICsgbGVuZGlmZiwgMSk7XG4gICAgaWYgKGN1dFRvcCAmJiBjdXRCb3QpIHtcbiAgICAgIGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZSgwLCBjdXRUb3AuaW5kZXgpXG4gICAgICAgIC5jb25jYXQoYnVpbGRWaWV3QXJyYXkoY20sIGN1dFRvcC5saW5lTiwgY3V0Qm90LmxpbmVOKSlcbiAgICAgICAgLmNvbmNhdChkaXNwbGF5LnZpZXcuc2xpY2UoY3V0Qm90LmluZGV4KSk7XG4gICAgICBkaXNwbGF5LnZpZXdUbyArPSBsZW5kaWZmO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFZpZXcoY20pO1xuICAgIH1cbiAgfVxuXG4gIHZhciBleHQgPSBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQ7XG4gIGlmIChleHQpIHtcbiAgICBpZiAodG8gPCBleHQubGluZU4pXG4gICAgICB7IGV4dC5saW5lTiArPSBsZW5kaWZmOyB9XG4gICAgZWxzZSBpZiAoZnJvbSA8IGV4dC5saW5lTiArIGV4dC5zaXplKVxuICAgICAgeyBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBudWxsOyB9XG4gIH1cbn1cblxuLy8gUmVnaXN0ZXIgYSBjaGFuZ2UgdG8gYSBzaW5nbGUgbGluZS4gVHlwZSBtdXN0IGJlIG9uZSBvZiBcInRleHRcIixcbi8vIFwiZ3V0dGVyXCIsIFwiY2xhc3NcIiwgXCJ3aWRnZXRcIlxuZnVuY3Rpb24gcmVnTGluZUNoYW5nZShjbSwgbGluZSwgdHlwZSkge1xuICBjbS5jdXJPcC52aWV3Q2hhbmdlZCA9IHRydWU7XG4gIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgZXh0ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkO1xuICBpZiAoZXh0ICYmIGxpbmUgPj0gZXh0LmxpbmVOICYmIGxpbmUgPCBleHQubGluZU4gKyBleHQuc2l6ZSlcbiAgICB7IGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCA9IG51bGw7IH1cblxuICBpZiAobGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHwgbGluZSA+PSBkaXNwbGF5LnZpZXdUbykgeyByZXR1cm4gfVxuICB2YXIgbGluZVZpZXcgPSBkaXNwbGF5LnZpZXdbZmluZFZpZXdJbmRleChjbSwgbGluZSldO1xuICBpZiAobGluZVZpZXcubm9kZSA9PSBudWxsKSB7IHJldHVybiB9XG4gIHZhciBhcnIgPSBsaW5lVmlldy5jaGFuZ2VzIHx8IChsaW5lVmlldy5jaGFuZ2VzID0gW10pO1xuICBpZiAoaW5kZXhPZihhcnIsIHR5cGUpID09IC0xKSB7IGFyci5wdXNoKHR5cGUpOyB9XG59XG5cbi8vIENsZWFyIHRoZSB2aWV3LlxuZnVuY3Rpb24gcmVzZXRWaWV3KGNtKSB7XG4gIGNtLmRpc3BsYXkudmlld0Zyb20gPSBjbS5kaXNwbGF5LnZpZXdUbyA9IGNtLmRvYy5maXJzdDtcbiAgY20uZGlzcGxheS52aWV3ID0gW107XG4gIGNtLmRpc3BsYXkudmlld09mZnNldCA9IDA7XG59XG5cbmZ1bmN0aW9uIHZpZXdDdXR0aW5nUG9pbnQoY20sIG9sZE4sIG5ld04sIGRpcikge1xuICB2YXIgaW5kZXggPSBmaW5kVmlld0luZGV4KGNtLCBvbGROKSwgZGlmZiwgdmlldyA9IGNtLmRpc3BsYXkudmlldztcbiAgaWYgKCFzYXdDb2xsYXBzZWRTcGFucyB8fCBuZXdOID09IGNtLmRvYy5maXJzdCArIGNtLmRvYy5zaXplKVxuICAgIHsgcmV0dXJuIHtpbmRleDogaW5kZXgsIGxpbmVOOiBuZXdOfSB9XG4gIHZhciBuID0gY20uZGlzcGxheS52aWV3RnJvbTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbmRleDsgaSsrKVxuICAgIHsgbiArPSB2aWV3W2ldLnNpemU7IH1cbiAgaWYgKG4gIT0gb2xkTikge1xuICAgIGlmIChkaXIgPiAwKSB7XG4gICAgICBpZiAoaW5kZXggPT0gdmlldy5sZW5ndGggLSAxKSB7IHJldHVybiBudWxsIH1cbiAgICAgIGRpZmYgPSAobiArIHZpZXdbaW5kZXhdLnNpemUpIC0gb2xkTjtcbiAgICAgIGluZGV4Kys7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpZmYgPSBuIC0gb2xkTjtcbiAgICB9XG4gICAgb2xkTiArPSBkaWZmOyBuZXdOICs9IGRpZmY7XG4gIH1cbiAgd2hpbGUgKHZpc3VhbExpbmVObyhjbS5kb2MsIG5ld04pICE9IG5ld04pIHtcbiAgICBpZiAoaW5kZXggPT0gKGRpciA8IDAgPyAwIDogdmlldy5sZW5ndGggLSAxKSkgeyByZXR1cm4gbnVsbCB9XG4gICAgbmV3TiArPSBkaXIgKiB2aWV3W2luZGV4IC0gKGRpciA8IDAgPyAxIDogMCldLnNpemU7XG4gICAgaW5kZXggKz0gZGlyO1xuICB9XG4gIHJldHVybiB7aW5kZXg6IGluZGV4LCBsaW5lTjogbmV3Tn1cbn1cblxuLy8gRm9yY2UgdGhlIHZpZXcgdG8gY292ZXIgYSBnaXZlbiByYW5nZSwgYWRkaW5nIGVtcHR5IHZpZXcgZWxlbWVudFxuLy8gb3IgY2xpcHBpbmcgb2ZmIGV4aXN0aW5nIG9uZXMgYXMgbmVlZGVkLlxuZnVuY3Rpb24gYWRqdXN0VmlldyhjbSwgZnJvbSwgdG8pIHtcbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCB2aWV3ID0gZGlzcGxheS52aWV3O1xuICBpZiAodmlldy5sZW5ndGggPT0gMCB8fCBmcm9tID49IGRpc3BsYXkudmlld1RvIHx8IHRvIDw9IGRpc3BsYXkudmlld0Zyb20pIHtcbiAgICBkaXNwbGF5LnZpZXcgPSBidWlsZFZpZXdBcnJheShjbSwgZnJvbSwgdG8pO1xuICAgIGRpc3BsYXkudmlld0Zyb20gPSBmcm9tO1xuICB9IGVsc2Uge1xuICAgIGlmIChkaXNwbGF5LnZpZXdGcm9tID4gZnJvbSlcbiAgICAgIHsgZGlzcGxheS52aWV3ID0gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIGRpc3BsYXkudmlld0Zyb20pLmNvbmNhdChkaXNwbGF5LnZpZXcpOyB9XG4gICAgZWxzZSBpZiAoZGlzcGxheS52aWV3RnJvbSA8IGZyb20pXG4gICAgICB7IGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZShmaW5kVmlld0luZGV4KGNtLCBmcm9tKSk7IH1cbiAgICBkaXNwbGF5LnZpZXdGcm9tID0gZnJvbTtcbiAgICBpZiAoZGlzcGxheS52aWV3VG8gPCB0bylcbiAgICAgIHsgZGlzcGxheS52aWV3ID0gZGlzcGxheS52aWV3LmNvbmNhdChidWlsZFZpZXdBcnJheShjbSwgZGlzcGxheS52aWV3VG8sIHRvKSk7IH1cbiAgICBlbHNlIGlmIChkaXNwbGF5LnZpZXdUbyA+IHRvKVxuICAgICAgeyBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoMCwgZmluZFZpZXdJbmRleChjbSwgdG8pKTsgfVxuICB9XG4gIGRpc3BsYXkudmlld1RvID0gdG87XG59XG5cbi8vIENvdW50IHRoZSBudW1iZXIgb2YgbGluZXMgaW4gdGhlIHZpZXcgd2hvc2UgRE9NIHJlcHJlc2VudGF0aW9uIGlzXG4vLyBvdXQgb2YgZGF0ZSAob3Igbm9uZXhpc3RlbnQpLlxuZnVuY3Rpb24gY291bnREaXJ0eVZpZXcoY20pIHtcbiAgdmFyIHZpZXcgPSBjbS5kaXNwbGF5LnZpZXcsIGRpcnR5ID0gMDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGxpbmVWaWV3ID0gdmlld1tpXTtcbiAgICBpZiAoIWxpbmVWaWV3LmhpZGRlbiAmJiAoIWxpbmVWaWV3Lm5vZGUgfHwgbGluZVZpZXcuY2hhbmdlcykpIHsgKytkaXJ0eTsgfVxuICB9XG4gIHJldHVybiBkaXJ0eVxufVxuXG4vLyBISUdITElHSFQgV09SS0VSXG5cbmZ1bmN0aW9uIHN0YXJ0V29ya2VyKGNtLCB0aW1lKSB7XG4gIGlmIChjbS5kb2MubW9kZS5zdGFydFN0YXRlICYmIGNtLmRvYy5mcm9udGllciA8IGNtLmRpc3BsYXkudmlld1RvKVxuICAgIHsgY20uc3RhdGUuaGlnaGxpZ2h0LnNldCh0aW1lLCBiaW5kKGhpZ2hsaWdodFdvcmtlciwgY20pKTsgfVxufVxuXG5mdW5jdGlvbiBoaWdobGlnaHRXb3JrZXIoY20pIHtcbiAgdmFyIGRvYyA9IGNtLmRvYztcbiAgaWYgKGRvYy5mcm9udGllciA8IGRvYy5maXJzdCkgeyBkb2MuZnJvbnRpZXIgPSBkb2MuZmlyc3Q7IH1cbiAgaWYgKGRvYy5mcm9udGllciA+PSBjbS5kaXNwbGF5LnZpZXdUbykgeyByZXR1cm4gfVxuICB2YXIgZW5kID0gK25ldyBEYXRlICsgY20ub3B0aW9ucy53b3JrVGltZTtcbiAgdmFyIHN0YXRlID0gY29weVN0YXRlKGRvYy5tb2RlLCBnZXRTdGF0ZUJlZm9yZShjbSwgZG9jLmZyb250aWVyKSk7XG4gIHZhciBjaGFuZ2VkTGluZXMgPSBbXTtcblxuICBkb2MuaXRlcihkb2MuZnJvbnRpZXIsIE1hdGgubWluKGRvYy5maXJzdCArIGRvYy5zaXplLCBjbS5kaXNwbGF5LnZpZXdUbyArIDUwMCksIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgaWYgKGRvYy5mcm9udGllciA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tKSB7IC8vIFZpc2libGVcbiAgICAgIHZhciBvbGRTdHlsZXMgPSBsaW5lLnN0eWxlcywgdG9vTG9uZyA9IGxpbmUudGV4dC5sZW5ndGggPiBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aDtcbiAgICAgIHZhciBoaWdobGlnaHRlZCA9IGhpZ2hsaWdodExpbmUoY20sIGxpbmUsIHRvb0xvbmcgPyBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKSA6IHN0YXRlLCB0cnVlKTtcbiAgICAgIGxpbmUuc3R5bGVzID0gaGlnaGxpZ2h0ZWQuc3R5bGVzO1xuICAgICAgdmFyIG9sZENscyA9IGxpbmUuc3R5bGVDbGFzc2VzLCBuZXdDbHMgPSBoaWdobGlnaHRlZC5jbGFzc2VzO1xuICAgICAgaWYgKG5ld0NscykgeyBsaW5lLnN0eWxlQ2xhc3NlcyA9IG5ld0NsczsgfVxuICAgICAgZWxzZSBpZiAob2xkQ2xzKSB7IGxpbmUuc3R5bGVDbGFzc2VzID0gbnVsbDsgfVxuICAgICAgdmFyIGlzY2hhbmdlID0gIW9sZFN0eWxlcyB8fCBvbGRTdHlsZXMubGVuZ3RoICE9IGxpbmUuc3R5bGVzLmxlbmd0aCB8fFxuICAgICAgICBvbGRDbHMgIT0gbmV3Q2xzICYmICghb2xkQ2xzIHx8ICFuZXdDbHMgfHwgb2xkQ2xzLmJnQ2xhc3MgIT0gbmV3Q2xzLmJnQ2xhc3MgfHwgb2xkQ2xzLnRleHRDbGFzcyAhPSBuZXdDbHMudGV4dENsYXNzKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyAhaXNjaGFuZ2UgJiYgaSA8IG9sZFN0eWxlcy5sZW5ndGg7ICsraSkgeyBpc2NoYW5nZSA9IG9sZFN0eWxlc1tpXSAhPSBsaW5lLnN0eWxlc1tpXTsgfVxuICAgICAgaWYgKGlzY2hhbmdlKSB7IGNoYW5nZWRMaW5lcy5wdXNoKGRvYy5mcm9udGllcik7IH1cbiAgICAgIGxpbmUuc3RhdGVBZnRlciA9IHRvb0xvbmcgPyBzdGF0ZSA6IGNvcHlTdGF0ZShkb2MubW9kZSwgc3RhdGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAobGluZS50ZXh0Lmxlbmd0aCA8PSBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aClcbiAgICAgICAgeyBwcm9jZXNzTGluZShjbSwgbGluZS50ZXh0LCBzdGF0ZSk7IH1cbiAgICAgIGxpbmUuc3RhdGVBZnRlciA9IGRvYy5mcm9udGllciAlIDUgPT0gMCA/IGNvcHlTdGF0ZShkb2MubW9kZSwgc3RhdGUpIDogbnVsbDtcbiAgICB9XG4gICAgKytkb2MuZnJvbnRpZXI7XG4gICAgaWYgKCtuZXcgRGF0ZSA+IGVuZCkge1xuICAgICAgc3RhcnRXb3JrZXIoY20sIGNtLm9wdGlvbnMud29ya0RlbGF5KTtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICB9KTtcbiAgaWYgKGNoYW5nZWRMaW5lcy5sZW5ndGgpIHsgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlZExpbmVzLmxlbmd0aDsgaSsrKVxuICAgICAgeyByZWdMaW5lQ2hhbmdlKGNtLCBjaGFuZ2VkTGluZXNbaV0sIFwidGV4dFwiKTsgfVxuICB9KTsgfVxufVxuXG4vLyBESVNQTEFZIERSQVdJTkdcblxudmFyIERpc3BsYXlVcGRhdGUgPSBmdW5jdGlvbihjbSwgdmlld3BvcnQsIGZvcmNlKSB7XG4gIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheTtcblxuICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7XG4gIC8vIFN0b3JlIHNvbWUgdmFsdWVzIHRoYXQgd2UnbGwgbmVlZCBsYXRlciAoYnV0IGRvbid0IHdhbnQgdG8gZm9yY2UgYSByZWxheW91dCBmb3IpXG4gIHRoaXMudmlzaWJsZSA9IHZpc2libGVMaW5lcyhkaXNwbGF5LCBjbS5kb2MsIHZpZXdwb3J0KTtcbiAgdGhpcy5lZGl0b3JJc0hpZGRlbiA9ICFkaXNwbGF5LndyYXBwZXIub2Zmc2V0V2lkdGg7XG4gIHRoaXMud3JhcHBlckhlaWdodCA9IGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7XG4gIHRoaXMud3JhcHBlcldpZHRoID0gZGlzcGxheS53cmFwcGVyLmNsaWVudFdpZHRoO1xuICB0aGlzLm9sZERpc3BsYXlXaWR0aCA9IGRpc3BsYXlXaWR0aChjbSk7XG4gIHRoaXMuZm9yY2UgPSBmb3JjZTtcbiAgdGhpcy5kaW1zID0gZ2V0RGltZW5zaW9ucyhjbSk7XG4gIHRoaXMuZXZlbnRzID0gW107XG59O1xuXG5EaXNwbGF5VXBkYXRlLnByb3RvdHlwZS5zaWduYWwgPSBmdW5jdGlvbiAoZW1pdHRlciwgdHlwZSkge1xuICBpZiAoaGFzSGFuZGxlcihlbWl0dGVyLCB0eXBlKSlcbiAgICB7IHRoaXMuZXZlbnRzLnB1c2goYXJndW1lbnRzKTsgfVxufTtcbkRpc3BsYXlVcGRhdGUucHJvdG90eXBlLmZpbmlzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZXZlbnRzLmxlbmd0aDsgaSsrKVxuICAgIHsgc2lnbmFsLmFwcGx5KG51bGwsIHRoaXMkMS5ldmVudHNbaV0pOyB9XG59O1xuXG5mdW5jdGlvbiBtYXliZUNsaXBTY3JvbGxiYXJzKGNtKSB7XG4gIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgaWYgKCFkaXNwbGF5LnNjcm9sbGJhcnNDbGlwcGVkICYmIGRpc3BsYXkuc2Nyb2xsZXIub2Zmc2V0V2lkdGgpIHtcbiAgICBkaXNwbGF5Lm5hdGl2ZUJhcldpZHRoID0gZGlzcGxheS5zY3JvbGxlci5vZmZzZXRXaWR0aCAtIGRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50V2lkdGg7XG4gICAgZGlzcGxheS5oZWlnaHRGb3JjZXIuc3R5bGUuaGVpZ2h0ID0gc2Nyb2xsR2FwKGNtKSArIFwicHhcIjtcbiAgICBkaXNwbGF5LnNpemVyLnN0eWxlLm1hcmdpbkJvdHRvbSA9IC1kaXNwbGF5Lm5hdGl2ZUJhcldpZHRoICsgXCJweFwiO1xuICAgIGRpc3BsYXkuc2l6ZXIuc3R5bGUuYm9yZGVyUmlnaHRXaWR0aCA9IHNjcm9sbEdhcChjbSkgKyBcInB4XCI7XG4gICAgZGlzcGxheS5zY3JvbGxiYXJzQ2xpcHBlZCA9IHRydWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2VsZWN0aW9uU25hcHNob3QoY20pIHtcbiAgaWYgKGNtLmhhc0ZvY3VzKCkpIHsgcmV0dXJuIG51bGwgfVxuICB2YXIgYWN0aXZlID0gYWN0aXZlRWx0KCk7XG4gIGlmICghYWN0aXZlIHx8ICFjb250YWlucyhjbS5kaXNwbGF5LmxpbmVEaXYsIGFjdGl2ZSkpIHsgcmV0dXJuIG51bGwgfVxuICB2YXIgcmVzdWx0ID0ge2FjdGl2ZUVsdDogYWN0aXZlfTtcbiAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcbiAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgIGlmIChzZWwuYW5jaG9yTm9kZSAmJiBzZWwuZXh0ZW5kICYmIGNvbnRhaW5zKGNtLmRpc3BsYXkubGluZURpdiwgc2VsLmFuY2hvck5vZGUpKSB7XG4gICAgICByZXN1bHQuYW5jaG9yTm9kZSA9IHNlbC5hbmNob3JOb2RlO1xuICAgICAgcmVzdWx0LmFuY2hvck9mZnNldCA9IHNlbC5hbmNob3JPZmZzZXQ7XG4gICAgICByZXN1bHQuZm9jdXNOb2RlID0gc2VsLmZvY3VzTm9kZTtcbiAgICAgIHJlc3VsdC5mb2N1c09mZnNldCA9IHNlbC5mb2N1c09mZnNldDtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG5mdW5jdGlvbiByZXN0b3JlU2VsZWN0aW9uKHNuYXBzaG90KSB7XG4gIGlmICghc25hcHNob3QgfHwgIXNuYXBzaG90LmFjdGl2ZUVsdCB8fCBzbmFwc2hvdC5hY3RpdmVFbHQgPT0gYWN0aXZlRWx0KCkpIHsgcmV0dXJuIH1cbiAgc25hcHNob3QuYWN0aXZlRWx0LmZvY3VzKCk7XG4gIGlmIChzbmFwc2hvdC5hbmNob3JOb2RlICYmIGNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHNuYXBzaG90LmFuY2hvck5vZGUpICYmIGNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHNuYXBzaG90LmZvY3VzTm9kZSkpIHtcbiAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpLCByYW5nZSQkMSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgcmFuZ2UkJDEuc2V0RW5kKHNuYXBzaG90LmFuY2hvck5vZGUsIHNuYXBzaG90LmFuY2hvck9mZnNldCk7XG4gICAgcmFuZ2UkJDEuY29sbGFwc2UoZmFsc2UpO1xuICAgIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICBzZWwuYWRkUmFuZ2UocmFuZ2UkJDEpO1xuICAgIHNlbC5leHRlbmQoc25hcHNob3QuZm9jdXNOb2RlLCBzbmFwc2hvdC5mb2N1c09mZnNldCk7XG4gIH1cbn1cblxuLy8gRG9lcyB0aGUgYWN0dWFsIHVwZGF0aW5nIG9mIHRoZSBsaW5lIGRpc3BsYXkuIEJhaWxzIG91dFxuLy8gKHJldHVybmluZyBmYWxzZSkgd2hlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGJlIGRvbmUgYW5kIGZvcmNlZCBpc1xuLy8gZmFsc2UuXG5mdW5jdGlvbiB1cGRhdGVEaXNwbGF5SWZOZWVkZWQoY20sIHVwZGF0ZSkge1xuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcblxuICBpZiAodXBkYXRlLmVkaXRvcklzSGlkZGVuKSB7XG4gICAgcmVzZXRWaWV3KGNtKTtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIC8vIEJhaWwgb3V0IGlmIHRoZSB2aXNpYmxlIGFyZWEgaXMgYWxyZWFkeSByZW5kZXJlZCBhbmQgbm90aGluZyBjaGFuZ2VkLlxuICBpZiAoIXVwZGF0ZS5mb3JjZSAmJlxuICAgICAgdXBkYXRlLnZpc2libGUuZnJvbSA+PSBkaXNwbGF5LnZpZXdGcm9tICYmIHVwZGF0ZS52aXNpYmxlLnRvIDw9IGRpc3BsYXkudmlld1RvICYmXG4gICAgICAoZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA9PSBudWxsIHx8IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPj0gZGlzcGxheS52aWV3VG8pICYmXG4gICAgICBkaXNwbGF5LnJlbmRlcmVkVmlldyA9PSBkaXNwbGF5LnZpZXcgJiYgY291bnREaXJ0eVZpZXcoY20pID09IDApXG4gICAgeyByZXR1cm4gZmFsc2UgfVxuXG4gIGlmIChtYXliZVVwZGF0ZUxpbmVOdW1iZXJXaWR0aChjbSkpIHtcbiAgICByZXNldFZpZXcoY20pO1xuICAgIHVwZGF0ZS5kaW1zID0gZ2V0RGltZW5zaW9ucyhjbSk7XG4gIH1cblxuICAvLyBDb21wdXRlIGEgc3VpdGFibGUgbmV3IHZpZXdwb3J0IChmcm9tICYgdG8pXG4gIHZhciBlbmQgPSBkb2MuZmlyc3QgKyBkb2Muc2l6ZTtcbiAgdmFyIGZyb20gPSBNYXRoLm1heCh1cGRhdGUudmlzaWJsZS5mcm9tIC0gY20ub3B0aW9ucy52aWV3cG9ydE1hcmdpbiwgZG9jLmZpcnN0KTtcbiAgdmFyIHRvID0gTWF0aC5taW4oZW5kLCB1cGRhdGUudmlzaWJsZS50byArIGNtLm9wdGlvbnMudmlld3BvcnRNYXJnaW4pO1xuICBpZiAoZGlzcGxheS52aWV3RnJvbSA8IGZyb20gJiYgZnJvbSAtIGRpc3BsYXkudmlld0Zyb20gPCAyMCkgeyBmcm9tID0gTWF0aC5tYXgoZG9jLmZpcnN0LCBkaXNwbGF5LnZpZXdGcm9tKTsgfVxuICBpZiAoZGlzcGxheS52aWV3VG8gPiB0byAmJiBkaXNwbGF5LnZpZXdUbyAtIHRvIDwgMjApIHsgdG8gPSBNYXRoLm1pbihlbmQsIGRpc3BsYXkudmlld1RvKTsgfVxuICBpZiAoc2F3Q29sbGFwc2VkU3BhbnMpIHtcbiAgICBmcm9tID0gdmlzdWFsTGluZU5vKGNtLmRvYywgZnJvbSk7XG4gICAgdG8gPSB2aXN1YWxMaW5lRW5kTm8oY20uZG9jLCB0byk7XG4gIH1cblxuICB2YXIgZGlmZmVyZW50ID0gZnJvbSAhPSBkaXNwbGF5LnZpZXdGcm9tIHx8IHRvICE9IGRpc3BsYXkudmlld1RvIHx8XG4gICAgZGlzcGxheS5sYXN0V3JhcEhlaWdodCAhPSB1cGRhdGUud3JhcHBlckhlaWdodCB8fCBkaXNwbGF5Lmxhc3RXcmFwV2lkdGggIT0gdXBkYXRlLndyYXBwZXJXaWR0aDtcbiAgYWRqdXN0VmlldyhjbSwgZnJvbSwgdG8pO1xuXG4gIGRpc3BsYXkudmlld09mZnNldCA9IGhlaWdodEF0TGluZShnZXRMaW5lKGNtLmRvYywgZGlzcGxheS52aWV3RnJvbSkpO1xuICAvLyBQb3NpdGlvbiB0aGUgbW92ZXIgZGl2IHRvIGFsaWduIHdpdGggdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uXG4gIGNtLmRpc3BsYXkubW92ZXIuc3R5bGUudG9wID0gZGlzcGxheS52aWV3T2Zmc2V0ICsgXCJweFwiO1xuXG4gIHZhciB0b1VwZGF0ZSA9IGNvdW50RGlydHlWaWV3KGNtKTtcbiAgaWYgKCFkaWZmZXJlbnQgJiYgdG9VcGRhdGUgPT0gMCAmJiAhdXBkYXRlLmZvcmNlICYmIGRpc3BsYXkucmVuZGVyZWRWaWV3ID09IGRpc3BsYXkudmlldyAmJlxuICAgICAgKGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPT0gbnVsbCB8fCBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID49IGRpc3BsYXkudmlld1RvKSlcbiAgICB7IHJldHVybiBmYWxzZSB9XG5cbiAgLy8gRm9yIGJpZyBjaGFuZ2VzLCB3ZSBoaWRlIHRoZSBlbmNsb3NpbmcgZWxlbWVudCBkdXJpbmcgdGhlXG4gIC8vIHVwZGF0ZSwgc2luY2UgdGhhdCBzcGVlZHMgdXAgdGhlIG9wZXJhdGlvbnMgb24gbW9zdCBicm93c2Vycy5cbiAgdmFyIHNlbFNuYXBzaG90ID0gc2VsZWN0aW9uU25hcHNob3QoY20pO1xuICBpZiAodG9VcGRhdGUgPiA0KSB7IGRpc3BsYXkubGluZURpdi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7IH1cbiAgcGF0Y2hEaXNwbGF5KGNtLCBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzLCB1cGRhdGUuZGltcyk7XG4gIGlmICh0b1VwZGF0ZSA+IDQpIHsgZGlzcGxheS5saW5lRGl2LnN0eWxlLmRpc3BsYXkgPSBcIlwiOyB9XG4gIGRpc3BsYXkucmVuZGVyZWRWaWV3ID0gZGlzcGxheS52aWV3O1xuICAvLyBUaGVyZSBtaWdodCBoYXZlIGJlZW4gYSB3aWRnZXQgd2l0aCBhIGZvY3VzZWQgZWxlbWVudCB0aGF0IGdvdFxuICAvLyBoaWRkZW4gb3IgdXBkYXRlZCwgaWYgc28gcmUtZm9jdXMgaXQuXG4gIHJlc3RvcmVTZWxlY3Rpb24oc2VsU25hcHNob3QpO1xuXG4gIC8vIFByZXZlbnQgc2VsZWN0aW9uIGFuZCBjdXJzb3JzIGZyb20gaW50ZXJmZXJpbmcgd2l0aCB0aGUgc2Nyb2xsXG4gIC8vIHdpZHRoIGFuZCBoZWlnaHQuXG4gIHJlbW92ZUNoaWxkcmVuKGRpc3BsYXkuY3Vyc29yRGl2KTtcbiAgcmVtb3ZlQ2hpbGRyZW4oZGlzcGxheS5zZWxlY3Rpb25EaXYpO1xuICBkaXNwbGF5Lmd1dHRlcnMuc3R5bGUuaGVpZ2h0ID0gZGlzcGxheS5zaXplci5zdHlsZS5taW5IZWlnaHQgPSAwO1xuXG4gIGlmIChkaWZmZXJlbnQpIHtcbiAgICBkaXNwbGF5Lmxhc3RXcmFwSGVpZ2h0ID0gdXBkYXRlLndyYXBwZXJIZWlnaHQ7XG4gICAgZGlzcGxheS5sYXN0V3JhcFdpZHRoID0gdXBkYXRlLndyYXBwZXJXaWR0aDtcbiAgICBzdGFydFdvcmtlcihjbSwgNDAwKTtcbiAgfVxuXG4gIGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPSBudWxsO1xuXG4gIHJldHVybiB0cnVlXG59XG5cbmZ1bmN0aW9uIHBvc3RVcGRhdGVEaXNwbGF5KGNtLCB1cGRhdGUpIHtcbiAgdmFyIHZpZXdwb3J0ID0gdXBkYXRlLnZpZXdwb3J0O1xuXG4gIGZvciAodmFyIGZpcnN0ID0gdHJ1ZTs7IGZpcnN0ID0gZmFsc2UpIHtcbiAgICBpZiAoIWZpcnN0IHx8ICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZyB8fCB1cGRhdGUub2xkRGlzcGxheVdpZHRoID09IGRpc3BsYXlXaWR0aChjbSkpIHtcbiAgICAgIC8vIENsaXAgZm9yY2VkIHZpZXdwb3J0IHRvIGFjdHVhbCBzY3JvbGxhYmxlIGFyZWEuXG4gICAgICBpZiAodmlld3BvcnQgJiYgdmlld3BvcnQudG9wICE9IG51bGwpXG4gICAgICAgIHsgdmlld3BvcnQgPSB7dG9wOiBNYXRoLm1pbihjbS5kb2MuaGVpZ2h0ICsgcGFkZGluZ1ZlcnQoY20uZGlzcGxheSkgLSBkaXNwbGF5SGVpZ2h0KGNtKSwgdmlld3BvcnQudG9wKX07IH1cbiAgICAgIC8vIFVwZGF0ZWQgbGluZSBoZWlnaHRzIG1pZ2h0IHJlc3VsdCBpbiB0aGUgZHJhd24gYXJlYSBub3RcbiAgICAgIC8vIGFjdHVhbGx5IGNvdmVyaW5nIHRoZSB2aWV3cG9ydC4gS2VlcCBsb29waW5nIHVudGlsIGl0IGRvZXMuXG4gICAgICB1cGRhdGUudmlzaWJsZSA9IHZpc2libGVMaW5lcyhjbS5kaXNwbGF5LCBjbS5kb2MsIHZpZXdwb3J0KTtcbiAgICAgIGlmICh1cGRhdGUudmlzaWJsZS5mcm9tID49IGNtLmRpc3BsYXkudmlld0Zyb20gJiYgdXBkYXRlLnZpc2libGUudG8gPD0gY20uZGlzcGxheS52aWV3VG8pXG4gICAgICAgIHsgYnJlYWsgfVxuICAgIH1cbiAgICBpZiAoIXVwZGF0ZURpc3BsYXlJZk5lZWRlZChjbSwgdXBkYXRlKSkgeyBicmVhayB9XG4gICAgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pO1xuICAgIHZhciBiYXJNZWFzdXJlID0gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pO1xuICAgIHVwZGF0ZVNlbGVjdGlvbihjbSk7XG4gICAgdXBkYXRlU2Nyb2xsYmFycyhjbSwgYmFyTWVhc3VyZSk7XG4gICAgc2V0RG9jdW1lbnRIZWlnaHQoY20sIGJhck1lYXN1cmUpO1xuICB9XG5cbiAgdXBkYXRlLnNpZ25hbChjbSwgXCJ1cGRhdGVcIiwgY20pO1xuICBpZiAoY20uZGlzcGxheS52aWV3RnJvbSAhPSBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld0Zyb20gfHwgY20uZGlzcGxheS52aWV3VG8gIT0gY20uZGlzcGxheS5yZXBvcnRlZFZpZXdUbykge1xuICAgIHVwZGF0ZS5zaWduYWwoY20sIFwidmlld3BvcnRDaGFuZ2VcIiwgY20sIGNtLmRpc3BsYXkudmlld0Zyb20sIGNtLmRpc3BsYXkudmlld1RvKTtcbiAgICBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld0Zyb20gPSBjbS5kaXNwbGF5LnZpZXdGcm9tOyBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld1RvID0gY20uZGlzcGxheS52aWV3VG87XG4gIH1cbn1cblxuZnVuY3Rpb24gdXBkYXRlRGlzcGxheVNpbXBsZShjbSwgdmlld3BvcnQpIHtcbiAgdmFyIHVwZGF0ZSA9IG5ldyBEaXNwbGF5VXBkYXRlKGNtLCB2aWV3cG9ydCk7XG4gIGlmICh1cGRhdGVEaXNwbGF5SWZOZWVkZWQoY20sIHVwZGF0ZSkpIHtcbiAgICB1cGRhdGVIZWlnaHRzSW5WaWV3cG9ydChjbSk7XG4gICAgcG9zdFVwZGF0ZURpc3BsYXkoY20sIHVwZGF0ZSk7XG4gICAgdmFyIGJhck1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7XG4gICAgdXBkYXRlU2VsZWN0aW9uKGNtKTtcbiAgICB1cGRhdGVTY3JvbGxiYXJzKGNtLCBiYXJNZWFzdXJlKTtcbiAgICBzZXREb2N1bWVudEhlaWdodChjbSwgYmFyTWVhc3VyZSk7XG4gICAgdXBkYXRlLmZpbmlzaCgpO1xuICB9XG59XG5cbi8vIFN5bmMgdGhlIGFjdHVhbCBkaXNwbGF5IERPTSBzdHJ1Y3R1cmUgd2l0aCBkaXNwbGF5LnZpZXcsIHJlbW92aW5nXG4vLyBub2RlcyBmb3IgbGluZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHZpZXcsIGFuZCBjcmVhdGluZyB0aGUgb25lc1xuLy8gdGhhdCBhcmUgbm90IHRoZXJlIHlldCwgYW5kIHVwZGF0aW5nIHRoZSBvbmVzIHRoYXQgYXJlIG91dCBvZlxuLy8gZGF0ZS5cbmZ1bmN0aW9uIHBhdGNoRGlzcGxheShjbSwgdXBkYXRlTnVtYmVyc0Zyb20sIGRpbXMpIHtcbiAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBsaW5lTnVtYmVycyA9IGNtLm9wdGlvbnMubGluZU51bWJlcnM7XG4gIHZhciBjb250YWluZXIgPSBkaXNwbGF5LmxpbmVEaXYsIGN1ciA9IGNvbnRhaW5lci5maXJzdENoaWxkO1xuXG4gIGZ1bmN0aW9uIHJtKG5vZGUpIHtcbiAgICB2YXIgbmV4dCA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgLy8gV29ya3MgYXJvdW5kIGEgdGhyb3ctc2Nyb2xsIGJ1ZyBpbiBPUyBYIFdlYmtpdFxuICAgIGlmICh3ZWJraXQgJiYgbWFjICYmIGNtLmRpc3BsYXkuY3VycmVudFdoZWVsVGFyZ2V0ID09IG5vZGUpXG4gICAgICB7IG5vZGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiOyB9XG4gICAgZWxzZVxuICAgICAgeyBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7IH1cbiAgICByZXR1cm4gbmV4dFxuICB9XG5cbiAgdmFyIHZpZXcgPSBkaXNwbGF5LnZpZXcsIGxpbmVOID0gZGlzcGxheS52aWV3RnJvbTtcbiAgLy8gTG9vcCBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGUgdmlldywgc3luY2luZyBjdXIgKHRoZSBET00gbm9kZXNcbiAgLy8gaW4gZGlzcGxheS5saW5lRGl2KSB3aXRoIHRoZSB2aWV3IGFzIHdlIGdvLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgbGluZVZpZXcgPSB2aWV3W2ldO1xuICAgIGlmIChsaW5lVmlldy5oaWRkZW4pIHtcbiAgICB9IGVsc2UgaWYgKCFsaW5lVmlldy5ub2RlIHx8IGxpbmVWaWV3Lm5vZGUucGFyZW50Tm9kZSAhPSBjb250YWluZXIpIHsgLy8gTm90IGRyYXduIHlldFxuICAgICAgdmFyIG5vZGUgPSBidWlsZExpbmVFbGVtZW50KGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpO1xuICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShub2RlLCBjdXIpO1xuICAgIH0gZWxzZSB7IC8vIEFscmVhZHkgZHJhd25cbiAgICAgIHdoaWxlIChjdXIgIT0gbGluZVZpZXcubm9kZSkgeyBjdXIgPSBybShjdXIpOyB9XG4gICAgICB2YXIgdXBkYXRlTnVtYmVyID0gbGluZU51bWJlcnMgJiYgdXBkYXRlTnVtYmVyc0Zyb20gIT0gbnVsbCAmJlxuICAgICAgICB1cGRhdGVOdW1iZXJzRnJvbSA8PSBsaW5lTiAmJiBsaW5lVmlldy5saW5lTnVtYmVyO1xuICAgICAgaWYgKGxpbmVWaWV3LmNoYW5nZXMpIHtcbiAgICAgICAgaWYgKGluZGV4T2YobGluZVZpZXcuY2hhbmdlcywgXCJndXR0ZXJcIikgPiAtMSkgeyB1cGRhdGVOdW1iZXIgPSBmYWxzZTsgfVxuICAgICAgICB1cGRhdGVMaW5lRm9yQ2hhbmdlcyhjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKTtcbiAgICAgIH1cbiAgICAgIGlmICh1cGRhdGVOdW1iZXIpIHtcbiAgICAgICAgcmVtb3ZlQ2hpbGRyZW4obGluZVZpZXcubGluZU51bWJlcik7XG4gICAgICAgIGxpbmVWaWV3LmxpbmVOdW1iZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGluZU51bWJlckZvcihjbS5vcHRpb25zLCBsaW5lTikpKTtcbiAgICAgIH1cbiAgICAgIGN1ciA9IGxpbmVWaWV3Lm5vZGUubmV4dFNpYmxpbmc7XG4gICAgfVxuICAgIGxpbmVOICs9IGxpbmVWaWV3LnNpemU7XG4gIH1cbiAgd2hpbGUgKGN1cikgeyBjdXIgPSBybShjdXIpOyB9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUd1dHRlclNwYWNlKGNtKSB7XG4gIHZhciB3aWR0aCA9IGNtLmRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aDtcbiAgY20uZGlzcGxheS5zaXplci5zdHlsZS5tYXJnaW5MZWZ0ID0gd2lkdGggKyBcInB4XCI7XG59XG5cbmZ1bmN0aW9uIHNldERvY3VtZW50SGVpZ2h0KGNtLCBtZWFzdXJlKSB7XG4gIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWluSGVpZ2h0ID0gbWVhc3VyZS5kb2NIZWlnaHQgKyBcInB4XCI7XG4gIGNtLmRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLnRvcCA9IG1lYXN1cmUuZG9jSGVpZ2h0ICsgXCJweFwiO1xuICBjbS5kaXNwbGF5Lmd1dHRlcnMuc3R5bGUuaGVpZ2h0ID0gKG1lYXN1cmUuZG9jSGVpZ2h0ICsgY20uZGlzcGxheS5iYXJIZWlnaHQgKyBzY3JvbGxHYXAoY20pKSArIFwicHhcIjtcbn1cblxuLy8gUmVidWlsZCB0aGUgZ3V0dGVyIGVsZW1lbnRzLCBlbnN1cmUgdGhlIG1hcmdpbiB0byB0aGUgbGVmdCBvZiB0aGVcbi8vIGNvZGUgbWF0Y2hlcyB0aGVpciB3aWR0aC5cbmZ1bmN0aW9uIHVwZGF0ZUd1dHRlcnMoY20pIHtcbiAgdmFyIGd1dHRlcnMgPSBjbS5kaXNwbGF5Lmd1dHRlcnMsIHNwZWNzID0gY20ub3B0aW9ucy5ndXR0ZXJzO1xuICByZW1vdmVDaGlsZHJlbihndXR0ZXJzKTtcbiAgdmFyIGkgPSAwO1xuICBmb3IgKDsgaSA8IHNwZWNzLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGd1dHRlckNsYXNzID0gc3BlY3NbaV07XG4gICAgdmFyIGdFbHQgPSBndXR0ZXJzLmFwcGVuZENoaWxkKGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyIFwiICsgZ3V0dGVyQ2xhc3MpKTtcbiAgICBpZiAoZ3V0dGVyQ2xhc3MgPT0gXCJDb2RlTWlycm9yLWxpbmVudW1iZXJzXCIpIHtcbiAgICAgIGNtLmRpc3BsYXkubGluZUd1dHRlciA9IGdFbHQ7XG4gICAgICBnRWx0LnN0eWxlLndpZHRoID0gKGNtLmRpc3BsYXkubGluZU51bVdpZHRoIHx8IDEpICsgXCJweFwiO1xuICAgIH1cbiAgfVxuICBndXR0ZXJzLnN0eWxlLmRpc3BsYXkgPSBpID8gXCJcIiA6IFwibm9uZVwiO1xuICB1cGRhdGVHdXR0ZXJTcGFjZShjbSk7XG59XG5cbi8vIE1ha2Ugc3VyZSB0aGUgZ3V0dGVycyBvcHRpb25zIGNvbnRhaW5zIHRoZSBlbGVtZW50XG4vLyBcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIiB3aGVuIHRoZSBsaW5lTnVtYmVycyBvcHRpb24gaXMgdHJ1ZS5cbmZ1bmN0aW9uIHNldEd1dHRlcnNGb3JMaW5lTnVtYmVycyhvcHRpb25zKSB7XG4gIHZhciBmb3VuZCA9IGluZGV4T2Yob3B0aW9ucy5ndXR0ZXJzLCBcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIik7XG4gIGlmIChmb3VuZCA9PSAtMSAmJiBvcHRpb25zLmxpbmVOdW1iZXJzKSB7XG4gICAgb3B0aW9ucy5ndXR0ZXJzID0gb3B0aW9ucy5ndXR0ZXJzLmNvbmNhdChbXCJDb2RlTWlycm9yLWxpbmVudW1iZXJzXCJdKTtcbiAgfSBlbHNlIGlmIChmb3VuZCA+IC0xICYmICFvcHRpb25zLmxpbmVOdW1iZXJzKSB7XG4gICAgb3B0aW9ucy5ndXR0ZXJzID0gb3B0aW9ucy5ndXR0ZXJzLnNsaWNlKDApO1xuICAgIG9wdGlvbnMuZ3V0dGVycy5zcGxpY2UoZm91bmQsIDEpO1xuICB9XG59XG5cbi8vIFNpbmNlIHRoZSBkZWx0YSB2YWx1ZXMgcmVwb3J0ZWQgb24gbW91c2Ugd2hlZWwgZXZlbnRzIGFyZVxuLy8gdW5zdGFuZGFyZGl6ZWQgYmV0d2VlbiBicm93c2VycyBhbmQgZXZlbiBicm93c2VyIHZlcnNpb25zLCBhbmRcbi8vIGdlbmVyYWxseSBob3JyaWJseSB1bnByZWRpY3RhYmxlLCB0aGlzIGNvZGUgc3RhcnRzIGJ5IG1lYXN1cmluZ1xuLy8gdGhlIHNjcm9sbCBlZmZlY3QgdGhhdCB0aGUgZmlyc3QgZmV3IG1vdXNlIHdoZWVsIGV2ZW50cyBoYXZlLFxuLy8gYW5kLCBmcm9tIHRoYXQsIGRldGVjdHMgdGhlIHdheSBpdCBjYW4gY29udmVydCBkZWx0YXMgdG8gcGl4ZWxcbi8vIG9mZnNldHMgYWZ0ZXJ3YXJkcy5cbi8vXG4vLyBUaGUgcmVhc29uIHdlIHdhbnQgdG8ga25vdyB0aGUgYW1vdW50IGEgd2hlZWwgZXZlbnQgd2lsbCBzY3JvbGxcbi8vIGlzIHRoYXQgaXQgZ2l2ZXMgdXMgYSBjaGFuY2UgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IGJlZm9yZSB0aGVcbi8vIGFjdHVhbCBzY3JvbGxpbmcgaGFwcGVucywgcmVkdWNpbmcgZmxpY2tlcmluZy5cblxudmFyIHdoZWVsU2FtcGxlcyA9IDA7XG52YXIgd2hlZWxQaXhlbHNQZXJVbml0ID0gbnVsbDtcbi8vIEZpbGwgaW4gYSBicm93c2VyLWRldGVjdGVkIHN0YXJ0aW5nIHZhbHVlIG9uIGJyb3dzZXJzIHdoZXJlIHdlXG4vLyBrbm93IG9uZS4gVGhlc2UgZG9uJ3QgaGF2ZSB0byBiZSBhY2N1cmF0ZSAtLSB0aGUgcmVzdWx0IG9mIHRoZW1cbi8vIGJlaW5nIHdyb25nIHdvdWxkIGp1c3QgYmUgYSBzbGlnaHQgZmxpY2tlciBvbiB0aGUgZmlyc3Qgd2hlZWxcbi8vIHNjcm9sbCAoaWYgaXQgaXMgbGFyZ2UgZW5vdWdoKS5cbmlmIChpZSkgeyB3aGVlbFBpeGVsc1BlclVuaXQgPSAtLjUzOyB9XG5lbHNlIGlmIChnZWNrbykgeyB3aGVlbFBpeGVsc1BlclVuaXQgPSAxNTsgfVxuZWxzZSBpZiAoY2hyb21lKSB7IHdoZWVsUGl4ZWxzUGVyVW5pdCA9IC0uNzsgfVxuZWxzZSBpZiAoc2FmYXJpKSB7IHdoZWVsUGl4ZWxzUGVyVW5pdCA9IC0xLzM7IH1cblxuZnVuY3Rpb24gd2hlZWxFdmVudERlbHRhKGUpIHtcbiAgdmFyIGR4ID0gZS53aGVlbERlbHRhWCwgZHkgPSBlLndoZWVsRGVsdGFZO1xuICBpZiAoZHggPT0gbnVsbCAmJiBlLmRldGFpbCAmJiBlLmF4aXMgPT0gZS5IT1JJWk9OVEFMX0FYSVMpIHsgZHggPSBlLmRldGFpbDsgfVxuICBpZiAoZHkgPT0gbnVsbCAmJiBlLmRldGFpbCAmJiBlLmF4aXMgPT0gZS5WRVJUSUNBTF9BWElTKSB7IGR5ID0gZS5kZXRhaWw7IH1cbiAgZWxzZSBpZiAoZHkgPT0gbnVsbCkgeyBkeSA9IGUud2hlZWxEZWx0YTsgfVxuICByZXR1cm4ge3g6IGR4LCB5OiBkeX1cbn1cbmZ1bmN0aW9uIHdoZWVsRXZlbnRQaXhlbHMoZSkge1xuICB2YXIgZGVsdGEgPSB3aGVlbEV2ZW50RGVsdGEoZSk7XG4gIGRlbHRhLnggKj0gd2hlZWxQaXhlbHNQZXJVbml0O1xuICBkZWx0YS55ICo9IHdoZWVsUGl4ZWxzUGVyVW5pdDtcbiAgcmV0dXJuIGRlbHRhXG59XG5cbmZ1bmN0aW9uIG9uU2Nyb2xsV2hlZWwoY20sIGUpIHtcbiAgdmFyIGRlbHRhID0gd2hlZWxFdmVudERlbHRhKGUpLCBkeCA9IGRlbHRhLngsIGR5ID0gZGVsdGEueTtcblxuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNjcm9sbCA9IGRpc3BsYXkuc2Nyb2xsZXI7XG4gIC8vIFF1aXQgaWYgdGhlcmUncyBub3RoaW5nIHRvIHNjcm9sbCBoZXJlXG4gIHZhciBjYW5TY3JvbGxYID0gc2Nyb2xsLnNjcm9sbFdpZHRoID4gc2Nyb2xsLmNsaWVudFdpZHRoO1xuICB2YXIgY2FuU2Nyb2xsWSA9IHNjcm9sbC5zY3JvbGxIZWlnaHQgPiBzY3JvbGwuY2xpZW50SGVpZ2h0O1xuICBpZiAoIShkeCAmJiBjYW5TY3JvbGxYIHx8IGR5ICYmIGNhblNjcm9sbFkpKSB7IHJldHVybiB9XG5cbiAgLy8gV2Via2l0IGJyb3dzZXJzIG9uIE9TIFggYWJvcnQgbW9tZW50dW0gc2Nyb2xscyB3aGVuIHRoZSB0YXJnZXRcbiAgLy8gb2YgdGhlIHNjcm9sbCBldmVudCBpcyByZW1vdmVkIGZyb20gdGhlIHNjcm9sbGFibGUgZWxlbWVudC5cbiAgLy8gVGhpcyBoYWNrIChzZWUgcmVsYXRlZCBjb2RlIGluIHBhdGNoRGlzcGxheSkgbWFrZXMgc3VyZSB0aGVcbiAgLy8gZWxlbWVudCBpcyBrZXB0IGFyb3VuZC5cbiAgaWYgKGR5ICYmIG1hYyAmJiB3ZWJraXQpIHtcbiAgICBvdXRlcjogZm9yICh2YXIgY3VyID0gZS50YXJnZXQsIHZpZXcgPSBkaXNwbGF5LnZpZXc7IGN1ciAhPSBzY3JvbGw7IGN1ciA9IGN1ci5wYXJlbnROb2RlKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHZpZXdbaV0ubm9kZSA9PSBjdXIpIHtcbiAgICAgICAgICBjbS5kaXNwbGF5LmN1cnJlbnRXaGVlbFRhcmdldCA9IGN1cjtcbiAgICAgICAgICBicmVhayBvdXRlclxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gT24gc29tZSBicm93c2VycywgaG9yaXpvbnRhbCBzY3JvbGxpbmcgd2lsbCBjYXVzZSByZWRyYXdzIHRvXG4gIC8vIGhhcHBlbiBiZWZvcmUgdGhlIGd1dHRlciBoYXMgYmVlbiByZWFsaWduZWQsIGNhdXNpbmcgaXQgdG9cbiAgLy8gd3JpZ2dsZSBhcm91bmQgaW4gYSBtb3N0IHVuc2VlbWx5IHdheS4gV2hlbiB3ZSBoYXZlIGFuXG4gIC8vIGVzdGltYXRlZCBwaXhlbHMvZGVsdGEgdmFsdWUsIHdlIGp1c3QgaGFuZGxlIGhvcml6b250YWxcbiAgLy8gc2Nyb2xsaW5nIGVudGlyZWx5IGhlcmUuIEl0J2xsIGJlIHNsaWdodGx5IG9mZiBmcm9tIG5hdGl2ZSwgYnV0XG4gIC8vIGJldHRlciB0aGFuIGdsaXRjaGluZyBvdXQuXG4gIGlmIChkeCAmJiAhZ2Vja28gJiYgIXByZXN0byAmJiB3aGVlbFBpeGVsc1BlclVuaXQgIT0gbnVsbCkge1xuICAgIGlmIChkeSAmJiBjYW5TY3JvbGxZKVxuICAgICAgeyB1cGRhdGVTY3JvbGxUb3AoY20sIE1hdGgubWF4KDAsIHNjcm9sbC5zY3JvbGxUb3AgKyBkeSAqIHdoZWVsUGl4ZWxzUGVyVW5pdCkpOyB9XG4gICAgc2V0U2Nyb2xsTGVmdChjbSwgTWF0aC5tYXgoMCwgc2Nyb2xsLnNjcm9sbExlZnQgKyBkeCAqIHdoZWVsUGl4ZWxzUGVyVW5pdCkpO1xuICAgIC8vIE9ubHkgcHJldmVudCBkZWZhdWx0IHNjcm9sbGluZyBpZiB2ZXJ0aWNhbCBzY3JvbGxpbmcgaXNcbiAgICAvLyBhY3R1YWxseSBwb3NzaWJsZS4gT3RoZXJ3aXNlLCBpdCBjYXVzZXMgdmVydGljYWwgc2Nyb2xsXG4gICAgLy8gaml0dGVyIG9uIE9TWCB0cmFja3BhZHMgd2hlbiBkZWx0YVggaXMgc21hbGwgYW5kIGRlbHRhWVxuICAgIC8vIGlzIGxhcmdlIChpc3N1ZSAjMzU3OSlcbiAgICBpZiAoIWR5IHx8IChkeSAmJiBjYW5TY3JvbGxZKSlcbiAgICAgIHsgZV9wcmV2ZW50RGVmYXVsdChlKTsgfVxuICAgIGRpc3BsYXkud2hlZWxTdGFydFggPSBudWxsOyAvLyBBYm9ydCBtZWFzdXJlbWVudCwgaWYgaW4gcHJvZ3Jlc3NcbiAgICByZXR1cm5cbiAgfVxuXG4gIC8vICdQcm9qZWN0JyB0aGUgdmlzaWJsZSB2aWV3cG9ydCB0byBjb3ZlciB0aGUgYXJlYSB0aGF0IGlzIGJlaW5nXG4gIC8vIHNjcm9sbGVkIGludG8gdmlldyAoaWYgd2Uga25vdyBlbm91Z2ggdG8gZXN0aW1hdGUgaXQpLlxuICBpZiAoZHkgJiYgd2hlZWxQaXhlbHNQZXJVbml0ICE9IG51bGwpIHtcbiAgICB2YXIgcGl4ZWxzID0gZHkgKiB3aGVlbFBpeGVsc1BlclVuaXQ7XG4gICAgdmFyIHRvcCA9IGNtLmRvYy5zY3JvbGxUb3AsIGJvdCA9IHRvcCArIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7XG4gICAgaWYgKHBpeGVscyA8IDApIHsgdG9wID0gTWF0aC5tYXgoMCwgdG9wICsgcGl4ZWxzIC0gNTApOyB9XG4gICAgZWxzZSB7IGJvdCA9IE1hdGgubWluKGNtLmRvYy5oZWlnaHQsIGJvdCArIHBpeGVscyArIDUwKTsgfVxuICAgIHVwZGF0ZURpc3BsYXlTaW1wbGUoY20sIHt0b3A6IHRvcCwgYm90dG9tOiBib3R9KTtcbiAgfVxuXG4gIGlmICh3aGVlbFNhbXBsZXMgPCAyMCkge1xuICAgIGlmIChkaXNwbGF5LndoZWVsU3RhcnRYID09IG51bGwpIHtcbiAgICAgIGRpc3BsYXkud2hlZWxTdGFydFggPSBzY3JvbGwuc2Nyb2xsTGVmdDsgZGlzcGxheS53aGVlbFN0YXJ0WSA9IHNjcm9sbC5zY3JvbGxUb3A7XG4gICAgICBkaXNwbGF5LndoZWVsRFggPSBkeDsgZGlzcGxheS53aGVlbERZID0gZHk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRpc3BsYXkud2hlZWxTdGFydFggPT0gbnVsbCkgeyByZXR1cm4gfVxuICAgICAgICB2YXIgbW92ZWRYID0gc2Nyb2xsLnNjcm9sbExlZnQgLSBkaXNwbGF5LndoZWVsU3RhcnRYO1xuICAgICAgICB2YXIgbW92ZWRZID0gc2Nyb2xsLnNjcm9sbFRvcCAtIGRpc3BsYXkud2hlZWxTdGFydFk7XG4gICAgICAgIHZhciBzYW1wbGUgPSAobW92ZWRZICYmIGRpc3BsYXkud2hlZWxEWSAmJiBtb3ZlZFkgLyBkaXNwbGF5LndoZWVsRFkpIHx8XG4gICAgICAgICAgKG1vdmVkWCAmJiBkaXNwbGF5LndoZWVsRFggJiYgbW92ZWRYIC8gZGlzcGxheS53aGVlbERYKTtcbiAgICAgICAgZGlzcGxheS53aGVlbFN0YXJ0WCA9IGRpc3BsYXkud2hlZWxTdGFydFkgPSBudWxsO1xuICAgICAgICBpZiAoIXNhbXBsZSkgeyByZXR1cm4gfVxuICAgICAgICB3aGVlbFBpeGVsc1BlclVuaXQgPSAod2hlZWxQaXhlbHNQZXJVbml0ICogd2hlZWxTYW1wbGVzICsgc2FtcGxlKSAvICh3aGVlbFNhbXBsZXMgKyAxKTtcbiAgICAgICAgKyt3aGVlbFNhbXBsZXM7XG4gICAgICB9LCAyMDApO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXNwbGF5LndoZWVsRFggKz0gZHg7IGRpc3BsYXkud2hlZWxEWSArPSBkeTtcbiAgICB9XG4gIH1cbn1cblxuLy8gU2VsZWN0aW9uIG9iamVjdHMgYXJlIGltbXV0YWJsZS4gQSBuZXcgb25lIGlzIGNyZWF0ZWQgZXZlcnkgdGltZVxuLy8gdGhlIHNlbGVjdGlvbiBjaGFuZ2VzLiBBIHNlbGVjdGlvbiBpcyBvbmUgb3IgbW9yZSBub24tb3ZlcmxhcHBpbmdcbi8vIChhbmQgbm9uLXRvdWNoaW5nKSByYW5nZXMsIHNvcnRlZCwgYW5kIGFuIGludGVnZXIgdGhhdCBpbmRpY2F0ZXNcbi8vIHdoaWNoIG9uZSBpcyB0aGUgcHJpbWFyeSBzZWxlY3Rpb24gKHRoZSBvbmUgdGhhdCdzIHNjcm9sbGVkIGludG9cbi8vIHZpZXcsIHRoYXQgZ2V0Q3Vyc29yIHJldHVybnMsIGV0YykuXG52YXIgU2VsZWN0aW9uID0gZnVuY3Rpb24ocmFuZ2VzLCBwcmltSW5kZXgpIHtcbiAgdGhpcy5yYW5nZXMgPSByYW5nZXM7XG4gIHRoaXMucHJpbUluZGV4ID0gcHJpbUluZGV4O1xufTtcblxuU2VsZWN0aW9uLnByb3RvdHlwZS5wcmltYXJ5ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5yYW5nZXNbdGhpcy5wcmltSW5kZXhdIH07XG5cblNlbGVjdGlvbi5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG90aGVyKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKG90aGVyID09IHRoaXMpIHsgcmV0dXJuIHRydWUgfVxuICBpZiAob3RoZXIucHJpbUluZGV4ICE9IHRoaXMucHJpbUluZGV4IHx8IG90aGVyLnJhbmdlcy5sZW5ndGggIT0gdGhpcy5yYW5nZXMubGVuZ3RoKSB7IHJldHVybiBmYWxzZSB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaGVyZSA9IHRoaXMkMS5yYW5nZXNbaV0sIHRoZXJlID0gb3RoZXIucmFuZ2VzW2ldO1xuICAgIGlmICghZXF1YWxDdXJzb3JQb3MoaGVyZS5hbmNob3IsIHRoZXJlLmFuY2hvcikgfHwgIWVxdWFsQ3Vyc29yUG9zKGhlcmUuaGVhZCwgdGhlcmUuaGVhZCkpIHsgcmV0dXJuIGZhbHNlIH1cbiAgfVxuICByZXR1cm4gdHJ1ZVxufTtcblxuU2VsZWN0aW9uLnByb3RvdHlwZS5kZWVwQ29weSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICB2YXIgb3V0ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgeyBvdXRbaV0gPSBuZXcgUmFuZ2UoY29weVBvcyh0aGlzJDEucmFuZ2VzW2ldLmFuY2hvciksIGNvcHlQb3ModGhpcyQxLnJhbmdlc1tpXS5oZWFkKSk7IH1cbiAgcmV0dXJuIG5ldyBTZWxlY3Rpb24ob3V0LCB0aGlzLnByaW1JbmRleClcbn07XG5cblNlbGVjdGlvbi5wcm90b3R5cGUuc29tZXRoaW5nU2VsZWN0ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICB7IGlmICghdGhpcyQxLnJhbmdlc1tpXS5lbXB0eSgpKSB7IHJldHVybiB0cnVlIH0gfVxuICByZXR1cm4gZmFsc2Vcbn07XG5cblNlbGVjdGlvbi5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbiAocG9zLCBlbmQpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBpZiAoIWVuZCkgeyBlbmQgPSBwb3M7IH1cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciByYW5nZSA9IHRoaXMkMS5yYW5nZXNbaV07XG4gICAgaWYgKGNtcChlbmQsIHJhbmdlLmZyb20oKSkgPj0gMCAmJiBjbXAocG9zLCByYW5nZS50bygpKSA8PSAwKVxuICAgICAgeyByZXR1cm4gaSB9XG4gIH1cbiAgcmV0dXJuIC0xXG59O1xuXG52YXIgUmFuZ2UgPSBmdW5jdGlvbihhbmNob3IsIGhlYWQpIHtcbiAgdGhpcy5hbmNob3IgPSBhbmNob3I7IHRoaXMuaGVhZCA9IGhlYWQ7XG59O1xuXG5SYW5nZS5wcm90b3R5cGUuZnJvbSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1pblBvcyh0aGlzLmFuY2hvciwgdGhpcy5oZWFkKSB9O1xuUmFuZ2UucHJvdG90eXBlLnRvID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbWF4UG9zKHRoaXMuYW5jaG9yLCB0aGlzLmhlYWQpIH07XG5SYW5nZS5wcm90b3R5cGUuZW1wdHkgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmhlYWQubGluZSA9PSB0aGlzLmFuY2hvci5saW5lICYmIHRoaXMuaGVhZC5jaCA9PSB0aGlzLmFuY2hvci5jaCB9O1xuXG4vLyBUYWtlIGFuIHVuc29ydGVkLCBwb3RlbnRpYWxseSBvdmVybGFwcGluZyBzZXQgb2YgcmFuZ2VzLCBhbmRcbi8vIGJ1aWxkIGEgc2VsZWN0aW9uIG91dCBvZiBpdC4gJ0NvbnN1bWVzJyByYW5nZXMgYXJyYXkgKG1vZGlmeWluZ1xuLy8gaXQpLlxuZnVuY3Rpb24gbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgcHJpbUluZGV4KSB7XG4gIHZhciBwcmltID0gcmFuZ2VzW3ByaW1JbmRleF07XG4gIHJhbmdlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBjbXAoYS5mcm9tKCksIGIuZnJvbSgpKTsgfSk7XG4gIHByaW1JbmRleCA9IGluZGV4T2YocmFuZ2VzLCBwcmltKTtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY3VyID0gcmFuZ2VzW2ldLCBwcmV2ID0gcmFuZ2VzW2kgLSAxXTtcbiAgICBpZiAoY21wKHByZXYudG8oKSwgY3VyLmZyb20oKSkgPj0gMCkge1xuICAgICAgdmFyIGZyb20gPSBtaW5Qb3MocHJldi5mcm9tKCksIGN1ci5mcm9tKCkpLCB0byA9IG1heFBvcyhwcmV2LnRvKCksIGN1ci50bygpKTtcbiAgICAgIHZhciBpbnYgPSBwcmV2LmVtcHR5KCkgPyBjdXIuZnJvbSgpID09IGN1ci5oZWFkIDogcHJldi5mcm9tKCkgPT0gcHJldi5oZWFkO1xuICAgICAgaWYgKGkgPD0gcHJpbUluZGV4KSB7IC0tcHJpbUluZGV4OyB9XG4gICAgICByYW5nZXMuc3BsaWNlKC0taSwgMiwgbmV3IFJhbmdlKGludiA/IHRvIDogZnJvbSwgaW52ID8gZnJvbSA6IHRvKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXcgU2VsZWN0aW9uKHJhbmdlcywgcHJpbUluZGV4KVxufVxuXG5mdW5jdGlvbiBzaW1wbGVTZWxlY3Rpb24oYW5jaG9yLCBoZWFkKSB7XG4gIHJldHVybiBuZXcgU2VsZWN0aW9uKFtuZXcgUmFuZ2UoYW5jaG9yLCBoZWFkIHx8IGFuY2hvcildLCAwKVxufVxuXG4vLyBDb21wdXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZW5kIG9mIGEgY2hhbmdlIChpdHMgJ3RvJyBwcm9wZXJ0eVxuLy8gcmVmZXJzIHRvIHRoZSBwcmUtY2hhbmdlIGVuZCkuXG5mdW5jdGlvbiBjaGFuZ2VFbmQoY2hhbmdlKSB7XG4gIGlmICghY2hhbmdlLnRleHQpIHsgcmV0dXJuIGNoYW5nZS50byB9XG4gIHJldHVybiBQb3MoY2hhbmdlLmZyb20ubGluZSArIGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDEsXG4gICAgICAgICAgICAgbHN0KGNoYW5nZS50ZXh0KS5sZW5ndGggKyAoY2hhbmdlLnRleHQubGVuZ3RoID09IDEgPyBjaGFuZ2UuZnJvbS5jaCA6IDApKVxufVxuXG4vLyBBZGp1c3QgYSBwb3NpdGlvbiB0byByZWZlciB0byB0aGUgcG9zdC1jaGFuZ2UgcG9zaXRpb24gb2YgdGhlXG4vLyBzYW1lIHRleHQsIG9yIHRoZSBlbmQgb2YgdGhlIGNoYW5nZSBpZiB0aGUgY2hhbmdlIGNvdmVycyBpdC5cbmZ1bmN0aW9uIGFkanVzdEZvckNoYW5nZShwb3MsIGNoYW5nZSkge1xuICBpZiAoY21wKHBvcywgY2hhbmdlLmZyb20pIDwgMCkgeyByZXR1cm4gcG9zIH1cbiAgaWYgKGNtcChwb3MsIGNoYW5nZS50bykgPD0gMCkgeyByZXR1cm4gY2hhbmdlRW5kKGNoYW5nZSkgfVxuXG4gIHZhciBsaW5lID0gcG9zLmxpbmUgKyBjaGFuZ2UudGV4dC5sZW5ndGggLSAoY2hhbmdlLnRvLmxpbmUgLSBjaGFuZ2UuZnJvbS5saW5lKSAtIDEsIGNoID0gcG9zLmNoO1xuICBpZiAocG9zLmxpbmUgPT0gY2hhbmdlLnRvLmxpbmUpIHsgY2ggKz0gY2hhbmdlRW5kKGNoYW5nZSkuY2ggLSBjaGFuZ2UudG8uY2g7IH1cbiAgcmV0dXJuIFBvcyhsaW5lLCBjaClcbn1cblxuZnVuY3Rpb24gY29tcHV0ZVNlbEFmdGVyQ2hhbmdlKGRvYywgY2hhbmdlKSB7XG4gIHZhciBvdXQgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciByYW5nZSA9IGRvYy5zZWwucmFuZ2VzW2ldO1xuICAgIG91dC5wdXNoKG5ldyBSYW5nZShhZGp1c3RGb3JDaGFuZ2UocmFuZ2UuYW5jaG9yLCBjaGFuZ2UpLFxuICAgICAgICAgICAgICAgICAgICAgICBhZGp1c3RGb3JDaGFuZ2UocmFuZ2UuaGVhZCwgY2hhbmdlKSkpO1xuICB9XG4gIHJldHVybiBub3JtYWxpemVTZWxlY3Rpb24ob3V0LCBkb2Muc2VsLnByaW1JbmRleClcbn1cblxuZnVuY3Rpb24gb2Zmc2V0UG9zKHBvcywgb2xkLCBudykge1xuICBpZiAocG9zLmxpbmUgPT0gb2xkLmxpbmUpXG4gICAgeyByZXR1cm4gUG9zKG53LmxpbmUsIHBvcy5jaCAtIG9sZC5jaCArIG53LmNoKSB9XG4gIGVsc2VcbiAgICB7IHJldHVybiBQb3MobncubGluZSArIChwb3MubGluZSAtIG9sZC5saW5lKSwgcG9zLmNoKSB9XG59XG5cbi8vIFVzZWQgYnkgcmVwbGFjZVNlbGVjdGlvbnMgdG8gYWxsb3cgbW92aW5nIHRoZSBzZWxlY3Rpb24gdG8gdGhlXG4vLyBzdGFydCBvciBhcm91bmQgdGhlIHJlcGxhY2VkIHRlc3QuIEhpbnQgbWF5IGJlIFwic3RhcnRcIiBvciBcImFyb3VuZFwiLlxuZnVuY3Rpb24gY29tcHV0ZVJlcGxhY2VkU2VsKGRvYywgY2hhbmdlcywgaGludCkge1xuICB2YXIgb3V0ID0gW107XG4gIHZhciBvbGRQcmV2ID0gUG9zKGRvYy5maXJzdCwgMCksIG5ld1ByZXYgPSBvbGRQcmV2O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgY2hhbmdlID0gY2hhbmdlc1tpXTtcbiAgICB2YXIgZnJvbSA9IG9mZnNldFBvcyhjaGFuZ2UuZnJvbSwgb2xkUHJldiwgbmV3UHJldik7XG4gICAgdmFyIHRvID0gb2Zmc2V0UG9zKGNoYW5nZUVuZChjaGFuZ2UpLCBvbGRQcmV2LCBuZXdQcmV2KTtcbiAgICBvbGRQcmV2ID0gY2hhbmdlLnRvO1xuICAgIG5ld1ByZXYgPSB0bztcbiAgICBpZiAoaGludCA9PSBcImFyb3VuZFwiKSB7XG4gICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpXSwgaW52ID0gY21wKHJhbmdlLmhlYWQsIHJhbmdlLmFuY2hvcikgPCAwO1xuICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKGludiA/IHRvIDogZnJvbSwgaW52ID8gZnJvbSA6IHRvKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKGZyb20sIGZyb20pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbmV3IFNlbGVjdGlvbihvdXQsIGRvYy5zZWwucHJpbUluZGV4KVxufVxuXG4vLyBVc2VkIHRvIGdldCB0aGUgZWRpdG9yIGludG8gYSBjb25zaXN0ZW50IHN0YXRlIGFnYWluIHdoZW4gb3B0aW9ucyBjaGFuZ2UuXG5cbmZ1bmN0aW9uIGxvYWRNb2RlKGNtKSB7XG4gIGNtLmRvYy5tb2RlID0gZ2V0TW9kZShjbS5vcHRpb25zLCBjbS5kb2MubW9kZU9wdGlvbik7XG4gIHJlc2V0TW9kZVN0YXRlKGNtKTtcbn1cblxuZnVuY3Rpb24gcmVzZXRNb2RlU3RhdGUoY20pIHtcbiAgY20uZG9jLml0ZXIoZnVuY3Rpb24gKGxpbmUpIHtcbiAgICBpZiAobGluZS5zdGF0ZUFmdGVyKSB7IGxpbmUuc3RhdGVBZnRlciA9IG51bGw7IH1cbiAgICBpZiAobGluZS5zdHlsZXMpIHsgbGluZS5zdHlsZXMgPSBudWxsOyB9XG4gIH0pO1xuICBjbS5kb2MuZnJvbnRpZXIgPSBjbS5kb2MuZmlyc3Q7XG4gIHN0YXJ0V29ya2VyKGNtLCAxMDApO1xuICBjbS5zdGF0ZS5tb2RlR2VuKys7XG4gIGlmIChjbS5jdXJPcCkgeyByZWdDaGFuZ2UoY20pOyB9XG59XG5cbi8vIERPQ1VNRU5UIERBVEEgU1RSVUNUVVJFXG5cbi8vIEJ5IGRlZmF1bHQsIHVwZGF0ZXMgdGhhdCBzdGFydCBhbmQgZW5kIGF0IHRoZSBiZWdpbm5pbmcgb2YgYSBsaW5lXG4vLyBhcmUgdHJlYXRlZCBzcGVjaWFsbHksIGluIG9yZGVyIHRvIG1ha2UgdGhlIGFzc29jaWF0aW9uIG9mIGxpbmVcbi8vIHdpZGdldHMgYW5kIG1hcmtlciBlbGVtZW50cyB3aXRoIHRoZSB0ZXh0IGJlaGF2ZSBtb3JlIGludHVpdGl2ZS5cbmZ1bmN0aW9uIGlzV2hvbGVMaW5lVXBkYXRlKGRvYywgY2hhbmdlKSB7XG4gIHJldHVybiBjaGFuZ2UuZnJvbS5jaCA9PSAwICYmIGNoYW5nZS50by5jaCA9PSAwICYmIGxzdChjaGFuZ2UudGV4dCkgPT0gXCJcIiAmJlxuICAgICghZG9jLmNtIHx8IGRvYy5jbS5vcHRpb25zLndob2xlTGluZVVwZGF0ZUJlZm9yZSlcbn1cblxuLy8gUGVyZm9ybSBhIGNoYW5nZSBvbiB0aGUgZG9jdW1lbnQgZGF0YSBzdHJ1Y3R1cmUuXG5mdW5jdGlvbiB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCQkMSkge1xuICBmdW5jdGlvbiBzcGFuc0ZvcihuKSB7cmV0dXJuIG1hcmtlZFNwYW5zID8gbWFya2VkU3BhbnNbbl0gOiBudWxsfVxuICBmdW5jdGlvbiB1cGRhdGUobGluZSwgdGV4dCwgc3BhbnMpIHtcbiAgICB1cGRhdGVMaW5lKGxpbmUsIHRleHQsIHNwYW5zLCBlc3RpbWF0ZUhlaWdodCQkMSk7XG4gICAgc2lnbmFsTGF0ZXIobGluZSwgXCJjaGFuZ2VcIiwgbGluZSwgY2hhbmdlKTtcbiAgfVxuICBmdW5jdGlvbiBsaW5lc0ZvcihzdGFydCwgZW5kKSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKVxuICAgICAgeyByZXN1bHQucHVzaChuZXcgTGluZSh0ZXh0W2ldLCBzcGFuc0ZvcihpKSwgZXN0aW1hdGVIZWlnaHQkJDEpKTsgfVxuICAgIHJldHVybiByZXN1bHRcbiAgfVxuXG4gIHZhciBmcm9tID0gY2hhbmdlLmZyb20sIHRvID0gY2hhbmdlLnRvLCB0ZXh0ID0gY2hhbmdlLnRleHQ7XG4gIHZhciBmaXJzdExpbmUgPSBnZXRMaW5lKGRvYywgZnJvbS5saW5lKSwgbGFzdExpbmUgPSBnZXRMaW5lKGRvYywgdG8ubGluZSk7XG4gIHZhciBsYXN0VGV4dCA9IGxzdCh0ZXh0KSwgbGFzdFNwYW5zID0gc3BhbnNGb3IodGV4dC5sZW5ndGggLSAxKSwgbmxpbmVzID0gdG8ubGluZSAtIGZyb20ubGluZTtcblxuICAvLyBBZGp1c3QgdGhlIGxpbmUgc3RydWN0dXJlXG4gIGlmIChjaGFuZ2UuZnVsbCkge1xuICAgIGRvYy5pbnNlcnQoMCwgbGluZXNGb3IoMCwgdGV4dC5sZW5ndGgpKTtcbiAgICBkb2MucmVtb3ZlKHRleHQubGVuZ3RoLCBkb2Muc2l6ZSAtIHRleHQubGVuZ3RoKTtcbiAgfSBlbHNlIGlmIChpc1dob2xlTGluZVVwZGF0ZShkb2MsIGNoYW5nZSkpIHtcbiAgICAvLyBUaGlzIGlzIGEgd2hvbGUtbGluZSByZXBsYWNlLiBUcmVhdGVkIHNwZWNpYWxseSB0byBtYWtlXG4gICAgLy8gc3VyZSBsaW5lIG9iamVjdHMgbW92ZSB0aGUgd2F5IHRoZXkgYXJlIHN1cHBvc2VkIHRvLlxuICAgIHZhciBhZGRlZCA9IGxpbmVzRm9yKDAsIHRleHQubGVuZ3RoIC0gMSk7XG4gICAgdXBkYXRlKGxhc3RMaW5lLCBsYXN0TGluZS50ZXh0LCBsYXN0U3BhbnMpO1xuICAgIGlmIChubGluZXMpIHsgZG9jLnJlbW92ZShmcm9tLmxpbmUsIG5saW5lcyk7IH1cbiAgICBpZiAoYWRkZWQubGVuZ3RoKSB7IGRvYy5pbnNlcnQoZnJvbS5saW5lLCBhZGRlZCk7IH1cbiAgfSBlbHNlIGlmIChmaXJzdExpbmUgPT0gbGFzdExpbmUpIHtcbiAgICBpZiAodGV4dC5sZW5ndGggPT0gMSkge1xuICAgICAgdXBkYXRlKGZpcnN0TGluZSwgZmlyc3RMaW5lLnRleHQuc2xpY2UoMCwgZnJvbS5jaCkgKyBsYXN0VGV4dCArIGZpcnN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgbGFzdFNwYW5zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGFkZGVkJDEgPSBsaW5lc0ZvcigxLCB0ZXh0Lmxlbmd0aCAtIDEpO1xuICAgICAgYWRkZWQkMS5wdXNoKG5ldyBMaW5lKGxhc3RUZXh0ICsgZmlyc3RMaW5lLnRleHQuc2xpY2UodG8uY2gpLCBsYXN0U3BhbnMsIGVzdGltYXRlSGVpZ2h0JCQxKSk7XG4gICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0sIHNwYW5zRm9yKDApKTtcbiAgICAgIGRvYy5pbnNlcnQoZnJvbS5saW5lICsgMSwgYWRkZWQkMSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHRleHQubGVuZ3RoID09IDEpIHtcbiAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0gKyBsYXN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgc3BhbnNGb3IoMCkpO1xuICAgIGRvYy5yZW1vdmUoZnJvbS5saW5lICsgMSwgbmxpbmVzKTtcbiAgfSBlbHNlIHtcbiAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0sIHNwYW5zRm9yKDApKTtcbiAgICB1cGRhdGUobGFzdExpbmUsIGxhc3RUZXh0ICsgbGFzdExpbmUudGV4dC5zbGljZSh0by5jaCksIGxhc3RTcGFucyk7XG4gICAgdmFyIGFkZGVkJDIgPSBsaW5lc0ZvcigxLCB0ZXh0Lmxlbmd0aCAtIDEpO1xuICAgIGlmIChubGluZXMgPiAxKSB7IGRvYy5yZW1vdmUoZnJvbS5saW5lICsgMSwgbmxpbmVzIC0gMSk7IH1cbiAgICBkb2MuaW5zZXJ0KGZyb20ubGluZSArIDEsIGFkZGVkJDIpO1xuICB9XG5cbiAgc2lnbmFsTGF0ZXIoZG9jLCBcImNoYW5nZVwiLCBkb2MsIGNoYW5nZSk7XG59XG5cbi8vIENhbGwgZiBmb3IgYWxsIGxpbmtlZCBkb2N1bWVudHMuXG5mdW5jdGlvbiBsaW5rZWREb2NzKGRvYywgZiwgc2hhcmVkSGlzdE9ubHkpIHtcbiAgZnVuY3Rpb24gcHJvcGFnYXRlKGRvYywgc2tpcCwgc2hhcmVkSGlzdCkge1xuICAgIGlmIChkb2MubGlua2VkKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLmxpbmtlZC5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHJlbCA9IGRvYy5saW5rZWRbaV07XG4gICAgICBpZiAocmVsLmRvYyA9PSBza2lwKSB7IGNvbnRpbnVlIH1cbiAgICAgIHZhciBzaGFyZWQgPSBzaGFyZWRIaXN0ICYmIHJlbC5zaGFyZWRIaXN0O1xuICAgICAgaWYgKHNoYXJlZEhpc3RPbmx5ICYmICFzaGFyZWQpIHsgY29udGludWUgfVxuICAgICAgZihyZWwuZG9jLCBzaGFyZWQpO1xuICAgICAgcHJvcGFnYXRlKHJlbC5kb2MsIGRvYywgc2hhcmVkKTtcbiAgICB9IH1cbiAgfVxuICBwcm9wYWdhdGUoZG9jLCBudWxsLCB0cnVlKTtcbn1cblxuLy8gQXR0YWNoIGEgZG9jdW1lbnQgdG8gYW4gZWRpdG9yLlxuZnVuY3Rpb24gYXR0YWNoRG9jKGNtLCBkb2MpIHtcbiAgaWYgKGRvYy5jbSkgeyB0aHJvdyBuZXcgRXJyb3IoXCJUaGlzIGRvY3VtZW50IGlzIGFscmVhZHkgaW4gdXNlLlwiKSB9XG4gIGNtLmRvYyA9IGRvYztcbiAgZG9jLmNtID0gY207XG4gIGVzdGltYXRlTGluZUhlaWdodHMoY20pO1xuICBsb2FkTW9kZShjbSk7XG4gIHNldERpcmVjdGlvbkNsYXNzKGNtKTtcbiAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgeyBmaW5kTWF4TGluZShjbSk7IH1cbiAgY20ub3B0aW9ucy5tb2RlID0gZG9jLm1vZGVPcHRpb247XG4gIHJlZ0NoYW5nZShjbSk7XG59XG5cbmZ1bmN0aW9uIHNldERpcmVjdGlvbkNsYXNzKGNtKSB7XG4gIChjbS5kb2MuZGlyZWN0aW9uID09IFwicnRsXCIgPyBhZGRDbGFzcyA6IHJtQ2xhc3MpKGNtLmRpc3BsYXkubGluZURpdiwgXCJDb2RlTWlycm9yLXJ0bFwiKTtcbn1cblxuZnVuY3Rpb24gZGlyZWN0aW9uQ2hhbmdlZChjbSkge1xuICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgc2V0RGlyZWN0aW9uQ2xhc3MoY20pO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBIaXN0b3J5KHN0YXJ0R2VuKSB7XG4gIC8vIEFycmF5cyBvZiBjaGFuZ2UgZXZlbnRzIGFuZCBzZWxlY3Rpb25zLiBEb2luZyBzb21ldGhpbmcgYWRkcyBhblxuICAvLyBldmVudCB0byBkb25lIGFuZCBjbGVhcnMgdW5kby4gVW5kb2luZyBtb3ZlcyBldmVudHMgZnJvbSBkb25lXG4gIC8vIHRvIHVuZG9uZSwgcmVkb2luZyBtb3ZlcyB0aGVtIGluIHRoZSBvdGhlciBkaXJlY3Rpb24uXG4gIHRoaXMuZG9uZSA9IFtdOyB0aGlzLnVuZG9uZSA9IFtdO1xuICB0aGlzLnVuZG9EZXB0aCA9IEluZmluaXR5O1xuICAvLyBVc2VkIHRvIHRyYWNrIHdoZW4gY2hhbmdlcyBjYW4gYmUgbWVyZ2VkIGludG8gYSBzaW5nbGUgdW5kb1xuICAvLyBldmVudFxuICB0aGlzLmxhc3RNb2RUaW1lID0gdGhpcy5sYXN0U2VsVGltZSA9IDA7XG4gIHRoaXMubGFzdE9wID0gdGhpcy5sYXN0U2VsT3AgPSBudWxsO1xuICB0aGlzLmxhc3RPcmlnaW4gPSB0aGlzLmxhc3RTZWxPcmlnaW4gPSBudWxsO1xuICAvLyBVc2VkIGJ5IHRoZSBpc0NsZWFuKCkgbWV0aG9kXG4gIHRoaXMuZ2VuZXJhdGlvbiA9IHRoaXMubWF4R2VuZXJhdGlvbiA9IHN0YXJ0R2VuIHx8IDE7XG59XG5cbi8vIENyZWF0ZSBhIGhpc3RvcnkgY2hhbmdlIGV2ZW50IGZyb20gYW4gdXBkYXRlRG9jLXN0eWxlIGNoYW5nZVxuLy8gb2JqZWN0LlxuZnVuY3Rpb24gaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpIHtcbiAgdmFyIGhpc3RDaGFuZ2UgPSB7ZnJvbTogY29weVBvcyhjaGFuZ2UuZnJvbSksIHRvOiBjaGFuZ2VFbmQoY2hhbmdlKSwgdGV4dDogZ2V0QmV0d2Vlbihkb2MsIGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pfTtcbiAgYXR0YWNoTG9jYWxTcGFucyhkb2MsIGhpc3RDaGFuZ2UsIGNoYW5nZS5mcm9tLmxpbmUsIGNoYW5nZS50by5saW5lICsgMSk7XG4gIGxpbmtlZERvY3MoZG9jLCBmdW5jdGlvbiAoZG9jKSB7IHJldHVybiBhdHRhY2hMb2NhbFNwYW5zKGRvYywgaGlzdENoYW5nZSwgY2hhbmdlLmZyb20ubGluZSwgY2hhbmdlLnRvLmxpbmUgKyAxKTsgfSwgdHJ1ZSk7XG4gIHJldHVybiBoaXN0Q2hhbmdlXG59XG5cbi8vIFBvcCBhbGwgc2VsZWN0aW9uIGV2ZW50cyBvZmYgdGhlIGVuZCBvZiBhIGhpc3RvcnkgYXJyYXkuIFN0b3AgYXRcbi8vIGEgY2hhbmdlIGV2ZW50LlxuZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb25FdmVudHMoYXJyYXkpIHtcbiAgd2hpbGUgKGFycmF5Lmxlbmd0aCkge1xuICAgIHZhciBsYXN0ID0gbHN0KGFycmF5KTtcbiAgICBpZiAobGFzdC5yYW5nZXMpIHsgYXJyYXkucG9wKCk7IH1cbiAgICBlbHNlIHsgYnJlYWsgfVxuICB9XG59XG5cbi8vIEZpbmQgdGhlIHRvcCBjaGFuZ2UgZXZlbnQgaW4gdGhlIGhpc3RvcnkuIFBvcCBvZmYgc2VsZWN0aW9uXG4vLyBldmVudHMgdGhhdCBhcmUgaW4gdGhlIHdheS5cbmZ1bmN0aW9uIGxhc3RDaGFuZ2VFdmVudChoaXN0LCBmb3JjZSkge1xuICBpZiAoZm9yY2UpIHtcbiAgICBjbGVhclNlbGVjdGlvbkV2ZW50cyhoaXN0LmRvbmUpO1xuICAgIHJldHVybiBsc3QoaGlzdC5kb25lKVxuICB9IGVsc2UgaWYgKGhpc3QuZG9uZS5sZW5ndGggJiYgIWxzdChoaXN0LmRvbmUpLnJhbmdlcykge1xuICAgIHJldHVybiBsc3QoaGlzdC5kb25lKVxuICB9IGVsc2UgaWYgKGhpc3QuZG9uZS5sZW5ndGggPiAxICYmICFoaXN0LmRvbmVbaGlzdC5kb25lLmxlbmd0aCAtIDJdLnJhbmdlcykge1xuICAgIGhpc3QuZG9uZS5wb3AoKTtcbiAgICByZXR1cm4gbHN0KGhpc3QuZG9uZSlcbiAgfVxufVxuXG4vLyBSZWdpc3RlciBhIGNoYW5nZSBpbiB0aGUgaGlzdG9yeS4gTWVyZ2VzIGNoYW5nZXMgdGhhdCBhcmUgd2l0aGluXG4vLyBhIHNpbmdsZSBvcGVyYXRpb24sIG9yIGFyZSBjbG9zZSB0b2dldGhlciB3aXRoIGFuIG9yaWdpbiB0aGF0XG4vLyBhbGxvd3MgbWVyZ2luZyAoc3RhcnRpbmcgd2l0aCBcIitcIikgaW50byBhIHNpbmdsZSBldmVudC5cbmZ1bmN0aW9uIGFkZENoYW5nZVRvSGlzdG9yeShkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIG9wSWQpIHtcbiAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeTtcbiAgaGlzdC51bmRvbmUubGVuZ3RoID0gMDtcbiAgdmFyIHRpbWUgPSArbmV3IERhdGUsIGN1cjtcbiAgdmFyIGxhc3Q7XG5cbiAgaWYgKChoaXN0Lmxhc3RPcCA9PSBvcElkIHx8XG4gICAgICAgaGlzdC5sYXN0T3JpZ2luID09IGNoYW5nZS5vcmlnaW4gJiYgY2hhbmdlLm9yaWdpbiAmJlxuICAgICAgICgoY2hhbmdlLm9yaWdpbi5jaGFyQXQoMCkgPT0gXCIrXCIgJiYgZG9jLmNtICYmIGhpc3QubGFzdE1vZFRpbWUgPiB0aW1lIC0gZG9jLmNtLm9wdGlvbnMuaGlzdG9yeUV2ZW50RGVsYXkpIHx8XG4gICAgICAgIGNoYW5nZS5vcmlnaW4uY2hhckF0KDApID09IFwiKlwiKSkgJiZcbiAgICAgIChjdXIgPSBsYXN0Q2hhbmdlRXZlbnQoaGlzdCwgaGlzdC5sYXN0T3AgPT0gb3BJZCkpKSB7XG4gICAgLy8gTWVyZ2UgdGhpcyBjaGFuZ2UgaW50byB0aGUgbGFzdCBldmVudFxuICAgIGxhc3QgPSBsc3QoY3VyLmNoYW5nZXMpO1xuICAgIGlmIChjbXAoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPT0gMCAmJiBjbXAoY2hhbmdlLmZyb20sIGxhc3QudG8pID09IDApIHtcbiAgICAgIC8vIE9wdGltaXplZCBjYXNlIGZvciBzaW1wbGUgaW5zZXJ0aW9uIC0tIGRvbid0IHdhbnQgdG8gYWRkXG4gICAgICAvLyBuZXcgY2hhbmdlc2V0cyBmb3IgZXZlcnkgY2hhcmFjdGVyIHR5cGVkXG4gICAgICBsYXN0LnRvID0gY2hhbmdlRW5kKGNoYW5nZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEFkZCBuZXcgc3ViLWV2ZW50XG4gICAgICBjdXIuY2hhbmdlcy5wdXNoKGhpc3RvcnlDaGFuZ2VGcm9tQ2hhbmdlKGRvYywgY2hhbmdlKSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIENhbiBub3QgYmUgbWVyZ2VkLCBzdGFydCBhIG5ldyBldmVudC5cbiAgICB2YXIgYmVmb3JlID0gbHN0KGhpc3QuZG9uZSk7XG4gICAgaWYgKCFiZWZvcmUgfHwgIWJlZm9yZS5yYW5nZXMpXG4gICAgICB7IHB1c2hTZWxlY3Rpb25Ub0hpc3RvcnkoZG9jLnNlbCwgaGlzdC5kb25lKTsgfVxuICAgIGN1ciA9IHtjaGFuZ2VzOiBbaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpXSxcbiAgICAgICAgICAgZ2VuZXJhdGlvbjogaGlzdC5nZW5lcmF0aW9ufTtcbiAgICBoaXN0LmRvbmUucHVzaChjdXIpO1xuICAgIHdoaWxlIChoaXN0LmRvbmUubGVuZ3RoID4gaGlzdC51bmRvRGVwdGgpIHtcbiAgICAgIGhpc3QuZG9uZS5zaGlmdCgpO1xuICAgICAgaWYgKCFoaXN0LmRvbmVbMF0ucmFuZ2VzKSB7IGhpc3QuZG9uZS5zaGlmdCgpOyB9XG4gICAgfVxuICB9XG4gIGhpc3QuZG9uZS5wdXNoKHNlbEFmdGVyKTtcbiAgaGlzdC5nZW5lcmF0aW9uID0gKytoaXN0Lm1heEdlbmVyYXRpb247XG4gIGhpc3QubGFzdE1vZFRpbWUgPSBoaXN0Lmxhc3RTZWxUaW1lID0gdGltZTtcbiAgaGlzdC5sYXN0T3AgPSBoaXN0Lmxhc3RTZWxPcCA9IG9wSWQ7XG4gIGhpc3QubGFzdE9yaWdpbiA9IGhpc3QubGFzdFNlbE9yaWdpbiA9IGNoYW5nZS5vcmlnaW47XG5cbiAgaWYgKCFsYXN0KSB7IHNpZ25hbChkb2MsIFwiaGlzdG9yeUFkZGVkXCIpOyB9XG59XG5cbmZ1bmN0aW9uIHNlbGVjdGlvbkV2ZW50Q2FuQmVNZXJnZWQoZG9jLCBvcmlnaW4sIHByZXYsIHNlbCkge1xuICB2YXIgY2ggPSBvcmlnaW4uY2hhckF0KDApO1xuICByZXR1cm4gY2ggPT0gXCIqXCIgfHxcbiAgICBjaCA9PSBcIitcIiAmJlxuICAgIHByZXYucmFuZ2VzLmxlbmd0aCA9PSBzZWwucmFuZ2VzLmxlbmd0aCAmJlxuICAgIHByZXYuc29tZXRoaW5nU2VsZWN0ZWQoKSA9PSBzZWwuc29tZXRoaW5nU2VsZWN0ZWQoKSAmJlxuICAgIG5ldyBEYXRlIC0gZG9jLmhpc3RvcnkubGFzdFNlbFRpbWUgPD0gKGRvYy5jbSA/IGRvYy5jbS5vcHRpb25zLmhpc3RvcnlFdmVudERlbGF5IDogNTAwKVxufVxuXG4vLyBDYWxsZWQgd2hlbmV2ZXIgdGhlIHNlbGVjdGlvbiBjaGFuZ2VzLCBzZXRzIHRoZSBuZXcgc2VsZWN0aW9uIGFzXG4vLyB0aGUgcGVuZGluZyBzZWxlY3Rpb24gaW4gdGhlIGhpc3RvcnksIGFuZCBwdXNoZXMgdGhlIG9sZCBwZW5kaW5nXG4vLyBzZWxlY3Rpb24gaW50byB0aGUgJ2RvbmUnIGFycmF5IHdoZW4gaXQgd2FzIHNpZ25pZmljYW50bHlcbi8vIGRpZmZlcmVudCAoaW4gbnVtYmVyIG9mIHNlbGVjdGVkIHJhbmdlcywgZW1wdGluZXNzLCBvciB0aW1lKS5cbmZ1bmN0aW9uIGFkZFNlbGVjdGlvblRvSGlzdG9yeShkb2MsIHNlbCwgb3BJZCwgb3B0aW9ucykge1xuICB2YXIgaGlzdCA9IGRvYy5oaXN0b3J5LCBvcmlnaW4gPSBvcHRpb25zICYmIG9wdGlvbnMub3JpZ2luO1xuXG4gIC8vIEEgbmV3IGV2ZW50IGlzIHN0YXJ0ZWQgd2hlbiB0aGUgcHJldmlvdXMgb3JpZ2luIGRvZXMgbm90IG1hdGNoXG4gIC8vIHRoZSBjdXJyZW50LCBvciB0aGUgb3JpZ2lucyBkb24ndCBhbGxvdyBtYXRjaGluZy4gT3JpZ2luc1xuICAvLyBzdGFydGluZyB3aXRoICogYXJlIGFsd2F5cyBtZXJnZWQsIHRob3NlIHN0YXJ0aW5nIHdpdGggKyBhcmVcbiAgLy8gbWVyZ2VkIHdoZW4gc2ltaWxhciBhbmQgY2xvc2UgdG9nZXRoZXIgaW4gdGltZS5cbiAgaWYgKG9wSWQgPT0gaGlzdC5sYXN0U2VsT3AgfHxcbiAgICAgIChvcmlnaW4gJiYgaGlzdC5sYXN0U2VsT3JpZ2luID09IG9yaWdpbiAmJlxuICAgICAgIChoaXN0Lmxhc3RNb2RUaW1lID09IGhpc3QubGFzdFNlbFRpbWUgJiYgaGlzdC5sYXN0T3JpZ2luID09IG9yaWdpbiB8fFxuICAgICAgICBzZWxlY3Rpb25FdmVudENhbkJlTWVyZ2VkKGRvYywgb3JpZ2luLCBsc3QoaGlzdC5kb25lKSwgc2VsKSkpKVxuICAgIHsgaGlzdC5kb25lW2hpc3QuZG9uZS5sZW5ndGggLSAxXSA9IHNlbDsgfVxuICBlbHNlXG4gICAgeyBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KHNlbCwgaGlzdC5kb25lKTsgfVxuXG4gIGhpc3QubGFzdFNlbFRpbWUgPSArbmV3IERhdGU7XG4gIGhpc3QubGFzdFNlbE9yaWdpbiA9IG9yaWdpbjtcbiAgaGlzdC5sYXN0U2VsT3AgPSBvcElkO1xuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNsZWFyUmVkbyAhPT0gZmFsc2UpXG4gICAgeyBjbGVhclNlbGVjdGlvbkV2ZW50cyhoaXN0LnVuZG9uZSk7IH1cbn1cblxuZnVuY3Rpb24gcHVzaFNlbGVjdGlvblRvSGlzdG9yeShzZWwsIGRlc3QpIHtcbiAgdmFyIHRvcCA9IGxzdChkZXN0KTtcbiAgaWYgKCEodG9wICYmIHRvcC5yYW5nZXMgJiYgdG9wLmVxdWFscyhzZWwpKSlcbiAgICB7IGRlc3QucHVzaChzZWwpOyB9XG59XG5cbi8vIFVzZWQgdG8gc3RvcmUgbWFya2VkIHNwYW4gaW5mb3JtYXRpb24gaW4gdGhlIGhpc3RvcnkuXG5mdW5jdGlvbiBhdHRhY2hMb2NhbFNwYW5zKGRvYywgY2hhbmdlLCBmcm9tLCB0bykge1xuICB2YXIgZXhpc3RpbmcgPSBjaGFuZ2VbXCJzcGFuc19cIiArIGRvYy5pZF0sIG4gPSAwO1xuICBkb2MuaXRlcihNYXRoLm1heChkb2MuZmlyc3QsIGZyb20pLCBNYXRoLm1pbihkb2MuZmlyc3QgKyBkb2Muc2l6ZSwgdG8pLCBmdW5jdGlvbiAobGluZSkge1xuICAgIGlmIChsaW5lLm1hcmtlZFNwYW5zKVxuICAgICAgeyAoZXhpc3RpbmcgfHwgKGV4aXN0aW5nID0gY2hhbmdlW1wic3BhbnNfXCIgKyBkb2MuaWRdID0ge30pKVtuXSA9IGxpbmUubWFya2VkU3BhbnM7IH1cbiAgICArK247XG4gIH0pO1xufVxuXG4vLyBXaGVuIHVuL3JlLWRvaW5nIHJlc3RvcmVzIHRleHQgY29udGFpbmluZyBtYXJrZWQgc3BhbnMsIHRob3NlXG4vLyB0aGF0IGhhdmUgYmVlbiBleHBsaWNpdGx5IGNsZWFyZWQgc2hvdWxkIG5vdCBiZSByZXN0b3JlZC5cbmZ1bmN0aW9uIHJlbW92ZUNsZWFyZWRTcGFucyhzcGFucykge1xuICBpZiAoIXNwYW5zKSB7IHJldHVybiBudWxsIH1cbiAgdmFyIG91dDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkge1xuICAgIGlmIChzcGFuc1tpXS5tYXJrZXIuZXhwbGljaXRseUNsZWFyZWQpIHsgaWYgKCFvdXQpIHsgb3V0ID0gc3BhbnMuc2xpY2UoMCwgaSk7IH0gfVxuICAgIGVsc2UgaWYgKG91dCkgeyBvdXQucHVzaChzcGFuc1tpXSk7IH1cbiAgfVxuICByZXR1cm4gIW91dCA/IHNwYW5zIDogb3V0Lmxlbmd0aCA/IG91dCA6IG51bGxcbn1cblxuLy8gUmV0cmlldmUgYW5kIGZpbHRlciB0aGUgb2xkIG1hcmtlZCBzcGFucyBzdG9yZWQgaW4gYSBjaGFuZ2UgZXZlbnQuXG5mdW5jdGlvbiBnZXRPbGRTcGFucyhkb2MsIGNoYW5nZSkge1xuICB2YXIgZm91bmQgPSBjaGFuZ2VbXCJzcGFuc19cIiArIGRvYy5pZF07XG4gIGlmICghZm91bmQpIHsgcmV0dXJuIG51bGwgfVxuICB2YXIgbncgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFuZ2UudGV4dC5sZW5ndGg7ICsraSlcbiAgICB7IG53LnB1c2gocmVtb3ZlQ2xlYXJlZFNwYW5zKGZvdW5kW2ldKSk7IH1cbiAgcmV0dXJuIG53XG59XG5cbi8vIFVzZWQgZm9yIHVuL3JlLWRvaW5nIGNoYW5nZXMgZnJvbSB0aGUgaGlzdG9yeS4gQ29tYmluZXMgdGhlXG4vLyByZXN1bHQgb2YgY29tcHV0aW5nIHRoZSBleGlzdGluZyBzcGFucyB3aXRoIHRoZSBzZXQgb2Ygc3BhbnMgdGhhdFxuLy8gZXhpc3RlZCBpbiB0aGUgaGlzdG9yeSAoc28gdGhhdCBkZWxldGluZyBhcm91bmQgYSBzcGFuIGFuZCB0aGVuXG4vLyB1bmRvaW5nIGJyaW5ncyBiYWNrIHRoZSBzcGFuKS5cbmZ1bmN0aW9uIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpIHtcbiAgdmFyIG9sZCA9IGdldE9sZFNwYW5zKGRvYywgY2hhbmdlKTtcbiAgdmFyIHN0cmV0Y2hlZCA9IHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpO1xuICBpZiAoIW9sZCkgeyByZXR1cm4gc3RyZXRjaGVkIH1cbiAgaWYgKCFzdHJldGNoZWQpIHsgcmV0dXJuIG9sZCB9XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBvbGQubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgb2xkQ3VyID0gb2xkW2ldLCBzdHJldGNoQ3VyID0gc3RyZXRjaGVkW2ldO1xuICAgIGlmIChvbGRDdXIgJiYgc3RyZXRjaEN1cikge1xuICAgICAgc3BhbnM6IGZvciAodmFyIGogPSAwOyBqIDwgc3RyZXRjaEN1ci5sZW5ndGg7ICsraikge1xuICAgICAgICB2YXIgc3BhbiA9IHN0cmV0Y2hDdXJbal07XG4gICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgb2xkQ3VyLmxlbmd0aDsgKytrKVxuICAgICAgICAgIHsgaWYgKG9sZEN1cltrXS5tYXJrZXIgPT0gc3Bhbi5tYXJrZXIpIHsgY29udGludWUgc3BhbnMgfSB9XG4gICAgICAgIG9sZEN1ci5wdXNoKHNwYW4pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3RyZXRjaEN1cikge1xuICAgICAgb2xkW2ldID0gc3RyZXRjaEN1cjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9sZFxufVxuXG4vLyBVc2VkIGJvdGggdG8gcHJvdmlkZSBhIEpTT04tc2FmZSBvYmplY3QgaW4gLmdldEhpc3RvcnksIGFuZCwgd2hlblxuLy8gZGV0YWNoaW5nIGEgZG9jdW1lbnQsIHRvIHNwbGl0IHRoZSBoaXN0b3J5IGluIHR3b1xuZnVuY3Rpb24gY29weUhpc3RvcnlBcnJheShldmVudHMsIG5ld0dyb3VwLCBpbnN0YW50aWF0ZVNlbCkge1xuICB2YXIgY29weSA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7ICsraSkge1xuICAgIHZhciBldmVudCA9IGV2ZW50c1tpXTtcbiAgICBpZiAoZXZlbnQucmFuZ2VzKSB7XG4gICAgICBjb3B5LnB1c2goaW5zdGFudGlhdGVTZWwgPyBTZWxlY3Rpb24ucHJvdG90eXBlLmRlZXBDb3B5LmNhbGwoZXZlbnQpIDogZXZlbnQpO1xuICAgICAgY29udGludWVcbiAgICB9XG4gICAgdmFyIGNoYW5nZXMgPSBldmVudC5jaGFuZ2VzLCBuZXdDaGFuZ2VzID0gW107XG4gICAgY29weS5wdXNoKHtjaGFuZ2VzOiBuZXdDaGFuZ2VzfSk7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBjaGFuZ2VzLmxlbmd0aDsgKytqKSB7XG4gICAgICB2YXIgY2hhbmdlID0gY2hhbmdlc1tqXSwgbSA9ICh2b2lkIDApO1xuICAgICAgbmV3Q2hhbmdlcy5wdXNoKHtmcm9tOiBjaGFuZ2UuZnJvbSwgdG86IGNoYW5nZS50bywgdGV4dDogY2hhbmdlLnRleHR9KTtcbiAgICAgIGlmIChuZXdHcm91cCkgeyBmb3IgKHZhciBwcm9wIGluIGNoYW5nZSkgeyBpZiAobSA9IHByb3AubWF0Y2goL15zcGFuc18oXFxkKykkLykpIHtcbiAgICAgICAgaWYgKGluZGV4T2YobmV3R3JvdXAsIE51bWJlcihtWzFdKSkgPiAtMSkge1xuICAgICAgICAgIGxzdChuZXdDaGFuZ2VzKVtwcm9wXSA9IGNoYW5nZVtwcm9wXTtcbiAgICAgICAgICBkZWxldGUgY2hhbmdlW3Byb3BdO1xuICAgICAgICB9XG4gICAgICB9IH0gfVxuICAgIH1cbiAgfVxuICByZXR1cm4gY29weVxufVxuXG4vLyBUaGUgJ3Njcm9sbCcgcGFyYW1ldGVyIGdpdmVuIHRvIG1hbnkgb2YgdGhlc2UgaW5kaWNhdGVkIHdoZXRoZXJcbi8vIHRoZSBuZXcgY3Vyc29yIHBvc2l0aW9uIHNob3VsZCBiZSBzY3JvbGxlZCBpbnRvIHZpZXcgYWZ0ZXJcbi8vIG1vZGlmeWluZyB0aGUgc2VsZWN0aW9uLlxuXG4vLyBJZiBzaGlmdCBpcyBoZWxkIG9yIHRoZSBleHRlbmQgZmxhZyBpcyBzZXQsIGV4dGVuZHMgYSByYW5nZSB0b1xuLy8gaW5jbHVkZSBhIGdpdmVuIHBvc2l0aW9uIChhbmQgb3B0aW9uYWxseSBhIHNlY29uZCBwb3NpdGlvbikuXG4vLyBPdGhlcndpc2UsIHNpbXBseSByZXR1cm5zIHRoZSByYW5nZSBiZXR3ZWVuIHRoZSBnaXZlbiBwb3NpdGlvbnMuXG4vLyBVc2VkIGZvciBjdXJzb3IgbW90aW9uIGFuZCBzdWNoLlxuZnVuY3Rpb24gZXh0ZW5kUmFuZ2UoZG9jLCByYW5nZSwgaGVhZCwgb3RoZXIpIHtcbiAgaWYgKGRvYy5jbSAmJiBkb2MuY20uZGlzcGxheS5zaGlmdCB8fCBkb2MuZXh0ZW5kKSB7XG4gICAgdmFyIGFuY2hvciA9IHJhbmdlLmFuY2hvcjtcbiAgICBpZiAob3RoZXIpIHtcbiAgICAgIHZhciBwb3NCZWZvcmUgPSBjbXAoaGVhZCwgYW5jaG9yKSA8IDA7XG4gICAgICBpZiAocG9zQmVmb3JlICE9IChjbXAob3RoZXIsIGFuY2hvcikgPCAwKSkge1xuICAgICAgICBhbmNob3IgPSBoZWFkO1xuICAgICAgICBoZWFkID0gb3RoZXI7XG4gICAgICB9IGVsc2UgaWYgKHBvc0JlZm9yZSAhPSAoY21wKGhlYWQsIG90aGVyKSA8IDApKSB7XG4gICAgICAgIGhlYWQgPSBvdGhlcjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBSYW5nZShhbmNob3IsIGhlYWQpXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG5ldyBSYW5nZShvdGhlciB8fCBoZWFkLCBoZWFkKVxuICB9XG59XG5cbi8vIEV4dGVuZCB0aGUgcHJpbWFyeSBzZWxlY3Rpb24gcmFuZ2UsIGRpc2NhcmQgdGhlIHJlc3QuXG5mdW5jdGlvbiBleHRlbmRTZWxlY3Rpb24oZG9jLCBoZWFkLCBvdGhlciwgb3B0aW9ucykge1xuICBzZXRTZWxlY3Rpb24oZG9jLCBuZXcgU2VsZWN0aW9uKFtleHRlbmRSYW5nZShkb2MsIGRvYy5zZWwucHJpbWFyeSgpLCBoZWFkLCBvdGhlcildLCAwKSwgb3B0aW9ucyk7XG59XG5cbi8vIEV4dGVuZCBhbGwgc2VsZWN0aW9ucyAocG9zIGlzIGFuIGFycmF5IG9mIHNlbGVjdGlvbnMgd2l0aCBsZW5ndGhcbi8vIGVxdWFsIHRoZSBudW1iZXIgb2Ygc2VsZWN0aW9ucylcbmZ1bmN0aW9uIGV4dGVuZFNlbGVjdGlvbnMoZG9jLCBoZWFkcywgb3B0aW9ucykge1xuICB2YXIgb3V0ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgeyBvdXRbaV0gPSBleHRlbmRSYW5nZShkb2MsIGRvYy5zZWwucmFuZ2VzW2ldLCBoZWFkc1tpXSwgbnVsbCk7IH1cbiAgdmFyIG5ld1NlbCA9IG5vcm1hbGl6ZVNlbGVjdGlvbihvdXQsIGRvYy5zZWwucHJpbUluZGV4KTtcbiAgc2V0U2VsZWN0aW9uKGRvYywgbmV3U2VsLCBvcHRpb25zKTtcbn1cblxuLy8gVXBkYXRlcyBhIHNpbmdsZSByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLlxuZnVuY3Rpb24gcmVwbGFjZU9uZVNlbGVjdGlvbihkb2MsIGksIHJhbmdlLCBvcHRpb25zKSB7XG4gIHZhciByYW5nZXMgPSBkb2Muc2VsLnJhbmdlcy5zbGljZSgwKTtcbiAgcmFuZ2VzW2ldID0gcmFuZ2U7XG4gIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihyYW5nZXMsIGRvYy5zZWwucHJpbUluZGV4KSwgb3B0aW9ucyk7XG59XG5cbi8vIFJlc2V0IHRoZSBzZWxlY3Rpb24gdG8gYSBzaW5nbGUgcmFuZ2UuXG5mdW5jdGlvbiBzZXRTaW1wbGVTZWxlY3Rpb24oZG9jLCBhbmNob3IsIGhlYWQsIG9wdGlvbnMpIHtcbiAgc2V0U2VsZWN0aW9uKGRvYywgc2ltcGxlU2VsZWN0aW9uKGFuY2hvciwgaGVhZCksIG9wdGlvbnMpO1xufVxuXG4vLyBHaXZlIGJlZm9yZVNlbGVjdGlvbkNoYW5nZSBoYW5kbGVycyBhIGNoYW5nZSB0byBpbmZsdWVuY2UgYVxuLy8gc2VsZWN0aW9uIHVwZGF0ZS5cbmZ1bmN0aW9uIGZpbHRlclNlbGVjdGlvbkNoYW5nZShkb2MsIHNlbCwgb3B0aW9ucykge1xuICB2YXIgb2JqID0ge1xuICAgIHJhbmdlczogc2VsLnJhbmdlcyxcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKHJhbmdlcykge1xuICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICAgIHRoaXMucmFuZ2VzID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgeyB0aGlzJDEucmFuZ2VzW2ldID0gbmV3IFJhbmdlKGNsaXBQb3MoZG9jLCByYW5nZXNbaV0uYW5jaG9yKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyhkb2MsIHJhbmdlc1tpXS5oZWFkKSk7IH1cbiAgICB9LFxuICAgIG9yaWdpbjogb3B0aW9ucyAmJiBvcHRpb25zLm9yaWdpblxuICB9O1xuICBzaWduYWwoZG9jLCBcImJlZm9yZVNlbGVjdGlvbkNoYW5nZVwiLCBkb2MsIG9iaik7XG4gIGlmIChkb2MuY20pIHsgc2lnbmFsKGRvYy5jbSwgXCJiZWZvcmVTZWxlY3Rpb25DaGFuZ2VcIiwgZG9jLmNtLCBvYmopOyB9XG4gIGlmIChvYmoucmFuZ2VzICE9IHNlbC5yYW5nZXMpIHsgcmV0dXJuIG5vcm1hbGl6ZVNlbGVjdGlvbihvYmoucmFuZ2VzLCBvYmoucmFuZ2VzLmxlbmd0aCAtIDEpIH1cbiAgZWxzZSB7IHJldHVybiBzZWwgfVxufVxuXG5mdW5jdGlvbiBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeShkb2MsIHNlbCwgb3B0aW9ucykge1xuICB2YXIgZG9uZSA9IGRvYy5oaXN0b3J5LmRvbmUsIGxhc3QgPSBsc3QoZG9uZSk7XG4gIGlmIChsYXN0ICYmIGxhc3QucmFuZ2VzKSB7XG4gICAgZG9uZVtkb25lLmxlbmd0aCAtIDFdID0gc2VsO1xuICAgIHNldFNlbGVjdGlvbk5vVW5kbyhkb2MsIHNlbCwgb3B0aW9ucyk7XG4gIH0gZWxzZSB7XG4gICAgc2V0U2VsZWN0aW9uKGRvYywgc2VsLCBvcHRpb25zKTtcbiAgfVxufVxuXG4vLyBTZXQgYSBuZXcgc2VsZWN0aW9uLlxuZnVuY3Rpb24gc2V0U2VsZWN0aW9uKGRvYywgc2VsLCBvcHRpb25zKSB7XG4gIHNldFNlbGVjdGlvbk5vVW5kbyhkb2MsIHNlbCwgb3B0aW9ucyk7XG4gIGFkZFNlbGVjdGlvblRvSGlzdG9yeShkb2MsIGRvYy5zZWwsIGRvYy5jbSA/IGRvYy5jbS5jdXJPcC5pZCA6IE5hTiwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIHNldFNlbGVjdGlvbk5vVW5kbyhkb2MsIHNlbCwgb3B0aW9ucykge1xuICBpZiAoaGFzSGFuZGxlcihkb2MsIFwiYmVmb3JlU2VsZWN0aW9uQ2hhbmdlXCIpIHx8IGRvYy5jbSAmJiBoYXNIYW5kbGVyKGRvYy5jbSwgXCJiZWZvcmVTZWxlY3Rpb25DaGFuZ2VcIikpXG4gICAgeyBzZWwgPSBmaWx0ZXJTZWxlY3Rpb25DaGFuZ2UoZG9jLCBzZWwsIG9wdGlvbnMpOyB9XG5cbiAgdmFyIGJpYXMgPSBvcHRpb25zICYmIG9wdGlvbnMuYmlhcyB8fFxuICAgIChjbXAoc2VsLnByaW1hcnkoKS5oZWFkLCBkb2Muc2VsLnByaW1hcnkoKS5oZWFkKSA8IDAgPyAtMSA6IDEpO1xuICBzZXRTZWxlY3Rpb25Jbm5lcihkb2MsIHNraXBBdG9taWNJblNlbGVjdGlvbihkb2MsIHNlbCwgYmlhcywgdHJ1ZSkpO1xuXG4gIGlmICghKG9wdGlvbnMgJiYgb3B0aW9ucy5zY3JvbGwgPT09IGZhbHNlKSAmJiBkb2MuY20pXG4gICAgeyBlbnN1cmVDdXJzb3JWaXNpYmxlKGRvYy5jbSk7IH1cbn1cblxuZnVuY3Rpb24gc2V0U2VsZWN0aW9uSW5uZXIoZG9jLCBzZWwpIHtcbiAgaWYgKHNlbC5lcXVhbHMoZG9jLnNlbCkpIHsgcmV0dXJuIH1cblxuICBkb2Muc2VsID0gc2VsO1xuXG4gIGlmIChkb2MuY20pIHtcbiAgICBkb2MuY20uY3VyT3AudXBkYXRlSW5wdXQgPSBkb2MuY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7XG4gICAgc2lnbmFsQ3Vyc29yQWN0aXZpdHkoZG9jLmNtKTtcbiAgfVxuICBzaWduYWxMYXRlcihkb2MsIFwiY3Vyc29yQWN0aXZpdHlcIiwgZG9jKTtcbn1cblxuLy8gVmVyaWZ5IHRoYXQgdGhlIHNlbGVjdGlvbiBkb2VzIG5vdCBwYXJ0aWFsbHkgc2VsZWN0IGFueSBhdG9taWNcbi8vIG1hcmtlZCByYW5nZXMuXG5mdW5jdGlvbiByZUNoZWNrU2VsZWN0aW9uKGRvYykge1xuICBzZXRTZWxlY3Rpb25Jbm5lcihkb2MsIHNraXBBdG9taWNJblNlbGVjdGlvbihkb2MsIGRvYy5zZWwsIG51bGwsIGZhbHNlKSk7XG59XG5cbi8vIFJldHVybiBhIHNlbGVjdGlvbiB0aGF0IGRvZXMgbm90IHBhcnRpYWxseSBzZWxlY3QgYW55IGF0b21pY1xuLy8gcmFuZ2VzLlxuZnVuY3Rpb24gc2tpcEF0b21pY0luU2VsZWN0aW9uKGRvYywgc2VsLCBiaWFzLCBtYXlDbGVhcikge1xuICB2YXIgb3V0O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbC5yYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcmFuZ2UgPSBzZWwucmFuZ2VzW2ldO1xuICAgIHZhciBvbGQgPSBzZWwucmFuZ2VzLmxlbmd0aCA9PSBkb2Muc2VsLnJhbmdlcy5sZW5ndGggJiYgZG9jLnNlbC5yYW5nZXNbaV07XG4gICAgdmFyIG5ld0FuY2hvciA9IHNraXBBdG9taWMoZG9jLCByYW5nZS5hbmNob3IsIG9sZCAmJiBvbGQuYW5jaG9yLCBiaWFzLCBtYXlDbGVhcik7XG4gICAgdmFyIG5ld0hlYWQgPSBza2lwQXRvbWljKGRvYywgcmFuZ2UuaGVhZCwgb2xkICYmIG9sZC5oZWFkLCBiaWFzLCBtYXlDbGVhcik7XG4gICAgaWYgKG91dCB8fCBuZXdBbmNob3IgIT0gcmFuZ2UuYW5jaG9yIHx8IG5ld0hlYWQgIT0gcmFuZ2UuaGVhZCkge1xuICAgICAgaWYgKCFvdXQpIHsgb3V0ID0gc2VsLnJhbmdlcy5zbGljZSgwLCBpKTsgfVxuICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKG5ld0FuY2hvciwgbmV3SGVhZCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBvdXQgPyBub3JtYWxpemVTZWxlY3Rpb24ob3V0LCBzZWwucHJpbUluZGV4KSA6IHNlbFxufVxuXG5mdW5jdGlvbiBza2lwQXRvbWljSW5uZXIoZG9jLCBwb3MsIG9sZFBvcywgZGlyLCBtYXlDbGVhcikge1xuICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBwb3MubGluZSk7XG4gIGlmIChsaW5lLm1hcmtlZFNwYW5zKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS5tYXJrZWRTcGFucy5sZW5ndGg7ICsraSkge1xuICAgIHZhciBzcCA9IGxpbmUubWFya2VkU3BhbnNbaV0sIG0gPSBzcC5tYXJrZXI7XG4gICAgaWYgKChzcC5mcm9tID09IG51bGwgfHwgKG0uaW5jbHVzaXZlTGVmdCA/IHNwLmZyb20gPD0gcG9zLmNoIDogc3AuZnJvbSA8IHBvcy5jaCkpICYmXG4gICAgICAgIChzcC50byA9PSBudWxsIHx8IChtLmluY2x1c2l2ZVJpZ2h0ID8gc3AudG8gPj0gcG9zLmNoIDogc3AudG8gPiBwb3MuY2gpKSkge1xuICAgICAgaWYgKG1heUNsZWFyKSB7XG4gICAgICAgIHNpZ25hbChtLCBcImJlZm9yZUN1cnNvckVudGVyXCIpO1xuICAgICAgICBpZiAobS5leHBsaWNpdGx5Q2xlYXJlZCkge1xuICAgICAgICAgIGlmICghbGluZS5tYXJrZWRTcGFucykgeyBicmVhayB9XG4gICAgICAgICAgZWxzZSB7LS1pOyBjb250aW51ZX1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFtLmF0b21pYykgeyBjb250aW51ZSB9XG5cbiAgICAgIGlmIChvbGRQb3MpIHtcbiAgICAgICAgdmFyIG5lYXIgPSBtLmZpbmQoZGlyIDwgMCA/IDEgOiAtMSksIGRpZmYgPSAodm9pZCAwKTtcbiAgICAgICAgaWYgKGRpciA8IDAgPyBtLmluY2x1c2l2ZVJpZ2h0IDogbS5pbmNsdXNpdmVMZWZ0KVxuICAgICAgICAgIHsgbmVhciA9IG1vdmVQb3MoZG9jLCBuZWFyLCAtZGlyLCBuZWFyICYmIG5lYXIubGluZSA9PSBwb3MubGluZSA/IGxpbmUgOiBudWxsKTsgfVxuICAgICAgICBpZiAobmVhciAmJiBuZWFyLmxpbmUgPT0gcG9zLmxpbmUgJiYgKGRpZmYgPSBjbXAobmVhciwgb2xkUG9zKSkgJiYgKGRpciA8IDAgPyBkaWZmIDwgMCA6IGRpZmYgPiAwKSlcbiAgICAgICAgICB7IHJldHVybiBza2lwQXRvbWljSW5uZXIoZG9jLCBuZWFyLCBwb3MsIGRpciwgbWF5Q2xlYXIpIH1cbiAgICAgIH1cblxuICAgICAgdmFyIGZhciA9IG0uZmluZChkaXIgPCAwID8gLTEgOiAxKTtcbiAgICAgIGlmIChkaXIgPCAwID8gbS5pbmNsdXNpdmVMZWZ0IDogbS5pbmNsdXNpdmVSaWdodClcbiAgICAgICAgeyBmYXIgPSBtb3ZlUG9zKGRvYywgZmFyLCBkaXIsIGZhci5saW5lID09IHBvcy5saW5lID8gbGluZSA6IG51bGwpOyB9XG4gICAgICByZXR1cm4gZmFyID8gc2tpcEF0b21pY0lubmVyKGRvYywgZmFyLCBwb3MsIGRpciwgbWF5Q2xlYXIpIDogbnVsbFxuICAgIH1cbiAgfSB9XG4gIHJldHVybiBwb3Ncbn1cblxuLy8gRW5zdXJlIGEgZ2l2ZW4gcG9zaXRpb24gaXMgbm90IGluc2lkZSBhbiBhdG9taWMgcmFuZ2UuXG5mdW5jdGlvbiBza2lwQXRvbWljKGRvYywgcG9zLCBvbGRQb3MsIGJpYXMsIG1heUNsZWFyKSB7XG4gIHZhciBkaXIgPSBiaWFzIHx8IDE7XG4gIHZhciBmb3VuZCA9IHNraXBBdG9taWNJbm5lcihkb2MsIHBvcywgb2xkUG9zLCBkaXIsIG1heUNsZWFyKSB8fFxuICAgICAgKCFtYXlDbGVhciAmJiBza2lwQXRvbWljSW5uZXIoZG9jLCBwb3MsIG9sZFBvcywgZGlyLCB0cnVlKSkgfHxcbiAgICAgIHNraXBBdG9taWNJbm5lcihkb2MsIHBvcywgb2xkUG9zLCAtZGlyLCBtYXlDbGVhcikgfHxcbiAgICAgICghbWF5Q2xlYXIgJiYgc2tpcEF0b21pY0lubmVyKGRvYywgcG9zLCBvbGRQb3MsIC1kaXIsIHRydWUpKTtcbiAgaWYgKCFmb3VuZCkge1xuICAgIGRvYy5jYW50RWRpdCA9IHRydWU7XG4gICAgcmV0dXJuIFBvcyhkb2MuZmlyc3QsIDApXG4gIH1cbiAgcmV0dXJuIGZvdW5kXG59XG5cbmZ1bmN0aW9uIG1vdmVQb3MoZG9jLCBwb3MsIGRpciwgbGluZSkge1xuICBpZiAoZGlyIDwgMCAmJiBwb3MuY2ggPT0gMCkge1xuICAgIGlmIChwb3MubGluZSA+IGRvYy5maXJzdCkgeyByZXR1cm4gY2xpcFBvcyhkb2MsIFBvcyhwb3MubGluZSAtIDEpKSB9XG4gICAgZWxzZSB7IHJldHVybiBudWxsIH1cbiAgfSBlbHNlIGlmIChkaXIgPiAwICYmIHBvcy5jaCA9PSAobGluZSB8fCBnZXRMaW5lKGRvYywgcG9zLmxpbmUpKS50ZXh0Lmxlbmd0aCkge1xuICAgIGlmIChwb3MubGluZSA8IGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSkgeyByZXR1cm4gUG9zKHBvcy5saW5lICsgMSwgMCkgfVxuICAgIGVsc2UgeyByZXR1cm4gbnVsbCB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG5ldyBQb3MocG9zLmxpbmUsIHBvcy5jaCArIGRpcilcbiAgfVxufVxuXG5mdW5jdGlvbiBzZWxlY3RBbGwoY20pIHtcbiAgY20uc2V0U2VsZWN0aW9uKFBvcyhjbS5maXJzdExpbmUoKSwgMCksIFBvcyhjbS5sYXN0TGluZSgpKSwgc2VsX2RvbnRTY3JvbGwpO1xufVxuXG4vLyBVUERBVElOR1xuXG4vLyBBbGxvdyBcImJlZm9yZUNoYW5nZVwiIGV2ZW50IGhhbmRsZXJzIHRvIGluZmx1ZW5jZSBhIGNoYW5nZVxuZnVuY3Rpb24gZmlsdGVyQ2hhbmdlKGRvYywgY2hhbmdlLCB1cGRhdGUpIHtcbiAgdmFyIG9iaiA9IHtcbiAgICBjYW5jZWxlZDogZmFsc2UsXG4gICAgZnJvbTogY2hhbmdlLmZyb20sXG4gICAgdG86IGNoYW5nZS50byxcbiAgICB0ZXh0OiBjaGFuZ2UudGV4dCxcbiAgICBvcmlnaW46IGNoYW5nZS5vcmlnaW4sXG4gICAgY2FuY2VsOiBmdW5jdGlvbiAoKSB7IHJldHVybiBvYmouY2FuY2VsZWQgPSB0cnVlOyB9XG4gIH07XG4gIGlmICh1cGRhdGUpIHsgb2JqLnVwZGF0ZSA9IGZ1bmN0aW9uIChmcm9tLCB0bywgdGV4dCwgb3JpZ2luKSB7XG4gICAgaWYgKGZyb20pIHsgb2JqLmZyb20gPSBjbGlwUG9zKGRvYywgZnJvbSk7IH1cbiAgICBpZiAodG8pIHsgb2JqLnRvID0gY2xpcFBvcyhkb2MsIHRvKTsgfVxuICAgIGlmICh0ZXh0KSB7IG9iai50ZXh0ID0gdGV4dDsgfVxuICAgIGlmIChvcmlnaW4gIT09IHVuZGVmaW5lZCkgeyBvYmoub3JpZ2luID0gb3JpZ2luOyB9XG4gIH07IH1cbiAgc2lnbmFsKGRvYywgXCJiZWZvcmVDaGFuZ2VcIiwgZG9jLCBvYmopO1xuICBpZiAoZG9jLmNtKSB7IHNpZ25hbChkb2MuY20sIFwiYmVmb3JlQ2hhbmdlXCIsIGRvYy5jbSwgb2JqKTsgfVxuXG4gIGlmIChvYmouY2FuY2VsZWQpIHsgcmV0dXJuIG51bGwgfVxuICByZXR1cm4ge2Zyb206IG9iai5mcm9tLCB0bzogb2JqLnRvLCB0ZXh0OiBvYmoudGV4dCwgb3JpZ2luOiBvYmoub3JpZ2lufVxufVxuXG4vLyBBcHBseSBhIGNoYW5nZSB0byBhIGRvY3VtZW50LCBhbmQgYWRkIGl0IHRvIHRoZSBkb2N1bWVudCdzXG4vLyBoaXN0b3J5LCBhbmQgcHJvcGFnYXRpbmcgaXQgdG8gYWxsIGxpbmtlZCBkb2N1bWVudHMuXG5mdW5jdGlvbiBtYWtlQ2hhbmdlKGRvYywgY2hhbmdlLCBpZ25vcmVSZWFkT25seSkge1xuICBpZiAoZG9jLmNtKSB7XG4gICAgaWYgKCFkb2MuY20uY3VyT3ApIHsgcmV0dXJuIG9wZXJhdGlvbihkb2MuY20sIG1ha2VDaGFuZ2UpKGRvYywgY2hhbmdlLCBpZ25vcmVSZWFkT25seSkgfVxuICAgIGlmIChkb2MuY20uc3RhdGUuc3VwcHJlc3NFZGl0cykgeyByZXR1cm4gfVxuICB9XG5cbiAgaWYgKGhhc0hhbmRsZXIoZG9jLCBcImJlZm9yZUNoYW5nZVwiKSB8fCBkb2MuY20gJiYgaGFzSGFuZGxlcihkb2MuY20sIFwiYmVmb3JlQ2hhbmdlXCIpKSB7XG4gICAgY2hhbmdlID0gZmlsdGVyQ2hhbmdlKGRvYywgY2hhbmdlLCB0cnVlKTtcbiAgICBpZiAoIWNoYW5nZSkgeyByZXR1cm4gfVxuICB9XG5cbiAgLy8gUG9zc2libHkgc3BsaXQgb3Igc3VwcHJlc3MgdGhlIHVwZGF0ZSBiYXNlZCBvbiB0aGUgcHJlc2VuY2VcbiAgLy8gb2YgcmVhZC1vbmx5IHNwYW5zIGluIGl0cyByYW5nZS5cbiAgdmFyIHNwbGl0ID0gc2F3UmVhZE9ubHlTcGFucyAmJiAhaWdub3JlUmVhZE9ubHkgJiYgcmVtb3ZlUmVhZE9ubHlSYW5nZXMoZG9jLCBjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKTtcbiAgaWYgKHNwbGl0KSB7XG4gICAgZm9yICh2YXIgaSA9IHNwbGl0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKVxuICAgICAgeyBtYWtlQ2hhbmdlSW5uZXIoZG9jLCB7ZnJvbTogc3BsaXRbaV0uZnJvbSwgdG86IHNwbGl0W2ldLnRvLCB0ZXh0OiBpID8gW1wiXCJdIDogY2hhbmdlLnRleHR9KTsgfVxuICB9IGVsc2Uge1xuICAgIG1ha2VDaGFuZ2VJbm5lcihkb2MsIGNoYW5nZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWFrZUNoYW5nZUlubmVyKGRvYywgY2hhbmdlKSB7XG4gIGlmIChjaGFuZ2UudGV4dC5sZW5ndGggPT0gMSAmJiBjaGFuZ2UudGV4dFswXSA9PSBcIlwiICYmIGNtcChjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKSA9PSAwKSB7IHJldHVybiB9XG4gIHZhciBzZWxBZnRlciA9IGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSk7XG4gIGFkZENoYW5nZVRvSGlzdG9yeShkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIGRvYy5jbSA/IGRvYy5jbS5jdXJPcC5pZCA6IE5hTik7XG5cbiAgbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpKTtcbiAgdmFyIHJlYmFzZWQgPSBbXTtcblxuICBsaW5rZWREb2NzKGRvYywgZnVuY3Rpb24gKGRvYywgc2hhcmVkSGlzdCkge1xuICAgIGlmICghc2hhcmVkSGlzdCAmJiBpbmRleE9mKHJlYmFzZWQsIGRvYy5oaXN0b3J5KSA9PSAtMSkge1xuICAgICAgcmViYXNlSGlzdChkb2MuaGlzdG9yeSwgY2hhbmdlKTtcbiAgICAgIHJlYmFzZWQucHVzaChkb2MuaGlzdG9yeSk7XG4gICAgfVxuICAgIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIG51bGwsIHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpKTtcbiAgfSk7XG59XG5cbi8vIFJldmVydCBhIGNoYW5nZSBzdG9yZWQgaW4gYSBkb2N1bWVudCdzIGhpc3RvcnkuXG5mdW5jdGlvbiBtYWtlQ2hhbmdlRnJvbUhpc3RvcnkoZG9jLCB0eXBlLCBhbGxvd1NlbGVjdGlvbk9ubHkpIHtcbiAgaWYgKGRvYy5jbSAmJiBkb2MuY20uc3RhdGUuc3VwcHJlc3NFZGl0cyAmJiAhYWxsb3dTZWxlY3Rpb25Pbmx5KSB7IHJldHVybiB9XG5cbiAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeSwgZXZlbnQsIHNlbEFmdGVyID0gZG9jLnNlbDtcbiAgdmFyIHNvdXJjZSA9IHR5cGUgPT0gXCJ1bmRvXCIgPyBoaXN0LmRvbmUgOiBoaXN0LnVuZG9uZSwgZGVzdCA9IHR5cGUgPT0gXCJ1bmRvXCIgPyBoaXN0LnVuZG9uZSA6IGhpc3QuZG9uZTtcblxuICAvLyBWZXJpZnkgdGhhdCB0aGVyZSBpcyBhIHVzZWFibGUgZXZlbnQgKHNvIHRoYXQgY3RybC16IHdvbid0XG4gIC8vIG5lZWRsZXNzbHkgY2xlYXIgc2VsZWN0aW9uIGV2ZW50cylcbiAgdmFyIGkgPSAwO1xuICBmb3IgKDsgaSA8IHNvdXJjZS5sZW5ndGg7IGkrKykge1xuICAgIGV2ZW50ID0gc291cmNlW2ldO1xuICAgIGlmIChhbGxvd1NlbGVjdGlvbk9ubHkgPyBldmVudC5yYW5nZXMgJiYgIWV2ZW50LmVxdWFscyhkb2Muc2VsKSA6ICFldmVudC5yYW5nZXMpXG4gICAgICB7IGJyZWFrIH1cbiAgfVxuICBpZiAoaSA9PSBzb3VyY2UubGVuZ3RoKSB7IHJldHVybiB9XG4gIGhpc3QubGFzdE9yaWdpbiA9IGhpc3QubGFzdFNlbE9yaWdpbiA9IG51bGw7XG5cbiAgZm9yICg7Oykge1xuICAgIGV2ZW50ID0gc291cmNlLnBvcCgpO1xuICAgIGlmIChldmVudC5yYW5nZXMpIHtcbiAgICAgIHB1c2hTZWxlY3Rpb25Ub0hpc3RvcnkoZXZlbnQsIGRlc3QpO1xuICAgICAgaWYgKGFsbG93U2VsZWN0aW9uT25seSAmJiAhZXZlbnQuZXF1YWxzKGRvYy5zZWwpKSB7XG4gICAgICAgIHNldFNlbGVjdGlvbihkb2MsIGV2ZW50LCB7Y2xlYXJSZWRvOiBmYWxzZX0pO1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIHNlbEFmdGVyID0gZXZlbnQ7XG4gICAgfVxuICAgIGVsc2UgeyBicmVhayB9XG4gIH1cblxuICAvLyBCdWlsZCB1cCBhIHJldmVyc2UgY2hhbmdlIG9iamVjdCB0byBhZGQgdG8gdGhlIG9wcG9zaXRlIGhpc3RvcnlcbiAgLy8gc3RhY2sgKHJlZG8gd2hlbiB1bmRvaW5nLCBhbmQgdmljZSB2ZXJzYSkuXG4gIHZhciBhbnRpQ2hhbmdlcyA9IFtdO1xuICBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KHNlbEFmdGVyLCBkZXN0KTtcbiAgZGVzdC5wdXNoKHtjaGFuZ2VzOiBhbnRpQ2hhbmdlcywgZ2VuZXJhdGlvbjogaGlzdC5nZW5lcmF0aW9ufSk7XG4gIGhpc3QuZ2VuZXJhdGlvbiA9IGV2ZW50LmdlbmVyYXRpb24gfHwgKytoaXN0Lm1heEdlbmVyYXRpb247XG5cbiAgdmFyIGZpbHRlciA9IGhhc0hhbmRsZXIoZG9jLCBcImJlZm9yZUNoYW5nZVwiKSB8fCBkb2MuY20gJiYgaGFzSGFuZGxlcihkb2MuY20sIFwiYmVmb3JlQ2hhbmdlXCIpO1xuXG4gIHZhciBsb29wID0gZnVuY3Rpb24gKCBpICkge1xuICAgIHZhciBjaGFuZ2UgPSBldmVudC5jaGFuZ2VzW2ldO1xuICAgIGNoYW5nZS5vcmlnaW4gPSB0eXBlO1xuICAgIGlmIChmaWx0ZXIgJiYgIWZpbHRlckNoYW5nZShkb2MsIGNoYW5nZSwgZmFsc2UpKSB7XG4gICAgICBzb3VyY2UubGVuZ3RoID0gMDtcbiAgICAgIHJldHVybiB7fVxuICAgIH1cblxuICAgIGFudGlDaGFuZ2VzLnB1c2goaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpKTtcblxuICAgIHZhciBhZnRlciA9IGkgPyBjb21wdXRlU2VsQWZ0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpIDogbHN0KHNvdXJjZSk7XG4gICAgbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgYWZ0ZXIsIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpKTtcbiAgICBpZiAoIWkgJiYgZG9jLmNtKSB7IGRvYy5jbS5zY3JvbGxJbnRvVmlldyh7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBjaGFuZ2VFbmQoY2hhbmdlKX0pOyB9XG4gICAgdmFyIHJlYmFzZWQgPSBbXTtcblxuICAgIC8vIFByb3BhZ2F0ZSB0byB0aGUgbGlua2VkIGRvY3VtZW50c1xuICAgIGxpbmtlZERvY3MoZG9jLCBmdW5jdGlvbiAoZG9jLCBzaGFyZWRIaXN0KSB7XG4gICAgICBpZiAoIXNoYXJlZEhpc3QgJiYgaW5kZXhPZihyZWJhc2VkLCBkb2MuaGlzdG9yeSkgPT0gLTEpIHtcbiAgICAgICAgcmViYXNlSGlzdChkb2MuaGlzdG9yeSwgY2hhbmdlKTtcbiAgICAgICAgcmViYXNlZC5wdXNoKGRvYy5oaXN0b3J5KTtcbiAgICAgIH1cbiAgICAgIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIG51bGwsIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpKTtcbiAgICB9KTtcbiAgfTtcblxuICBmb3IgKHZhciBpJDEgPSBldmVudC5jaGFuZ2VzLmxlbmd0aCAtIDE7IGkkMSA+PSAwOyAtLWkkMSkge1xuICAgIHZhciByZXR1cm5lZCA9IGxvb3AoIGkkMSApO1xuXG4gICAgaWYgKCByZXR1cm5lZCApIHJldHVybiByZXR1cm5lZC52O1xuICB9XG59XG5cbi8vIFN1Yi12aWV3cyBuZWVkIHRoZWlyIGxpbmUgbnVtYmVycyBzaGlmdGVkIHdoZW4gdGV4dCBpcyBhZGRlZFxuLy8gYWJvdmUgb3IgYmVsb3cgdGhlbSBpbiB0aGUgcGFyZW50IGRvY3VtZW50LlxuZnVuY3Rpb24gc2hpZnREb2MoZG9jLCBkaXN0YW5jZSkge1xuICBpZiAoZGlzdGFuY2UgPT0gMCkgeyByZXR1cm4gfVxuICBkb2MuZmlyc3QgKz0gZGlzdGFuY2U7XG4gIGRvYy5zZWwgPSBuZXcgU2VsZWN0aW9uKG1hcChkb2Muc2VsLnJhbmdlcywgZnVuY3Rpb24gKHJhbmdlKSB7IHJldHVybiBuZXcgUmFuZ2UoXG4gICAgUG9zKHJhbmdlLmFuY2hvci5saW5lICsgZGlzdGFuY2UsIHJhbmdlLmFuY2hvci5jaCksXG4gICAgUG9zKHJhbmdlLmhlYWQubGluZSArIGRpc3RhbmNlLCByYW5nZS5oZWFkLmNoKVxuICApOyB9KSwgZG9jLnNlbC5wcmltSW5kZXgpO1xuICBpZiAoZG9jLmNtKSB7XG4gICAgcmVnQ2hhbmdlKGRvYy5jbSwgZG9jLmZpcnN0LCBkb2MuZmlyc3QgLSBkaXN0YW5jZSwgZGlzdGFuY2UpO1xuICAgIGZvciAodmFyIGQgPSBkb2MuY20uZGlzcGxheSwgbCA9IGQudmlld0Zyb207IGwgPCBkLnZpZXdUbzsgbCsrKVxuICAgICAgeyByZWdMaW5lQ2hhbmdlKGRvYy5jbSwgbCwgXCJndXR0ZXJcIik7IH1cbiAgfVxufVxuXG4vLyBNb3JlIGxvd2VyLWxldmVsIGNoYW5nZSBmdW5jdGlvbiwgaGFuZGxpbmcgb25seSBhIHNpbmdsZSBkb2N1bWVudFxuLy8gKG5vdCBsaW5rZWQgb25lcykuXG5mdW5jdGlvbiBtYWtlQ2hhbmdlU2luZ2xlRG9jKGRvYywgY2hhbmdlLCBzZWxBZnRlciwgc3BhbnMpIHtcbiAgaWYgKGRvYy5jbSAmJiAhZG9jLmNtLmN1ck9wKVxuICAgIHsgcmV0dXJuIG9wZXJhdGlvbihkb2MuY20sIG1ha2VDaGFuZ2VTaW5nbGVEb2MpKGRvYywgY2hhbmdlLCBzZWxBZnRlciwgc3BhbnMpIH1cblxuICBpZiAoY2hhbmdlLnRvLmxpbmUgPCBkb2MuZmlyc3QpIHtcbiAgICBzaGlmdERvYyhkb2MsIGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDEgLSAoY2hhbmdlLnRvLmxpbmUgLSBjaGFuZ2UuZnJvbS5saW5lKSk7XG4gICAgcmV0dXJuXG4gIH1cbiAgaWYgKGNoYW5nZS5mcm9tLmxpbmUgPiBkb2MubGFzdExpbmUoKSkgeyByZXR1cm4gfVxuXG4gIC8vIENsaXAgdGhlIGNoYW5nZSB0byB0aGUgc2l6ZSBvZiB0aGlzIGRvY1xuICBpZiAoY2hhbmdlLmZyb20ubGluZSA8IGRvYy5maXJzdCkge1xuICAgIHZhciBzaGlmdCA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDEgLSAoZG9jLmZpcnN0IC0gY2hhbmdlLmZyb20ubGluZSk7XG4gICAgc2hpZnREb2MoZG9jLCBzaGlmdCk7XG4gICAgY2hhbmdlID0ge2Zyb206IFBvcyhkb2MuZmlyc3QsIDApLCB0bzogUG9zKGNoYW5nZS50by5saW5lICsgc2hpZnQsIGNoYW5nZS50by5jaCksXG4gICAgICAgICAgICAgIHRleHQ6IFtsc3QoY2hhbmdlLnRleHQpXSwgb3JpZ2luOiBjaGFuZ2Uub3JpZ2lufTtcbiAgfVxuICB2YXIgbGFzdCA9IGRvYy5sYXN0TGluZSgpO1xuICBpZiAoY2hhbmdlLnRvLmxpbmUgPiBsYXN0KSB7XG4gICAgY2hhbmdlID0ge2Zyb206IGNoYW5nZS5mcm9tLCB0bzogUG9zKGxhc3QsIGdldExpbmUoZG9jLCBsYXN0KS50ZXh0Lmxlbmd0aCksXG4gICAgICAgICAgICAgIHRleHQ6IFtjaGFuZ2UudGV4dFswXV0sIG9yaWdpbjogY2hhbmdlLm9yaWdpbn07XG4gIH1cblxuICBjaGFuZ2UucmVtb3ZlZCA9IGdldEJldHdlZW4oZG9jLCBjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKTtcblxuICBpZiAoIXNlbEFmdGVyKSB7IHNlbEFmdGVyID0gY29tcHV0ZVNlbEFmdGVyQ2hhbmdlKGRvYywgY2hhbmdlKTsgfVxuICBpZiAoZG9jLmNtKSB7IG1ha2VDaGFuZ2VTaW5nbGVEb2NJbkVkaXRvcihkb2MuY20sIGNoYW5nZSwgc3BhbnMpOyB9XG4gIGVsc2UgeyB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIHNwYW5zKTsgfVxuICBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWxBZnRlciwgc2VsX2RvbnRTY3JvbGwpO1xufVxuXG4vLyBIYW5kbGUgdGhlIGludGVyYWN0aW9uIG9mIGEgY2hhbmdlIHRvIGEgZG9jdW1lbnQgd2l0aCB0aGUgZWRpdG9yXG4vLyB0aGF0IHRoaXMgZG9jdW1lbnQgaXMgcGFydCBvZi5cbmZ1bmN0aW9uIG1ha2VDaGFuZ2VTaW5nbGVEb2NJbkVkaXRvcihjbSwgY2hhbmdlLCBzcGFucykge1xuICB2YXIgZG9jID0gY20uZG9jLCBkaXNwbGF5ID0gY20uZGlzcGxheSwgZnJvbSA9IGNoYW5nZS5mcm9tLCB0byA9IGNoYW5nZS50bztcblxuICB2YXIgcmVjb21wdXRlTWF4TGVuZ3RoID0gZmFsc2UsIGNoZWNrV2lkdGhTdGFydCA9IGZyb20ubGluZTtcbiAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgIGNoZWNrV2lkdGhTdGFydCA9IGxpbmVObyh2aXN1YWxMaW5lKGdldExpbmUoZG9jLCBmcm9tLmxpbmUpKSk7XG4gICAgZG9jLml0ZXIoY2hlY2tXaWR0aFN0YXJ0LCB0by5saW5lICsgMSwgZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgIGlmIChsaW5lID09IGRpc3BsYXkubWF4TGluZSkge1xuICAgICAgICByZWNvbXB1dGVNYXhMZW5ndGggPSB0cnVlO1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKGRvYy5zZWwuY29udGFpbnMoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPiAtMSlcbiAgICB7IHNpZ25hbEN1cnNvckFjdGl2aXR5KGNtKTsgfVxuXG4gIHVwZGF0ZURvYyhkb2MsIGNoYW5nZSwgc3BhbnMsIGVzdGltYXRlSGVpZ2h0KGNtKSk7XG5cbiAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgIGRvYy5pdGVyKGNoZWNrV2lkdGhTdGFydCwgZnJvbS5saW5lICsgY2hhbmdlLnRleHQubGVuZ3RoLCBmdW5jdGlvbiAobGluZSkge1xuICAgICAgdmFyIGxlbiA9IGxpbmVMZW5ndGgobGluZSk7XG4gICAgICBpZiAobGVuID4gZGlzcGxheS5tYXhMaW5lTGVuZ3RoKSB7XG4gICAgICAgIGRpc3BsYXkubWF4TGluZSA9IGxpbmU7XG4gICAgICAgIGRpc3BsYXkubWF4TGluZUxlbmd0aCA9IGxlbjtcbiAgICAgICAgZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgIHJlY29tcHV0ZU1heExlbmd0aCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChyZWNvbXB1dGVNYXhMZW5ndGgpIHsgY20uY3VyT3AudXBkYXRlTWF4TGluZSA9IHRydWU7IH1cbiAgfVxuXG4gIC8vIEFkanVzdCBmcm9udGllciwgc2NoZWR1bGUgd29ya2VyXG4gIGRvYy5mcm9udGllciA9IE1hdGgubWluKGRvYy5mcm9udGllciwgZnJvbS5saW5lKTtcbiAgc3RhcnRXb3JrZXIoY20sIDQwMCk7XG5cbiAgdmFyIGxlbmRpZmYgPSBjaGFuZ2UudGV4dC5sZW5ndGggLSAodG8ubGluZSAtIGZyb20ubGluZSkgLSAxO1xuICAvLyBSZW1lbWJlciB0aGF0IHRoZXNlIGxpbmVzIGNoYW5nZWQsIGZvciB1cGRhdGluZyB0aGUgZGlzcGxheVxuICBpZiAoY2hhbmdlLmZ1bGwpXG4gICAgeyByZWdDaGFuZ2UoY20pOyB9XG4gIGVsc2UgaWYgKGZyb20ubGluZSA9PSB0by5saW5lICYmIGNoYW5nZS50ZXh0Lmxlbmd0aCA9PSAxICYmICFpc1dob2xlTGluZVVwZGF0ZShjbS5kb2MsIGNoYW5nZSkpXG4gICAgeyByZWdMaW5lQ2hhbmdlKGNtLCBmcm9tLmxpbmUsIFwidGV4dFwiKTsgfVxuICBlbHNlXG4gICAgeyByZWdDaGFuZ2UoY20sIGZyb20ubGluZSwgdG8ubGluZSArIDEsIGxlbmRpZmYpOyB9XG5cbiAgdmFyIGNoYW5nZXNIYW5kbGVyID0gaGFzSGFuZGxlcihjbSwgXCJjaGFuZ2VzXCIpLCBjaGFuZ2VIYW5kbGVyID0gaGFzSGFuZGxlcihjbSwgXCJjaGFuZ2VcIik7XG4gIGlmIChjaGFuZ2VIYW5kbGVyIHx8IGNoYW5nZXNIYW5kbGVyKSB7XG4gICAgdmFyIG9iaiA9IHtcbiAgICAgIGZyb206IGZyb20sIHRvOiB0byxcbiAgICAgIHRleHQ6IGNoYW5nZS50ZXh0LFxuICAgICAgcmVtb3ZlZDogY2hhbmdlLnJlbW92ZWQsXG4gICAgICBvcmlnaW46IGNoYW5nZS5vcmlnaW5cbiAgICB9O1xuICAgIGlmIChjaGFuZ2VIYW5kbGVyKSB7IHNpZ25hbExhdGVyKGNtLCBcImNoYW5nZVwiLCBjbSwgb2JqKTsgfVxuICAgIGlmIChjaGFuZ2VzSGFuZGxlcikgeyAoY20uY3VyT3AuY2hhbmdlT2JqcyB8fCAoY20uY3VyT3AuY2hhbmdlT2JqcyA9IFtdKSkucHVzaChvYmopOyB9XG4gIH1cbiAgY20uZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSA9IG51bGw7XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VSYW5nZShkb2MsIGNvZGUsIGZyb20sIHRvLCBvcmlnaW4pIHtcbiAgaWYgKCF0bykgeyB0byA9IGZyb207IH1cbiAgaWYgKGNtcCh0bywgZnJvbSkgPCAwKSB7IHZhciB0bXAgPSB0bzsgdG8gPSBmcm9tOyBmcm9tID0gdG1wOyB9XG4gIGlmICh0eXBlb2YgY29kZSA9PSBcInN0cmluZ1wiKSB7IGNvZGUgPSBkb2Muc3BsaXRMaW5lcyhjb2RlKTsgfVxuICBtYWtlQ2hhbmdlKGRvYywge2Zyb206IGZyb20sIHRvOiB0bywgdGV4dDogY29kZSwgb3JpZ2luOiBvcmlnaW59KTtcbn1cblxuLy8gUmViYXNpbmcvcmVzZXR0aW5nIGhpc3RvcnkgdG8gZGVhbCB3aXRoIGV4dGVybmFsbHktc291cmNlZCBjaGFuZ2VzXG5cbmZ1bmN0aW9uIHJlYmFzZUhpc3RTZWxTaW5nbGUocG9zLCBmcm9tLCB0bywgZGlmZikge1xuICBpZiAodG8gPCBwb3MubGluZSkge1xuICAgIHBvcy5saW5lICs9IGRpZmY7XG4gIH0gZWxzZSBpZiAoZnJvbSA8IHBvcy5saW5lKSB7XG4gICAgcG9zLmxpbmUgPSBmcm9tO1xuICAgIHBvcy5jaCA9IDA7XG4gIH1cbn1cblxuLy8gVHJpZXMgdG8gcmViYXNlIGFuIGFycmF5IG9mIGhpc3RvcnkgZXZlbnRzIGdpdmVuIGEgY2hhbmdlIGluIHRoZVxuLy8gZG9jdW1lbnQuIElmIHRoZSBjaGFuZ2UgdG91Y2hlcyB0aGUgc2FtZSBsaW5lcyBhcyB0aGUgZXZlbnQsIHRoZVxuLy8gZXZlbnQsIGFuZCBldmVyeXRoaW5nICdiZWhpbmQnIGl0LCBpcyBkaXNjYXJkZWQuIElmIHRoZSBjaGFuZ2UgaXNcbi8vIGJlZm9yZSB0aGUgZXZlbnQsIHRoZSBldmVudCdzIHBvc2l0aW9ucyBhcmUgdXBkYXRlZC4gVXNlcyBhXG4vLyBjb3B5LW9uLXdyaXRlIHNjaGVtZSBmb3IgdGhlIHBvc2l0aW9ucywgdG8gYXZvaWQgaGF2aW5nIHRvXG4vLyByZWFsbG9jYXRlIHRoZW0gYWxsIG9uIGV2ZXJ5IHJlYmFzZSwgYnV0IGFsc28gYXZvaWQgcHJvYmxlbXMgd2l0aFxuLy8gc2hhcmVkIHBvc2l0aW9uIG9iamVjdHMgYmVpbmcgdW5zYWZlbHkgdXBkYXRlZC5cbmZ1bmN0aW9uIHJlYmFzZUhpc3RBcnJheShhcnJheSwgZnJvbSwgdG8sIGRpZmYpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7ICsraSkge1xuICAgIHZhciBzdWIgPSBhcnJheVtpXSwgb2sgPSB0cnVlO1xuICAgIGlmIChzdWIucmFuZ2VzKSB7XG4gICAgICBpZiAoIXN1Yi5jb3BpZWQpIHsgc3ViID0gYXJyYXlbaV0gPSBzdWIuZGVlcENvcHkoKTsgc3ViLmNvcGllZCA9IHRydWU7IH1cbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3ViLnJhbmdlcy5sZW5ndGg7IGorKykge1xuICAgICAgICByZWJhc2VIaXN0U2VsU2luZ2xlKHN1Yi5yYW5nZXNbal0uYW5jaG9yLCBmcm9tLCB0bywgZGlmZik7XG4gICAgICAgIHJlYmFzZUhpc3RTZWxTaW5nbGUoc3ViLnJhbmdlc1tqXS5oZWFkLCBmcm9tLCB0bywgZGlmZik7XG4gICAgICB9XG4gICAgICBjb250aW51ZVxuICAgIH1cbiAgICBmb3IgKHZhciBqJDEgPSAwOyBqJDEgPCBzdWIuY2hhbmdlcy5sZW5ndGg7ICsraiQxKSB7XG4gICAgICB2YXIgY3VyID0gc3ViLmNoYW5nZXNbaiQxXTtcbiAgICAgIGlmICh0byA8IGN1ci5mcm9tLmxpbmUpIHtcbiAgICAgICAgY3VyLmZyb20gPSBQb3MoY3VyLmZyb20ubGluZSArIGRpZmYsIGN1ci5mcm9tLmNoKTtcbiAgICAgICAgY3VyLnRvID0gUG9zKGN1ci50by5saW5lICsgZGlmZiwgY3VyLnRvLmNoKTtcbiAgICAgIH0gZWxzZSBpZiAoZnJvbSA8PSBjdXIudG8ubGluZSkge1xuICAgICAgICBvayA9IGZhbHNlO1xuICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW9rKSB7XG4gICAgICBhcnJheS5zcGxpY2UoMCwgaSArIDEpO1xuICAgICAgaSA9IDA7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlYmFzZUhpc3QoaGlzdCwgY2hhbmdlKSB7XG4gIHZhciBmcm9tID0gY2hhbmdlLmZyb20ubGluZSwgdG8gPSBjaGFuZ2UudG8ubGluZSwgZGlmZiA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtICh0byAtIGZyb20pIC0gMTtcbiAgcmViYXNlSGlzdEFycmF5KGhpc3QuZG9uZSwgZnJvbSwgdG8sIGRpZmYpO1xuICByZWJhc2VIaXN0QXJyYXkoaGlzdC51bmRvbmUsIGZyb20sIHRvLCBkaWZmKTtcbn1cblxuLy8gVXRpbGl0eSBmb3IgYXBwbHlpbmcgYSBjaGFuZ2UgdG8gYSBsaW5lIGJ5IGhhbmRsZSBvciBudW1iZXIsXG4vLyByZXR1cm5pbmcgdGhlIG51bWJlciBhbmQgb3B0aW9uYWxseSByZWdpc3RlcmluZyB0aGUgbGluZSBhc1xuLy8gY2hhbmdlZC5cbmZ1bmN0aW9uIGNoYW5nZUxpbmUoZG9jLCBoYW5kbGUsIGNoYW5nZVR5cGUsIG9wKSB7XG4gIHZhciBubyA9IGhhbmRsZSwgbGluZSA9IGhhbmRsZTtcbiAgaWYgKHR5cGVvZiBoYW5kbGUgPT0gXCJudW1iZXJcIikgeyBsaW5lID0gZ2V0TGluZShkb2MsIGNsaXBMaW5lKGRvYywgaGFuZGxlKSk7IH1cbiAgZWxzZSB7IG5vID0gbGluZU5vKGhhbmRsZSk7IH1cbiAgaWYgKG5vID09IG51bGwpIHsgcmV0dXJuIG51bGwgfVxuICBpZiAob3AobGluZSwgbm8pICYmIGRvYy5jbSkgeyByZWdMaW5lQ2hhbmdlKGRvYy5jbSwgbm8sIGNoYW5nZVR5cGUpOyB9XG4gIHJldHVybiBsaW5lXG59XG5cbi8vIFRoZSBkb2N1bWVudCBpcyByZXByZXNlbnRlZCBhcyBhIEJUcmVlIGNvbnNpc3Rpbmcgb2YgbGVhdmVzLCB3aXRoXG4vLyBjaHVuayBvZiBsaW5lcyBpbiB0aGVtLCBhbmQgYnJhbmNoZXMsIHdpdGggdXAgdG8gdGVuIGxlYXZlcyBvclxuLy8gb3RoZXIgYnJhbmNoIG5vZGVzIGJlbG93IHRoZW0uIFRoZSB0b3Agbm9kZSBpcyBhbHdheXMgYSBicmFuY2hcbi8vIG5vZGUsIGFuZCBpcyB0aGUgZG9jdW1lbnQgb2JqZWN0IGl0c2VsZiAobWVhbmluZyBpdCBoYXNcbi8vIGFkZGl0aW9uYWwgbWV0aG9kcyBhbmQgcHJvcGVydGllcykuXG4vL1xuLy8gQWxsIG5vZGVzIGhhdmUgcGFyZW50IGxpbmtzLiBUaGUgdHJlZSBpcyB1c2VkIGJvdGggdG8gZ28gZnJvbVxuLy8gbGluZSBudW1iZXJzIHRvIGxpbmUgb2JqZWN0cywgYW5kIHRvIGdvIGZyb20gb2JqZWN0cyB0byBudW1iZXJzLlxuLy8gSXQgYWxzbyBpbmRleGVzIGJ5IGhlaWdodCwgYW5kIGlzIHVzZWQgdG8gY29udmVydCBiZXR3ZWVuIGhlaWdodFxuLy8gYW5kIGxpbmUgb2JqZWN0LCBhbmQgdG8gZmluZCB0aGUgdG90YWwgaGVpZ2h0IG9mIHRoZSBkb2N1bWVudC5cbi8vXG4vLyBTZWUgYWxzbyBodHRwOi8vbWFyaWpuaGF2ZXJiZWtlLm5sL2Jsb2cvY29kZW1pcnJvci1saW5lLXRyZWUuaHRtbFxuXG52YXIgTGVhZkNodW5rID0gZnVuY3Rpb24obGluZXMpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdGhpcy5saW5lcyA9IGxpbmVzO1xuICB0aGlzLnBhcmVudCA9IG51bGw7XG4gIHZhciBoZWlnaHQgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgKytpKSB7XG4gICAgbGluZXNbaV0ucGFyZW50ID0gdGhpcyQxO1xuICAgIGhlaWdodCArPSBsaW5lc1tpXS5oZWlnaHQ7XG4gIH1cbiAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG59O1xuXG5MZWFmQ2h1bmsucHJvdG90eXBlLmNodW5rU2l6ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMubGluZXMubGVuZ3RoIH07XG5cbi8vIFJlbW92ZSB0aGUgbiBsaW5lcyBhdCBvZmZzZXQgJ2F0Jy5cbkxlYWZDaHVuay5wcm90b3R5cGUucmVtb3ZlSW5uZXIgPSBmdW5jdGlvbiAoYXQsIG4pIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBmb3IgKHZhciBpID0gYXQsIGUgPSBhdCArIG47IGkgPCBlOyArK2kpIHtcbiAgICB2YXIgbGluZSA9IHRoaXMkMS5saW5lc1tpXTtcbiAgICB0aGlzJDEuaGVpZ2h0IC09IGxpbmUuaGVpZ2h0O1xuICAgIGNsZWFuVXBMaW5lKGxpbmUpO1xuICAgIHNpZ25hbExhdGVyKGxpbmUsIFwiZGVsZXRlXCIpO1xuICB9XG4gIHRoaXMubGluZXMuc3BsaWNlKGF0LCBuKTtcbn07XG5cbi8vIEhlbHBlciB1c2VkIHRvIGNvbGxhcHNlIGEgc21hbGwgYnJhbmNoIGludG8gYSBzaW5nbGUgbGVhZi5cbkxlYWZDaHVuay5wcm90b3R5cGUuY29sbGFwc2UgPSBmdW5jdGlvbiAobGluZXMpIHtcbiAgbGluZXMucHVzaC5hcHBseShsaW5lcywgdGhpcy5saW5lcyk7XG59O1xuXG4vLyBJbnNlcnQgdGhlIGdpdmVuIGFycmF5IG9mIGxpbmVzIGF0IG9mZnNldCAnYXQnLCBjb3VudCB0aGVtIGFzXG4vLyBoYXZpbmcgdGhlIGdpdmVuIGhlaWdodC5cbkxlYWZDaHVuay5wcm90b3R5cGUuaW5zZXJ0SW5uZXIgPSBmdW5jdGlvbiAoYXQsIGxpbmVzLCBoZWlnaHQpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICB0aGlzLmhlaWdodCArPSBoZWlnaHQ7XG4gIHRoaXMubGluZXMgPSB0aGlzLmxpbmVzLnNsaWNlKDAsIGF0KS5jb25jYXQobGluZXMpLmNvbmNhdCh0aGlzLmxpbmVzLnNsaWNlKGF0KSk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyArK2kpIHsgbGluZXNbaV0ucGFyZW50ID0gdGhpcyQxOyB9XG59O1xuXG4vLyBVc2VkIHRvIGl0ZXJhdGUgb3ZlciBhIHBhcnQgb2YgdGhlIHRyZWUuXG5MZWFmQ2h1bmsucHJvdG90eXBlLml0ZXJOID0gZnVuY3Rpb24gKGF0LCBuLCBvcCkge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGZvciAodmFyIGUgPSBhdCArIG47IGF0IDwgZTsgKythdClcbiAgICB7IGlmIChvcCh0aGlzJDEubGluZXNbYXRdKSkgeyByZXR1cm4gdHJ1ZSB9IH1cbn07XG5cbnZhciBCcmFuY2hDaHVuayA9IGZ1bmN0aW9uKGNoaWxkcmVuKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjtcbiAgdmFyIHNpemUgPSAwLCBoZWlnaHQgPSAwO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGNoID0gY2hpbGRyZW5baV07XG4gICAgc2l6ZSArPSBjaC5jaHVua1NpemUoKTsgaGVpZ2h0ICs9IGNoLmhlaWdodDtcbiAgICBjaC5wYXJlbnQgPSB0aGlzJDE7XG4gIH1cbiAgdGhpcy5zaXplID0gc2l6ZTtcbiAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gIHRoaXMucGFyZW50ID0gbnVsbDtcbn07XG5cbkJyYW5jaENodW5rLnByb3RvdHlwZS5jaHVua1NpemUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnNpemUgfTtcblxuQnJhbmNoQ2h1bmsucHJvdG90eXBlLnJlbW92ZUlubmVyID0gZnVuY3Rpb24gKGF0LCBuKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdGhpcy5zaXplIC09IG47XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgIHZhciBjaGlsZCA9IHRoaXMkMS5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICBpZiAoYXQgPCBzeikge1xuICAgICAgdmFyIHJtID0gTWF0aC5taW4obiwgc3ogLSBhdCksIG9sZEhlaWdodCA9IGNoaWxkLmhlaWdodDtcbiAgICAgIGNoaWxkLnJlbW92ZUlubmVyKGF0LCBybSk7XG4gICAgICB0aGlzJDEuaGVpZ2h0IC09IG9sZEhlaWdodCAtIGNoaWxkLmhlaWdodDtcbiAgICAgIGlmIChzeiA9PSBybSkgeyB0aGlzJDEuY2hpbGRyZW4uc3BsaWNlKGktLSwgMSk7IGNoaWxkLnBhcmVudCA9IG51bGw7IH1cbiAgICAgIGlmICgobiAtPSBybSkgPT0gMCkgeyBicmVhayB9XG4gICAgICBhdCA9IDA7XG4gICAgfSBlbHNlIHsgYXQgLT0gc3o7IH1cbiAgfVxuICAvLyBJZiB0aGUgcmVzdWx0IGlzIHNtYWxsZXIgdGhhbiAyNSBsaW5lcywgZW5zdXJlIHRoYXQgaXQgaXMgYVxuICAvLyBzaW5nbGUgbGVhZiBub2RlLlxuICBpZiAodGhpcy5zaXplIC0gbiA8IDI1ICYmXG4gICAgICAodGhpcy5jaGlsZHJlbi5sZW5ndGggPiAxIHx8ICEodGhpcy5jaGlsZHJlblswXSBpbnN0YW5jZW9mIExlYWZDaHVuaykpKSB7XG4gICAgdmFyIGxpbmVzID0gW107XG4gICAgdGhpcy5jb2xsYXBzZShsaW5lcyk7XG4gICAgdGhpcy5jaGlsZHJlbiA9IFtuZXcgTGVhZkNodW5rKGxpbmVzKV07XG4gICAgdGhpcy5jaGlsZHJlblswXS5wYXJlbnQgPSB0aGlzO1xuICB9XG59O1xuXG5CcmFuY2hDaHVuay5wcm90b3R5cGUuY29sbGFwc2UgPSBmdW5jdGlvbiAobGluZXMpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsgdGhpcyQxLmNoaWxkcmVuW2ldLmNvbGxhcHNlKGxpbmVzKTsgfVxufTtcblxuQnJhbmNoQ2h1bmsucHJvdG90eXBlLmluc2VydElubmVyID0gZnVuY3Rpb24gKGF0LCBsaW5lcywgaGVpZ2h0KSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdGhpcy5zaXplICs9IGxpbmVzLmxlbmd0aDtcbiAgdGhpcy5oZWlnaHQgKz0gaGVpZ2h0O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgY2hpbGQgPSB0aGlzJDEuY2hpbGRyZW5baV0sIHN6ID0gY2hpbGQuY2h1bmtTaXplKCk7XG4gICAgaWYgKGF0IDw9IHN6KSB7XG4gICAgICBjaGlsZC5pbnNlcnRJbm5lcihhdCwgbGluZXMsIGhlaWdodCk7XG4gICAgICBpZiAoY2hpbGQubGluZXMgJiYgY2hpbGQubGluZXMubGVuZ3RoID4gNTApIHtcbiAgICAgICAgLy8gVG8gYXZvaWQgbWVtb3J5IHRocmFzaGluZyB3aGVuIGNoaWxkLmxpbmVzIGlzIGh1Z2UgKGUuZy4gZmlyc3QgdmlldyBvZiBhIGxhcmdlIGZpbGUpLCBpdCdzIG5ldmVyIHNwbGljZWQuXG4gICAgICAgIC8vIEluc3RlYWQsIHNtYWxsIHNsaWNlcyBhcmUgdGFrZW4uIFRoZXkncmUgdGFrZW4gaW4gb3JkZXIgYmVjYXVzZSBzZXF1ZW50aWFsIG1lbW9yeSBhY2Nlc3NlcyBhcmUgZmFzdGVzdC5cbiAgICAgICAgdmFyIHJlbWFpbmluZyA9IGNoaWxkLmxpbmVzLmxlbmd0aCAlIDI1ICsgMjU7XG4gICAgICAgIGZvciAodmFyIHBvcyA9IHJlbWFpbmluZzsgcG9zIDwgY2hpbGQubGluZXMubGVuZ3RoOykge1xuICAgICAgICAgIHZhciBsZWFmID0gbmV3IExlYWZDaHVuayhjaGlsZC5saW5lcy5zbGljZShwb3MsIHBvcyArPSAyNSkpO1xuICAgICAgICAgIGNoaWxkLmhlaWdodCAtPSBsZWFmLmhlaWdodDtcbiAgICAgICAgICB0aGlzJDEuY2hpbGRyZW4uc3BsaWNlKCsraSwgMCwgbGVhZik7XG4gICAgICAgICAgbGVhZi5wYXJlbnQgPSB0aGlzJDE7XG4gICAgICAgIH1cbiAgICAgICAgY2hpbGQubGluZXMgPSBjaGlsZC5saW5lcy5zbGljZSgwLCByZW1haW5pbmcpO1xuICAgICAgICB0aGlzJDEubWF5YmVTcGlsbCgpO1xuICAgICAgfVxuICAgICAgYnJlYWtcbiAgICB9XG4gICAgYXQgLT0gc3o7XG4gIH1cbn07XG5cbi8vIFdoZW4gYSBub2RlIGhhcyBncm93biwgY2hlY2sgd2hldGhlciBpdCBzaG91bGQgYmUgc3BsaXQuXG5CcmFuY2hDaHVuay5wcm90b3R5cGUubWF5YmVTcGlsbCA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoIDw9IDEwKSB7IHJldHVybiB9XG4gIHZhciBtZSA9IHRoaXM7XG4gIGRvIHtcbiAgICB2YXIgc3BpbGxlZCA9IG1lLmNoaWxkcmVuLnNwbGljZShtZS5jaGlsZHJlbi5sZW5ndGggLSA1LCA1KTtcbiAgICB2YXIgc2libGluZyA9IG5ldyBCcmFuY2hDaHVuayhzcGlsbGVkKTtcbiAgICBpZiAoIW1lLnBhcmVudCkgeyAvLyBCZWNvbWUgdGhlIHBhcmVudCBub2RlXG4gICAgICB2YXIgY29weSA9IG5ldyBCcmFuY2hDaHVuayhtZS5jaGlsZHJlbik7XG4gICAgICBjb3B5LnBhcmVudCA9IG1lO1xuICAgICAgbWUuY2hpbGRyZW4gPSBbY29weSwgc2libGluZ107XG4gICAgICBtZSA9IGNvcHk7XG4gICB9IGVsc2Uge1xuICAgICAgbWUuc2l6ZSAtPSBzaWJsaW5nLnNpemU7XG4gICAgICBtZS5oZWlnaHQgLT0gc2libGluZy5oZWlnaHQ7XG4gICAgICB2YXIgbXlJbmRleCA9IGluZGV4T2YobWUucGFyZW50LmNoaWxkcmVuLCBtZSk7XG4gICAgICBtZS5wYXJlbnQuY2hpbGRyZW4uc3BsaWNlKG15SW5kZXggKyAxLCAwLCBzaWJsaW5nKTtcbiAgICB9XG4gICAgc2libGluZy5wYXJlbnQgPSBtZS5wYXJlbnQ7XG4gIH0gd2hpbGUgKG1lLmNoaWxkcmVuLmxlbmd0aCA+IDEwKVxuICBtZS5wYXJlbnQubWF5YmVTcGlsbCgpO1xufTtcblxuQnJhbmNoQ2h1bmsucHJvdG90eXBlLml0ZXJOID0gZnVuY3Rpb24gKGF0LCBuLCBvcCkge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgIHZhciBjaGlsZCA9IHRoaXMkMS5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICBpZiAoYXQgPCBzeikge1xuICAgICAgdmFyIHVzZWQgPSBNYXRoLm1pbihuLCBzeiAtIGF0KTtcbiAgICAgIGlmIChjaGlsZC5pdGVyTihhdCwgdXNlZCwgb3ApKSB7IHJldHVybiB0cnVlIH1cbiAgICAgIGlmICgobiAtPSB1c2VkKSA9PSAwKSB7IGJyZWFrIH1cbiAgICAgIGF0ID0gMDtcbiAgICB9IGVsc2UgeyBhdCAtPSBzejsgfVxuICB9XG59O1xuXG4vLyBMaW5lIHdpZGdldHMgYXJlIGJsb2NrIGVsZW1lbnRzIGRpc3BsYXllZCBhYm92ZSBvciBiZWxvdyBhIGxpbmUuXG5cbnZhciBMaW5lV2lkZ2V0ID0gZnVuY3Rpb24oZG9jLCBub2RlLCBvcHRpb25zKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGlmIChvcHRpb25zKSB7IGZvciAodmFyIG9wdCBpbiBvcHRpb25zKSB7IGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KG9wdCkpXG4gICAgeyB0aGlzJDFbb3B0XSA9IG9wdGlvbnNbb3B0XTsgfSB9IH1cbiAgdGhpcy5kb2MgPSBkb2M7XG4gIHRoaXMubm9kZSA9IG5vZGU7XG59O1xuXG5MaW5lV2lkZ2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICB2YXIgY20gPSB0aGlzLmRvYy5jbSwgd3MgPSB0aGlzLmxpbmUud2lkZ2V0cywgbGluZSA9IHRoaXMubGluZSwgbm8gPSBsaW5lTm8obGluZSk7XG4gIGlmIChubyA9PSBudWxsIHx8ICF3cykgeyByZXR1cm4gfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IHdzLmxlbmd0aDsgKytpKSB7IGlmICh3c1tpXSA9PSB0aGlzJDEpIHsgd3Muc3BsaWNlKGktLSwgMSk7IH0gfVxuICBpZiAoIXdzLmxlbmd0aCkgeyBsaW5lLndpZGdldHMgPSBudWxsOyB9XG4gIHZhciBoZWlnaHQgPSB3aWRnZXRIZWlnaHQodGhpcyk7XG4gIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgTWF0aC5tYXgoMCwgbGluZS5oZWlnaHQgLSBoZWlnaHQpKTtcbiAgaWYgKGNtKSB7XG4gICAgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkge1xuICAgICAgYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgLWhlaWdodCk7XG4gICAgICByZWdMaW5lQ2hhbmdlKGNtLCBubywgXCJ3aWRnZXRcIik7XG4gICAgfSk7XG4gICAgc2lnbmFsTGF0ZXIoY20sIFwibGluZVdpZGdldENsZWFyZWRcIiwgY20sIHRoaXMsIG5vKTtcbiAgfVxufTtcblxuTGluZVdpZGdldC5wcm90b3R5cGUuY2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICB2YXIgb2xkSCA9IHRoaXMuaGVpZ2h0LCBjbSA9IHRoaXMuZG9jLmNtLCBsaW5lID0gdGhpcy5saW5lO1xuICB0aGlzLmhlaWdodCA9IG51bGw7XG4gIHZhciBkaWZmID0gd2lkZ2V0SGVpZ2h0KHRoaXMpIC0gb2xkSDtcbiAgaWYgKCFkaWZmKSB7IHJldHVybiB9XG4gIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgbGluZS5oZWlnaHQgKyBkaWZmKTtcbiAgaWYgKGNtKSB7XG4gICAgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkge1xuICAgICAgY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgZGlmZik7XG4gICAgICBzaWduYWxMYXRlcihjbSwgXCJsaW5lV2lkZ2V0Q2hhbmdlZFwiLCBjbSwgdGhpcyQxLCBsaW5lTm8obGluZSkpO1xuICAgIH0pO1xuICB9XG59O1xuZXZlbnRNaXhpbihMaW5lV2lkZ2V0KTtcblxuZnVuY3Rpb24gYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgZGlmZikge1xuICBpZiAoaGVpZ2h0QXRMaW5lKGxpbmUpIDwgKChjbS5jdXJPcCAmJiBjbS5jdXJPcC5zY3JvbGxUb3ApIHx8IGNtLmRvYy5zY3JvbGxUb3ApKVxuICAgIHsgYWRkVG9TY3JvbGxUb3AoY20sIGRpZmYpOyB9XG59XG5cbmZ1bmN0aW9uIGFkZExpbmVXaWRnZXQoZG9jLCBoYW5kbGUsIG5vZGUsIG9wdGlvbnMpIHtcbiAgdmFyIHdpZGdldCA9IG5ldyBMaW5lV2lkZ2V0KGRvYywgbm9kZSwgb3B0aW9ucyk7XG4gIHZhciBjbSA9IGRvYy5jbTtcbiAgaWYgKGNtICYmIHdpZGdldC5ub0hTY3JvbGwpIHsgY20uZGlzcGxheS5hbGlnbldpZGdldHMgPSB0cnVlOyB9XG4gIGNoYW5nZUxpbmUoZG9jLCBoYW5kbGUsIFwid2lkZ2V0XCIsIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgdmFyIHdpZGdldHMgPSBsaW5lLndpZGdldHMgfHwgKGxpbmUud2lkZ2V0cyA9IFtdKTtcbiAgICBpZiAod2lkZ2V0Lmluc2VydEF0ID09IG51bGwpIHsgd2lkZ2V0cy5wdXNoKHdpZGdldCk7IH1cbiAgICBlbHNlIHsgd2lkZ2V0cy5zcGxpY2UoTWF0aC5taW4od2lkZ2V0cy5sZW5ndGggLSAxLCBNYXRoLm1heCgwLCB3aWRnZXQuaW5zZXJ0QXQpKSwgMCwgd2lkZ2V0KTsgfVxuICAgIHdpZGdldC5saW5lID0gbGluZTtcbiAgICBpZiAoY20gJiYgIWxpbmVJc0hpZGRlbihkb2MsIGxpbmUpKSB7XG4gICAgICB2YXIgYWJvdmVWaXNpYmxlID0gaGVpZ2h0QXRMaW5lKGxpbmUpIDwgZG9jLnNjcm9sbFRvcDtcbiAgICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgbGluZS5oZWlnaHQgKyB3aWRnZXRIZWlnaHQod2lkZ2V0KSk7XG4gICAgICBpZiAoYWJvdmVWaXNpYmxlKSB7IGFkZFRvU2Nyb2xsVG9wKGNtLCB3aWRnZXQuaGVpZ2h0KTsgfVxuICAgICAgY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZVxuICB9KTtcbiAgc2lnbmFsTGF0ZXIoY20sIFwibGluZVdpZGdldEFkZGVkXCIsIGNtLCB3aWRnZXQsIHR5cGVvZiBoYW5kbGUgPT0gXCJudW1iZXJcIiA/IGhhbmRsZSA6IGxpbmVObyhoYW5kbGUpKTtcbiAgcmV0dXJuIHdpZGdldFxufVxuXG4vLyBURVhUTUFSS0VSU1xuXG4vLyBDcmVhdGVkIHdpdGggbWFya1RleHQgYW5kIHNldEJvb2ttYXJrIG1ldGhvZHMuIEEgVGV4dE1hcmtlciBpcyBhXG4vLyBoYW5kbGUgdGhhdCBjYW4gYmUgdXNlZCB0byBjbGVhciBvciBmaW5kIGEgbWFya2VkIHBvc2l0aW9uIGluIHRoZVxuLy8gZG9jdW1lbnQuIExpbmUgb2JqZWN0cyBob2xkIGFycmF5cyAobWFya2VkU3BhbnMpIGNvbnRhaW5pbmdcbi8vIHtmcm9tLCB0bywgbWFya2VyfSBvYmplY3QgcG9pbnRpbmcgdG8gc3VjaCBtYXJrZXIgb2JqZWN0cywgYW5kXG4vLyBpbmRpY2F0aW5nIHRoYXQgc3VjaCBhIG1hcmtlciBpcyBwcmVzZW50IG9uIHRoYXQgbGluZS4gTXVsdGlwbGVcbi8vIGxpbmVzIG1heSBwb2ludCB0byB0aGUgc2FtZSBtYXJrZXIgd2hlbiBpdCBzcGFucyBhY3Jvc3MgbGluZXMuXG4vLyBUaGUgc3BhbnMgd2lsbCBoYXZlIG51bGwgZm9yIHRoZWlyIGZyb20vdG8gcHJvcGVydGllcyB3aGVuIHRoZVxuLy8gbWFya2VyIGNvbnRpbnVlcyBiZXlvbmQgdGhlIHN0YXJ0L2VuZCBvZiB0aGUgbGluZS4gTWFya2VycyBoYXZlXG4vLyBsaW5rcyBiYWNrIHRvIHRoZSBsaW5lcyB0aGV5IGN1cnJlbnRseSB0b3VjaC5cblxuLy8gQ29sbGFwc2VkIG1hcmtlcnMgaGF2ZSB1bmlxdWUgaWRzLCBpbiBvcmRlciB0byBiZSBhYmxlIHRvIG9yZGVyXG4vLyB0aGVtLCB3aGljaCBpcyBuZWVkZWQgZm9yIHVuaXF1ZWx5IGRldGVybWluaW5nIGFuIG91dGVyIG1hcmtlclxuLy8gd2hlbiB0aGV5IG92ZXJsYXAgKHRoZXkgbWF5IG5lc3QsIGJ1dCBub3QgcGFydGlhbGx5IG92ZXJsYXApLlxudmFyIG5leHRNYXJrZXJJZCA9IDA7XG5cbnZhciBUZXh0TWFya2VyID0gZnVuY3Rpb24oZG9jLCB0eXBlKSB7XG4gIHRoaXMubGluZXMgPSBbXTtcbiAgdGhpcy50eXBlID0gdHlwZTtcbiAgdGhpcy5kb2MgPSBkb2M7XG4gIHRoaXMuaWQgPSArK25leHRNYXJrZXJJZDtcbn07XG5cbi8vIENsZWFyIHRoZSBtYXJrZXIuXG5UZXh0TWFya2VyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBpZiAodGhpcy5leHBsaWNpdGx5Q2xlYXJlZCkgeyByZXR1cm4gfVxuICB2YXIgY20gPSB0aGlzLmRvYy5jbSwgd2l0aE9wID0gY20gJiYgIWNtLmN1ck9wO1xuICBpZiAod2l0aE9wKSB7IHN0YXJ0T3BlcmF0aW9uKGNtKTsgfVxuICBpZiAoaGFzSGFuZGxlcih0aGlzLCBcImNsZWFyXCIpKSB7XG4gICAgdmFyIGZvdW5kID0gdGhpcy5maW5kKCk7XG4gICAgaWYgKGZvdW5kKSB7IHNpZ25hbExhdGVyKHRoaXMsIFwiY2xlYXJcIiwgZm91bmQuZnJvbSwgZm91bmQudG8pOyB9XG4gIH1cbiAgdmFyIG1pbiA9IG51bGwsIG1heCA9IG51bGw7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgIHZhciBsaW5lID0gdGhpcyQxLmxpbmVzW2ldO1xuICAgIHZhciBzcGFuID0gZ2V0TWFya2VkU3BhbkZvcihsaW5lLm1hcmtlZFNwYW5zLCB0aGlzJDEpO1xuICAgIGlmIChjbSAmJiAhdGhpcyQxLmNvbGxhcHNlZCkgeyByZWdMaW5lQ2hhbmdlKGNtLCBsaW5lTm8obGluZSksIFwidGV4dFwiKTsgfVxuICAgIGVsc2UgaWYgKGNtKSB7XG4gICAgICBpZiAoc3Bhbi50byAhPSBudWxsKSB7IG1heCA9IGxpbmVObyhsaW5lKTsgfVxuICAgICAgaWYgKHNwYW4uZnJvbSAhPSBudWxsKSB7IG1pbiA9IGxpbmVObyhsaW5lKTsgfVxuICAgIH1cbiAgICBsaW5lLm1hcmtlZFNwYW5zID0gcmVtb3ZlTWFya2VkU3BhbihsaW5lLm1hcmtlZFNwYW5zLCBzcGFuKTtcbiAgICBpZiAoc3Bhbi5mcm9tID09IG51bGwgJiYgdGhpcyQxLmNvbGxhcHNlZCAmJiAhbGluZUlzSGlkZGVuKHRoaXMkMS5kb2MsIGxpbmUpICYmIGNtKVxuICAgICAgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIHRleHRIZWlnaHQoY20uZGlzcGxheSkpOyB9XG4gIH1cbiAgaWYgKGNtICYmIHRoaXMuY29sbGFwc2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgeyBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCB0aGlzLmxpbmVzLmxlbmd0aDsgKytpJDEpIHtcbiAgICB2YXIgdmlzdWFsID0gdmlzdWFsTGluZSh0aGlzJDEubGluZXNbaSQxXSksIGxlbiA9IGxpbmVMZW5ndGgodmlzdWFsKTtcbiAgICBpZiAobGVuID4gY20uZGlzcGxheS5tYXhMaW5lTGVuZ3RoKSB7XG4gICAgICBjbS5kaXNwbGF5Lm1heExpbmUgPSB2aXN1YWw7XG4gICAgICBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGggPSBsZW47XG4gICAgICBjbS5kaXNwbGF5Lm1heExpbmVDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG4gIH0gfVxuXG4gIGlmIChtaW4gIT0gbnVsbCAmJiBjbSAmJiB0aGlzLmNvbGxhcHNlZCkgeyByZWdDaGFuZ2UoY20sIG1pbiwgbWF4ICsgMSk7IH1cbiAgdGhpcy5saW5lcy5sZW5ndGggPSAwO1xuICB0aGlzLmV4cGxpY2l0bHlDbGVhcmVkID0gdHJ1ZTtcbiAgaWYgKHRoaXMuYXRvbWljICYmIHRoaXMuZG9jLmNhbnRFZGl0KSB7XG4gICAgdGhpcy5kb2MuY2FudEVkaXQgPSBmYWxzZTtcbiAgICBpZiAoY20pIHsgcmVDaGVja1NlbGVjdGlvbihjbS5kb2MpOyB9XG4gIH1cbiAgaWYgKGNtKSB7IHNpZ25hbExhdGVyKGNtLCBcIm1hcmtlckNsZWFyZWRcIiwgY20sIHRoaXMsIG1pbiwgbWF4KTsgfVxuICBpZiAod2l0aE9wKSB7IGVuZE9wZXJhdGlvbihjbSk7IH1cbiAgaWYgKHRoaXMucGFyZW50KSB7IHRoaXMucGFyZW50LmNsZWFyKCk7IH1cbn07XG5cbi8vIEZpbmQgdGhlIHBvc2l0aW9uIG9mIHRoZSBtYXJrZXIgaW4gdGhlIGRvY3VtZW50LiBSZXR1cm5zIGEge2Zyb20sXG4vLyB0b30gb2JqZWN0IGJ5IGRlZmF1bHQuIFNpZGUgY2FuIGJlIHBhc3NlZCB0byBnZXQgYSBzcGVjaWZpYyBzaWRlXG4vLyAtLSAwIChib3RoKSwgLTEgKGxlZnQpLCBvciAxIChyaWdodCkuIFdoZW4gbGluZU9iaiBpcyB0cnVlLCB0aGVcbi8vIFBvcyBvYmplY3RzIHJldHVybmVkIGNvbnRhaW4gYSBsaW5lIG9iamVjdCwgcmF0aGVyIHRoYW4gYSBsaW5lXG4vLyBudW1iZXIgKHVzZWQgdG8gcHJldmVudCBsb29raW5nIHVwIHRoZSBzYW1lIGxpbmUgdHdpY2UpLlxuVGV4dE1hcmtlci5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uIChzaWRlLCBsaW5lT2JqKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKHNpZGUgPT0gbnVsbCAmJiB0aGlzLnR5cGUgPT0gXCJib29rbWFya1wiKSB7IHNpZGUgPSAxOyB9XG4gIHZhciBmcm9tLCB0bztcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxpbmVzLmxlbmd0aDsgKytpKSB7XG4gICAgdmFyIGxpbmUgPSB0aGlzJDEubGluZXNbaV07XG4gICAgdmFyIHNwYW4gPSBnZXRNYXJrZWRTcGFuRm9yKGxpbmUubWFya2VkU3BhbnMsIHRoaXMkMSk7XG4gICAgaWYgKHNwYW4uZnJvbSAhPSBudWxsKSB7XG4gICAgICBmcm9tID0gUG9zKGxpbmVPYmogPyBsaW5lIDogbGluZU5vKGxpbmUpLCBzcGFuLmZyb20pO1xuICAgICAgaWYgKHNpZGUgPT0gLTEpIHsgcmV0dXJuIGZyb20gfVxuICAgIH1cbiAgICBpZiAoc3Bhbi50byAhPSBudWxsKSB7XG4gICAgICB0byA9IFBvcyhsaW5lT2JqID8gbGluZSA6IGxpbmVObyhsaW5lKSwgc3Bhbi50byk7XG4gICAgICBpZiAoc2lkZSA9PSAxKSB7IHJldHVybiB0byB9XG4gICAgfVxuICB9XG4gIHJldHVybiBmcm9tICYmIHtmcm9tOiBmcm9tLCB0bzogdG99XG59O1xuXG4vLyBTaWduYWxzIHRoYXQgdGhlIG1hcmtlcidzIHdpZGdldCBjaGFuZ2VkLCBhbmQgc3Vycm91bmRpbmcgbGF5b3V0XG4vLyBzaG91bGQgYmUgcmVjb21wdXRlZC5cblRleHRNYXJrZXIucHJvdG90eXBlLmNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIHBvcyA9IHRoaXMuZmluZCgtMSwgdHJ1ZSksIHdpZGdldCA9IHRoaXMsIGNtID0gdGhpcy5kb2MuY207XG4gIGlmICghcG9zIHx8ICFjbSkgeyByZXR1cm4gfVxuICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxpbmUgPSBwb3MubGluZSwgbGluZU4gPSBsaW5lTm8ocG9zLmxpbmUpO1xuICAgIHZhciB2aWV3ID0gZmluZFZpZXdGb3JMaW5lKGNtLCBsaW5lTik7XG4gICAgaWYgKHZpZXcpIHtcbiAgICAgIGNsZWFyTGluZU1lYXN1cmVtZW50Q2FjaGVGb3Iodmlldyk7XG4gICAgICBjbS5jdXJPcC5zZWxlY3Rpb25DaGFuZ2VkID0gY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgIH1cbiAgICBjbS5jdXJPcC51cGRhdGVNYXhMaW5lID0gdHJ1ZTtcbiAgICBpZiAoIWxpbmVJc0hpZGRlbih3aWRnZXQuZG9jLCBsaW5lKSAmJiB3aWRnZXQuaGVpZ2h0ICE9IG51bGwpIHtcbiAgICAgIHZhciBvbGRIZWlnaHQgPSB3aWRnZXQuaGVpZ2h0O1xuICAgICAgd2lkZ2V0LmhlaWdodCA9IG51bGw7XG4gICAgICB2YXIgZEhlaWdodCA9IHdpZGdldEhlaWdodCh3aWRnZXQpIC0gb2xkSGVpZ2h0O1xuICAgICAgaWYgKGRIZWlnaHQpXG4gICAgICAgIHsgdXBkYXRlTGluZUhlaWdodChsaW5lLCBsaW5lLmhlaWdodCArIGRIZWlnaHQpOyB9XG4gICAgfVxuICAgIHNpZ25hbExhdGVyKGNtLCBcIm1hcmtlckNoYW5nZWRcIiwgY20sIHRoaXMkMSk7XG4gIH0pO1xufTtcblxuVGV4dE1hcmtlci5wcm90b3R5cGUuYXR0YWNoTGluZSA9IGZ1bmN0aW9uIChsaW5lKSB7XG4gIGlmICghdGhpcy5saW5lcy5sZW5ndGggJiYgdGhpcy5kb2MuY20pIHtcbiAgICB2YXIgb3AgPSB0aGlzLmRvYy5jbS5jdXJPcDtcbiAgICBpZiAoIW9wLm1heWJlSGlkZGVuTWFya2VycyB8fCBpbmRleE9mKG9wLm1heWJlSGlkZGVuTWFya2VycywgdGhpcykgPT0gLTEpXG4gICAgICB7IChvcC5tYXliZVVuaGlkZGVuTWFya2VycyB8fCAob3AubWF5YmVVbmhpZGRlbk1hcmtlcnMgPSBbXSkpLnB1c2godGhpcyk7IH1cbiAgfVxuICB0aGlzLmxpbmVzLnB1c2gobGluZSk7XG59O1xuXG5UZXh0TWFya2VyLnByb3RvdHlwZS5kZXRhY2hMaW5lID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgdGhpcy5saW5lcy5zcGxpY2UoaW5kZXhPZih0aGlzLmxpbmVzLCBsaW5lKSwgMSk7XG4gIGlmICghdGhpcy5saW5lcy5sZW5ndGggJiYgdGhpcy5kb2MuY20pIHtcbiAgICB2YXIgb3AgPSB0aGlzLmRvYy5jbS5jdXJPcDsob3AubWF5YmVIaWRkZW5NYXJrZXJzIHx8IChvcC5tYXliZUhpZGRlbk1hcmtlcnMgPSBbXSkpLnB1c2godGhpcyk7XG4gIH1cbn07XG5ldmVudE1peGluKFRleHRNYXJrZXIpO1xuXG4vLyBDcmVhdGUgYSBtYXJrZXIsIHdpcmUgaXQgdXAgdG8gdGhlIHJpZ2h0IGxpbmVzLCBhbmRcbmZ1bmN0aW9uIG1hcmtUZXh0KGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpIHtcbiAgLy8gU2hhcmVkIG1hcmtlcnMgKGFjcm9zcyBsaW5rZWQgZG9jdW1lbnRzKSBhcmUgaGFuZGxlZCBzZXBhcmF0ZWx5XG4gIC8vIChtYXJrVGV4dFNoYXJlZCB3aWxsIGNhbGwgb3V0IHRvIHRoaXMgYWdhaW4sIG9uY2UgcGVyXG4gIC8vIGRvY3VtZW50KS5cbiAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zaGFyZWQpIHsgcmV0dXJuIG1hcmtUZXh0U2hhcmVkKGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpIH1cbiAgLy8gRW5zdXJlIHdlIGFyZSBpbiBhbiBvcGVyYXRpb24uXG4gIGlmIChkb2MuY20gJiYgIWRvYy5jbS5jdXJPcCkgeyByZXR1cm4gb3BlcmF0aW9uKGRvYy5jbSwgbWFya1RleHQpKGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpIH1cblxuICB2YXIgbWFya2VyID0gbmV3IFRleHRNYXJrZXIoZG9jLCB0eXBlKSwgZGlmZiA9IGNtcChmcm9tLCB0byk7XG4gIGlmIChvcHRpb25zKSB7IGNvcHlPYmoob3B0aW9ucywgbWFya2VyLCBmYWxzZSk7IH1cbiAgLy8gRG9uJ3QgY29ubmVjdCBlbXB0eSBtYXJrZXJzIHVubGVzcyBjbGVhcldoZW5FbXB0eSBpcyBmYWxzZVxuICBpZiAoZGlmZiA+IDAgfHwgZGlmZiA9PSAwICYmIG1hcmtlci5jbGVhcldoZW5FbXB0eSAhPT0gZmFsc2UpXG4gICAgeyByZXR1cm4gbWFya2VyIH1cbiAgaWYgKG1hcmtlci5yZXBsYWNlZFdpdGgpIHtcbiAgICAvLyBTaG93aW5nIHVwIGFzIGEgd2lkZ2V0IGltcGxpZXMgY29sbGFwc2VkICh3aWRnZXQgcmVwbGFjZXMgdGV4dClcbiAgICBtYXJrZXIuY29sbGFwc2VkID0gdHJ1ZTtcbiAgICBtYXJrZXIud2lkZ2V0Tm9kZSA9IGVsdFAoXCJzcGFuXCIsIFttYXJrZXIucmVwbGFjZWRXaXRoXSwgXCJDb2RlTWlycm9yLXdpZGdldFwiKTtcbiAgICBpZiAoIW9wdGlvbnMuaGFuZGxlTW91c2VFdmVudHMpIHsgbWFya2VyLndpZGdldE5vZGUuc2V0QXR0cmlidXRlKFwiY20taWdub3JlLWV2ZW50c1wiLCBcInRydWVcIik7IH1cbiAgICBpZiAob3B0aW9ucy5pbnNlcnRMZWZ0KSB7IG1hcmtlci53aWRnZXROb2RlLmluc2VydExlZnQgPSB0cnVlOyB9XG4gIH1cbiAgaWYgKG1hcmtlci5jb2xsYXBzZWQpIHtcbiAgICBpZiAoY29uZmxpY3RpbmdDb2xsYXBzZWRSYW5nZShkb2MsIGZyb20ubGluZSwgZnJvbSwgdG8sIG1hcmtlcikgfHxcbiAgICAgICAgZnJvbS5saW5lICE9IHRvLmxpbmUgJiYgY29uZmxpY3RpbmdDb2xsYXBzZWRSYW5nZShkb2MsIHRvLmxpbmUsIGZyb20sIHRvLCBtYXJrZXIpKVxuICAgICAgeyB0aHJvdyBuZXcgRXJyb3IoXCJJbnNlcnRpbmcgY29sbGFwc2VkIG1hcmtlciBwYXJ0aWFsbHkgb3ZlcmxhcHBpbmcgYW4gZXhpc3Rpbmcgb25lXCIpIH1cbiAgICBzZWVDb2xsYXBzZWRTcGFucygpO1xuICB9XG5cbiAgaWYgKG1hcmtlci5hZGRUb0hpc3RvcnkpXG4gICAgeyBhZGRDaGFuZ2VUb0hpc3RvcnkoZG9jLCB7ZnJvbTogZnJvbSwgdG86IHRvLCBvcmlnaW46IFwibWFya1RleHRcIn0sIGRvYy5zZWwsIE5hTik7IH1cblxuICB2YXIgY3VyTGluZSA9IGZyb20ubGluZSwgY20gPSBkb2MuY20sIHVwZGF0ZU1heExpbmU7XG4gIGRvYy5pdGVyKGN1ckxpbmUsIHRvLmxpbmUgKyAxLCBmdW5jdGlvbiAobGluZSkge1xuICAgIGlmIChjbSAmJiBtYXJrZXIuY29sbGFwc2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZyAmJiB2aXN1YWxMaW5lKGxpbmUpID09IGNtLmRpc3BsYXkubWF4TGluZSlcbiAgICAgIHsgdXBkYXRlTWF4TGluZSA9IHRydWU7IH1cbiAgICBpZiAobWFya2VyLmNvbGxhcHNlZCAmJiBjdXJMaW5lICE9IGZyb20ubGluZSkgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIDApOyB9XG4gICAgYWRkTWFya2VkU3BhbihsaW5lLCBuZXcgTWFya2VkU3BhbihtYXJrZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJMaW5lID09IGZyb20ubGluZSA/IGZyb20uY2ggOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyTGluZSA9PSB0by5saW5lID8gdG8uY2ggOiBudWxsKSk7XG4gICAgKytjdXJMaW5lO1xuICB9KTtcbiAgLy8gbGluZUlzSGlkZGVuIGRlcGVuZHMgb24gdGhlIHByZXNlbmNlIG9mIHRoZSBzcGFucywgc28gbmVlZHMgYSBzZWNvbmQgcGFzc1xuICBpZiAobWFya2VyLmNvbGxhcHNlZCkgeyBkb2MuaXRlcihmcm9tLmxpbmUsIHRvLmxpbmUgKyAxLCBmdW5jdGlvbiAobGluZSkge1xuICAgIGlmIChsaW5lSXNIaWRkZW4oZG9jLCBsaW5lKSkgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIDApOyB9XG4gIH0pOyB9XG5cbiAgaWYgKG1hcmtlci5jbGVhck9uRW50ZXIpIHsgb24obWFya2VyLCBcImJlZm9yZUN1cnNvckVudGVyXCIsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1hcmtlci5jbGVhcigpOyB9KTsgfVxuXG4gIGlmIChtYXJrZXIucmVhZE9ubHkpIHtcbiAgICBzZWVSZWFkT25seVNwYW5zKCk7XG4gICAgaWYgKGRvYy5oaXN0b3J5LmRvbmUubGVuZ3RoIHx8IGRvYy5oaXN0b3J5LnVuZG9uZS5sZW5ndGgpXG4gICAgICB7IGRvYy5jbGVhckhpc3RvcnkoKTsgfVxuICB9XG4gIGlmIChtYXJrZXIuY29sbGFwc2VkKSB7XG4gICAgbWFya2VyLmlkID0gKytuZXh0TWFya2VySWQ7XG4gICAgbWFya2VyLmF0b21pYyA9IHRydWU7XG4gIH1cbiAgaWYgKGNtKSB7XG4gICAgLy8gU3luYyBlZGl0b3Igc3RhdGVcbiAgICBpZiAodXBkYXRlTWF4TGluZSkgeyBjbS5jdXJPcC51cGRhdGVNYXhMaW5lID0gdHJ1ZTsgfVxuICAgIGlmIChtYXJrZXIuY29sbGFwc2VkKVxuICAgICAgeyByZWdDaGFuZ2UoY20sIGZyb20ubGluZSwgdG8ubGluZSArIDEpOyB9XG4gICAgZWxzZSBpZiAobWFya2VyLmNsYXNzTmFtZSB8fCBtYXJrZXIudGl0bGUgfHwgbWFya2VyLnN0YXJ0U3R5bGUgfHwgbWFya2VyLmVuZFN0eWxlIHx8IG1hcmtlci5jc3MpXG4gICAgICB7IGZvciAodmFyIGkgPSBmcm9tLmxpbmU7IGkgPD0gdG8ubGluZTsgaSsrKSB7IHJlZ0xpbmVDaGFuZ2UoY20sIGksIFwidGV4dFwiKTsgfSB9XG4gICAgaWYgKG1hcmtlci5hdG9taWMpIHsgcmVDaGVja1NlbGVjdGlvbihjbS5kb2MpOyB9XG4gICAgc2lnbmFsTGF0ZXIoY20sIFwibWFya2VyQWRkZWRcIiwgY20sIG1hcmtlcik7XG4gIH1cbiAgcmV0dXJuIG1hcmtlclxufVxuXG4vLyBTSEFSRUQgVEVYVE1BUktFUlNcblxuLy8gQSBzaGFyZWQgbWFya2VyIHNwYW5zIG11bHRpcGxlIGxpbmtlZCBkb2N1bWVudHMuIEl0IGlzXG4vLyBpbXBsZW1lbnRlZCBhcyBhIG1ldGEtbWFya2VyLW9iamVjdCBjb250cm9sbGluZyBtdWx0aXBsZSBub3JtYWxcbi8vIG1hcmtlcnMuXG52YXIgU2hhcmVkVGV4dE1hcmtlciA9IGZ1bmN0aW9uKG1hcmtlcnMsIHByaW1hcnkpIHtcbiAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdGhpcy5tYXJrZXJzID0gbWFya2VycztcbiAgdGhpcy5wcmltYXJ5ID0gcHJpbWFyeTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgKytpKVxuICAgIHsgbWFya2Vyc1tpXS5wYXJlbnQgPSB0aGlzJDE7IH1cbn07XG5cblNoYXJlZFRleHRNYXJrZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGlmICh0aGlzLmV4cGxpY2l0bHlDbGVhcmVkKSB7IHJldHVybiB9XG4gIHRoaXMuZXhwbGljaXRseUNsZWFyZWQgPSB0cnVlO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWFya2Vycy5sZW5ndGg7ICsraSlcbiAgICB7IHRoaXMkMS5tYXJrZXJzW2ldLmNsZWFyKCk7IH1cbiAgc2lnbmFsTGF0ZXIodGhpcywgXCJjbGVhclwiKTtcbn07XG5cblNoYXJlZFRleHRNYXJrZXIucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiAoc2lkZSwgbGluZU9iaikge1xuICByZXR1cm4gdGhpcy5wcmltYXJ5LmZpbmQoc2lkZSwgbGluZU9iailcbn07XG5ldmVudE1peGluKFNoYXJlZFRleHRNYXJrZXIpO1xuXG5mdW5jdGlvbiBtYXJrVGV4dFNoYXJlZChkb2MsIGZyb20sIHRvLCBvcHRpb25zLCB0eXBlKSB7XG4gIG9wdGlvbnMgPSBjb3B5T2JqKG9wdGlvbnMpO1xuICBvcHRpb25zLnNoYXJlZCA9IGZhbHNlO1xuICB2YXIgbWFya2VycyA9IFttYXJrVGV4dChkb2MsIGZyb20sIHRvLCBvcHRpb25zLCB0eXBlKV0sIHByaW1hcnkgPSBtYXJrZXJzWzBdO1xuICB2YXIgd2lkZ2V0ID0gb3B0aW9ucy53aWRnZXROb2RlO1xuICBsaW5rZWREb2NzKGRvYywgZnVuY3Rpb24gKGRvYykge1xuICAgIGlmICh3aWRnZXQpIHsgb3B0aW9ucy53aWRnZXROb2RlID0gd2lkZ2V0LmNsb25lTm9kZSh0cnVlKTsgfVxuICAgIG1hcmtlcnMucHVzaChtYXJrVGV4dChkb2MsIGNsaXBQb3MoZG9jLCBmcm9tKSwgY2xpcFBvcyhkb2MsIHRvKSwgb3B0aW9ucywgdHlwZSkpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLmxpbmtlZC5sZW5ndGg7ICsraSlcbiAgICAgIHsgaWYgKGRvYy5saW5rZWRbaV0uaXNQYXJlbnQpIHsgcmV0dXJuIH0gfVxuICAgIHByaW1hcnkgPSBsc3QobWFya2Vycyk7XG4gIH0pO1xuICByZXR1cm4gbmV3IFNoYXJlZFRleHRNYXJrZXIobWFya2VycywgcHJpbWFyeSlcbn1cblxuZnVuY3Rpb24gZmluZFNoYXJlZE1hcmtlcnMoZG9jKSB7XG4gIHJldHVybiBkb2MuZmluZE1hcmtzKFBvcyhkb2MuZmlyc3QsIDApLCBkb2MuY2xpcFBvcyhQb3MoZG9jLmxhc3RMaW5lKCkpKSwgZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0ucGFyZW50OyB9KVxufVxuXG5mdW5jdGlvbiBjb3B5U2hhcmVkTWFya2Vycyhkb2MsIG1hcmtlcnMpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaV0sIHBvcyA9IG1hcmtlci5maW5kKCk7XG4gICAgdmFyIG1Gcm9tID0gZG9jLmNsaXBQb3MocG9zLmZyb20pLCBtVG8gPSBkb2MuY2xpcFBvcyhwb3MudG8pO1xuICAgIGlmIChjbXAobUZyb20sIG1UbykpIHtcbiAgICAgIHZhciBzdWJNYXJrID0gbWFya1RleHQoZG9jLCBtRnJvbSwgbVRvLCBtYXJrZXIucHJpbWFyeSwgbWFya2VyLnByaW1hcnkudHlwZSk7XG4gICAgICBtYXJrZXIubWFya2Vycy5wdXNoKHN1Yk1hcmspO1xuICAgICAgc3ViTWFyay5wYXJlbnQgPSBtYXJrZXI7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGRldGFjaFNoYXJlZE1hcmtlcnMobWFya2Vycykge1xuICB2YXIgbG9vcCA9IGZ1bmN0aW9uICggaSApIHtcbiAgICB2YXIgbWFya2VyID0gbWFya2Vyc1tpXSwgbGlua2VkID0gW21hcmtlci5wcmltYXJ5LmRvY107XG4gICAgbGlua2VkRG9jcyhtYXJrZXIucHJpbWFyeS5kb2MsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBsaW5rZWQucHVzaChkKTsgfSk7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBtYXJrZXIubWFya2Vycy5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIHN1Yk1hcmtlciA9IG1hcmtlci5tYXJrZXJzW2pdO1xuICAgICAgaWYgKGluZGV4T2YobGlua2VkLCBzdWJNYXJrZXIuZG9jKSA9PSAtMSkge1xuICAgICAgICBzdWJNYXJrZXIucGFyZW50ID0gbnVsbDtcbiAgICAgICAgbWFya2VyLm1hcmtlcnMuc3BsaWNlKGotLSwgMSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7IGkrKykgbG9vcCggaSApO1xufVxuXG52YXIgbmV4dERvY0lkID0gMDtcbnZhciBEb2MgPSBmdW5jdGlvbih0ZXh0LCBtb2RlLCBmaXJzdExpbmUsIGxpbmVTZXAsIGRpcmVjdGlvbikge1xuICBpZiAoISh0aGlzIGluc3RhbmNlb2YgRG9jKSkgeyByZXR1cm4gbmV3IERvYyh0ZXh0LCBtb2RlLCBmaXJzdExpbmUsIGxpbmVTZXAsIGRpcmVjdGlvbikgfVxuICBpZiAoZmlyc3RMaW5lID09IG51bGwpIHsgZmlyc3RMaW5lID0gMDsgfVxuXG4gIEJyYW5jaENodW5rLmNhbGwodGhpcywgW25ldyBMZWFmQ2h1bmsoW25ldyBMaW5lKFwiXCIsIG51bGwpXSldKTtcbiAgdGhpcy5maXJzdCA9IGZpcnN0TGluZTtcbiAgdGhpcy5zY3JvbGxUb3AgPSB0aGlzLnNjcm9sbExlZnQgPSAwO1xuICB0aGlzLmNhbnRFZGl0ID0gZmFsc2U7XG4gIHRoaXMuY2xlYW5HZW5lcmF0aW9uID0gMTtcbiAgdGhpcy5mcm9udGllciA9IGZpcnN0TGluZTtcbiAgdmFyIHN0YXJ0ID0gUG9zKGZpcnN0TGluZSwgMCk7XG4gIHRoaXMuc2VsID0gc2ltcGxlU2VsZWN0aW9uKHN0YXJ0KTtcbiAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkobnVsbCk7XG4gIHRoaXMuaWQgPSArK25leHREb2NJZDtcbiAgdGhpcy5tb2RlT3B0aW9uID0gbW9kZTtcbiAgdGhpcy5saW5lU2VwID0gbGluZVNlcDtcbiAgdGhpcy5kaXJlY3Rpb24gPSAoZGlyZWN0aW9uID09IFwicnRsXCIpID8gXCJydGxcIiA6IFwibHRyXCI7XG4gIHRoaXMuZXh0ZW5kID0gZmFsc2U7XG5cbiAgaWYgKHR5cGVvZiB0ZXh0ID09IFwic3RyaW5nXCIpIHsgdGV4dCA9IHRoaXMuc3BsaXRMaW5lcyh0ZXh0KTsgfVxuICB1cGRhdGVEb2ModGhpcywge2Zyb206IHN0YXJ0LCB0bzogc3RhcnQsIHRleHQ6IHRleHR9KTtcbiAgc2V0U2VsZWN0aW9uKHRoaXMsIHNpbXBsZVNlbGVjdGlvbihzdGFydCksIHNlbF9kb250U2Nyb2xsKTtcbn07XG5cbkRvYy5wcm90b3R5cGUgPSBjcmVhdGVPYmooQnJhbmNoQ2h1bmsucHJvdG90eXBlLCB7XG4gIGNvbnN0cnVjdG9yOiBEb2MsXG4gIC8vIEl0ZXJhdGUgb3ZlciB0aGUgZG9jdW1lbnQuIFN1cHBvcnRzIHR3byBmb3JtcyAtLSB3aXRoIG9ubHkgb25lXG4gIC8vIGFyZ3VtZW50LCBpdCBjYWxscyB0aGF0IGZvciBlYWNoIGxpbmUgaW4gdGhlIGRvY3VtZW50LiBXaXRoXG4gIC8vIHRocmVlLCBpdCBpdGVyYXRlcyBvdmVyIHRoZSByYW5nZSBnaXZlbiBieSB0aGUgZmlyc3QgdHdvICh3aXRoXG4gIC8vIHRoZSBzZWNvbmQgYmVpbmcgbm9uLWluY2x1c2l2ZSkuXG4gIGl0ZXI6IGZ1bmN0aW9uKGZyb20sIHRvLCBvcCkge1xuICAgIGlmIChvcCkgeyB0aGlzLml0ZXJOKGZyb20gLSB0aGlzLmZpcnN0LCB0byAtIGZyb20sIG9wKTsgfVxuICAgIGVsc2UgeyB0aGlzLml0ZXJOKHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUsIGZyb20pOyB9XG4gIH0sXG5cbiAgLy8gTm9uLXB1YmxpYyBpbnRlcmZhY2UgZm9yIGFkZGluZyBhbmQgcmVtb3ZpbmcgbGluZXMuXG4gIGluc2VydDogZnVuY3Rpb24oYXQsIGxpbmVzKSB7XG4gICAgdmFyIGhlaWdodCA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7ICsraSkgeyBoZWlnaHQgKz0gbGluZXNbaV0uaGVpZ2h0OyB9XG4gICAgdGhpcy5pbnNlcnRJbm5lcihhdCAtIHRoaXMuZmlyc3QsIGxpbmVzLCBoZWlnaHQpO1xuICB9LFxuICByZW1vdmU6IGZ1bmN0aW9uKGF0LCBuKSB7IHRoaXMucmVtb3ZlSW5uZXIoYXQgLSB0aGlzLmZpcnN0LCBuKTsgfSxcblxuICAvLyBGcm9tIGhlcmUsIHRoZSBtZXRob2RzIGFyZSBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLiBNb3N0XG4gIC8vIGFyZSBhbHNvIGF2YWlsYWJsZSBmcm9tIENvZGVNaXJyb3IgKGVkaXRvcikgaW5zdGFuY2VzLlxuXG4gIGdldFZhbHVlOiBmdW5jdGlvbihsaW5lU2VwKSB7XG4gICAgdmFyIGxpbmVzID0gZ2V0TGluZXModGhpcywgdGhpcy5maXJzdCwgdGhpcy5maXJzdCArIHRoaXMuc2l6ZSk7XG4gICAgaWYgKGxpbmVTZXAgPT09IGZhbHNlKSB7IHJldHVybiBsaW5lcyB9XG4gICAgcmV0dXJuIGxpbmVzLmpvaW4obGluZVNlcCB8fCB0aGlzLmxpbmVTZXBhcmF0b3IoKSlcbiAgfSxcbiAgc2V0VmFsdWU6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGNvZGUpIHtcbiAgICB2YXIgdG9wID0gUG9zKHRoaXMuZmlyc3QsIDApLCBsYXN0ID0gdGhpcy5maXJzdCArIHRoaXMuc2l6ZSAtIDE7XG4gICAgbWFrZUNoYW5nZSh0aGlzLCB7ZnJvbTogdG9wLCB0bzogUG9zKGxhc3QsIGdldExpbmUodGhpcywgbGFzdCkudGV4dC5sZW5ndGgpLFxuICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMuc3BsaXRMaW5lcyhjb2RlKSwgb3JpZ2luOiBcInNldFZhbHVlXCIsIGZ1bGw6IHRydWV9LCB0cnVlKTtcbiAgICBpZiAodGhpcy5jbSkgeyBzY3JvbGxUb0Nvb3Jkcyh0aGlzLmNtLCAwLCAwKTsgfVxuICAgIHNldFNlbGVjdGlvbih0aGlzLCBzaW1wbGVTZWxlY3Rpb24odG9wKSwgc2VsX2RvbnRTY3JvbGwpO1xuICB9KSxcbiAgcmVwbGFjZVJhbmdlOiBmdW5jdGlvbihjb2RlLCBmcm9tLCB0bywgb3JpZ2luKSB7XG4gICAgZnJvbSA9IGNsaXBQb3ModGhpcywgZnJvbSk7XG4gICAgdG8gPSB0byA/IGNsaXBQb3ModGhpcywgdG8pIDogZnJvbTtcbiAgICByZXBsYWNlUmFuZ2UodGhpcywgY29kZSwgZnJvbSwgdG8sIG9yaWdpbik7XG4gIH0sXG4gIGdldFJhbmdlOiBmdW5jdGlvbihmcm9tLCB0bywgbGluZVNlcCkge1xuICAgIHZhciBsaW5lcyA9IGdldEJldHdlZW4odGhpcywgY2xpcFBvcyh0aGlzLCBmcm9tKSwgY2xpcFBvcyh0aGlzLCB0bykpO1xuICAgIGlmIChsaW5lU2VwID09PSBmYWxzZSkgeyByZXR1cm4gbGluZXMgfVxuICAgIHJldHVybiBsaW5lcy5qb2luKGxpbmVTZXAgfHwgdGhpcy5saW5lU2VwYXJhdG9yKCkpXG4gIH0sXG5cbiAgZ2V0TGluZTogZnVuY3Rpb24obGluZSkge3ZhciBsID0gdGhpcy5nZXRMaW5lSGFuZGxlKGxpbmUpOyByZXR1cm4gbCAmJiBsLnRleHR9LFxuXG4gIGdldExpbmVIYW5kbGU6IGZ1bmN0aW9uKGxpbmUpIHtpZiAoaXNMaW5lKHRoaXMsIGxpbmUpKSB7IHJldHVybiBnZXRMaW5lKHRoaXMsIGxpbmUpIH19LFxuICBnZXRMaW5lTnVtYmVyOiBmdW5jdGlvbihsaW5lKSB7cmV0dXJuIGxpbmVObyhsaW5lKX0sXG5cbiAgZ2V0TGluZUhhbmRsZVZpc3VhbFN0YXJ0OiBmdW5jdGlvbihsaW5lKSB7XG4gICAgaWYgKHR5cGVvZiBsaW5lID09IFwibnVtYmVyXCIpIHsgbGluZSA9IGdldExpbmUodGhpcywgbGluZSk7IH1cbiAgICByZXR1cm4gdmlzdWFsTGluZShsaW5lKVxuICB9LFxuXG4gIGxpbmVDb3VudDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuc2l6ZX0sXG4gIGZpcnN0TGluZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuZmlyc3R9LFxuICBsYXN0TGluZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUgLSAxfSxcblxuICBjbGlwUG9zOiBmdW5jdGlvbihwb3MpIHtyZXR1cm4gY2xpcFBvcyh0aGlzLCBwb3MpfSxcblxuICBnZXRDdXJzb3I6IGZ1bmN0aW9uKHN0YXJ0KSB7XG4gICAgdmFyIHJhbmdlJCQxID0gdGhpcy5zZWwucHJpbWFyeSgpLCBwb3M7XG4gICAgaWYgKHN0YXJ0ID09IG51bGwgfHwgc3RhcnQgPT0gXCJoZWFkXCIpIHsgcG9zID0gcmFuZ2UkJDEuaGVhZDsgfVxuICAgIGVsc2UgaWYgKHN0YXJ0ID09IFwiYW5jaG9yXCIpIHsgcG9zID0gcmFuZ2UkJDEuYW5jaG9yOyB9XG4gICAgZWxzZSBpZiAoc3RhcnQgPT0gXCJlbmRcIiB8fCBzdGFydCA9PSBcInRvXCIgfHwgc3RhcnQgPT09IGZhbHNlKSB7IHBvcyA9IHJhbmdlJCQxLnRvKCk7IH1cbiAgICBlbHNlIHsgcG9zID0gcmFuZ2UkJDEuZnJvbSgpOyB9XG4gICAgcmV0dXJuIHBvc1xuICB9LFxuICBsaXN0U2VsZWN0aW9uczogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNlbC5yYW5nZXMgfSxcbiAgc29tZXRoaW5nU2VsZWN0ZWQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLnNlbC5zb21ldGhpbmdTZWxlY3RlZCgpfSxcblxuICBzZXRDdXJzb3I6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGxpbmUsIGNoLCBvcHRpb25zKSB7XG4gICAgc2V0U2ltcGxlU2VsZWN0aW9uKHRoaXMsIGNsaXBQb3ModGhpcywgdHlwZW9mIGxpbmUgPT0gXCJudW1iZXJcIiA/IFBvcyhsaW5lLCBjaCB8fCAwKSA6IGxpbmUpLCBudWxsLCBvcHRpb25zKTtcbiAgfSksXG4gIHNldFNlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oYW5jaG9yLCBoZWFkLCBvcHRpb25zKSB7XG4gICAgc2V0U2ltcGxlU2VsZWN0aW9uKHRoaXMsIGNsaXBQb3ModGhpcywgYW5jaG9yKSwgY2xpcFBvcyh0aGlzLCBoZWFkIHx8IGFuY2hvciksIG9wdGlvbnMpO1xuICB9KSxcbiAgZXh0ZW5kU2VsZWN0aW9uOiBkb2NNZXRob2RPcChmdW5jdGlvbihoZWFkLCBvdGhlciwgb3B0aW9ucykge1xuICAgIGV4dGVuZFNlbGVjdGlvbih0aGlzLCBjbGlwUG9zKHRoaXMsIGhlYWQpLCBvdGhlciAmJiBjbGlwUG9zKHRoaXMsIG90aGVyKSwgb3B0aW9ucyk7XG4gIH0pLFxuICBleHRlbmRTZWxlY3Rpb25zOiBkb2NNZXRob2RPcChmdW5jdGlvbihoZWFkcywgb3B0aW9ucykge1xuICAgIGV4dGVuZFNlbGVjdGlvbnModGhpcywgY2xpcFBvc0FycmF5KHRoaXMsIGhlYWRzKSwgb3B0aW9ucyk7XG4gIH0pLFxuICBleHRlbmRTZWxlY3Rpb25zQnk6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGYsIG9wdGlvbnMpIHtcbiAgICB2YXIgaGVhZHMgPSBtYXAodGhpcy5zZWwucmFuZ2VzLCBmKTtcbiAgICBleHRlbmRTZWxlY3Rpb25zKHRoaXMsIGNsaXBQb3NBcnJheSh0aGlzLCBoZWFkcyksIG9wdGlvbnMpO1xuICB9KSxcbiAgc2V0U2VsZWN0aW9uczogZG9jTWV0aG9kT3AoZnVuY3Rpb24ocmFuZ2VzLCBwcmltYXJ5LCBvcHRpb25zKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICBpZiAoIXJhbmdlcy5sZW5ndGgpIHsgcmV0dXJuIH1cbiAgICB2YXIgb3V0ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICB7IG91dFtpXSA9IG5ldyBSYW5nZShjbGlwUG9zKHRoaXMkMSwgcmFuZ2VzW2ldLmFuY2hvciksXG4gICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyh0aGlzJDEsIHJhbmdlc1tpXS5oZWFkKSk7IH1cbiAgICBpZiAocHJpbWFyeSA9PSBudWxsKSB7IHByaW1hcnkgPSBNYXRoLm1pbihyYW5nZXMubGVuZ3RoIC0gMSwgdGhpcy5zZWwucHJpbUluZGV4KTsgfVxuICAgIHNldFNlbGVjdGlvbih0aGlzLCBub3JtYWxpemVTZWxlY3Rpb24ob3V0LCBwcmltYXJ5KSwgb3B0aW9ucyk7XG4gIH0pLFxuICBhZGRTZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGFuY2hvciwgaGVhZCwgb3B0aW9ucykge1xuICAgIHZhciByYW5nZXMgPSB0aGlzLnNlbC5yYW5nZXMuc2xpY2UoMCk7XG4gICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKGNsaXBQb3ModGhpcywgYW5jaG9yKSwgY2xpcFBvcyh0aGlzLCBoZWFkIHx8IGFuY2hvcikpKTtcbiAgICBzZXRTZWxlY3Rpb24odGhpcywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgcmFuZ2VzLmxlbmd0aCAtIDEpLCBvcHRpb25zKTtcbiAgfSksXG5cbiAgZ2V0U2VsZWN0aW9uOiBmdW5jdGlvbihsaW5lU2VwKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICB2YXIgcmFuZ2VzID0gdGhpcy5zZWwucmFuZ2VzLCBsaW5lcztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHNlbCA9IGdldEJldHdlZW4odGhpcyQxLCByYW5nZXNbaV0uZnJvbSgpLCByYW5nZXNbaV0udG8oKSk7XG4gICAgICBsaW5lcyA9IGxpbmVzID8gbGluZXMuY29uY2F0KHNlbCkgOiBzZWw7XG4gICAgfVxuICAgIGlmIChsaW5lU2VwID09PSBmYWxzZSkgeyByZXR1cm4gbGluZXMgfVxuICAgIGVsc2UgeyByZXR1cm4gbGluZXMuam9pbihsaW5lU2VwIHx8IHRoaXMubGluZVNlcGFyYXRvcigpKSB9XG4gIH0sXG4gIGdldFNlbGVjdGlvbnM6IGZ1bmN0aW9uKGxpbmVTZXApIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICAgIHZhciBwYXJ0cyA9IFtdLCByYW5nZXMgPSB0aGlzLnNlbC5yYW5nZXM7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzZWwgPSBnZXRCZXR3ZWVuKHRoaXMkMSwgcmFuZ2VzW2ldLmZyb20oKSwgcmFuZ2VzW2ldLnRvKCkpO1xuICAgICAgaWYgKGxpbmVTZXAgIT09IGZhbHNlKSB7IHNlbCA9IHNlbC5qb2luKGxpbmVTZXAgfHwgdGhpcyQxLmxpbmVTZXBhcmF0b3IoKSk7IH1cbiAgICAgIHBhcnRzW2ldID0gc2VsO1xuICAgIH1cbiAgICByZXR1cm4gcGFydHNcbiAgfSxcbiAgcmVwbGFjZVNlbGVjdGlvbjogZnVuY3Rpb24oY29kZSwgY29sbGFwc2UsIG9yaWdpbikge1xuICAgIHZhciBkdXAgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc2VsLnJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICAgIHsgZHVwW2ldID0gY29kZTsgfVxuICAgIHRoaXMucmVwbGFjZVNlbGVjdGlvbnMoZHVwLCBjb2xsYXBzZSwgb3JpZ2luIHx8IFwiK2lucHV0XCIpO1xuICB9LFxuICByZXBsYWNlU2VsZWN0aW9uczogZG9jTWV0aG9kT3AoZnVuY3Rpb24oY29kZSwgY29sbGFwc2UsIG9yaWdpbikge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gICAgdmFyIGNoYW5nZXMgPSBbXSwgc2VsID0gdGhpcy5zZWw7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcmFuZ2UkJDEgPSBzZWwucmFuZ2VzW2ldO1xuICAgICAgY2hhbmdlc1tpXSA9IHtmcm9tOiByYW5nZSQkMS5mcm9tKCksIHRvOiByYW5nZSQkMS50bygpLCB0ZXh0OiB0aGlzJDEuc3BsaXRMaW5lcyhjb2RlW2ldKSwgb3JpZ2luOiBvcmlnaW59O1xuICAgIH1cbiAgICB2YXIgbmV3U2VsID0gY29sbGFwc2UgJiYgY29sbGFwc2UgIT0gXCJlbmRcIiAmJiBjb21wdXRlUmVwbGFjZWRTZWwodGhpcywgY2hhbmdlcywgY29sbGFwc2UpO1xuICAgIGZvciAodmFyIGkkMSA9IGNoYW5nZXMubGVuZ3RoIC0gMTsgaSQxID49IDA7IGkkMS0tKVxuICAgICAgeyBtYWtlQ2hhbmdlKHRoaXMkMSwgY2hhbmdlc1tpJDFdKTsgfVxuICAgIGlmIChuZXdTZWwpIHsgc2V0U2VsZWN0aW9uUmVwbGFjZUhpc3RvcnkodGhpcywgbmV3U2VsKTsgfVxuICAgIGVsc2UgaWYgKHRoaXMuY20pIHsgZW5zdXJlQ3Vyc29yVmlzaWJsZSh0aGlzLmNtKTsgfVxuICB9KSxcbiAgdW5kbzogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwidW5kb1wiKTt9KSxcbiAgcmVkbzogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwicmVkb1wiKTt9KSxcbiAgdW5kb1NlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwidW5kb1wiLCB0cnVlKTt9KSxcbiAgcmVkb1NlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwicmVkb1wiLCB0cnVlKTt9KSxcblxuICBzZXRFeHRlbmRpbmc6IGZ1bmN0aW9uKHZhbCkge3RoaXMuZXh0ZW5kID0gdmFsO30sXG4gIGdldEV4dGVuZGluZzogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuZXh0ZW5kfSxcblxuICBoaXN0b3J5U2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGhpc3QgPSB0aGlzLmhpc3RvcnksIGRvbmUgPSAwLCB1bmRvbmUgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGlzdC5kb25lLmxlbmd0aDsgaSsrKSB7IGlmICghaGlzdC5kb25lW2ldLnJhbmdlcykgeyArK2RvbmU7IH0gfVxuICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGhpc3QudW5kb25lLmxlbmd0aDsgaSQxKyspIHsgaWYgKCFoaXN0LnVuZG9uZVtpJDFdLnJhbmdlcykgeyArK3VuZG9uZTsgfSB9XG4gICAgcmV0dXJuIHt1bmRvOiBkb25lLCByZWRvOiB1bmRvbmV9XG4gIH0sXG4gIGNsZWFySGlzdG9yeTogZnVuY3Rpb24oKSB7dGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcy5oaXN0b3J5Lm1heEdlbmVyYXRpb24pO30sXG5cbiAgbWFya0NsZWFuOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsZWFuR2VuZXJhdGlvbiA9IHRoaXMuY2hhbmdlR2VuZXJhdGlvbih0cnVlKTtcbiAgfSxcbiAgY2hhbmdlR2VuZXJhdGlvbjogZnVuY3Rpb24oZm9yY2VTcGxpdCkge1xuICAgIGlmIChmb3JjZVNwbGl0KVxuICAgICAgeyB0aGlzLmhpc3RvcnkubGFzdE9wID0gdGhpcy5oaXN0b3J5Lmxhc3RTZWxPcCA9IHRoaXMuaGlzdG9yeS5sYXN0T3JpZ2luID0gbnVsbDsgfVxuICAgIHJldHVybiB0aGlzLmhpc3RvcnkuZ2VuZXJhdGlvblxuICB9LFxuICBpc0NsZWFuOiBmdW5jdGlvbiAoZ2VuKSB7XG4gICAgcmV0dXJuIHRoaXMuaGlzdG9yeS5nZW5lcmF0aW9uID09IChnZW4gfHwgdGhpcy5jbGVhbkdlbmVyYXRpb24pXG4gIH0sXG5cbiAgZ2V0SGlzdG9yeTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtkb25lOiBjb3B5SGlzdG9yeUFycmF5KHRoaXMuaGlzdG9yeS5kb25lKSxcbiAgICAgICAgICAgIHVuZG9uZTogY29weUhpc3RvcnlBcnJheSh0aGlzLmhpc3RvcnkudW5kb25lKX1cbiAgfSxcbiAgc2V0SGlzdG9yeTogZnVuY3Rpb24oaGlzdERhdGEpIHtcbiAgICB2YXIgaGlzdCA9IHRoaXMuaGlzdG9yeSA9IG5ldyBIaXN0b3J5KHRoaXMuaGlzdG9yeS5tYXhHZW5lcmF0aW9uKTtcbiAgICBoaXN0LmRvbmUgPSBjb3B5SGlzdG9yeUFycmF5KGhpc3REYXRhLmRvbmUuc2xpY2UoMCksIG51bGwsIHRydWUpO1xuICAgIGhpc3QudW5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS51bmRvbmUuc2xpY2UoMCksIG51bGwsIHRydWUpO1xuICB9LFxuXG4gIHNldEd1dHRlck1hcmtlcjogZG9jTWV0aG9kT3AoZnVuY3Rpb24obGluZSwgZ3V0dGVySUQsIHZhbHVlKSB7XG4gICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgbGluZSwgXCJndXR0ZXJcIiwgZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgIHZhciBtYXJrZXJzID0gbGluZS5ndXR0ZXJNYXJrZXJzIHx8IChsaW5lLmd1dHRlck1hcmtlcnMgPSB7fSk7XG4gICAgICBtYXJrZXJzW2d1dHRlcklEXSA9IHZhbHVlO1xuICAgICAgaWYgKCF2YWx1ZSAmJiBpc0VtcHR5KG1hcmtlcnMpKSB7IGxpbmUuZ3V0dGVyTWFya2VycyA9IG51bGw7IH1cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSlcbiAgfSksXG5cbiAgY2xlYXJHdXR0ZXI6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGd1dHRlcklEKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICB0aGlzLml0ZXIoZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgIGlmIChsaW5lLmd1dHRlck1hcmtlcnMgJiYgbGluZS5ndXR0ZXJNYXJrZXJzW2d1dHRlcklEXSkge1xuICAgICAgICBjaGFuZ2VMaW5lKHRoaXMkMSwgbGluZSwgXCJndXR0ZXJcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGxpbmUuZ3V0dGVyTWFya2Vyc1tndXR0ZXJJRF0gPSBudWxsO1xuICAgICAgICAgIGlmIChpc0VtcHR5KGxpbmUuZ3V0dGVyTWFya2VycykpIHsgbGluZS5ndXR0ZXJNYXJrZXJzID0gbnVsbDsgfVxuICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9KSxcblxuICBsaW5lSW5mbzogZnVuY3Rpb24obGluZSkge1xuICAgIHZhciBuO1xuICAgIGlmICh0eXBlb2YgbGluZSA9PSBcIm51bWJlclwiKSB7XG4gICAgICBpZiAoIWlzTGluZSh0aGlzLCBsaW5lKSkgeyByZXR1cm4gbnVsbCB9XG4gICAgICBuID0gbGluZTtcbiAgICAgIGxpbmUgPSBnZXRMaW5lKHRoaXMsIGxpbmUpO1xuICAgICAgaWYgKCFsaW5lKSB7IHJldHVybiBudWxsIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbiA9IGxpbmVObyhsaW5lKTtcbiAgICAgIGlmIChuID09IG51bGwpIHsgcmV0dXJuIG51bGwgfVxuICAgIH1cbiAgICByZXR1cm4ge2xpbmU6IG4sIGhhbmRsZTogbGluZSwgdGV4dDogbGluZS50ZXh0LCBndXR0ZXJNYXJrZXJzOiBsaW5lLmd1dHRlck1hcmtlcnMsXG4gICAgICAgICAgICB0ZXh0Q2xhc3M6IGxpbmUudGV4dENsYXNzLCBiZ0NsYXNzOiBsaW5lLmJnQ2xhc3MsIHdyYXBDbGFzczogbGluZS53cmFwQ2xhc3MsXG4gICAgICAgICAgICB3aWRnZXRzOiBsaW5lLndpZGdldHN9XG4gIH0sXG5cbiAgYWRkTGluZUNsYXNzOiBkb2NNZXRob2RPcChmdW5jdGlvbihoYW5kbGUsIHdoZXJlLCBjbHMpIHtcbiAgICByZXR1cm4gY2hhbmdlTGluZSh0aGlzLCBoYW5kbGUsIHdoZXJlID09IFwiZ3V0dGVyXCIgPyBcImd1dHRlclwiIDogXCJjbGFzc1wiLCBmdW5jdGlvbiAobGluZSkge1xuICAgICAgdmFyIHByb3AgPSB3aGVyZSA9PSBcInRleHRcIiA/IFwidGV4dENsYXNzXCJcbiAgICAgICAgICAgICAgIDogd2hlcmUgPT0gXCJiYWNrZ3JvdW5kXCIgPyBcImJnQ2xhc3NcIlxuICAgICAgICAgICAgICAgOiB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJDbGFzc1wiIDogXCJ3cmFwQ2xhc3NcIjtcbiAgICAgIGlmICghbGluZVtwcm9wXSkgeyBsaW5lW3Byb3BdID0gY2xzOyB9XG4gICAgICBlbHNlIGlmIChjbGFzc1Rlc3QoY2xzKS50ZXN0KGxpbmVbcHJvcF0pKSB7IHJldHVybiBmYWxzZSB9XG4gICAgICBlbHNlIHsgbGluZVtwcm9wXSArPSBcIiBcIiArIGNsczsgfVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9KVxuICB9KSxcbiAgcmVtb3ZlTGluZUNsYXNzOiBkb2NNZXRob2RPcChmdW5jdGlvbihoYW5kbGUsIHdoZXJlLCBjbHMpIHtcbiAgICByZXR1cm4gY2hhbmdlTGluZSh0aGlzLCBoYW5kbGUsIHdoZXJlID09IFwiZ3V0dGVyXCIgPyBcImd1dHRlclwiIDogXCJjbGFzc1wiLCBmdW5jdGlvbiAobGluZSkge1xuICAgICAgdmFyIHByb3AgPSB3aGVyZSA9PSBcInRleHRcIiA/IFwidGV4dENsYXNzXCJcbiAgICAgICAgICAgICAgIDogd2hlcmUgPT0gXCJiYWNrZ3JvdW5kXCIgPyBcImJnQ2xhc3NcIlxuICAgICAgICAgICAgICAgOiB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJDbGFzc1wiIDogXCJ3cmFwQ2xhc3NcIjtcbiAgICAgIHZhciBjdXIgPSBsaW5lW3Byb3BdO1xuICAgICAgaWYgKCFjdXIpIHsgcmV0dXJuIGZhbHNlIH1cbiAgICAgIGVsc2UgaWYgKGNscyA9PSBudWxsKSB7IGxpbmVbcHJvcF0gPSBudWxsOyB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdmFyIGZvdW5kID0gY3VyLm1hdGNoKGNsYXNzVGVzdChjbHMpKTtcbiAgICAgICAgaWYgKCFmb3VuZCkgeyByZXR1cm4gZmFsc2UgfVxuICAgICAgICB2YXIgZW5kID0gZm91bmQuaW5kZXggKyBmb3VuZFswXS5sZW5ndGg7XG4gICAgICAgIGxpbmVbcHJvcF0gPSBjdXIuc2xpY2UoMCwgZm91bmQuaW5kZXgpICsgKCFmb3VuZC5pbmRleCB8fCBlbmQgPT0gY3VyLmxlbmd0aCA/IFwiXCIgOiBcIiBcIikgKyBjdXIuc2xpY2UoZW5kKSB8fCBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9KVxuICB9KSxcblxuICBhZGRMaW5lV2lkZ2V0OiBkb2NNZXRob2RPcChmdW5jdGlvbihoYW5kbGUsIG5vZGUsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gYWRkTGluZVdpZGdldCh0aGlzLCBoYW5kbGUsIG5vZGUsIG9wdGlvbnMpXG4gIH0pLFxuICByZW1vdmVMaW5lV2lkZ2V0OiBmdW5jdGlvbih3aWRnZXQpIHsgd2lkZ2V0LmNsZWFyKCk7IH0sXG5cbiAgbWFya1RleHQ6IGZ1bmN0aW9uKGZyb20sIHRvLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIG1hcmtUZXh0KHRoaXMsIGNsaXBQb3ModGhpcywgZnJvbSksIGNsaXBQb3ModGhpcywgdG8pLCBvcHRpb25zLCBvcHRpb25zICYmIG9wdGlvbnMudHlwZSB8fCBcInJhbmdlXCIpXG4gIH0sXG4gIHNldEJvb2ttYXJrOiBmdW5jdGlvbihwb3MsIG9wdGlvbnMpIHtcbiAgICB2YXIgcmVhbE9wdHMgPSB7cmVwbGFjZWRXaXRoOiBvcHRpb25zICYmIChvcHRpb25zLm5vZGVUeXBlID09IG51bGwgPyBvcHRpb25zLndpZGdldCA6IG9wdGlvbnMpLFxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRMZWZ0OiBvcHRpb25zICYmIG9wdGlvbnMuaW5zZXJ0TGVmdCxcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJXaGVuRW1wdHk6IGZhbHNlLCBzaGFyZWQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5zaGFyZWQsXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZU1vdXNlRXZlbnRzOiBvcHRpb25zICYmIG9wdGlvbnMuaGFuZGxlTW91c2VFdmVudHN9O1xuICAgIHBvcyA9IGNsaXBQb3ModGhpcywgcG9zKTtcbiAgICByZXR1cm4gbWFya1RleHQodGhpcywgcG9zLCBwb3MsIHJlYWxPcHRzLCBcImJvb2ttYXJrXCIpXG4gIH0sXG4gIGZpbmRNYXJrc0F0OiBmdW5jdGlvbihwb3MpIHtcbiAgICBwb3MgPSBjbGlwUG9zKHRoaXMsIHBvcyk7XG4gICAgdmFyIG1hcmtlcnMgPSBbXSwgc3BhbnMgPSBnZXRMaW5lKHRoaXMsIHBvcy5saW5lKS5tYXJrZWRTcGFucztcbiAgICBpZiAoc3BhbnMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgIGlmICgoc3Bhbi5mcm9tID09IG51bGwgfHwgc3Bhbi5mcm9tIDw9IHBvcy5jaCkgJiZcbiAgICAgICAgICAoc3Bhbi50byA9PSBudWxsIHx8IHNwYW4udG8gPj0gcG9zLmNoKSlcbiAgICAgICAgeyBtYXJrZXJzLnB1c2goc3Bhbi5tYXJrZXIucGFyZW50IHx8IHNwYW4ubWFya2VyKTsgfVxuICAgIH0gfVxuICAgIHJldHVybiBtYXJrZXJzXG4gIH0sXG4gIGZpbmRNYXJrczogZnVuY3Rpb24oZnJvbSwgdG8sIGZpbHRlcikge1xuICAgIGZyb20gPSBjbGlwUG9zKHRoaXMsIGZyb20pOyB0byA9IGNsaXBQb3ModGhpcywgdG8pO1xuICAgIHZhciBmb3VuZCA9IFtdLCBsaW5lTm8kJDEgPSBmcm9tLmxpbmU7XG4gICAgdGhpcy5pdGVyKGZyb20ubGluZSwgdG8ubGluZSArIDEsIGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICB2YXIgc3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zO1xuICAgICAgaWYgKHNwYW5zKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgICAgaWYgKCEoc3Bhbi50byAhPSBudWxsICYmIGxpbmVObyQkMSA9PSBmcm9tLmxpbmUgJiYgZnJvbS5jaCA+PSBzcGFuLnRvIHx8XG4gICAgICAgICAgICAgIHNwYW4uZnJvbSA9PSBudWxsICYmIGxpbmVObyQkMSAhPSBmcm9tLmxpbmUgfHxcbiAgICAgICAgICAgICAgc3Bhbi5mcm9tICE9IG51bGwgJiYgbGluZU5vJCQxID09IHRvLmxpbmUgJiYgc3Bhbi5mcm9tID49IHRvLmNoKSAmJlxuICAgICAgICAgICAgKCFmaWx0ZXIgfHwgZmlsdGVyKHNwYW4ubWFya2VyKSkpXG4gICAgICAgICAgeyBmb3VuZC5wdXNoKHNwYW4ubWFya2VyLnBhcmVudCB8fCBzcGFuLm1hcmtlcik7IH1cbiAgICAgIH0gfVxuICAgICAgKytsaW5lTm8kJDE7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvdW5kXG4gIH0sXG4gIGdldEFsbE1hcmtzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbWFya2VycyA9IFtdO1xuICAgIHRoaXMuaXRlcihmdW5jdGlvbiAobGluZSkge1xuICAgICAgdmFyIHNwcyA9IGxpbmUubWFya2VkU3BhbnM7XG4gICAgICBpZiAoc3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKVxuICAgICAgICB7IGlmIChzcHNbaV0uZnJvbSAhPSBudWxsKSB7IG1hcmtlcnMucHVzaChzcHNbaV0ubWFya2VyKTsgfSB9IH1cbiAgICB9KTtcbiAgICByZXR1cm4gbWFya2Vyc1xuICB9LFxuXG4gIHBvc0Zyb21JbmRleDogZnVuY3Rpb24ob2ZmKSB7XG4gICAgdmFyIGNoLCBsaW5lTm8kJDEgPSB0aGlzLmZpcnN0LCBzZXBTaXplID0gdGhpcy5saW5lU2VwYXJhdG9yKCkubGVuZ3RoO1xuICAgIHRoaXMuaXRlcihmdW5jdGlvbiAobGluZSkge1xuICAgICAgdmFyIHN6ID0gbGluZS50ZXh0Lmxlbmd0aCArIHNlcFNpemU7XG4gICAgICBpZiAoc3ogPiBvZmYpIHsgY2ggPSBvZmY7IHJldHVybiB0cnVlIH1cbiAgICAgIG9mZiAtPSBzejtcbiAgICAgICsrbGluZU5vJCQxO1xuICAgIH0pO1xuICAgIHJldHVybiBjbGlwUG9zKHRoaXMsIFBvcyhsaW5lTm8kJDEsIGNoKSlcbiAgfSxcbiAgaW5kZXhGcm9tUG9zOiBmdW5jdGlvbiAoY29vcmRzKSB7XG4gICAgY29vcmRzID0gY2xpcFBvcyh0aGlzLCBjb29yZHMpO1xuICAgIHZhciBpbmRleCA9IGNvb3Jkcy5jaDtcbiAgICBpZiAoY29vcmRzLmxpbmUgPCB0aGlzLmZpcnN0IHx8IGNvb3Jkcy5jaCA8IDApIHsgcmV0dXJuIDAgfVxuICAgIHZhciBzZXBTaXplID0gdGhpcy5saW5lU2VwYXJhdG9yKCkubGVuZ3RoO1xuICAgIHRoaXMuaXRlcih0aGlzLmZpcnN0LCBjb29yZHMubGluZSwgZnVuY3Rpb24gKGxpbmUpIHsgLy8gaXRlciBhYm9ydHMgd2hlbiBjYWxsYmFjayByZXR1cm5zIGEgdHJ1dGh5IHZhbHVlXG4gICAgICBpbmRleCArPSBsaW5lLnRleHQubGVuZ3RoICsgc2VwU2l6ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gaW5kZXhcbiAgfSxcblxuICBjb3B5OiBmdW5jdGlvbihjb3B5SGlzdG9yeSkge1xuICAgIHZhciBkb2MgPSBuZXcgRG9jKGdldExpbmVzKHRoaXMsIHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUpLFxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZU9wdGlvbiwgdGhpcy5maXJzdCwgdGhpcy5saW5lU2VwLCB0aGlzLmRpcmVjdGlvbik7XG4gICAgZG9jLnNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wOyBkb2Muc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcbiAgICBkb2Muc2VsID0gdGhpcy5zZWw7XG4gICAgZG9jLmV4dGVuZCA9IGZhbHNlO1xuICAgIGlmIChjb3B5SGlzdG9yeSkge1xuICAgICAgZG9jLmhpc3RvcnkudW5kb0RlcHRoID0gdGhpcy5oaXN0b3J5LnVuZG9EZXB0aDtcbiAgICAgIGRvYy5zZXRIaXN0b3J5KHRoaXMuZ2V0SGlzdG9yeSgpKTtcbiAgICB9XG4gICAgcmV0dXJuIGRvY1xuICB9LFxuXG4gIGxpbmtlZERvYzogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIGlmICghb3B0aW9ucykgeyBvcHRpb25zID0ge307IH1cbiAgICB2YXIgZnJvbSA9IHRoaXMuZmlyc3QsIHRvID0gdGhpcy5maXJzdCArIHRoaXMuc2l6ZTtcbiAgICBpZiAob3B0aW9ucy5mcm9tICE9IG51bGwgJiYgb3B0aW9ucy5mcm9tID4gZnJvbSkgeyBmcm9tID0gb3B0aW9ucy5mcm9tOyB9XG4gICAgaWYgKG9wdGlvbnMudG8gIT0gbnVsbCAmJiBvcHRpb25zLnRvIDwgdG8pIHsgdG8gPSBvcHRpb25zLnRvOyB9XG4gICAgdmFyIGNvcHkgPSBuZXcgRG9jKGdldExpbmVzKHRoaXMsIGZyb20sIHRvKSwgb3B0aW9ucy5tb2RlIHx8IHRoaXMubW9kZU9wdGlvbiwgZnJvbSwgdGhpcy5saW5lU2VwLCB0aGlzLmRpcmVjdGlvbik7XG4gICAgaWYgKG9wdGlvbnMuc2hhcmVkSGlzdCkgeyBjb3B5Lmhpc3RvcnkgPSB0aGlzLmhpc3RvcnlcbiAgICA7IH0odGhpcy5saW5rZWQgfHwgKHRoaXMubGlua2VkID0gW10pKS5wdXNoKHtkb2M6IGNvcHksIHNoYXJlZEhpc3Q6IG9wdGlvbnMuc2hhcmVkSGlzdH0pO1xuICAgIGNvcHkubGlua2VkID0gW3tkb2M6IHRoaXMsIGlzUGFyZW50OiB0cnVlLCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9XTtcbiAgICBjb3B5U2hhcmVkTWFya2Vycyhjb3B5LCBmaW5kU2hhcmVkTWFya2Vycyh0aGlzKSk7XG4gICAgcmV0dXJuIGNvcHlcbiAgfSxcbiAgdW5saW5rRG9jOiBmdW5jdGlvbihvdGhlcikge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gICAgaWYgKG90aGVyIGluc3RhbmNlb2YgQ29kZU1pcnJvciQxKSB7IG90aGVyID0gb3RoZXIuZG9jOyB9XG4gICAgaWYgKHRoaXMubGlua2VkKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5rZWQubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBsaW5rID0gdGhpcyQxLmxpbmtlZFtpXTtcbiAgICAgIGlmIChsaW5rLmRvYyAhPSBvdGhlcikgeyBjb250aW51ZSB9XG4gICAgICB0aGlzJDEubGlua2VkLnNwbGljZShpLCAxKTtcbiAgICAgIG90aGVyLnVubGlua0RvYyh0aGlzJDEpO1xuICAgICAgZGV0YWNoU2hhcmVkTWFya2VycyhmaW5kU2hhcmVkTWFya2Vycyh0aGlzJDEpKTtcbiAgICAgIGJyZWFrXG4gICAgfSB9XG4gICAgLy8gSWYgdGhlIGhpc3RvcmllcyB3ZXJlIHNoYXJlZCwgc3BsaXQgdGhlbSBhZ2FpblxuICAgIGlmIChvdGhlci5oaXN0b3J5ID09IHRoaXMuaGlzdG9yeSkge1xuICAgICAgdmFyIHNwbGl0SWRzID0gW290aGVyLmlkXTtcbiAgICAgIGxpbmtlZERvY3Mob3RoZXIsIGZ1bmN0aW9uIChkb2MpIHsgcmV0dXJuIHNwbGl0SWRzLnB1c2goZG9jLmlkKTsgfSwgdHJ1ZSk7XG4gICAgICBvdGhlci5oaXN0b3J5ID0gbmV3IEhpc3RvcnkobnVsbCk7XG4gICAgICBvdGhlci5oaXN0b3J5LmRvbmUgPSBjb3B5SGlzdG9yeUFycmF5KHRoaXMuaGlzdG9yeS5kb25lLCBzcGxpdElkcyk7XG4gICAgICBvdGhlci5oaXN0b3J5LnVuZG9uZSA9IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LnVuZG9uZSwgc3BsaXRJZHMpO1xuICAgIH1cbiAgfSxcbiAgaXRlckxpbmtlZERvY3M6IGZ1bmN0aW9uKGYpIHtsaW5rZWREb2NzKHRoaXMsIGYpO30sXG5cbiAgZ2V0TW9kZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMubW9kZX0sXG4gIGdldEVkaXRvcjogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuY219LFxuXG4gIHNwbGl0TGluZXM6IGZ1bmN0aW9uKHN0cikge1xuICAgIGlmICh0aGlzLmxpbmVTZXApIHsgcmV0dXJuIHN0ci5zcGxpdCh0aGlzLmxpbmVTZXApIH1cbiAgICByZXR1cm4gc3BsaXRMaW5lc0F1dG8oc3RyKVxuICB9LFxuICBsaW5lU2VwYXJhdG9yOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubGluZVNlcCB8fCBcIlxcblwiIH0sXG5cbiAgc2V0RGlyZWN0aW9uOiBkb2NNZXRob2RPcChmdW5jdGlvbiAoZGlyKSB7XG4gICAgaWYgKGRpciAhPSBcInJ0bFwiKSB7IGRpciA9IFwibHRyXCI7IH1cbiAgICBpZiAoZGlyID09IHRoaXMuZGlyZWN0aW9uKSB7IHJldHVybiB9XG4gICAgdGhpcy5kaXJlY3Rpb24gPSBkaXI7XG4gICAgdGhpcy5pdGVyKGZ1bmN0aW9uIChsaW5lKSB7IHJldHVybiBsaW5lLm9yZGVyID0gbnVsbDsgfSk7XG4gICAgaWYgKHRoaXMuY20pIHsgZGlyZWN0aW9uQ2hhbmdlZCh0aGlzLmNtKTsgfVxuICB9KVxufSk7XG5cbi8vIFB1YmxpYyBhbGlhcy5cbkRvYy5wcm90b3R5cGUuZWFjaExpbmUgPSBEb2MucHJvdG90eXBlLml0ZXI7XG5cbi8vIEtsdWRnZSB0byB3b3JrIGFyb3VuZCBzdHJhbmdlIElFIGJlaGF2aW9yIHdoZXJlIGl0J2xsIHNvbWV0aW1lc1xuLy8gcmUtZmlyZSBhIHNlcmllcyBvZiBkcmFnLXJlbGF0ZWQgZXZlbnRzIHJpZ2h0IGFmdGVyIHRoZSBkcm9wICgjMTU1MSlcbnZhciBsYXN0RHJvcCA9IDA7XG5cbmZ1bmN0aW9uIG9uRHJvcChlKSB7XG4gIHZhciBjbSA9IHRoaXM7XG4gIGNsZWFyRHJhZ0N1cnNvcihjbSk7XG4gIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSlcbiAgICB7IHJldHVybiB9XG4gIGVfcHJldmVudERlZmF1bHQoZSk7XG4gIGlmIChpZSkgeyBsYXN0RHJvcCA9ICtuZXcgRGF0ZTsgfVxuICB2YXIgcG9zID0gcG9zRnJvbU1vdXNlKGNtLCBlLCB0cnVlKSwgZmlsZXMgPSBlLmRhdGFUcmFuc2Zlci5maWxlcztcbiAgaWYgKCFwb3MgfHwgY20uaXNSZWFkT25seSgpKSB7IHJldHVybiB9XG4gIC8vIE1pZ2h0IGJlIGEgZmlsZSBkcm9wLCBpbiB3aGljaCBjYXNlIHdlIHNpbXBseSBleHRyYWN0IHRoZSB0ZXh0XG4gIC8vIGFuZCBpbnNlcnQgaXQuXG4gIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggJiYgd2luZG93LkZpbGVSZWFkZXIgJiYgd2luZG93LkZpbGUpIHtcbiAgICB2YXIgbiA9IGZpbGVzLmxlbmd0aCwgdGV4dCA9IEFycmF5KG4pLCByZWFkID0gMDtcbiAgICB2YXIgbG9hZEZpbGUgPSBmdW5jdGlvbiAoZmlsZSwgaSkge1xuICAgICAgaWYgKGNtLm9wdGlvbnMuYWxsb3dEcm9wRmlsZVR5cGVzICYmXG4gICAgICAgICAgaW5kZXhPZihjbS5vcHRpb25zLmFsbG93RHJvcEZpbGVUeXBlcywgZmlsZS50eXBlKSA9PSAtMSlcbiAgICAgICAgeyByZXR1cm4gfVxuXG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXI7XG4gICAgICByZWFkZXIub25sb2FkID0gb3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb250ZW50ID0gcmVhZGVyLnJlc3VsdDtcbiAgICAgICAgaWYgKC9bXFx4MDAtXFx4MDhcXHgwZS1cXHgxZl17Mn0vLnRlc3QoY29udGVudCkpIHsgY29udGVudCA9IFwiXCI7IH1cbiAgICAgICAgdGV4dFtpXSA9IGNvbnRlbnQ7XG4gICAgICAgIGlmICgrK3JlYWQgPT0gbikge1xuICAgICAgICAgIHBvcyA9IGNsaXBQb3MoY20uZG9jLCBwb3MpO1xuICAgICAgICAgIHZhciBjaGFuZ2UgPSB7ZnJvbTogcG9zLCB0bzogcG9zLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogY20uZG9jLnNwbGl0TGluZXModGV4dC5qb2luKGNtLmRvYy5saW5lU2VwYXJhdG9yKCkpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbjogXCJwYXN0ZVwifTtcbiAgICAgICAgICBtYWtlQ2hhbmdlKGNtLmRvYywgY2hhbmdlKTtcbiAgICAgICAgICBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeShjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihwb3MsIGNoYW5nZUVuZChjaGFuZ2UpKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7XG4gICAgfTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG47ICsraSkgeyBsb2FkRmlsZShmaWxlc1tpXSwgaSk7IH1cbiAgfSBlbHNlIHsgLy8gTm9ybWFsIGRyb3BcbiAgICAvLyBEb24ndCBkbyBhIHJlcGxhY2UgaWYgdGhlIGRyb3AgaGFwcGVuZWQgaW5zaWRlIG9mIHRoZSBzZWxlY3RlZCB0ZXh0LlxuICAgIGlmIChjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgJiYgY20uZG9jLnNlbC5jb250YWlucyhwb3MpID4gLTEpIHtcbiAgICAgIGNtLnN0YXRlLmRyYWdnaW5nVGV4dChlKTtcbiAgICAgIC8vIEVuc3VyZSB0aGUgZWRpdG9yIGlzIHJlLWZvY3VzZWRcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gY20uZGlzcGxheS5pbnB1dC5mb2N1cygpOyB9LCAyMCk7XG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHZhciB0ZXh0JDEgPSBlLmRhdGFUcmFuc2Zlci5nZXREYXRhKFwiVGV4dFwiKTtcbiAgICAgIGlmICh0ZXh0JDEpIHtcbiAgICAgICAgdmFyIHNlbGVjdGVkO1xuICAgICAgICBpZiAoY20uc3RhdGUuZHJhZ2dpbmdUZXh0ICYmICFjbS5zdGF0ZS5kcmFnZ2luZ1RleHQuY29weSlcbiAgICAgICAgICB7IHNlbGVjdGVkID0gY20ubGlzdFNlbGVjdGlvbnMoKTsgfVxuICAgICAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oY20uZG9jLCBzaW1wbGVTZWxlY3Rpb24ocG9zLCBwb3MpKTtcbiAgICAgICAgaWYgKHNlbGVjdGVkKSB7IGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IHNlbGVjdGVkLmxlbmd0aDsgKytpJDEpXG4gICAgICAgICAgeyByZXBsYWNlUmFuZ2UoY20uZG9jLCBcIlwiLCBzZWxlY3RlZFtpJDFdLmFuY2hvciwgc2VsZWN0ZWRbaSQxXS5oZWFkLCBcImRyYWdcIik7IH0gfVxuICAgICAgICBjbS5yZXBsYWNlU2VsZWN0aW9uKHRleHQkMSwgXCJhcm91bmRcIiwgXCJwYXN0ZVwiKTtcbiAgICAgICAgY20uZGlzcGxheS5pbnB1dC5mb2N1cygpO1xuICAgICAgfVxuICAgIH1cbiAgICBjYXRjaChlKXt9XG4gIH1cbn1cblxuZnVuY3Rpb24gb25EcmFnU3RhcnQoY20sIGUpIHtcbiAgaWYgKGllICYmICghY20uc3RhdGUuZHJhZ2dpbmdUZXh0IHx8ICtuZXcgRGF0ZSAtIGxhc3REcm9wIDwgMTAwKSkgeyBlX3N0b3AoZSk7IHJldHVybiB9XG4gIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSkgeyByZXR1cm4gfVxuXG4gIGUuZGF0YVRyYW5zZmVyLnNldERhdGEoXCJUZXh0XCIsIGNtLmdldFNlbGVjdGlvbigpKTtcbiAgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9IFwiY29weU1vdmVcIjtcblxuICAvLyBVc2UgZHVtbXkgaW1hZ2UgaW5zdGVhZCBvZiBkZWZhdWx0IGJyb3dzZXJzIGltYWdlLlxuICAvLyBSZWNlbnQgU2FmYXJpICh+Ni4wLjIpIGhhdmUgYSB0ZW5kZW5jeSB0byBzZWdmYXVsdCB3aGVuIHRoaXMgaGFwcGVucywgc28gd2UgZG9uJ3QgZG8gaXQgdGhlcmUuXG4gIGlmIChlLmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UgJiYgIXNhZmFyaSkge1xuICAgIHZhciBpbWcgPSBlbHQoXCJpbWdcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogZml4ZWQ7IGxlZnQ6IDA7IHRvcDogMDtcIik7XG4gICAgaW1nLnNyYyA9IFwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBQUFBQ0g1QkFFS0FBRUFMQUFBQUFBQkFBRUFBQUlDVEFFQU93PT1cIjtcbiAgICBpZiAocHJlc3RvKSB7XG4gICAgICBpbWcud2lkdGggPSBpbWcuaGVpZ2h0ID0gMTtcbiAgICAgIGNtLmRpc3BsYXkud3JhcHBlci5hcHBlbmRDaGlsZChpbWcpO1xuICAgICAgLy8gRm9yY2UgYSByZWxheW91dCwgb3IgT3BlcmEgd29uJ3QgdXNlIG91ciBpbWFnZSBmb3Igc29tZSBvYnNjdXJlIHJlYXNvblxuICAgICAgaW1nLl90b3AgPSBpbWcub2Zmc2V0VG9wO1xuICAgIH1cbiAgICBlLmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UoaW1nLCAwLCAwKTtcbiAgICBpZiAocHJlc3RvKSB7IGltZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGltZyk7IH1cbiAgfVxufVxuXG5mdW5jdGlvbiBvbkRyYWdPdmVyKGNtLCBlKSB7XG4gIHZhciBwb3MgPSBwb3NGcm9tTW91c2UoY20sIGUpO1xuICBpZiAoIXBvcykgeyByZXR1cm4gfVxuICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgZHJhd1NlbGVjdGlvbkN1cnNvcihjbSwgcG9zLCBmcmFnKTtcbiAgaWYgKCFjbS5kaXNwbGF5LmRyYWdDdXJzb3IpIHtcbiAgICBjbS5kaXNwbGF5LmRyYWdDdXJzb3IgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLWN1cnNvcnMgQ29kZU1pcnJvci1kcmFnY3Vyc29yc1wiKTtcbiAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5pbnNlcnRCZWZvcmUoY20uZGlzcGxheS5kcmFnQ3Vyc29yLCBjbS5kaXNwbGF5LmN1cnNvckRpdik7XG4gIH1cbiAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoY20uZGlzcGxheS5kcmFnQ3Vyc29yLCBmcmFnKTtcbn1cblxuZnVuY3Rpb24gY2xlYXJEcmFnQ3Vyc29yKGNtKSB7XG4gIGlmIChjbS5kaXNwbGF5LmRyYWdDdXJzb3IpIHtcbiAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5yZW1vdmVDaGlsZChjbS5kaXNwbGF5LmRyYWdDdXJzb3IpO1xuICAgIGNtLmRpc3BsYXkuZHJhZ0N1cnNvciA9IG51bGw7XG4gIH1cbn1cblxuLy8gVGhlc2UgbXVzdCBiZSBoYW5kbGVkIGNhcmVmdWxseSwgYmVjYXVzZSBuYWl2ZWx5IHJlZ2lzdGVyaW5nIGFcbi8vIGhhbmRsZXIgZm9yIGVhY2ggZWRpdG9yIHdpbGwgY2F1c2UgdGhlIGVkaXRvcnMgdG8gbmV2ZXIgYmVcbi8vIGdhcmJhZ2UgY29sbGVjdGVkLlxuXG5mdW5jdGlvbiBmb3JFYWNoQ29kZU1pcnJvcihmKSB7XG4gIGlmICghZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSB7IHJldHVybiB9XG4gIHZhciBieUNsYXNzID0gZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiQ29kZU1pcnJvclwiKTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBieUNsYXNzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGNtID0gYnlDbGFzc1tpXS5Db2RlTWlycm9yO1xuICAgIGlmIChjbSkgeyBmKGNtKTsgfVxuICB9XG59XG5cbnZhciBnbG9iYWxzUmVnaXN0ZXJlZCA9IGZhbHNlO1xuZnVuY3Rpb24gZW5zdXJlR2xvYmFsSGFuZGxlcnMoKSB7XG4gIGlmIChnbG9iYWxzUmVnaXN0ZXJlZCkgeyByZXR1cm4gfVxuICByZWdpc3Rlckdsb2JhbEhhbmRsZXJzKCk7XG4gIGdsb2JhbHNSZWdpc3RlcmVkID0gdHJ1ZTtcbn1cbmZ1bmN0aW9uIHJlZ2lzdGVyR2xvYmFsSGFuZGxlcnMoKSB7XG4gIC8vIFdoZW4gdGhlIHdpbmRvdyByZXNpemVzLCB3ZSBuZWVkIHRvIHJlZnJlc2ggYWN0aXZlIGVkaXRvcnMuXG4gIHZhciByZXNpemVUaW1lcjtcbiAgb24od2luZG93LCBcInJlc2l6ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHJlc2l6ZVRpbWVyID09IG51bGwpIHsgcmVzaXplVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHJlc2l6ZVRpbWVyID0gbnVsbDtcbiAgICAgIGZvckVhY2hDb2RlTWlycm9yKG9uUmVzaXplKTtcbiAgICB9LCAxMDApOyB9XG4gIH0pO1xuICAvLyBXaGVuIHRoZSB3aW5kb3cgbG9zZXMgZm9jdXMsIHdlIHdhbnQgdG8gc2hvdyB0aGUgZWRpdG9yIGFzIGJsdXJyZWRcbiAgb24od2luZG93LCBcImJsdXJcIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gZm9yRWFjaENvZGVNaXJyb3Iob25CbHVyKTsgfSk7XG59XG4vLyBDYWxsZWQgd2hlbiB0aGUgd2luZG93IHJlc2l6ZXNcbmZ1bmN0aW9uIG9uUmVzaXplKGNtKSB7XG4gIHZhciBkID0gY20uZGlzcGxheTtcbiAgaWYgKGQubGFzdFdyYXBIZWlnaHQgPT0gZC53cmFwcGVyLmNsaWVudEhlaWdodCAmJiBkLmxhc3RXcmFwV2lkdGggPT0gZC53cmFwcGVyLmNsaWVudFdpZHRoKVxuICAgIHsgcmV0dXJuIH1cbiAgLy8gTWlnaHQgYmUgYSB0ZXh0IHNjYWxpbmcgb3BlcmF0aW9uLCBjbGVhciBzaXplIGNhY2hlcy5cbiAgZC5jYWNoZWRDaGFyV2lkdGggPSBkLmNhY2hlZFRleHRIZWlnaHQgPSBkLmNhY2hlZFBhZGRpbmdIID0gbnVsbDtcbiAgZC5zY3JvbGxiYXJzQ2xpcHBlZCA9IGZhbHNlO1xuICBjbS5zZXRTaXplKCk7XG59XG5cbnZhciBrZXlOYW1lcyA9IHtcbiAgMzogXCJFbnRlclwiLCA4OiBcIkJhY2tzcGFjZVwiLCA5OiBcIlRhYlwiLCAxMzogXCJFbnRlclwiLCAxNjogXCJTaGlmdFwiLCAxNzogXCJDdHJsXCIsIDE4OiBcIkFsdFwiLFxuICAxOTogXCJQYXVzZVwiLCAyMDogXCJDYXBzTG9ja1wiLCAyNzogXCJFc2NcIiwgMzI6IFwiU3BhY2VcIiwgMzM6IFwiUGFnZVVwXCIsIDM0OiBcIlBhZ2VEb3duXCIsIDM1OiBcIkVuZFwiLFxuICAzNjogXCJIb21lXCIsIDM3OiBcIkxlZnRcIiwgMzg6IFwiVXBcIiwgMzk6IFwiUmlnaHRcIiwgNDA6IFwiRG93blwiLCA0NDogXCJQcmludFNjcm5cIiwgNDU6IFwiSW5zZXJ0XCIsXG4gIDQ2OiBcIkRlbGV0ZVwiLCA1OTogXCI7XCIsIDYxOiBcIj1cIiwgOTE6IFwiTW9kXCIsIDkyOiBcIk1vZFwiLCA5MzogXCJNb2RcIixcbiAgMTA2OiBcIipcIiwgMTA3OiBcIj1cIiwgMTA5OiBcIi1cIiwgMTEwOiBcIi5cIiwgMTExOiBcIi9cIiwgMTI3OiBcIkRlbGV0ZVwiLFxuICAxNzM6IFwiLVwiLCAxODY6IFwiO1wiLCAxODc6IFwiPVwiLCAxODg6IFwiLFwiLCAxODk6IFwiLVwiLCAxOTA6IFwiLlwiLCAxOTE6IFwiL1wiLCAxOTI6IFwiYFwiLCAyMTk6IFwiW1wiLCAyMjA6IFwiXFxcXFwiLFxuICAyMjE6IFwiXVwiLCAyMjI6IFwiJ1wiLCA2MzIzMjogXCJVcFwiLCA2MzIzMzogXCJEb3duXCIsIDYzMjM0OiBcIkxlZnRcIiwgNjMyMzU6IFwiUmlnaHRcIiwgNjMyNzI6IFwiRGVsZXRlXCIsXG4gIDYzMjczOiBcIkhvbWVcIiwgNjMyNzU6IFwiRW5kXCIsIDYzMjc2OiBcIlBhZ2VVcFwiLCA2MzI3NzogXCJQYWdlRG93blwiLCA2MzMwMjogXCJJbnNlcnRcIlxufTtcblxuLy8gTnVtYmVyIGtleXNcbmZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykgeyBrZXlOYW1lc1tpICsgNDhdID0ga2V5TmFtZXNbaSArIDk2XSA9IFN0cmluZyhpKTsgfVxuLy8gQWxwaGFiZXRpYyBrZXlzXG5mb3IgKHZhciBpJDEgPSA2NTsgaSQxIDw9IDkwOyBpJDErKykgeyBrZXlOYW1lc1tpJDFdID0gU3RyaW5nLmZyb21DaGFyQ29kZShpJDEpOyB9XG4vLyBGdW5jdGlvbiBrZXlzXG5mb3IgKHZhciBpJDIgPSAxOyBpJDIgPD0gMTI7IGkkMisrKSB7IGtleU5hbWVzW2kkMiArIDExMV0gPSBrZXlOYW1lc1tpJDIgKyA2MzIzNV0gPSBcIkZcIiArIGkkMjsgfVxuXG52YXIga2V5TWFwID0ge307XG5cbmtleU1hcC5iYXNpYyA9IHtcbiAgXCJMZWZ0XCI6IFwiZ29DaGFyTGVmdFwiLCBcIlJpZ2h0XCI6IFwiZ29DaGFyUmlnaHRcIiwgXCJVcFwiOiBcImdvTGluZVVwXCIsIFwiRG93blwiOiBcImdvTGluZURvd25cIixcbiAgXCJFbmRcIjogXCJnb0xpbmVFbmRcIiwgXCJIb21lXCI6IFwiZ29MaW5lU3RhcnRTbWFydFwiLCBcIlBhZ2VVcFwiOiBcImdvUGFnZVVwXCIsIFwiUGFnZURvd25cIjogXCJnb1BhZ2VEb3duXCIsXG4gIFwiRGVsZXRlXCI6IFwiZGVsQ2hhckFmdGVyXCIsIFwiQmFja3NwYWNlXCI6IFwiZGVsQ2hhckJlZm9yZVwiLCBcIlNoaWZ0LUJhY2tzcGFjZVwiOiBcImRlbENoYXJCZWZvcmVcIixcbiAgXCJUYWJcIjogXCJkZWZhdWx0VGFiXCIsIFwiU2hpZnQtVGFiXCI6IFwiaW5kZW50QXV0b1wiLFxuICBcIkVudGVyXCI6IFwibmV3bGluZUFuZEluZGVudFwiLCBcIkluc2VydFwiOiBcInRvZ2dsZU92ZXJ3cml0ZVwiLFxuICBcIkVzY1wiOiBcInNpbmdsZVNlbGVjdGlvblwiXG59O1xuLy8gTm90ZSB0aGF0IHRoZSBzYXZlIGFuZCBmaW5kLXJlbGF0ZWQgY29tbWFuZHMgYXJlbid0IGRlZmluZWQgYnlcbi8vIGRlZmF1bHQuIFVzZXIgY29kZSBvciBhZGRvbnMgY2FuIGRlZmluZSB0aGVtLiBVbmtub3duIGNvbW1hbmRzXG4vLyBhcmUgc2ltcGx5IGlnbm9yZWQuXG5rZXlNYXAucGNEZWZhdWx0ID0ge1xuICBcIkN0cmwtQVwiOiBcInNlbGVjdEFsbFwiLCBcIkN0cmwtRFwiOiBcImRlbGV0ZUxpbmVcIiwgXCJDdHJsLVpcIjogXCJ1bmRvXCIsIFwiU2hpZnQtQ3RybC1aXCI6IFwicmVkb1wiLCBcIkN0cmwtWVwiOiBcInJlZG9cIixcbiAgXCJDdHJsLUhvbWVcIjogXCJnb0RvY1N0YXJ0XCIsIFwiQ3RybC1FbmRcIjogXCJnb0RvY0VuZFwiLCBcIkN0cmwtVXBcIjogXCJnb0xpbmVVcFwiLCBcIkN0cmwtRG93blwiOiBcImdvTGluZURvd25cIixcbiAgXCJDdHJsLUxlZnRcIjogXCJnb0dyb3VwTGVmdFwiLCBcIkN0cmwtUmlnaHRcIjogXCJnb0dyb3VwUmlnaHRcIiwgXCJBbHQtTGVmdFwiOiBcImdvTGluZVN0YXJ0XCIsIFwiQWx0LVJpZ2h0XCI6IFwiZ29MaW5lRW5kXCIsXG4gIFwiQ3RybC1CYWNrc3BhY2VcIjogXCJkZWxHcm91cEJlZm9yZVwiLCBcIkN0cmwtRGVsZXRlXCI6IFwiZGVsR3JvdXBBZnRlclwiLCBcIkN0cmwtU1wiOiBcInNhdmVcIiwgXCJDdHJsLUZcIjogXCJmaW5kXCIsXG4gIFwiQ3RybC1HXCI6IFwiZmluZE5leHRcIiwgXCJTaGlmdC1DdHJsLUdcIjogXCJmaW5kUHJldlwiLCBcIlNoaWZ0LUN0cmwtRlwiOiBcInJlcGxhY2VcIiwgXCJTaGlmdC1DdHJsLVJcIjogXCJyZXBsYWNlQWxsXCIsXG4gIFwiQ3RybC1bXCI6IFwiaW5kZW50TGVzc1wiLCBcIkN0cmwtXVwiOiBcImluZGVudE1vcmVcIixcbiAgXCJDdHJsLVVcIjogXCJ1bmRvU2VsZWN0aW9uXCIsIFwiU2hpZnQtQ3RybC1VXCI6IFwicmVkb1NlbGVjdGlvblwiLCBcIkFsdC1VXCI6IFwicmVkb1NlbGVjdGlvblwiLFxuICBmYWxsdGhyb3VnaDogXCJiYXNpY1wiXG59O1xuLy8gVmVyeSBiYXNpYyByZWFkbGluZS9lbWFjcy1zdHlsZSBiaW5kaW5ncywgd2hpY2ggYXJlIHN0YW5kYXJkIG9uIE1hYy5cbmtleU1hcC5lbWFjc3kgPSB7XG4gIFwiQ3RybC1GXCI6IFwiZ29DaGFyUmlnaHRcIiwgXCJDdHJsLUJcIjogXCJnb0NoYXJMZWZ0XCIsIFwiQ3RybC1QXCI6IFwiZ29MaW5lVXBcIiwgXCJDdHJsLU5cIjogXCJnb0xpbmVEb3duXCIsXG4gIFwiQWx0LUZcIjogXCJnb1dvcmRSaWdodFwiLCBcIkFsdC1CXCI6IFwiZ29Xb3JkTGVmdFwiLCBcIkN0cmwtQVwiOiBcImdvTGluZVN0YXJ0XCIsIFwiQ3RybC1FXCI6IFwiZ29MaW5lRW5kXCIsXG4gIFwiQ3RybC1WXCI6IFwiZ29QYWdlRG93blwiLCBcIlNoaWZ0LUN0cmwtVlwiOiBcImdvUGFnZVVwXCIsIFwiQ3RybC1EXCI6IFwiZGVsQ2hhckFmdGVyXCIsIFwiQ3RybC1IXCI6IFwiZGVsQ2hhckJlZm9yZVwiLFxuICBcIkFsdC1EXCI6IFwiZGVsV29yZEFmdGVyXCIsIFwiQWx0LUJhY2tzcGFjZVwiOiBcImRlbFdvcmRCZWZvcmVcIiwgXCJDdHJsLUtcIjogXCJraWxsTGluZVwiLCBcIkN0cmwtVFwiOiBcInRyYW5zcG9zZUNoYXJzXCIsXG4gIFwiQ3RybC1PXCI6IFwib3BlbkxpbmVcIlxufTtcbmtleU1hcC5tYWNEZWZhdWx0ID0ge1xuICBcIkNtZC1BXCI6IFwic2VsZWN0QWxsXCIsIFwiQ21kLURcIjogXCJkZWxldGVMaW5lXCIsIFwiQ21kLVpcIjogXCJ1bmRvXCIsIFwiU2hpZnQtQ21kLVpcIjogXCJyZWRvXCIsIFwiQ21kLVlcIjogXCJyZWRvXCIsXG4gIFwiQ21kLUhvbWVcIjogXCJnb0RvY1N0YXJ0XCIsIFwiQ21kLVVwXCI6IFwiZ29Eb2NTdGFydFwiLCBcIkNtZC1FbmRcIjogXCJnb0RvY0VuZFwiLCBcIkNtZC1Eb3duXCI6IFwiZ29Eb2NFbmRcIiwgXCJBbHQtTGVmdFwiOiBcImdvR3JvdXBMZWZ0XCIsXG4gIFwiQWx0LVJpZ2h0XCI6IFwiZ29Hcm91cFJpZ2h0XCIsIFwiQ21kLUxlZnRcIjogXCJnb0xpbmVMZWZ0XCIsIFwiQ21kLVJpZ2h0XCI6IFwiZ29MaW5lUmlnaHRcIiwgXCJBbHQtQmFja3NwYWNlXCI6IFwiZGVsR3JvdXBCZWZvcmVcIixcbiAgXCJDdHJsLUFsdC1CYWNrc3BhY2VcIjogXCJkZWxHcm91cEFmdGVyXCIsIFwiQWx0LURlbGV0ZVwiOiBcImRlbEdyb3VwQWZ0ZXJcIiwgXCJDbWQtU1wiOiBcInNhdmVcIiwgXCJDbWQtRlwiOiBcImZpbmRcIixcbiAgXCJDbWQtR1wiOiBcImZpbmROZXh0XCIsIFwiU2hpZnQtQ21kLUdcIjogXCJmaW5kUHJldlwiLCBcIkNtZC1BbHQtRlwiOiBcInJlcGxhY2VcIiwgXCJTaGlmdC1DbWQtQWx0LUZcIjogXCJyZXBsYWNlQWxsXCIsXG4gIFwiQ21kLVtcIjogXCJpbmRlbnRMZXNzXCIsIFwiQ21kLV1cIjogXCJpbmRlbnRNb3JlXCIsIFwiQ21kLUJhY2tzcGFjZVwiOiBcImRlbFdyYXBwZWRMaW5lTGVmdFwiLCBcIkNtZC1EZWxldGVcIjogXCJkZWxXcmFwcGVkTGluZVJpZ2h0XCIsXG4gIFwiQ21kLVVcIjogXCJ1bmRvU2VsZWN0aW9uXCIsIFwiU2hpZnQtQ21kLVVcIjogXCJyZWRvU2VsZWN0aW9uXCIsIFwiQ3RybC1VcFwiOiBcImdvRG9jU3RhcnRcIiwgXCJDdHJsLURvd25cIjogXCJnb0RvY0VuZFwiLFxuICBmYWxsdGhyb3VnaDogW1wiYmFzaWNcIiwgXCJlbWFjc3lcIl1cbn07XG5rZXlNYXBbXCJkZWZhdWx0XCJdID0gbWFjID8ga2V5TWFwLm1hY0RlZmF1bHQgOiBrZXlNYXAucGNEZWZhdWx0O1xuXG4vLyBLRVlNQVAgRElTUEFUQ0hcblxuZnVuY3Rpb24gbm9ybWFsaXplS2V5TmFtZShuYW1lKSB7XG4gIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoLy0oPyEkKS8pO1xuICBuYW1lID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07XG4gIHZhciBhbHQsIGN0cmwsIHNoaWZ0LCBjbWQ7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgdmFyIG1vZCA9IHBhcnRzW2ldO1xuICAgIGlmICgvXihjbWR8bWV0YXxtKSQvaS50ZXN0KG1vZCkpIHsgY21kID0gdHJ1ZTsgfVxuICAgIGVsc2UgaWYgKC9eYShsdCk/JC9pLnRlc3QobW9kKSkgeyBhbHQgPSB0cnVlOyB9XG4gICAgZWxzZSBpZiAoL14oY3xjdHJsfGNvbnRyb2wpJC9pLnRlc3QobW9kKSkgeyBjdHJsID0gdHJ1ZTsgfVxuICAgIGVsc2UgaWYgKC9ecyhoaWZ0KT8kL2kudGVzdChtb2QpKSB7IHNoaWZ0ID0gdHJ1ZTsgfVxuICAgIGVsc2UgeyB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgbW9kaWZpZXIgbmFtZTogXCIgKyBtb2QpIH1cbiAgfVxuICBpZiAoYWx0KSB7IG5hbWUgPSBcIkFsdC1cIiArIG5hbWU7IH1cbiAgaWYgKGN0cmwpIHsgbmFtZSA9IFwiQ3RybC1cIiArIG5hbWU7IH1cbiAgaWYgKGNtZCkgeyBuYW1lID0gXCJDbWQtXCIgKyBuYW1lOyB9XG4gIGlmIChzaGlmdCkgeyBuYW1lID0gXCJTaGlmdC1cIiArIG5hbWU7IH1cbiAgcmV0dXJuIG5hbWVcbn1cblxuLy8gVGhpcyBpcyBhIGtsdWRnZSB0byBrZWVwIGtleW1hcHMgbW9zdGx5IHdvcmtpbmcgYXMgcmF3IG9iamVjdHNcbi8vIChiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSkgd2hpbGUgYXQgdGhlIHNhbWUgdGltZSBzdXBwb3J0IGZlYXR1cmVzXG4vLyBsaWtlIG5vcm1hbGl6YXRpb24gYW5kIG11bHRpLXN0cm9rZSBrZXkgYmluZGluZ3MuIEl0IGNvbXBpbGVzIGFcbi8vIG5ldyBub3JtYWxpemVkIGtleW1hcCwgYW5kIHRoZW4gdXBkYXRlcyB0aGUgb2xkIG9iamVjdCB0byByZWZsZWN0XG4vLyB0aGlzLlxuZnVuY3Rpb24gbm9ybWFsaXplS2V5TWFwKGtleW1hcCkge1xuICB2YXIgY29weSA9IHt9O1xuICBmb3IgKHZhciBrZXluYW1lIGluIGtleW1hcCkgeyBpZiAoa2V5bWFwLmhhc093blByb3BlcnR5KGtleW5hbWUpKSB7XG4gICAgdmFyIHZhbHVlID0ga2V5bWFwW2tleW5hbWVdO1xuICAgIGlmICgvXihuYW1lfGZhbGx0aHJvdWdofChkZXxhdCl0YWNoKSQvLnRlc3Qoa2V5bmFtZSkpIHsgY29udGludWUgfVxuICAgIGlmICh2YWx1ZSA9PSBcIi4uLlwiKSB7IGRlbGV0ZSBrZXltYXBba2V5bmFtZV07IGNvbnRpbnVlIH1cblxuICAgIHZhciBrZXlzID0gbWFwKGtleW5hbWUuc3BsaXQoXCIgXCIpLCBub3JtYWxpemVLZXlOYW1lKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB2YWwgPSAodm9pZCAwKSwgbmFtZSA9ICh2b2lkIDApO1xuICAgICAgaWYgKGkgPT0ga2V5cy5sZW5ndGggLSAxKSB7XG4gICAgICAgIG5hbWUgPSBrZXlzLmpvaW4oXCIgXCIpO1xuICAgICAgICB2YWwgPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5hbWUgPSBrZXlzLnNsaWNlKDAsIGkgKyAxKS5qb2luKFwiIFwiKTtcbiAgICAgICAgdmFsID0gXCIuLi5cIjtcbiAgICAgIH1cbiAgICAgIHZhciBwcmV2ID0gY29weVtuYW1lXTtcbiAgICAgIGlmICghcHJldikgeyBjb3B5W25hbWVdID0gdmFsOyB9XG4gICAgICBlbHNlIGlmIChwcmV2ICE9IHZhbCkgeyB0aHJvdyBuZXcgRXJyb3IoXCJJbmNvbnNpc3RlbnQgYmluZGluZ3MgZm9yIFwiICsgbmFtZSkgfVxuICAgIH1cbiAgICBkZWxldGUga2V5bWFwW2tleW5hbWVdO1xuICB9IH1cbiAgZm9yICh2YXIgcHJvcCBpbiBjb3B5KSB7IGtleW1hcFtwcm9wXSA9IGNvcHlbcHJvcF07IH1cbiAgcmV0dXJuIGtleW1hcFxufVxuXG5mdW5jdGlvbiBsb29rdXBLZXkoa2V5LCBtYXAkJDEsIGhhbmRsZSwgY29udGV4dCkge1xuICBtYXAkJDEgPSBnZXRLZXlNYXAobWFwJCQxKTtcbiAgdmFyIGZvdW5kID0gbWFwJCQxLmNhbGwgPyBtYXAkJDEuY2FsbChrZXksIGNvbnRleHQpIDogbWFwJCQxW2tleV07XG4gIGlmIChmb3VuZCA9PT0gZmFsc2UpIHsgcmV0dXJuIFwibm90aGluZ1wiIH1cbiAgaWYgKGZvdW5kID09PSBcIi4uLlwiKSB7IHJldHVybiBcIm11bHRpXCIgfVxuICBpZiAoZm91bmQgIT0gbnVsbCAmJiBoYW5kbGUoZm91bmQpKSB7IHJldHVybiBcImhhbmRsZWRcIiB9XG5cbiAgaWYgKG1hcCQkMS5mYWxsdGhyb3VnaCkge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWFwJCQxLmZhbGx0aHJvdWdoKSAhPSBcIltvYmplY3QgQXJyYXldXCIpXG4gICAgICB7IHJldHVybiBsb29rdXBLZXkoa2V5LCBtYXAkJDEuZmFsbHRocm91Z2gsIGhhbmRsZSwgY29udGV4dCkgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFwJCQxLmZhbGx0aHJvdWdoLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gbG9va3VwS2V5KGtleSwgbWFwJCQxLmZhbGx0aHJvdWdoW2ldLCBoYW5kbGUsIGNvbnRleHQpO1xuICAgICAgaWYgKHJlc3VsdCkgeyByZXR1cm4gcmVzdWx0IH1cbiAgICB9XG4gIH1cbn1cblxuLy8gTW9kaWZpZXIga2V5IHByZXNzZXMgZG9uJ3QgY291bnQgYXMgJ3JlYWwnIGtleSBwcmVzc2VzIGZvciB0aGVcbi8vIHB1cnBvc2Ugb2Yga2V5bWFwIGZhbGx0aHJvdWdoLlxuZnVuY3Rpb24gaXNNb2RpZmllcktleSh2YWx1ZSkge1xuICB2YXIgbmFtZSA9IHR5cGVvZiB2YWx1ZSA9PSBcInN0cmluZ1wiID8gdmFsdWUgOiBrZXlOYW1lc1t2YWx1ZS5rZXlDb2RlXTtcbiAgcmV0dXJuIG5hbWUgPT0gXCJDdHJsXCIgfHwgbmFtZSA9PSBcIkFsdFwiIHx8IG5hbWUgPT0gXCJTaGlmdFwiIHx8IG5hbWUgPT0gXCJNb2RcIlxufVxuXG4vLyBMb29rIHVwIHRoZSBuYW1lIG9mIGEga2V5IGFzIGluZGljYXRlZCBieSBhbiBldmVudCBvYmplY3QuXG5mdW5jdGlvbiBrZXlOYW1lKGV2ZW50LCBub1NoaWZ0KSB7XG4gIGlmIChwcmVzdG8gJiYgZXZlbnQua2V5Q29kZSA9PSAzNCAmJiBldmVudFtcImNoYXJcIl0pIHsgcmV0dXJuIGZhbHNlIH1cbiAgdmFyIGJhc2UgPSBrZXlOYW1lc1tldmVudC5rZXlDb2RlXSwgbmFtZSA9IGJhc2U7XG4gIGlmIChuYW1lID09IG51bGwgfHwgZXZlbnQuYWx0R3JhcGhLZXkpIHsgcmV0dXJuIGZhbHNlIH1cbiAgaWYgKGV2ZW50LmFsdEtleSAmJiBiYXNlICE9IFwiQWx0XCIpIHsgbmFtZSA9IFwiQWx0LVwiICsgbmFtZTsgfVxuICBpZiAoKGZsaXBDdHJsQ21kID8gZXZlbnQubWV0YUtleSA6IGV2ZW50LmN0cmxLZXkpICYmIGJhc2UgIT0gXCJDdHJsXCIpIHsgbmFtZSA9IFwiQ3RybC1cIiArIG5hbWU7IH1cbiAgaWYgKChmbGlwQ3RybENtZCA/IGV2ZW50LmN0cmxLZXkgOiBldmVudC5tZXRhS2V5KSAmJiBiYXNlICE9IFwiQ21kXCIpIHsgbmFtZSA9IFwiQ21kLVwiICsgbmFtZTsgfVxuICBpZiAoIW5vU2hpZnQgJiYgZXZlbnQuc2hpZnRLZXkgJiYgYmFzZSAhPSBcIlNoaWZ0XCIpIHsgbmFtZSA9IFwiU2hpZnQtXCIgKyBuYW1lOyB9XG4gIHJldHVybiBuYW1lXG59XG5cbmZ1bmN0aW9uIGdldEtleU1hcCh2YWwpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWwgPT0gXCJzdHJpbmdcIiA/IGtleU1hcFt2YWxdIDogdmFsXG59XG5cbi8vIEhlbHBlciBmb3IgZGVsZXRpbmcgdGV4dCBuZWFyIHRoZSBzZWxlY3Rpb24ocyksIHVzZWQgdG8gaW1wbGVtZW50XG4vLyBiYWNrc3BhY2UsIGRlbGV0ZSwgYW5kIHNpbWlsYXIgZnVuY3Rpb25hbGl0eS5cbmZ1bmN0aW9uIGRlbGV0ZU5lYXJTZWxlY3Rpb24oY20sIGNvbXB1dGUpIHtcbiAgdmFyIHJhbmdlcyA9IGNtLmRvYy5zZWwucmFuZ2VzLCBraWxsID0gW107XG4gIC8vIEJ1aWxkIHVwIGEgc2V0IG9mIHJhbmdlcyB0byBraWxsIGZpcnN0LCBtZXJnaW5nIG92ZXJsYXBwaW5nXG4gIC8vIHJhbmdlcy5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgdG9LaWxsID0gY29tcHV0ZShyYW5nZXNbaV0pO1xuICAgIHdoaWxlIChraWxsLmxlbmd0aCAmJiBjbXAodG9LaWxsLmZyb20sIGxzdChraWxsKS50bykgPD0gMCkge1xuICAgICAgdmFyIHJlcGxhY2VkID0ga2lsbC5wb3AoKTtcbiAgICAgIGlmIChjbXAocmVwbGFjZWQuZnJvbSwgdG9LaWxsLmZyb20pIDwgMCkge1xuICAgICAgICB0b0tpbGwuZnJvbSA9IHJlcGxhY2VkLmZyb207XG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuICAgIGtpbGwucHVzaCh0b0tpbGwpO1xuICB9XG4gIC8vIE5leHQsIHJlbW92ZSB0aG9zZSBhY3R1YWwgcmFuZ2VzLlxuICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgaSA9IGtpbGwubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pXG4gICAgICB7IHJlcGxhY2VSYW5nZShjbS5kb2MsIFwiXCIsIGtpbGxbaV0uZnJvbSwga2lsbFtpXS50bywgXCIrZGVsZXRlXCIpOyB9XG4gICAgZW5zdXJlQ3Vyc29yVmlzaWJsZShjbSk7XG4gIH0pO1xufVxuXG4vLyBDb21tYW5kcyBhcmUgcGFyYW1ldGVyLWxlc3MgYWN0aW9ucyB0aGF0IGNhbiBiZSBwZXJmb3JtZWQgb24gYW5cbi8vIGVkaXRvciwgbW9zdGx5IHVzZWQgZm9yIGtleWJpbmRpbmdzLlxudmFyIGNvbW1hbmRzID0ge1xuICBzZWxlY3RBbGw6IHNlbGVjdEFsbCxcbiAgc2luZ2xlU2VsZWN0aW9uOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnNldFNlbGVjdGlvbihjbS5nZXRDdXJzb3IoXCJhbmNob3JcIiksIGNtLmdldEN1cnNvcihcImhlYWRcIiksIHNlbF9kb250U2Nyb2xsKTsgfSxcbiAga2lsbExpbmU6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24gKHJhbmdlKSB7XG4gICAgaWYgKHJhbmdlLmVtcHR5KCkpIHtcbiAgICAgIHZhciBsZW4gPSBnZXRMaW5lKGNtLmRvYywgcmFuZ2UuaGVhZC5saW5lKS50ZXh0Lmxlbmd0aDtcbiAgICAgIGlmIChyYW5nZS5oZWFkLmNoID09IGxlbiAmJiByYW5nZS5oZWFkLmxpbmUgPCBjbS5sYXN0TGluZSgpKVxuICAgICAgICB7IHJldHVybiB7ZnJvbTogcmFuZ2UuaGVhZCwgdG86IFBvcyhyYW5nZS5oZWFkLmxpbmUgKyAxLCAwKX0gfVxuICAgICAgZWxzZVxuICAgICAgICB7IHJldHVybiB7ZnJvbTogcmFuZ2UuaGVhZCwgdG86IFBvcyhyYW5nZS5oZWFkLmxpbmUsIGxlbil9IH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtmcm9tOiByYW5nZS5mcm9tKCksIHRvOiByYW5nZS50bygpfVxuICAgIH1cbiAgfSk7IH0sXG4gIGRlbGV0ZUxpbmU6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24gKHJhbmdlKSB7IHJldHVybiAoe1xuICAgIGZyb206IFBvcyhyYW5nZS5mcm9tKCkubGluZSwgMCksXG4gICAgdG86IGNsaXBQb3MoY20uZG9jLCBQb3MocmFuZ2UudG8oKS5saW5lICsgMSwgMCkpXG4gIH0pOyB9KTsgfSxcbiAgZGVsTGluZUxlZnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24gKHJhbmdlKSB7IHJldHVybiAoe1xuICAgIGZyb206IFBvcyhyYW5nZS5mcm9tKCkubGluZSwgMCksIHRvOiByYW5nZS5mcm9tKClcbiAgfSk7IH0pOyB9LFxuICBkZWxXcmFwcGVkTGluZUxlZnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24gKHJhbmdlKSB7XG4gICAgdmFyIHRvcCA9IGNtLmNoYXJDb29yZHMocmFuZ2UuaGVhZCwgXCJkaXZcIikudG9wICsgNTtcbiAgICB2YXIgbGVmdFBvcyA9IGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IDAsIHRvcDogdG9wfSwgXCJkaXZcIik7XG4gICAgcmV0dXJuIHtmcm9tOiBsZWZ0UG9zLCB0bzogcmFuZ2UuZnJvbSgpfVxuICB9KTsgfSxcbiAgZGVsV3JhcHBlZExpbmVSaWdodDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbiAocmFuZ2UpIHtcbiAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCBcImRpdlwiKS50b3AgKyA1O1xuICAgIHZhciByaWdodFBvcyA9IGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IGNtLmRpc3BsYXkubGluZURpdi5vZmZzZXRXaWR0aCArIDEwMCwgdG9wOiB0b3B9LCBcImRpdlwiKTtcbiAgICByZXR1cm4ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJpZ2h0UG9zIH1cbiAgfSk7IH0sXG4gIHVuZG86IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20udW5kbygpOyB9LFxuICByZWRvOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlZG8oKTsgfSxcbiAgdW5kb1NlbGVjdGlvbjogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS51bmRvU2VsZWN0aW9uKCk7IH0sXG4gIHJlZG9TZWxlY3Rpb246IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ucmVkb1NlbGVjdGlvbigpOyB9LFxuICBnb0RvY1N0YXJ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbihQb3MoY20uZmlyc3RMaW5lKCksIDApKTsgfSxcbiAgZ29Eb2NFbmQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZXh0ZW5kU2VsZWN0aW9uKFBvcyhjbS5sYXN0TGluZSgpKSk7IH0sXG4gIGdvTGluZVN0YXJ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UpIHsgcmV0dXJuIGxpbmVTdGFydChjbSwgcmFuZ2UuaGVhZC5saW5lKTsgfSxcbiAgICB7b3JpZ2luOiBcIittb3ZlXCIsIGJpYXM6IDF9XG4gICk7IH0sXG4gIGdvTGluZVN0YXJ0U21hcnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uIChyYW5nZSkgeyByZXR1cm4gbGluZVN0YXJ0U21hcnQoY20sIHJhbmdlLmhlYWQpOyB9LFxuICAgIHtvcmlnaW46IFwiK21vdmVcIiwgYmlhczogMX1cbiAgKTsgfSxcbiAgZ29MaW5lRW5kOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UpIHsgcmV0dXJuIGxpbmVFbmQoY20sIHJhbmdlLmhlYWQubGluZSk7IH0sXG4gICAge29yaWdpbjogXCIrbW92ZVwiLCBiaWFzOiAtMX1cbiAgKTsgfSxcbiAgZ29MaW5lUmlnaHQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uIChyYW5nZSkge1xuICAgIHZhciB0b3AgPSBjbS5jaGFyQ29vcmRzKHJhbmdlLmhlYWQsIFwiZGl2XCIpLnRvcCArIDU7XG4gICAgcmV0dXJuIGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IGNtLmRpc3BsYXkubGluZURpdi5vZmZzZXRXaWR0aCArIDEwMCwgdG9wOiB0b3B9LCBcImRpdlwiKVxuICB9LCBzZWxfbW92ZSk7IH0sXG4gIGdvTGluZUxlZnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uIChyYW5nZSkge1xuICAgIHZhciB0b3AgPSBjbS5jaGFyQ29vcmRzKHJhbmdlLmhlYWQsIFwiZGl2XCIpLnRvcCArIDU7XG4gICAgcmV0dXJuIGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IDAsIHRvcDogdG9wfSwgXCJkaXZcIilcbiAgfSwgc2VsX21vdmUpOyB9LFxuICBnb0xpbmVMZWZ0U21hcnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uIChyYW5nZSkge1xuICAgIHZhciB0b3AgPSBjbS5jaGFyQ29vcmRzKHJhbmdlLmhlYWQsIFwiZGl2XCIpLnRvcCArIDU7XG4gICAgdmFyIHBvcyA9IGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IDAsIHRvcDogdG9wfSwgXCJkaXZcIik7XG4gICAgaWYgKHBvcy5jaCA8IGNtLmdldExpbmUocG9zLmxpbmUpLnNlYXJjaCgvXFxTLykpIHsgcmV0dXJuIGxpbmVTdGFydFNtYXJ0KGNtLCByYW5nZS5oZWFkKSB9XG4gICAgcmV0dXJuIHBvc1xuICB9LCBzZWxfbW92ZSk7IH0sXG4gIGdvTGluZVVwOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVWKC0xLCBcImxpbmVcIik7IH0sXG4gIGdvTGluZURvd246IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZVYoMSwgXCJsaW5lXCIpOyB9LFxuICBnb1BhZ2VVcDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlVigtMSwgXCJwYWdlXCIpOyB9LFxuICBnb1BhZ2VEb3duOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVWKDEsIFwicGFnZVwiKTsgfSxcbiAgZ29DaGFyTGVmdDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlSCgtMSwgXCJjaGFyXCIpOyB9LFxuICBnb0NoYXJSaWdodDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlSCgxLCBcImNoYXJcIik7IH0sXG4gIGdvQ29sdW1uTGVmdDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlSCgtMSwgXCJjb2x1bW5cIik7IH0sXG4gIGdvQ29sdW1uUmlnaHQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZUgoMSwgXCJjb2x1bW5cIik7IH0sXG4gIGdvV29yZExlZnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZUgoLTEsIFwid29yZFwiKTsgfSxcbiAgZ29Hcm91cFJpZ2h0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVIKDEsIFwiZ3JvdXBcIik7IH0sXG4gIGdvR3JvdXBMZWZ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVIKC0xLCBcImdyb3VwXCIpOyB9LFxuICBnb1dvcmRSaWdodDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlSCgxLCBcIndvcmRcIik7IH0sXG4gIGRlbENoYXJCZWZvcmU6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZGVsZXRlSCgtMSwgXCJjaGFyXCIpOyB9LFxuICBkZWxDaGFyQWZ0ZXI6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZGVsZXRlSCgxLCBcImNoYXJcIik7IH0sXG4gIGRlbFdvcmRCZWZvcmU6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZGVsZXRlSCgtMSwgXCJ3b3JkXCIpOyB9LFxuICBkZWxXb3JkQWZ0ZXI6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZGVsZXRlSCgxLCBcIndvcmRcIik7IH0sXG4gIGRlbEdyb3VwQmVmb3JlOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmRlbGV0ZUgoLTEsIFwiZ3JvdXBcIik7IH0sXG4gIGRlbEdyb3VwQWZ0ZXI6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uZGVsZXRlSCgxLCBcImdyb3VwXCIpOyB9LFxuICBpbmRlbnRBdXRvOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmluZGVudFNlbGVjdGlvbihcInNtYXJ0XCIpOyB9LFxuICBpbmRlbnRNb3JlOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmluZGVudFNlbGVjdGlvbihcImFkZFwiKTsgfSxcbiAgaW5kZW50TGVzczogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5pbmRlbnRTZWxlY3Rpb24oXCJzdWJ0cmFjdFwiKTsgfSxcbiAgaW5zZXJ0VGFiOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlcGxhY2VTZWxlY3Rpb24oXCJcXHRcIik7IH0sXG4gIGluc2VydFNvZnRUYWI6IGZ1bmN0aW9uIChjbSkge1xuICAgIHZhciBzcGFjZXMgPSBbXSwgcmFuZ2VzID0gY20ubGlzdFNlbGVjdGlvbnMoKSwgdGFiU2l6ZSA9IGNtLm9wdGlvbnMudGFiU2l6ZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHBvcyA9IHJhbmdlc1tpXS5mcm9tKCk7XG4gICAgICB2YXIgY29sID0gY291bnRDb2x1bW4oY20uZ2V0TGluZShwb3MubGluZSksIHBvcy5jaCwgdGFiU2l6ZSk7XG4gICAgICBzcGFjZXMucHVzaChzcGFjZVN0cih0YWJTaXplIC0gY29sICUgdGFiU2l6ZSkpO1xuICAgIH1cbiAgICBjbS5yZXBsYWNlU2VsZWN0aW9ucyhzcGFjZXMpO1xuICB9LFxuICBkZWZhdWx0VGFiOiBmdW5jdGlvbiAoY20pIHtcbiAgICBpZiAoY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkgeyBjbS5pbmRlbnRTZWxlY3Rpb24oXCJhZGRcIik7IH1cbiAgICBlbHNlIHsgY20uZXhlY0NvbW1hbmQoXCJpbnNlcnRUYWJcIik7IH1cbiAgfSxcbiAgLy8gU3dhcCB0aGUgdHdvIGNoYXJzIGxlZnQgYW5kIHJpZ2h0IG9mIGVhY2ggc2VsZWN0aW9uJ3MgaGVhZC5cbiAgLy8gTW92ZSBjdXJzb3IgYmVoaW5kIHRoZSB0d28gc3dhcHBlZCBjaGFyYWN0ZXJzIGFmdGVyd2FyZHMuXG4gIC8vXG4gIC8vIERvZXNuJ3QgY29uc2lkZXIgbGluZSBmZWVkcyBhIGNoYXJhY3Rlci5cbiAgLy8gRG9lc24ndCBzY2FuIG1vcmUgdGhhbiBvbmUgbGluZSBhYm92ZSB0byBmaW5kIGEgY2hhcmFjdGVyLlxuICAvLyBEb2Vzbid0IGRvIGFueXRoaW5nIG9uIGFuIGVtcHR5IGxpbmUuXG4gIC8vIERvZXNuJ3QgZG8gYW55dGhpbmcgd2l0aCBub24tZW1wdHkgc2VsZWN0aW9ucy5cbiAgdHJhbnNwb3NlQ2hhcnM6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkge1xuICAgIHZhciByYW5nZXMgPSBjbS5saXN0U2VsZWN0aW9ucygpLCBuZXdTZWwgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFyYW5nZXNbaV0uZW1wdHkoKSkgeyBjb250aW51ZSB9XG4gICAgICB2YXIgY3VyID0gcmFuZ2VzW2ldLmhlYWQsIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgY3VyLmxpbmUpLnRleHQ7XG4gICAgICBpZiAobGluZSkge1xuICAgICAgICBpZiAoY3VyLmNoID09IGxpbmUubGVuZ3RoKSB7IGN1ciA9IG5ldyBQb3MoY3VyLmxpbmUsIGN1ci5jaCAtIDEpOyB9XG4gICAgICAgIGlmIChjdXIuY2ggPiAwKSB7XG4gICAgICAgICAgY3VyID0gbmV3IFBvcyhjdXIubGluZSwgY3VyLmNoICsgMSk7XG4gICAgICAgICAgY20ucmVwbGFjZVJhbmdlKGxpbmUuY2hhckF0KGN1ci5jaCAtIDEpICsgbGluZS5jaGFyQXQoY3VyLmNoIC0gMiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIFBvcyhjdXIubGluZSwgY3VyLmNoIC0gMiksIGN1ciwgXCIrdHJhbnNwb3NlXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKGN1ci5saW5lID4gY20uZG9jLmZpcnN0KSB7XG4gICAgICAgICAgdmFyIHByZXYgPSBnZXRMaW5lKGNtLmRvYywgY3VyLmxpbmUgLSAxKS50ZXh0O1xuICAgICAgICAgIGlmIChwcmV2KSB7XG4gICAgICAgICAgICBjdXIgPSBuZXcgUG9zKGN1ci5saW5lLCAxKTtcbiAgICAgICAgICAgIGNtLnJlcGxhY2VSYW5nZShsaW5lLmNoYXJBdCgwKSArIGNtLmRvYy5saW5lU2VwYXJhdG9yKCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXYuY2hhckF0KHByZXYubGVuZ3RoIC0gMSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zKGN1ci5saW5lIC0gMSwgcHJldi5sZW5ndGggLSAxKSwgY3VyLCBcIit0cmFuc3Bvc2VcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBuZXdTZWwucHVzaChuZXcgUmFuZ2UoY3VyLCBjdXIpKTtcbiAgICB9XG4gICAgY20uc2V0U2VsZWN0aW9ucyhuZXdTZWwpO1xuICB9KTsgfSxcbiAgbmV3bGluZUFuZEluZGVudDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbHMgPSBjbS5saXN0U2VsZWN0aW9ucygpO1xuICAgIGZvciAodmFyIGkgPSBzZWxzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgeyBjbS5yZXBsYWNlUmFuZ2UoY20uZG9jLmxpbmVTZXBhcmF0b3IoKSwgc2Vsc1tpXS5hbmNob3IsIHNlbHNbaV0uaGVhZCwgXCIraW5wdXRcIik7IH1cbiAgICBzZWxzID0gY20ubGlzdFNlbGVjdGlvbnMoKTtcbiAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBzZWxzLmxlbmd0aDsgaSQxKyspXG4gICAgICB7IGNtLmluZGVudExpbmUoc2Vsc1tpJDFdLmZyb20oKS5saW5lLCBudWxsLCB0cnVlKTsgfVxuICAgIGVuc3VyZUN1cnNvclZpc2libGUoY20pO1xuICB9KTsgfSxcbiAgb3BlbkxpbmU6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ucmVwbGFjZVNlbGVjdGlvbihcIlxcblwiLCBcInN0YXJ0XCIpOyB9LFxuICB0b2dnbGVPdmVyd3JpdGU6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20udG9nZ2xlT3ZlcndyaXRlKCk7IH1cbn07XG5cblxuZnVuY3Rpb24gbGluZVN0YXJ0KGNtLCBsaW5lTikge1xuICB2YXIgbGluZSA9IGdldExpbmUoY20uZG9jLCBsaW5lTik7XG4gIHZhciB2aXN1YWwgPSB2aXN1YWxMaW5lKGxpbmUpO1xuICBpZiAodmlzdWFsICE9IGxpbmUpIHsgbGluZU4gPSBsaW5lTm8odmlzdWFsKTsgfVxuICByZXR1cm4gZW5kT2ZMaW5lKHRydWUsIGNtLCB2aXN1YWwsIGxpbmVOLCAxKVxufVxuZnVuY3Rpb24gbGluZUVuZChjbSwgbGluZU4pIHtcbiAgdmFyIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgbGluZU4pO1xuICB2YXIgdmlzdWFsID0gdmlzdWFsTGluZUVuZChsaW5lKTtcbiAgaWYgKHZpc3VhbCAhPSBsaW5lKSB7IGxpbmVOID0gbGluZU5vKHZpc3VhbCk7IH1cbiAgcmV0dXJuIGVuZE9mTGluZSh0cnVlLCBjbSwgbGluZSwgbGluZU4sIC0xKVxufVxuZnVuY3Rpb24gbGluZVN0YXJ0U21hcnQoY20sIHBvcykge1xuICB2YXIgc3RhcnQgPSBsaW5lU3RhcnQoY20sIHBvcy5saW5lKTtcbiAgdmFyIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgc3RhcnQubGluZSk7XG4gIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmUsIGNtLmRvYy5kaXJlY3Rpb24pO1xuICBpZiAoIW9yZGVyIHx8IG9yZGVyWzBdLmxldmVsID09IDApIHtcbiAgICB2YXIgZmlyc3ROb25XUyA9IE1hdGgubWF4KDAsIGxpbmUudGV4dC5zZWFyY2goL1xcUy8pKTtcbiAgICB2YXIgaW5XUyA9IHBvcy5saW5lID09IHN0YXJ0LmxpbmUgJiYgcG9zLmNoIDw9IGZpcnN0Tm9uV1MgJiYgcG9zLmNoO1xuICAgIHJldHVybiBQb3Moc3RhcnQubGluZSwgaW5XUyA/IDAgOiBmaXJzdE5vbldTLCBzdGFydC5zdGlja3kpXG4gIH1cbiAgcmV0dXJuIHN0YXJ0XG59XG5cbi8vIFJ1biBhIGhhbmRsZXIgdGhhdCB3YXMgYm91bmQgdG8gYSBrZXkuXG5mdW5jdGlvbiBkb0hhbmRsZUJpbmRpbmcoY20sIGJvdW5kLCBkcm9wU2hpZnQpIHtcbiAgaWYgKHR5cGVvZiBib3VuZCA9PSBcInN0cmluZ1wiKSB7XG4gICAgYm91bmQgPSBjb21tYW5kc1tib3VuZF07XG4gICAgaWYgKCFib3VuZCkgeyByZXR1cm4gZmFsc2UgfVxuICB9XG4gIC8vIEVuc3VyZSBwcmV2aW91cyBpbnB1dCBoYXMgYmVlbiByZWFkLCBzbyB0aGF0IHRoZSBoYW5kbGVyIHNlZXMgYVxuICAvLyBjb25zaXN0ZW50IHZpZXcgb2YgdGhlIGRvY3VtZW50XG4gIGNtLmRpc3BsYXkuaW5wdXQuZW5zdXJlUG9sbGVkKCk7XG4gIHZhciBwcmV2U2hpZnQgPSBjbS5kaXNwbGF5LnNoaWZ0LCBkb25lID0gZmFsc2U7XG4gIHRyeSB7XG4gICAgaWYgKGNtLmlzUmVhZE9ubHkoKSkgeyBjbS5zdGF0ZS5zdXBwcmVzc0VkaXRzID0gdHJ1ZTsgfVxuICAgIGlmIChkcm9wU2hpZnQpIHsgY20uZGlzcGxheS5zaGlmdCA9IGZhbHNlOyB9XG4gICAgZG9uZSA9IGJvdW5kKGNtKSAhPSBQYXNzO1xuICB9IGZpbmFsbHkge1xuICAgIGNtLmRpc3BsYXkuc2hpZnQgPSBwcmV2U2hpZnQ7XG4gICAgY20uc3RhdGUuc3VwcHJlc3NFZGl0cyA9IGZhbHNlO1xuICB9XG4gIHJldHVybiBkb25lXG59XG5cbmZ1bmN0aW9uIGxvb2t1cEtleUZvckVkaXRvcihjbSwgbmFtZSwgaGFuZGxlKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY20uc3RhdGUua2V5TWFwcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciByZXN1bHQgPSBsb29rdXBLZXkobmFtZSwgY20uc3RhdGUua2V5TWFwc1tpXSwgaGFuZGxlLCBjbSk7XG4gICAgaWYgKHJlc3VsdCkgeyByZXR1cm4gcmVzdWx0IH1cbiAgfVxuICByZXR1cm4gKGNtLm9wdGlvbnMuZXh0cmFLZXlzICYmIGxvb2t1cEtleShuYW1lLCBjbS5vcHRpb25zLmV4dHJhS2V5cywgaGFuZGxlLCBjbSkpXG4gICAgfHwgbG9va3VwS2V5KG5hbWUsIGNtLm9wdGlvbnMua2V5TWFwLCBoYW5kbGUsIGNtKVxufVxuXG52YXIgc3RvcFNlcSA9IG5ldyBEZWxheWVkO1xuZnVuY3Rpb24gZGlzcGF0Y2hLZXkoY20sIG5hbWUsIGUsIGhhbmRsZSkge1xuICB2YXIgc2VxID0gY20uc3RhdGUua2V5U2VxO1xuICBpZiAoc2VxKSB7XG4gICAgaWYgKGlzTW9kaWZpZXJLZXkobmFtZSkpIHsgcmV0dXJuIFwiaGFuZGxlZFwiIH1cbiAgICBzdG9wU2VxLnNldCg1MCwgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGNtLnN0YXRlLmtleVNlcSA9PSBzZXEpIHtcbiAgICAgICAgY20uc3RhdGUua2V5U2VxID0gbnVsbDtcbiAgICAgICAgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIG5hbWUgPSBzZXEgKyBcIiBcIiArIG5hbWU7XG4gIH1cbiAgdmFyIHJlc3VsdCA9IGxvb2t1cEtleUZvckVkaXRvcihjbSwgbmFtZSwgaGFuZGxlKTtcblxuICBpZiAocmVzdWx0ID09IFwibXVsdGlcIilcbiAgICB7IGNtLnN0YXRlLmtleVNlcSA9IG5hbWU7IH1cbiAgaWYgKHJlc3VsdCA9PSBcImhhbmRsZWRcIilcbiAgICB7IHNpZ25hbExhdGVyKGNtLCBcImtleUhhbmRsZWRcIiwgY20sIG5hbWUsIGUpOyB9XG5cbiAgaWYgKHJlc3VsdCA9PSBcImhhbmRsZWRcIiB8fCByZXN1bHQgPT0gXCJtdWx0aVwiKSB7XG4gICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICByZXN0YXJ0QmxpbmsoY20pO1xuICB9XG5cbiAgaWYgKHNlcSAmJiAhcmVzdWx0ICYmIC9cXCckLy50ZXN0KG5hbWUpKSB7XG4gICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG4gIHJldHVybiAhIXJlc3VsdFxufVxuXG4vLyBIYW5kbGUgYSBrZXkgZnJvbSB0aGUga2V5ZG93biBldmVudC5cbmZ1bmN0aW9uIGhhbmRsZUtleUJpbmRpbmcoY20sIGUpIHtcbiAgdmFyIG5hbWUgPSBrZXlOYW1lKGUsIHRydWUpO1xuICBpZiAoIW5hbWUpIHsgcmV0dXJuIGZhbHNlIH1cblxuICBpZiAoZS5zaGlmdEtleSAmJiAhY20uc3RhdGUua2V5U2VxKSB7XG4gICAgLy8gRmlyc3QgdHJ5IHRvIHJlc29sdmUgZnVsbCBuYW1lIChpbmNsdWRpbmcgJ1NoaWZ0LScpLiBGYWlsaW5nXG4gICAgLy8gdGhhdCwgc2VlIGlmIHRoZXJlIGlzIGEgY3Vyc29yLW1vdGlvbiBjb21tYW5kIChzdGFydGluZyB3aXRoXG4gICAgLy8gJ2dvJykgYm91bmQgdG8gdGhlIGtleW5hbWUgd2l0aG91dCAnU2hpZnQtJy5cbiAgICByZXR1cm4gZGlzcGF0Y2hLZXkoY20sIFwiU2hpZnQtXCIgKyBuYW1lLCBlLCBmdW5jdGlvbiAoYikgeyByZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiLCB0cnVlKTsgfSlcbiAgICAgICAgfHwgZGlzcGF0Y2hLZXkoY20sIG5hbWUsIGUsIGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgaWYgKHR5cGVvZiBiID09IFwic3RyaW5nXCIgPyAvXmdvW0EtWl0vLnRlc3QoYikgOiBiLm1vdGlvbilcbiAgICAgICAgICAgICAgIHsgcmV0dXJuIGRvSGFuZGxlQmluZGluZyhjbSwgYikgfVxuICAgICAgICAgICB9KVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBkaXNwYXRjaEtleShjbSwgbmFtZSwgZSwgZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGRvSGFuZGxlQmluZGluZyhjbSwgYik7IH0pXG4gIH1cbn1cblxuLy8gSGFuZGxlIGEga2V5IGZyb20gdGhlIGtleXByZXNzIGV2ZW50XG5mdW5jdGlvbiBoYW5kbGVDaGFyQmluZGluZyhjbSwgZSwgY2gpIHtcbiAgcmV0dXJuIGRpc3BhdGNoS2V5KGNtLCBcIidcIiArIGNoICsgXCInXCIsIGUsIGZ1bmN0aW9uIChiKSB7IHJldHVybiBkb0hhbmRsZUJpbmRpbmcoY20sIGIsIHRydWUpOyB9KVxufVxuXG52YXIgbGFzdFN0b3BwZWRLZXkgPSBudWxsO1xuZnVuY3Rpb24gb25LZXlEb3duKGUpIHtcbiAgdmFyIGNtID0gdGhpcztcbiAgY20uY3VyT3AuZm9jdXMgPSBhY3RpdmVFbHQoKTtcbiAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyByZXR1cm4gfVxuICAvLyBJRSBkb2VzIHN0cmFuZ2UgdGhpbmdzIHdpdGggZXNjYXBlLlxuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExICYmIGUua2V5Q29kZSA9PSAyNykgeyBlLnJldHVyblZhbHVlID0gZmFsc2U7IH1cbiAgdmFyIGNvZGUgPSBlLmtleUNvZGU7XG4gIGNtLmRpc3BsYXkuc2hpZnQgPSBjb2RlID09IDE2IHx8IGUuc2hpZnRLZXk7XG4gIHZhciBoYW5kbGVkID0gaGFuZGxlS2V5QmluZGluZyhjbSwgZSk7XG4gIGlmIChwcmVzdG8pIHtcbiAgICBsYXN0U3RvcHBlZEtleSA9IGhhbmRsZWQgPyBjb2RlIDogbnVsbDtcbiAgICAvLyBPcGVyYSBoYXMgbm8gY3V0IGV2ZW50Li4uIHdlIHRyeSB0byBhdCBsZWFzdCBjYXRjaCB0aGUga2V5IGNvbWJvXG4gICAgaWYgKCFoYW5kbGVkICYmIGNvZGUgPT0gODggJiYgIWhhc0NvcHlFdmVudCAmJiAobWFjID8gZS5tZXRhS2V5IDogZS5jdHJsS2V5KSlcbiAgICAgIHsgY20ucmVwbGFjZVNlbGVjdGlvbihcIlwiLCBudWxsLCBcImN1dFwiKTsgfVxuICB9XG5cbiAgLy8gVHVybiBtb3VzZSBpbnRvIGNyb3NzaGFpciB3aGVuIEFsdCBpcyBoZWxkIG9uIE1hYy5cbiAgaWYgKGNvZGUgPT0gMTggJiYgIS9cXGJDb2RlTWlycm9yLWNyb3NzaGFpclxcYi8udGVzdChjbS5kaXNwbGF5LmxpbmVEaXYuY2xhc3NOYW1lKSlcbiAgICB7IHNob3dDcm9zc0hhaXIoY20pOyB9XG59XG5cbmZ1bmN0aW9uIHNob3dDcm9zc0hhaXIoY20pIHtcbiAgdmFyIGxpbmVEaXYgPSBjbS5kaXNwbGF5LmxpbmVEaXY7XG4gIGFkZENsYXNzKGxpbmVEaXYsIFwiQ29kZU1pcnJvci1jcm9zc2hhaXJcIik7XG5cbiAgZnVuY3Rpb24gdXAoZSkge1xuICAgIGlmIChlLmtleUNvZGUgPT0gMTggfHwgIWUuYWx0S2V5KSB7XG4gICAgICBybUNsYXNzKGxpbmVEaXYsIFwiQ29kZU1pcnJvci1jcm9zc2hhaXJcIik7XG4gICAgICBvZmYoZG9jdW1lbnQsIFwia2V5dXBcIiwgdXApO1xuICAgICAgb2ZmKGRvY3VtZW50LCBcIm1vdXNlb3ZlclwiLCB1cCk7XG4gICAgfVxuICB9XG4gIG9uKGRvY3VtZW50LCBcImtleXVwXCIsIHVwKTtcbiAgb24oZG9jdW1lbnQsIFwibW91c2VvdmVyXCIsIHVwKTtcbn1cblxuZnVuY3Rpb24gb25LZXlVcChlKSB7XG4gIGlmIChlLmtleUNvZGUgPT0gMTYpIHsgdGhpcy5kb2Muc2VsLnNoaWZ0ID0gZmFsc2U7IH1cbiAgc2lnbmFsRE9NRXZlbnQodGhpcywgZSk7XG59XG5cbmZ1bmN0aW9uIG9uS2V5UHJlc3MoZSkge1xuICB2YXIgY20gPSB0aGlzO1xuICBpZiAoZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSB8fCBzaWduYWxET01FdmVudChjbSwgZSkgfHwgZS5jdHJsS2V5ICYmICFlLmFsdEtleSB8fCBtYWMgJiYgZS5tZXRhS2V5KSB7IHJldHVybiB9XG4gIHZhciBrZXlDb2RlID0gZS5rZXlDb2RlLCBjaGFyQ29kZSA9IGUuY2hhckNvZGU7XG4gIGlmIChwcmVzdG8gJiYga2V5Q29kZSA9PSBsYXN0U3RvcHBlZEtleSkge2xhc3RTdG9wcGVkS2V5ID0gbnVsbDsgZV9wcmV2ZW50RGVmYXVsdChlKTsgcmV0dXJufVxuICBpZiAoKHByZXN0byAmJiAoIWUud2hpY2ggfHwgZS53aGljaCA8IDEwKSkgJiYgaGFuZGxlS2V5QmluZGluZyhjbSwgZSkpIHsgcmV0dXJuIH1cbiAgdmFyIGNoID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyQ29kZSA9PSBudWxsID8ga2V5Q29kZSA6IGNoYXJDb2RlKTtcbiAgLy8gU29tZSBicm93c2VycyBmaXJlIGtleXByZXNzIGV2ZW50cyBmb3IgYmFja3NwYWNlXG4gIGlmIChjaCA9PSBcIlxceDA4XCIpIHsgcmV0dXJuIH1cbiAgaWYgKGhhbmRsZUNoYXJCaW5kaW5nKGNtLCBlLCBjaCkpIHsgcmV0dXJuIH1cbiAgY20uZGlzcGxheS5pbnB1dC5vbktleVByZXNzKGUpO1xufVxuXG4vLyBBIG1vdXNlIGRvd24gY2FuIGJlIGEgc2luZ2xlIGNsaWNrLCBkb3VibGUgY2xpY2ssIHRyaXBsZSBjbGljayxcbi8vIHN0YXJ0IG9mIHNlbGVjdGlvbiBkcmFnLCBzdGFydCBvZiB0ZXh0IGRyYWcsIG5ldyBjdXJzb3Jcbi8vIChjdHJsLWNsaWNrKSwgcmVjdGFuZ2xlIGRyYWcgKGFsdC1kcmFnKSwgb3IgeHdpblxuLy8gbWlkZGxlLWNsaWNrLXBhc3RlLiBPciBpdCBtaWdodCBiZSBhIGNsaWNrIG9uIHNvbWV0aGluZyB3ZSBzaG91bGRcbi8vIG5vdCBpbnRlcmZlcmUgd2l0aCwgc3VjaCBhcyBhIHNjcm9sbGJhciBvciB3aWRnZXQuXG5mdW5jdGlvbiBvbk1vdXNlRG93bihlKSB7XG4gIHZhciBjbSA9IHRoaXMsIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpIHx8IGRpc3BsYXkuYWN0aXZlVG91Y2ggJiYgZGlzcGxheS5pbnB1dC5zdXBwb3J0c1RvdWNoKCkpIHsgcmV0dXJuIH1cbiAgZGlzcGxheS5pbnB1dC5lbnN1cmVQb2xsZWQoKTtcbiAgZGlzcGxheS5zaGlmdCA9IGUuc2hpZnRLZXk7XG5cbiAgaWYgKGV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkpIHtcbiAgICBpZiAoIXdlYmtpdCkge1xuICAgICAgLy8gQnJpZWZseSB0dXJuIG9mZiBkcmFnZ2FiaWxpdHksIHRvIGFsbG93IHdpZGdldHMgdG8gZG9cbiAgICAgIC8vIG5vcm1hbCBkcmFnZ2luZyB0aGluZ3MuXG4gICAgICBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IGZhbHNlO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IHRydWU7IH0sIDEwMCk7XG4gICAgfVxuICAgIHJldHVyblxuICB9XG4gIGlmIChjbGlja0luR3V0dGVyKGNtLCBlKSkgeyByZXR1cm4gfVxuICB2YXIgc3RhcnQgPSBwb3NGcm9tTW91c2UoY20sIGUpO1xuICB3aW5kb3cuZm9jdXMoKTtcblxuICBzd2l0Y2ggKGVfYnV0dG9uKGUpKSB7XG4gIGNhc2UgMTpcbiAgICAvLyAjMzI2MTogbWFrZSBzdXJlLCB0aGF0IHdlJ3JlIG5vdCBzdGFydGluZyBhIHNlY29uZCBzZWxlY3Rpb25cbiAgICBpZiAoY20uc3RhdGUuc2VsZWN0aW5nVGV4dClcbiAgICAgIHsgY20uc3RhdGUuc2VsZWN0aW5nVGV4dChlKTsgfVxuICAgIGVsc2UgaWYgKHN0YXJ0KVxuICAgICAgeyBsZWZ0QnV0dG9uRG93bihjbSwgZSwgc3RhcnQpOyB9XG4gICAgZWxzZSBpZiAoZV90YXJnZXQoZSkgPT0gZGlzcGxheS5zY3JvbGxlcilcbiAgICAgIHsgZV9wcmV2ZW50RGVmYXVsdChlKTsgfVxuICAgIGJyZWFrXG4gIGNhc2UgMjpcbiAgICBpZiAod2Via2l0KSB7IGNtLnN0YXRlLmxhc3RNaWRkbGVEb3duID0gK25ldyBEYXRlOyB9XG4gICAgaWYgKHN0YXJ0KSB7IGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHN0YXJ0KTsgfVxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gZGlzcGxheS5pbnB1dC5mb2N1cygpOyB9LCAyMCk7XG4gICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICBicmVha1xuICBjYXNlIDM6XG4gICAgaWYgKGNhcHR1cmVSaWdodENsaWNrKSB7IG9uQ29udGV4dE1lbnUoY20sIGUpOyB9XG4gICAgZWxzZSB7IGRlbGF5Qmx1ckV2ZW50KGNtKTsgfVxuICAgIGJyZWFrXG4gIH1cbn1cblxudmFyIGxhc3RDbGljaztcbnZhciBsYXN0RG91YmxlQ2xpY2s7XG5mdW5jdGlvbiBsZWZ0QnV0dG9uRG93bihjbSwgZSwgc3RhcnQpIHtcbiAgaWYgKGllKSB7IHNldFRpbWVvdXQoYmluZChlbnN1cmVGb2N1cywgY20pLCAwKTsgfVxuICBlbHNlIHsgY20uY3VyT3AuZm9jdXMgPSBhY3RpdmVFbHQoKTsgfVxuXG4gIHZhciBub3cgPSArbmV3IERhdGUsIHR5cGU7XG4gIGlmIChsYXN0RG91YmxlQ2xpY2sgJiYgbGFzdERvdWJsZUNsaWNrLnRpbWUgPiBub3cgLSA0MDAgJiYgY21wKGxhc3REb3VibGVDbGljay5wb3MsIHN0YXJ0KSA9PSAwKSB7XG4gICAgdHlwZSA9IFwidHJpcGxlXCI7XG4gIH0gZWxzZSBpZiAobGFzdENsaWNrICYmIGxhc3RDbGljay50aW1lID4gbm93IC0gNDAwICYmIGNtcChsYXN0Q2xpY2sucG9zLCBzdGFydCkgPT0gMCkge1xuICAgIHR5cGUgPSBcImRvdWJsZVwiO1xuICAgIGxhc3REb3VibGVDbGljayA9IHt0aW1lOiBub3csIHBvczogc3RhcnR9O1xuICB9IGVsc2Uge1xuICAgIHR5cGUgPSBcInNpbmdsZVwiO1xuICAgIGxhc3RDbGljayA9IHt0aW1lOiBub3csIHBvczogc3RhcnR9O1xuICB9XG5cbiAgdmFyIHNlbCA9IGNtLmRvYy5zZWwsIG1vZGlmaWVyID0gbWFjID8gZS5tZXRhS2V5IDogZS5jdHJsS2V5LCBjb250YWluZWQ7XG4gIGlmIChjbS5vcHRpb25zLmRyYWdEcm9wICYmIGRyYWdBbmREcm9wICYmICFjbS5pc1JlYWRPbmx5KCkgJiZcbiAgICAgIHR5cGUgPT0gXCJzaW5nbGVcIiAmJiAoY29udGFpbmVkID0gc2VsLmNvbnRhaW5zKHN0YXJ0KSkgPiAtMSAmJlxuICAgICAgKGNtcCgoY29udGFpbmVkID0gc2VsLnJhbmdlc1tjb250YWluZWRdKS5mcm9tKCksIHN0YXJ0KSA8IDAgfHwgc3RhcnQueFJlbCA+IDApICYmXG4gICAgICAoY21wKGNvbnRhaW5lZC50bygpLCBzdGFydCkgPiAwIHx8IHN0YXJ0LnhSZWwgPCAwKSlcbiAgICB7IGxlZnRCdXR0b25TdGFydERyYWcoY20sIGUsIHN0YXJ0LCBtb2RpZmllcik7IH1cbiAgZWxzZVxuICAgIHsgbGVmdEJ1dHRvblNlbGVjdChjbSwgZSwgc3RhcnQsIHR5cGUsIG1vZGlmaWVyKTsgfVxufVxuXG4vLyBTdGFydCBhIHRleHQgZHJhZy4gV2hlbiBpdCBlbmRzLCBzZWUgaWYgYW55IGRyYWdnaW5nIGFjdHVhbGx5XG4vLyBoYXBwZW4sIGFuZCB0cmVhdCBhcyBhIGNsaWNrIGlmIGl0IGRpZG4ndC5cbmZ1bmN0aW9uIGxlZnRCdXR0b25TdGFydERyYWcoY20sIGUsIHN0YXJ0LCBtb2RpZmllcikge1xuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIG1vdmVkID0gZmFsc2U7XG4gIHZhciBkcmFnRW5kID0gb3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmICh3ZWJraXQpIHsgZGlzcGxheS5zY3JvbGxlci5kcmFnZ2FibGUgPSBmYWxzZTsgfVxuICAgIGNtLnN0YXRlLmRyYWdnaW5nVGV4dCA9IGZhbHNlO1xuICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZXVwXCIsIGRyYWdFbmQpO1xuICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlKTtcbiAgICBvZmYoZGlzcGxheS5zY3JvbGxlciwgXCJkcmFnc3RhcnRcIiwgZHJhZ1N0YXJ0KTtcbiAgICBvZmYoZGlzcGxheS5zY3JvbGxlciwgXCJkcm9wXCIsIGRyYWdFbmQpO1xuICAgIGlmICghbW92ZWQpIHtcbiAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgICBpZiAoIW1vZGlmaWVyKVxuICAgICAgICB7IGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHN0YXJ0KTsgfVxuICAgICAgLy8gV29yayBhcm91bmQgdW5leHBsYWluYWJsZSBmb2N1cyBwcm9ibGVtIGluIElFOSAoIzIxMjcpIGFuZCBDaHJvbWUgKCMzMDgxKVxuICAgICAgaWYgKHdlYmtpdCB8fCBpZSAmJiBpZV92ZXJzaW9uID09IDkpXG4gICAgICAgIHsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7ZG9jdW1lbnQuYm9keS5mb2N1cygpOyBkaXNwbGF5LmlucHV0LmZvY3VzKCk7fSwgMjApOyB9XG4gICAgICBlbHNlXG4gICAgICAgIHsgZGlzcGxheS5pbnB1dC5mb2N1cygpOyB9XG4gICAgfVxuICB9KTtcbiAgdmFyIG1vdXNlTW92ZSA9IGZ1bmN0aW9uKGUyKSB7XG4gICAgbW92ZWQgPSBtb3ZlZCB8fCBNYXRoLmFicyhlLmNsaWVudFggLSBlMi5jbGllbnRYKSArIE1hdGguYWJzKGUuY2xpZW50WSAtIGUyLmNsaWVudFkpID49IDEwO1xuICB9O1xuICB2YXIgZHJhZ1N0YXJ0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbW92ZWQgPSB0cnVlOyB9O1xuICAvLyBMZXQgdGhlIGRyYWcgaGFuZGxlciBoYW5kbGUgdGhpcy5cbiAgaWYgKHdlYmtpdCkgeyBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IHRydWU7IH1cbiAgY20uc3RhdGUuZHJhZ2dpbmdUZXh0ID0gZHJhZ0VuZDtcbiAgZHJhZ0VuZC5jb3B5ID0gbWFjID8gZS5hbHRLZXkgOiBlLmN0cmxLZXk7XG4gIC8vIElFJ3MgYXBwcm9hY2ggdG8gZHJhZ2dhYmxlXG4gIGlmIChkaXNwbGF5LnNjcm9sbGVyLmRyYWdEcm9wKSB7IGRpc3BsYXkuc2Nyb2xsZXIuZHJhZ0Ryb3AoKTsgfVxuICBvbihkb2N1bWVudCwgXCJtb3VzZXVwXCIsIGRyYWdFbmQpO1xuICBvbihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW91c2VNb3ZlKTtcbiAgb24oZGlzcGxheS5zY3JvbGxlciwgXCJkcmFnc3RhcnRcIiwgZHJhZ1N0YXJ0KTtcbiAgb24oZGlzcGxheS5zY3JvbGxlciwgXCJkcm9wXCIsIGRyYWdFbmQpO1xuXG4gIGRlbGF5Qmx1ckV2ZW50KGNtKTtcbiAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBkaXNwbGF5LmlucHV0LmZvY3VzKCk7IH0sIDIwKTtcbn1cblxuLy8gTm9ybWFsIHNlbGVjdGlvbiwgYXMgb3Bwb3NlZCB0byB0ZXh0IGRyYWdnaW5nLlxuZnVuY3Rpb24gbGVmdEJ1dHRvblNlbGVjdChjbSwgZSwgc3RhcnQsIHR5cGUsIGFkZE5ldykge1xuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcbiAgZV9wcmV2ZW50RGVmYXVsdChlKTtcblxuICB2YXIgb3VyUmFuZ2UsIG91ckluZGV4LCBzdGFydFNlbCA9IGRvYy5zZWwsIHJhbmdlcyA9IHN0YXJ0U2VsLnJhbmdlcztcbiAgaWYgKGFkZE5ldyAmJiAhZS5zaGlmdEtleSkge1xuICAgIG91ckluZGV4ID0gZG9jLnNlbC5jb250YWlucyhzdGFydCk7XG4gICAgaWYgKG91ckluZGV4ID4gLTEpXG4gICAgICB7IG91clJhbmdlID0gcmFuZ2VzW291ckluZGV4XTsgfVxuICAgIGVsc2VcbiAgICAgIHsgb3VyUmFuZ2UgPSBuZXcgUmFuZ2Uoc3RhcnQsIHN0YXJ0KTsgfVxuICB9IGVsc2Uge1xuICAgIG91clJhbmdlID0gZG9jLnNlbC5wcmltYXJ5KCk7XG4gICAgb3VySW5kZXggPSBkb2Muc2VsLnByaW1JbmRleDtcbiAgfVxuXG4gIGlmIChjaHJvbWVPUyA/IGUuc2hpZnRLZXkgJiYgZS5tZXRhS2V5IDogZS5hbHRLZXkpIHtcbiAgICB0eXBlID0gXCJyZWN0XCI7XG4gICAgaWYgKCFhZGROZXcpIHsgb3VyUmFuZ2UgPSBuZXcgUmFuZ2Uoc3RhcnQsIHN0YXJ0KTsgfVxuICAgIHN0YXJ0ID0gcG9zRnJvbU1vdXNlKGNtLCBlLCB0cnVlLCB0cnVlKTtcbiAgICBvdXJJbmRleCA9IC0xO1xuICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJkb3VibGVcIikge1xuICAgIHZhciB3b3JkID0gY20uZmluZFdvcmRBdChzdGFydCk7XG4gICAgaWYgKGNtLmRpc3BsYXkuc2hpZnQgfHwgZG9jLmV4dGVuZClcbiAgICAgIHsgb3VyUmFuZ2UgPSBleHRlbmRSYW5nZShkb2MsIG91clJhbmdlLCB3b3JkLmFuY2hvciwgd29yZC5oZWFkKTsgfVxuICAgIGVsc2VcbiAgICAgIHsgb3VyUmFuZ2UgPSB3b3JkOyB9XG4gIH0gZWxzZSBpZiAodHlwZSA9PSBcInRyaXBsZVwiKSB7XG4gICAgdmFyIGxpbmUgPSBuZXcgUmFuZ2UoUG9zKHN0YXJ0LmxpbmUsIDApLCBjbGlwUG9zKGRvYywgUG9zKHN0YXJ0LmxpbmUgKyAxLCAwKSkpO1xuICAgIGlmIChjbS5kaXNwbGF5LnNoaWZ0IHx8IGRvYy5leHRlbmQpXG4gICAgICB7IG91clJhbmdlID0gZXh0ZW5kUmFuZ2UoZG9jLCBvdXJSYW5nZSwgbGluZS5hbmNob3IsIGxpbmUuaGVhZCk7IH1cbiAgICBlbHNlXG4gICAgICB7IG91clJhbmdlID0gbGluZTsgfVxuICB9IGVsc2Uge1xuICAgIG91clJhbmdlID0gZXh0ZW5kUmFuZ2UoZG9jLCBvdXJSYW5nZSwgc3RhcnQpO1xuICB9XG5cbiAgaWYgKCFhZGROZXcpIHtcbiAgICBvdXJJbmRleCA9IDA7XG4gICAgc2V0U2VsZWN0aW9uKGRvYywgbmV3IFNlbGVjdGlvbihbb3VyUmFuZ2VdLCAwKSwgc2VsX21vdXNlKTtcbiAgICBzdGFydFNlbCA9IGRvYy5zZWw7XG4gIH0gZWxzZSBpZiAob3VySW5kZXggPT0gLTEpIHtcbiAgICBvdXJJbmRleCA9IHJhbmdlcy5sZW5ndGg7XG4gICAgc2V0U2VsZWN0aW9uKGRvYywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcy5jb25jYXQoW291clJhbmdlXSksIG91ckluZGV4KSxcbiAgICAgICAgICAgICAgICAge3Njcm9sbDogZmFsc2UsIG9yaWdpbjogXCIqbW91c2VcIn0pO1xuICB9IGVsc2UgaWYgKHJhbmdlcy5sZW5ndGggPiAxICYmIHJhbmdlc1tvdXJJbmRleF0uZW1wdHkoKSAmJiB0eXBlID09IFwic2luZ2xlXCIgJiYgIWUuc2hpZnRLZXkpIHtcbiAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24ocmFuZ2VzLnNsaWNlKDAsIG91ckluZGV4KS5jb25jYXQocmFuZ2VzLnNsaWNlKG91ckluZGV4ICsgMSkpLCAwKSxcbiAgICAgICAgICAgICAgICAge3Njcm9sbDogZmFsc2UsIG9yaWdpbjogXCIqbW91c2VcIn0pO1xuICAgIHN0YXJ0U2VsID0gZG9jLnNlbDtcbiAgfSBlbHNlIHtcbiAgICByZXBsYWNlT25lU2VsZWN0aW9uKGRvYywgb3VySW5kZXgsIG91clJhbmdlLCBzZWxfbW91c2UpO1xuICB9XG5cbiAgdmFyIGxhc3RQb3MgPSBzdGFydDtcbiAgZnVuY3Rpb24gZXh0ZW5kVG8ocG9zKSB7XG4gICAgaWYgKGNtcChsYXN0UG9zLCBwb3MpID09IDApIHsgcmV0dXJuIH1cbiAgICBsYXN0UG9zID0gcG9zO1xuXG4gICAgaWYgKHR5cGUgPT0gXCJyZWN0XCIpIHtcbiAgICAgIHZhciByYW5nZXMgPSBbXSwgdGFiU2l6ZSA9IGNtLm9wdGlvbnMudGFiU2l6ZTtcbiAgICAgIHZhciBzdGFydENvbCA9IGNvdW50Q29sdW1uKGdldExpbmUoZG9jLCBzdGFydC5saW5lKS50ZXh0LCBzdGFydC5jaCwgdGFiU2l6ZSk7XG4gICAgICB2YXIgcG9zQ29sID0gY291bnRDb2x1bW4oZ2V0TGluZShkb2MsIHBvcy5saW5lKS50ZXh0LCBwb3MuY2gsIHRhYlNpemUpO1xuICAgICAgdmFyIGxlZnQgPSBNYXRoLm1pbihzdGFydENvbCwgcG9zQ29sKSwgcmlnaHQgPSBNYXRoLm1heChzdGFydENvbCwgcG9zQ29sKTtcbiAgICAgIGZvciAodmFyIGxpbmUgPSBNYXRoLm1pbihzdGFydC5saW5lLCBwb3MubGluZSksIGVuZCA9IE1hdGgubWluKGNtLmxhc3RMaW5lKCksIE1hdGgubWF4KHN0YXJ0LmxpbmUsIHBvcy5saW5lKSk7XG4gICAgICAgICAgIGxpbmUgPD0gZW5kOyBsaW5lKyspIHtcbiAgICAgICAgdmFyIHRleHQgPSBnZXRMaW5lKGRvYywgbGluZSkudGV4dCwgbGVmdFBvcyA9IGZpbmRDb2x1bW4odGV4dCwgbGVmdCwgdGFiU2l6ZSk7XG4gICAgICAgIGlmIChsZWZ0ID09IHJpZ2h0KVxuICAgICAgICAgIHsgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKFBvcyhsaW5lLCBsZWZ0UG9zKSwgUG9zKGxpbmUsIGxlZnRQb3MpKSk7IH1cbiAgICAgICAgZWxzZSBpZiAodGV4dC5sZW5ndGggPiBsZWZ0UG9zKVxuICAgICAgICAgIHsgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKFBvcyhsaW5lLCBsZWZ0UG9zKSwgUG9zKGxpbmUsIGZpbmRDb2x1bW4odGV4dCwgcmlnaHQsIHRhYlNpemUpKSkpOyB9XG4gICAgICB9XG4gICAgICBpZiAoIXJhbmdlcy5sZW5ndGgpIHsgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKHN0YXJ0LCBzdGFydCkpOyB9XG4gICAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24oc3RhcnRTZWwucmFuZ2VzLnNsaWNlKDAsIG91ckluZGV4KS5jb25jYXQocmFuZ2VzKSwgb3VySW5kZXgpLFxuICAgICAgICAgICAgICAgICAgIHtvcmlnaW46IFwiKm1vdXNlXCIsIHNjcm9sbDogZmFsc2V9KTtcbiAgICAgIGNtLnNjcm9sbEludG9WaWV3KHBvcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBvbGRSYW5nZSA9IG91clJhbmdlO1xuICAgICAgdmFyIGFuY2hvciA9IG9sZFJhbmdlLmFuY2hvciwgaGVhZCA9IHBvcztcbiAgICAgIGlmICh0eXBlICE9IFwic2luZ2xlXCIpIHtcbiAgICAgICAgdmFyIHJhbmdlJCQxO1xuICAgICAgICBpZiAodHlwZSA9PSBcImRvdWJsZVwiKVxuICAgICAgICAgIHsgcmFuZ2UkJDEgPSBjbS5maW5kV29yZEF0KHBvcyk7IH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgIHsgcmFuZ2UkJDEgPSBuZXcgUmFuZ2UoUG9zKHBvcy5saW5lLCAwKSwgY2xpcFBvcyhkb2MsIFBvcyhwb3MubGluZSArIDEsIDApKSk7IH1cbiAgICAgICAgaWYgKGNtcChyYW5nZSQkMS5hbmNob3IsIGFuY2hvcikgPiAwKSB7XG4gICAgICAgICAgaGVhZCA9IHJhbmdlJCQxLmhlYWQ7XG4gICAgICAgICAgYW5jaG9yID0gbWluUG9zKG9sZFJhbmdlLmZyb20oKSwgcmFuZ2UkJDEuYW5jaG9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBoZWFkID0gcmFuZ2UkJDEuYW5jaG9yO1xuICAgICAgICAgIGFuY2hvciA9IG1heFBvcyhvbGRSYW5nZS50bygpLCByYW5nZSQkMS5oZWFkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIHJhbmdlcyQxID0gc3RhcnRTZWwucmFuZ2VzLnNsaWNlKDApO1xuICAgICAgcmFuZ2VzJDFbb3VySW5kZXhdID0gbmV3IFJhbmdlKGNsaXBQb3MoZG9jLCBhbmNob3IpLCBoZWFkKTtcbiAgICAgIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihyYW5nZXMkMSwgb3VySW5kZXgpLCBzZWxfbW91c2UpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBlZGl0b3JTaXplID0gZGlzcGxheS53cmFwcGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAvLyBVc2VkIHRvIGVuc3VyZSB0aW1lb3V0IHJlLXRyaWVzIGRvbid0IGZpcmUgd2hlbiBhbm90aGVyIGV4dGVuZFxuICAvLyBoYXBwZW5lZCBpbiB0aGUgbWVhbnRpbWUgKGNsZWFyVGltZW91dCBpc24ndCByZWxpYWJsZSAtLSBhdFxuICAvLyBsZWFzdCBvbiBDaHJvbWUsIHRoZSB0aW1lb3V0cyBzdGlsbCBoYXBwZW4gZXZlbiB3aGVuIGNsZWFyZWQsXG4gIC8vIGlmIHRoZSBjbGVhciBoYXBwZW5zIGFmdGVyIHRoZWlyIHNjaGVkdWxlZCBmaXJpbmcgdGltZSkuXG4gIHZhciBjb3VudGVyID0gMDtcblxuICBmdW5jdGlvbiBleHRlbmQoZSkge1xuICAgIHZhciBjdXJDb3VudCA9ICsrY291bnRlcjtcbiAgICB2YXIgY3VyID0gcG9zRnJvbU1vdXNlKGNtLCBlLCB0cnVlLCB0eXBlID09IFwicmVjdFwiKTtcbiAgICBpZiAoIWN1cikgeyByZXR1cm4gfVxuICAgIGlmIChjbXAoY3VyLCBsYXN0UG9zKSAhPSAwKSB7XG4gICAgICBjbS5jdXJPcC5mb2N1cyA9IGFjdGl2ZUVsdCgpO1xuICAgICAgZXh0ZW5kVG8oY3VyKTtcbiAgICAgIHZhciB2aXNpYmxlID0gdmlzaWJsZUxpbmVzKGRpc3BsYXksIGRvYyk7XG4gICAgICBpZiAoY3VyLmxpbmUgPj0gdmlzaWJsZS50byB8fCBjdXIubGluZSA8IHZpc2libGUuZnJvbSlcbiAgICAgICAgeyBzZXRUaW1lb3V0KG9wZXJhdGlvbihjbSwgZnVuY3Rpb24gKCkge2lmIChjb3VudGVyID09IGN1ckNvdW50KSB7IGV4dGVuZChlKTsgfX0pLCAxNTApOyB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBvdXRzaWRlID0gZS5jbGllbnRZIDwgZWRpdG9yU2l6ZS50b3AgPyAtMjAgOiBlLmNsaWVudFkgPiBlZGl0b3JTaXplLmJvdHRvbSA/IDIwIDogMDtcbiAgICAgIGlmIChvdXRzaWRlKSB7IHNldFRpbWVvdXQob3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChjb3VudGVyICE9IGN1ckNvdW50KSB7IHJldHVybiB9XG4gICAgICAgIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wICs9IG91dHNpZGU7XG4gICAgICAgIGV4dGVuZChlKTtcbiAgICAgIH0pLCA1MCk7IH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkb25lKGUpIHtcbiAgICBjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0ID0gZmFsc2U7XG4gICAgY291bnRlciA9IEluZmluaXR5O1xuICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgZGlzcGxheS5pbnB1dC5mb2N1cygpO1xuICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW92ZSk7XG4gICAgb2ZmKGRvY3VtZW50LCBcIm1vdXNldXBcIiwgdXApO1xuICAgIGRvYy5oaXN0b3J5Lmxhc3RTZWxPcmlnaW4gPSBudWxsO1xuICB9XG5cbiAgdmFyIG1vdmUgPSBvcGVyYXRpb24oY20sIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCFlX2J1dHRvbihlKSkgeyBkb25lKGUpOyB9XG4gICAgZWxzZSB7IGV4dGVuZChlKTsgfVxuICB9KTtcbiAgdmFyIHVwID0gb3BlcmF0aW9uKGNtLCBkb25lKTtcbiAgY20uc3RhdGUuc2VsZWN0aW5nVGV4dCA9IHVwO1xuICBvbihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW92ZSk7XG4gIG9uKGRvY3VtZW50LCBcIm1vdXNldXBcIiwgdXApO1xufVxuXG5cbi8vIERldGVybWluZXMgd2hldGhlciBhbiBldmVudCBoYXBwZW5lZCBpbiB0aGUgZ3V0dGVyLCBhbmQgZmlyZXMgdGhlXG4vLyBoYW5kbGVycyBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgZXZlbnQuXG5mdW5jdGlvbiBndXR0ZXJFdmVudChjbSwgZSwgdHlwZSwgcHJldmVudCkge1xuICB2YXIgbVgsIG1ZO1xuICB0cnkgeyBtWCA9IGUuY2xpZW50WDsgbVkgPSBlLmNsaWVudFk7IH1cbiAgY2F0Y2goZSkgeyByZXR1cm4gZmFsc2UgfVxuICBpZiAobVggPj0gTWF0aC5mbG9vcihjbS5kaXNwbGF5Lmd1dHRlcnMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQpKSB7IHJldHVybiBmYWxzZSB9XG4gIGlmIChwcmV2ZW50KSB7IGVfcHJldmVudERlZmF1bHQoZSk7IH1cblxuICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gIHZhciBsaW5lQm94ID0gZGlzcGxheS5saW5lRGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gIGlmIChtWSA+IGxpbmVCb3guYm90dG9tIHx8ICFoYXNIYW5kbGVyKGNtLCB0eXBlKSkgeyByZXR1cm4gZV9kZWZhdWx0UHJldmVudGVkKGUpIH1cbiAgbVkgLT0gbGluZUJveC50b3AgLSBkaXNwbGF5LnZpZXdPZmZzZXQ7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbS5vcHRpb25zLmd1dHRlcnMubGVuZ3RoOyArK2kpIHtcbiAgICB2YXIgZyA9IGRpc3BsYXkuZ3V0dGVycy5jaGlsZE5vZGVzW2ldO1xuICAgIGlmIChnICYmIGcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQgPj0gbVgpIHtcbiAgICAgIHZhciBsaW5lID0gbGluZUF0SGVpZ2h0KGNtLmRvYywgbVkpO1xuICAgICAgdmFyIGd1dHRlciA9IGNtLm9wdGlvbnMuZ3V0dGVyc1tpXTtcbiAgICAgIHNpZ25hbChjbSwgdHlwZSwgY20sIGxpbmUsIGd1dHRlciwgZSk7XG4gICAgICByZXR1cm4gZV9kZWZhdWx0UHJldmVudGVkKGUpXG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNsaWNrSW5HdXR0ZXIoY20sIGUpIHtcbiAgcmV0dXJuIGd1dHRlckV2ZW50KGNtLCBlLCBcImd1dHRlckNsaWNrXCIsIHRydWUpXG59XG5cbi8vIENPTlRFWFQgTUVOVSBIQU5ETElOR1xuXG4vLyBUbyBtYWtlIHRoZSBjb250ZXh0IG1lbnUgd29yaywgd2UgbmVlZCB0byBicmllZmx5IHVuaGlkZSB0aGVcbi8vIHRleHRhcmVhIChtYWtpbmcgaXQgYXMgdW5vYnRydXNpdmUgYXMgcG9zc2libGUpIHRvIGxldCB0aGVcbi8vIHJpZ2h0LWNsaWNrIHRha2UgZWZmZWN0IG9uIGl0LlxuZnVuY3Rpb24gb25Db250ZXh0TWVudShjbSwgZSkge1xuICBpZiAoZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSB8fCBjb250ZXh0TWVudUluR3V0dGVyKGNtLCBlKSkgeyByZXR1cm4gfVxuICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUsIFwiY29udGV4dG1lbnVcIikpIHsgcmV0dXJuIH1cbiAgY20uZGlzcGxheS5pbnB1dC5vbkNvbnRleHRNZW51KGUpO1xufVxuXG5mdW5jdGlvbiBjb250ZXh0TWVudUluR3V0dGVyKGNtLCBlKSB7XG4gIGlmICghaGFzSGFuZGxlcihjbSwgXCJndXR0ZXJDb250ZXh0TWVudVwiKSkgeyByZXR1cm4gZmFsc2UgfVxuICByZXR1cm4gZ3V0dGVyRXZlbnQoY20sIGUsIFwiZ3V0dGVyQ29udGV4dE1lbnVcIiwgZmFsc2UpXG59XG5cbmZ1bmN0aW9uIHRoZW1lQ2hhbmdlZChjbSkge1xuICBjbS5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lID0gY20uZGlzcGxheS53cmFwcGVyLmNsYXNzTmFtZS5yZXBsYWNlKC9cXHMqY20tcy1cXFMrL2csIFwiXCIpICtcbiAgICBjbS5vcHRpb25zLnRoZW1lLnJlcGxhY2UoLyhefFxccylcXHMqL2csIFwiIGNtLXMtXCIpO1xuICBjbGVhckNhY2hlcyhjbSk7XG59XG5cbnZhciBJbml0ID0ge3RvU3RyaW5nOiBmdW5jdGlvbigpe3JldHVybiBcIkNvZGVNaXJyb3IuSW5pdFwifX07XG5cbnZhciBkZWZhdWx0cyA9IHt9O1xudmFyIG9wdGlvbkhhbmRsZXJzID0ge307XG5cbmZ1bmN0aW9uIGRlZmluZU9wdGlvbnMoQ29kZU1pcnJvcikge1xuICB2YXIgb3B0aW9uSGFuZGxlcnMgPSBDb2RlTWlycm9yLm9wdGlvbkhhbmRsZXJzO1xuXG4gIGZ1bmN0aW9uIG9wdGlvbihuYW1lLCBkZWZsdCwgaGFuZGxlLCBub3RPbkluaXQpIHtcbiAgICBDb2RlTWlycm9yLmRlZmF1bHRzW25hbWVdID0gZGVmbHQ7XG4gICAgaWYgKGhhbmRsZSkgeyBvcHRpb25IYW5kbGVyc1tuYW1lXSA9XG4gICAgICBub3RPbkluaXQgPyBmdW5jdGlvbiAoY20sIHZhbCwgb2xkKSB7aWYgKG9sZCAhPSBJbml0KSB7IGhhbmRsZShjbSwgdmFsLCBvbGQpOyB9fSA6IGhhbmRsZTsgfVxuICB9XG5cbiAgQ29kZU1pcnJvci5kZWZpbmVPcHRpb24gPSBvcHRpb247XG5cbiAgLy8gUGFzc2VkIHRvIG9wdGlvbiBoYW5kbGVycyB3aGVuIHRoZXJlIGlzIG5vIG9sZCB2YWx1ZS5cbiAgQ29kZU1pcnJvci5Jbml0ID0gSW5pdDtcblxuICAvLyBUaGVzZSB0d28gYXJlLCBvbiBpbml0LCBjYWxsZWQgZnJvbSB0aGUgY29uc3RydWN0b3IgYmVjYXVzZSB0aGV5XG4gIC8vIGhhdmUgdG8gYmUgaW5pdGlhbGl6ZWQgYmVmb3JlIHRoZSBlZGl0b3IgY2FuIHN0YXJ0IGF0IGFsbC5cbiAgb3B0aW9uKFwidmFsdWVcIiwgXCJcIiwgZnVuY3Rpb24gKGNtLCB2YWwpIHsgcmV0dXJuIGNtLnNldFZhbHVlKHZhbCk7IH0sIHRydWUpO1xuICBvcHRpb24oXCJtb2RlXCIsIG51bGwsIGZ1bmN0aW9uIChjbSwgdmFsKSB7XG4gICAgY20uZG9jLm1vZGVPcHRpb24gPSB2YWw7XG4gICAgbG9hZE1vZGUoY20pO1xuICB9LCB0cnVlKTtcblxuICBvcHRpb24oXCJpbmRlbnRVbml0XCIsIDIsIGxvYWRNb2RlLCB0cnVlKTtcbiAgb3B0aW9uKFwiaW5kZW50V2l0aFRhYnNcIiwgZmFsc2UpO1xuICBvcHRpb24oXCJzbWFydEluZGVudFwiLCB0cnVlKTtcbiAgb3B0aW9uKFwidGFiU2l6ZVwiLCA0LCBmdW5jdGlvbiAoY20pIHtcbiAgICByZXNldE1vZGVTdGF0ZShjbSk7XG4gICAgY2xlYXJDYWNoZXMoY20pO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJsaW5lU2VwYXJhdG9yXCIsIG51bGwsIGZ1bmN0aW9uIChjbSwgdmFsKSB7XG4gICAgY20uZG9jLmxpbmVTZXAgPSB2YWw7XG4gICAgaWYgKCF2YWwpIHsgcmV0dXJuIH1cbiAgICB2YXIgbmV3QnJlYWtzID0gW10sIGxpbmVObyA9IGNtLmRvYy5maXJzdDtcbiAgICBjbS5kb2MuaXRlcihmdW5jdGlvbiAobGluZSkge1xuICAgICAgZm9yICh2YXIgcG9zID0gMDs7KSB7XG4gICAgICAgIHZhciBmb3VuZCA9IGxpbmUudGV4dC5pbmRleE9mKHZhbCwgcG9zKTtcbiAgICAgICAgaWYgKGZvdW5kID09IC0xKSB7IGJyZWFrIH1cbiAgICAgICAgcG9zID0gZm91bmQgKyB2YWwubGVuZ3RoO1xuICAgICAgICBuZXdCcmVha3MucHVzaChQb3MobGluZU5vLCBmb3VuZCkpO1xuICAgICAgfVxuICAgICAgbGluZU5vKys7XG4gICAgfSk7XG4gICAgZm9yICh2YXIgaSA9IG5ld0JyZWFrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSlcbiAgICAgIHsgcmVwbGFjZVJhbmdlKGNtLmRvYywgdmFsLCBuZXdCcmVha3NbaV0sIFBvcyhuZXdCcmVha3NbaV0ubGluZSwgbmV3QnJlYWtzW2ldLmNoICsgdmFsLmxlbmd0aCkpOyB9XG4gIH0pO1xuICBvcHRpb24oXCJzcGVjaWFsQ2hhcnNcIiwgL1tcXHUwMDAwLVxcdTAwMWZcXHUwMDdmLVxcdTAwOWZcXHUwMGFkXFx1MDYxY1xcdTIwMGItXFx1MjAwZlxcdTIwMjhcXHUyMDI5XFx1ZmVmZl0vZywgZnVuY3Rpb24gKGNtLCB2YWwsIG9sZCkge1xuICAgIGNtLnN0YXRlLnNwZWNpYWxDaGFycyA9IG5ldyBSZWdFeHAodmFsLnNvdXJjZSArICh2YWwudGVzdChcIlxcdFwiKSA/IFwiXCIgOiBcInxcXHRcIiksIFwiZ1wiKTtcbiAgICBpZiAob2xkICE9IEluaXQpIHsgY20ucmVmcmVzaCgpOyB9XG4gIH0pO1xuICBvcHRpb24oXCJzcGVjaWFsQ2hhclBsYWNlaG9sZGVyXCIsIGRlZmF1bHRTcGVjaWFsQ2hhclBsYWNlaG9sZGVyLCBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlZnJlc2goKTsgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcImVsZWN0cmljQ2hhcnNcIiwgdHJ1ZSk7XG4gIG9wdGlvbihcImlucHV0U3R5bGVcIiwgbW9iaWxlID8gXCJjb250ZW50ZWRpdGFibGVcIiA6IFwidGV4dGFyZWFcIiwgZnVuY3Rpb24gKCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImlucHV0U3R5bGUgY2FuIG5vdCAoeWV0KSBiZSBjaGFuZ2VkIGluIGEgcnVubmluZyBlZGl0b3JcIikgLy8gRklYTUVcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcInNwZWxsY2hlY2tcIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7IHJldHVybiBjbS5nZXRJbnB1dEZpZWxkKCkuc3BlbGxjaGVjayA9IHZhbDsgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcInJ0bE1vdmVWaXN1YWxseVwiLCAhd2luZG93cyk7XG4gIG9wdGlvbihcIndob2xlTGluZVVwZGF0ZUJlZm9yZVwiLCB0cnVlKTtcblxuICBvcHRpb24oXCJ0aGVtZVwiLCBcImRlZmF1bHRcIiwgZnVuY3Rpb24gKGNtKSB7XG4gICAgdGhlbWVDaGFuZ2VkKGNtKTtcbiAgICBndXR0ZXJzQ2hhbmdlZChjbSk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJrZXlNYXBcIiwgXCJkZWZhdWx0XCIsIGZ1bmN0aW9uIChjbSwgdmFsLCBvbGQpIHtcbiAgICB2YXIgbmV4dCA9IGdldEtleU1hcCh2YWwpO1xuICAgIHZhciBwcmV2ID0gb2xkICE9IEluaXQgJiYgZ2V0S2V5TWFwKG9sZCk7XG4gICAgaWYgKHByZXYgJiYgcHJldi5kZXRhY2gpIHsgcHJldi5kZXRhY2goY20sIG5leHQpOyB9XG4gICAgaWYgKG5leHQuYXR0YWNoKSB7IG5leHQuYXR0YWNoKGNtLCBwcmV2IHx8IG51bGwpOyB9XG4gIH0pO1xuICBvcHRpb24oXCJleHRyYUtleXNcIiwgbnVsbCk7XG5cbiAgb3B0aW9uKFwibGluZVdyYXBwaW5nXCIsIGZhbHNlLCB3cmFwcGluZ0NoYW5nZWQsIHRydWUpO1xuICBvcHRpb24oXCJndXR0ZXJzXCIsIFtdLCBmdW5jdGlvbiAoY20pIHtcbiAgICBzZXRHdXR0ZXJzRm9yTGluZU51bWJlcnMoY20ub3B0aW9ucyk7XG4gICAgZ3V0dGVyc0NoYW5nZWQoY20pO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwiZml4ZWRHdXR0ZXJcIiwgdHJ1ZSwgZnVuY3Rpb24gKGNtLCB2YWwpIHtcbiAgICBjbS5kaXNwbGF5Lmd1dHRlcnMuc3R5bGUubGVmdCA9IHZhbCA/IGNvbXBlbnNhdGVGb3JIU2Nyb2xsKGNtLmRpc3BsYXkpICsgXCJweFwiIDogXCIwXCI7XG4gICAgY20ucmVmcmVzaCgpO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwiY292ZXJHdXR0ZXJOZXh0VG9TY3JvbGxiYXJcIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gdXBkYXRlU2Nyb2xsYmFycyhjbSk7IH0sIHRydWUpO1xuICBvcHRpb24oXCJzY3JvbGxiYXJTdHlsZVwiLCBcIm5hdGl2ZVwiLCBmdW5jdGlvbiAoY20pIHtcbiAgICBpbml0U2Nyb2xsYmFycyhjbSk7XG4gICAgdXBkYXRlU2Nyb2xsYmFycyhjbSk7XG4gICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcChjbS5kb2Muc2Nyb2xsVG9wKTtcbiAgICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuc2V0U2Nyb2xsTGVmdChjbS5kb2Muc2Nyb2xsTGVmdCk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJsaW5lTnVtYmVyc1wiLCBmYWxzZSwgZnVuY3Rpb24gKGNtKSB7XG4gICAgc2V0R3V0dGVyc0ZvckxpbmVOdW1iZXJzKGNtLm9wdGlvbnMpO1xuICAgIGd1dHRlcnNDaGFuZ2VkKGNtKTtcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcImZpcnN0TGluZU51bWJlclwiLCAxLCBndXR0ZXJzQ2hhbmdlZCwgdHJ1ZSk7XG4gIG9wdGlvbihcImxpbmVOdW1iZXJGb3JtYXR0ZXJcIiwgZnVuY3Rpb24gKGludGVnZXIpIHsgcmV0dXJuIGludGVnZXI7IH0sIGd1dHRlcnNDaGFuZ2VkLCB0cnVlKTtcbiAgb3B0aW9uKFwic2hvd0N1cnNvcldoZW5TZWxlY3RpbmdcIiwgZmFsc2UsIHVwZGF0ZVNlbGVjdGlvbiwgdHJ1ZSk7XG5cbiAgb3B0aW9uKFwicmVzZXRTZWxlY3Rpb25PbkNvbnRleHRNZW51XCIsIHRydWUpO1xuICBvcHRpb24oXCJsaW5lV2lzZUNvcHlDdXRcIiwgdHJ1ZSk7XG5cbiAgb3B0aW9uKFwicmVhZE9ubHlcIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7XG4gICAgaWYgKHZhbCA9PSBcIm5vY3Vyc29yXCIpIHtcbiAgICAgIG9uQmx1cihjbSk7XG4gICAgICBjbS5kaXNwbGF5LmlucHV0LmJsdXIoKTtcbiAgICAgIGNtLmRpc3BsYXkuZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjbS5kaXNwbGF5LmRpc2FibGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGNtLmRpc3BsYXkuaW5wdXQucmVhZE9ubHlDaGFuZ2VkKHZhbCk7XG4gIH0pO1xuICBvcHRpb24oXCJkaXNhYmxlSW5wdXRcIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7aWYgKCF2YWwpIHsgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpOyB9fSwgdHJ1ZSk7XG4gIG9wdGlvbihcImRyYWdEcm9wXCIsIHRydWUsIGRyYWdEcm9wQ2hhbmdlZCk7XG4gIG9wdGlvbihcImFsbG93RHJvcEZpbGVUeXBlc1wiLCBudWxsKTtcblxuICBvcHRpb24oXCJjdXJzb3JCbGlua1JhdGVcIiwgNTMwKTtcbiAgb3B0aW9uKFwiY3Vyc29yU2Nyb2xsTWFyZ2luXCIsIDApO1xuICBvcHRpb24oXCJjdXJzb3JIZWlnaHRcIiwgMSwgdXBkYXRlU2VsZWN0aW9uLCB0cnVlKTtcbiAgb3B0aW9uKFwic2luZ2xlQ3Vyc29ySGVpZ2h0UGVyTGluZVwiLCB0cnVlLCB1cGRhdGVTZWxlY3Rpb24sIHRydWUpO1xuICBvcHRpb24oXCJ3b3JrVGltZVwiLCAxMDApO1xuICBvcHRpb24oXCJ3b3JrRGVsYXlcIiwgMTAwKTtcbiAgb3B0aW9uKFwiZmxhdHRlblNwYW5zXCIsIHRydWUsIHJlc2V0TW9kZVN0YXRlLCB0cnVlKTtcbiAgb3B0aW9uKFwiYWRkTW9kZUNsYXNzXCIsIGZhbHNlLCByZXNldE1vZGVTdGF0ZSwgdHJ1ZSk7XG4gIG9wdGlvbihcInBvbGxJbnRlcnZhbFwiLCAxMDApO1xuICBvcHRpb24oXCJ1bmRvRGVwdGhcIiwgMjAwLCBmdW5jdGlvbiAoY20sIHZhbCkgeyByZXR1cm4gY20uZG9jLmhpc3RvcnkudW5kb0RlcHRoID0gdmFsOyB9KTtcbiAgb3B0aW9uKFwiaGlzdG9yeUV2ZW50RGVsYXlcIiwgMTI1MCk7XG4gIG9wdGlvbihcInZpZXdwb3J0TWFyZ2luXCIsIDEwLCBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlZnJlc2goKTsgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcIm1heEhpZ2hsaWdodExlbmd0aFwiLCAxMDAwMCwgcmVzZXRNb2RlU3RhdGUsIHRydWUpO1xuICBvcHRpb24oXCJtb3ZlSW5wdXRXaXRoQ3Vyc29yXCIsIHRydWUsIGZ1bmN0aW9uIChjbSwgdmFsKSB7XG4gICAgaWYgKCF2YWwpIHsgY20uZGlzcGxheS5pbnB1dC5yZXNldFBvc2l0aW9uKCk7IH1cbiAgfSk7XG5cbiAgb3B0aW9uKFwidGFiaW5kZXhcIiwgbnVsbCwgZnVuY3Rpb24gKGNtLCB2YWwpIHsgcmV0dXJuIGNtLmRpc3BsYXkuaW5wdXQuZ2V0RmllbGQoKS50YWJJbmRleCA9IHZhbCB8fCBcIlwiOyB9KTtcbiAgb3B0aW9uKFwiYXV0b2ZvY3VzXCIsIG51bGwpO1xuICBvcHRpb24oXCJkaXJlY3Rpb25cIiwgXCJsdHJcIiwgZnVuY3Rpb24gKGNtLCB2YWwpIHsgcmV0dXJuIGNtLmRvYy5zZXREaXJlY3Rpb24odmFsKTsgfSwgdHJ1ZSk7XG59XG5cbmZ1bmN0aW9uIGd1dHRlcnNDaGFuZ2VkKGNtKSB7XG4gIHVwZGF0ZUd1dHRlcnMoY20pO1xuICByZWdDaGFuZ2UoY20pO1xuICBhbGlnbkhvcml6b250YWxseShjbSk7XG59XG5cbmZ1bmN0aW9uIGRyYWdEcm9wQ2hhbmdlZChjbSwgdmFsdWUsIG9sZCkge1xuICB2YXIgd2FzT24gPSBvbGQgJiYgb2xkICE9IEluaXQ7XG4gIGlmICghdmFsdWUgIT0gIXdhc09uKSB7XG4gICAgdmFyIGZ1bmNzID0gY20uZGlzcGxheS5kcmFnRnVuY3Rpb25zO1xuICAgIHZhciB0b2dnbGUgPSB2YWx1ZSA/IG9uIDogb2ZmO1xuICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCBcImRyYWdzdGFydFwiLCBmdW5jcy5zdGFydCk7XG4gICAgdG9nZ2xlKGNtLmRpc3BsYXkuc2Nyb2xsZXIsIFwiZHJhZ2VudGVyXCIsIGZ1bmNzLmVudGVyKTtcbiAgICB0b2dnbGUoY20uZGlzcGxheS5zY3JvbGxlciwgXCJkcmFnb3ZlclwiLCBmdW5jcy5vdmVyKTtcbiAgICB0b2dnbGUoY20uZGlzcGxheS5zY3JvbGxlciwgXCJkcmFnbGVhdmVcIiwgZnVuY3MubGVhdmUpO1xuICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCBcImRyb3BcIiwgZnVuY3MuZHJvcCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gd3JhcHBpbmdDaGFuZ2VkKGNtKSB7XG4gIGlmIChjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgIGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgXCJDb2RlTWlycm9yLXdyYXBcIik7XG4gICAgY20uZGlzcGxheS5zaXplci5zdHlsZS5taW5XaWR0aCA9IFwiXCI7XG4gICAgY20uZGlzcGxheS5zaXplcldpZHRoID0gbnVsbDtcbiAgfSBlbHNlIHtcbiAgICBybUNsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgXCJDb2RlTWlycm9yLXdyYXBcIik7XG4gICAgZmluZE1heExpbmUoY20pO1xuICB9XG4gIGVzdGltYXRlTGluZUhlaWdodHMoY20pO1xuICByZWdDaGFuZ2UoY20pO1xuICBjbGVhckNhY2hlcyhjbSk7XG4gIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gdXBkYXRlU2Nyb2xsYmFycyhjbSk7IH0sIDEwMCk7XG59XG5cbi8vIEEgQ29kZU1pcnJvciBpbnN0YW5jZSByZXByZXNlbnRzIGFuIGVkaXRvci4gVGhpcyBpcyB0aGUgb2JqZWN0XG4vLyB0aGF0IHVzZXIgY29kZSBpcyB1c3VhbGx5IGRlYWxpbmcgd2l0aC5cblxuZnVuY3Rpb24gQ29kZU1pcnJvciQxKHBsYWNlLCBvcHRpb25zKSB7XG4gIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIGlmICghKHRoaXMgaW5zdGFuY2VvZiBDb2RlTWlycm9yJDEpKSB7IHJldHVybiBuZXcgQ29kZU1pcnJvciQxKHBsYWNlLCBvcHRpb25zKSB9XG5cbiAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyA9IG9wdGlvbnMgPyBjb3B5T2JqKG9wdGlvbnMpIDoge307XG4gIC8vIERldGVybWluZSBlZmZlY3RpdmUgb3B0aW9ucyBiYXNlZCBvbiBnaXZlbiB2YWx1ZXMgYW5kIGRlZmF1bHRzLlxuICBjb3B5T2JqKGRlZmF1bHRzLCBvcHRpb25zLCBmYWxzZSk7XG4gIHNldEd1dHRlcnNGb3JMaW5lTnVtYmVycyhvcHRpb25zKTtcblxuICB2YXIgZG9jID0gb3B0aW9ucy52YWx1ZTtcbiAgaWYgKHR5cGVvZiBkb2MgPT0gXCJzdHJpbmdcIikgeyBkb2MgPSBuZXcgRG9jKGRvYywgb3B0aW9ucy5tb2RlLCBudWxsLCBvcHRpb25zLmxpbmVTZXBhcmF0b3IsIG9wdGlvbnMuZGlyZWN0aW9uKTsgfVxuICB0aGlzLmRvYyA9IGRvYztcblxuICB2YXIgaW5wdXQgPSBuZXcgQ29kZU1pcnJvciQxLmlucHV0U3R5bGVzW29wdGlvbnMuaW5wdXRTdHlsZV0odGhpcyk7XG4gIHZhciBkaXNwbGF5ID0gdGhpcy5kaXNwbGF5ID0gbmV3IERpc3BsYXkocGxhY2UsIGRvYywgaW5wdXQpO1xuICBkaXNwbGF5LndyYXBwZXIuQ29kZU1pcnJvciA9IHRoaXM7XG4gIHVwZGF0ZUd1dHRlcnModGhpcyk7XG4gIHRoZW1lQ2hhbmdlZCh0aGlzKTtcbiAgaWYgKG9wdGlvbnMubGluZVdyYXBwaW5nKVxuICAgIHsgdGhpcy5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lICs9IFwiIENvZGVNaXJyb3Itd3JhcFwiOyB9XG4gIGluaXRTY3JvbGxiYXJzKHRoaXMpO1xuXG4gIHRoaXMuc3RhdGUgPSB7XG4gICAga2V5TWFwczogW10sICAvLyBzdG9yZXMgbWFwcyBhZGRlZCBieSBhZGRLZXlNYXBcbiAgICBvdmVybGF5czogW10sIC8vIGhpZ2hsaWdodGluZyBvdmVybGF5cywgYXMgYWRkZWQgYnkgYWRkT3ZlcmxheVxuICAgIG1vZGVHZW46IDAsICAgLy8gYnVtcGVkIHdoZW4gbW9kZS9vdmVybGF5IGNoYW5nZXMsIHVzZWQgdG8gaW52YWxpZGF0ZSBoaWdobGlnaHRpbmcgaW5mb1xuICAgIG92ZXJ3cml0ZTogZmFsc2UsXG4gICAgZGVsYXlpbmdCbHVyRXZlbnQ6IGZhbHNlLFxuICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgIHN1cHByZXNzRWRpdHM6IGZhbHNlLCAvLyB1c2VkIHRvIGRpc2FibGUgZWRpdGluZyBkdXJpbmcga2V5IGhhbmRsZXJzIHdoZW4gaW4gcmVhZE9ubHkgbW9kZVxuICAgIHBhc3RlSW5jb21pbmc6IGZhbHNlLCBjdXRJbmNvbWluZzogZmFsc2UsIC8vIGhlbHAgcmVjb2duaXplIHBhc3RlL2N1dCBlZGl0cyBpbiBpbnB1dC5wb2xsXG4gICAgc2VsZWN0aW5nVGV4dDogZmFsc2UsXG4gICAgZHJhZ2dpbmdUZXh0OiBmYWxzZSxcbiAgICBoaWdobGlnaHQ6IG5ldyBEZWxheWVkKCksIC8vIHN0b3JlcyBoaWdobGlnaHQgd29ya2VyIHRpbWVvdXRcbiAgICBrZXlTZXE6IG51bGwsICAvLyBVbmZpbmlzaGVkIGtleSBzZXF1ZW5jZVxuICAgIHNwZWNpYWxDaGFyczogbnVsbFxuICB9O1xuXG4gIGlmIChvcHRpb25zLmF1dG9mb2N1cyAmJiAhbW9iaWxlKSB7IGRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgfVxuXG4gIC8vIE92ZXJyaWRlIG1hZ2ljIHRleHRhcmVhIGNvbnRlbnQgcmVzdG9yZSB0aGF0IElFIHNvbWV0aW1lcyBkb2VzXG4gIC8vIG9uIG91ciBoaWRkZW4gdGV4dGFyZWEgb24gcmVsb2FkXG4gIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgMTEpIHsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzJDEuZGlzcGxheS5pbnB1dC5yZXNldCh0cnVlKTsgfSwgMjApOyB9XG5cbiAgcmVnaXN0ZXJFdmVudEhhbmRsZXJzKHRoaXMpO1xuICBlbnN1cmVHbG9iYWxIYW5kbGVycygpO1xuXG4gIHN0YXJ0T3BlcmF0aW9uKHRoaXMpO1xuICB0aGlzLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTtcbiAgYXR0YWNoRG9jKHRoaXMsIGRvYyk7XG5cbiAgaWYgKChvcHRpb25zLmF1dG9mb2N1cyAmJiAhbW9iaWxlKSB8fCB0aGlzLmhhc0ZvY3VzKCkpXG4gICAgeyBzZXRUaW1lb3V0KGJpbmQob25Gb2N1cywgdGhpcyksIDIwKTsgfVxuICBlbHNlXG4gICAgeyBvbkJsdXIodGhpcyk7IH1cblxuICBmb3IgKHZhciBvcHQgaW4gb3B0aW9uSGFuZGxlcnMpIHsgaWYgKG9wdGlvbkhhbmRsZXJzLmhhc093blByb3BlcnR5KG9wdCkpXG4gICAgeyBvcHRpb25IYW5kbGVyc1tvcHRdKHRoaXMkMSwgb3B0aW9uc1tvcHRdLCBJbml0KTsgfSB9XG4gIG1heWJlVXBkYXRlTGluZU51bWJlcldpZHRoKHRoaXMpO1xuICBpZiAob3B0aW9ucy5maW5pc2hJbml0KSB7IG9wdGlvbnMuZmluaXNoSW5pdCh0aGlzKTsgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRIb29rcy5sZW5ndGg7ICsraSkgeyBpbml0SG9va3NbaV0odGhpcyQxKTsgfVxuICBlbmRPcGVyYXRpb24odGhpcyk7XG4gIC8vIFN1cHByZXNzIG9wdGltaXplbGVnaWJpbGl0eSBpbiBXZWJraXQsIHNpbmNlIGl0IGJyZWFrcyB0ZXh0XG4gIC8vIG1lYXN1cmluZyBvbiBsaW5lIHdyYXBwaW5nIGJvdW5kYXJpZXMuXG4gIGlmICh3ZWJraXQgJiYgb3B0aW9ucy5saW5lV3JhcHBpbmcgJiZcbiAgICAgIGdldENvbXB1dGVkU3R5bGUoZGlzcGxheS5saW5lRGl2KS50ZXh0UmVuZGVyaW5nID09IFwib3B0aW1pemVsZWdpYmlsaXR5XCIpXG4gICAgeyBkaXNwbGF5LmxpbmVEaXYuc3R5bGUudGV4dFJlbmRlcmluZyA9IFwiYXV0b1wiOyB9XG59XG5cbi8vIFRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gb3B0aW9ucy5cbkNvZGVNaXJyb3IkMS5kZWZhdWx0cyA9IGRlZmF1bHRzO1xuLy8gRnVuY3Rpb25zIHRvIHJ1biB3aGVuIG9wdGlvbnMgYXJlIGNoYW5nZWQuXG5Db2RlTWlycm9yJDEub3B0aW9uSGFuZGxlcnMgPSBvcHRpb25IYW5kbGVycztcblxuLy8gQXR0YWNoIHRoZSBuZWNlc3NhcnkgZXZlbnQgaGFuZGxlcnMgd2hlbiBpbml0aWFsaXppbmcgdGhlIGVkaXRvclxuZnVuY3Rpb24gcmVnaXN0ZXJFdmVudEhhbmRsZXJzKGNtKSB7XG4gIHZhciBkID0gY20uZGlzcGxheTtcbiAgb24oZC5zY3JvbGxlciwgXCJtb3VzZWRvd25cIiwgb3BlcmF0aW9uKGNtLCBvbk1vdXNlRG93bikpO1xuICAvLyBPbGRlciBJRSdzIHdpbGwgbm90IGZpcmUgYSBzZWNvbmQgbW91c2Vkb3duIGZvciBhIGRvdWJsZSBjbGlja1xuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKVxuICAgIHsgb24oZC5zY3JvbGxlciwgXCJkYmxjbGlja1wiLCBvcGVyYXRpb24oY20sIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpKSB7IHJldHVybiB9XG4gICAgICB2YXIgcG9zID0gcG9zRnJvbU1vdXNlKGNtLCBlKTtcbiAgICAgIGlmICghcG9zIHx8IGNsaWNrSW5HdXR0ZXIoY20sIGUpIHx8IGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkpIHsgcmV0dXJuIH1cbiAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgICB2YXIgd29yZCA9IGNtLmZpbmRXb3JkQXQocG9zKTtcbiAgICAgIGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHdvcmQuYW5jaG9yLCB3b3JkLmhlYWQpO1xuICAgIH0pKTsgfVxuICBlbHNlXG4gICAgeyBvbihkLnNjcm9sbGVyLCBcImRibGNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBzaWduYWxET01FdmVudChjbSwgZSkgfHwgZV9wcmV2ZW50RGVmYXVsdChlKTsgfSk7IH1cbiAgLy8gU29tZSBicm93c2VycyBmaXJlIGNvbnRleHRtZW51ICphZnRlciogb3BlbmluZyB0aGUgbWVudSwgYXRcbiAgLy8gd2hpY2ggcG9pbnQgd2UgY2FuJ3QgbWVzcyB3aXRoIGl0IGFueW1vcmUuIENvbnRleHQgbWVudSBpc1xuICAvLyBoYW5kbGVkIGluIG9uTW91c2VEb3duIGZvciB0aGVzZSBicm93c2Vycy5cbiAgaWYgKCFjYXB0dXJlUmlnaHRDbGljaykgeyBvbihkLnNjcm9sbGVyLCBcImNvbnRleHRtZW51XCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvbkNvbnRleHRNZW51KGNtLCBlKTsgfSk7IH1cblxuICAvLyBVc2VkIHRvIHN1cHByZXNzIG1vdXNlIGV2ZW50IGhhbmRsaW5nIHdoZW4gYSB0b3VjaCBoYXBwZW5zXG4gIHZhciB0b3VjaEZpbmlzaGVkLCBwcmV2VG91Y2ggPSB7ZW5kOiAwfTtcbiAgZnVuY3Rpb24gZmluaXNoVG91Y2goKSB7XG4gICAgaWYgKGQuYWN0aXZlVG91Y2gpIHtcbiAgICAgIHRvdWNoRmluaXNoZWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGQuYWN0aXZlVG91Y2ggPSBudWxsOyB9LCAxMDAwKTtcbiAgICAgIHByZXZUb3VjaCA9IGQuYWN0aXZlVG91Y2g7XG4gICAgICBwcmV2VG91Y2guZW5kID0gK25ldyBEYXRlO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBpc01vdXNlTGlrZVRvdWNoRXZlbnQoZSkge1xuICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoICE9IDEpIHsgcmV0dXJuIGZhbHNlIH1cbiAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgcmV0dXJuIHRvdWNoLnJhZGl1c1ggPD0gMSAmJiB0b3VjaC5yYWRpdXNZIDw9IDFcbiAgfVxuICBmdW5jdGlvbiBmYXJBd2F5KHRvdWNoLCBvdGhlcikge1xuICAgIGlmIChvdGhlci5sZWZ0ID09IG51bGwpIHsgcmV0dXJuIHRydWUgfVxuICAgIHZhciBkeCA9IG90aGVyLmxlZnQgLSB0b3VjaC5sZWZ0LCBkeSA9IG90aGVyLnRvcCAtIHRvdWNoLnRvcDtcbiAgICByZXR1cm4gZHggKiBkeCArIGR5ICogZHkgPiAyMCAqIDIwXG4gIH1cbiAgb24oZC5zY3JvbGxlciwgXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCFzaWduYWxET01FdmVudChjbSwgZSkgJiYgIWlzTW91c2VMaWtlVG91Y2hFdmVudChlKSkge1xuICAgICAgZC5pbnB1dC5lbnN1cmVQb2xsZWQoKTtcbiAgICAgIGNsZWFyVGltZW91dCh0b3VjaEZpbmlzaGVkKTtcbiAgICAgIHZhciBub3cgPSArbmV3IERhdGU7XG4gICAgICBkLmFjdGl2ZVRvdWNoID0ge3N0YXJ0OiBub3csIG1vdmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgcHJldjogbm93IC0gcHJldlRvdWNoLmVuZCA8PSAzMDAgPyBwcmV2VG91Y2ggOiBudWxsfTtcbiAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgZC5hY3RpdmVUb3VjaC5sZWZ0ID0gZS50b3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICBkLmFjdGl2ZVRvdWNoLnRvcCA9IGUudG91Y2hlc1swXS5wYWdlWTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICBvbihkLnNjcm9sbGVyLCBcInRvdWNobW92ZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGQuYWN0aXZlVG91Y2gpIHsgZC5hY3RpdmVUb3VjaC5tb3ZlZCA9IHRydWU7IH1cbiAgfSk7XG4gIG9uKGQuc2Nyb2xsZXIsIFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgdG91Y2ggPSBkLmFjdGl2ZVRvdWNoO1xuICAgIGlmICh0b3VjaCAmJiAhZXZlbnRJbldpZGdldChkLCBlKSAmJiB0b3VjaC5sZWZ0ICE9IG51bGwgJiZcbiAgICAgICAgIXRvdWNoLm1vdmVkICYmIG5ldyBEYXRlIC0gdG91Y2guc3RhcnQgPCAzMDApIHtcbiAgICAgIHZhciBwb3MgPSBjbS5jb29yZHNDaGFyKGQuYWN0aXZlVG91Y2gsIFwicGFnZVwiKSwgcmFuZ2U7XG4gICAgICBpZiAoIXRvdWNoLnByZXYgfHwgZmFyQXdheSh0b3VjaCwgdG91Y2gucHJldikpIC8vIFNpbmdsZSB0YXBcbiAgICAgICAgeyByYW5nZSA9IG5ldyBSYW5nZShwb3MsIHBvcyk7IH1cbiAgICAgIGVsc2UgaWYgKCF0b3VjaC5wcmV2LnByZXYgfHwgZmFyQXdheSh0b3VjaCwgdG91Y2gucHJldi5wcmV2KSkgLy8gRG91YmxlIHRhcFxuICAgICAgICB7IHJhbmdlID0gY20uZmluZFdvcmRBdChwb3MpOyB9XG4gICAgICBlbHNlIC8vIFRyaXBsZSB0YXBcbiAgICAgICAgeyByYW5nZSA9IG5ldyBSYW5nZShQb3MocG9zLmxpbmUsIDApLCBjbGlwUG9zKGNtLmRvYywgUG9zKHBvcy5saW5lICsgMSwgMCkpKTsgfVxuICAgICAgY20uc2V0U2VsZWN0aW9uKHJhbmdlLmFuY2hvciwgcmFuZ2UuaGVhZCk7XG4gICAgICBjbS5mb2N1cygpO1xuICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICB9XG4gICAgZmluaXNoVG91Y2goKTtcbiAgfSk7XG4gIG9uKGQuc2Nyb2xsZXIsIFwidG91Y2hjYW5jZWxcIiwgZmluaXNoVG91Y2gpO1xuXG4gIC8vIFN5bmMgc2Nyb2xsaW5nIGJldHdlZW4gZmFrZSBzY3JvbGxiYXJzIGFuZCByZWFsIHNjcm9sbGFibGVcbiAgLy8gYXJlYSwgZW5zdXJlIHZpZXdwb3J0IGlzIHVwZGF0ZWQgd2hlbiBzY3JvbGxpbmcuXG4gIG9uKGQuc2Nyb2xsZXIsIFwic2Nyb2xsXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZC5zY3JvbGxlci5jbGllbnRIZWlnaHQpIHtcbiAgICAgIHVwZGF0ZVNjcm9sbFRvcChjbSwgZC5zY3JvbGxlci5zY3JvbGxUb3ApO1xuICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgZC5zY3JvbGxlci5zY3JvbGxMZWZ0LCB0cnVlKTtcbiAgICAgIHNpZ25hbChjbSwgXCJzY3JvbGxcIiwgY20pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gTGlzdGVuIHRvIHdoZWVsIGV2ZW50cyBpbiBvcmRlciB0byB0cnkgYW5kIHVwZGF0ZSB0aGUgdmlld3BvcnQgb24gdGltZS5cbiAgb24oZC5zY3JvbGxlciwgXCJtb3VzZXdoZWVsXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvblNjcm9sbFdoZWVsKGNtLCBlKTsgfSk7XG4gIG9uKGQuc2Nyb2xsZXIsIFwiRE9NTW91c2VTY3JvbGxcIiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uU2Nyb2xsV2hlZWwoY20sIGUpOyB9KTtcblxuICAvLyBQcmV2ZW50IHdyYXBwZXIgZnJvbSBldmVyIHNjcm9sbGluZ1xuICBvbihkLndyYXBwZXIsIFwic2Nyb2xsXCIsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGQud3JhcHBlci5zY3JvbGxUb3AgPSBkLndyYXBwZXIuc2Nyb2xsTGVmdCA9IDA7IH0pO1xuXG4gIGQuZHJhZ0Z1bmN0aW9ucyA9IHtcbiAgICBlbnRlcjogZnVuY3Rpb24gKGUpIHtpZiAoIXNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyBlX3N0b3AoZSk7IH19LFxuICAgIG92ZXI6IGZ1bmN0aW9uIChlKSB7aWYgKCFzaWduYWxET01FdmVudChjbSwgZSkpIHsgb25EcmFnT3ZlcihjbSwgZSk7IGVfc3RvcChlKTsgfX0sXG4gICAgc3RhcnQ6IGZ1bmN0aW9uIChlKSB7IHJldHVybiBvbkRyYWdTdGFydChjbSwgZSk7IH0sXG4gICAgZHJvcDogb3BlcmF0aW9uKGNtLCBvbkRyb3ApLFxuICAgIGxlYXZlOiBmdW5jdGlvbiAoZSkge2lmICghc2lnbmFsRE9NRXZlbnQoY20sIGUpKSB7IGNsZWFyRHJhZ0N1cnNvcihjbSk7IH19XG4gIH07XG5cbiAgdmFyIGlucCA9IGQuaW5wdXQuZ2V0RmllbGQoKTtcbiAgb24oaW5wLCBcImtleXVwXCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvbktleVVwLmNhbGwoY20sIGUpOyB9KTtcbiAgb24oaW5wLCBcImtleWRvd25cIiwgb3BlcmF0aW9uKGNtLCBvbktleURvd24pKTtcbiAgb24oaW5wLCBcImtleXByZXNzXCIsIG9wZXJhdGlvbihjbSwgb25LZXlQcmVzcykpO1xuICBvbihpbnAsIFwiZm9jdXNcIiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uRm9jdXMoY20sIGUpOyB9KTtcbiAgb24oaW5wLCBcImJsdXJcIiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uQmx1cihjbSwgZSk7IH0pO1xufVxuXG52YXIgaW5pdEhvb2tzID0gW107XG5Db2RlTWlycm9yJDEuZGVmaW5lSW5pdEhvb2sgPSBmdW5jdGlvbiAoZikgeyByZXR1cm4gaW5pdEhvb2tzLnB1c2goZik7IH07XG5cbi8vIEluZGVudCB0aGUgZ2l2ZW4gbGluZS4gVGhlIGhvdyBwYXJhbWV0ZXIgY2FuIGJlIFwic21hcnRcIixcbi8vIFwiYWRkXCIvbnVsbCwgXCJzdWJ0cmFjdFwiLCBvciBcInByZXZcIi4gV2hlbiBhZ2dyZXNzaXZlIGlzIGZhbHNlXG4vLyAodHlwaWNhbGx5IHNldCB0byB0cnVlIGZvciBmb3JjZWQgc2luZ2xlLWxpbmUgaW5kZW50cyksIGVtcHR5XG4vLyBsaW5lcyBhcmUgbm90IGluZGVudGVkLCBhbmQgcGxhY2VzIHdoZXJlIHRoZSBtb2RlIHJldHVybnMgUGFzc1xuLy8gYXJlIGxlZnQgYWxvbmUuXG5mdW5jdGlvbiBpbmRlbnRMaW5lKGNtLCBuLCBob3csIGFnZ3Jlc3NpdmUpIHtcbiAgdmFyIGRvYyA9IGNtLmRvYywgc3RhdGU7XG4gIGlmIChob3cgPT0gbnVsbCkgeyBob3cgPSBcImFkZFwiOyB9XG4gIGlmIChob3cgPT0gXCJzbWFydFwiKSB7XG4gICAgLy8gRmFsbCBiYWNrIHRvIFwicHJldlwiIHdoZW4gdGhlIG1vZGUgZG9lc24ndCBoYXZlIGFuIGluZGVudGF0aW9uXG4gICAgLy8gbWV0aG9kLlxuICAgIGlmICghZG9jLm1vZGUuaW5kZW50KSB7IGhvdyA9IFwicHJldlwiOyB9XG4gICAgZWxzZSB7IHN0YXRlID0gZ2V0U3RhdGVCZWZvcmUoY20sIG4pOyB9XG4gIH1cblxuICB2YXIgdGFiU2l6ZSA9IGNtLm9wdGlvbnMudGFiU2l6ZTtcbiAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgbiksIGN1clNwYWNlID0gY291bnRDb2x1bW4obGluZS50ZXh0LCBudWxsLCB0YWJTaXplKTtcbiAgaWYgKGxpbmUuc3RhdGVBZnRlcikgeyBsaW5lLnN0YXRlQWZ0ZXIgPSBudWxsOyB9XG4gIHZhciBjdXJTcGFjZVN0cmluZyA9IGxpbmUudGV4dC5tYXRjaCgvXlxccyovKVswXSwgaW5kZW50YXRpb247XG4gIGlmICghYWdncmVzc2l2ZSAmJiAhL1xcUy8udGVzdChsaW5lLnRleHQpKSB7XG4gICAgaW5kZW50YXRpb24gPSAwO1xuICAgIGhvdyA9IFwibm90XCI7XG4gIH0gZWxzZSBpZiAoaG93ID09IFwic21hcnRcIikge1xuICAgIGluZGVudGF0aW9uID0gZG9jLm1vZGUuaW5kZW50KHN0YXRlLCBsaW5lLnRleHQuc2xpY2UoY3VyU3BhY2VTdHJpbmcubGVuZ3RoKSwgbGluZS50ZXh0KTtcbiAgICBpZiAoaW5kZW50YXRpb24gPT0gUGFzcyB8fCBpbmRlbnRhdGlvbiA+IDE1MCkge1xuICAgICAgaWYgKCFhZ2dyZXNzaXZlKSB7IHJldHVybiB9XG4gICAgICBob3cgPSBcInByZXZcIjtcbiAgICB9XG4gIH1cbiAgaWYgKGhvdyA9PSBcInByZXZcIikge1xuICAgIGlmIChuID4gZG9jLmZpcnN0KSB7IGluZGVudGF0aW9uID0gY291bnRDb2x1bW4oZ2V0TGluZShkb2MsIG4tMSkudGV4dCwgbnVsbCwgdGFiU2l6ZSk7IH1cbiAgICBlbHNlIHsgaW5kZW50YXRpb24gPSAwOyB9XG4gIH0gZWxzZSBpZiAoaG93ID09IFwiYWRkXCIpIHtcbiAgICBpbmRlbnRhdGlvbiA9IGN1clNwYWNlICsgY20ub3B0aW9ucy5pbmRlbnRVbml0O1xuICB9IGVsc2UgaWYgKGhvdyA9PSBcInN1YnRyYWN0XCIpIHtcbiAgICBpbmRlbnRhdGlvbiA9IGN1clNwYWNlIC0gY20ub3B0aW9ucy5pbmRlbnRVbml0O1xuICB9IGVsc2UgaWYgKHR5cGVvZiBob3cgPT0gXCJudW1iZXJcIikge1xuICAgIGluZGVudGF0aW9uID0gY3VyU3BhY2UgKyBob3c7XG4gIH1cbiAgaW5kZW50YXRpb24gPSBNYXRoLm1heCgwLCBpbmRlbnRhdGlvbik7XG5cbiAgdmFyIGluZGVudFN0cmluZyA9IFwiXCIsIHBvcyA9IDA7XG4gIGlmIChjbS5vcHRpb25zLmluZGVudFdpdGhUYWJzKVxuICAgIHsgZm9yICh2YXIgaSA9IE1hdGguZmxvb3IoaW5kZW50YXRpb24gLyB0YWJTaXplKTsgaTsgLS1pKSB7cG9zICs9IHRhYlNpemU7IGluZGVudFN0cmluZyArPSBcIlxcdFwiO30gfVxuICBpZiAocG9zIDwgaW5kZW50YXRpb24pIHsgaW5kZW50U3RyaW5nICs9IHNwYWNlU3RyKGluZGVudGF0aW9uIC0gcG9zKTsgfVxuXG4gIGlmIChpbmRlbnRTdHJpbmcgIT0gY3VyU3BhY2VTdHJpbmcpIHtcbiAgICByZXBsYWNlUmFuZ2UoZG9jLCBpbmRlbnRTdHJpbmcsIFBvcyhuLCAwKSwgUG9zKG4sIGN1clNwYWNlU3RyaW5nLmxlbmd0aCksIFwiK2lucHV0XCIpO1xuICAgIGxpbmUuc3RhdGVBZnRlciA9IG51bGw7XG4gICAgcmV0dXJuIHRydWVcbiAgfSBlbHNlIHtcbiAgICAvLyBFbnN1cmUgdGhhdCwgaWYgdGhlIGN1cnNvciB3YXMgaW4gdGhlIHdoaXRlc3BhY2UgYXQgdGhlIHN0YXJ0XG4gICAgLy8gb2YgdGhlIGxpbmUsIGl0IGlzIG1vdmVkIHRvIHRoZSBlbmQgb2YgdGhhdCBzcGFjZS5cbiAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkkMSsrKSB7XG4gICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpJDFdO1xuICAgICAgaWYgKHJhbmdlLmhlYWQubGluZSA9PSBuICYmIHJhbmdlLmhlYWQuY2ggPCBjdXJTcGFjZVN0cmluZy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIHBvcyQxID0gUG9zKG4sIGN1clNwYWNlU3RyaW5nLmxlbmd0aCk7XG4gICAgICAgIHJlcGxhY2VPbmVTZWxlY3Rpb24oZG9jLCBpJDEsIG5ldyBSYW5nZShwb3MkMSwgcG9zJDEpKTtcbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLy8gVGhpcyB3aWxsIGJlIHNldCB0byBhIHtsaW5lV2lzZTogYm9vbCwgdGV4dDogW3N0cmluZ119IG9iamVjdCwgc29cbi8vIHRoYXQsIHdoZW4gcGFzdGluZywgd2Uga25vdyB3aGF0IGtpbmQgb2Ygc2VsZWN0aW9ucyB0aGUgY29waWVkXG4vLyB0ZXh0IHdhcyBtYWRlIG91dCBvZi5cbnZhciBsYXN0Q29waWVkID0gbnVsbDtcblxuZnVuY3Rpb24gc2V0TGFzdENvcGllZChuZXdMYXN0Q29waWVkKSB7XG4gIGxhc3RDb3BpZWQgPSBuZXdMYXN0Q29waWVkO1xufVxuXG5mdW5jdGlvbiBhcHBseVRleHRJbnB1dChjbSwgaW5zZXJ0ZWQsIGRlbGV0ZWQsIHNlbCwgb3JpZ2luKSB7XG4gIHZhciBkb2MgPSBjbS5kb2M7XG4gIGNtLmRpc3BsYXkuc2hpZnQgPSBmYWxzZTtcbiAgaWYgKCFzZWwpIHsgc2VsID0gZG9jLnNlbDsgfVxuXG4gIHZhciBwYXN0ZSA9IGNtLnN0YXRlLnBhc3RlSW5jb21pbmcgfHwgb3JpZ2luID09IFwicGFzdGVcIjtcbiAgdmFyIHRleHRMaW5lcyA9IHNwbGl0TGluZXNBdXRvKGluc2VydGVkKSwgbXVsdGlQYXN0ZSA9IG51bGw7XG4gIC8vIFdoZW4gcGFzaW5nIE4gbGluZXMgaW50byBOIHNlbGVjdGlvbnMsIGluc2VydCBvbmUgbGluZSBwZXIgc2VsZWN0aW9uXG4gIGlmIChwYXN0ZSAmJiBzZWwucmFuZ2VzLmxlbmd0aCA+IDEpIHtcbiAgICBpZiAobGFzdENvcGllZCAmJiBsYXN0Q29waWVkLnRleHQuam9pbihcIlxcblwiKSA9PSBpbnNlcnRlZCkge1xuICAgICAgaWYgKHNlbC5yYW5nZXMubGVuZ3RoICUgbGFzdENvcGllZC50ZXh0Lmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIG11bHRpUGFzdGUgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0Q29waWVkLnRleHQubGVuZ3RoOyBpKyspXG4gICAgICAgICAgeyBtdWx0aVBhc3RlLnB1c2goZG9jLnNwbGl0TGluZXMobGFzdENvcGllZC50ZXh0W2ldKSk7IH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRleHRMaW5lcy5sZW5ndGggPT0gc2VsLnJhbmdlcy5sZW5ndGgpIHtcbiAgICAgIG11bHRpUGFzdGUgPSBtYXAodGV4dExpbmVzLCBmdW5jdGlvbiAobCkgeyByZXR1cm4gW2xdOyB9KTtcbiAgICB9XG4gIH1cblxuICB2YXIgdXBkYXRlSW5wdXQ7XG4gIC8vIE5vcm1hbCBiZWhhdmlvciBpcyB0byBpbnNlcnQgdGhlIG5ldyB0ZXh0IGludG8gZXZlcnkgc2VsZWN0aW9uXG4gIGZvciAodmFyIGkkMSA9IHNlbC5yYW5nZXMubGVuZ3RoIC0gMTsgaSQxID49IDA7IGkkMS0tKSB7XG4gICAgdmFyIHJhbmdlJCQxID0gc2VsLnJhbmdlc1tpJDFdO1xuICAgIHZhciBmcm9tID0gcmFuZ2UkJDEuZnJvbSgpLCB0byA9IHJhbmdlJCQxLnRvKCk7XG4gICAgaWYgKHJhbmdlJCQxLmVtcHR5KCkpIHtcbiAgICAgIGlmIChkZWxldGVkICYmIGRlbGV0ZWQgPiAwKSAvLyBIYW5kbGUgZGVsZXRpb25cbiAgICAgICAgeyBmcm9tID0gUG9zKGZyb20ubGluZSwgZnJvbS5jaCAtIGRlbGV0ZWQpOyB9XG4gICAgICBlbHNlIGlmIChjbS5zdGF0ZS5vdmVyd3JpdGUgJiYgIXBhc3RlKSAvLyBIYW5kbGUgb3ZlcndyaXRlXG4gICAgICAgIHsgdG8gPSBQb3ModG8ubGluZSwgTWF0aC5taW4oZ2V0TGluZShkb2MsIHRvLmxpbmUpLnRleHQubGVuZ3RoLCB0by5jaCArIGxzdCh0ZXh0TGluZXMpLmxlbmd0aCkpOyB9XG4gICAgICBlbHNlIGlmIChsYXN0Q29waWVkICYmIGxhc3RDb3BpZWQubGluZVdpc2UgJiYgbGFzdENvcGllZC50ZXh0LmpvaW4oXCJcXG5cIikgPT0gaW5zZXJ0ZWQpXG4gICAgICAgIHsgZnJvbSA9IHRvID0gUG9zKGZyb20ubGluZSwgMCk7IH1cbiAgICB9XG4gICAgdXBkYXRlSW5wdXQgPSBjbS5jdXJPcC51cGRhdGVJbnB1dDtcbiAgICB2YXIgY2hhbmdlRXZlbnQgPSB7ZnJvbTogZnJvbSwgdG86IHRvLCB0ZXh0OiBtdWx0aVBhc3RlID8gbXVsdGlQYXN0ZVtpJDEgJSBtdWx0aVBhc3RlLmxlbmd0aF0gOiB0ZXh0TGluZXMsXG4gICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbjogb3JpZ2luIHx8IChwYXN0ZSA/IFwicGFzdGVcIiA6IGNtLnN0YXRlLmN1dEluY29taW5nID8gXCJjdXRcIiA6IFwiK2lucHV0XCIpfTtcbiAgICBtYWtlQ2hhbmdlKGNtLmRvYywgY2hhbmdlRXZlbnQpO1xuICAgIHNpZ25hbExhdGVyKGNtLCBcImlucHV0UmVhZFwiLCBjbSwgY2hhbmdlRXZlbnQpO1xuICB9XG4gIGlmIChpbnNlcnRlZCAmJiAhcGFzdGUpXG4gICAgeyB0cmlnZ2VyRWxlY3RyaWMoY20sIGluc2VydGVkKTsgfVxuXG4gIGVuc3VyZUN1cnNvclZpc2libGUoY20pO1xuICBjbS5jdXJPcC51cGRhdGVJbnB1dCA9IHVwZGF0ZUlucHV0O1xuICBjbS5jdXJPcC50eXBpbmcgPSB0cnVlO1xuICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gY20uc3RhdGUuY3V0SW5jb21pbmcgPSBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlUGFzdGUoZSwgY20pIHtcbiAgdmFyIHBhc3RlZCA9IGUuY2xpcGJvYXJkRGF0YSAmJiBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YShcIlRleHRcIik7XG4gIGlmIChwYXN0ZWQpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCFjbS5pc1JlYWRPbmx5KCkgJiYgIWNtLm9wdGlvbnMuZGlzYWJsZUlucHV0KVxuICAgICAgeyBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7IHJldHVybiBhcHBseVRleHRJbnB1dChjbSwgcGFzdGVkLCAwLCBudWxsLCBcInBhc3RlXCIpOyB9KTsgfVxuICAgIHJldHVybiB0cnVlXG4gIH1cbn1cblxuZnVuY3Rpb24gdHJpZ2dlckVsZWN0cmljKGNtLCBpbnNlcnRlZCkge1xuICAvLyBXaGVuIGFuICdlbGVjdHJpYycgY2hhcmFjdGVyIGlzIGluc2VydGVkLCBpbW1lZGlhdGVseSB0cmlnZ2VyIGEgcmVpbmRlbnRcbiAgaWYgKCFjbS5vcHRpb25zLmVsZWN0cmljQ2hhcnMgfHwgIWNtLm9wdGlvbnMuc21hcnRJbmRlbnQpIHsgcmV0dXJuIH1cbiAgdmFyIHNlbCA9IGNtLmRvYy5zZWw7XG5cbiAgZm9yICh2YXIgaSA9IHNlbC5yYW5nZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgcmFuZ2UkJDEgPSBzZWwucmFuZ2VzW2ldO1xuICAgIGlmIChyYW5nZSQkMS5oZWFkLmNoID4gMTAwIHx8IChpICYmIHNlbC5yYW5nZXNbaSAtIDFdLmhlYWQubGluZSA9PSByYW5nZSQkMS5oZWFkLmxpbmUpKSB7IGNvbnRpbnVlIH1cbiAgICB2YXIgbW9kZSA9IGNtLmdldE1vZGVBdChyYW5nZSQkMS5oZWFkKTtcbiAgICB2YXIgaW5kZW50ZWQgPSBmYWxzZTtcbiAgICBpZiAobW9kZS5lbGVjdHJpY0NoYXJzKSB7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1vZGUuZWxlY3RyaWNDaGFycy5sZW5ndGg7IGorKylcbiAgICAgICAgeyBpZiAoaW5zZXJ0ZWQuaW5kZXhPZihtb2RlLmVsZWN0cmljQ2hhcnMuY2hhckF0KGopKSA+IC0xKSB7XG4gICAgICAgICAgaW5kZW50ZWQgPSBpbmRlbnRMaW5lKGNtLCByYW5nZSQkMS5oZWFkLmxpbmUsIFwic21hcnRcIik7XG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfSB9XG4gICAgfSBlbHNlIGlmIChtb2RlLmVsZWN0cmljSW5wdXQpIHtcbiAgICAgIGlmIChtb2RlLmVsZWN0cmljSW5wdXQudGVzdChnZXRMaW5lKGNtLmRvYywgcmFuZ2UkJDEuaGVhZC5saW5lKS50ZXh0LnNsaWNlKDAsIHJhbmdlJCQxLmhlYWQuY2gpKSlcbiAgICAgICAgeyBpbmRlbnRlZCA9IGluZGVudExpbmUoY20sIHJhbmdlJCQxLmhlYWQubGluZSwgXCJzbWFydFwiKTsgfVxuICAgIH1cbiAgICBpZiAoaW5kZW50ZWQpIHsgc2lnbmFsTGF0ZXIoY20sIFwiZWxlY3RyaWNJbnB1dFwiLCBjbSwgcmFuZ2UkJDEuaGVhZC5saW5lKTsgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvcHlhYmxlUmFuZ2VzKGNtKSB7XG4gIHZhciB0ZXh0ID0gW10sIHJhbmdlcyA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGxpbmUgPSBjbS5kb2Muc2VsLnJhbmdlc1tpXS5oZWFkLmxpbmU7XG4gICAgdmFyIGxpbmVSYW5nZSA9IHthbmNob3I6IFBvcyhsaW5lLCAwKSwgaGVhZDogUG9zKGxpbmUgKyAxLCAwKX07XG4gICAgcmFuZ2VzLnB1c2gobGluZVJhbmdlKTtcbiAgICB0ZXh0LnB1c2goY20uZ2V0UmFuZ2UobGluZVJhbmdlLmFuY2hvciwgbGluZVJhbmdlLmhlYWQpKTtcbiAgfVxuICByZXR1cm4ge3RleHQ6IHRleHQsIHJhbmdlczogcmFuZ2VzfVxufVxuXG5mdW5jdGlvbiBkaXNhYmxlQnJvd3Nlck1hZ2ljKGZpZWxkLCBzcGVsbGNoZWNrKSB7XG4gIGZpZWxkLnNldEF0dHJpYnV0ZShcImF1dG9jb3JyZWN0XCIsIFwib2ZmXCIpO1xuICBmaWVsZC5zZXRBdHRyaWJ1dGUoXCJhdXRvY2FwaXRhbGl6ZVwiLCBcIm9mZlwiKTtcbiAgZmllbGQuc2V0QXR0cmlidXRlKFwic3BlbGxjaGVja1wiLCAhIXNwZWxsY2hlY2spO1xufVxuXG5mdW5jdGlvbiBoaWRkZW5UZXh0YXJlYSgpIHtcbiAgdmFyIHRlID0gZWx0KFwidGV4dGFyZWFcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogYWJzb2x1dGU7IGJvdHRvbTogLTFlbTsgcGFkZGluZzogMDsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxZW07IG91dGxpbmU6IG5vbmVcIik7XG4gIHZhciBkaXYgPSBlbHQoXCJkaXZcIiwgW3RlXSwgbnVsbCwgXCJvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7IHdpZHRoOiAzcHg7IGhlaWdodDogMHB4O1wiKTtcbiAgLy8gVGhlIHRleHRhcmVhIGlzIGtlcHQgcG9zaXRpb25lZCBuZWFyIHRoZSBjdXJzb3IgdG8gcHJldmVudCB0aGVcbiAgLy8gZmFjdCB0aGF0IGl0J2xsIGJlIHNjcm9sbGVkIGludG8gdmlldyBvbiBpbnB1dCBmcm9tIHNjcm9sbGluZ1xuICAvLyBvdXIgZmFrZSBjdXJzb3Igb3V0IG9mIHZpZXcuIE9uIHdlYmtpdCwgd2hlbiB3cmFwPW9mZiwgcGFzdGUgaXNcbiAgLy8gdmVyeSBzbG93LiBTbyBtYWtlIHRoZSBhcmVhIHdpZGUgaW5zdGVhZC5cbiAgaWYgKHdlYmtpdCkgeyB0ZS5zdHlsZS53aWR0aCA9IFwiMTAwMHB4XCI7IH1cbiAgZWxzZSB7IHRlLnNldEF0dHJpYnV0ZShcIndyYXBcIiwgXCJvZmZcIik7IH1cbiAgLy8gSWYgYm9yZGVyOiAwOyAtLSBpT1MgZmFpbHMgdG8gb3BlbiBrZXlib2FyZCAoaXNzdWUgIzEyODcpXG4gIGlmIChpb3MpIHsgdGUuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgYmxhY2tcIjsgfVxuICBkaXNhYmxlQnJvd3Nlck1hZ2ljKHRlKTtcbiAgcmV0dXJuIGRpdlxufVxuXG4vLyBUaGUgcHVibGljbHkgdmlzaWJsZSBBUEkuIE5vdGUgdGhhdCBtZXRob2RPcChmKSBtZWFuc1xuLy8gJ3dyYXAgZiBpbiBhbiBvcGVyYXRpb24sIHBlcmZvcm1lZCBvbiBpdHMgYHRoaXNgIHBhcmFtZXRlcicuXG5cbi8vIFRoaXMgaXMgbm90IHRoZSBjb21wbGV0ZSBzZXQgb2YgZWRpdG9yIG1ldGhvZHMuIE1vc3Qgb2YgdGhlXG4vLyBtZXRob2RzIGRlZmluZWQgb24gdGhlIERvYyB0eXBlIGFyZSBhbHNvIGluamVjdGVkIGludG9cbi8vIENvZGVNaXJyb3IucHJvdG90eXBlLCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgYW5kXG4vLyBjb252ZW5pZW5jZS5cblxudmFyIGFkZEVkaXRvck1ldGhvZHMgPSBmdW5jdGlvbihDb2RlTWlycm9yKSB7XG4gIHZhciBvcHRpb25IYW5kbGVycyA9IENvZGVNaXJyb3Iub3B0aW9uSGFuZGxlcnM7XG5cbiAgdmFyIGhlbHBlcnMgPSBDb2RlTWlycm9yLmhlbHBlcnMgPSB7fTtcblxuICBDb2RlTWlycm9yLnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogQ29kZU1pcnJvcixcbiAgICBmb2N1czogZnVuY3Rpb24oKXt3aW5kb3cuZm9jdXMoKTsgdGhpcy5kaXNwbGF5LmlucHV0LmZvY3VzKCk7fSxcblxuICAgIHNldE9wdGlvbjogZnVuY3Rpb24ob3B0aW9uLCB2YWx1ZSkge1xuICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsIG9sZCA9IG9wdGlvbnNbb3B0aW9uXTtcbiAgICAgIGlmIChvcHRpb25zW29wdGlvbl0gPT0gdmFsdWUgJiYgb3B0aW9uICE9IFwibW9kZVwiKSB7IHJldHVybiB9XG4gICAgICBvcHRpb25zW29wdGlvbl0gPSB2YWx1ZTtcbiAgICAgIGlmIChvcHRpb25IYW5kbGVycy5oYXNPd25Qcm9wZXJ0eShvcHRpb24pKVxuICAgICAgICB7IG9wZXJhdGlvbih0aGlzLCBvcHRpb25IYW5kbGVyc1tvcHRpb25dKSh0aGlzLCB2YWx1ZSwgb2xkKTsgfVxuICAgICAgc2lnbmFsKHRoaXMsIFwib3B0aW9uQ2hhbmdlXCIsIHRoaXMsIG9wdGlvbik7XG4gICAgfSxcblxuICAgIGdldE9wdGlvbjogZnVuY3Rpb24ob3B0aW9uKSB7cmV0dXJuIHRoaXMub3B0aW9uc1tvcHRpb25dfSxcbiAgICBnZXREb2M6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmRvY30sXG5cbiAgICBhZGRLZXlNYXA6IGZ1bmN0aW9uKG1hcCQkMSwgYm90dG9tKSB7XG4gICAgICB0aGlzLnN0YXRlLmtleU1hcHNbYm90dG9tID8gXCJwdXNoXCIgOiBcInVuc2hpZnRcIl0oZ2V0S2V5TWFwKG1hcCQkMSkpO1xuICAgIH0sXG4gICAgcmVtb3ZlS2V5TWFwOiBmdW5jdGlvbihtYXAkJDEpIHtcbiAgICAgIHZhciBtYXBzID0gdGhpcy5zdGF0ZS5rZXlNYXBzO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXBzLmxlbmd0aDsgKytpKVxuICAgICAgICB7IGlmIChtYXBzW2ldID09IG1hcCQkMSB8fCBtYXBzW2ldLm5hbWUgPT0gbWFwJCQxKSB7XG4gICAgICAgICAgbWFwcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfSB9XG4gICAgfSxcblxuICAgIGFkZE92ZXJsYXk6IG1ldGhvZE9wKGZ1bmN0aW9uKHNwZWMsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBtb2RlID0gc3BlYy50b2tlbiA/IHNwZWMgOiBDb2RlTWlycm9yLmdldE1vZGUodGhpcy5vcHRpb25zLCBzcGVjKTtcbiAgICAgIGlmIChtb2RlLnN0YXJ0U3RhdGUpIHsgdGhyb3cgbmV3IEVycm9yKFwiT3ZlcmxheXMgbWF5IG5vdCBiZSBzdGF0ZWZ1bC5cIikgfVxuICAgICAgaW5zZXJ0U29ydGVkKHRoaXMuc3RhdGUub3ZlcmxheXMsXG4gICAgICAgICAgICAgICAgICAge21vZGU6IG1vZGUsIG1vZGVTcGVjOiBzcGVjLCBvcGFxdWU6IG9wdGlvbnMgJiYgb3B0aW9ucy5vcGFxdWUsXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiAob3B0aW9ucyAmJiBvcHRpb25zLnByaW9yaXR5KSB8fCAwfSxcbiAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAob3ZlcmxheSkgeyByZXR1cm4gb3ZlcmxheS5wcmlvcml0eTsgfSk7XG4gICAgICB0aGlzLnN0YXRlLm1vZGVHZW4rKztcbiAgICAgIHJlZ0NoYW5nZSh0aGlzKTtcbiAgICB9KSxcbiAgICByZW1vdmVPdmVybGF5OiBtZXRob2RPcChmdW5jdGlvbihzcGVjKSB7XG4gICAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICAgICAgdmFyIG92ZXJsYXlzID0gdGhpcy5zdGF0ZS5vdmVybGF5cztcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3ZlcmxheXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGN1ciA9IG92ZXJsYXlzW2ldLm1vZGVTcGVjO1xuICAgICAgICBpZiAoY3VyID09IHNwZWMgfHwgdHlwZW9mIHNwZWMgPT0gXCJzdHJpbmdcIiAmJiBjdXIubmFtZSA9PSBzcGVjKSB7XG4gICAgICAgICAgb3ZlcmxheXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIHRoaXMkMS5zdGF0ZS5tb2RlR2VuKys7XG4gICAgICAgICAgcmVnQ2hhbmdlKHRoaXMkMSk7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSxcblxuICAgIGluZGVudExpbmU6IG1ldGhvZE9wKGZ1bmN0aW9uKG4sIGRpciwgYWdncmVzc2l2ZSkge1xuICAgICAgaWYgKHR5cGVvZiBkaXIgIT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgZGlyICE9IFwibnVtYmVyXCIpIHtcbiAgICAgICAgaWYgKGRpciA9PSBudWxsKSB7IGRpciA9IHRoaXMub3B0aW9ucy5zbWFydEluZGVudCA/IFwic21hcnRcIiA6IFwicHJldlwiOyB9XG4gICAgICAgIGVsc2UgeyBkaXIgPSBkaXIgPyBcImFkZFwiIDogXCJzdWJ0cmFjdFwiOyB9XG4gICAgICB9XG4gICAgICBpZiAoaXNMaW5lKHRoaXMuZG9jLCBuKSkgeyBpbmRlbnRMaW5lKHRoaXMsIG4sIGRpciwgYWdncmVzc2l2ZSk7IH1cbiAgICB9KSxcbiAgICBpbmRlbnRTZWxlY3Rpb246IG1ldGhvZE9wKGZ1bmN0aW9uKGhvdykge1xuICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICAgIHZhciByYW5nZXMgPSB0aGlzLmRvYy5zZWwucmFuZ2VzLCBlbmQgPSAtMTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByYW5nZSQkMSA9IHJhbmdlc1tpXTtcbiAgICAgICAgaWYgKCFyYW5nZSQkMS5lbXB0eSgpKSB7XG4gICAgICAgICAgdmFyIGZyb20gPSByYW5nZSQkMS5mcm9tKCksIHRvID0gcmFuZ2UkJDEudG8oKTtcbiAgICAgICAgICB2YXIgc3RhcnQgPSBNYXRoLm1heChlbmQsIGZyb20ubGluZSk7XG4gICAgICAgICAgZW5kID0gTWF0aC5taW4odGhpcyQxLmxhc3RMaW5lKCksIHRvLmxpbmUgLSAodG8uY2ggPyAwIDogMSkpICsgMTtcbiAgICAgICAgICBmb3IgKHZhciBqID0gc3RhcnQ7IGogPCBlbmQ7ICsrailcbiAgICAgICAgICAgIHsgaW5kZW50TGluZSh0aGlzJDEsIGosIGhvdyk7IH1cbiAgICAgICAgICB2YXIgbmV3UmFuZ2VzID0gdGhpcyQxLmRvYy5zZWwucmFuZ2VzO1xuICAgICAgICAgIGlmIChmcm9tLmNoID09IDAgJiYgcmFuZ2VzLmxlbmd0aCA9PSBuZXdSYW5nZXMubGVuZ3RoICYmIG5ld1Jhbmdlc1tpXS5mcm9tKCkuY2ggPiAwKVxuICAgICAgICAgICAgeyByZXBsYWNlT25lU2VsZWN0aW9uKHRoaXMkMS5kb2MsIGksIG5ldyBSYW5nZShmcm9tLCBuZXdSYW5nZXNbaV0udG8oKSksIHNlbF9kb250U2Nyb2xsKTsgfVxuICAgICAgICB9IGVsc2UgaWYgKHJhbmdlJCQxLmhlYWQubGluZSA+IGVuZCkge1xuICAgICAgICAgIGluZGVudExpbmUodGhpcyQxLCByYW5nZSQkMS5oZWFkLmxpbmUsIGhvdywgdHJ1ZSk7XG4gICAgICAgICAgZW5kID0gcmFuZ2UkJDEuaGVhZC5saW5lO1xuICAgICAgICAgIGlmIChpID09IHRoaXMkMS5kb2Muc2VsLnByaW1JbmRleCkgeyBlbnN1cmVDdXJzb3JWaXNpYmxlKHRoaXMkMSk7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pLFxuXG4gICAgLy8gRmV0Y2ggdGhlIHBhcnNlciB0b2tlbiBmb3IgYSBnaXZlbiBjaGFyYWN0ZXIuIFVzZWZ1bCBmb3IgaGFja3NcbiAgICAvLyB0aGF0IHdhbnQgdG8gaW5zcGVjdCB0aGUgbW9kZSBzdGF0ZSAoc2F5LCBmb3IgY29tcGxldGlvbikuXG4gICAgZ2V0VG9rZW5BdDogZnVuY3Rpb24ocG9zLCBwcmVjaXNlKSB7XG4gICAgICByZXR1cm4gdGFrZVRva2VuKHRoaXMsIHBvcywgcHJlY2lzZSlcbiAgICB9LFxuXG4gICAgZ2V0TGluZVRva2VuczogZnVuY3Rpb24obGluZSwgcHJlY2lzZSkge1xuICAgICAgcmV0dXJuIHRha2VUb2tlbih0aGlzLCBQb3MobGluZSksIHByZWNpc2UsIHRydWUpXG4gICAgfSxcblxuICAgIGdldFRva2VuVHlwZUF0OiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIHBvcyA9IGNsaXBQb3ModGhpcy5kb2MsIHBvcyk7XG4gICAgICB2YXIgc3R5bGVzID0gZ2V0TGluZVN0eWxlcyh0aGlzLCBnZXRMaW5lKHRoaXMuZG9jLCBwb3MubGluZSkpO1xuICAgICAgdmFyIGJlZm9yZSA9IDAsIGFmdGVyID0gKHN0eWxlcy5sZW5ndGggLSAxKSAvIDIsIGNoID0gcG9zLmNoO1xuICAgICAgdmFyIHR5cGU7XG4gICAgICBpZiAoY2ggPT0gMCkgeyB0eXBlID0gc3R5bGVzWzJdOyB9XG4gICAgICBlbHNlIHsgZm9yICg7Oykge1xuICAgICAgICB2YXIgbWlkID0gKGJlZm9yZSArIGFmdGVyKSA+PiAxO1xuICAgICAgICBpZiAoKG1pZCA/IHN0eWxlc1ttaWQgKiAyIC0gMV0gOiAwKSA+PSBjaCkgeyBhZnRlciA9IG1pZDsgfVxuICAgICAgICBlbHNlIGlmIChzdHlsZXNbbWlkICogMiArIDFdIDwgY2gpIHsgYmVmb3JlID0gbWlkICsgMTsgfVxuICAgICAgICBlbHNlIHsgdHlwZSA9IHN0eWxlc1ttaWQgKiAyICsgMl07IGJyZWFrIH1cbiAgICAgIH0gfVxuICAgICAgdmFyIGN1dCA9IHR5cGUgPyB0eXBlLmluZGV4T2YoXCJvdmVybGF5IFwiKSA6IC0xO1xuICAgICAgcmV0dXJuIGN1dCA8IDAgPyB0eXBlIDogY3V0ID09IDAgPyBudWxsIDogdHlwZS5zbGljZSgwLCBjdXQgLSAxKVxuICAgIH0sXG5cbiAgICBnZXRNb2RlQXQ6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgdmFyIG1vZGUgPSB0aGlzLmRvYy5tb2RlO1xuICAgICAgaWYgKCFtb2RlLmlubmVyTW9kZSkgeyByZXR1cm4gbW9kZSB9XG4gICAgICByZXR1cm4gQ29kZU1pcnJvci5pbm5lck1vZGUobW9kZSwgdGhpcy5nZXRUb2tlbkF0KHBvcykuc3RhdGUpLm1vZGVcbiAgICB9LFxuXG4gICAgZ2V0SGVscGVyOiBmdW5jdGlvbihwb3MsIHR5cGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEhlbHBlcnMocG9zLCB0eXBlKVswXVxuICAgIH0sXG5cbiAgICBnZXRIZWxwZXJzOiBmdW5jdGlvbihwb3MsIHR5cGUpIHtcbiAgICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gICAgICB2YXIgZm91bmQgPSBbXTtcbiAgICAgIGlmICghaGVscGVycy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkgeyByZXR1cm4gZm91bmQgfVxuICAgICAgdmFyIGhlbHAgPSBoZWxwZXJzW3R5cGVdLCBtb2RlID0gdGhpcy5nZXRNb2RlQXQocG9zKTtcbiAgICAgIGlmICh0eXBlb2YgbW9kZVt0eXBlXSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGlmIChoZWxwW21vZGVbdHlwZV1dKSB7IGZvdW5kLnB1c2goaGVscFttb2RlW3R5cGVdXSk7IH1cbiAgICAgIH0gZWxzZSBpZiAobW9kZVt0eXBlXSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1vZGVbdHlwZV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2YXIgdmFsID0gaGVscFttb2RlW3R5cGVdW2ldXTtcbiAgICAgICAgICBpZiAodmFsKSB7IGZvdW5kLnB1c2godmFsKTsgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG1vZGUuaGVscGVyVHlwZSAmJiBoZWxwW21vZGUuaGVscGVyVHlwZV0pIHtcbiAgICAgICAgZm91bmQucHVzaChoZWxwW21vZGUuaGVscGVyVHlwZV0pO1xuICAgICAgfSBlbHNlIGlmIChoZWxwW21vZGUubmFtZV0pIHtcbiAgICAgICAgZm91bmQucHVzaChoZWxwW21vZGUubmFtZV0pO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgaGVscC5fZ2xvYmFsLmxlbmd0aDsgaSQxKyspIHtcbiAgICAgICAgdmFyIGN1ciA9IGhlbHAuX2dsb2JhbFtpJDFdO1xuICAgICAgICBpZiAoY3VyLnByZWQobW9kZSwgdGhpcyQxKSAmJiBpbmRleE9mKGZvdW5kLCBjdXIudmFsKSA9PSAtMSlcbiAgICAgICAgICB7IGZvdW5kLnB1c2goY3VyLnZhbCk7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmb3VuZFxuICAgIH0sXG5cbiAgICBnZXRTdGF0ZUFmdGVyOiBmdW5jdGlvbihsaW5lLCBwcmVjaXNlKSB7XG4gICAgICB2YXIgZG9jID0gdGhpcy5kb2M7XG4gICAgICBsaW5lID0gY2xpcExpbmUoZG9jLCBsaW5lID09IG51bGwgPyBkb2MuZmlyc3QgKyBkb2Muc2l6ZSAtIDE6IGxpbmUpO1xuICAgICAgcmV0dXJuIGdldFN0YXRlQmVmb3JlKHRoaXMsIGxpbmUgKyAxLCBwcmVjaXNlKVxuICAgIH0sXG5cbiAgICBjdXJzb3JDb29yZHM6IGZ1bmN0aW9uKHN0YXJ0LCBtb2RlKSB7XG4gICAgICB2YXIgcG9zLCByYW5nZSQkMSA9IHRoaXMuZG9jLnNlbC5wcmltYXJ5KCk7XG4gICAgICBpZiAoc3RhcnQgPT0gbnVsbCkgeyBwb3MgPSByYW5nZSQkMS5oZWFkOyB9XG4gICAgICBlbHNlIGlmICh0eXBlb2Ygc3RhcnQgPT0gXCJvYmplY3RcIikgeyBwb3MgPSBjbGlwUG9zKHRoaXMuZG9jLCBzdGFydCk7IH1cbiAgICAgIGVsc2UgeyBwb3MgPSBzdGFydCA/IHJhbmdlJCQxLmZyb20oKSA6IHJhbmdlJCQxLnRvKCk7IH1cbiAgICAgIHJldHVybiBjdXJzb3JDb29yZHModGhpcywgcG9zLCBtb2RlIHx8IFwicGFnZVwiKVxuICAgIH0sXG5cbiAgICBjaGFyQ29vcmRzOiBmdW5jdGlvbihwb3MsIG1vZGUpIHtcbiAgICAgIHJldHVybiBjaGFyQ29vcmRzKHRoaXMsIGNsaXBQb3ModGhpcy5kb2MsIHBvcyksIG1vZGUgfHwgXCJwYWdlXCIpXG4gICAgfSxcblxuICAgIGNvb3Jkc0NoYXI6IGZ1bmN0aW9uKGNvb3JkcywgbW9kZSkge1xuICAgICAgY29vcmRzID0gZnJvbUNvb3JkU3lzdGVtKHRoaXMsIGNvb3JkcywgbW9kZSB8fCBcInBhZ2VcIik7XG4gICAgICByZXR1cm4gY29vcmRzQ2hhcih0aGlzLCBjb29yZHMubGVmdCwgY29vcmRzLnRvcClcbiAgICB9LFxuXG4gICAgbGluZUF0SGVpZ2h0OiBmdW5jdGlvbihoZWlnaHQsIG1vZGUpIHtcbiAgICAgIGhlaWdodCA9IGZyb21Db29yZFN5c3RlbSh0aGlzLCB7dG9wOiBoZWlnaHQsIGxlZnQ6IDB9LCBtb2RlIHx8IFwicGFnZVwiKS50b3A7XG4gICAgICByZXR1cm4gbGluZUF0SGVpZ2h0KHRoaXMuZG9jLCBoZWlnaHQgKyB0aGlzLmRpc3BsYXkudmlld09mZnNldClcbiAgICB9LFxuICAgIGhlaWdodEF0TGluZTogZnVuY3Rpb24obGluZSwgbW9kZSwgaW5jbHVkZVdpZGdldHMpIHtcbiAgICAgIHZhciBlbmQgPSBmYWxzZSwgbGluZU9iajtcbiAgICAgIGlmICh0eXBlb2YgbGluZSA9PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHZhciBsYXN0ID0gdGhpcy5kb2MuZmlyc3QgKyB0aGlzLmRvYy5zaXplIC0gMTtcbiAgICAgICAgaWYgKGxpbmUgPCB0aGlzLmRvYy5maXJzdCkgeyBsaW5lID0gdGhpcy5kb2MuZmlyc3Q7IH1cbiAgICAgICAgZWxzZSBpZiAobGluZSA+IGxhc3QpIHsgbGluZSA9IGxhc3Q7IGVuZCA9IHRydWU7IH1cbiAgICAgICAgbGluZU9iaiA9IGdldExpbmUodGhpcy5kb2MsIGxpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGluZU9iaiA9IGxpbmU7XG4gICAgICB9XG4gICAgICByZXR1cm4gaW50b0Nvb3JkU3lzdGVtKHRoaXMsIGxpbmVPYmosIHt0b3A6IDAsIGxlZnQ6IDB9LCBtb2RlIHx8IFwicGFnZVwiLCBpbmNsdWRlV2lkZ2V0cyB8fCBlbmQpLnRvcCArXG4gICAgICAgIChlbmQgPyB0aGlzLmRvYy5oZWlnaHQgLSBoZWlnaHRBdExpbmUobGluZU9iaikgOiAwKVxuICAgIH0sXG5cbiAgICBkZWZhdWx0VGV4dEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiB0ZXh0SGVpZ2h0KHRoaXMuZGlzcGxheSkgfSxcbiAgICBkZWZhdWx0Q2hhcldpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNoYXJXaWR0aCh0aGlzLmRpc3BsYXkpIH0sXG5cbiAgICBnZXRWaWV3cG9ydDogZnVuY3Rpb24oKSB7IHJldHVybiB7ZnJvbTogdGhpcy5kaXNwbGF5LnZpZXdGcm9tLCB0bzogdGhpcy5kaXNwbGF5LnZpZXdUb319LFxuXG4gICAgYWRkV2lkZ2V0OiBmdW5jdGlvbihwb3MsIG5vZGUsIHNjcm9sbCwgdmVydCwgaG9yaXopIHtcbiAgICAgIHZhciBkaXNwbGF5ID0gdGhpcy5kaXNwbGF5O1xuICAgICAgcG9zID0gY3Vyc29yQ29vcmRzKHRoaXMsIGNsaXBQb3ModGhpcy5kb2MsIHBvcykpO1xuICAgICAgdmFyIHRvcCA9IHBvcy5ib3R0b20sIGxlZnQgPSBwb3MubGVmdDtcbiAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICBub2RlLnNldEF0dHJpYnV0ZShcImNtLWlnbm9yZS1ldmVudHNcIiwgXCJ0cnVlXCIpO1xuICAgICAgdGhpcy5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUobm9kZSk7XG4gICAgICBkaXNwbGF5LnNpemVyLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgaWYgKHZlcnQgPT0gXCJvdmVyXCIpIHtcbiAgICAgICAgdG9wID0gcG9zLnRvcDtcbiAgICAgIH0gZWxzZSBpZiAodmVydCA9PSBcImFib3ZlXCIgfHwgdmVydCA9PSBcIm5lYXJcIikge1xuICAgICAgICB2YXIgdnNwYWNlID0gTWF0aC5tYXgoZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCwgdGhpcy5kb2MuaGVpZ2h0KSxcbiAgICAgICAgaHNwYWNlID0gTWF0aC5tYXgoZGlzcGxheS5zaXplci5jbGllbnRXaWR0aCwgZGlzcGxheS5saW5lU3BhY2UuY2xpZW50V2lkdGgpO1xuICAgICAgICAvLyBEZWZhdWx0IHRvIHBvc2l0aW9uaW5nIGFib3ZlIChpZiBzcGVjaWZpZWQgYW5kIHBvc3NpYmxlKTsgb3RoZXJ3aXNlIGRlZmF1bHQgdG8gcG9zaXRpb25pbmcgYmVsb3dcbiAgICAgICAgaWYgKCh2ZXJ0ID09ICdhYm92ZScgfHwgcG9zLmJvdHRvbSArIG5vZGUub2Zmc2V0SGVpZ2h0ID4gdnNwYWNlKSAmJiBwb3MudG9wID4gbm9kZS5vZmZzZXRIZWlnaHQpXG4gICAgICAgICAgeyB0b3AgPSBwb3MudG9wIC0gbm9kZS5vZmZzZXRIZWlnaHQ7IH1cbiAgICAgICAgZWxzZSBpZiAocG9zLmJvdHRvbSArIG5vZGUub2Zmc2V0SGVpZ2h0IDw9IHZzcGFjZSlcbiAgICAgICAgICB7IHRvcCA9IHBvcy5ib3R0b207IH1cbiAgICAgICAgaWYgKGxlZnQgKyBub2RlLm9mZnNldFdpZHRoID4gaHNwYWNlKVxuICAgICAgICAgIHsgbGVmdCA9IGhzcGFjZSAtIG5vZGUub2Zmc2V0V2lkdGg7IH1cbiAgICAgIH1cbiAgICAgIG5vZGUuc3R5bGUudG9wID0gdG9wICsgXCJweFwiO1xuICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gbm9kZS5zdHlsZS5yaWdodCA9IFwiXCI7XG4gICAgICBpZiAoaG9yaXogPT0gXCJyaWdodFwiKSB7XG4gICAgICAgIGxlZnQgPSBkaXNwbGF5LnNpemVyLmNsaWVudFdpZHRoIC0gbm9kZS5vZmZzZXRXaWR0aDtcbiAgICAgICAgbm9kZS5zdHlsZS5yaWdodCA9IFwiMHB4XCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaG9yaXogPT0gXCJsZWZ0XCIpIHsgbGVmdCA9IDA7IH1cbiAgICAgICAgZWxzZSBpZiAoaG9yaXogPT0gXCJtaWRkbGVcIikgeyBsZWZ0ID0gKGRpc3BsYXkuc2l6ZXIuY2xpZW50V2lkdGggLSBub2RlLm9mZnNldFdpZHRoKSAvIDI7IH1cbiAgICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gbGVmdCArIFwicHhcIjtcbiAgICAgIH1cbiAgICAgIGlmIChzY3JvbGwpXG4gICAgICAgIHsgc2Nyb2xsSW50b1ZpZXcodGhpcywge2xlZnQ6IGxlZnQsIHRvcDogdG9wLCByaWdodDogbGVmdCArIG5vZGUub2Zmc2V0V2lkdGgsIGJvdHRvbTogdG9wICsgbm9kZS5vZmZzZXRIZWlnaHR9KTsgfVxuICAgIH0sXG5cbiAgICB0cmlnZ2VyT25LZXlEb3duOiBtZXRob2RPcChvbktleURvd24pLFxuICAgIHRyaWdnZXJPbktleVByZXNzOiBtZXRob2RPcChvbktleVByZXNzKSxcbiAgICB0cmlnZ2VyT25LZXlVcDogb25LZXlVcCxcblxuICAgIGV4ZWNDb21tYW5kOiBmdW5jdGlvbihjbWQpIHtcbiAgICAgIGlmIChjb21tYW5kcy5oYXNPd25Qcm9wZXJ0eShjbWQpKVxuICAgICAgICB7IHJldHVybiBjb21tYW5kc1tjbWRdLmNhbGwobnVsbCwgdGhpcykgfVxuICAgIH0sXG5cbiAgICB0cmlnZ2VyRWxlY3RyaWM6IG1ldGhvZE9wKGZ1bmN0aW9uKHRleHQpIHsgdHJpZ2dlckVsZWN0cmljKHRoaXMsIHRleHQpOyB9KSxcblxuICAgIGZpbmRQb3NIOiBmdW5jdGlvbihmcm9tLCBhbW91bnQsIHVuaXQsIHZpc3VhbGx5KSB7XG4gICAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICAgICAgdmFyIGRpciA9IDE7XG4gICAgICBpZiAoYW1vdW50IDwgMCkgeyBkaXIgPSAtMTsgYW1vdW50ID0gLWFtb3VudDsgfVxuICAgICAgdmFyIGN1ciA9IGNsaXBQb3ModGhpcy5kb2MsIGZyb20pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbW91bnQ7ICsraSkge1xuICAgICAgICBjdXIgPSBmaW5kUG9zSCh0aGlzJDEuZG9jLCBjdXIsIGRpciwgdW5pdCwgdmlzdWFsbHkpO1xuICAgICAgICBpZiAoY3VyLmhpdFNpZGUpIHsgYnJlYWsgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGN1clxuICAgIH0sXG5cbiAgICBtb3ZlSDogbWV0aG9kT3AoZnVuY3Rpb24oZGlyLCB1bml0KSB7XG4gICAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICAgICAgdGhpcy5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24gKHJhbmdlJCQxKSB7XG4gICAgICAgIGlmICh0aGlzJDEuZGlzcGxheS5zaGlmdCB8fCB0aGlzJDEuZG9jLmV4dGVuZCB8fCByYW5nZSQkMS5lbXB0eSgpKVxuICAgICAgICAgIHsgcmV0dXJuIGZpbmRQb3NIKHRoaXMkMS5kb2MsIHJhbmdlJCQxLmhlYWQsIGRpciwgdW5pdCwgdGhpcyQxLm9wdGlvbnMucnRsTW92ZVZpc3VhbGx5KSB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICB7IHJldHVybiBkaXIgPCAwID8gcmFuZ2UkJDEuZnJvbSgpIDogcmFuZ2UkJDEudG8oKSB9XG4gICAgICB9LCBzZWxfbW92ZSk7XG4gICAgfSksXG5cbiAgICBkZWxldGVIOiBtZXRob2RPcChmdW5jdGlvbihkaXIsIHVuaXQpIHtcbiAgICAgIHZhciBzZWwgPSB0aGlzLmRvYy5zZWwsIGRvYyA9IHRoaXMuZG9jO1xuICAgICAgaWYgKHNlbC5zb21ldGhpbmdTZWxlY3RlZCgpKVxuICAgICAgICB7IGRvYy5yZXBsYWNlU2VsZWN0aW9uKFwiXCIsIG51bGwsIFwiK2RlbGV0ZVwiKTsgfVxuICAgICAgZWxzZVxuICAgICAgICB7IGRlbGV0ZU5lYXJTZWxlY3Rpb24odGhpcywgZnVuY3Rpb24gKHJhbmdlJCQxKSB7XG4gICAgICAgICAgdmFyIG90aGVyID0gZmluZFBvc0goZG9jLCByYW5nZSQkMS5oZWFkLCBkaXIsIHVuaXQsIGZhbHNlKTtcbiAgICAgICAgICByZXR1cm4gZGlyIDwgMCA/IHtmcm9tOiBvdGhlciwgdG86IHJhbmdlJCQxLmhlYWR9IDoge2Zyb206IHJhbmdlJCQxLmhlYWQsIHRvOiBvdGhlcn1cbiAgICAgICAgfSk7IH1cbiAgICB9KSxcblxuICAgIGZpbmRQb3NWOiBmdW5jdGlvbihmcm9tLCBhbW91bnQsIHVuaXQsIGdvYWxDb2x1bW4pIHtcbiAgICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gICAgICB2YXIgZGlyID0gMSwgeCA9IGdvYWxDb2x1bW47XG4gICAgICBpZiAoYW1vdW50IDwgMCkgeyBkaXIgPSAtMTsgYW1vdW50ID0gLWFtb3VudDsgfVxuICAgICAgdmFyIGN1ciA9IGNsaXBQb3ModGhpcy5kb2MsIGZyb20pO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbW91bnQ7ICsraSkge1xuICAgICAgICB2YXIgY29vcmRzID0gY3Vyc29yQ29vcmRzKHRoaXMkMSwgY3VyLCBcImRpdlwiKTtcbiAgICAgICAgaWYgKHggPT0gbnVsbCkgeyB4ID0gY29vcmRzLmxlZnQ7IH1cbiAgICAgICAgZWxzZSB7IGNvb3Jkcy5sZWZ0ID0geDsgfVxuICAgICAgICBjdXIgPSBmaW5kUG9zVih0aGlzJDEsIGNvb3JkcywgZGlyLCB1bml0KTtcbiAgICAgICAgaWYgKGN1ci5oaXRTaWRlKSB7IGJyZWFrIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjdXJcbiAgICB9LFxuXG4gICAgbW92ZVY6IG1ldGhvZE9wKGZ1bmN0aW9uKGRpciwgdW5pdCkge1xuICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgICAgIHZhciBkb2MgPSB0aGlzLmRvYywgZ29hbHMgPSBbXTtcbiAgICAgIHZhciBjb2xsYXBzZSA9ICF0aGlzLmRpc3BsYXkuc2hpZnQgJiYgIWRvYy5leHRlbmQgJiYgZG9jLnNlbC5zb21ldGhpbmdTZWxlY3RlZCgpO1xuICAgICAgZG9jLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UkJDEpIHtcbiAgICAgICAgaWYgKGNvbGxhcHNlKVxuICAgICAgICAgIHsgcmV0dXJuIGRpciA8IDAgPyByYW5nZSQkMS5mcm9tKCkgOiByYW5nZSQkMS50bygpIH1cbiAgICAgICAgdmFyIGhlYWRQb3MgPSBjdXJzb3JDb29yZHModGhpcyQxLCByYW5nZSQkMS5oZWFkLCBcImRpdlwiKTtcbiAgICAgICAgaWYgKHJhbmdlJCQxLmdvYWxDb2x1bW4gIT0gbnVsbCkgeyBoZWFkUG9zLmxlZnQgPSByYW5nZSQkMS5nb2FsQ29sdW1uOyB9XG4gICAgICAgIGdvYWxzLnB1c2goaGVhZFBvcy5sZWZ0KTtcbiAgICAgICAgdmFyIHBvcyA9IGZpbmRQb3NWKHRoaXMkMSwgaGVhZFBvcywgZGlyLCB1bml0KTtcbiAgICAgICAgaWYgKHVuaXQgPT0gXCJwYWdlXCIgJiYgcmFuZ2UkJDEgPT0gZG9jLnNlbC5wcmltYXJ5KCkpXG4gICAgICAgICAgeyBhZGRUb1Njcm9sbFRvcCh0aGlzJDEsIGNoYXJDb29yZHModGhpcyQxLCBwb3MsIFwiZGl2XCIpLnRvcCAtIGhlYWRQb3MudG9wKTsgfVxuICAgICAgICByZXR1cm4gcG9zXG4gICAgICB9LCBzZWxfbW92ZSk7XG4gICAgICBpZiAoZ29hbHMubGVuZ3RoKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIHsgZG9jLnNlbC5yYW5nZXNbaV0uZ29hbENvbHVtbiA9IGdvYWxzW2ldOyB9IH1cbiAgICB9KSxcblxuICAgIC8vIEZpbmQgdGhlIHdvcmQgYXQgdGhlIGdpdmVuIHBvc2l0aW9uIChhcyByZXR1cm5lZCBieSBjb29yZHNDaGFyKS5cbiAgICBmaW5kV29yZEF0OiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIHZhciBkb2MgPSB0aGlzLmRvYywgbGluZSA9IGdldExpbmUoZG9jLCBwb3MubGluZSkudGV4dDtcbiAgICAgIHZhciBzdGFydCA9IHBvcy5jaCwgZW5kID0gcG9zLmNoO1xuICAgICAgaWYgKGxpbmUpIHtcbiAgICAgICAgdmFyIGhlbHBlciA9IHRoaXMuZ2V0SGVscGVyKHBvcywgXCJ3b3JkQ2hhcnNcIik7XG4gICAgICAgIGlmICgocG9zLnN0aWNreSA9PSBcImJlZm9yZVwiIHx8IGVuZCA9PSBsaW5lLmxlbmd0aCkgJiYgc3RhcnQpIHsgLS1zdGFydDsgfSBlbHNlIHsgKytlbmQ7IH1cbiAgICAgICAgdmFyIHN0YXJ0Q2hhciA9IGxpbmUuY2hhckF0KHN0YXJ0KTtcbiAgICAgICAgdmFyIGNoZWNrID0gaXNXb3JkQ2hhcihzdGFydENoYXIsIGhlbHBlcilcbiAgICAgICAgICA/IGZ1bmN0aW9uIChjaCkgeyByZXR1cm4gaXNXb3JkQ2hhcihjaCwgaGVscGVyKTsgfVxuICAgICAgICAgIDogL1xccy8udGVzdChzdGFydENoYXIpID8gZnVuY3Rpb24gKGNoKSB7IHJldHVybiAvXFxzLy50ZXN0KGNoKTsgfVxuICAgICAgICAgIDogZnVuY3Rpb24gKGNoKSB7IHJldHVybiAoIS9cXHMvLnRlc3QoY2gpICYmICFpc1dvcmRDaGFyKGNoKSk7IH07XG4gICAgICAgIHdoaWxlIChzdGFydCA+IDAgJiYgY2hlY2sobGluZS5jaGFyQXQoc3RhcnQgLSAxKSkpIHsgLS1zdGFydDsgfVxuICAgICAgICB3aGlsZSAoZW5kIDwgbGluZS5sZW5ndGggJiYgY2hlY2sobGluZS5jaGFyQXQoZW5kKSkpIHsgKytlbmQ7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgUmFuZ2UoUG9zKHBvcy5saW5lLCBzdGFydCksIFBvcyhwb3MubGluZSwgZW5kKSlcbiAgICB9LFxuXG4gICAgdG9nZ2xlT3ZlcndyaXRlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUgPT0gdGhpcy5zdGF0ZS5vdmVyd3JpdGUpIHsgcmV0dXJuIH1cbiAgICAgIGlmICh0aGlzLnN0YXRlLm92ZXJ3cml0ZSA9ICF0aGlzLnN0YXRlLm92ZXJ3cml0ZSlcbiAgICAgICAgeyBhZGRDbGFzcyh0aGlzLmRpc3BsYXkuY3Vyc29yRGl2LCBcIkNvZGVNaXJyb3Itb3ZlcndyaXRlXCIpOyB9XG4gICAgICBlbHNlXG4gICAgICAgIHsgcm1DbGFzcyh0aGlzLmRpc3BsYXkuY3Vyc29yRGl2LCBcIkNvZGVNaXJyb3Itb3ZlcndyaXRlXCIpOyB9XG5cbiAgICAgIHNpZ25hbCh0aGlzLCBcIm92ZXJ3cml0ZVRvZ2dsZVwiLCB0aGlzLCB0aGlzLnN0YXRlLm92ZXJ3cml0ZSk7XG4gICAgfSxcbiAgICBoYXNGb2N1czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmRpc3BsYXkuaW5wdXQuZ2V0RmllbGQoKSA9PSBhY3RpdmVFbHQoKSB9LFxuICAgIGlzUmVhZE9ubHk6IGZ1bmN0aW9uKCkgeyByZXR1cm4gISEodGhpcy5vcHRpb25zLnJlYWRPbmx5IHx8IHRoaXMuZG9jLmNhbnRFZGl0KSB9LFxuXG4gICAgc2Nyb2xsVG86IG1ldGhvZE9wKGZ1bmN0aW9uICh4LCB5KSB7IHNjcm9sbFRvQ29vcmRzKHRoaXMsIHgsIHkpOyB9KSxcbiAgICBnZXRTY3JvbGxJbmZvOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzY3JvbGxlciA9IHRoaXMuZGlzcGxheS5zY3JvbGxlcjtcbiAgICAgIHJldHVybiB7bGVmdDogc2Nyb2xsZXIuc2Nyb2xsTGVmdCwgdG9wOiBzY3JvbGxlci5zY3JvbGxUb3AsXG4gICAgICAgICAgICAgIGhlaWdodDogc2Nyb2xsZXIuc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsR2FwKHRoaXMpIC0gdGhpcy5kaXNwbGF5LmJhckhlaWdodCxcbiAgICAgICAgICAgICAgd2lkdGg6IHNjcm9sbGVyLnNjcm9sbFdpZHRoIC0gc2Nyb2xsR2FwKHRoaXMpIC0gdGhpcy5kaXNwbGF5LmJhcldpZHRoLFxuICAgICAgICAgICAgICBjbGllbnRIZWlnaHQ6IGRpc3BsYXlIZWlnaHQodGhpcyksIGNsaWVudFdpZHRoOiBkaXNwbGF5V2lkdGgodGhpcyl9XG4gICAgfSxcblxuICAgIHNjcm9sbEludG9WaWV3OiBtZXRob2RPcChmdW5jdGlvbihyYW5nZSQkMSwgbWFyZ2luKSB7XG4gICAgICBpZiAocmFuZ2UkJDEgPT0gbnVsbCkge1xuICAgICAgICByYW5nZSQkMSA9IHtmcm9tOiB0aGlzLmRvYy5zZWwucHJpbWFyeSgpLmhlYWQsIHRvOiBudWxsfTtcbiAgICAgICAgaWYgKG1hcmdpbiA9PSBudWxsKSB7IG1hcmdpbiA9IHRoaXMub3B0aW9ucy5jdXJzb3JTY3JvbGxNYXJnaW47IH1cbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJhbmdlJCQxID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgcmFuZ2UkJDEgPSB7ZnJvbTogUG9zKHJhbmdlJCQxLCAwKSwgdG86IG51bGx9O1xuICAgICAgfSBlbHNlIGlmIChyYW5nZSQkMS5mcm9tID09IG51bGwpIHtcbiAgICAgICAgcmFuZ2UkJDEgPSB7ZnJvbTogcmFuZ2UkJDEsIHRvOiBudWxsfTtcbiAgICAgIH1cbiAgICAgIGlmICghcmFuZ2UkJDEudG8pIHsgcmFuZ2UkJDEudG8gPSByYW5nZSQkMS5mcm9tOyB9XG4gICAgICByYW5nZSQkMS5tYXJnaW4gPSBtYXJnaW4gfHwgMDtcblxuICAgICAgaWYgKHJhbmdlJCQxLmZyb20ubGluZSAhPSBudWxsKSB7XG4gICAgICAgIHNjcm9sbFRvUmFuZ2UodGhpcywgcmFuZ2UkJDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2Nyb2xsVG9Db29yZHNSYW5nZSh0aGlzLCByYW5nZSQkMS5mcm9tLCByYW5nZSQkMS50bywgcmFuZ2UkJDEubWFyZ2luKTtcbiAgICAgIH1cbiAgICB9KSxcblxuICAgIHNldFNpemU6IG1ldGhvZE9wKGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gICAgICB2YXIgaW50ZXJwcmV0ID0gZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gdHlwZW9mIHZhbCA9PSBcIm51bWJlclwiIHx8IC9eXFxkKyQvLnRlc3QoU3RyaW5nKHZhbCkpID8gdmFsICsgXCJweFwiIDogdmFsOyB9O1xuICAgICAgaWYgKHdpZHRoICE9IG51bGwpIHsgdGhpcy5kaXNwbGF5LndyYXBwZXIuc3R5bGUud2lkdGggPSBpbnRlcnByZXQod2lkdGgpOyB9XG4gICAgICBpZiAoaGVpZ2h0ICE9IG51bGwpIHsgdGhpcy5kaXNwbGF5LndyYXBwZXIuc3R5bGUuaGVpZ2h0ID0gaW50ZXJwcmV0KGhlaWdodCk7IH1cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7IGNsZWFyTGluZU1lYXN1cmVtZW50Q2FjaGUodGhpcyk7IH1cbiAgICAgIHZhciBsaW5lTm8kJDEgPSB0aGlzLmRpc3BsYXkudmlld0Zyb207XG4gICAgICB0aGlzLmRvYy5pdGVyKGxpbmVObyQkMSwgdGhpcy5kaXNwbGF5LnZpZXdUbywgZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgaWYgKGxpbmUud2lkZ2V0cykgeyBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmUud2lkZ2V0cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICB7IGlmIChsaW5lLndpZGdldHNbaV0ubm9IU2Nyb2xsKSB7IHJlZ0xpbmVDaGFuZ2UodGhpcyQxLCBsaW5lTm8kJDEsIFwid2lkZ2V0XCIpOyBicmVhayB9IH0gfVxuICAgICAgICArK2xpbmVObyQkMTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7XG4gICAgICBzaWduYWwodGhpcywgXCJyZWZyZXNoXCIsIHRoaXMpO1xuICAgIH0pLFxuXG4gICAgb3BlcmF0aW9uOiBmdW5jdGlvbihmKXtyZXR1cm4gcnVuSW5PcCh0aGlzLCBmKX0sXG5cbiAgICByZWZyZXNoOiBtZXRob2RPcChmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvbGRIZWlnaHQgPSB0aGlzLmRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodDtcbiAgICAgIHJlZ0NoYW5nZSh0aGlzKTtcbiAgICAgIHRoaXMuY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgY2xlYXJDYWNoZXModGhpcyk7XG4gICAgICBzY3JvbGxUb0Nvb3Jkcyh0aGlzLCB0aGlzLmRvYy5zY3JvbGxMZWZ0LCB0aGlzLmRvYy5zY3JvbGxUb3ApO1xuICAgICAgdXBkYXRlR3V0dGVyU3BhY2UodGhpcyk7XG4gICAgICBpZiAob2xkSGVpZ2h0ID09IG51bGwgfHwgTWF0aC5hYnMob2xkSGVpZ2h0IC0gdGV4dEhlaWdodCh0aGlzLmRpc3BsYXkpKSA+IC41KVxuICAgICAgICB7IGVzdGltYXRlTGluZUhlaWdodHModGhpcyk7IH1cbiAgICAgIHNpZ25hbCh0aGlzLCBcInJlZnJlc2hcIiwgdGhpcyk7XG4gICAgfSksXG5cbiAgICBzd2FwRG9jOiBtZXRob2RPcChmdW5jdGlvbihkb2MpIHtcbiAgICAgIHZhciBvbGQgPSB0aGlzLmRvYztcbiAgICAgIG9sZC5jbSA9IG51bGw7XG4gICAgICBhdHRhY2hEb2ModGhpcywgZG9jKTtcbiAgICAgIGNsZWFyQ2FjaGVzKHRoaXMpO1xuICAgICAgdGhpcy5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICBzY3JvbGxUb0Nvb3Jkcyh0aGlzLCBkb2Muc2Nyb2xsTGVmdCwgZG9jLnNjcm9sbFRvcCk7XG4gICAgICB0aGlzLmN1ck9wLmZvcmNlU2Nyb2xsID0gdHJ1ZTtcbiAgICAgIHNpZ25hbExhdGVyKHRoaXMsIFwic3dhcERvY1wiLCB0aGlzLCBvbGQpO1xuICAgICAgcmV0dXJuIG9sZFxuICAgIH0pLFxuXG4gICAgZ2V0SW5wdXRGaWVsZDogZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kaXNwbGF5LmlucHV0LmdldEZpZWxkKCl9LFxuICAgIGdldFdyYXBwZXJFbGVtZW50OiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpc3BsYXkud3JhcHBlcn0sXG4gICAgZ2V0U2Nyb2xsZXJFbGVtZW50OiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpc3BsYXkuc2Nyb2xsZXJ9LFxuICAgIGdldEd1dHRlckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS5ndXR0ZXJzfVxuICB9O1xuICBldmVudE1peGluKENvZGVNaXJyb3IpO1xuXG4gIENvZGVNaXJyb3IucmVnaXN0ZXJIZWxwZXIgPSBmdW5jdGlvbih0eXBlLCBuYW1lLCB2YWx1ZSkge1xuICAgIGlmICghaGVscGVycy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkgeyBoZWxwZXJzW3R5cGVdID0gQ29kZU1pcnJvclt0eXBlXSA9IHtfZ2xvYmFsOiBbXX07IH1cbiAgICBoZWxwZXJzW3R5cGVdW25hbWVdID0gdmFsdWU7XG4gIH07XG4gIENvZGVNaXJyb3IucmVnaXN0ZXJHbG9iYWxIZWxwZXIgPSBmdW5jdGlvbih0eXBlLCBuYW1lLCBwcmVkaWNhdGUsIHZhbHVlKSB7XG4gICAgQ29kZU1pcnJvci5yZWdpc3RlckhlbHBlcih0eXBlLCBuYW1lLCB2YWx1ZSk7XG4gICAgaGVscGVyc1t0eXBlXS5fZ2xvYmFsLnB1c2goe3ByZWQ6IHByZWRpY2F0ZSwgdmFsOiB2YWx1ZX0pO1xuICB9O1xufTtcblxuLy8gVXNlZCBmb3IgaG9yaXpvbnRhbCByZWxhdGl2ZSBtb3Rpb24uIERpciBpcyAtMSBvciAxIChsZWZ0IG9yXG4vLyByaWdodCksIHVuaXQgY2FuIGJlIFwiY2hhclwiLCBcImNvbHVtblwiIChsaWtlIGNoYXIsIGJ1dCBkb2Vzbid0XG4vLyBjcm9zcyBsaW5lIGJvdW5kYXJpZXMpLCBcIndvcmRcIiAoYWNyb3NzIG5leHQgd29yZCksIG9yIFwiZ3JvdXBcIiAodG9cbi8vIHRoZSBzdGFydCBvZiBuZXh0IGdyb3VwIG9mIHdvcmQgb3Igbm9uLXdvcmQtbm9uLXdoaXRlc3BhY2Vcbi8vIGNoYXJzKS4gVGhlIHZpc3VhbGx5IHBhcmFtIGNvbnRyb2xzIHdoZXRoZXIsIGluIHJpZ2h0LXRvLWxlZnRcbi8vIHRleHQsIGRpcmVjdGlvbiAxIG1lYW5zIHRvIG1vdmUgdG93YXJkcyB0aGUgbmV4dCBpbmRleCBpbiB0aGVcbi8vIHN0cmluZywgb3IgdG93YXJkcyB0aGUgY2hhcmFjdGVyIHRvIHRoZSByaWdodCBvZiB0aGUgY3VycmVudFxuLy8gcG9zaXRpb24uIFRoZSByZXN1bHRpbmcgcG9zaXRpb24gd2lsbCBoYXZlIGEgaGl0U2lkZT10cnVlXG4vLyBwcm9wZXJ0eSBpZiBpdCByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIGRvY3VtZW50LlxuZnVuY3Rpb24gZmluZFBvc0goZG9jLCBwb3MsIGRpciwgdW5pdCwgdmlzdWFsbHkpIHtcbiAgdmFyIG9sZFBvcyA9IHBvcztcbiAgdmFyIG9yaWdEaXIgPSBkaXI7XG4gIHZhciBsaW5lT2JqID0gZ2V0TGluZShkb2MsIHBvcy5saW5lKTtcbiAgZnVuY3Rpb24gZmluZE5leHRMaW5lKCkge1xuICAgIHZhciBsID0gcG9zLmxpbmUgKyBkaXI7XG4gICAgaWYgKGwgPCBkb2MuZmlyc3QgfHwgbCA+PSBkb2MuZmlyc3QgKyBkb2Muc2l6ZSkgeyByZXR1cm4gZmFsc2UgfVxuICAgIHBvcyA9IG5ldyBQb3MobCwgcG9zLmNoLCBwb3Muc3RpY2t5KTtcbiAgICByZXR1cm4gbGluZU9iaiA9IGdldExpbmUoZG9jLCBsKVxuICB9XG4gIGZ1bmN0aW9uIG1vdmVPbmNlKGJvdW5kVG9MaW5lKSB7XG4gICAgdmFyIG5leHQ7XG4gICAgaWYgKHZpc3VhbGx5KSB7XG4gICAgICBuZXh0ID0gbW92ZVZpc3VhbGx5KGRvYy5jbSwgbGluZU9iaiwgcG9zLCBkaXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0ID0gbW92ZUxvZ2ljYWxseShsaW5lT2JqLCBwb3MsIGRpcik7XG4gICAgfVxuICAgIGlmIChuZXh0ID09IG51bGwpIHtcbiAgICAgIGlmICghYm91bmRUb0xpbmUgJiYgZmluZE5leHRMaW5lKCkpXG4gICAgICAgIHsgcG9zID0gZW5kT2ZMaW5lKHZpc3VhbGx5LCBkb2MuY20sIGxpbmVPYmosIHBvcy5saW5lLCBkaXIpOyB9XG4gICAgICBlbHNlXG4gICAgICAgIHsgcmV0dXJuIGZhbHNlIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcG9zID0gbmV4dDtcbiAgICB9XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGlmICh1bml0ID09IFwiY2hhclwiKSB7XG4gICAgbW92ZU9uY2UoKTtcbiAgfSBlbHNlIGlmICh1bml0ID09IFwiY29sdW1uXCIpIHtcbiAgICBtb3ZlT25jZSh0cnVlKTtcbiAgfSBlbHNlIGlmICh1bml0ID09IFwid29yZFwiIHx8IHVuaXQgPT0gXCJncm91cFwiKSB7XG4gICAgdmFyIHNhd1R5cGUgPSBudWxsLCBncm91cCA9IHVuaXQgPT0gXCJncm91cFwiO1xuICAgIHZhciBoZWxwZXIgPSBkb2MuY20gJiYgZG9jLmNtLmdldEhlbHBlcihwb3MsIFwid29yZENoYXJzXCIpO1xuICAgIGZvciAodmFyIGZpcnN0ID0gdHJ1ZTs7IGZpcnN0ID0gZmFsc2UpIHtcbiAgICAgIGlmIChkaXIgPCAwICYmICFtb3ZlT25jZSghZmlyc3QpKSB7IGJyZWFrIH1cbiAgICAgIHZhciBjdXIgPSBsaW5lT2JqLnRleHQuY2hhckF0KHBvcy5jaCkgfHwgXCJcXG5cIjtcbiAgICAgIHZhciB0eXBlID0gaXNXb3JkQ2hhcihjdXIsIGhlbHBlcikgPyBcIndcIlxuICAgICAgICA6IGdyb3VwICYmIGN1ciA9PSBcIlxcblwiID8gXCJuXCJcbiAgICAgICAgOiAhZ3JvdXAgfHwgL1xccy8udGVzdChjdXIpID8gbnVsbFxuICAgICAgICA6IFwicFwiO1xuICAgICAgaWYgKGdyb3VwICYmICFmaXJzdCAmJiAhdHlwZSkgeyB0eXBlID0gXCJzXCI7IH1cbiAgICAgIGlmIChzYXdUeXBlICYmIHNhd1R5cGUgIT0gdHlwZSkge1xuICAgICAgICBpZiAoZGlyIDwgMCkge2RpciA9IDE7IG1vdmVPbmNlKCk7IHBvcy5zdGlja3kgPSBcImFmdGVyXCI7fVxuICAgICAgICBicmVha1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZSkgeyBzYXdUeXBlID0gdHlwZTsgfVxuICAgICAgaWYgKGRpciA+IDAgJiYgIW1vdmVPbmNlKCFmaXJzdCkpIHsgYnJlYWsgfVxuICAgIH1cbiAgfVxuICB2YXIgcmVzdWx0ID0gc2tpcEF0b21pYyhkb2MsIHBvcywgb2xkUG9zLCBvcmlnRGlyLCB0cnVlKTtcbiAgaWYgKGVxdWFsQ3Vyc29yUG9zKG9sZFBvcywgcmVzdWx0KSkgeyByZXN1bHQuaGl0U2lkZSA9IHRydWU7IH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG4vLyBGb3IgcmVsYXRpdmUgdmVydGljYWwgbW92ZW1lbnQuIERpciBtYXkgYmUgLTEgb3IgMS4gVW5pdCBjYW4gYmVcbi8vIFwicGFnZVwiIG9yIFwibGluZVwiLiBUaGUgcmVzdWx0aW5nIHBvc2l0aW9uIHdpbGwgaGF2ZSBhIGhpdFNpZGU9dHJ1ZVxuLy8gcHJvcGVydHkgaWYgaXQgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudC5cbmZ1bmN0aW9uIGZpbmRQb3NWKGNtLCBwb3MsIGRpciwgdW5pdCkge1xuICB2YXIgZG9jID0gY20uZG9jLCB4ID0gcG9zLmxlZnQsIHk7XG4gIGlmICh1bml0ID09IFwicGFnZVwiKSB7XG4gICAgdmFyIHBhZ2VTaXplID0gTWF0aC5taW4oY20uZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCwgd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpO1xuICAgIHZhciBtb3ZlQW1vdW50ID0gTWF0aC5tYXgocGFnZVNpemUgLSAuNSAqIHRleHRIZWlnaHQoY20uZGlzcGxheSksIDMpO1xuICAgIHkgPSAoZGlyID4gMCA/IHBvcy5ib3R0b20gOiBwb3MudG9wKSArIGRpciAqIG1vdmVBbW91bnQ7XG5cbiAgfSBlbHNlIGlmICh1bml0ID09IFwibGluZVwiKSB7XG4gICAgeSA9IGRpciA+IDAgPyBwb3MuYm90dG9tICsgMyA6IHBvcy50b3AgLSAzO1xuICB9XG4gIHZhciB0YXJnZXQ7XG4gIGZvciAoOzspIHtcbiAgICB0YXJnZXQgPSBjb29yZHNDaGFyKGNtLCB4LCB5KTtcbiAgICBpZiAoIXRhcmdldC5vdXRzaWRlKSB7IGJyZWFrIH1cbiAgICBpZiAoZGlyIDwgMCA/IHkgPD0gMCA6IHkgPj0gZG9jLmhlaWdodCkgeyB0YXJnZXQuaGl0U2lkZSA9IHRydWU7IGJyZWFrIH1cbiAgICB5ICs9IGRpciAqIDU7XG4gIH1cbiAgcmV0dXJuIHRhcmdldFxufVxuXG4vLyBDT05URU5URURJVEFCTEUgSU5QVVQgU1RZTEVcblxudmFyIENvbnRlbnRFZGl0YWJsZUlucHV0ID0gZnVuY3Rpb24oY20pIHtcbiAgdGhpcy5jbSA9IGNtO1xuICB0aGlzLmxhc3RBbmNob3JOb2RlID0gdGhpcy5sYXN0QW5jaG9yT2Zmc2V0ID0gdGhpcy5sYXN0Rm9jdXNOb2RlID0gdGhpcy5sYXN0Rm9jdXNPZmZzZXQgPSBudWxsO1xuICB0aGlzLnBvbGxpbmcgPSBuZXcgRGVsYXllZCgpO1xuICB0aGlzLmNvbXBvc2luZyA9IG51bGw7XG4gIHRoaXMuZ3JhY2VQZXJpb2QgPSBmYWxzZTtcbiAgdGhpcy5yZWFkRE9NVGltZW91dCA9IG51bGw7XG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChkaXNwbGF5KSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgdmFyIGlucHV0ID0gdGhpcywgY20gPSBpbnB1dC5jbTtcbiAgdmFyIGRpdiA9IGlucHV0LmRpdiA9IGRpc3BsYXkubGluZURpdjtcbiAgZGlzYWJsZUJyb3dzZXJNYWdpYyhkaXYsIGNtLm9wdGlvbnMuc3BlbGxjaGVjayk7XG5cbiAgb24oZGl2LCBcInBhc3RlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSB8fCBoYW5kbGVQYXN0ZShlLCBjbSkpIHsgcmV0dXJuIH1cbiAgICAvLyBJRSBkb2Vzbid0IGZpcmUgaW5wdXQgZXZlbnRzLCBzbyB3ZSBzY2hlZHVsZSBhIHJlYWQgZm9yIHRoZSBwYXN0ZWQgY29udGVudCBpbiB0aGlzIHdheVxuICAgIGlmIChpZV92ZXJzaW9uIDw9IDExKSB7IHNldFRpbWVvdXQob3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzJDEudXBkYXRlRnJvbURPTSgpOyB9KSwgMjApOyB9XG4gIH0pO1xuXG4gIG9uKGRpdiwgXCJjb21wb3NpdGlvbnN0YXJ0XCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcyQxLmNvbXBvc2luZyA9IHtkYXRhOiBlLmRhdGEsIGRvbmU6IGZhbHNlfTtcbiAgfSk7XG4gIG9uKGRpdiwgXCJjb21wb3NpdGlvbnVwZGF0ZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcyQxLmNvbXBvc2luZykgeyB0aGlzJDEuY29tcG9zaW5nID0ge2RhdGE6IGUuZGF0YSwgZG9uZTogZmFsc2V9OyB9XG4gIH0pO1xuICBvbihkaXYsIFwiY29tcG9zaXRpb25lbmRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAodGhpcyQxLmNvbXBvc2luZykge1xuICAgICAgaWYgKGUuZGF0YSAhPSB0aGlzJDEuY29tcG9zaW5nLmRhdGEpIHsgdGhpcyQxLnJlYWRGcm9tRE9NU29vbigpOyB9XG4gICAgICB0aGlzJDEuY29tcG9zaW5nLmRvbmUgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgb24oZGl2LCBcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gaW5wdXQuZm9yY2VDb21wb3NpdGlvbkVuZCgpOyB9KTtcblxuICBvbihkaXYsIFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcyQxLmNvbXBvc2luZykgeyB0aGlzJDEucmVhZEZyb21ET01Tb29uKCk7IH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gb25Db3B5Q3V0KGUpIHtcbiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpKSB7IHJldHVybiB9XG4gICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICAgIHNldExhc3RDb3BpZWQoe2xpbmVXaXNlOiBmYWxzZSwgdGV4dDogY20uZ2V0U2VsZWN0aW9ucygpfSk7XG4gICAgICBpZiAoZS50eXBlID09IFwiY3V0XCIpIHsgY20ucmVwbGFjZVNlbGVjdGlvbihcIlwiLCBudWxsLCBcImN1dFwiKTsgfVxuICAgIH0gZWxzZSBpZiAoIWNtLm9wdGlvbnMubGluZVdpc2VDb3B5Q3V0KSB7XG4gICAgICByZXR1cm5cbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHJhbmdlcyA9IGNvcHlhYmxlUmFuZ2VzKGNtKTtcbiAgICAgIHNldExhc3RDb3BpZWQoe2xpbmVXaXNlOiB0cnVlLCB0ZXh0OiByYW5nZXMudGV4dH0pO1xuICAgICAgaWYgKGUudHlwZSA9PSBcImN1dFwiKSB7XG4gICAgICAgIGNtLm9wZXJhdGlvbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY20uc2V0U2VsZWN0aW9ucyhyYW5nZXMucmFuZ2VzLCAwLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgICAgICAgY20ucmVwbGFjZVNlbGVjdGlvbihcIlwiLCBudWxsLCBcImN1dFwiKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChlLmNsaXBib2FyZERhdGEpIHtcbiAgICAgIGUuY2xpcGJvYXJkRGF0YS5jbGVhckRhdGEoKTtcbiAgICAgIHZhciBjb250ZW50ID0gbGFzdENvcGllZC50ZXh0LmpvaW4oXCJcXG5cIik7XG4gICAgICAvLyBpT1MgZXhwb3NlcyB0aGUgY2xpcGJvYXJkIEFQSSwgYnV0IHNlZW1zIHRvIGRpc2NhcmQgY29udGVudCBpbnNlcnRlZCBpbnRvIGl0XG4gICAgICBlLmNsaXBib2FyZERhdGEuc2V0RGF0YShcIlRleHRcIiwgY29udGVudCk7XG4gICAgICBpZiAoZS5jbGlwYm9hcmREYXRhLmdldERhdGEoXCJUZXh0XCIpID09IGNvbnRlbnQpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9XG4gICAgLy8gT2xkLWZhc2hpb25lZCBicmllZmx5LWZvY3VzLWEtdGV4dGFyZWEgaGFja1xuICAgIHZhciBrbHVkZ2UgPSBoaWRkZW5UZXh0YXJlYSgpLCB0ZSA9IGtsdWRnZS5maXJzdENoaWxkO1xuICAgIGNtLmRpc3BsYXkubGluZVNwYWNlLmluc2VydEJlZm9yZShrbHVkZ2UsIGNtLmRpc3BsYXkubGluZVNwYWNlLmZpcnN0Q2hpbGQpO1xuICAgIHRlLnZhbHVlID0gbGFzdENvcGllZC50ZXh0LmpvaW4oXCJcXG5cIik7XG4gICAgdmFyIGhhZEZvY3VzID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICBzZWxlY3RJbnB1dCh0ZSk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5yZW1vdmVDaGlsZChrbHVkZ2UpO1xuICAgICAgaGFkRm9jdXMuZm9jdXMoKTtcbiAgICAgIGlmIChoYWRGb2N1cyA9PSBkaXYpIHsgaW5wdXQuc2hvd1ByaW1hcnlTZWxlY3Rpb24oKTsgfVxuICAgIH0sIDUwKTtcbiAgfVxuICBvbihkaXYsIFwiY29weVwiLCBvbkNvcHlDdXQpO1xuICBvbihkaXYsIFwiY3V0XCIsIG9uQ29weUN1dCk7XG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucHJlcGFyZVNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHJlc3VsdCA9IHByZXBhcmVTZWxlY3Rpb24odGhpcy5jbSwgZmFsc2UpO1xuICByZXN1bHQuZm9jdXMgPSB0aGlzLmNtLnN0YXRlLmZvY3VzZWQ7XG4gIHJldHVybiByZXN1bHRcbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5zaG93U2VsZWN0aW9uID0gZnVuY3Rpb24gKGluZm8sIHRha2VGb2N1cykge1xuICBpZiAoIWluZm8gfHwgIXRoaXMuY20uZGlzcGxheS52aWV3Lmxlbmd0aCkgeyByZXR1cm4gfVxuICBpZiAoaW5mby5mb2N1cyB8fCB0YWtlRm9jdXMpIHsgdGhpcy5zaG93UHJpbWFyeVNlbGVjdGlvbigpOyB9XG4gIHRoaXMuc2hvd011bHRpcGxlU2VsZWN0aW9ucyhpbmZvKTtcbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5zaG93UHJpbWFyeVNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgY20gPSB0aGlzLmNtLCBwcmltID0gY20uZG9jLnNlbC5wcmltYXJ5KCk7XG4gIHZhciBmcm9tID0gcHJpbS5mcm9tKCksIHRvID0gcHJpbS50bygpO1xuXG4gIGlmIChjbS5kaXNwbGF5LnZpZXdUbyA9PSBjbS5kaXNwbGF5LnZpZXdGcm9tIHx8IGZyb20ubGluZSA+PSBjbS5kaXNwbGF5LnZpZXdUbyB8fCB0by5saW5lIDwgY20uZGlzcGxheS52aWV3RnJvbSkge1xuICAgIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICByZXR1cm5cbiAgfVxuXG4gIHZhciBjdXJBbmNob3IgPSBkb21Ub1BvcyhjbSwgc2VsLmFuY2hvck5vZGUsIHNlbC5hbmNob3JPZmZzZXQpO1xuICB2YXIgY3VyRm9jdXMgPSBkb21Ub1BvcyhjbSwgc2VsLmZvY3VzTm9kZSwgc2VsLmZvY3VzT2Zmc2V0KTtcbiAgaWYgKGN1ckFuY2hvciAmJiAhY3VyQW5jaG9yLmJhZCAmJiBjdXJGb2N1cyAmJiAhY3VyRm9jdXMuYmFkICYmXG4gICAgICBjbXAobWluUG9zKGN1ckFuY2hvciwgY3VyRm9jdXMpLCBmcm9tKSA9PSAwICYmXG4gICAgICBjbXAobWF4UG9zKGN1ckFuY2hvciwgY3VyRm9jdXMpLCB0bykgPT0gMClcbiAgICB7IHJldHVybiB9XG5cbiAgdmFyIHZpZXcgPSBjbS5kaXNwbGF5LnZpZXc7XG4gIHZhciBzdGFydCA9IChmcm9tLmxpbmUgPj0gY20uZGlzcGxheS52aWV3RnJvbSAmJiBwb3NUb0RPTShjbSwgZnJvbSkpIHx8XG4gICAgICB7bm9kZTogdmlld1swXS5tZWFzdXJlLm1hcFsyXSwgb2Zmc2V0OiAwfTtcbiAgdmFyIGVuZCA9IHRvLmxpbmUgPCBjbS5kaXNwbGF5LnZpZXdUbyAmJiBwb3NUb0RPTShjbSwgdG8pO1xuICBpZiAoIWVuZCkge1xuICAgIHZhciBtZWFzdXJlID0gdmlld1t2aWV3Lmxlbmd0aCAtIDFdLm1lYXN1cmU7XG4gICAgdmFyIG1hcCQkMSA9IG1lYXN1cmUubWFwcyA/IG1lYXN1cmUubWFwc1ttZWFzdXJlLm1hcHMubGVuZ3RoIC0gMV0gOiBtZWFzdXJlLm1hcDtcbiAgICBlbmQgPSB7bm9kZTogbWFwJCQxW21hcCQkMS5sZW5ndGggLSAxXSwgb2Zmc2V0OiBtYXAkJDFbbWFwJCQxLmxlbmd0aCAtIDJdIC0gbWFwJCQxW21hcCQkMS5sZW5ndGggLSAzXX07XG4gIH1cblxuICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHtcbiAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgcmV0dXJuXG4gIH1cblxuICB2YXIgb2xkID0gc2VsLnJhbmdlQ291bnQgJiYgc2VsLmdldFJhbmdlQXQoMCksIHJuZztcbiAgdHJ5IHsgcm5nID0gcmFuZ2Uoc3RhcnQubm9kZSwgc3RhcnQub2Zmc2V0LCBlbmQub2Zmc2V0LCBlbmQubm9kZSk7IH1cbiAgY2F0Y2goZSkge30gLy8gT3VyIG1vZGVsIG9mIHRoZSBET00gbWlnaHQgYmUgb3V0ZGF0ZWQsIGluIHdoaWNoIGNhc2UgdGhlIHJhbmdlIHdlIHRyeSB0byBzZXQgY2FuIGJlIGltcG9zc2libGVcbiAgaWYgKHJuZykge1xuICAgIGlmICghZ2Vja28gJiYgY20uc3RhdGUuZm9jdXNlZCkge1xuICAgICAgc2VsLmNvbGxhcHNlKHN0YXJ0Lm5vZGUsIHN0YXJ0Lm9mZnNldCk7XG4gICAgICBpZiAoIXJuZy5jb2xsYXBzZWQpIHtcbiAgICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICBzZWwuYWRkUmFuZ2Uocm5nKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgc2VsLmFkZFJhbmdlKHJuZyk7XG4gICAgfVxuICAgIGlmIChvbGQgJiYgc2VsLmFuY2hvck5vZGUgPT0gbnVsbCkgeyBzZWwuYWRkUmFuZ2Uob2xkKTsgfVxuICAgIGVsc2UgaWYgKGdlY2tvKSB7IHRoaXMuc3RhcnRHcmFjZVBlcmlvZCgpOyB9XG4gIH1cbiAgdGhpcy5yZW1lbWJlclNlbGVjdGlvbigpO1xufTtcblxuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnN0YXJ0R3JhY2VQZXJpb2QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgY2xlYXJUaW1lb3V0KHRoaXMuZ3JhY2VQZXJpb2QpO1xuICB0aGlzLmdyYWNlUGVyaW9kID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgdGhpcyQxLmdyYWNlUGVyaW9kID0gZmFsc2U7XG4gICAgaWYgKHRoaXMkMS5zZWxlY3Rpb25DaGFuZ2VkKCkpXG4gICAgICB7IHRoaXMkMS5jbS5vcGVyYXRpb24oZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcyQxLmNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlOyB9KTsgfVxuICB9LCAyMCk7XG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuc2hvd011bHRpcGxlU2VsZWN0aW9ucyA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHRoaXMuY20uZGlzcGxheS5jdXJzb3JEaXYsIGluZm8uY3Vyc29ycyk7XG4gIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHRoaXMuY20uZGlzcGxheS5zZWxlY3Rpb25EaXYsIGluZm8uc2VsZWN0aW9uKTtcbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5yZW1lbWJlclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgdGhpcy5sYXN0QW5jaG9yTm9kZSA9IHNlbC5hbmNob3JOb2RlOyB0aGlzLmxhc3RBbmNob3JPZmZzZXQgPSBzZWwuYW5jaG9yT2Zmc2V0O1xuICB0aGlzLmxhc3RGb2N1c05vZGUgPSBzZWwuZm9jdXNOb2RlOyB0aGlzLmxhc3RGb2N1c09mZnNldCA9IHNlbC5mb2N1c09mZnNldDtcbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5zZWxlY3Rpb25JbkVkaXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgaWYgKCFzZWwucmFuZ2VDb3VudCkgeyByZXR1cm4gZmFsc2UgfVxuICB2YXIgbm9kZSA9IHNlbC5nZXRSYW5nZUF0KDApLmNvbW1vbkFuY2VzdG9yQ29udGFpbmVyO1xuICByZXR1cm4gY29udGFpbnModGhpcy5kaXYsIG5vZGUpXG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICh0aGlzLmNtLm9wdGlvbnMucmVhZE9ubHkgIT0gXCJub2N1cnNvclwiKSB7XG4gICAgaWYgKCF0aGlzLnNlbGVjdGlvbkluRWRpdG9yKCkpXG4gICAgICB7IHRoaXMuc2hvd1NlbGVjdGlvbih0aGlzLnByZXBhcmVTZWxlY3Rpb24oKSwgdHJ1ZSk7IH1cbiAgICB0aGlzLmRpdi5mb2N1cygpO1xuICB9XG59O1xuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLmJsdXIgPSBmdW5jdGlvbiAoKSB7IHRoaXMuZGl2LmJsdXIoKTsgfTtcbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5nZXRGaWVsZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZGl2IH07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5zdXBwb3J0c1RvdWNoID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdHJ1ZSB9O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucmVjZWl2ZWRGb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGlucHV0ID0gdGhpcztcbiAgaWYgKHRoaXMuc2VsZWN0aW9uSW5FZGl0b3IoKSlcbiAgICB7IHRoaXMucG9sbFNlbGVjdGlvbigpOyB9XG4gIGVsc2VcbiAgICB7IHJ1bkluT3AodGhpcy5jbSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gaW5wdXQuY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7IH0pOyB9XG5cbiAgZnVuY3Rpb24gcG9sbCgpIHtcbiAgICBpZiAoaW5wdXQuY20uc3RhdGUuZm9jdXNlZCkge1xuICAgICAgaW5wdXQucG9sbFNlbGVjdGlvbigpO1xuICAgICAgaW5wdXQucG9sbGluZy5zZXQoaW5wdXQuY20ub3B0aW9ucy5wb2xsSW50ZXJ2YWwsIHBvbGwpO1xuICAgIH1cbiAgfVxuICB0aGlzLnBvbGxpbmcuc2V0KHRoaXMuY20ub3B0aW9ucy5wb2xsSW50ZXJ2YWwsIHBvbGwpO1xufTtcblxuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnNlbGVjdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XG4gIHJldHVybiBzZWwuYW5jaG9yTm9kZSAhPSB0aGlzLmxhc3RBbmNob3JOb2RlIHx8IHNlbC5hbmNob3JPZmZzZXQgIT0gdGhpcy5sYXN0QW5jaG9yT2Zmc2V0IHx8XG4gICAgc2VsLmZvY3VzTm9kZSAhPSB0aGlzLmxhc3RGb2N1c05vZGUgfHwgc2VsLmZvY3VzT2Zmc2V0ICE9IHRoaXMubGFzdEZvY3VzT2Zmc2V0XG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucG9sbFNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMucmVhZERPTVRpbWVvdXQgIT0gbnVsbCB8fCB0aGlzLmdyYWNlUGVyaW9kIHx8ICF0aGlzLnNlbGVjdGlvbkNoYW5nZWQoKSkgeyByZXR1cm4gfVxuICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpLCBjbSA9IHRoaXMuY207XG4gIC8vIE9uIEFuZHJvaWQgQ2hyb21lICh2ZXJzaW9uIDU2LCBhdCBsZWFzdCksIGJhY2tzcGFjaW5nIGludG8gYW5cbiAgLy8gdW5lZGl0YWJsZSBibG9jayBlbGVtZW50IHdpbGwgcHV0IHRoZSBjdXJzb3IgaW4gdGhhdCBlbGVtZW50LFxuICAvLyBhbmQgdGhlbiwgYmVjYXVzZSBpdCdzIG5vdCBlZGl0YWJsZSwgaGlkZSB0aGUgdmlydHVhbCBrZXlib2FyZC5cbiAgLy8gQmVjYXVzZSBBbmRyb2lkIGRvZXNuJ3QgYWxsb3cgdXMgdG8gYWN0dWFsbHkgZGV0ZWN0IGJhY2tzcGFjZVxuICAvLyBwcmVzc2VzIGluIGEgc2FuZSB3YXksIHRoaXMgY29kZSBjaGVja3MgZm9yIHdoZW4gdGhhdCBoYXBwZW5zXG4gIC8vIGFuZCBzaW11bGF0ZXMgYSBiYWNrc3BhY2UgcHJlc3MgaW4gdGhpcyBjYXNlLlxuICBpZiAoYW5kcm9pZCAmJiBjaHJvbWUgJiYgdGhpcy5jbS5vcHRpb25zLmd1dHRlcnMubGVuZ3RoICYmIGlzSW5HdXR0ZXIoc2VsLmFuY2hvck5vZGUpKSB7XG4gICAgdGhpcy5jbS50cmlnZ2VyT25LZXlEb3duKHt0eXBlOiBcImtleWRvd25cIiwga2V5Q29kZTogOCwgcHJldmVudERlZmF1bHQ6IE1hdGguYWJzfSk7XG4gICAgdGhpcy5ibHVyKCk7XG4gICAgdGhpcy5mb2N1cygpO1xuICAgIHJldHVyblxuICB9XG4gIGlmICh0aGlzLmNvbXBvc2luZykgeyByZXR1cm4gfVxuICB0aGlzLnJlbWVtYmVyU2VsZWN0aW9uKCk7XG4gIHZhciBhbmNob3IgPSBkb21Ub1BvcyhjbSwgc2VsLmFuY2hvck5vZGUsIHNlbC5hbmNob3JPZmZzZXQpO1xuICB2YXIgaGVhZCA9IGRvbVRvUG9zKGNtLCBzZWwuZm9jdXNOb2RlLCBzZWwuZm9jdXNPZmZzZXQpO1xuICBpZiAoYW5jaG9yICYmIGhlYWQpIHsgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkge1xuICAgIHNldFNlbGVjdGlvbihjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihhbmNob3IsIGhlYWQpLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgaWYgKGFuY2hvci5iYWQgfHwgaGVhZC5iYWQpIHsgY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7IH1cbiAgfSk7IH1cbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5wb2xsQ29udGVudCA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMucmVhZERPTVRpbWVvdXQgIT0gbnVsbCkge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLnJlYWRET01UaW1lb3V0KTtcbiAgICB0aGlzLnJlYWRET01UaW1lb3V0ID0gbnVsbDtcbiAgfVxuXG4gIHZhciBjbSA9IHRoaXMuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBzZWwgPSBjbS5kb2Muc2VsLnByaW1hcnkoKTtcbiAgdmFyIGZyb20gPSBzZWwuZnJvbSgpLCB0byA9IHNlbC50bygpO1xuICBpZiAoZnJvbS5jaCA9PSAwICYmIGZyb20ubGluZSA+IGNtLmZpcnN0TGluZSgpKVxuICAgIHsgZnJvbSA9IFBvcyhmcm9tLmxpbmUgLSAxLCBnZXRMaW5lKGNtLmRvYywgZnJvbS5saW5lIC0gMSkubGVuZ3RoKTsgfVxuICBpZiAodG8uY2ggPT0gZ2V0TGluZShjbS5kb2MsIHRvLmxpbmUpLnRleHQubGVuZ3RoICYmIHRvLmxpbmUgPCBjbS5sYXN0TGluZSgpKVxuICAgIHsgdG8gPSBQb3ModG8ubGluZSArIDEsIDApOyB9XG4gIGlmIChmcm9tLmxpbmUgPCBkaXNwbGF5LnZpZXdGcm9tIHx8IHRvLmxpbmUgPiBkaXNwbGF5LnZpZXdUbyAtIDEpIHsgcmV0dXJuIGZhbHNlIH1cblxuICB2YXIgZnJvbUluZGV4LCBmcm9tTGluZSwgZnJvbU5vZGU7XG4gIGlmIChmcm9tLmxpbmUgPT0gZGlzcGxheS52aWV3RnJvbSB8fCAoZnJvbUluZGV4ID0gZmluZFZpZXdJbmRleChjbSwgZnJvbS5saW5lKSkgPT0gMCkge1xuICAgIGZyb21MaW5lID0gbGluZU5vKGRpc3BsYXkudmlld1swXS5saW5lKTtcbiAgICBmcm9tTm9kZSA9IGRpc3BsYXkudmlld1swXS5ub2RlO1xuICB9IGVsc2Uge1xuICAgIGZyb21MaW5lID0gbGluZU5vKGRpc3BsYXkudmlld1tmcm9tSW5kZXhdLmxpbmUpO1xuICAgIGZyb21Ob2RlID0gZGlzcGxheS52aWV3W2Zyb21JbmRleCAtIDFdLm5vZGUubmV4dFNpYmxpbmc7XG4gIH1cbiAgdmFyIHRvSW5kZXggPSBmaW5kVmlld0luZGV4KGNtLCB0by5saW5lKTtcbiAgdmFyIHRvTGluZSwgdG9Ob2RlO1xuICBpZiAodG9JbmRleCA9PSBkaXNwbGF5LnZpZXcubGVuZ3RoIC0gMSkge1xuICAgIHRvTGluZSA9IGRpc3BsYXkudmlld1RvIC0gMTtcbiAgICB0b05vZGUgPSBkaXNwbGF5LmxpbmVEaXYubGFzdENoaWxkO1xuICB9IGVsc2Uge1xuICAgIHRvTGluZSA9IGxpbmVObyhkaXNwbGF5LnZpZXdbdG9JbmRleCArIDFdLmxpbmUpIC0gMTtcbiAgICB0b05vZGUgPSBkaXNwbGF5LnZpZXdbdG9JbmRleCArIDFdLm5vZGUucHJldmlvdXNTaWJsaW5nO1xuICB9XG5cbiAgaWYgKCFmcm9tTm9kZSkgeyByZXR1cm4gZmFsc2UgfVxuICB2YXIgbmV3VGV4dCA9IGNtLmRvYy5zcGxpdExpbmVzKGRvbVRleHRCZXR3ZWVuKGNtLCBmcm9tTm9kZSwgdG9Ob2RlLCBmcm9tTGluZSwgdG9MaW5lKSk7XG4gIHZhciBvbGRUZXh0ID0gZ2V0QmV0d2VlbihjbS5kb2MsIFBvcyhmcm9tTGluZSwgMCksIFBvcyh0b0xpbmUsIGdldExpbmUoY20uZG9jLCB0b0xpbmUpLnRleHQubGVuZ3RoKSk7XG4gIHdoaWxlIChuZXdUZXh0Lmxlbmd0aCA+IDEgJiYgb2xkVGV4dC5sZW5ndGggPiAxKSB7XG4gICAgaWYgKGxzdChuZXdUZXh0KSA9PSBsc3Qob2xkVGV4dCkpIHsgbmV3VGV4dC5wb3AoKTsgb2xkVGV4dC5wb3AoKTsgdG9MaW5lLS07IH1cbiAgICBlbHNlIGlmIChuZXdUZXh0WzBdID09IG9sZFRleHRbMF0pIHsgbmV3VGV4dC5zaGlmdCgpOyBvbGRUZXh0LnNoaWZ0KCk7IGZyb21MaW5lKys7IH1cbiAgICBlbHNlIHsgYnJlYWsgfVxuICB9XG5cbiAgdmFyIGN1dEZyb250ID0gMCwgY3V0RW5kID0gMDtcbiAgdmFyIG5ld1RvcCA9IG5ld1RleHRbMF0sIG9sZFRvcCA9IG9sZFRleHRbMF0sIG1heEN1dEZyb250ID0gTWF0aC5taW4obmV3VG9wLmxlbmd0aCwgb2xkVG9wLmxlbmd0aCk7XG4gIHdoaWxlIChjdXRGcm9udCA8IG1heEN1dEZyb250ICYmIG5ld1RvcC5jaGFyQ29kZUF0KGN1dEZyb250KSA9PSBvbGRUb3AuY2hhckNvZGVBdChjdXRGcm9udCkpXG4gICAgeyArK2N1dEZyb250OyB9XG4gIHZhciBuZXdCb3QgPSBsc3QobmV3VGV4dCksIG9sZEJvdCA9IGxzdChvbGRUZXh0KTtcbiAgdmFyIG1heEN1dEVuZCA9IE1hdGgubWluKG5ld0JvdC5sZW5ndGggLSAobmV3VGV4dC5sZW5ndGggPT0gMSA/IGN1dEZyb250IDogMCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRCb3QubGVuZ3RoIC0gKG9sZFRleHQubGVuZ3RoID09IDEgPyBjdXRGcm9udCA6IDApKTtcbiAgd2hpbGUgKGN1dEVuZCA8IG1heEN1dEVuZCAmJlxuICAgICAgICAgbmV3Qm90LmNoYXJDb2RlQXQobmV3Qm90Lmxlbmd0aCAtIGN1dEVuZCAtIDEpID09IG9sZEJvdC5jaGFyQ29kZUF0KG9sZEJvdC5sZW5ndGggLSBjdXRFbmQgLSAxKSlcbiAgICB7ICsrY3V0RW5kOyB9XG4gIC8vIFRyeSB0byBtb3ZlIHN0YXJ0IG9mIGNoYW5nZSB0byBzdGFydCBvZiBzZWxlY3Rpb24gaWYgYW1iaWd1b3VzXG4gIGlmIChuZXdUZXh0Lmxlbmd0aCA9PSAxICYmIG9sZFRleHQubGVuZ3RoID09IDEgJiYgZnJvbUxpbmUgPT0gZnJvbS5saW5lKSB7XG4gICAgd2hpbGUgKGN1dEZyb250ICYmIGN1dEZyb250ID4gZnJvbS5jaCAmJlxuICAgICAgICAgICBuZXdCb3QuY2hhckNvZGVBdChuZXdCb3QubGVuZ3RoIC0gY3V0RW5kIC0gMSkgPT0gb2xkQm90LmNoYXJDb2RlQXQob2xkQm90Lmxlbmd0aCAtIGN1dEVuZCAtIDEpKSB7XG4gICAgICBjdXRGcm9udC0tO1xuICAgICAgY3V0RW5kKys7XG4gICAgfVxuICB9XG5cbiAgbmV3VGV4dFtuZXdUZXh0Lmxlbmd0aCAtIDFdID0gbmV3Qm90LnNsaWNlKDAsIG5ld0JvdC5sZW5ndGggLSBjdXRFbmQpLnJlcGxhY2UoL15cXHUyMDBiKy8sIFwiXCIpO1xuICBuZXdUZXh0WzBdID0gbmV3VGV4dFswXS5zbGljZShjdXRGcm9udCkucmVwbGFjZSgvXFx1MjAwYiskLywgXCJcIik7XG5cbiAgdmFyIGNoRnJvbSA9IFBvcyhmcm9tTGluZSwgY3V0RnJvbnQpO1xuICB2YXIgY2hUbyA9IFBvcyh0b0xpbmUsIG9sZFRleHQubGVuZ3RoID8gbHN0KG9sZFRleHQpLmxlbmd0aCAtIGN1dEVuZCA6IDApO1xuICBpZiAobmV3VGV4dC5sZW5ndGggPiAxIHx8IG5ld1RleHRbMF0gfHwgY21wKGNoRnJvbSwgY2hUbykpIHtcbiAgICByZXBsYWNlUmFuZ2UoY20uZG9jLCBuZXdUZXh0LCBjaEZyb20sIGNoVG8sIFwiK2lucHV0XCIpO1xuICAgIHJldHVybiB0cnVlXG4gIH1cbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5lbnN1cmVQb2xsZWQgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuZm9yY2VDb21wb3NpdGlvbkVuZCgpO1xufTtcbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5mb3JjZUNvbXBvc2l0aW9uRW5kKCk7XG59O1xuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLmZvcmNlQ29tcG9zaXRpb25FbmQgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICghdGhpcy5jb21wb3NpbmcpIHsgcmV0dXJuIH1cbiAgY2xlYXJUaW1lb3V0KHRoaXMucmVhZERPTVRpbWVvdXQpO1xuICB0aGlzLmNvbXBvc2luZyA9IG51bGw7XG4gIHRoaXMudXBkYXRlRnJvbURPTSgpO1xuICB0aGlzLmRpdi5ibHVyKCk7XG4gIHRoaXMuZGl2LmZvY3VzKCk7XG59O1xuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnJlYWRGcm9tRE9NU29vbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICBpZiAodGhpcy5yZWFkRE9NVGltZW91dCAhPSBudWxsKSB7IHJldHVybiB9XG4gIHRoaXMucmVhZERPTVRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzJDEucmVhZERPTVRpbWVvdXQgPSBudWxsO1xuICAgIGlmICh0aGlzJDEuY29tcG9zaW5nKSB7XG4gICAgICBpZiAodGhpcyQxLmNvbXBvc2luZy5kb25lKSB7IHRoaXMkMS5jb21wb3NpbmcgPSBudWxsOyB9XG4gICAgICBlbHNlIHsgcmV0dXJuIH1cbiAgICB9XG4gICAgdGhpcyQxLnVwZGF0ZUZyb21ET00oKTtcbiAgfSwgODApO1xufTtcblxuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnVwZGF0ZUZyb21ET00gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKHRoaXMuY20uaXNSZWFkT25seSgpIHx8ICF0aGlzLnBvbGxDb250ZW50KCkpXG4gICAgeyBydW5Jbk9wKHRoaXMuY20sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlZ0NoYW5nZSh0aGlzJDEuY20pOyB9KTsgfVxufTtcblxuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnNldFVuZWRpdGFibGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICBub2RlLmNvbnRlbnRFZGl0YWJsZSA9IFwiZmFsc2VcIjtcbn07XG5cbkNvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5vbktleVByZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgaWYgKGUuY2hhckNvZGUgPT0gMCkgeyByZXR1cm4gfVxuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGlmICghdGhpcy5jbS5pc1JlYWRPbmx5KCkpXG4gICAgeyBvcGVyYXRpb24odGhpcy5jbSwgYXBwbHlUZXh0SW5wdXQpKHRoaXMuY20sIFN0cmluZy5mcm9tQ2hhckNvZGUoZS5jaGFyQ29kZSA9PSBudWxsID8gZS5rZXlDb2RlIDogZS5jaGFyQ29kZSksIDApOyB9XG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucmVhZE9ubHlDaGFuZ2VkID0gZnVuY3Rpb24gKHZhbCkge1xuICB0aGlzLmRpdi5jb250ZW50RWRpdGFibGUgPSBTdHJpbmcodmFsICE9IFwibm9jdXJzb3JcIik7XG59O1xuXG5Db250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUub25Db250ZXh0TWVudSA9IGZ1bmN0aW9uICgpIHt9O1xuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnJlc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7fTtcblxuQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLm5lZWRzQ29udGVudEF0dHJpYnV0ZSA9IHRydWU7XG5cbmZ1bmN0aW9uIHBvc1RvRE9NKGNtLCBwb3MpIHtcbiAgdmFyIHZpZXcgPSBmaW5kVmlld0ZvckxpbmUoY20sIHBvcy5saW5lKTtcbiAgaWYgKCF2aWV3IHx8IHZpZXcuaGlkZGVuKSB7IHJldHVybiBudWxsIH1cbiAgdmFyIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgcG9zLmxpbmUpO1xuICB2YXIgaW5mbyA9IG1hcEZyb21MaW5lVmlldyh2aWV3LCBsaW5lLCBwb3MubGluZSk7XG5cbiAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZSwgY20uZG9jLmRpcmVjdGlvbiksIHNpZGUgPSBcImxlZnRcIjtcbiAgaWYgKG9yZGVyKSB7XG4gICAgdmFyIHBhcnRQb3MgPSBnZXRCaWRpUGFydEF0KG9yZGVyLCBwb3MuY2gpO1xuICAgIHNpZGUgPSBwYXJ0UG9zICUgMiA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICB9XG4gIHZhciByZXN1bHQgPSBub2RlQW5kT2Zmc2V0SW5MaW5lTWFwKGluZm8ubWFwLCBwb3MuY2gsIHNpZGUpO1xuICByZXN1bHQub2Zmc2V0ID0gcmVzdWx0LmNvbGxhcHNlID09IFwicmlnaHRcIiA/IHJlc3VsdC5lbmQgOiByZXN1bHQuc3RhcnQ7XG4gIHJldHVybiByZXN1bHRcbn1cblxuZnVuY3Rpb24gaXNJbkd1dHRlcihub2RlKSB7XG4gIGZvciAodmFyIHNjYW4gPSBub2RlOyBzY2FuOyBzY2FuID0gc2Nhbi5wYXJlbnROb2RlKVxuICAgIHsgaWYgKC9Db2RlTWlycm9yLWd1dHRlci13cmFwcGVyLy50ZXN0KHNjYW4uY2xhc3NOYW1lKSkgeyByZXR1cm4gdHJ1ZSB9IH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmZ1bmN0aW9uIGJhZFBvcyhwb3MsIGJhZCkgeyBpZiAoYmFkKSB7IHBvcy5iYWQgPSB0cnVlOyB9IHJldHVybiBwb3MgfVxuXG5mdW5jdGlvbiBkb21UZXh0QmV0d2VlbihjbSwgZnJvbSwgdG8sIGZyb21MaW5lLCB0b0xpbmUpIHtcbiAgdmFyIHRleHQgPSBcIlwiLCBjbG9zaW5nID0gZmFsc2UsIGxpbmVTZXAgPSBjbS5kb2MubGluZVNlcGFyYXRvcigpO1xuICBmdW5jdGlvbiByZWNvZ25pemVNYXJrZXIoaWQpIHsgcmV0dXJuIGZ1bmN0aW9uIChtYXJrZXIpIHsgcmV0dXJuIG1hcmtlci5pZCA9PSBpZDsgfSB9XG4gIGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgIGlmIChjbG9zaW5nKSB7XG4gICAgICB0ZXh0ICs9IGxpbmVTZXA7XG4gICAgICBjbG9zaW5nID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGFkZFRleHQoc3RyKSB7XG4gICAgaWYgKHN0cikge1xuICAgICAgY2xvc2UoKTtcbiAgICAgIHRleHQgKz0gc3RyO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiB3YWxrKG5vZGUpIHtcbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSB7XG4gICAgICB2YXIgY21UZXh0ID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJjbS10ZXh0XCIpO1xuICAgICAgaWYgKGNtVGV4dCAhPSBudWxsKSB7XG4gICAgICAgIGFkZFRleHQoY21UZXh0IHx8IG5vZGUudGV4dENvbnRlbnQucmVwbGFjZSgvXFx1MjAwYi9nLCBcIlwiKSk7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgdmFyIG1hcmtlcklEID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJjbS1tYXJrZXJcIiksIHJhbmdlJCQxO1xuICAgICAgaWYgKG1hcmtlcklEKSB7XG4gICAgICAgIHZhciBmb3VuZCA9IGNtLmZpbmRNYXJrcyhQb3MoZnJvbUxpbmUsIDApLCBQb3ModG9MaW5lICsgMSwgMCksIHJlY29nbml6ZU1hcmtlcigrbWFya2VySUQpKTtcbiAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCAmJiAocmFuZ2UkJDEgPSBmb3VuZFswXS5maW5kKCkpKVxuICAgICAgICAgIHsgYWRkVGV4dChnZXRCZXR3ZWVuKGNtLmRvYywgcmFuZ2UkJDEuZnJvbSwgcmFuZ2UkJDEudG8pLmpvaW4obGluZVNlcCkpOyB9XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgaWYgKG5vZGUuZ2V0QXR0cmlidXRlKFwiY29udGVudGVkaXRhYmxlXCIpID09IFwiZmFsc2VcIikgeyByZXR1cm4gfVxuICAgICAgdmFyIGlzQmxvY2sgPSAvXihwcmV8ZGl2fHApJC9pLnRlc3Qobm9kZS5ub2RlTmFtZSk7XG4gICAgICBpZiAoaXNCbG9jaykgeyBjbG9zZSgpOyB9XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgeyB3YWxrKG5vZGUuY2hpbGROb2Rlc1tpXSk7IH1cbiAgICAgIGlmIChpc0Jsb2NrKSB7IGNsb3NpbmcgPSB0cnVlOyB9XG4gICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09IDMpIHtcbiAgICAgIGFkZFRleHQobm9kZS5ub2RlVmFsdWUpO1xuICAgIH1cbiAgfVxuICBmb3IgKDs7KSB7XG4gICAgd2Fsayhmcm9tKTtcbiAgICBpZiAoZnJvbSA9PSB0bykgeyBicmVhayB9XG4gICAgZnJvbSA9IGZyb20ubmV4dFNpYmxpbmc7XG4gIH1cbiAgcmV0dXJuIHRleHRcbn1cblxuZnVuY3Rpb24gZG9tVG9Qb3MoY20sIG5vZGUsIG9mZnNldCkge1xuICB2YXIgbGluZU5vZGU7XG4gIGlmIChub2RlID09IGNtLmRpc3BsYXkubGluZURpdikge1xuICAgIGxpbmVOb2RlID0gY20uZGlzcGxheS5saW5lRGl2LmNoaWxkTm9kZXNbb2Zmc2V0XTtcbiAgICBpZiAoIWxpbmVOb2RlKSB7IHJldHVybiBiYWRQb3MoY20uY2xpcFBvcyhQb3MoY20uZGlzcGxheS52aWV3VG8gLSAxKSksIHRydWUpIH1cbiAgICBub2RlID0gbnVsbDsgb2Zmc2V0ID0gMDtcbiAgfSBlbHNlIHtcbiAgICBmb3IgKGxpbmVOb2RlID0gbm9kZTs7IGxpbmVOb2RlID0gbGluZU5vZGUucGFyZW50Tm9kZSkge1xuICAgICAgaWYgKCFsaW5lTm9kZSB8fCBsaW5lTm9kZSA9PSBjbS5kaXNwbGF5LmxpbmVEaXYpIHsgcmV0dXJuIG51bGwgfVxuICAgICAgaWYgKGxpbmVOb2RlLnBhcmVudE5vZGUgJiYgbGluZU5vZGUucGFyZW50Tm9kZSA9PSBjbS5kaXNwbGF5LmxpbmVEaXYpIHsgYnJlYWsgfVxuICAgIH1cbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRpc3BsYXkudmlldy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBsaW5lVmlldyA9IGNtLmRpc3BsYXkudmlld1tpXTtcbiAgICBpZiAobGluZVZpZXcubm9kZSA9PSBsaW5lTm9kZSlcbiAgICAgIHsgcmV0dXJuIGxvY2F0ZU5vZGVJbkxpbmVWaWV3KGxpbmVWaWV3LCBub2RlLCBvZmZzZXQpIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBsb2NhdGVOb2RlSW5MaW5lVmlldyhsaW5lVmlldywgbm9kZSwgb2Zmc2V0KSB7XG4gIHZhciB3cmFwcGVyID0gbGluZVZpZXcudGV4dC5maXJzdENoaWxkLCBiYWQgPSBmYWxzZTtcbiAgaWYgKCFub2RlIHx8ICFjb250YWlucyh3cmFwcGVyLCBub2RlKSkgeyByZXR1cm4gYmFkUG9zKFBvcyhsaW5lTm8obGluZVZpZXcubGluZSksIDApLCB0cnVlKSB9XG4gIGlmIChub2RlID09IHdyYXBwZXIpIHtcbiAgICBiYWQgPSB0cnVlO1xuICAgIG5vZGUgPSB3cmFwcGVyLmNoaWxkTm9kZXNbb2Zmc2V0XTtcbiAgICBvZmZzZXQgPSAwO1xuICAgIGlmICghbm9kZSkge1xuICAgICAgdmFyIGxpbmUgPSBsaW5lVmlldy5yZXN0ID8gbHN0KGxpbmVWaWV3LnJlc3QpIDogbGluZVZpZXcubGluZTtcbiAgICAgIHJldHVybiBiYWRQb3MoUG9zKGxpbmVObyhsaW5lKSwgbGluZS50ZXh0Lmxlbmd0aCksIGJhZClcbiAgICB9XG4gIH1cblxuICB2YXIgdGV4dE5vZGUgPSBub2RlLm5vZGVUeXBlID09IDMgPyBub2RlIDogbnVsbCwgdG9wTm9kZSA9IG5vZGU7XG4gIGlmICghdGV4dE5vZGUgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxICYmIG5vZGUuZmlyc3RDaGlsZC5ub2RlVHlwZSA9PSAzKSB7XG4gICAgdGV4dE5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7XG4gICAgaWYgKG9mZnNldCkgeyBvZmZzZXQgPSB0ZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoOyB9XG4gIH1cbiAgd2hpbGUgKHRvcE5vZGUucGFyZW50Tm9kZSAhPSB3cmFwcGVyKSB7IHRvcE5vZGUgPSB0b3BOb2RlLnBhcmVudE5vZGU7IH1cbiAgdmFyIG1lYXN1cmUgPSBsaW5lVmlldy5tZWFzdXJlLCBtYXBzID0gbWVhc3VyZS5tYXBzO1xuXG4gIGZ1bmN0aW9uIGZpbmQodGV4dE5vZGUsIHRvcE5vZGUsIG9mZnNldCkge1xuICAgIGZvciAodmFyIGkgPSAtMTsgaSA8IChtYXBzID8gbWFwcy5sZW5ndGggOiAwKTsgaSsrKSB7XG4gICAgICB2YXIgbWFwJCQxID0gaSA8IDAgPyBtZWFzdXJlLm1hcCA6IG1hcHNbaV07XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1hcCQkMS5sZW5ndGg7IGogKz0gMykge1xuICAgICAgICB2YXIgY3VyTm9kZSA9IG1hcCQkMVtqICsgMl07XG4gICAgICAgIGlmIChjdXJOb2RlID09IHRleHROb2RlIHx8IGN1ck5vZGUgPT0gdG9wTm9kZSkge1xuICAgICAgICAgIHZhciBsaW5lID0gbGluZU5vKGkgPCAwID8gbGluZVZpZXcubGluZSA6IGxpbmVWaWV3LnJlc3RbaV0pO1xuICAgICAgICAgIHZhciBjaCA9IG1hcCQkMVtqXSArIG9mZnNldDtcbiAgICAgICAgICBpZiAob2Zmc2V0IDwgMCB8fCBjdXJOb2RlICE9IHRleHROb2RlKSB7IGNoID0gbWFwJCQxW2ogKyAob2Zmc2V0ID8gMSA6IDApXTsgfVxuICAgICAgICAgIHJldHVybiBQb3MobGluZSwgY2gpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgdmFyIGZvdW5kID0gZmluZCh0ZXh0Tm9kZSwgdG9wTm9kZSwgb2Zmc2V0KTtcbiAgaWYgKGZvdW5kKSB7IHJldHVybiBiYWRQb3MoZm91bmQsIGJhZCkgfVxuXG4gIC8vIEZJWE1FIHRoaXMgaXMgYWxsIHJlYWxseSBzaGFreS4gbWlnaHQgaGFuZGxlIHRoZSBmZXcgY2FzZXMgaXQgbmVlZHMgdG8gaGFuZGxlLCBidXQgbGlrZWx5IHRvIGNhdXNlIHByb2JsZW1zXG4gIGZvciAodmFyIGFmdGVyID0gdG9wTm9kZS5uZXh0U2libGluZywgZGlzdCA9IHRleHROb2RlID8gdGV4dE5vZGUubm9kZVZhbHVlLmxlbmd0aCAtIG9mZnNldCA6IDA7IGFmdGVyOyBhZnRlciA9IGFmdGVyLm5leHRTaWJsaW5nKSB7XG4gICAgZm91bmQgPSBmaW5kKGFmdGVyLCBhZnRlci5maXJzdENoaWxkLCAwKTtcbiAgICBpZiAoZm91bmQpXG4gICAgICB7IHJldHVybiBiYWRQb3MoUG9zKGZvdW5kLmxpbmUsIGZvdW5kLmNoIC0gZGlzdCksIGJhZCkgfVxuICAgIGVsc2VcbiAgICAgIHsgZGlzdCArPSBhZnRlci50ZXh0Q29udGVudC5sZW5ndGg7IH1cbiAgfVxuICBmb3IgKHZhciBiZWZvcmUgPSB0b3BOb2RlLnByZXZpb3VzU2libGluZywgZGlzdCQxID0gb2Zmc2V0OyBiZWZvcmU7IGJlZm9yZSA9IGJlZm9yZS5wcmV2aW91c1NpYmxpbmcpIHtcbiAgICBmb3VuZCA9IGZpbmQoYmVmb3JlLCBiZWZvcmUuZmlyc3RDaGlsZCwgLTEpO1xuICAgIGlmIChmb3VuZClcbiAgICAgIHsgcmV0dXJuIGJhZFBvcyhQb3MoZm91bmQubGluZSwgZm91bmQuY2ggKyBkaXN0JDEpLCBiYWQpIH1cbiAgICBlbHNlXG4gICAgICB7IGRpc3QkMSArPSBiZWZvcmUudGV4dENvbnRlbnQubGVuZ3RoOyB9XG4gIH1cbn1cblxuLy8gVEVYVEFSRUEgSU5QVVQgU1RZTEVcblxudmFyIFRleHRhcmVhSW5wdXQgPSBmdW5jdGlvbihjbSkge1xuICB0aGlzLmNtID0gY207XG4gIC8vIFNlZSBpbnB1dC5wb2xsIGFuZCBpbnB1dC5yZXNldFxuICB0aGlzLnByZXZJbnB1dCA9IFwiXCI7XG5cbiAgLy8gRmxhZyB0aGF0IGluZGljYXRlcyB3aGV0aGVyIHdlIGV4cGVjdCBpbnB1dCB0byBhcHBlYXIgcmVhbCBzb29uXG4gIC8vIG5vdyAoYWZ0ZXIgc29tZSBldmVudCBsaWtlICdrZXlwcmVzcycgb3IgJ2lucHV0JykgYW5kIGFyZVxuICAvLyBwb2xsaW5nIGludGVuc2l2ZWx5LlxuICB0aGlzLnBvbGxpbmdGYXN0ID0gZmFsc2U7XG4gIC8vIFNlbGYtcmVzZXR0aW5nIHRpbWVvdXQgZm9yIHRoZSBwb2xsZXJcbiAgdGhpcy5wb2xsaW5nID0gbmV3IERlbGF5ZWQoKTtcbiAgLy8gVHJhY2tzIHdoZW4gaW5wdXQucmVzZXQgaGFzIHB1bnRlZCB0byBqdXN0IHB1dHRpbmcgYSBzaG9ydFxuICAvLyBzdHJpbmcgaW50byB0aGUgdGV4dGFyZWEgaW5zdGVhZCBvZiB0aGUgZnVsbCBzZWxlY3Rpb24uXG4gIHRoaXMuaW5hY2N1cmF0ZVNlbGVjdGlvbiA9IGZhbHNlO1xuICAvLyBVc2VkIHRvIHdvcmsgYXJvdW5kIElFIGlzc3VlIHdpdGggc2VsZWN0aW9uIGJlaW5nIGZvcmdvdHRlbiB3aGVuIGZvY3VzIG1vdmVzIGF3YXkgZnJvbSB0ZXh0YXJlYVxuICB0aGlzLmhhc1NlbGVjdGlvbiA9IGZhbHNlO1xuICB0aGlzLmNvbXBvc2luZyA9IG51bGw7XG59O1xuXG5UZXh0YXJlYUlucHV0LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGRpc3BsYXkpIHtcbiAgICB2YXIgdGhpcyQxID0gdGhpcztcblxuICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IHRoaXMuY207XG5cbiAgLy8gV3JhcHMgYW5kIGhpZGVzIGlucHV0IHRleHRhcmVhXG4gIHZhciBkaXYgPSB0aGlzLndyYXBwZXIgPSBoaWRkZW5UZXh0YXJlYSgpO1xuICAvLyBUaGUgc2VtaWhpZGRlbiB0ZXh0YXJlYSB0aGF0IGlzIGZvY3VzZWQgd2hlbiB0aGUgZWRpdG9yIGlzXG4gIC8vIGZvY3VzZWQsIGFuZCByZWNlaXZlcyBpbnB1dC5cbiAgdmFyIHRlID0gdGhpcy50ZXh0YXJlYSA9IGRpdi5maXJzdENoaWxkO1xuICBkaXNwbGF5LndyYXBwZXIuaW5zZXJ0QmVmb3JlKGRpdiwgZGlzcGxheS53cmFwcGVyLmZpcnN0Q2hpbGQpO1xuXG4gIC8vIE5lZWRlZCB0byBoaWRlIGJpZyBibHVlIGJsaW5raW5nIGN1cnNvciBvbiBNb2JpbGUgU2FmYXJpIChkb2Vzbid0IHNlZW0gdG8gd29yayBpbiBpT1MgOCBhbnltb3JlKVxuICBpZiAoaW9zKSB7IHRlLnN0eWxlLndpZHRoID0gXCIwcHhcIjsgfVxuXG4gIG9uKHRlLCBcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5ICYmIHRoaXMkMS5oYXNTZWxlY3Rpb24pIHsgdGhpcyQxLmhhc1NlbGVjdGlvbiA9IG51bGw7IH1cbiAgICBpbnB1dC5wb2xsKCk7XG4gIH0pO1xuXG4gIG9uKHRlLCBcInBhc3RlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSB8fCBoYW5kbGVQYXN0ZShlLCBjbSkpIHsgcmV0dXJuIH1cblxuICAgIGNtLnN0YXRlLnBhc3RlSW5jb21pbmcgPSB0cnVlO1xuICAgIGlucHV0LmZhc3RQb2xsKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHByZXBhcmVDb3B5Q3V0KGUpIHtcbiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpKSB7IHJldHVybiB9XG4gICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICAgIHNldExhc3RDb3BpZWQoe2xpbmVXaXNlOiBmYWxzZSwgdGV4dDogY20uZ2V0U2VsZWN0aW9ucygpfSk7XG4gICAgICBpZiAoaW5wdXQuaW5hY2N1cmF0ZVNlbGVjdGlvbikge1xuICAgICAgICBpbnB1dC5wcmV2SW5wdXQgPSBcIlwiO1xuICAgICAgICBpbnB1dC5pbmFjY3VyYXRlU2VsZWN0aW9uID0gZmFsc2U7XG4gICAgICAgIHRlLnZhbHVlID0gbGFzdENvcGllZC50ZXh0LmpvaW4oXCJcXG5cIik7XG4gICAgICAgIHNlbGVjdElucHV0KHRlKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFjbS5vcHRpb25zLmxpbmVXaXNlQ29weUN1dCkge1xuICAgICAgcmV0dXJuXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciByYW5nZXMgPSBjb3B5YWJsZVJhbmdlcyhjbSk7XG4gICAgICBzZXRMYXN0Q29waWVkKHtsaW5lV2lzZTogdHJ1ZSwgdGV4dDogcmFuZ2VzLnRleHR9KTtcbiAgICAgIGlmIChlLnR5cGUgPT0gXCJjdXRcIikge1xuICAgICAgICBjbS5zZXRTZWxlY3Rpb25zKHJhbmdlcy5yYW5nZXMsIG51bGwsIHNlbF9kb250U2Nyb2xsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlucHV0LnByZXZJbnB1dCA9IFwiXCI7XG4gICAgICAgIHRlLnZhbHVlID0gcmFuZ2VzLnRleHQuam9pbihcIlxcblwiKTtcbiAgICAgICAgc2VsZWN0SW5wdXQodGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZS50eXBlID09IFwiY3V0XCIpIHsgY20uc3RhdGUuY3V0SW5jb21pbmcgPSB0cnVlOyB9XG4gIH1cbiAgb24odGUsIFwiY3V0XCIsIHByZXBhcmVDb3B5Q3V0KTtcbiAgb24odGUsIFwiY29weVwiLCBwcmVwYXJlQ29weUN1dCk7XG5cbiAgb24oZGlzcGxheS5zY3JvbGxlciwgXCJwYXN0ZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChldmVudEluV2lkZ2V0KGRpc3BsYXksIGUpIHx8IHNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyByZXR1cm4gfVxuICAgIGNtLnN0YXRlLnBhc3RlSW5jb21pbmcgPSB0cnVlO1xuICAgIGlucHV0LmZvY3VzKCk7XG4gIH0pO1xuXG4gIC8vIFByZXZlbnQgbm9ybWFsIHNlbGVjdGlvbiBpbiB0aGUgZWRpdG9yICh3ZSBoYW5kbGUgb3VyIG93bilcbiAgb24oZGlzcGxheS5saW5lU3BhY2UsIFwic2VsZWN0c3RhcnRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIWV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkpIHsgZV9wcmV2ZW50RGVmYXVsdChlKTsgfVxuICB9KTtcblxuICBvbih0ZSwgXCJjb21wb3NpdGlvbnN0YXJ0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc3RhcnQgPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgIGlmIChpbnB1dC5jb21wb3NpbmcpIHsgaW5wdXQuY29tcG9zaW5nLnJhbmdlLmNsZWFyKCk7IH1cbiAgICBpbnB1dC5jb21wb3NpbmcgPSB7XG4gICAgICBzdGFydDogc3RhcnQsXG4gICAgICByYW5nZTogY20ubWFya1RleHQoc3RhcnQsIGNtLmdldEN1cnNvcihcInRvXCIpLCB7Y2xhc3NOYW1lOiBcIkNvZGVNaXJyb3ItY29tcG9zaW5nXCJ9KVxuICAgIH07XG4gIH0pO1xuICBvbih0ZSwgXCJjb21wb3NpdGlvbmVuZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGlucHV0LmNvbXBvc2luZykge1xuICAgICAgaW5wdXQucG9sbCgpO1xuICAgICAgaW5wdXQuY29tcG9zaW5nLnJhbmdlLmNsZWFyKCk7XG4gICAgICBpbnB1dC5jb21wb3NpbmcgPSBudWxsO1xuICAgIH1cbiAgfSk7XG59O1xuXG5UZXh0YXJlYUlucHV0LnByb3RvdHlwZS5wcmVwYXJlU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAvLyBSZWRyYXcgdGhlIHNlbGVjdGlvbiBhbmQvb3IgY3Vyc29yXG4gIHZhciBjbSA9IHRoaXMuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG4gIHZhciByZXN1bHQgPSBwcmVwYXJlU2VsZWN0aW9uKGNtKTtcblxuICAvLyBNb3ZlIHRoZSBoaWRkZW4gdGV4dGFyZWEgbmVhciB0aGUgY3Vyc29yIHRvIHByZXZlbnQgc2Nyb2xsaW5nIGFydGlmYWN0c1xuICBpZiAoY20ub3B0aW9ucy5tb3ZlSW5wdXRXaXRoQ3Vyc29yKSB7XG4gICAgdmFyIGhlYWRQb3MgPSBjdXJzb3JDb29yZHMoY20sIGRvYy5zZWwucHJpbWFyeSgpLmhlYWQsIFwiZGl2XCIpO1xuICAgIHZhciB3cmFwT2ZmID0gZGlzcGxheS53cmFwcGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBsaW5lT2ZmID0gZGlzcGxheS5saW5lRGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJlc3VsdC50ZVRvcCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQgLSAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkUG9zLnRvcCArIGxpbmVPZmYudG9wIC0gd3JhcE9mZi50b3ApKTtcbiAgICByZXN1bHQudGVMZWZ0ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oZGlzcGxheS53cmFwcGVyLmNsaWVudFdpZHRoIC0gMTAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRQb3MubGVmdCArIGxpbmVPZmYubGVmdCAtIHdyYXBPZmYubGVmdCkpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdFxufTtcblxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUuc2hvd1NlbGVjdGlvbiA9IGZ1bmN0aW9uIChkcmF3bikge1xuICB2YXIgY20gPSB0aGlzLmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoZGlzcGxheS5jdXJzb3JEaXYsIGRyYXduLmN1cnNvcnMpO1xuICByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5LnNlbGVjdGlvbkRpdiwgZHJhd24uc2VsZWN0aW9uKTtcbiAgaWYgKGRyYXduLnRlVG9wICE9IG51bGwpIHtcbiAgICB0aGlzLndyYXBwZXIuc3R5bGUudG9wID0gZHJhd24udGVUb3AgKyBcInB4XCI7XG4gICAgdGhpcy53cmFwcGVyLnN0eWxlLmxlZnQgPSBkcmF3bi50ZUxlZnQgKyBcInB4XCI7XG4gIH1cbn07XG5cbi8vIFJlc2V0IHRoZSBpbnB1dCB0byBjb3JyZXNwb25kIHRvIHRoZSBzZWxlY3Rpb24gKG9yIHRvIGJlIGVtcHR5LFxuLy8gd2hlbiBub3QgdHlwaW5nIGFuZCBub3RoaW5nIGlzIHNlbGVjdGVkKVxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAodHlwaW5nKSB7XG4gIGlmICh0aGlzLmNvbnRleHRNZW51UGVuZGluZyB8fCB0aGlzLmNvbXBvc2luZykgeyByZXR1cm4gfVxuICB2YXIgbWluaW1hbCwgc2VsZWN0ZWQsIGNtID0gdGhpcy5jbSwgZG9jID0gY20uZG9jO1xuICBpZiAoY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgIHRoaXMucHJldklucHV0ID0gXCJcIjtcbiAgICB2YXIgcmFuZ2UkJDEgPSBkb2Muc2VsLnByaW1hcnkoKTtcbiAgICBtaW5pbWFsID0gaGFzQ29weUV2ZW50ICYmXG4gICAgICAocmFuZ2UkJDEudG8oKS5saW5lIC0gcmFuZ2UkJDEuZnJvbSgpLmxpbmUgPiAxMDAgfHwgKHNlbGVjdGVkID0gY20uZ2V0U2VsZWN0aW9uKCkpLmxlbmd0aCA+IDEwMDApO1xuICAgIHZhciBjb250ZW50ID0gbWluaW1hbCA/IFwiLVwiIDogc2VsZWN0ZWQgfHwgY20uZ2V0U2VsZWN0aW9uKCk7XG4gICAgdGhpcy50ZXh0YXJlYS52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHsgc2VsZWN0SW5wdXQodGhpcy50ZXh0YXJlYSk7IH1cbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KSB7IHRoaXMuaGFzU2VsZWN0aW9uID0gY29udGVudDsgfVxuICB9IGVsc2UgaWYgKCF0eXBpbmcpIHtcbiAgICB0aGlzLnByZXZJbnB1dCA9IHRoaXMudGV4dGFyZWEudmFsdWUgPSBcIlwiO1xuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkpIHsgdGhpcy5oYXNTZWxlY3Rpb24gPSBudWxsOyB9XG4gIH1cbiAgdGhpcy5pbmFjY3VyYXRlU2VsZWN0aW9uID0gbWluaW1hbDtcbn07XG5cblRleHRhcmVhSW5wdXQucHJvdG90eXBlLmdldEZpZWxkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50ZXh0YXJlYSB9O1xuXG5UZXh0YXJlYUlucHV0LnByb3RvdHlwZS5zdXBwb3J0c1RvdWNoID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2UgfTtcblxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICh0aGlzLmNtLm9wdGlvbnMucmVhZE9ubHkgIT0gXCJub2N1cnNvclwiICYmICghbW9iaWxlIHx8IGFjdGl2ZUVsdCgpICE9IHRoaXMudGV4dGFyZWEpKSB7XG4gICAgdHJ5IHsgdGhpcy50ZXh0YXJlYS5mb2N1cygpOyB9XG4gICAgY2F0Y2ggKGUpIHt9IC8vIElFOCB3aWxsIHRocm93IGlmIHRoZSB0ZXh0YXJlYSBpcyBkaXNwbGF5OiBub25lIG9yIG5vdCBpbiBET01cbiAgfVxufTtcblxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUuYmx1ciA9IGZ1bmN0aW9uICgpIHsgdGhpcy50ZXh0YXJlYS5ibHVyKCk7IH07XG5cblRleHRhcmVhSW5wdXQucHJvdG90eXBlLnJlc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMud3JhcHBlci5zdHlsZS50b3AgPSB0aGlzLndyYXBwZXIuc3R5bGUubGVmdCA9IDA7XG59O1xuXG5UZXh0YXJlYUlucHV0LnByb3RvdHlwZS5yZWNlaXZlZEZvY3VzID0gZnVuY3Rpb24gKCkgeyB0aGlzLnNsb3dQb2xsKCk7IH07XG5cbi8vIFBvbGwgZm9yIGlucHV0IGNoYW5nZXMsIHVzaW5nIHRoZSBub3JtYWwgcmF0ZSBvZiBwb2xsaW5nLiBUaGlzXG4vLyBydW5zIGFzIGxvbmcgYXMgdGhlIGVkaXRvciBpcyBmb2N1c2VkLlxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUuc2xvd1BvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRoaXMkMSA9IHRoaXM7XG5cbiAgaWYgKHRoaXMucG9sbGluZ0Zhc3QpIHsgcmV0dXJuIH1cbiAgdGhpcy5wb2xsaW5nLnNldCh0aGlzLmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcyQxLnBvbGwoKTtcbiAgICBpZiAodGhpcyQxLmNtLnN0YXRlLmZvY3VzZWQpIHsgdGhpcyQxLnNsb3dQb2xsKCk7IH1cbiAgfSk7XG59O1xuXG4vLyBXaGVuIGFuIGV2ZW50IGhhcyBqdXN0IGNvbWUgaW4gdGhhdCBpcyBsaWtlbHkgdG8gYWRkIG9yIGNoYW5nZVxuLy8gc29tZXRoaW5nIGluIHRoZSBpbnB1dCB0ZXh0YXJlYSwgd2UgcG9sbCBmYXN0ZXIsIHRvIGVuc3VyZSB0aGF0XG4vLyB0aGUgY2hhbmdlIGFwcGVhcnMgb24gdGhlIHNjcmVlbiBxdWlja2x5LlxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUuZmFzdFBvbGwgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBtaXNzZWQgPSBmYWxzZSwgaW5wdXQgPSB0aGlzO1xuICBpbnB1dC5wb2xsaW5nRmFzdCA9IHRydWU7XG4gIGZ1bmN0aW9uIHAoKSB7XG4gICAgdmFyIGNoYW5nZWQgPSBpbnB1dC5wb2xsKCk7XG4gICAgaWYgKCFjaGFuZ2VkICYmICFtaXNzZWQpIHttaXNzZWQgPSB0cnVlOyBpbnB1dC5wb2xsaW5nLnNldCg2MCwgcCk7fVxuICAgIGVsc2Uge2lucHV0LnBvbGxpbmdGYXN0ID0gZmFsc2U7IGlucHV0LnNsb3dQb2xsKCk7fVxuICB9XG4gIGlucHV0LnBvbGxpbmcuc2V0KDIwLCBwKTtcbn07XG5cbi8vIFJlYWQgaW5wdXQgZnJvbSB0aGUgdGV4dGFyZWEsIGFuZCB1cGRhdGUgdGhlIGRvY3VtZW50IHRvIG1hdGNoLlxuLy8gV2hlbiBzb21ldGhpbmcgaXMgc2VsZWN0ZWQsIGl0IGlzIHByZXNlbnQgaW4gdGhlIHRleHRhcmVhLCBhbmRcbi8vIHNlbGVjdGVkICh1bmxlc3MgaXQgaXMgaHVnZSwgaW4gd2hpY2ggY2FzZSBhIHBsYWNlaG9sZGVyIGlzXG4vLyB1c2VkKS4gV2hlbiBub3RoaW5nIGlzIHNlbGVjdGVkLCB0aGUgY3Vyc29yIHNpdHMgYWZ0ZXIgcHJldmlvdXNseVxuLy8gc2VlbiB0ZXh0IChjYW4gYmUgZW1wdHkpLCB3aGljaCBpcyBzdG9yZWQgaW4gcHJldklucHV0ICh3ZSBtdXN0XG4vLyBub3QgcmVzZXQgdGhlIHRleHRhcmVhIHdoZW4gdHlwaW5nLCBiZWNhdXNlIHRoYXQgYnJlYWtzIElNRSkuXG5UZXh0YXJlYUlucHV0LnByb3RvdHlwZS5wb2xsID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aGlzJDEgPSB0aGlzO1xuXG4gIHZhciBjbSA9IHRoaXMuY20sIGlucHV0ID0gdGhpcy50ZXh0YXJlYSwgcHJldklucHV0ID0gdGhpcy5wcmV2SW5wdXQ7XG4gIC8vIFNpbmNlIHRoaXMgaXMgY2FsbGVkIGEgKmxvdCosIHRyeSB0byBiYWlsIG91dCBhcyBjaGVhcGx5IGFzXG4gIC8vIHBvc3NpYmxlIHdoZW4gaXQgaXMgY2xlYXIgdGhhdCBub3RoaW5nIGhhcHBlbmVkLiBoYXNTZWxlY3Rpb25cbiAgLy8gd2lsbCBiZSB0aGUgY2FzZSB3aGVuIHRoZXJlIGlzIGEgbG90IG9mIHRleHQgaW4gdGhlIHRleHRhcmVhLFxuICAvLyBpbiB3aGljaCBjYXNlIHJlYWRpbmcgaXRzIHZhbHVlIHdvdWxkIGJlIGV4cGVuc2l2ZS5cbiAgaWYgKHRoaXMuY29udGV4dE1lbnVQZW5kaW5nIHx8ICFjbS5zdGF0ZS5mb2N1c2VkIHx8XG4gICAgICAoaGFzU2VsZWN0aW9uKGlucHV0KSAmJiAhcHJldklucHV0ICYmICF0aGlzLmNvbXBvc2luZykgfHxcbiAgICAgIGNtLmlzUmVhZE9ubHkoKSB8fCBjbS5vcHRpb25zLmRpc2FibGVJbnB1dCB8fCBjbS5zdGF0ZS5rZXlTZXEpXG4gICAgeyByZXR1cm4gZmFsc2UgfVxuXG4gIHZhciB0ZXh0ID0gaW5wdXQudmFsdWU7XG4gIC8vIElmIG5vdGhpbmcgY2hhbmdlZCwgYmFpbC5cbiAgaWYgKHRleHQgPT0gcHJldklucHV0ICYmICFjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7IHJldHVybiBmYWxzZSB9XG4gIC8vIFdvcmsgYXJvdW5kIG5vbnNlbnNpY2FsIHNlbGVjdGlvbiByZXNldHRpbmcgaW4gSUU5LzEwLCBhbmRcbiAgLy8gaW5leHBsaWNhYmxlIGFwcGVhcmFuY2Ugb2YgcHJpdmF0ZSBhcmVhIHVuaWNvZGUgY2hhcmFjdGVycyBvblxuICAvLyBzb21lIGtleSBjb21ib3MgaW4gTWFjICgjMjY4OSkuXG4gIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkgJiYgdGhpcy5oYXNTZWxlY3Rpb24gPT09IHRleHQgfHxcbiAgICAgIG1hYyAmJiAvW1xcdWY3MDAtXFx1ZjdmZl0vLnRlc3QodGV4dCkpIHtcbiAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBpZiAoY20uZG9jLnNlbCA9PSBjbS5kaXNwbGF5LnNlbEZvckNvbnRleHRNZW51KSB7XG4gICAgdmFyIGZpcnN0ID0gdGV4dC5jaGFyQ29kZUF0KDApO1xuICAgIGlmIChmaXJzdCA9PSAweDIwMGIgJiYgIXByZXZJbnB1dCkgeyBwcmV2SW5wdXQgPSBcIlxcdTIwMGJcIjsgfVxuICAgIGlmIChmaXJzdCA9PSAweDIxZGEpIHsgdGhpcy5yZXNldCgpOyByZXR1cm4gdGhpcy5jbS5leGVjQ29tbWFuZChcInVuZG9cIikgfVxuICB9XG4gIC8vIEZpbmQgdGhlIHBhcnQgb2YgdGhlIGlucHV0IHRoYXQgaXMgYWN0dWFsbHkgbmV3XG4gIHZhciBzYW1lID0gMCwgbCA9IE1hdGgubWluKHByZXZJbnB1dC5sZW5ndGgsIHRleHQubGVuZ3RoKTtcbiAgd2hpbGUgKHNhbWUgPCBsICYmIHByZXZJbnB1dC5jaGFyQ29kZUF0KHNhbWUpID09IHRleHQuY2hhckNvZGVBdChzYW1lKSkgeyArK3NhbWU7IH1cblxuICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7XG4gICAgYXBwbHlUZXh0SW5wdXQoY20sIHRleHQuc2xpY2Uoc2FtZSksIHByZXZJbnB1dC5sZW5ndGggLSBzYW1lLFxuICAgICAgICAgICAgICAgICAgIG51bGwsIHRoaXMkMS5jb21wb3NpbmcgPyBcIipjb21wb3NlXCIgOiBudWxsKTtcblxuICAgIC8vIERvbid0IGxlYXZlIGxvbmcgdGV4dCBpbiB0aGUgdGV4dGFyZWEsIHNpbmNlIGl0IG1ha2VzIGZ1cnRoZXIgcG9sbGluZyBzbG93XG4gICAgaWYgKHRleHQubGVuZ3RoID4gMTAwMCB8fCB0ZXh0LmluZGV4T2YoXCJcXG5cIikgPiAtMSkgeyBpbnB1dC52YWx1ZSA9IHRoaXMkMS5wcmV2SW5wdXQgPSBcIlwiOyB9XG4gICAgZWxzZSB7IHRoaXMkMS5wcmV2SW5wdXQgPSB0ZXh0OyB9XG5cbiAgICBpZiAodGhpcyQxLmNvbXBvc2luZykge1xuICAgICAgdGhpcyQxLmNvbXBvc2luZy5yYW5nZS5jbGVhcigpO1xuICAgICAgdGhpcyQxLmNvbXBvc2luZy5yYW5nZSA9IGNtLm1hcmtUZXh0KHRoaXMkMS5jb21wb3Npbmcuc3RhcnQsIGNtLmdldEN1cnNvcihcInRvXCIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2xhc3NOYW1lOiBcIkNvZGVNaXJyb3ItY29tcG9zaW5nXCJ9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdHJ1ZVxufTtcblxuVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUuZW5zdXJlUG9sbGVkID0gZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5wb2xsaW5nRmFzdCAmJiB0aGlzLnBvbGwoKSkgeyB0aGlzLnBvbGxpbmdGYXN0ID0gZmFsc2U7IH1cbn07XG5cblRleHRhcmVhSW5wdXQucHJvdG90eXBlLm9uS2V5UHJlc3MgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkpIHsgdGhpcy5oYXNTZWxlY3Rpb24gPSBudWxsOyB9XG4gIHRoaXMuZmFzdFBvbGwoKTtcbn07XG5cblRleHRhcmVhSW5wdXQucHJvdG90eXBlLm9uQ29udGV4dE1lbnUgPSBmdW5jdGlvbiAoZSkge1xuICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheSwgdGUgPSBpbnB1dC50ZXh0YXJlYTtcbiAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSksIHNjcm9sbFBvcyA9IGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wO1xuICBpZiAoIXBvcyB8fCBwcmVzdG8pIHsgcmV0dXJuIH0gLy8gT3BlcmEgaXMgZGlmZmljdWx0LlxuXG4gIC8vIFJlc2V0IHRoZSBjdXJyZW50IHRleHQgc2VsZWN0aW9uIG9ubHkgaWYgdGhlIGNsaWNrIGlzIGRvbmUgb3V0c2lkZSBvZiB0aGUgc2VsZWN0aW9uXG4gIC8vIGFuZCAncmVzZXRTZWxlY3Rpb25PbkNvbnRleHRNZW51JyBvcHRpb24gaXMgdHJ1ZS5cbiAgdmFyIHJlc2V0ID0gY20ub3B0aW9ucy5yZXNldFNlbGVjdGlvbk9uQ29udGV4dE1lbnU7XG4gIGlmIChyZXNldCAmJiBjbS5kb2Muc2VsLmNvbnRhaW5zKHBvcykgPT0gLTEpXG4gICAgeyBvcGVyYXRpb24oY20sIHNldFNlbGVjdGlvbikoY20uZG9jLCBzaW1wbGVTZWxlY3Rpb24ocG9zKSwgc2VsX2RvbnRTY3JvbGwpOyB9XG5cbiAgdmFyIG9sZENTUyA9IHRlLnN0eWxlLmNzc1RleHQsIG9sZFdyYXBwZXJDU1MgPSBpbnB1dC53cmFwcGVyLnN0eWxlLmNzc1RleHQ7XG4gIGlucHV0LndyYXBwZXIuc3R5bGUuY3NzVGV4dCA9IFwicG9zaXRpb246IGFic29sdXRlXCI7XG4gIHZhciB3cmFwcGVyQm94ID0gaW5wdXQud3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgdGUuc3R5bGUuY3NzVGV4dCA9IFwicG9zaXRpb246IGFic29sdXRlOyB3aWR0aDogMzBweDsgaGVpZ2h0OiAzMHB4O1xcbiAgICAgIHRvcDogXCIgKyAoZS5jbGllbnRZIC0gd3JhcHBlckJveC50b3AgLSA1KSArIFwicHg7IGxlZnQ6IFwiICsgKGUuY2xpZW50WCAtIHdyYXBwZXJCb3gubGVmdCAtIDUpICsgXCJweDtcXG4gICAgICB6LWluZGV4OiAxMDAwOyBiYWNrZ3JvdW5kOiBcIiArIChpZSA/IFwicmdiYSgyNTUsIDI1NSwgMjU1LCAuMDUpXCIgOiBcInRyYW5zcGFyZW50XCIpICsgXCI7XFxuICAgICAgb3V0bGluZTogbm9uZTsgYm9yZGVyLXdpZHRoOiAwOyBvdXRsaW5lOiBub25lOyBvdmVyZmxvdzogaGlkZGVuOyBvcGFjaXR5OiAuMDU7IGZpbHRlcjogYWxwaGEob3BhY2l0eT01KTtcIjtcbiAgdmFyIG9sZFNjcm9sbFk7XG4gIGlmICh3ZWJraXQpIHsgb2xkU2Nyb2xsWSA9IHdpbmRvdy5zY3JvbGxZOyB9IC8vIFdvcmsgYXJvdW5kIENocm9tZSBpc3N1ZSAoIzI3MTIpXG4gIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTtcbiAgaWYgKHdlYmtpdCkgeyB3aW5kb3cuc2Nyb2xsVG8obnVsbCwgb2xkU2Nyb2xsWSk7IH1cbiAgZGlzcGxheS5pbnB1dC5yZXNldCgpO1xuICAvLyBBZGRzIFwiU2VsZWN0IGFsbFwiIHRvIGNvbnRleHQgbWVudSBpbiBGRlxuICBpZiAoIWNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsgdGUudmFsdWUgPSBpbnB1dC5wcmV2SW5wdXQgPSBcIiBcIjsgfVxuICBpbnB1dC5jb250ZXh0TWVudVBlbmRpbmcgPSB0cnVlO1xuICBkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gY20uZG9jLnNlbDtcbiAgY2xlYXJUaW1lb3V0KGRpc3BsYXkuZGV0ZWN0aW5nU2VsZWN0QWxsKTtcblxuICAvLyBTZWxlY3QtYWxsIHdpbGwgYmUgZ3JleWVkIG91dCBpZiB0aGVyZSdzIG5vdGhpbmcgdG8gc2VsZWN0LCBzb1xuICAvLyB0aGlzIGFkZHMgYSB6ZXJvLXdpZHRoIHNwYWNlIHNvIHRoYXQgd2UgY2FuIGxhdGVyIGNoZWNrIHdoZXRoZXJcbiAgLy8gaXQgZ290IHNlbGVjdGVkLlxuICBmdW5jdGlvbiBwcmVwYXJlU2VsZWN0QWxsSGFjaygpIHtcbiAgICBpZiAodGUuc2VsZWN0aW9uU3RhcnQgIT0gbnVsbCkge1xuICAgICAgdmFyIHNlbGVjdGVkID0gY20uc29tZXRoaW5nU2VsZWN0ZWQoKTtcbiAgICAgIHZhciBleHR2YWwgPSBcIlxcdTIwMGJcIiArIChzZWxlY3RlZCA/IHRlLnZhbHVlIDogXCJcIik7XG4gICAgICB0ZS52YWx1ZSA9IFwiXFx1MjFkYVwiOyAvLyBVc2VkIHRvIGNhdGNoIGNvbnRleHQtbWVudSB1bmRvXG4gICAgICB0ZS52YWx1ZSA9IGV4dHZhbDtcbiAgICAgIGlucHV0LnByZXZJbnB1dCA9IHNlbGVjdGVkID8gXCJcIiA6IFwiXFx1MjAwYlwiO1xuICAgICAgdGUuc2VsZWN0aW9uU3RhcnQgPSAxOyB0ZS5zZWxlY3Rpb25FbmQgPSBleHR2YWwubGVuZ3RoO1xuICAgICAgLy8gUmUtc2V0IHRoaXMsIGluIGNhc2Ugc29tZSBvdGhlciBoYW5kbGVyIHRvdWNoZWQgdGhlXG4gICAgICAvLyBzZWxlY3Rpb24gaW4gdGhlIG1lYW50aW1lLlxuICAgICAgZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSA9IGNtLmRvYy5zZWw7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIHJlaGlkZSgpIHtcbiAgICBpbnB1dC5jb250ZXh0TWVudVBlbmRpbmcgPSBmYWxzZTtcbiAgICBpbnB1dC53cmFwcGVyLnN0eWxlLmNzc1RleHQgPSBvbGRXcmFwcGVyQ1NTO1xuICAgIHRlLnN0eWxlLmNzc1RleHQgPSBvbGRDU1M7XG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA5KSB7IGRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxUb3AoZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgPSBzY3JvbGxQb3MpOyB9XG5cbiAgICAvLyBUcnkgdG8gZGV0ZWN0IHRoZSB1c2VyIGNob29zaW5nIHNlbGVjdC1hbGxcbiAgICBpZiAodGUuc2VsZWN0aW9uU3RhcnQgIT0gbnVsbCkge1xuICAgICAgaWYgKCFpZSB8fCAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpKSB7IHByZXBhcmVTZWxlY3RBbGxIYWNrKCk7IH1cbiAgICAgIHZhciBpID0gMCwgcG9sbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgPT0gY20uZG9jLnNlbCAmJiB0ZS5zZWxlY3Rpb25TdGFydCA9PSAwICYmXG4gICAgICAgICAgICB0ZS5zZWxlY3Rpb25FbmQgPiAwICYmIGlucHV0LnByZXZJbnB1dCA9PSBcIlxcdTIwMGJcIikge1xuICAgICAgICAgIG9wZXJhdGlvbihjbSwgc2VsZWN0QWxsKShjbSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaSsrIDwgMTApIHtcbiAgICAgICAgICBkaXNwbGF5LmRldGVjdGluZ1NlbGVjdEFsbCA9IHNldFRpbWVvdXQocG9sbCwgNTAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gbnVsbDtcbiAgICAgICAgICBkaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBkaXNwbGF5LmRldGVjdGluZ1NlbGVjdEFsbCA9IHNldFRpbWVvdXQocG9sbCwgMjAwKTtcbiAgICB9XG4gIH1cblxuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KSB7IHByZXBhcmVTZWxlY3RBbGxIYWNrKCk7IH1cbiAgaWYgKGNhcHR1cmVSaWdodENsaWNrKSB7XG4gICAgZV9zdG9wKGUpO1xuICAgIHZhciBtb3VzZXVwID0gZnVuY3Rpb24gKCkge1xuICAgICAgb2ZmKHdpbmRvdywgXCJtb3VzZXVwXCIsIG1vdXNldXApO1xuICAgICAgc2V0VGltZW91dChyZWhpZGUsIDIwKTtcbiAgICB9O1xuICAgIG9uKHdpbmRvdywgXCJtb3VzZXVwXCIsIG1vdXNldXApO1xuICB9IGVsc2Uge1xuICAgIHNldFRpbWVvdXQocmVoaWRlLCA1MCk7XG4gIH1cbn07XG5cblRleHRhcmVhSW5wdXQucHJvdG90eXBlLnJlYWRPbmx5Q2hhbmdlZCA9IGZ1bmN0aW9uICh2YWwpIHtcbiAgaWYgKCF2YWwpIHsgdGhpcy5yZXNldCgpOyB9XG59O1xuXG5UZXh0YXJlYUlucHV0LnByb3RvdHlwZS5zZXRVbmVkaXRhYmxlID0gZnVuY3Rpb24gKCkge307XG5cblRleHRhcmVhSW5wdXQucHJvdG90eXBlLm5lZWRzQ29udGVudEF0dHJpYnV0ZSA9IGZhbHNlO1xuXG5mdW5jdGlvbiBmcm9tVGV4dEFyZWEodGV4dGFyZWEsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgPyBjb3B5T2JqKG9wdGlvbnMpIDoge307XG4gIG9wdGlvbnMudmFsdWUgPSB0ZXh0YXJlYS52YWx1ZTtcbiAgaWYgKCFvcHRpb25zLnRhYmluZGV4ICYmIHRleHRhcmVhLnRhYkluZGV4KVxuICAgIHsgb3B0aW9ucy50YWJpbmRleCA9IHRleHRhcmVhLnRhYkluZGV4OyB9XG4gIGlmICghb3B0aW9ucy5wbGFjZWhvbGRlciAmJiB0ZXh0YXJlYS5wbGFjZWhvbGRlcilcbiAgICB7IG9wdGlvbnMucGxhY2Vob2xkZXIgPSB0ZXh0YXJlYS5wbGFjZWhvbGRlcjsgfVxuICAvLyBTZXQgYXV0b2ZvY3VzIHRvIHRydWUgaWYgdGhpcyB0ZXh0YXJlYSBpcyBmb2N1c2VkLCBvciBpZiBpdCBoYXNcbiAgLy8gYXV0b2ZvY3VzIGFuZCBubyBvdGhlciBlbGVtZW50IGlzIGZvY3VzZWQuXG4gIGlmIChvcHRpb25zLmF1dG9mb2N1cyA9PSBudWxsKSB7XG4gICAgdmFyIGhhc0ZvY3VzID0gYWN0aXZlRWx0KCk7XG4gICAgb3B0aW9ucy5hdXRvZm9jdXMgPSBoYXNGb2N1cyA9PSB0ZXh0YXJlYSB8fFxuICAgICAgdGV4dGFyZWEuZ2V0QXR0cmlidXRlKFwiYXV0b2ZvY3VzXCIpICE9IG51bGwgJiYgaGFzRm9jdXMgPT0gZG9jdW1lbnQuYm9keTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNhdmUoKSB7dGV4dGFyZWEudmFsdWUgPSBjbS5nZXRWYWx1ZSgpO31cblxuICB2YXIgcmVhbFN1Ym1pdDtcbiAgaWYgKHRleHRhcmVhLmZvcm0pIHtcbiAgICBvbih0ZXh0YXJlYS5mb3JtLCBcInN1Ym1pdFwiLCBzYXZlKTtcbiAgICAvLyBEZXBsb3JhYmxlIGhhY2sgdG8gbWFrZSB0aGUgc3VibWl0IG1ldGhvZCBkbyB0aGUgcmlnaHQgdGhpbmcuXG4gICAgaWYgKCFvcHRpb25zLmxlYXZlU3VibWl0TWV0aG9kQWxvbmUpIHtcbiAgICAgIHZhciBmb3JtID0gdGV4dGFyZWEuZm9ybTtcbiAgICAgIHJlYWxTdWJtaXQgPSBmb3JtLnN1Ym1pdDtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciB3cmFwcGVkU3VibWl0ID0gZm9ybS5zdWJtaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc2F2ZSgpO1xuICAgICAgICAgIGZvcm0uc3VibWl0ID0gcmVhbFN1Ym1pdDtcbiAgICAgICAgICBmb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgIGZvcm0uc3VibWl0ID0gd3JhcHBlZFN1Ym1pdDtcbiAgICAgICAgfTtcbiAgICAgIH0gY2F0Y2goZSkge31cbiAgICB9XG4gIH1cblxuICBvcHRpb25zLmZpbmlzaEluaXQgPSBmdW5jdGlvbiAoY20pIHtcbiAgICBjbS5zYXZlID0gc2F2ZTtcbiAgICBjbS5nZXRUZXh0QXJlYSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRleHRhcmVhOyB9O1xuICAgIGNtLnRvVGV4dEFyZWEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjbS50b1RleHRBcmVhID0gaXNOYU47IC8vIFByZXZlbnQgdGhpcyBmcm9tIGJlaW5nIHJhbiB0d2ljZVxuICAgICAgc2F2ZSgpO1xuICAgICAgdGV4dGFyZWEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbS5nZXRXcmFwcGVyRWxlbWVudCgpKTtcbiAgICAgIHRleHRhcmVhLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgICAgaWYgKHRleHRhcmVhLmZvcm0pIHtcbiAgICAgICAgb2ZmKHRleHRhcmVhLmZvcm0sIFwic3VibWl0XCIsIHNhdmUpO1xuICAgICAgICBpZiAodHlwZW9mIHRleHRhcmVhLmZvcm0uc3VibWl0ID09IFwiZnVuY3Rpb25cIilcbiAgICAgICAgICB7IHRleHRhcmVhLmZvcm0uc3VibWl0ID0gcmVhbFN1Ym1pdDsgfVxuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB2YXIgY20gPSBDb2RlTWlycm9yJDEoZnVuY3Rpb24gKG5vZGUpIHsgcmV0dXJuIHRleHRhcmVhLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIHRleHRhcmVhLm5leHRTaWJsaW5nKTsgfSxcbiAgICBvcHRpb25zKTtcbiAgcmV0dXJuIGNtXG59XG5cbmZ1bmN0aW9uIGFkZExlZ2FjeVByb3BzKENvZGVNaXJyb3IpIHtcbiAgQ29kZU1pcnJvci5vZmYgPSBvZmY7XG4gIENvZGVNaXJyb3Iub24gPSBvbjtcbiAgQ29kZU1pcnJvci53aGVlbEV2ZW50UGl4ZWxzID0gd2hlZWxFdmVudFBpeGVscztcbiAgQ29kZU1pcnJvci5Eb2MgPSBEb2M7XG4gIENvZGVNaXJyb3Iuc3BsaXRMaW5lcyA9IHNwbGl0TGluZXNBdXRvO1xuICBDb2RlTWlycm9yLmNvdW50Q29sdW1uID0gY291bnRDb2x1bW47XG4gIENvZGVNaXJyb3IuZmluZENvbHVtbiA9IGZpbmRDb2x1bW47XG4gIENvZGVNaXJyb3IuaXNXb3JkQ2hhciA9IGlzV29yZENoYXJCYXNpYztcbiAgQ29kZU1pcnJvci5QYXNzID0gUGFzcztcbiAgQ29kZU1pcnJvci5zaWduYWwgPSBzaWduYWw7XG4gIENvZGVNaXJyb3IuTGluZSA9IExpbmU7XG4gIENvZGVNaXJyb3IuY2hhbmdlRW5kID0gY2hhbmdlRW5kO1xuICBDb2RlTWlycm9yLnNjcm9sbGJhck1vZGVsID0gc2Nyb2xsYmFyTW9kZWw7XG4gIENvZGVNaXJyb3IuUG9zID0gUG9zO1xuICBDb2RlTWlycm9yLmNtcFBvcyA9IGNtcDtcbiAgQ29kZU1pcnJvci5tb2RlcyA9IG1vZGVzO1xuICBDb2RlTWlycm9yLm1pbWVNb2RlcyA9IG1pbWVNb2RlcztcbiAgQ29kZU1pcnJvci5yZXNvbHZlTW9kZSA9IHJlc29sdmVNb2RlO1xuICBDb2RlTWlycm9yLmdldE1vZGUgPSBnZXRNb2RlO1xuICBDb2RlTWlycm9yLm1vZGVFeHRlbnNpb25zID0gbW9kZUV4dGVuc2lvbnM7XG4gIENvZGVNaXJyb3IuZXh0ZW5kTW9kZSA9IGV4dGVuZE1vZGU7XG4gIENvZGVNaXJyb3IuY29weVN0YXRlID0gY29weVN0YXRlO1xuICBDb2RlTWlycm9yLnN0YXJ0U3RhdGUgPSBzdGFydFN0YXRlO1xuICBDb2RlTWlycm9yLmlubmVyTW9kZSA9IGlubmVyTW9kZTtcbiAgQ29kZU1pcnJvci5jb21tYW5kcyA9IGNvbW1hbmRzO1xuICBDb2RlTWlycm9yLmtleU1hcCA9IGtleU1hcDtcbiAgQ29kZU1pcnJvci5rZXlOYW1lID0ga2V5TmFtZTtcbiAgQ29kZU1pcnJvci5pc01vZGlmaWVyS2V5ID0gaXNNb2RpZmllcktleTtcbiAgQ29kZU1pcnJvci5sb29rdXBLZXkgPSBsb29rdXBLZXk7XG4gIENvZGVNaXJyb3Iubm9ybWFsaXplS2V5TWFwID0gbm9ybWFsaXplS2V5TWFwO1xuICBDb2RlTWlycm9yLlN0cmluZ1N0cmVhbSA9IFN0cmluZ1N0cmVhbTtcbiAgQ29kZU1pcnJvci5TaGFyZWRUZXh0TWFya2VyID0gU2hhcmVkVGV4dE1hcmtlcjtcbiAgQ29kZU1pcnJvci5UZXh0TWFya2VyID0gVGV4dE1hcmtlcjtcbiAgQ29kZU1pcnJvci5MaW5lV2lkZ2V0ID0gTGluZVdpZGdldDtcbiAgQ29kZU1pcnJvci5lX3ByZXZlbnREZWZhdWx0ID0gZV9wcmV2ZW50RGVmYXVsdDtcbiAgQ29kZU1pcnJvci5lX3N0b3BQcm9wYWdhdGlvbiA9IGVfc3RvcFByb3BhZ2F0aW9uO1xuICBDb2RlTWlycm9yLmVfc3RvcCA9IGVfc3RvcDtcbiAgQ29kZU1pcnJvci5hZGRDbGFzcyA9IGFkZENsYXNzO1xuICBDb2RlTWlycm9yLmNvbnRhaW5zID0gY29udGFpbnM7XG4gIENvZGVNaXJyb3Iucm1DbGFzcyA9IHJtQ2xhc3M7XG4gIENvZGVNaXJyb3Iua2V5TmFtZXMgPSBrZXlOYW1lcztcbn1cblxuLy8gRURJVE9SIENPTlNUUlVDVE9SXG5cbmRlZmluZU9wdGlvbnMoQ29kZU1pcnJvciQxKTtcblxuYWRkRWRpdG9yTWV0aG9kcyhDb2RlTWlycm9yJDEpO1xuXG4vLyBTZXQgdXAgbWV0aG9kcyBvbiBDb2RlTWlycm9yJ3MgcHJvdG90eXBlIHRvIHJlZGlyZWN0IHRvIHRoZSBlZGl0b3IncyBkb2N1bWVudC5cbnZhciBkb250RGVsZWdhdGUgPSBcIml0ZXIgaW5zZXJ0IHJlbW92ZSBjb3B5IGdldEVkaXRvciBjb25zdHJ1Y3RvclwiLnNwbGl0KFwiIFwiKTtcbmZvciAodmFyIHByb3AgaW4gRG9jLnByb3RvdHlwZSkgeyBpZiAoRG9jLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiBpbmRleE9mKGRvbnREZWxlZ2F0ZSwgcHJvcCkgPCAwKVxuICB7IENvZGVNaXJyb3IkMS5wcm90b3R5cGVbcHJvcF0gPSAoZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge3JldHVybiBtZXRob2QuYXBwbHkodGhpcy5kb2MsIGFyZ3VtZW50cyl9XG4gIH0pKERvYy5wcm90b3R5cGVbcHJvcF0pOyB9IH1cblxuZXZlbnRNaXhpbihEb2MpO1xuXG4vLyBJTlBVVCBIQU5ETElOR1xuXG5Db2RlTWlycm9yJDEuaW5wdXRTdHlsZXMgPSB7XCJ0ZXh0YXJlYVwiOiBUZXh0YXJlYUlucHV0LCBcImNvbnRlbnRlZGl0YWJsZVwiOiBDb250ZW50RWRpdGFibGVJbnB1dH07XG5cbi8vIE1PREUgREVGSU5JVElPTiBBTkQgUVVFUllJTkdcblxuLy8gRXh0cmEgYXJndW1lbnRzIGFyZSBzdG9yZWQgYXMgdGhlIG1vZGUncyBkZXBlbmRlbmNpZXMsIHdoaWNoIGlzXG4vLyB1c2VkIGJ5IChsZWdhY3kpIG1lY2hhbmlzbXMgbGlrZSBsb2FkbW9kZS5qcyB0byBhdXRvbWF0aWNhbGx5XG4vLyBsb2FkIGEgbW9kZS4gKFByZWZlcnJlZCBtZWNoYW5pc20gaXMgdGhlIHJlcXVpcmUvZGVmaW5lIGNhbGxzLilcbkNvZGVNaXJyb3IkMS5kZWZpbmVNb2RlID0gZnVuY3Rpb24obmFtZS8qLCBtb2RlLCDigKYqLykge1xuICBpZiAoIUNvZGVNaXJyb3IkMS5kZWZhdWx0cy5tb2RlICYmIG5hbWUgIT0gXCJudWxsXCIpIHsgQ29kZU1pcnJvciQxLmRlZmF1bHRzLm1vZGUgPSBuYW1lOyB9XG4gIGRlZmluZU1vZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG5cbkNvZGVNaXJyb3IkMS5kZWZpbmVNSU1FID0gZGVmaW5lTUlNRTtcblxuLy8gTWluaW1hbCBkZWZhdWx0IG1vZGUuXG5Db2RlTWlycm9yJDEuZGVmaW5lTW9kZShcIm51bGxcIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gKHt0b2tlbjogZnVuY3Rpb24gKHN0cmVhbSkgeyByZXR1cm4gc3RyZWFtLnNraXBUb0VuZCgpOyB9fSk7IH0pO1xuQ29kZU1pcnJvciQxLmRlZmluZU1JTUUoXCJ0ZXh0L3BsYWluXCIsIFwibnVsbFwiKTtcblxuLy8gRVhURU5TSU9OU1xuXG5Db2RlTWlycm9yJDEuZGVmaW5lRXh0ZW5zaW9uID0gZnVuY3Rpb24gKG5hbWUsIGZ1bmMpIHtcbiAgQ29kZU1pcnJvciQxLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmM7XG59O1xuQ29kZU1pcnJvciQxLmRlZmluZURvY0V4dGVuc2lvbiA9IGZ1bmN0aW9uIChuYW1lLCBmdW5jKSB7XG4gIERvYy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jO1xufTtcblxuQ29kZU1pcnJvciQxLmZyb21UZXh0QXJlYSA9IGZyb21UZXh0QXJlYTtcblxuYWRkTGVnYWN5UHJvcHMoQ29kZU1pcnJvciQxKTtcblxuQ29kZU1pcnJvciQxLnZlcnNpb24gPSBcIjUuMjYuMFwiO1xuXG5yZXR1cm4gQ29kZU1pcnJvciQxO1xuXG59KSkpO1xuIiwiLyoqXG4gKiBTdXBlciBzaW1wbGUgd3lzaXd5ZyBlZGl0b3IgdjAuOC4yXG4gKiBodHRwOi8vc3VtbWVybm90ZS5vcmcvXG4gKlxuICogc3VtbWVybm90ZS5qc1xuICogQ29weXJpZ2h0IDIwMTMtMjAxNiBBbGFuIEhvbmcuIGFuZCBvdGhlciBjb250cmlidXRvcnNcbiAqIHN1bW1lcm5vdGUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuL1xuICpcbiAqIERhdGU6IDIwMTYtMDgtMDdUMDU6MTFaXG4gKi9cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICAvLyBCcm93c2VyIGdsb2JhbHNcbiAgZmFjdG9yeSh3aW5kb3cualF1ZXJ5KTtcbn0oZnVuY3Rpb24gKCQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgY29yZS5mdW5jXG4gICAqXG4gICAqIGZ1bmMgdXRpbHMgKGZvciBoaWdoLW9yZGVyIGZ1bmMncyBhcmcpXG4gICAqXG4gICAqIEBzaW5nbGV0b25cbiAgICogQGFsdGVybmF0ZUNsYXNzTmFtZSBmdW5jXG4gICAqL1xuICB2YXIgZnVuYyA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGVxID0gZnVuY3Rpb24gKGl0ZW1BKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW1CKSB7XG4gICAgICAgIHJldHVybiBpdGVtQSA9PT0gaXRlbUI7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgZXEyID0gZnVuY3Rpb24gKGl0ZW1BLCBpdGVtQikge1xuICAgICAgcmV0dXJuIGl0ZW1BID09PSBpdGVtQjtcbiAgICB9O1xuXG4gICAgdmFyIHBlcTIgPSBmdW5jdGlvbiAocHJvcE5hbWUpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoaXRlbUEsIGl0ZW1CKSB7XG4gICAgICAgIHJldHVybiBpdGVtQVtwcm9wTmFtZV0gPT09IGl0ZW1CW3Byb3BOYW1lXTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBvayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICB2YXIgZmFpbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgdmFyIG5vdCA9IGZ1bmN0aW9uIChmKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gIWYuYXBwbHkoZiwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhbmQgPSBmdW5jdGlvbiAoZkEsIGZCKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGZBKGl0ZW0pICYmIGZCKGl0ZW0pO1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdmFyIHNlbGYgPSBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGE7XG4gICAgfTtcblxuICAgIHZhciBpbnZva2UgPSBmdW5jdGlvbiAob2JqLCBtZXRob2QpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB2YXIgaWRDb3VudGVyID0gMDtcblxuICAgIC8qKlxuICAgICAqIGdlbmVyYXRlIGEgZ2xvYmFsbHktdW5pcXVlIGlkXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3ByZWZpeF1cbiAgICAgKi9cbiAgICB2YXIgdW5pcXVlSWQgPSBmdW5jdGlvbiAocHJlZml4KSB7XG4gICAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnO1xuICAgICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgYm5kIChib3VuZHMpIGZyb20gcmVjdFxuICAgICAqXG4gICAgICogLSBJRSBDb21wYXRpYmlsaXR5IElzc3VlOiBodHRwOi8vZ29vLmdsL3NSTE9Bb1xuICAgICAqIC0gU2Nyb2xsIElzc3VlOiBodHRwOi8vZ29vLmdsL3NOalVjXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1JlY3R9IHJlY3RcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IGJvdW5kc1xuICAgICAqIEByZXR1cm4ge051bWJlcn0gYm91bmRzLnRvcFxuICAgICAqIEByZXR1cm4ge051bWJlcn0gYm91bmRzLmxlZnRcbiAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IGJvdW5kcy53aWR0aFxuICAgICAqIEByZXR1cm4ge051bWJlcn0gYm91bmRzLmhlaWdodFxuICAgICAqL1xuICAgIHZhciByZWN0MmJuZCA9IGZ1bmN0aW9uIChyZWN0KSB7XG4gICAgICB2YXIgJGRvY3VtZW50ID0gJChkb2N1bWVudCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3A6IHJlY3QudG9wICsgJGRvY3VtZW50LnNjcm9sbFRvcCgpLFxuICAgICAgICBsZWZ0OiByZWN0LmxlZnQgKyAkZG9jdW1lbnQuc2Nyb2xsTGVmdCgpLFxuICAgICAgICB3aWR0aDogcmVjdC5yaWdodCAtIHJlY3QubGVmdCxcbiAgICAgICAgaGVpZ2h0OiByZWN0LmJvdHRvbSAtIHJlY3QudG9wXG4gICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIGEgY29weSBvZiB0aGUgb2JqZWN0IHdoZXJlIHRoZSBrZXlzIGhhdmUgYmVjb21lIHRoZSB2YWx1ZXMgYW5kIHRoZSB2YWx1ZXMgdGhlIGtleXMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9ialxuICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgKi9cbiAgICB2YXIgaW52ZXJ0T2JqZWN0ID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgdmFyIGludmVydGVkID0ge307XG4gICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgIGludmVydGVkW29ialtrZXldXSA9IGtleTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGludmVydGVkO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZXNwYWNlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtwcmVmaXhdXG4gICAgICogQHJldHVybiB7U3RyaW5nfVxuICAgICAqL1xuICAgIHZhciBuYW1lc3BhY2VUb0NhbWVsID0gZnVuY3Rpb24gKG5hbWVzcGFjZSwgcHJlZml4KSB7XG4gICAgICBwcmVmaXggPSBwcmVmaXggfHwgJyc7XG4gICAgICByZXR1cm4gcHJlZml4ICsgbmFtZXNwYWNlLnNwbGl0KCcuJykubWFwKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiBuYW1lLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zdWJzdHJpbmcoMSk7XG4gICAgICB9KS5qb2luKCcnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCBhcyBsb25nIGFzIGl0IGNvbnRpbnVlcyB0byBiZSBpbnZva2VkLCB3aWxsIG5vdFxuICAgICAqIGJlIHRyaWdnZXJlZC4gVGhlIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGFmdGVyIGl0IHN0b3BzIGJlaW5nIGNhbGxlZCBmb3JcbiAgICAgKiBOIG1pbGxpc2Vjb25kcy4gSWYgYGltbWVkaWF0ZWAgaXMgcGFzc2VkLCB0cmlnZ2VyIHRoZSBmdW5jdGlvbiBvbiB0aGVcbiAgICAgKiBsZWFkaW5nIGVkZ2UsIGluc3RlYWQgb2YgdGhlIHRyYWlsaW5nLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmNcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gd2FpdFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaW1tZWRpYXRlXG4gICAgICogQHJldHVybiB7RnVuY3Rpb259XG4gICAgICovXG4gICAgdmFyIGRlYm91bmNlID0gZnVuY3Rpb24gKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xuICAgICAgdmFyIHRpbWVvdXQ7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkge1xuICAgICAgICAgICAgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcbiAgICAgICAgaWYgKGNhbGxOb3cpIHtcbiAgICAgICAgICBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgZXE6IGVxLFxuICAgICAgZXEyOiBlcTIsXG4gICAgICBwZXEyOiBwZXEyLFxuICAgICAgb2s6IG9rLFxuICAgICAgZmFpbDogZmFpbCxcbiAgICAgIHNlbGY6IHNlbGYsXG4gICAgICBub3Q6IG5vdCxcbiAgICAgIGFuZDogYW5kLFxuICAgICAgaW52b2tlOiBpbnZva2UsXG4gICAgICB1bmlxdWVJZDogdW5pcXVlSWQsXG4gICAgICByZWN0MmJuZDogcmVjdDJibmQsXG4gICAgICBpbnZlcnRPYmplY3Q6IGludmVydE9iamVjdCxcbiAgICAgIG5hbWVzcGFjZVRvQ2FtZWw6IG5hbWVzcGFjZVRvQ2FtZWwsXG4gICAgICBkZWJvdW5jZTogZGVib3VuY2VcbiAgICB9O1xuICB9KSgpO1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgY29yZS5saXN0XG4gICAqXG4gICAqIGxpc3QgdXRpbHNcbiAgICpcbiAgICogQHNpbmdsZXRvblxuICAgKiBAYWx0ZXJuYXRlQ2xhc3NOYW1lIGxpc3RcbiAgICovXG4gIHZhciBsaXN0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHRoZSBmaXJzdCBpdGVtIG9mIGFuIGFycmF5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXlcbiAgICAgKi9cbiAgICB2YXIgaGVhZCA9IGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgcmV0dXJuIGFycmF5WzBdO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHRoZSBsYXN0IGl0ZW0gb2YgYW4gYXJyYXkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICAgICAqL1xuICAgIHZhciBsYXN0ID0gZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXlcbiAgICAgKi9cbiAgICB2YXIgaW5pdGlhbCA9IGZ1bmN0aW9uIChhcnJheSkge1xuICAgICAgcmV0dXJuIGFycmF5LnNsaWNlKDAsIGFycmF5Lmxlbmd0aCAtIDEpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHRoZSByZXN0IG9mIHRoZSBpdGVtcyBpbiBhbiBhcnJheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5XG4gICAgICovXG4gICAgdmFyIHRhaWwgPSBmdW5jdGlvbiAoYXJyYXkpIHtcbiAgICAgIHJldHVybiBhcnJheS5zbGljZSgxKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBpdGVtIG9mIGFycmF5XG4gICAgICovXG4gICAgdmFyIGZpbmQgPSBmdW5jdGlvbiAoYXJyYXksIHByZWQpIHtcbiAgICAgIGZvciAodmFyIGlkeCA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaWR4IDwgbGVuOyBpZHggKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBhcnJheVtpZHhdO1xuICAgICAgICBpZiAocHJlZChpdGVtKSkge1xuICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgdHJ1ZSBpZiBhbGwgb2YgdGhlIHZhbHVlcyBpbiB0aGUgYXJyYXkgcGFzcyB0aGUgcHJlZGljYXRlIHRydXRoIHRlc3QuXG4gICAgICovXG4gICAgdmFyIGFsbCA9IGZ1bmN0aW9uIChhcnJheSwgcHJlZCkge1xuICAgICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gYXJyYXkubGVuZ3RoOyBpZHggPCBsZW47IGlkeCArKykge1xuICAgICAgICBpZiAoIXByZWQoYXJyYXlbaWR4XSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIGluZGV4IG9mIGl0ZW1cbiAgICAgKi9cbiAgICB2YXIgaW5kZXhPZiA9IGZ1bmN0aW9uIChhcnJheSwgaXRlbSkge1xuICAgICAgcmV0dXJuICQuaW5BcnJheShpdGVtLCBhcnJheSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgdHJ1ZSBpZiB0aGUgdmFsdWUgaXMgcHJlc2VudCBpbiB0aGUgbGlzdC5cbiAgICAgKi9cbiAgICB2YXIgY29udGFpbnMgPSBmdW5jdGlvbiAoYXJyYXksIGl0ZW0pIHtcbiAgICAgIHJldHVybiBpbmRleE9mKGFycmF5LCBpdGVtKSAhPT0gLTE7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGdldCBzdW0gZnJvbSBhIGxpc3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IC0gYXJyYXlcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiAtIGl0ZXJhdG9yXG4gICAgICovXG4gICAgdmFyIHN1bSA9IGZ1bmN0aW9uIChhcnJheSwgZm4pIHtcbiAgICAgIGZuID0gZm4gfHwgZnVuYy5zZWxmO1xuICAgICAgcmV0dXJuIGFycmF5LnJlZHVjZShmdW5jdGlvbiAobWVtbywgdikge1xuICAgICAgICByZXR1cm4gbWVtbyArIGZuKHYpO1xuICAgICAgfSwgMCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgYSBjb3B5IG9mIHRoZSBjb2xsZWN0aW9uIHdpdGggYXJyYXkgdHlwZS5cbiAgICAgKiBAcGFyYW0ge0NvbGxlY3Rpb259IGNvbGxlY3Rpb24gLSBjb2xsZWN0aW9uIGVnKSBub2RlLmNoaWxkTm9kZXMsIC4uLlxuICAgICAqL1xuICAgIHZhciBmcm9tID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICAgIHZhciByZXN1bHQgPSBbXSwgaWR4ID0gLTEsIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoO1xuICAgICAgd2hpbGUgKCsraWR4IDwgbGVuZ3RoKSB7XG4gICAgICAgIHJlc3VsdFtpZHhdID0gY29sbGVjdGlvbltpZHhdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIGxpc3QgaXMgZW1wdHkgb3Igbm90XG4gICAgICovXG4gICAgdmFyIGlzRW1wdHkgPSBmdW5jdGlvbiAoYXJyYXkpIHtcbiAgICAgIHJldHVybiAhYXJyYXkgfHwgIWFycmF5Lmxlbmd0aDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogY2x1c3RlciBlbGVtZW50cyBieSBwcmVkaWNhdGUgZnVuY3Rpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSAtIGFycmF5XG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBwcmVkaWNhdGUgZnVuY3Rpb24gZm9yIGNsdXN0ZXIgcnVsZVxuICAgICAqIEBwYXJhbSB7QXJyYXlbXX1cbiAgICAgKi9cbiAgICB2YXIgY2x1c3RlckJ5ID0gZnVuY3Rpb24gKGFycmF5LCBmbikge1xuICAgICAgaWYgKCFhcnJheS5sZW5ndGgpIHsgcmV0dXJuIFtdOyB9XG4gICAgICB2YXIgYVRhaWwgPSB0YWlsKGFycmF5KTtcbiAgICAgIHJldHVybiBhVGFpbC5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIHYpIHtcbiAgICAgICAgdmFyIGFMYXN0ID0gbGFzdChtZW1vKTtcbiAgICAgICAgaWYgKGZuKGxhc3QoYUxhc3QpLCB2KSkge1xuICAgICAgICAgIGFMYXN0W2FMYXN0Lmxlbmd0aF0gPSB2O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1lbW9bbWVtby5sZW5ndGhdID0gW3ZdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtZW1vO1xuICAgICAgfSwgW1toZWFkKGFycmF5KV1dKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBhIGNvcHkgb2YgdGhlIGFycmF5IHdpdGggYWxsIGZhbHNlIHZhbHVlcyByZW1vdmVkXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheSAtIGFycmF5XG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBwcmVkaWNhdGUgZnVuY3Rpb24gZm9yIGNsdXN0ZXIgcnVsZVxuICAgICAqL1xuICAgIHZhciBjb21wYWN0ID0gZnVuY3Rpb24gKGFycmF5KSB7XG4gICAgICB2YXIgYVJlc3VsdCA9IFtdO1xuICAgICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gYXJyYXkubGVuZ3RoOyBpZHggPCBsZW47IGlkeCArKykge1xuICAgICAgICBpZiAoYXJyYXlbaWR4XSkgeyBhUmVzdWx0LnB1c2goYXJyYXlbaWR4XSk7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBhUmVzdWx0O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBwcm9kdWNlcyBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgdGhlIGFycmF5XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICAgICAqL1xuICAgIHZhciB1bmlxdWUgPSBmdW5jdGlvbiAoYXJyYXkpIHtcbiAgICAgIHZhciByZXN1bHRzID0gW107XG5cbiAgICAgIGZvciAodmFyIGlkeCA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaWR4IDwgbGVuOyBpZHggKyspIHtcbiAgICAgICAgaWYgKCFjb250YWlucyhyZXN1bHRzLCBhcnJheVtpZHhdKSkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaChhcnJheVtpZHhdKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBuZXh0IGl0ZW0uXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJyYXlcbiAgICAgKi9cbiAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIChhcnJheSwgaXRlbSkge1xuICAgICAgdmFyIGlkeCA9IGluZGV4T2YoYXJyYXksIGl0ZW0pO1xuICAgICAgaWYgKGlkeCA9PT0gLTEpIHsgcmV0dXJuIG51bGw7IH1cblxuICAgICAgcmV0dXJuIGFycmF5W2lkeCArIDFdO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHByZXYgaXRlbS5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcnJheVxuICAgICAqL1xuICAgIHZhciBwcmV2ID0gZnVuY3Rpb24gKGFycmF5LCBpdGVtKSB7XG4gICAgICB2YXIgaWR4ID0gaW5kZXhPZihhcnJheSwgaXRlbSk7XG4gICAgICBpZiAoaWR4ID09PSAtMSkgeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgICByZXR1cm4gYXJyYXlbaWR4IC0gMV07XG4gICAgfTtcblxuICAgIHJldHVybiB7IGhlYWQ6IGhlYWQsIGxhc3Q6IGxhc3QsIGluaXRpYWw6IGluaXRpYWwsIHRhaWw6IHRhaWwsXG4gICAgICAgICAgICAgcHJldjogcHJldiwgbmV4dDogbmV4dCwgZmluZDogZmluZCwgY29udGFpbnM6IGNvbnRhaW5zLFxuICAgICAgICAgICAgIGFsbDogYWxsLCBzdW06IHN1bSwgZnJvbTogZnJvbSwgaXNFbXB0eTogaXNFbXB0eSxcbiAgICAgICAgICAgICBjbHVzdGVyQnk6IGNsdXN0ZXJCeSwgY29tcGFjdDogY29tcGFjdCwgdW5pcXVlOiB1bmlxdWUgfTtcbiAgfSkoKTtcblxuICB2YXIgaXNTdXBwb3J0QW1kID0gdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kO1xuXG4gIC8qKlxuICAgKiByZXR1cm5zIHdoZXRoZXIgZm9udCBpcyBpbnN0YWxsZWQgb3Igbm90LlxuICAgKlxuICAgKiBAcGFyYW0ge1N0cmluZ30gZm9udE5hbWVcbiAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICovXG4gIHZhciBpc0ZvbnRJbnN0YWxsZWQgPSBmdW5jdGlvbiAoZm9udE5hbWUpIHtcbiAgICB2YXIgdGVzdEZvbnROYW1lID0gZm9udE5hbWUgPT09ICdDb21pYyBTYW5zIE1TJyA/ICdDb3VyaWVyIE5ldycgOiAnQ29taWMgU2FucyBNUyc7XG4gICAgdmFyICR0ZXN0ZXIgPSAkKCc8ZGl2PicpLmNzcyh7XG4gICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgIGxlZnQ6ICctOTk5OXB4JyxcbiAgICAgIHRvcDogJy05OTk5cHgnLFxuICAgICAgZm9udFNpemU6ICcyMDBweCdcbiAgICB9KS50ZXh0KCdtbW1tbW1tbW13d3d3d3d3JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSk7XG5cbiAgICB2YXIgb3JpZ2luYWxXaWR0aCA9ICR0ZXN0ZXIuY3NzKCdmb250RmFtaWx5JywgdGVzdEZvbnROYW1lKS53aWR0aCgpO1xuICAgIHZhciB3aWR0aCA9ICR0ZXN0ZXIuY3NzKCdmb250RmFtaWx5JywgZm9udE5hbWUgKyAnLCcgKyB0ZXN0Rm9udE5hbWUpLndpZHRoKCk7XG5cbiAgICAkdGVzdGVyLnJlbW92ZSgpO1xuXG4gICAgcmV0dXJuIG9yaWdpbmFsV2lkdGggIT09IHdpZHRoO1xuICB9O1xuXG4gIHZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICB2YXIgaXNNU0lFID0gL01TSUV8VHJpZGVudC9pLnRlc3QodXNlckFnZW50KTtcbiAgdmFyIGJyb3dzZXJWZXJzaW9uO1xuICBpZiAoaXNNU0lFKSB7XG4gICAgdmFyIG1hdGNoZXMgPSAvTVNJRSAoXFxkK1suXVxcZCspLy5leGVjKHVzZXJBZ2VudCk7XG4gICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgIGJyb3dzZXJWZXJzaW9uID0gcGFyc2VGbG9hdChtYXRjaGVzWzFdKTtcbiAgICB9XG4gICAgbWF0Y2hlcyA9IC9UcmlkZW50XFwvLipydjooWzAtOV17MSx9W1xcLjAtOV17MCx9KS8uZXhlYyh1c2VyQWdlbnQpO1xuICAgIGlmIChtYXRjaGVzKSB7XG4gICAgICBicm93c2VyVmVyc2lvbiA9IHBhcnNlRmxvYXQobWF0Y2hlc1sxXSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGlzRWRnZSA9IC9FZGdlXFwvXFxkKy8udGVzdCh1c2VyQWdlbnQpO1xuXG4gIHZhciBoYXNDb2RlTWlycm9yID0gISF3aW5kb3cuQ29kZU1pcnJvcjtcbiAgaWYgKCFoYXNDb2RlTWlycm9yICYmIGlzU3VwcG9ydEFtZCkge1xuICAgIHJlcXVpcmUoJ2NvZGVtaXJyb3InKTtcbiAgICBoYXNDb2RlTWlycm9yID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAY2xhc3MgY29yZS5hZ2VudFxuICAgKlxuICAgKiBPYmplY3Qgd2hpY2ggY2hlY2sgcGxhdGZvcm0gYW5kIGFnZW50XG4gICAqXG4gICAqIEBzaW5nbGV0b25cbiAgICogQGFsdGVybmF0ZUNsYXNzTmFtZSBhZ2VudFxuICAgKi9cbiAgdmFyIGFnZW50ID0ge1xuICAgIGlzTWFjOiBuYXZpZ2F0b3IuYXBwVmVyc2lvbi5pbmRleE9mKCdNYWMnKSA+IC0xLFxuICAgIGlzTVNJRTogaXNNU0lFLFxuICAgIGlzRWRnZTogaXNFZGdlLFxuICAgIGlzRkY6ICFpc0VkZ2UgJiYgL2ZpcmVmb3gvaS50ZXN0KHVzZXJBZ2VudCksXG4gICAgaXNQaGFudG9tOiAvUGhhbnRvbUpTL2kudGVzdCh1c2VyQWdlbnQpLFxuICAgIGlzV2Via2l0OiAhaXNFZGdlICYmIC93ZWJraXQvaS50ZXN0KHVzZXJBZ2VudCksXG4gICAgaXNDaHJvbWU6ICFpc0VkZ2UgJiYgL2Nocm9tZS9pLnRlc3QodXNlckFnZW50KSxcbiAgICBpc1NhZmFyaTogIWlzRWRnZSAmJiAvc2FmYXJpL2kudGVzdCh1c2VyQWdlbnQpLFxuICAgIGJyb3dzZXJWZXJzaW9uOiBicm93c2VyVmVyc2lvbixcbiAgICBqcXVlcnlWZXJzaW9uOiBwYXJzZUZsb2F0KCQuZm4uanF1ZXJ5KSxcbiAgICBpc1N1cHBvcnRBbWQ6IGlzU3VwcG9ydEFtZCxcbiAgICBoYXNDb2RlTWlycm9yOiBoYXNDb2RlTWlycm9yLFxuICAgIGlzRm9udEluc3RhbGxlZDogaXNGb250SW5zdGFsbGVkLFxuICAgIGlzVzNDUmFuZ2VTdXBwb3J0OiAhIWRvY3VtZW50LmNyZWF0ZVJhbmdlXG4gIH07XG5cblxuICB2YXIgTkJTUF9DSEFSID0gU3RyaW5nLmZyb21DaGFyQ29kZSgxNjApO1xuICB2YXIgWkVST19XSURUSF9OQlNQX0NIQVIgPSAnXFx1ZmVmZic7XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBjb3JlLmRvbVxuICAgKlxuICAgKiBEb20gZnVuY3Rpb25zXG4gICAqXG4gICAqIEBzaW5nbGV0b25cbiAgICogQGFsdGVybmF0ZUNsYXNzTmFtZSBkb21cbiAgICovXG4gIHZhciBkb20gPSAoZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaXNFZGl0YWJsZVxuICAgICAqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIG5vZGUgaXMgYG5vdGUtZWRpdGFibGVgIG9yIG5vdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG4gICAgdmFyIGlzRWRpdGFibGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUgJiYgJChub2RlKS5oYXNDbGFzcygnbm90ZS1lZGl0YWJsZScpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGlzQ29udHJvbFNpemluZ1xuICAgICAqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIG5vZGUgaXMgYG5vdGUtY29udHJvbC1zaXppbmdgIG9yIG5vdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG4gICAgdmFyIGlzQ29udHJvbFNpemluZyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZSAmJiAkKG5vZGUpLmhhc0NsYXNzKCdub3RlLWNvbnRyb2wtc2l6aW5nJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbWFrZVByZWRCeU5vZGVOYW1lXG4gICAgICpcbiAgICAgKiByZXR1cm5zIHByZWRpY2F0ZSB3aGljaCBqdWRnZSB3aGV0aGVyIG5vZGVOYW1lIGlzIHNhbWVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBub2RlTmFtZVxuICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICAgICAqL1xuICAgIHZhciBtYWtlUHJlZEJ5Tm9kZU5hbWUgPSBmdW5jdGlvbiAobm9kZU5hbWUpIHtcbiAgICAgIG5vZGVOYW1lID0gbm9kZU5hbWUudG9VcHBlckNhc2UoKTtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICByZXR1cm4gbm9kZSAmJiBub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5vZGVOYW1lO1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBpc1RleHRcbiAgICAgKlxuICAgICAqXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIG5vZGUncyB0eXBlIGlzIHRleHQoMylcbiAgICAgKi9cbiAgICB2YXIgaXNUZXh0ID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHJldHVybiBub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IDM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgaXNFbGVtZW50XG4gICAgICpcbiAgICAgKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBub2RlJ3MgdHlwZSBpcyBlbGVtZW50KDEpXG4gICAgICovXG4gICAgdmFyIGlzRWxlbWVudCA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZSAmJiBub2RlLm5vZGVUeXBlID09PSAxO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBleCkgYnIsIGNvbCwgZW1iZWQsIGhyLCBpbWcsIGlucHV0LCAuLi5cbiAgICAgKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL2h0bWwvd2cvZHJhZnRzL2h0bWwvbWFzdGVyL3N5bnRheC5odG1sI3ZvaWQtZWxlbWVudHNcbiAgICAgKi9cbiAgICB2YXIgaXNWb2lkID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHJldHVybiBub2RlICYmIC9eQlJ8XklNR3xeSFJ8XklGUkFNRXxeQlVUVE9OLy50ZXN0KG5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKSk7XG4gICAgfTtcblxuICAgIHZhciBpc1BhcmEgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgaWYgKGlzRWRpdGFibGUobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBDaHJvbWUodjMxLjApLCBGRih2MjUuMC4xKSB1c2UgRElWIGZvciBwYXJhZ3JhcGhcbiAgICAgIHJldHVybiBub2RlICYmIC9eRElWfF5QfF5MSXxeSFsxLTddLy50ZXN0KG5vZGUubm9kZU5hbWUudG9VcHBlckNhc2UoKSk7XG4gICAgfTtcblxuICAgIHZhciBpc0hlYWRpbmcgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUgJiYgL15IWzEtN10vLnRlc3Qobm9kZS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzUHJlID0gbWFrZVByZWRCeU5vZGVOYW1lKCdQUkUnKTtcblxuICAgIHZhciBpc0xpID0gbWFrZVByZWRCeU5vZGVOYW1lKCdMSScpO1xuXG4gICAgdmFyIGlzUHVyZVBhcmEgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIGlzUGFyYShub2RlKSAmJiAhaXNMaShub2RlKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzVGFibGUgPSBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ1RBQkxFJyk7XG5cbiAgICB2YXIgaXNEYXRhID0gbWFrZVByZWRCeU5vZGVOYW1lKCdEQVRBJyk7XG5cbiAgICB2YXIgaXNJbmxpbmUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuICFpc0JvZHlDb250YWluZXIobm9kZSkgJiZcbiAgICAgICAgICAgICAhaXNMaXN0KG5vZGUpICYmXG4gICAgICAgICAgICAgIWlzSHIobm9kZSkgJiZcbiAgICAgICAgICAgICAhaXNQYXJhKG5vZGUpICYmXG4gICAgICAgICAgICAgIWlzVGFibGUobm9kZSkgJiZcbiAgICAgICAgICAgICAhaXNCbG9ja3F1b3RlKG5vZGUpICYmXG4gICAgICAgICAgICAgIWlzRGF0YShub2RlKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzTGlzdCA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gbm9kZSAmJiAvXlVMfF5PTC8udGVzdChub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkpO1xuICAgIH07XG5cbiAgICB2YXIgaXNIciA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnSFInKTtcblxuICAgIHZhciBpc0NlbGwgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIG5vZGUgJiYgL15URHxeVEgvLnRlc3Qobm9kZS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzQmxvY2txdW90ZSA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnQkxPQ0tRVU9URScpO1xuXG4gICAgdmFyIGlzQm9keUNvbnRhaW5lciA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gaXNDZWxsKG5vZGUpIHx8IGlzQmxvY2txdW90ZShub2RlKSB8fCBpc0VkaXRhYmxlKG5vZGUpO1xuICAgIH07XG5cbiAgICB2YXIgaXNBbmNob3IgPSBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0EnKTtcblxuICAgIHZhciBpc1BhcmFJbmxpbmUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuIGlzSW5saW5lKG5vZGUpICYmICEhYW5jZXN0b3Iobm9kZSwgaXNQYXJhKTtcbiAgICB9O1xuXG4gICAgdmFyIGlzQm9keUlubGluZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICByZXR1cm4gaXNJbmxpbmUobm9kZSkgJiYgIWFuY2VzdG9yKG5vZGUsIGlzUGFyYSk7XG4gICAgfTtcblxuICAgIHZhciBpc0JvZHkgPSBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0JPRFknKTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciBub2RlQiBpcyBjbG9zZXN0IHNpYmxpbmcgb2Ygbm9kZUFcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZUFcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVCXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB2YXIgaXNDbG9zZXN0U2libGluZyA9IGZ1bmN0aW9uIChub2RlQSwgbm9kZUIpIHtcbiAgICAgIHJldHVybiBub2RlQS5uZXh0U2libGluZyA9PT0gbm9kZUIgfHxcbiAgICAgICAgICAgICBub2RlQS5wcmV2aW91c1NpYmxpbmcgPT09IG5vZGVCO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIGFycmF5IG9mIGNsb3Nlc3Qgc2libGluZ3Mgd2l0aCBub2RlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbcHJlZF0gLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAgICAgKiBAcmV0dXJuIHtOb2RlW119XG4gICAgICovXG4gICAgdmFyIHdpdGhDbG9zZXN0U2libGluZ3MgPSBmdW5jdGlvbiAobm9kZSwgcHJlZCkge1xuICAgICAgcHJlZCA9IHByZWQgfHwgZnVuYy5vaztcblxuICAgICAgdmFyIHNpYmxpbmdzID0gW107XG4gICAgICBpZiAobm9kZS5wcmV2aW91c1NpYmxpbmcgJiYgcHJlZChub2RlLnByZXZpb3VzU2libGluZykpIHtcbiAgICAgICAgc2libGluZ3MucHVzaChub2RlLnByZXZpb3VzU2libGluZyk7XG4gICAgICB9XG4gICAgICBzaWJsaW5ncy5wdXNoKG5vZGUpO1xuICAgICAgaWYgKG5vZGUubmV4dFNpYmxpbmcgJiYgcHJlZChub2RlLm5leHRTaWJsaW5nKSkge1xuICAgICAgICBzaWJsaW5ncy5wdXNoKG5vZGUubmV4dFNpYmxpbmcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNpYmxpbmdzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBibGFuayBIVE1MIGZvciBjdXJzb3IgcG9zaXRpb25cbiAgICAgKiAtIFt3b3JrYXJvdW5kXSBvbGQgSUUgb25seSB3b3JrcyB3aXRoICZuYnNwO1xuICAgICAqIC0gW3dvcmthcm91bmRdIElFMTEgYW5kIG90aGVyIGJyb3dzZXIgd29ya3Mgd2l0aCBib2d1cyBiclxuICAgICAqL1xuICAgIHZhciBibGFua0hUTUwgPSBhZ2VudC5pc01TSUUgJiYgYWdlbnQuYnJvd3NlclZlcnNpb24gPCAxMSA/ICcmbmJzcDsnIDogJzxicj4nO1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBub2RlTGVuZ3RoXG4gICAgICpcbiAgICAgKiByZXR1cm5zICN0ZXh0J3MgdGV4dCBzaXplIG9yIGVsZW1lbnQncyBjaGlsZE5vZGVzIHNpemVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqL1xuICAgIHZhciBub2RlTGVuZ3RoID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIGlmIChpc1RleHQobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIG5vZGUubm9kZVZhbHVlLmxlbmd0aDtcbiAgICAgIH1cblxuICAgICAgaWYgKG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAwO1xuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciBub2RlIGlzIGVtcHR5IG9yIG5vdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG4gICAgdmFyIGlzRW1wdHkgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgdmFyIGxlbiA9IG5vZGVMZW5ndGgobm9kZSk7XG5cbiAgICAgIGlmIChsZW4gPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2UgaWYgKCFpc1RleHQobm9kZSkgJiYgbGVuID09PSAxICYmIG5vZGUuaW5uZXJIVE1MID09PSBibGFua0hUTUwpIHtcbiAgICAgICAgLy8gZXgpIDxwPjxicj48L3A+LCA8c3Bhbj48YnI+PC9zcGFuPlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAobGlzdC5hbGwobm9kZS5jaGlsZE5vZGVzLCBpc1RleHQpICYmIG5vZGUuaW5uZXJIVE1MID09PSAnJykge1xuICAgICAgICAvLyBleCkgPHA+PC9wPiwgPHNwYW4+PC9zcGFuPlxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBwYWRkaW5nIGJsYW5rSFRNTCBpZiBub2RlIGlzIGVtcHR5IChmb3IgY3Vyc29yIHBvc2l0aW9uKVxuICAgICAqL1xuICAgIHZhciBwYWRkaW5nQmxhbmtIVE1MID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIGlmICghaXNWb2lkKG5vZGUpICYmICFub2RlTGVuZ3RoKG5vZGUpKSB7XG4gICAgICAgIG5vZGUuaW5uZXJIVE1MID0gYmxhbmtIVE1MO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmaW5kIG5lYXJlc3QgYW5jZXN0b3IgcHJlZGljYXRlIGhpdFxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZCAtIHByZWRpY2F0ZSBmdW5jdGlvblxuICAgICAqL1xuICAgIHZhciBhbmNlc3RvciA9IGZ1bmN0aW9uIChub2RlLCBwcmVkKSB7XG4gICAgICB3aGlsZSAobm9kZSkge1xuICAgICAgICBpZiAocHJlZChub2RlKSkgeyByZXR1cm4gbm9kZTsgfVxuICAgICAgICBpZiAoaXNFZGl0YWJsZShub2RlKSkgeyBicmVhazsgfVxuXG4gICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogZmluZCBuZWFyZXN0IGFuY2VzdG9yIG9ubHkgc2luZ2xlIGNoaWxkIGJsb29kIGxpbmUgYW5kIHByZWRpY2F0ZSBoaXRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHByZWQgLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAgICAgKi9cbiAgICB2YXIgc2luZ2xlQ2hpbGRBbmNlc3RvciA9IGZ1bmN0aW9uIChub2RlLCBwcmVkKSB7XG4gICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuXG4gICAgICB3aGlsZSAobm9kZSkge1xuICAgICAgICBpZiAobm9kZUxlbmd0aChub2RlKSAhPT0gMSkgeyBicmVhazsgfVxuICAgICAgICBpZiAocHJlZChub2RlKSkgeyByZXR1cm4gbm9kZTsgfVxuICAgICAgICBpZiAoaXNFZGl0YWJsZShub2RlKSkgeyBicmVhazsgfVxuXG4gICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBuZXcgYXJyYXkgb2YgYW5jZXN0b3Igbm9kZXMgKHVudGlsIHByZWRpY2F0ZSBoaXQpLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbmFsXSBwcmVkIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gICAgICovXG4gICAgdmFyIGxpc3RBbmNlc3RvciA9IGZ1bmN0aW9uIChub2RlLCBwcmVkKSB7XG4gICAgICBwcmVkID0gcHJlZCB8fCBmdW5jLmZhaWw7XG5cbiAgICAgIHZhciBhbmNlc3RvcnMgPSBbXTtcbiAgICAgIGFuY2VzdG9yKG5vZGUsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBpZiAoIWlzRWRpdGFibGUoZWwpKSB7XG4gICAgICAgICAgYW5jZXN0b3JzLnB1c2goZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHByZWQoZWwpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gYW5jZXN0b3JzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmaW5kIGZhcnRoZXN0IGFuY2VzdG9yIHByZWRpY2F0ZSBoaXRcbiAgICAgKi9cbiAgICB2YXIgbGFzdEFuY2VzdG9yID0gZnVuY3Rpb24gKG5vZGUsIHByZWQpIHtcbiAgICAgIHZhciBhbmNlc3RvcnMgPSBsaXN0QW5jZXN0b3Iobm9kZSk7XG4gICAgICByZXR1cm4gbGlzdC5sYXN0KGFuY2VzdG9ycy5maWx0ZXIocHJlZCkpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIGNvbW1vbiBhbmNlc3RvciBub2RlIGJldHdlZW4gdHdvIG5vZGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlQVxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZUJcbiAgICAgKi9cbiAgICB2YXIgY29tbW9uQW5jZXN0b3IgPSBmdW5jdGlvbiAobm9kZUEsIG5vZGVCKSB7XG4gICAgICB2YXIgYW5jZXN0b3JzID0gbGlzdEFuY2VzdG9yKG5vZGVBKTtcbiAgICAgIGZvciAodmFyIG4gPSBub2RlQjsgbjsgbiA9IG4ucGFyZW50Tm9kZSkge1xuICAgICAgICBpZiAoJC5pbkFycmF5KG4sIGFuY2VzdG9ycykgPiAtMSkgeyByZXR1cm4gbjsgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGw7IC8vIGRpZmZlcmVuY2UgZG9jdW1lbnQgYXJlYVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBsaXN0aW5nIGFsbCBwcmV2aW91cyBzaWJsaW5ncyAodW50aWwgcHJlZGljYXRlIGhpdCkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb3B0aW9uYWxdIHByZWQgLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAgICAgKi9cbiAgICB2YXIgbGlzdFByZXYgPSBmdW5jdGlvbiAobm9kZSwgcHJlZCkge1xuICAgICAgcHJlZCA9IHByZWQgfHwgZnVuYy5mYWlsO1xuXG4gICAgICB2YXIgbm9kZXMgPSBbXTtcbiAgICAgIHdoaWxlIChub2RlKSB7XG4gICAgICAgIGlmIChwcmVkKG5vZGUpKSB7IGJyZWFrOyB9XG4gICAgICAgIG5vZGVzLnB1c2gobm9kZSk7XG4gICAgICAgIG5vZGUgPSBub2RlLnByZXZpb3VzU2libGluZztcbiAgICAgIH1cbiAgICAgIHJldHVybiBub2RlcztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogbGlzdGluZyBuZXh0IHNpYmxpbmdzICh1bnRpbCBwcmVkaWNhdGUgaGl0KS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtwcmVkXSAtIHByZWRpY2F0ZSBmdW5jdGlvblxuICAgICAqL1xuICAgIHZhciBsaXN0TmV4dCA9IGZ1bmN0aW9uIChub2RlLCBwcmVkKSB7XG4gICAgICBwcmVkID0gcHJlZCB8fCBmdW5jLmZhaWw7XG5cbiAgICAgIHZhciBub2RlcyA9IFtdO1xuICAgICAgd2hpbGUgKG5vZGUpIHtcbiAgICAgICAgaWYgKHByZWQobm9kZSkpIHsgYnJlYWs7IH1cbiAgICAgICAgbm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9kZXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGxpc3RpbmcgZGVzY2VuZGFudCBub2Rlc1xuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW3ByZWRdIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gICAgICovXG4gICAgdmFyIGxpc3REZXNjZW5kYW50ID0gZnVuY3Rpb24gKG5vZGUsIHByZWQpIHtcbiAgICAgIHZhciBkZXNjZW5kYW50cyA9IFtdO1xuICAgICAgcHJlZCA9IHByZWQgfHwgZnVuYy5vaztcblxuICAgICAgLy8gc3RhcnQgREZTKGRlcHRoIGZpcnN0IHNlYXJjaCkgd2l0aCBub2RlXG4gICAgICAoZnVuY3Rpb24gZm5XYWxrKGN1cnJlbnQpIHtcbiAgICAgICAgaWYgKG5vZGUgIT09IGN1cnJlbnQgJiYgcHJlZChjdXJyZW50KSkge1xuICAgICAgICAgIGRlc2NlbmRhbnRzLnB1c2goY3VycmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gY3VycmVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaWR4IDwgbGVuOyBpZHgrKykge1xuICAgICAgICAgIGZuV2FsayhjdXJyZW50LmNoaWxkTm9kZXNbaWR4XSk7XG4gICAgICAgIH1cbiAgICAgIH0pKG5vZGUpO1xuXG4gICAgICByZXR1cm4gZGVzY2VuZGFudHM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHdyYXAgbm9kZSB3aXRoIG5ldyB0YWcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKiBAcGFyYW0ge05vZGV9IHRhZ05hbWUgb2Ygd3JhcHBlclxuICAgICAqIEByZXR1cm4ge05vZGV9IC0gd3JhcHBlclxuICAgICAqL1xuICAgIHZhciB3cmFwID0gZnVuY3Rpb24gKG5vZGUsIHdyYXBwZXJOYW1lKSB7XG4gICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgdmFyIHdyYXBwZXIgPSAkKCc8JyArIHdyYXBwZXJOYW1lICsgJz4nKVswXTtcblxuICAgICAgcGFyZW50Lmluc2VydEJlZm9yZSh3cmFwcGVyLCBub2RlKTtcbiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQobm9kZSk7XG5cbiAgICAgIHJldHVybiB3cmFwcGVyO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBpbnNlcnQgbm9kZSBhZnRlciBwcmVjZWRpbmdcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEBwYXJhbSB7Tm9kZX0gcHJlY2VkaW5nIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gICAgICovXG4gICAgdmFyIGluc2VydEFmdGVyID0gZnVuY3Rpb24gKG5vZGUsIHByZWNlZGluZykge1xuICAgICAgdmFyIG5leHQgPSBwcmVjZWRpbmcubmV4dFNpYmxpbmcsIHBhcmVudCA9IHByZWNlZGluZy5wYXJlbnROb2RlO1xuICAgICAgaWYgKG5leHQpIHtcbiAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShub2RlLCBuZXh0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub2RlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBhcHBlbmQgZWxlbWVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKiBAcGFyYW0ge0NvbGxlY3Rpb259IGFDaGlsZFxuICAgICAqL1xuICAgIHZhciBhcHBlbmRDaGlsZE5vZGVzID0gZnVuY3Rpb24gKG5vZGUsIGFDaGlsZCkge1xuICAgICAgJC5lYWNoKGFDaGlsZCwgZnVuY3Rpb24gKGlkeCwgY2hpbGQpIHtcbiAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjaGlsZCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBub2RlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHdoZXRoZXIgYm91bmRhcnlQb2ludCBpcyBsZWZ0IGVkZ2Ugb3Igbm90LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG4gICAgdmFyIGlzTGVmdEVkZ2VQb2ludCA9IGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgcmV0dXJuIHBvaW50Lm9mZnNldCA9PT0gMDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIGJvdW5kYXJ5UG9pbnQgaXMgcmlnaHQgZWRnZSBvciBub3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB2YXIgaXNSaWdodEVkZ2VQb2ludCA9IGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgcmV0dXJuIHBvaW50Lm9mZnNldCA9PT0gbm9kZUxlbmd0aChwb2ludC5ub2RlKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIGJvdW5kYXJ5UG9pbnQgaXMgZWRnZSBvciBub3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB2YXIgaXNFZGdlUG9pbnQgPSBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgIHJldHVybiBpc0xlZnRFZGdlUG9pbnQocG9pbnQpIHx8IGlzUmlnaHRFZGdlUG9pbnQocG9pbnQpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHdoZXRoZXIgbm9kZSBpcyBsZWZ0IGVkZ2Ugb2YgYW5jZXN0b3Igb3Igbm90LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvclxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG4gICAgdmFyIGlzTGVmdEVkZ2VPZiA9IGZ1bmN0aW9uIChub2RlLCBhbmNlc3Rvcikge1xuICAgICAgd2hpbGUgKG5vZGUgJiYgbm9kZSAhPT0gYW5jZXN0b3IpIHtcbiAgICAgICAgaWYgKHBvc2l0aW9uKG5vZGUpICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHdoZXRoZXIgbm9kZSBpcyByaWdodCBlZGdlIG9mIGFuY2VzdG9yIG9yIG5vdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqIEBwYXJhbSB7Tm9kZX0gYW5jZXN0b3JcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqL1xuICAgIHZhciBpc1JpZ2h0RWRnZU9mID0gZnVuY3Rpb24gKG5vZGUsIGFuY2VzdG9yKSB7XG4gICAgICBpZiAoIWFuY2VzdG9yKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHdoaWxlIChub2RlICYmIG5vZGUgIT09IGFuY2VzdG9yKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbihub2RlKSAhPT0gbm9kZUxlbmd0aChub2RlLnBhcmVudE5vZGUpIC0gMSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIHBvaW50IGlzIGxlZnQgZWRnZSBvZiBhbmNlc3RvciBvciBub3QuXG4gICAgICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICAgICAqIEBwYXJhbSB7Tm9kZX0gYW5jZXN0b3JcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqL1xuICAgIHZhciBpc0xlZnRFZGdlUG9pbnRPZiA9IGZ1bmN0aW9uIChwb2ludCwgYW5jZXN0b3IpIHtcbiAgICAgIHJldHVybiBpc0xlZnRFZGdlUG9pbnQocG9pbnQpICYmIGlzTGVmdEVkZ2VPZihwb2ludC5ub2RlLCBhbmNlc3Rvcik7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciBwb2ludCBpcyByaWdodCBlZGdlIG9mIGFuY2VzdG9yIG9yIG5vdC5cbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvclxuICAgICAqIEByZXR1cm4ge0Jvb2xlYW59XG4gICAgICovXG4gICAgdmFyIGlzUmlnaHRFZGdlUG9pbnRPZiA9IGZ1bmN0aW9uIChwb2ludCwgYW5jZXN0b3IpIHtcbiAgICAgIHJldHVybiBpc1JpZ2h0RWRnZVBvaW50KHBvaW50KSAmJiBpc1JpZ2h0RWRnZU9mKHBvaW50Lm5vZGUsIGFuY2VzdG9yKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBvZmZzZXQgZnJvbSBwYXJlbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKi9cbiAgICB2YXIgcG9zaXRpb24gPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgdmFyIG9mZnNldCA9IDA7XG4gICAgICB3aGlsZSAoKG5vZGUgPSBub2RlLnByZXZpb3VzU2libGluZykpIHtcbiAgICAgICAgb2Zmc2V0ICs9IDE7XG4gICAgICB9XG4gICAgICByZXR1cm4gb2Zmc2V0O1xuICAgIH07XG5cbiAgICB2YXIgaGFzQ2hpbGRyZW4gPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgcmV0dXJuICEhKG5vZGUgJiYgbm9kZS5jaGlsZE5vZGVzICYmIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHByZXZpb3VzIGJvdW5kYXJ5UG9pbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzU2tpcElubmVyT2Zmc2V0XG4gICAgICogQHJldHVybiB7Qm91bmRhcnlQb2ludH1cbiAgICAgKi9cbiAgICB2YXIgcHJldlBvaW50ID0gZnVuY3Rpb24gKHBvaW50LCBpc1NraXBJbm5lck9mZnNldCkge1xuICAgICAgdmFyIG5vZGUsIG9mZnNldDtcblxuICAgICAgaWYgKHBvaW50Lm9mZnNldCA9PT0gMCkge1xuICAgICAgICBpZiAoaXNFZGl0YWJsZShwb2ludC5ub2RlKSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgbm9kZSA9IHBvaW50Lm5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgb2Zmc2V0ID0gcG9zaXRpb24ocG9pbnQubm9kZSk7XG4gICAgICB9IGVsc2UgaWYgKGhhc0NoaWxkcmVuKHBvaW50Lm5vZGUpKSB7XG4gICAgICAgIG5vZGUgPSBwb2ludC5ub2RlLmNoaWxkTm9kZXNbcG9pbnQub2Zmc2V0IC0gMV07XG4gICAgICAgIG9mZnNldCA9IG5vZGVMZW5ndGgobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub2RlID0gcG9pbnQubm9kZTtcbiAgICAgICAgb2Zmc2V0ID0gaXNTa2lwSW5uZXJPZmZzZXQgPyAwIDogcG9pbnQub2Zmc2V0IC0gMTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbm9kZTogbm9kZSxcbiAgICAgICAgb2Zmc2V0OiBvZmZzZXRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgbmV4dCBib3VuZGFyeVBvaW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc1NraXBJbm5lck9mZnNldFxuICAgICAqIEByZXR1cm4ge0JvdW5kYXJ5UG9pbnR9XG4gICAgICovXG4gICAgdmFyIG5leHRQb2ludCA9IGZ1bmN0aW9uIChwb2ludCwgaXNTa2lwSW5uZXJPZmZzZXQpIHtcbiAgICAgIHZhciBub2RlLCBvZmZzZXQ7XG5cbiAgICAgIGlmIChub2RlTGVuZ3RoKHBvaW50Lm5vZGUpID09PSBwb2ludC5vZmZzZXQpIHtcbiAgICAgICAgaWYgKGlzRWRpdGFibGUocG9pbnQubm9kZSkpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGUgPSBwb2ludC5ub2RlLnBhcmVudE5vZGU7XG4gICAgICAgIG9mZnNldCA9IHBvc2l0aW9uKHBvaW50Lm5vZGUpICsgMTtcbiAgICAgIH0gZWxzZSBpZiAoaGFzQ2hpbGRyZW4ocG9pbnQubm9kZSkpIHtcbiAgICAgICAgbm9kZSA9IHBvaW50Lm5vZGUuY2hpbGROb2Rlc1twb2ludC5vZmZzZXRdO1xuICAgICAgICBvZmZzZXQgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbm9kZSA9IHBvaW50Lm5vZGU7XG4gICAgICAgIG9mZnNldCA9IGlzU2tpcElubmVyT2Zmc2V0ID8gbm9kZUxlbmd0aChwb2ludC5ub2RlKSA6IHBvaW50Lm9mZnNldCArIDE7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5vZGU6IG5vZGUsXG4gICAgICAgIG9mZnNldDogb2Zmc2V0XG4gICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHdoZXRoZXIgcG9pbnRBIGFuZCBwb2ludEIgaXMgc2FtZSBvciBub3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50QVxuICAgICAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRCXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB2YXIgaXNTYW1lUG9pbnQgPSBmdW5jdGlvbiAocG9pbnRBLCBwb2ludEIpIHtcbiAgICAgIHJldHVybiBwb2ludEEubm9kZSA9PT0gcG9pbnRCLm5vZGUgJiYgcG9pbnRBLm9mZnNldCA9PT0gcG9pbnRCLm9mZnNldDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIHBvaW50IGlzIHZpc2libGUgKGNhbiBzZXQgY3Vyc29yKSBvciBub3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB2YXIgaXNWaXNpYmxlUG9pbnQgPSBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgIGlmIChpc1RleHQocG9pbnQubm9kZSkgfHwgIWhhc0NoaWxkcmVuKHBvaW50Lm5vZGUpIHx8IGlzRW1wdHkocG9pbnQubm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBsZWZ0Tm9kZSA9IHBvaW50Lm5vZGUuY2hpbGROb2Rlc1twb2ludC5vZmZzZXQgLSAxXTtcbiAgICAgIHZhciByaWdodE5vZGUgPSBwb2ludC5ub2RlLmNoaWxkTm9kZXNbcG9pbnQub2Zmc2V0XTtcbiAgICAgIGlmICgoIWxlZnROb2RlIHx8IGlzVm9pZChsZWZ0Tm9kZSkpICYmICghcmlnaHROb2RlIHx8IGlzVm9pZChyaWdodE5vZGUpKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHByZXZQb2ludFV0aWxcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkXG4gICAgICogQHJldHVybiB7Qm91bmRhcnlQb2ludH1cbiAgICAgKi9cbiAgICB2YXIgcHJldlBvaW50VW50aWwgPSBmdW5jdGlvbiAocG9pbnQsIHByZWQpIHtcbiAgICAgIHdoaWxlIChwb2ludCkge1xuICAgICAgICBpZiAocHJlZChwb2ludCkpIHtcbiAgICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBwb2ludCA9IHByZXZQb2ludChwb2ludCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIG5leHRQb2ludFVudGlsXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZFxuICAgICAqIEByZXR1cm4ge0JvdW5kYXJ5UG9pbnR9XG4gICAgICovXG4gICAgdmFyIG5leHRQb2ludFVudGlsID0gZnVuY3Rpb24gKHBvaW50LCBwcmVkKSB7XG4gICAgICB3aGlsZSAocG9pbnQpIHtcbiAgICAgICAgaWYgKHByZWQocG9pbnQpKSB7XG4gICAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgICB9XG5cbiAgICAgICAgcG9pbnQgPSBuZXh0UG9pbnQocG9pbnQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB3aGV0aGVyIHBvaW50IGhhcyBjaGFyYWN0ZXIgb3Igbm90LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtQb2ludH0gcG9pbnRcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAqL1xuICAgIHZhciBpc0NoYXJQb2ludCA9IGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgaWYgKCFpc1RleHQocG9pbnQubm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB2YXIgY2ggPSBwb2ludC5ub2RlLm5vZGVWYWx1ZS5jaGFyQXQocG9pbnQub2Zmc2V0IC0gMSk7XG4gICAgICByZXR1cm4gY2ggJiYgKGNoICE9PSAnICcgJiYgY2ggIT09IE5CU1BfQ0hBUik7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgd2Fsa1BvaW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHN0YXJ0UG9pbnRcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IGVuZFBvaW50XG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlclxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNTa2lwSW5uZXJPZmZzZXRcbiAgICAgKi9cbiAgICB2YXIgd2Fsa1BvaW50ID0gZnVuY3Rpb24gKHN0YXJ0UG9pbnQsIGVuZFBvaW50LCBoYW5kbGVyLCBpc1NraXBJbm5lck9mZnNldCkge1xuICAgICAgdmFyIHBvaW50ID0gc3RhcnRQb2ludDtcblxuICAgICAgd2hpbGUgKHBvaW50KSB7XG4gICAgICAgIGhhbmRsZXIocG9pbnQpO1xuXG4gICAgICAgIGlmIChpc1NhbWVQb2ludChwb2ludCwgZW5kUG9pbnQpKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaXNTa2lwT2Zmc2V0ID0gaXNTa2lwSW5uZXJPZmZzZXQgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9pbnQubm9kZSAhPT0gcG9pbnQubm9kZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kUG9pbnQubm9kZSAhPT0gcG9pbnQubm9kZTtcbiAgICAgICAgcG9pbnQgPSBuZXh0UG9pbnQocG9pbnQsIGlzU2tpcE9mZnNldCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbWFrZU9mZnNldFBhdGhcbiAgICAgKlxuICAgICAqIHJldHVybiBvZmZzZXRQYXRoKGFycmF5IG9mIG9mZnNldCkgZnJvbSBhbmNlc3RvclxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBhbmNlc3RvciAtIGFuY2VzdG9yIG5vZGVcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKi9cbiAgICB2YXIgbWFrZU9mZnNldFBhdGggPSBmdW5jdGlvbiAoYW5jZXN0b3IsIG5vZGUpIHtcbiAgICAgIHZhciBhbmNlc3RvcnMgPSBsaXN0QW5jZXN0b3Iobm9kZSwgZnVuYy5lcShhbmNlc3RvcikpO1xuICAgICAgcmV0dXJuIGFuY2VzdG9ycy5tYXAocG9zaXRpb24pLnJldmVyc2UoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCBmcm9tT2Zmc2V0UGF0aFxuICAgICAqXG4gICAgICogcmV0dXJuIGVsZW1lbnQgZnJvbSBvZmZzZXRQYXRoKGFycmF5IG9mIG9mZnNldClcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Tm9kZX0gYW5jZXN0b3IgLSBhbmNlc3RvciBub2RlXG4gICAgICogQHBhcmFtIHthcnJheX0gb2Zmc2V0cyAtIG9mZnNldFBhdGhcbiAgICAgKi9cbiAgICB2YXIgZnJvbU9mZnNldFBhdGggPSBmdW5jdGlvbiAoYW5jZXN0b3IsIG9mZnNldHMpIHtcbiAgICAgIHZhciBjdXJyZW50ID0gYW5jZXN0b3I7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gb2Zmc2V0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBpZiAoY3VycmVudC5jaGlsZE5vZGVzLmxlbmd0aCA8PSBvZmZzZXRzW2ldKSB7XG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQuY2hpbGROb2Rlc1tjdXJyZW50LmNoaWxkTm9kZXMubGVuZ3RoIC0gMV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQuY2hpbGROb2Rlc1tvZmZzZXRzW2ldXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc3BsaXROb2RlXG4gICAgICpcbiAgICAgKiBzcGxpdCBlbGVtZW50IG9yICN0ZXh0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaXNTa2lwUGFkZGluZ0JsYW5rSFRNTF0gLSBkZWZhdWx0OiBmYWxzZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaXNOb3RTcGxpdEVkZ2VQb2ludF0gLSBkZWZhdWx0OiBmYWxzZVxuICAgICAqIEByZXR1cm4ge05vZGV9IHJpZ2h0IG5vZGUgb2YgYm91bmRhcnlQb2ludFxuICAgICAqL1xuICAgIHZhciBzcGxpdE5vZGUgPSBmdW5jdGlvbiAocG9pbnQsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBpc1NraXBQYWRkaW5nQmxhbmtIVE1MID0gb3B0aW9ucyAmJiBvcHRpb25zLmlzU2tpcFBhZGRpbmdCbGFua0hUTUw7XG4gICAgICB2YXIgaXNOb3RTcGxpdEVkZ2VQb2ludCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5pc05vdFNwbGl0RWRnZVBvaW50O1xuXG4gICAgICAvLyBlZGdlIGNhc2VcbiAgICAgIGlmIChpc0VkZ2VQb2ludChwb2ludCkgJiYgKGlzVGV4dChwb2ludC5ub2RlKSB8fCBpc05vdFNwbGl0RWRnZVBvaW50KSkge1xuICAgICAgICBpZiAoaXNMZWZ0RWRnZVBvaW50KHBvaW50KSkge1xuICAgICAgICAgIHJldHVybiBwb2ludC5ub2RlO1xuICAgICAgICB9IGVsc2UgaWYgKGlzUmlnaHRFZGdlUG9pbnQocG9pbnQpKSB7XG4gICAgICAgICAgcmV0dXJuIHBvaW50Lm5vZGUubmV4dFNpYmxpbmc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gc3BsaXQgI3RleHRcbiAgICAgIGlmIChpc1RleHQocG9pbnQubm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHBvaW50Lm5vZGUuc3BsaXRUZXh0KHBvaW50Lm9mZnNldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2hpbGROb2RlID0gcG9pbnQubm9kZS5jaGlsZE5vZGVzW3BvaW50Lm9mZnNldF07XG4gICAgICAgIHZhciBjbG9uZSA9IGluc2VydEFmdGVyKHBvaW50Lm5vZGUuY2xvbmVOb2RlKGZhbHNlKSwgcG9pbnQubm9kZSk7XG4gICAgICAgIGFwcGVuZENoaWxkTm9kZXMoY2xvbmUsIGxpc3ROZXh0KGNoaWxkTm9kZSkpO1xuXG4gICAgICAgIGlmICghaXNTa2lwUGFkZGluZ0JsYW5rSFRNTCkge1xuICAgICAgICAgIHBhZGRpbmdCbGFua0hUTUwocG9pbnQubm9kZSk7XG4gICAgICAgICAgcGFkZGluZ0JsYW5rSFRNTChjbG9uZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2Qgc3BsaXRUcmVlXG4gICAgICpcbiAgICAgKiBzcGxpdCB0cmVlIGJ5IHBvaW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IHJvb3QgLSBzcGxpdCByb290XG4gICAgICogQHBhcmFtIHtCb3VuZGFyeVBvaW50fSBwb2ludFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmlzU2tpcFBhZGRpbmdCbGFua0hUTUxdIC0gZGVmYXVsdDogZmFsc2VcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmlzTm90U3BsaXRFZGdlUG9pbnRdIC0gZGVmYXVsdDogZmFsc2VcbiAgICAgKiBAcmV0dXJuIHtOb2RlfSByaWdodCBub2RlIG9mIGJvdW5kYXJ5UG9pbnRcbiAgICAgKi9cbiAgICB2YXIgc3BsaXRUcmVlID0gZnVuY3Rpb24gKHJvb3QsIHBvaW50LCBvcHRpb25zKSB7XG4gICAgICAvLyBleCkgWyN0ZXh0LCA8c3Bhbj4sIDxwPl1cbiAgICAgIHZhciBhbmNlc3RvcnMgPSBsaXN0QW5jZXN0b3IocG9pbnQubm9kZSwgZnVuYy5lcShyb290KSk7XG5cbiAgICAgIGlmICghYW5jZXN0b3JzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0gZWxzZSBpZiAoYW5jZXN0b3JzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICByZXR1cm4gc3BsaXROb2RlKHBvaW50LCBvcHRpb25zKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFuY2VzdG9ycy5yZWR1Y2UoZnVuY3Rpb24gKG5vZGUsIHBhcmVudCkge1xuICAgICAgICBpZiAobm9kZSA9PT0gcG9pbnQubm9kZSkge1xuICAgICAgICAgIG5vZGUgPSBzcGxpdE5vZGUocG9pbnQsIG9wdGlvbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNwbGl0Tm9kZSh7XG4gICAgICAgICAgbm9kZTogcGFyZW50LFxuICAgICAgICAgIG9mZnNldDogbm9kZSA/IGRvbS5wb3NpdGlvbihub2RlKSA6IG5vZGVMZW5ndGgocGFyZW50KVxuICAgICAgICB9LCBvcHRpb25zKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBzcGxpdCBwb2ludFxuICAgICAqXG4gICAgICogQHBhcmFtIHtQb2ludH0gcG9pbnRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzSW5saW5lXG4gICAgICogQHJldHVybiB7T2JqZWN0fVxuICAgICAqL1xuICAgIHZhciBzcGxpdFBvaW50ID0gZnVuY3Rpb24gKHBvaW50LCBpc0lubGluZSkge1xuICAgICAgLy8gZmluZCBzcGxpdFJvb3QsIGNvbnRhaW5lclxuICAgICAgLy8gIC0gaW5saW5lOiBzcGxpdFJvb3QgaXMgYSBjaGlsZCBvZiBwYXJhZ3JhcGhcbiAgICAgIC8vICAtIGJsb2NrOiBzcGxpdFJvb3QgaXMgYSBjaGlsZCBvZiBib2R5Q29udGFpbmVyXG4gICAgICB2YXIgcHJlZCA9IGlzSW5saW5lID8gaXNQYXJhIDogaXNCb2R5Q29udGFpbmVyO1xuICAgICAgdmFyIGFuY2VzdG9ycyA9IGxpc3RBbmNlc3Rvcihwb2ludC5ub2RlLCBwcmVkKTtcbiAgICAgIHZhciB0b3BBbmNlc3RvciA9IGxpc3QubGFzdChhbmNlc3RvcnMpIHx8IHBvaW50Lm5vZGU7XG5cbiAgICAgIHZhciBzcGxpdFJvb3QsIGNvbnRhaW5lcjtcbiAgICAgIGlmIChwcmVkKHRvcEFuY2VzdG9yKSkge1xuICAgICAgICBzcGxpdFJvb3QgPSBhbmNlc3RvcnNbYW5jZXN0b3JzLmxlbmd0aCAtIDJdO1xuICAgICAgICBjb250YWluZXIgPSB0b3BBbmNlc3RvcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNwbGl0Um9vdCA9IHRvcEFuY2VzdG9yO1xuICAgICAgICBjb250YWluZXIgPSBzcGxpdFJvb3QucGFyZW50Tm9kZTtcbiAgICAgIH1cblxuICAgICAgLy8gaWYgc3BsaXRSb290IGlzIGV4aXN0cywgc3BsaXQgd2l0aCBzcGxpdFRyZWVcbiAgICAgIHZhciBwaXZvdCA9IHNwbGl0Um9vdCAmJiBzcGxpdFRyZWUoc3BsaXRSb290LCBwb2ludCwge1xuICAgICAgICBpc1NraXBQYWRkaW5nQmxhbmtIVE1MOiBpc0lubGluZSxcbiAgICAgICAgaXNOb3RTcGxpdEVkZ2VQb2ludDogaXNJbmxpbmVcbiAgICAgIH0pO1xuXG4gICAgICAvLyBpZiBjb250YWluZXIgaXMgcG9pbnQubm9kZSwgZmluZCBwaXZvdCB3aXRoIHBvaW50Lm9mZnNldFxuICAgICAgaWYgKCFwaXZvdCAmJiBjb250YWluZXIgPT09IHBvaW50Lm5vZGUpIHtcbiAgICAgICAgcGl2b3QgPSBwb2ludC5ub2RlLmNoaWxkTm9kZXNbcG9pbnQub2Zmc2V0XTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmlnaHROb2RlOiBwaXZvdCxcbiAgICAgICAgY29udGFpbmVyOiBjb250YWluZXJcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBjcmVhdGUgPSBmdW5jdGlvbiAobm9kZU5hbWUpIHtcbiAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5vZGVOYW1lKTtcbiAgICB9O1xuXG4gICAgdmFyIGNyZWF0ZVRleHQgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJlbW92ZVxuICAgICAqXG4gICAgICogcmVtb3ZlIG5vZGUsIChpc1JlbW92ZUNoaWxkOiByZW1vdmUgY2hpbGQgb3Igbm90KVxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc1JlbW92ZUNoaWxkXG4gICAgICovXG4gICAgdmFyIHJlbW92ZSA9IGZ1bmN0aW9uIChub2RlLCBpc1JlbW92ZUNoaWxkKSB7XG4gICAgICBpZiAoIW5vZGUgfHwgIW5vZGUucGFyZW50Tm9kZSkgeyByZXR1cm47IH1cbiAgICAgIGlmIChub2RlLnJlbW92ZU5vZGUpIHsgcmV0dXJuIG5vZGUucmVtb3ZlTm9kZShpc1JlbW92ZUNoaWxkKTsgfVxuXG4gICAgICB2YXIgcGFyZW50ID0gbm9kZS5wYXJlbnROb2RlO1xuICAgICAgaWYgKCFpc1JlbW92ZUNoaWxkKSB7XG4gICAgICAgIHZhciBub2RlcyA9IFtdO1xuICAgICAgICB2YXIgaSwgbGVuO1xuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBub2Rlcy5wdXNoKG5vZGUuY2hpbGROb2Rlc1tpXSk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBub2Rlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZXNbaV0sIG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChub2RlKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQG1ldGhvZCByZW1vdmVXaGlsZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZFxuICAgICAqL1xuICAgIHZhciByZW1vdmVXaGlsZSA9IGZ1bmN0aW9uIChub2RlLCBwcmVkKSB7XG4gICAgICB3aGlsZSAobm9kZSkge1xuICAgICAgICBpZiAoaXNFZGl0YWJsZShub2RlKSB8fCAhcHJlZChub2RlKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgcmVtb3ZlKG5vZGUpO1xuICAgICAgICBub2RlID0gcGFyZW50O1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJlcGxhY2VcbiAgICAgKlxuICAgICAqIHJlcGxhY2Ugbm9kZSB3aXRoIHByb3ZpZGVkIG5vZGVOYW1lXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge05vZGV9IG5vZGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbm9kZU5hbWVcbiAgICAgKiBAcmV0dXJuIHtOb2RlfSAtIG5ldyBub2RlXG4gICAgICovXG4gICAgdmFyIHJlcGxhY2UgPSBmdW5jdGlvbiAobm9kZSwgbm9kZU5hbWUpIHtcbiAgICAgIGlmIChub2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IG5vZGVOYW1lLnRvVXBwZXJDYXNlKCkpIHtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9XG5cbiAgICAgIHZhciBuZXdOb2RlID0gY3JlYXRlKG5vZGVOYW1lKTtcblxuICAgICAgaWYgKG5vZGUuc3R5bGUuY3NzVGV4dCkge1xuICAgICAgICBuZXdOb2RlLnN0eWxlLmNzc1RleHQgPSBub2RlLnN0eWxlLmNzc1RleHQ7XG4gICAgICB9XG5cbiAgICAgIGFwcGVuZENoaWxkTm9kZXMobmV3Tm9kZSwgbGlzdC5mcm9tKG5vZGUuY2hpbGROb2RlcykpO1xuICAgICAgaW5zZXJ0QWZ0ZXIobmV3Tm9kZSwgbm9kZSk7XG4gICAgICByZW1vdmUobm9kZSk7XG5cbiAgICAgIHJldHVybiBuZXdOb2RlO1xuICAgIH07XG5cbiAgICB2YXIgaXNUZXh0YXJlYSA9IG1ha2VQcmVkQnlOb2RlTmFtZSgnVEVYVEFSRUEnKTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkbm9kZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3N0cmlwTGluZWJyZWFrc10gLSBkZWZhdWx0OiBmYWxzZVxuICAgICAqL1xuICAgIHZhciB2YWx1ZSA9IGZ1bmN0aW9uICgkbm9kZSwgc3RyaXBMaW5lYnJlYWtzKSB7XG4gICAgICB2YXIgdmFsID0gaXNUZXh0YXJlYSgkbm9kZVswXSkgPyAkbm9kZS52YWwoKSA6ICRub2RlLmh0bWwoKTtcbiAgICAgIGlmIChzdHJpcExpbmVicmVha3MpIHtcbiAgICAgICAgcmV0dXJuIHZhbC5yZXBsYWNlKC9bXFxuXFxyXS9nLCAnJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGh0bWxcbiAgICAgKlxuICAgICAqIGdldCB0aGUgSFRNTCBjb250ZW50cyBvZiBub2RlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJG5vZGVcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpc05ld2xpbmVPbkJsb2NrXVxuICAgICAqL1xuICAgIHZhciBodG1sID0gZnVuY3Rpb24gKCRub2RlLCBpc05ld2xpbmVPbkJsb2NrKSB7XG4gICAgICB2YXIgbWFya3VwID0gdmFsdWUoJG5vZGUpO1xuXG4gICAgICBpZiAoaXNOZXdsaW5lT25CbG9jaykge1xuICAgICAgICB2YXIgcmVnZXhUYWcgPSAvPChcXC8/KShcXGIoPyEhKVtePlxcc10qKSguKj8pKFxccypcXC8/PikvZztcbiAgICAgICAgbWFya3VwID0gbWFya3VwLnJlcGxhY2UocmVnZXhUYWcsIGZ1bmN0aW9uIChtYXRjaCwgZW5kU2xhc2gsIG5hbWUpIHtcbiAgICAgICAgICBuYW1lID0gbmFtZS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgIHZhciBpc0VuZE9mSW5saW5lQ29udGFpbmVyID0gL15ESVZ8XlREfF5USHxeUHxeTEl8XkhbMS03XS8udGVzdChuYW1lKSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISFlbmRTbGFzaDtcbiAgICAgICAgICB2YXIgaXNCbG9ja05vZGUgPSAvXkJMT0NLUVVPVEV8XlRBQkxFfF5UQk9EWXxeVFJ8XkhSfF5VTHxeT0wvLnRlc3QobmFtZSk7XG5cbiAgICAgICAgICByZXR1cm4gbWF0Y2ggKyAoKGlzRW5kT2ZJbmxpbmVDb250YWluZXIgfHwgaXNCbG9ja05vZGUpID8gJ1xcbicgOiAnJyk7XG4gICAgICAgIH0pO1xuICAgICAgICBtYXJrdXAgPSAkLnRyaW0obWFya3VwKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1hcmt1cDtcbiAgICB9O1xuXG4gICAgdmFyIHBvc0Zyb21QbGFjZWhvbGRlciA9IGZ1bmN0aW9uIChwbGFjZWhvbGRlcikge1xuICAgICAgdmFyICRwbGFjZWhvbGRlciA9ICQocGxhY2Vob2xkZXIpO1xuICAgICAgdmFyIHBvcyA9ICRwbGFjZWhvbGRlci5vZmZzZXQoKTtcbiAgICAgIHZhciBoZWlnaHQgPSAkcGxhY2Vob2xkZXIub3V0ZXJIZWlnaHQodHJ1ZSk7IC8vIGluY2x1ZGUgbWFyZ2luXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICB0b3A6IHBvcy50b3AgKyBoZWlnaHRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhdHRhY2hFdmVudHMgPSBmdW5jdGlvbiAoJG5vZGUsIGV2ZW50cykge1xuICAgICAgT2JqZWN0LmtleXMoZXZlbnRzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgJG5vZGUub24oa2V5LCBldmVudHNba2V5XSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIGRldGFjaEV2ZW50cyA9IGZ1bmN0aW9uICgkbm9kZSwgZXZlbnRzKSB7XG4gICAgICBPYmplY3Qua2V5cyhldmVudHMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAkbm9kZS5vZmYoa2V5LCBldmVudHNba2V5XSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC8qKiBAcHJvcGVydHkge1N0cmluZ30gTkJTUF9DSEFSICovXG4gICAgICBOQlNQX0NIQVI6IE5CU1BfQ0hBUixcbiAgICAgIC8qKiBAcHJvcGVydHkge1N0cmluZ30gWkVST19XSURUSF9OQlNQX0NIQVIgKi9cbiAgICAgIFpFUk9fV0lEVEhfTkJTUF9DSEFSOiBaRVJPX1dJRFRIX05CU1BfQ0hBUixcbiAgICAgIC8qKiBAcHJvcGVydHkge1N0cmluZ30gYmxhbmsgKi9cbiAgICAgIGJsYW5rOiBibGFua0hUTUwsXG4gICAgICAvKiogQHByb3BlcnR5IHtTdHJpbmd9IGVtcHR5UGFyYSAqL1xuICAgICAgZW1wdHlQYXJhOiAnPHA+JyArIGJsYW5rSFRNTCArICc8L3A+JyxcbiAgICAgIG1ha2VQcmVkQnlOb2RlTmFtZTogbWFrZVByZWRCeU5vZGVOYW1lLFxuICAgICAgaXNFZGl0YWJsZTogaXNFZGl0YWJsZSxcbiAgICAgIGlzQ29udHJvbFNpemluZzogaXNDb250cm9sU2l6aW5nLFxuICAgICAgaXNUZXh0OiBpc1RleHQsXG4gICAgICBpc0VsZW1lbnQ6IGlzRWxlbWVudCxcbiAgICAgIGlzVm9pZDogaXNWb2lkLFxuICAgICAgaXNQYXJhOiBpc1BhcmEsXG4gICAgICBpc1B1cmVQYXJhOiBpc1B1cmVQYXJhLFxuICAgICAgaXNIZWFkaW5nOiBpc0hlYWRpbmcsXG4gICAgICBpc0lubGluZTogaXNJbmxpbmUsXG4gICAgICBpc0Jsb2NrOiBmdW5jLm5vdChpc0lubGluZSksXG4gICAgICBpc0JvZHlJbmxpbmU6IGlzQm9keUlubGluZSxcbiAgICAgIGlzQm9keTogaXNCb2R5LFxuICAgICAgaXNQYXJhSW5saW5lOiBpc1BhcmFJbmxpbmUsXG4gICAgICBpc1ByZTogaXNQcmUsXG4gICAgICBpc0xpc3Q6IGlzTGlzdCxcbiAgICAgIGlzVGFibGU6IGlzVGFibGUsXG4gICAgICBpc0RhdGE6IGlzRGF0YSxcbiAgICAgIGlzQ2VsbDogaXNDZWxsLFxuICAgICAgaXNCbG9ja3F1b3RlOiBpc0Jsb2NrcXVvdGUsXG4gICAgICBpc0JvZHlDb250YWluZXI6IGlzQm9keUNvbnRhaW5lcixcbiAgICAgIGlzQW5jaG9yOiBpc0FuY2hvcixcbiAgICAgIGlzRGl2OiBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ0RJVicpLFxuICAgICAgaXNMaTogaXNMaSxcbiAgICAgIGlzQlI6IG1ha2VQcmVkQnlOb2RlTmFtZSgnQlInKSxcbiAgICAgIGlzU3BhbjogbWFrZVByZWRCeU5vZGVOYW1lKCdTUEFOJyksXG4gICAgICBpc0I6IG1ha2VQcmVkQnlOb2RlTmFtZSgnQicpLFxuICAgICAgaXNVOiBtYWtlUHJlZEJ5Tm9kZU5hbWUoJ1UnKSxcbiAgICAgIGlzUzogbWFrZVByZWRCeU5vZGVOYW1lKCdTJyksXG4gICAgICBpc0k6IG1ha2VQcmVkQnlOb2RlTmFtZSgnSScpLFxuICAgICAgaXNJbWc6IG1ha2VQcmVkQnlOb2RlTmFtZSgnSU1HJyksXG4gICAgICBpc1RleHRhcmVhOiBpc1RleHRhcmVhLFxuICAgICAgaXNFbXB0eTogaXNFbXB0eSxcbiAgICAgIGlzRW1wdHlBbmNob3I6IGZ1bmMuYW5kKGlzQW5jaG9yLCBpc0VtcHR5KSxcbiAgICAgIGlzQ2xvc2VzdFNpYmxpbmc6IGlzQ2xvc2VzdFNpYmxpbmcsXG4gICAgICB3aXRoQ2xvc2VzdFNpYmxpbmdzOiB3aXRoQ2xvc2VzdFNpYmxpbmdzLFxuICAgICAgbm9kZUxlbmd0aDogbm9kZUxlbmd0aCxcbiAgICAgIGlzTGVmdEVkZ2VQb2ludDogaXNMZWZ0RWRnZVBvaW50LFxuICAgICAgaXNSaWdodEVkZ2VQb2ludDogaXNSaWdodEVkZ2VQb2ludCxcbiAgICAgIGlzRWRnZVBvaW50OiBpc0VkZ2VQb2ludCxcbiAgICAgIGlzTGVmdEVkZ2VPZjogaXNMZWZ0RWRnZU9mLFxuICAgICAgaXNSaWdodEVkZ2VPZjogaXNSaWdodEVkZ2VPZixcbiAgICAgIGlzTGVmdEVkZ2VQb2ludE9mOiBpc0xlZnRFZGdlUG9pbnRPZixcbiAgICAgIGlzUmlnaHRFZGdlUG9pbnRPZjogaXNSaWdodEVkZ2VQb2ludE9mLFxuICAgICAgcHJldlBvaW50OiBwcmV2UG9pbnQsXG4gICAgICBuZXh0UG9pbnQ6IG5leHRQb2ludCxcbiAgICAgIGlzU2FtZVBvaW50OiBpc1NhbWVQb2ludCxcbiAgICAgIGlzVmlzaWJsZVBvaW50OiBpc1Zpc2libGVQb2ludCxcbiAgICAgIHByZXZQb2ludFVudGlsOiBwcmV2UG9pbnRVbnRpbCxcbiAgICAgIG5leHRQb2ludFVudGlsOiBuZXh0UG9pbnRVbnRpbCxcbiAgICAgIGlzQ2hhclBvaW50OiBpc0NoYXJQb2ludCxcbiAgICAgIHdhbGtQb2ludDogd2Fsa1BvaW50LFxuICAgICAgYW5jZXN0b3I6IGFuY2VzdG9yLFxuICAgICAgc2luZ2xlQ2hpbGRBbmNlc3Rvcjogc2luZ2xlQ2hpbGRBbmNlc3RvcixcbiAgICAgIGxpc3RBbmNlc3RvcjogbGlzdEFuY2VzdG9yLFxuICAgICAgbGFzdEFuY2VzdG9yOiBsYXN0QW5jZXN0b3IsXG4gICAgICBsaXN0TmV4dDogbGlzdE5leHQsXG4gICAgICBsaXN0UHJldjogbGlzdFByZXYsXG4gICAgICBsaXN0RGVzY2VuZGFudDogbGlzdERlc2NlbmRhbnQsXG4gICAgICBjb21tb25BbmNlc3RvcjogY29tbW9uQW5jZXN0b3IsXG4gICAgICB3cmFwOiB3cmFwLFxuICAgICAgaW5zZXJ0QWZ0ZXI6IGluc2VydEFmdGVyLFxuICAgICAgYXBwZW5kQ2hpbGROb2RlczogYXBwZW5kQ2hpbGROb2RlcyxcbiAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgIGhhc0NoaWxkcmVuOiBoYXNDaGlsZHJlbixcbiAgICAgIG1ha2VPZmZzZXRQYXRoOiBtYWtlT2Zmc2V0UGF0aCxcbiAgICAgIGZyb21PZmZzZXRQYXRoOiBmcm9tT2Zmc2V0UGF0aCxcbiAgICAgIHNwbGl0VHJlZTogc3BsaXRUcmVlLFxuICAgICAgc3BsaXRQb2ludDogc3BsaXRQb2ludCxcbiAgICAgIGNyZWF0ZTogY3JlYXRlLFxuICAgICAgY3JlYXRlVGV4dDogY3JlYXRlVGV4dCxcbiAgICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgICAgcmVtb3ZlV2hpbGU6IHJlbW92ZVdoaWxlLFxuICAgICAgcmVwbGFjZTogcmVwbGFjZSxcbiAgICAgIGh0bWw6IGh0bWwsXG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBwb3NGcm9tUGxhY2Vob2xkZXI6IHBvc0Zyb21QbGFjZWhvbGRlcixcbiAgICAgIGF0dGFjaEV2ZW50czogYXR0YWNoRXZlbnRzLFxuICAgICAgZGV0YWNoRXZlbnRzOiBkZXRhY2hFdmVudHNcbiAgICB9O1xuICB9KSgpO1xuXG4gIC8qKlxuICAgKiBAcGFyYW0ge2pRdWVyeX0gJG5vdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHJldHVybiB7Q29udGV4dH1cbiAgICovXG4gIHZhciBDb250ZXh0ID0gZnVuY3Rpb24gKCRub3RlLCBvcHRpb25zKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHVpID0gJC5zdW1tZXJub3RlLnVpO1xuICAgIHRoaXMubWVtb3MgPSB7fTtcbiAgICB0aGlzLm1vZHVsZXMgPSB7fTtcbiAgICB0aGlzLmxheW91dEluZm8gPSB7fTtcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgLyoqXG4gICAgICogY3JlYXRlIGxheW91dCBhbmQgaW5pdGlhbGl6ZSBtb2R1bGVzIGFuZCBvdGhlciByZXNvdXJjZXNcbiAgICAgKi9cbiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmxheW91dEluZm8gPSB1aS5jcmVhdGVMYXlvdXQoJG5vdGUsIG9wdGlvbnMpO1xuICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgICAgJG5vdGUuaGlkZSgpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGRlc3Ryb3kgbW9kdWxlcyBhbmQgb3RoZXIgcmVzb3VyY2VzIGFuZCByZW1vdmUgbGF5b3V0XG4gICAgICovXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fZGVzdHJveSgpO1xuICAgICAgJG5vdGUucmVtb3ZlRGF0YSgnc3VtbWVybm90ZScpO1xuICAgICAgdWkucmVtb3ZlTGF5b3V0KCRub3RlLCB0aGlzLmxheW91dEluZm8pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBkZXN0b3J5IG1vZHVsZXMgYW5kIG90aGVyIHJlc291cmNlcyBhbmQgaW5pdGlhbGl6ZSBpdCBhZ2FpblxuICAgICAqL1xuICAgIHRoaXMucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZGlzYWJsZWQgPSBzZWxmLmlzRGlzYWJsZWQoKTtcbiAgICAgIHRoaXMuY29kZShkb20uZW1wdHlQYXJhKTtcbiAgICAgIHRoaXMuX2Rlc3Ryb3koKTtcbiAgICAgIHRoaXMuX2luaXRpYWxpemUoKTtcblxuICAgICAgaWYgKGRpc2FibGVkKSB7XG4gICAgICAgIHNlbGYuZGlzYWJsZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy8gYWRkIG9wdGlvbmFsIGJ1dHRvbnNcbiAgICAgIHZhciBidXR0b25zID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucy5idXR0b25zKTtcbiAgICAgIE9iamVjdC5rZXlzKGJ1dHRvbnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBzZWxmLm1lbW8oJ2J1dHRvbi4nICsga2V5LCBidXR0b25zW2tleV0pO1xuICAgICAgfSk7XG5cbiAgICAgIHZhciBtb2R1bGVzID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucy5tb2R1bGVzLCAkLnN1bW1lcm5vdGUucGx1Z2lucyB8fCB7fSk7XG5cbiAgICAgIC8vIGFkZCBhbmQgaW5pdGlhbGl6ZSBtb2R1bGVzXG4gICAgICBPYmplY3Qua2V5cyhtb2R1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgc2VsZi5tb2R1bGUoa2V5LCBtb2R1bGVzW2tleV0sIHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIE9iamVjdC5rZXlzKHRoaXMubW9kdWxlcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHNlbGYuaW5pdGlhbGl6ZU1vZHVsZShrZXkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuX2Rlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBkZXN0cm95IG1vZHVsZXMgd2l0aCByZXZlcnNlZCBvcmRlclxuICAgICAgT2JqZWN0LmtleXModGhpcy5tb2R1bGVzKS5yZXZlcnNlKCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHNlbGYucmVtb3ZlTW9kdWxlKGtleSk7XG4gICAgICB9KTtcblxuICAgICAgT2JqZWN0LmtleXModGhpcy5tZW1vcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHNlbGYucmVtb3ZlTWVtbyhrZXkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuY29kZSA9IGZ1bmN0aW9uIChodG1sKSB7XG4gICAgICB2YXIgaXNBY3RpdmF0ZWQgPSB0aGlzLmludm9rZSgnY29kZXZpZXcuaXNBY3RpdmF0ZWQnKTtcblxuICAgICAgaWYgKGh0bWwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLmludm9rZSgnY29kZXZpZXcuc3luYycpO1xuICAgICAgICByZXR1cm4gaXNBY3RpdmF0ZWQgPyB0aGlzLmxheW91dEluZm8uY29kYWJsZS52YWwoKSA6IHRoaXMubGF5b3V0SW5mby5lZGl0YWJsZS5odG1sKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaXNBY3RpdmF0ZWQpIHtcbiAgICAgICAgICB0aGlzLmxheW91dEluZm8uY29kYWJsZS52YWwoaHRtbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5sYXlvdXRJbmZvLmVkaXRhYmxlLmh0bWwoaHRtbCk7XG4gICAgICAgIH1cbiAgICAgICAgJG5vdGUudmFsKGh0bWwpO1xuICAgICAgICB0aGlzLnRyaWdnZXJFdmVudCgnY2hhbmdlJywgaHRtbCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuaXNEaXNhYmxlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmxheW91dEluZm8uZWRpdGFibGUuYXR0cignY29udGVudGVkaXRhYmxlJykgPT09ICdmYWxzZSc7XG4gICAgfTtcblxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5sYXlvdXRJbmZvLmVkaXRhYmxlLmF0dHIoJ2NvbnRlbnRlZGl0YWJsZScsIHRydWUpO1xuICAgICAgdGhpcy5pbnZva2UoJ3Rvb2xiYXIuYWN0aXZhdGUnLCB0cnVlKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy8gY2xvc2UgY29kZXZpZXcgaWYgY29kZXZpZXcgaXMgb3BlbmRcbiAgICAgIGlmICh0aGlzLmludm9rZSgnY29kZXZpZXcuaXNBY3RpdmF0ZWQnKSkge1xuICAgICAgICB0aGlzLmludm9rZSgnY29kZXZpZXcuZGVhY3RpdmF0ZScpO1xuICAgICAgfVxuICAgICAgdGhpcy5sYXlvdXRJbmZvLmVkaXRhYmxlLmF0dHIoJ2NvbnRlbnRlZGl0YWJsZScsIGZhbHNlKTtcbiAgICAgIHRoaXMuaW52b2tlKCd0b29sYmFyLmRlYWN0aXZhdGUnLCB0cnVlKTtcbiAgICB9O1xuXG4gICAgdGhpcy50cmlnZ2VyRXZlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbmFtZXNwYWNlID0gbGlzdC5oZWFkKGFyZ3VtZW50cyk7XG4gICAgICB2YXIgYXJncyA9IGxpc3QudGFpbChsaXN0LmZyb20oYXJndW1lbnRzKSk7XG5cbiAgICAgIHZhciBjYWxsYmFjayA9IHRoaXMub3B0aW9ucy5jYWxsYmFja3NbZnVuYy5uYW1lc3BhY2VUb0NhbWVsKG5hbWVzcGFjZSwgJ29uJyldO1xuICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrLmFwcGx5KCRub3RlWzBdLCBhcmdzKTtcbiAgICAgIH1cbiAgICAgICRub3RlLnRyaWdnZXIoJ3N1bW1lcm5vdGUuJyArIG5hbWVzcGFjZSwgYXJncyk7XG4gICAgfTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZU1vZHVsZSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHZhciBtb2R1bGUgPSB0aGlzLm1vZHVsZXNba2V5XTtcbiAgICAgIG1vZHVsZS5zaG91bGRJbml0aWFsaXplID0gbW9kdWxlLnNob3VsZEluaXRpYWxpemUgfHwgZnVuYy5vaztcbiAgICAgIGlmICghbW9kdWxlLnNob3VsZEluaXRpYWxpemUoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIGluaXRpYWxpemUgbW9kdWxlXG4gICAgICBpZiAobW9kdWxlLmluaXRpYWxpemUpIHtcbiAgICAgICAgbW9kdWxlLmluaXRpYWxpemUoKTtcbiAgICAgIH1cblxuICAgICAgLy8gYXR0YWNoIGV2ZW50c1xuICAgICAgaWYgKG1vZHVsZS5ldmVudHMpIHtcbiAgICAgICAgZG9tLmF0dGFjaEV2ZW50cygkbm90ZSwgbW9kdWxlLmV2ZW50cyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMubW9kdWxlID0gZnVuY3Rpb24gKGtleSwgTW9kdWxlQ2xhc3MsIHdpdGhvdXRJbnRpYWxpemUpIHtcbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZHVsZXNba2V5XTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5tb2R1bGVzW2tleV0gPSBuZXcgTW9kdWxlQ2xhc3ModGhpcyk7XG5cbiAgICAgIGlmICghd2l0aG91dEludGlhbGl6ZSkge1xuICAgICAgICB0aGlzLmluaXRpYWxpemVNb2R1bGUoa2V5KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5yZW1vdmVNb2R1bGUgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICB2YXIgbW9kdWxlID0gdGhpcy5tb2R1bGVzW2tleV07XG4gICAgICBpZiAobW9kdWxlLnNob3VsZEluaXRpYWxpemUoKSkge1xuICAgICAgICBpZiAobW9kdWxlLmV2ZW50cykge1xuICAgICAgICAgIGRvbS5kZXRhY2hFdmVudHMoJG5vdGUsIG1vZHVsZS5ldmVudHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1vZHVsZS5kZXN0cm95KSB7XG4gICAgICAgICAgbW9kdWxlLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkZWxldGUgdGhpcy5tb2R1bGVzW2tleV07XG4gICAgfTtcblxuICAgIHRoaXMubWVtbyA9IGZ1bmN0aW9uIChrZXksIG9iaikge1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWVtb3Nba2V5XTtcbiAgICAgIH1cbiAgICAgIHRoaXMubWVtb3Nba2V5XSA9IG9iajtcbiAgICB9O1xuXG4gICAgdGhpcy5yZW1vdmVNZW1vID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgaWYgKHRoaXMubWVtb3Nba2V5XSAmJiB0aGlzLm1lbW9zW2tleV0uZGVzdHJveSkge1xuICAgICAgICB0aGlzLm1lbW9zW2tleV0uZGVzdHJveSgpO1xuICAgICAgfVxuXG4gICAgICBkZWxldGUgdGhpcy5tZW1vc1trZXldO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZUludm9rZUhhbmRsZXIgPSBmdW5jdGlvbiAobmFtZXNwYWNlLCB2YWx1ZSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBzZWxmLmludm9rZShuYW1lc3BhY2UsIHZhbHVlIHx8ICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCdbZGF0YS12YWx1ZV0nKS5kYXRhKCd2YWx1ZScpKTtcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHRoaXMuaW52b2tlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG5hbWVzcGFjZSA9IGxpc3QuaGVhZChhcmd1bWVudHMpO1xuICAgICAgdmFyIGFyZ3MgPSBsaXN0LnRhaWwobGlzdC5mcm9tKGFyZ3VtZW50cykpO1xuXG4gICAgICB2YXIgc3BsaXRzID0gbmFtZXNwYWNlLnNwbGl0KCcuJyk7XG4gICAgICB2YXIgaGFzU2VwYXJhdG9yID0gc3BsaXRzLmxlbmd0aCA+IDE7XG4gICAgICB2YXIgbW9kdWxlTmFtZSA9IGhhc1NlcGFyYXRvciAmJiBsaXN0LmhlYWQoc3BsaXRzKTtcbiAgICAgIHZhciBtZXRob2ROYW1lID0gaGFzU2VwYXJhdG9yID8gbGlzdC5sYXN0KHNwbGl0cykgOiBsaXN0LmhlYWQoc3BsaXRzKTtcblxuICAgICAgdmFyIG1vZHVsZSA9IHRoaXMubW9kdWxlc1ttb2R1bGVOYW1lIHx8ICdlZGl0b3InXTtcbiAgICAgIGlmICghbW9kdWxlTmFtZSAmJiB0aGlzW21ldGhvZE5hbWVdKSB7XG4gICAgICAgIHJldHVybiB0aGlzW21ldGhvZE5hbWVdLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgfSBlbHNlIGlmIChtb2R1bGUgJiYgbW9kdWxlW21ldGhvZE5hbWVdICYmIG1vZHVsZS5zaG91bGRJbml0aWFsaXplKCkpIHtcbiAgICAgICAgcmV0dXJuIG1vZHVsZVttZXRob2ROYW1lXS5hcHBseShtb2R1bGUsIGFyZ3MpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXplKCk7XG4gIH07XG5cbiAgJC5mbi5leHRlbmQoe1xuICAgIC8qKlxuICAgICAqIFN1bW1lcm5vdGUgQVBJXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdHxTdHJpbmd9XG4gICAgICogQHJldHVybiB7dGhpc31cbiAgICAgKi9cbiAgICBzdW1tZXJub3RlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdHlwZSA9ICQudHlwZShsaXN0LmhlYWQoYXJndW1lbnRzKSk7XG4gICAgICB2YXIgaXNFeHRlcm5hbEFQSUNhbGxlZCA9IHR5cGUgPT09ICdzdHJpbmcnO1xuICAgICAgdmFyIGhhc0luaXRPcHRpb25zID0gdHlwZSA9PT0gJ29iamVjdCc7XG5cbiAgICAgIHZhciBvcHRpb25zID0gaGFzSW5pdE9wdGlvbnMgPyBsaXN0LmhlYWQoYXJndW1lbnRzKSA6IHt9O1xuXG4gICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sICQuc3VtbWVybm90ZS5vcHRpb25zLCBvcHRpb25zKTtcbiAgICAgIG9wdGlvbnMubGFuZ0luZm8gPSAkLmV4dGVuZCh0cnVlLCB7fSwgJC5zdW1tZXJub3RlLmxhbmdbJ2VuLVVTJ10sICQuc3VtbWVybm90ZS5sYW5nW29wdGlvbnMubGFuZ10pO1xuICAgICAgb3B0aW9ucy5pY29ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCAkLnN1bW1lcm5vdGUub3B0aW9ucy5pY29ucywgb3B0aW9ucy5pY29ucyk7XG5cbiAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaWR4LCBub3RlKSB7XG4gICAgICAgIHZhciAkbm90ZSA9ICQobm90ZSk7XG4gICAgICAgIGlmICghJG5vdGUuZGF0YSgnc3VtbWVybm90ZScpKSB7XG4gICAgICAgICAgdmFyIGNvbnRleHQgPSBuZXcgQ29udGV4dCgkbm90ZSwgb3B0aW9ucyk7XG4gICAgICAgICAgJG5vdGUuZGF0YSgnc3VtbWVybm90ZScsIGNvbnRleHQpO1xuICAgICAgICAgICRub3RlLmRhdGEoJ3N1bW1lcm5vdGUnKS50cmlnZ2VyRXZlbnQoJ2luaXQnLCBjb250ZXh0LmxheW91dEluZm8pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdmFyICRub3RlID0gdGhpcy5maXJzdCgpO1xuICAgICAgaWYgKCRub3RlLmxlbmd0aCkge1xuICAgICAgICB2YXIgY29udGV4dCA9ICRub3RlLmRhdGEoJ3N1bW1lcm5vdGUnKTtcbiAgICAgICAgaWYgKGlzRXh0ZXJuYWxBUElDYWxsZWQpIHtcbiAgICAgICAgICByZXR1cm4gY29udGV4dC5pbnZva2UuYXBwbHkoY29udGV4dCwgbGlzdC5mcm9tKGFyZ3VtZW50cykpO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMuZm9jdXMpIHtcbiAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmZvY3VzJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICB9KTtcblxuXG4gIHZhciBSZW5kZXJlciA9IGZ1bmN0aW9uIChtYXJrdXAsIGNoaWxkcmVuLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCRwYXJlbnQpIHtcbiAgICAgIHZhciAkbm9kZSA9ICQobWFya3VwKTtcblxuICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jb250ZW50cykge1xuICAgICAgICAkbm9kZS5odG1sKG9wdGlvbnMuY29udGVudHMpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNsYXNzTmFtZSkge1xuICAgICAgICAkbm9kZS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzTmFtZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZGF0YSkge1xuICAgICAgICAkLmVhY2gob3B0aW9ucy5kYXRhLCBmdW5jdGlvbiAoaywgdikge1xuICAgICAgICAgICRub2RlLmF0dHIoJ2RhdGEtJyArIGssIHYpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jbGljaykge1xuICAgICAgICAkbm9kZS5vbignY2xpY2snLCBvcHRpb25zLmNsaWNrKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciAkY29udGFpbmVyID0gJG5vZGUuZmluZCgnLm5vdGUtY2hpbGRyZW4tY29udGFpbmVyJyk7XG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgICAgY2hpbGQucmVuZGVyKCRjb250YWluZXIubGVuZ3RoID8gJGNvbnRhaW5lciA6ICRub2RlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjaygkbm9kZSwgb3B0aW9ucyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY2FsbGJhY2spIHtcbiAgICAgICAgb3B0aW9ucy5jYWxsYmFjaygkbm9kZSk7XG4gICAgICB9XG5cbiAgICAgIGlmICgkcGFyZW50KSB7XG4gICAgICAgICRwYXJlbnQuYXBwZW5kKCRub2RlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICRub2RlO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIHJlbmRlcmVyID0ge1xuICAgIGNyZWF0ZTogZnVuY3Rpb24gKG1hcmt1cCwgY2FsbGJhY2spIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjaGlsZHJlbiA9ICQuaXNBcnJheShhcmd1bWVudHNbMF0pID8gYXJndW1lbnRzWzBdIDogW107XG4gICAgICAgIHZhciBvcHRpb25zID0gdHlwZW9mIGFyZ3VtZW50c1sxXSA9PT0gJ29iamVjdCcgPyBhcmd1bWVudHNbMV0gOiBhcmd1bWVudHNbMF07XG4gICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjaGlsZHJlbiA9IG9wdGlvbnMuY2hpbGRyZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBSZW5kZXJlcihtYXJrdXAsIGNoaWxkcmVuLCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgICB9O1xuICAgIH1cbiAgfTtcblxuICB2YXIgZWRpdG9yID0gcmVuZGVyZXIuY3JlYXRlKCc8ZGl2IGNsYXNzPVwibm90ZS1lZGl0b3Igbm90ZS1mcmFtZVwiLz4nKTtcbiAgdmFyIHRvb2xiYXIgPSByZW5kZXJlci5jcmVhdGUoJzxkaXYgY2xhc3M9XCJub3RlLXRvb2xiYXJcIi8+Jyk7XG4gIHZhciBlZGl0aW5nQXJlYSA9IHJlbmRlcmVyLmNyZWF0ZSgnPGRpdiBjbGFzcz1cIm5vdGUtZWRpdGluZy1hcmVhXCIvPicpO1xuICB2YXIgY29kYWJsZSA9IHJlbmRlcmVyLmNyZWF0ZSgnPHRleHRhcmVhIGNsYXNzPVwibm90ZS1jb2RhYmxlXCIvPicpO1xuICB2YXIgZWRpdGFibGUgPSByZW5kZXJlci5jcmVhdGUoJzxkaXYgY2xhc3M9XCJub3RlLWVkaXRhYmxlXCIgY29udGVudEVkaXRhYmxlPVwidHJ1ZVwiLz4nKTtcbiAgdmFyIHN0YXR1c2JhciA9IHJlbmRlcmVyLmNyZWF0ZShbXG4gICAgJzxkaXYgY2xhc3M9XCJub3RlLXN0YXR1c2JhclwiPicsXG4gICAgJyAgPGRpdiBjbGFzcz1cIm5vdGUtcmVzaXplYmFyXCI+JyxcbiAgICAnICAgIDxkaXYgY2xhc3M9XCJub3RlLWljb24tYmFyXCIvPicsXG4gICAgJyAgICA8ZGl2IGNsYXNzPVwibm90ZS1pY29uLWJhclwiLz4nLFxuICAgICcgICAgPGRpdiBjbGFzcz1cIm5vdGUtaWNvbi1iYXJcIi8+JyxcbiAgICAnICA8L2Rpdj4nLFxuICAgICc8L2Rpdj4nXG4gIF0uam9pbignJykpO1xuXG4gIHZhciBhaXJFZGl0b3IgPSByZW5kZXJlci5jcmVhdGUoJzxkaXYgY2xhc3M9XCJub3RlLWVkaXRvclwiLz4nKTtcbiAgdmFyIGFpckVkaXRhYmxlID0gcmVuZGVyZXIuY3JlYXRlKCc8ZGl2IGNsYXNzPVwibm90ZS1lZGl0YWJsZVwiIGNvbnRlbnRFZGl0YWJsZT1cInRydWVcIi8+Jyk7XG5cbiAgdmFyIGJ1dHRvbkdyb3VwID0gcmVuZGVyZXIuY3JlYXRlKCc8ZGl2IGNsYXNzPVwibm90ZS1idG4tZ3JvdXAgYnRuLWdyb3VwXCI+Jyk7XG4gIHZhciBidXR0b24gPSByZW5kZXJlci5jcmVhdGUoJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwibm90ZS1idG4gYnRuIC1kYXJrIGJ0bi1zbVwiIHRhYmluZGV4PVwiLTFcIj4nLCBmdW5jdGlvbiAoJG5vZGUsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnRvb2x0aXApIHtcbiAgICAgICRub2RlLmF0dHIoe1xuICAgICAgICB0aXRsZTogb3B0aW9ucy50b29sdGlwXG4gICAgICB9KS50b29sdGlwKHtcbiAgICAgICAgY29udGFpbmVyOiAnYm9keScsXG4gICAgICAgIHRyaWdnZXI6ICdob3ZlcicsXG4gICAgICAgIHBsYWNlbWVudDogJ2JvdHRvbSdcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIGRyb3Bkb3duID0gcmVuZGVyZXIuY3JlYXRlKCc8ZGl2IGNsYXNzPVwiZHJvcGRvd24tbWVudSAtZGFya1wiPicsIGZ1bmN0aW9uICgkbm9kZSwgb3B0aW9ucykge1xuICAgIHZhciBtYXJrdXAgPSAkLmlzQXJyYXkob3B0aW9ucy5pdGVtcykgPyBvcHRpb25zLml0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIHZhbHVlID0gKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykgPyBpdGVtIDogKGl0ZW0udmFsdWUgfHwgJycpO1xuICAgICAgdmFyIGNvbnRlbnQgPSBvcHRpb25zLnRlbXBsYXRlID8gb3B0aW9ucy50ZW1wbGF0ZShpdGVtKSA6IGl0ZW07XG4gICAgICByZXR1cm4gJzxsaT48YSBocmVmPVwiI1wiIGRhdGEtdmFsdWU9XCInICsgdmFsdWUgKyAnXCI+JyArIGNvbnRlbnQgKyAnPC9hPjwvbGk+JztcbiAgICB9KS5qb2luKCcnKSA6IG9wdGlvbnMuaXRlbXM7XG5cbiAgICAkbm9kZS5odG1sKG1hcmt1cCk7XG4gIH0pO1xuXG4gIHZhciBkcm9wZG93bkNoZWNrID0gcmVuZGVyZXIuY3JlYXRlKCc8ZGl2IGNsYXNzPVwiZHJvcGRvd24tbWVudSAtZGFyayBub3RlLWNoZWNrXCI+JywgZnVuY3Rpb24gKCRub2RlLCBvcHRpb25zKSB7XG4gICAgdmFyIG1hcmt1cCA9ICQuaXNBcnJheShvcHRpb25zLml0ZW1zKSA/IG9wdGlvbnMuaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICB2YXIgdmFsdWUgPSAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKSA/IGl0ZW0gOiAoaXRlbS52YWx1ZSB8fCAnJyk7XG4gICAgICB2YXIgY29udGVudCA9IG9wdGlvbnMudGVtcGxhdGUgPyBvcHRpb25zLnRlbXBsYXRlKGl0ZW0pIDogaXRlbTtcbiAgICAgIHJldHVybiAnPGxpPjxhIGhyZWY9XCIjXCIgZGF0YS12YWx1ZT1cIicgKyB2YWx1ZSArICdcIj4nICsgaWNvbihvcHRpb25zLmNoZWNrQ2xhc3NOYW1lKSArICcgJyArIGNvbnRlbnQgKyAnPC9hPjwvbGk+JztcbiAgICB9KS5qb2luKCcnKSA6IG9wdGlvbnMuaXRlbXM7XG4gICAgJG5vZGUuaHRtbChtYXJrdXApO1xuICB9KTtcblxuICB2YXIgcGFsZXR0ZSA9IHJlbmRlcmVyLmNyZWF0ZSgnPGRpdiBjbGFzcz1cIm5vdGUtY29sb3ItcGFsZXR0ZVwiLz4nLCBmdW5jdGlvbiAoJG5vZGUsIG9wdGlvbnMpIHtcbiAgICB2YXIgY29udGVudHMgPSBbXTtcbiAgICBmb3IgKHZhciByb3cgPSAwLCByb3dTaXplID0gb3B0aW9ucy5jb2xvcnMubGVuZ3RoOyByb3cgPCByb3dTaXplOyByb3crKykge1xuICAgICAgdmFyIGV2ZW50TmFtZSA9IG9wdGlvbnMuZXZlbnROYW1lO1xuICAgICAgdmFyIGNvbG9ycyA9IG9wdGlvbnMuY29sb3JzW3Jvd107XG4gICAgICB2YXIgYnV0dG9ucyA9IFtdO1xuICAgICAgZm9yICh2YXIgY29sID0gMCwgY29sU2l6ZSA9IGNvbG9ycy5sZW5ndGg7IGNvbCA8IGNvbFNpemU7IGNvbCsrKSB7XG4gICAgICAgIHZhciBjb2xvciA9IGNvbG9yc1tjb2xdO1xuICAgICAgICBidXR0b25zLnB1c2goW1xuICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cIm5vdGUtY29sb3ItYnRuXCInLFxuICAgICAgICAgICdzdHlsZT1cImJhY2tncm91bmQtY29sb3I6JywgY29sb3IsICdcIiAnLFxuICAgICAgICAgICdkYXRhLWV2ZW50PVwiJywgZXZlbnROYW1lLCAnXCIgJyxcbiAgICAgICAgICAnZGF0YS12YWx1ZT1cIicsIGNvbG9yLCAnXCIgJyxcbiAgICAgICAgICAndGl0bGU9XCInLCBjb2xvciwgJ1wiICcsXG4gICAgICAgICAgJ2RhdGEtdG9nZ2xlPVwiYnV0dG9uXCIgdGFiaW5kZXg9XCItMVwiPjwvYnV0dG9uPidcbiAgICAgICAgXS5qb2luKCcnKSk7XG4gICAgICB9XG4gICAgICBjb250ZW50cy5wdXNoKCc8ZGl2IGNsYXNzPVwibm90ZS1jb2xvci1yb3dcIj4nICsgYnV0dG9ucy5qb2luKCcnKSArICc8L2Rpdj4nKTtcbiAgICB9XG4gICAgJG5vZGUuaHRtbChjb250ZW50cy5qb2luKCcnKSk7XG5cbiAgICAkbm9kZS5maW5kKCcubm90ZS1jb2xvci1idG4nKS50b29sdGlwKHtcbiAgICAgIGNvbnRhaW5lcjogJ2JvZHknLFxuICAgICAgdHJpZ2dlcjogJ2hvdmVyJyxcbiAgICAgIHBsYWNlbWVudDogJ2JvdHRvbSdcbiAgICB9KTtcbiAgfSk7XG5cbiAgdmFyIGRpYWxvZyA9IHJlbmRlcmVyLmNyZWF0ZSgnPGRpdiBjbGFzcz1cIm1vZGFsIC1wcmltYXJ5XCIgYXJpYS1oaWRkZW49XCJmYWxzZVwiIHRhYmluZGV4PVwiLTFcIi8+JywgZnVuY3Rpb24gKCRub2RlLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMuZmFkZSkge1xuICAgICAgJG5vZGUuYWRkQ2xhc3MoJ2ZhZGUnKTtcbiAgICB9XG4gICAgJG5vZGUuaHRtbChbXG4gICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZ1wiPicsXG4gICAgICAnICA8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiPicsXG4gICAgICAob3B0aW9ucy50aXRsZSA/XG4gICAgICAnICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj4nICtcbiAgICAgICcgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImNsb3NlIF90ZXh0LXdoaXRlXCIgZGF0YS1kaXNtaXNzPVwibW9kYWxcIiBhcmlhLWxhYmVsPVwiQ2xvc2VcIj48c3BhbiBhcmlhLWhpZGRlbj1cInRydWVcIj4mdGltZXM7PC9zcGFuPjwvYnV0dG9uPicgK1xuICAgICAgJyAgICAgIDxoNCBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+JyArIG9wdGlvbnMudGl0bGUgKyAnPC9oND4nICtcbiAgICAgICcgICAgPC9kaXY+JyA6ICcnXG4gICAgICApLFxuICAgICAgJyAgICA8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPicgKyBvcHRpb25zLmJvZHkgKyAnPC9kaXY+JyxcbiAgICAgIChvcHRpb25zLmZvb3RlciA/XG4gICAgICAnICAgIDxkaXYgY2xhc3M9XCJtb2RhbC1mb290ZXJcIj4nICsgb3B0aW9ucy5mb290ZXIgKyAnPC9kaXY+JyA6ICcnXG4gICAgICApLFxuICAgICAgJyAgPC9kaXY+JyxcbiAgICAgICc8L2Rpdj4nXG4gICAgXS5qb2luKCcnKSk7XG4gIH0pO1xuXG4gIHZhciBwb3BvdmVyID0gcmVuZGVyZXIuY3JlYXRlKFtcbiAgICAnPGRpdiBjbGFzcz1cIm5vdGUtcG9wb3ZlciBwb3BvdmVyIGluXCI+JyxcbiAgICAnICA8ZGl2IGNsYXNzPVwiYXJyb3dcIi8+JyxcbiAgICAnICA8ZGl2IGNsYXNzPVwicG9wb3Zlci1jb250ZW50IG5vdGUtY2hpbGRyZW4tY29udGFpbmVyXCIvPicsXG4gICAgJzwvZGl2PidcbiAgXS5qb2luKCcnKSwgZnVuY3Rpb24gKCRub2RlLCBvcHRpb25zKSB7XG4gICAgdmFyIGRpcmVjdGlvbiA9IHR5cGVvZiBvcHRpb25zLmRpcmVjdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmRpcmVjdGlvbiA6ICdib3R0b20nO1xuXG4gICAgJG5vZGUuYWRkQ2xhc3MoZGlyZWN0aW9uKTtcblxuICAgIGlmIChvcHRpb25zLmhpZGVBcnJvdykge1xuICAgICAgJG5vZGUuZmluZCgnLmFycm93JykuaGlkZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgdmFyIGljb24gPSBmdW5jdGlvbiAoaWNvbkNsYXNzTmFtZSwgdGFnTmFtZSkge1xuICAgIHRhZ05hbWUgPSB0YWdOYW1lIHx8ICdpJztcbiAgICByZXR1cm4gJzwnICsgdGFnTmFtZSArICcgY2xhc3M9XCInICsgaWNvbkNsYXNzTmFtZSArICdcIi8+JztcbiAgfTtcblxuICB2YXIgdWkgPSB7XG4gICAgZWRpdG9yOiBlZGl0b3IsXG4gICAgdG9vbGJhcjogdG9vbGJhcixcbiAgICBlZGl0aW5nQXJlYTogZWRpdGluZ0FyZWEsXG4gICAgY29kYWJsZTogY29kYWJsZSxcbiAgICBlZGl0YWJsZTogZWRpdGFibGUsXG4gICAgc3RhdHVzYmFyOiBzdGF0dXNiYXIsXG4gICAgYWlyRWRpdG9yOiBhaXJFZGl0b3IsXG4gICAgYWlyRWRpdGFibGU6IGFpckVkaXRhYmxlLFxuICAgIGJ1dHRvbkdyb3VwOiBidXR0b25Hcm91cCxcbiAgICBidXR0b246IGJ1dHRvbixcbiAgICBkcm9wZG93bjogZHJvcGRvd24sXG4gICAgZHJvcGRvd25DaGVjazogZHJvcGRvd25DaGVjayxcbiAgICBwYWxldHRlOiBwYWxldHRlLFxuICAgIGRpYWxvZzogZGlhbG9nLFxuICAgIHBvcG92ZXI6IHBvcG92ZXIsXG4gICAgaWNvbjogaWNvbixcblxuICAgIHRvZ2dsZUJ0bjogZnVuY3Rpb24gKCRidG4sIGlzRW5hYmxlKSB7XG4gICAgICAkYnRuLnRvZ2dsZUNsYXNzKCdkaXNhYmxlZCcsICFpc0VuYWJsZSk7XG4gICAgICAkYnRuLmF0dHIoJ2Rpc2FibGVkJywgIWlzRW5hYmxlKTtcbiAgICB9LFxuXG4gICAgdG9nZ2xlQnRuQWN0aXZlOiBmdW5jdGlvbiAoJGJ0biwgaXNBY3RpdmUpIHtcbiAgICAgICRidG4udG9nZ2xlQ2xhc3MoJ2FjdGl2ZScsIGlzQWN0aXZlKTtcbiAgICB9LFxuXG4gICAgb25EaWFsb2dTaG93bjogZnVuY3Rpb24gKCRkaWFsb2csIGhhbmRsZXIpIHtcbiAgICAgICRkaWFsb2cub25lKCdzaG93bi5icy5tb2RhbCcsIGhhbmRsZXIpO1xuICAgIH0sXG5cbiAgICBvbkRpYWxvZ0hpZGRlbjogZnVuY3Rpb24gKCRkaWFsb2csIGhhbmRsZXIpIHtcbiAgICAgICRkaWFsb2cub25lKCdoaWRkZW4uYnMubW9kYWwnLCBoYW5kbGVyKTtcbiAgICB9LFxuXG4gICAgc2hvd0RpYWxvZzogZnVuY3Rpb24gKCRkaWFsb2cpIHtcbiAgICAgICRkaWFsb2cubW9kYWwoJ3Nob3cnKTtcbiAgICB9LFxuXG4gICAgaGlkZURpYWxvZzogZnVuY3Rpb24gKCRkaWFsb2cpIHtcbiAgICAgICRkaWFsb2cubW9kYWwoJ2hpZGUnKTtcbiAgICB9LFxuXG4gICAgY3JlYXRlTGF5b3V0OiBmdW5jdGlvbiAoJG5vdGUsIG9wdGlvbnMpIHtcbiAgICAgIHZhciAkZWRpdG9yID0gKG9wdGlvbnMuYWlyTW9kZSA/IHVpLmFpckVkaXRvcihbXG4gICAgICAgIHVpLmVkaXRpbmdBcmVhKFtcbiAgICAgICAgICB1aS5haXJFZGl0YWJsZSgpXG4gICAgICAgIF0pXG4gICAgICBdKSA6IHVpLmVkaXRvcihbXG4gICAgICAgIHVpLnRvb2xiYXIoKSxcbiAgICAgICAgdWkuZWRpdGluZ0FyZWEoW1xuICAgICAgICAgIHVpLmNvZGFibGUoKSxcbiAgICAgICAgICB1aS5lZGl0YWJsZSgpXG4gICAgICAgIF0pLFxuICAgICAgICB1aS5zdGF0dXNiYXIoKVxuICAgICAgXSkpLnJlbmRlcigpO1xuXG4gICAgICAkZWRpdG9yLmluc2VydEFmdGVyKCRub3RlKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbm90ZTogJG5vdGUsXG4gICAgICAgIGVkaXRvcjogJGVkaXRvcixcbiAgICAgICAgdG9vbGJhcjogJGVkaXRvci5maW5kKCcubm90ZS10b29sYmFyJyksXG4gICAgICAgIGVkaXRpbmdBcmVhOiAkZWRpdG9yLmZpbmQoJy5ub3RlLWVkaXRpbmctYXJlYScpLFxuICAgICAgICBlZGl0YWJsZTogJGVkaXRvci5maW5kKCcubm90ZS1lZGl0YWJsZScpLFxuICAgICAgICBjb2RhYmxlOiAkZWRpdG9yLmZpbmQoJy5ub3RlLWNvZGFibGUnKSxcbiAgICAgICAgc3RhdHVzYmFyOiAkZWRpdG9yLmZpbmQoJy5ub3RlLXN0YXR1c2JhcicpXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICByZW1vdmVMYXlvdXQ6IGZ1bmN0aW9uICgkbm90ZSwgbGF5b3V0SW5mbykge1xuICAgICAgJG5vdGUuaHRtbChsYXlvdXRJbmZvLmVkaXRhYmxlLmh0bWwoKSk7XG4gICAgICBsYXlvdXRJbmZvLmVkaXRvci5yZW1vdmUoKTtcbiAgICAgICRub3RlLnNob3coKTtcbiAgICB9XG4gIH07XG5cbiAgJC5zdW1tZXJub3RlID0gJC5zdW1tZXJub3RlIHx8IHtcbiAgICBsYW5nOiB7fVxuICB9O1xuXG4gICQuZXh0ZW5kKCQuc3VtbWVybm90ZS5sYW5nLCB7XG4gICAgJ2VuLVVTJzoge1xuICAgICAgZm9udDoge1xuICAgICAgICBib2xkOiAnQm9sZCcsXG4gICAgICAgIGl0YWxpYzogJ0l0YWxpYycsXG4gICAgICAgIHVuZGVybGluZTogJ1VuZGVybGluZScsXG4gICAgICAgIGNsZWFyOiAnUmVtb3ZlIEZvbnQgU3R5bGUnLFxuICAgICAgICBoZWlnaHQ6ICdMaW5lIEhlaWdodCcsXG4gICAgICAgIG5hbWU6ICdGb250IEZhbWlseScsXG4gICAgICAgIHN0cmlrZXRocm91Z2g6ICdTdHJpa2V0aHJvdWdoJyxcbiAgICAgICAgc3Vic2NyaXB0OiAnU3Vic2NyaXB0JyxcbiAgICAgICAgc3VwZXJzY3JpcHQ6ICdTdXBlcnNjcmlwdCcsXG4gICAgICAgIHNpemU6ICdGb250IFNpemUnXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgaW1hZ2U6ICdQaWN0dXJlJyxcbiAgICAgICAgaW5zZXJ0OiAnSW5zZXJ0IEltYWdlJyxcbiAgICAgICAgcmVzaXplRnVsbDogJ1Jlc2l6ZSBGdWxsJyxcbiAgICAgICAgcmVzaXplSGFsZjogJ1Jlc2l6ZSBIYWxmJyxcbiAgICAgICAgcmVzaXplUXVhcnRlcjogJ1Jlc2l6ZSBRdWFydGVyJyxcbiAgICAgICAgZmxvYXRMZWZ0OiAnRmxvYXQgTGVmdCcsXG4gICAgICAgIGZsb2F0UmlnaHQ6ICdGbG9hdCBSaWdodCcsXG4gICAgICAgIGZsb2F0Tm9uZTogJ0Zsb2F0IE5vbmUnLFxuICAgICAgICBzaGFwZVJvdW5kZWQ6ICdTaGFwZTogUm91bmRlZCcsXG4gICAgICAgIHNoYXBlQ2lyY2xlOiAnU2hhcGU6IENpcmNsZScsXG4gICAgICAgIHNoYXBlVGh1bWJuYWlsOiAnU2hhcGU6IFRodW1ibmFpbCcsXG4gICAgICAgIHNoYXBlTm9uZTogJ1NoYXBlOiBOb25lJyxcbiAgICAgICAgZHJhZ0ltYWdlSGVyZTogJ0RyYWcgaW1hZ2Ugb3IgdGV4dCBoZXJlJyxcbiAgICAgICAgZHJvcEltYWdlOiAnRHJvcCBpbWFnZSBvciBUZXh0JyxcbiAgICAgICAgc2VsZWN0RnJvbUZpbGVzOiAnU2VsZWN0IGZyb20gZmlsZXMnLFxuICAgICAgICBtYXhpbXVtRmlsZVNpemU6ICdNYXhpbXVtIGZpbGUgc2l6ZScsXG4gICAgICAgIG1heGltdW1GaWxlU2l6ZUVycm9yOiAnTWF4aW11bSBmaWxlIHNpemUgZXhjZWVkZWQuJyxcbiAgICAgICAgdXJsOiAnSW1hZ2UgVVJMJyxcbiAgICAgICAgcmVtb3ZlOiAnUmVtb3ZlIEltYWdlJ1xuICAgICAgfSxcbiAgICAgIHZpZGVvOiB7XG4gICAgICAgIHZpZGVvOiAnVmlkZW8nLFxuICAgICAgICB2aWRlb0xpbms6ICdWaWRlbyBMaW5rJyxcbiAgICAgICAgaW5zZXJ0OiAnSW5zZXJ0IFZpZGVvJyxcbiAgICAgICAgdXJsOiAnVmlkZW8gVVJMPycsXG4gICAgICAgIHByb3ZpZGVyczogJyhZb3VUdWJlLCBWaW1lbywgVmluZSwgSW5zdGFncmFtLCBEYWlseU1vdGlvbiBvciBZb3VrdSknXG4gICAgICB9LFxuICAgICAgbGluazoge1xuICAgICAgICBsaW5rOiAnTGluaycsXG4gICAgICAgIGluc2VydDogJ0luc2VydCBMaW5rJyxcbiAgICAgICAgdW5saW5rOiAnVW5saW5rJyxcbiAgICAgICAgZWRpdDogJ0VkaXQnLFxuICAgICAgICB0ZXh0VG9EaXNwbGF5OiAnVGV4dCB0byBkaXNwbGF5JyxcbiAgICAgICAgdXJsOiAnVG8gd2hhdCBVUkwgc2hvdWxkIHRoaXMgbGluayBnbz8nLFxuICAgICAgICBvcGVuSW5OZXdXaW5kb3c6ICdPcGVuIGluIG5ldyB3aW5kb3cnXG4gICAgICB9LFxuICAgICAgdGFibGU6IHtcbiAgICAgICAgdGFibGU6ICdUYWJsZSdcbiAgICAgIH0sXG4gICAgICBocjoge1xuICAgICAgICBpbnNlcnQ6ICdJbnNlcnQgSG9yaXpvbnRhbCBSdWxlJ1xuICAgICAgfSxcbiAgICAgIHN0eWxlOiB7XG4gICAgICAgIHN0eWxlOiAnU3R5bGUnLFxuICAgICAgICBub3JtYWw6ICdOb3JtYWwnLFxuICAgICAgICBibG9ja3F1b3RlOiAnUXVvdGUnLFxuICAgICAgICBwcmU6ICdDb2RlJyxcbiAgICAgICAgaDE6ICdIZWFkZXIgMScsXG4gICAgICAgIGgyOiAnSGVhZGVyIDInLFxuICAgICAgICBoMzogJ0hlYWRlciAzJyxcbiAgICAgICAgaDQ6ICdIZWFkZXIgNCcsXG4gICAgICAgIGg1OiAnSGVhZGVyIDUnLFxuICAgICAgICBoNjogJ0hlYWRlciA2J1xuICAgICAgfSxcbiAgICAgIGxpc3RzOiB7XG4gICAgICAgIHVub3JkZXJlZDogJ1Vub3JkZXJlZCBsaXN0JyxcbiAgICAgICAgb3JkZXJlZDogJ09yZGVyZWQgbGlzdCdcbiAgICAgIH0sXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIGhlbHA6ICdIZWxwJyxcbiAgICAgICAgZnVsbHNjcmVlbjogJ0Z1bGwgU2NyZWVuJyxcbiAgICAgICAgY29kZXZpZXc6ICdDb2RlIFZpZXcnXG4gICAgICB9LFxuICAgICAgcGFyYWdyYXBoOiB7XG4gICAgICAgIHBhcmFncmFwaDogJ1BhcmFncmFwaCcsXG4gICAgICAgIG91dGRlbnQ6ICdPdXRkZW50JyxcbiAgICAgICAgaW5kZW50OiAnSW5kZW50JyxcbiAgICAgICAgbGVmdDogJ0FsaWduIGxlZnQnLFxuICAgICAgICBjZW50ZXI6ICdBbGlnbiBjZW50ZXInLFxuICAgICAgICByaWdodDogJ0FsaWduIHJpZ2h0JyxcbiAgICAgICAganVzdGlmeTogJ0p1c3RpZnkgZnVsbCdcbiAgICAgIH0sXG4gICAgICBjb2xvcjoge1xuICAgICAgICByZWNlbnQ6ICdSZWNlbnQgQ29sb3InLFxuICAgICAgICBtb3JlOiAnTW9yZSBDb2xvcicsXG4gICAgICAgIGJhY2tncm91bmQ6ICdCYWNrZ3JvdW5kIENvbG9yJyxcbiAgICAgICAgZm9yZWdyb3VuZDogJ0ZvcmVncm91bmQgQ29sb3InLFxuICAgICAgICB0cmFuc3BhcmVudDogJ1RyYW5zcGFyZW50JyxcbiAgICAgICAgc2V0VHJhbnNwYXJlbnQ6ICdTZXQgdHJhbnNwYXJlbnQnLFxuICAgICAgICByZXNldDogJ1Jlc2V0JyxcbiAgICAgICAgcmVzZXRUb0RlZmF1bHQ6ICdSZXNldCB0byBkZWZhdWx0J1xuICAgICAgfSxcbiAgICAgIHNob3J0Y3V0OiB7XG4gICAgICAgIHNob3J0Y3V0czogJ0tleWJvYXJkIHNob3J0Y3V0cycsXG4gICAgICAgIGNsb3NlOiAnQ2xvc2UnLFxuICAgICAgICB0ZXh0Rm9ybWF0dGluZzogJ1RleHQgZm9ybWF0dGluZycsXG4gICAgICAgIGFjdGlvbjogJ0FjdGlvbicsXG4gICAgICAgIHBhcmFncmFwaEZvcm1hdHRpbmc6ICdQYXJhZ3JhcGggZm9ybWF0dGluZycsXG4gICAgICAgIGRvY3VtZW50U3R5bGU6ICdEb2N1bWVudCBTdHlsZScsXG4gICAgICAgIGV4dHJhS2V5czogJ0V4dHJhIGtleXMnXG4gICAgICB9LFxuICAgICAgaGVscDoge1xuICAgICAgICAnaW5zZXJ0UGFyYWdyYXBoJzogJ0luc2VydCBQYXJhZ3JhcGgnLFxuICAgICAgICAndW5kbyc6ICdVbmRvZXMgdGhlIGxhc3QgY29tbWFuZCcsXG4gICAgICAgICdyZWRvJzogJ1JlZG9lcyB0aGUgbGFzdCBjb21tYW5kJyxcbiAgICAgICAgJ3RhYic6ICdUYWInLFxuICAgICAgICAndW50YWInOiAnVW50YWInLFxuICAgICAgICAnYm9sZCc6ICdTZXQgYSBib2xkIHN0eWxlJyxcbiAgICAgICAgJ2l0YWxpYyc6ICdTZXQgYSBpdGFsaWMgc3R5bGUnLFxuICAgICAgICAndW5kZXJsaW5lJzogJ1NldCBhIHVuZGVybGluZSBzdHlsZScsXG4gICAgICAgICdzdHJpa2V0aHJvdWdoJzogJ1NldCBhIHN0cmlrZXRocm91Z2ggc3R5bGUnLFxuICAgICAgICAncmVtb3ZlRm9ybWF0JzogJ0NsZWFuIGEgc3R5bGUnLFxuICAgICAgICAnanVzdGlmeUxlZnQnOiAnU2V0IGxlZnQgYWxpZ24nLFxuICAgICAgICAnanVzdGlmeUNlbnRlcic6ICdTZXQgY2VudGVyIGFsaWduJyxcbiAgICAgICAgJ2p1c3RpZnlSaWdodCc6ICdTZXQgcmlnaHQgYWxpZ24nLFxuICAgICAgICAnanVzdGlmeUZ1bGwnOiAnU2V0IGZ1bGwgYWxpZ24nLFxuICAgICAgICAnaW5zZXJ0VW5vcmRlcmVkTGlzdCc6ICdUb2dnbGUgdW5vcmRlcmVkIGxpc3QnLFxuICAgICAgICAnaW5zZXJ0T3JkZXJlZExpc3QnOiAnVG9nZ2xlIG9yZGVyZWQgbGlzdCcsXG4gICAgICAgICdvdXRkZW50JzogJ091dGRlbnQgb24gY3VycmVudCBwYXJhZ3JhcGgnLFxuICAgICAgICAnaW5kZW50JzogJ0luZGVudCBvbiBjdXJyZW50IHBhcmFncmFwaCcsXG4gICAgICAgICdmb3JtYXRQYXJhJzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgYSBwYXJhZ3JhcGgoUCB0YWcpJyxcbiAgICAgICAgJ2Zvcm1hdEgxJzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDEnLFxuICAgICAgICAnZm9ybWF0SDInOiAnQ2hhbmdlIGN1cnJlbnQgYmxvY2tcXCdzIGZvcm1hdCBhcyBIMicsXG4gICAgICAgICdmb3JtYXRIMyc6ICdDaGFuZ2UgY3VycmVudCBibG9ja1xcJ3MgZm9ybWF0IGFzIEgzJyxcbiAgICAgICAgJ2Zvcm1hdEg0JzogJ0NoYW5nZSBjdXJyZW50IGJsb2NrXFwncyBmb3JtYXQgYXMgSDQnLFxuICAgICAgICAnZm9ybWF0SDUnOiAnQ2hhbmdlIGN1cnJlbnQgYmxvY2tcXCdzIGZvcm1hdCBhcyBINScsXG4gICAgICAgICdmb3JtYXRINic6ICdDaGFuZ2UgY3VycmVudCBibG9ja1xcJ3MgZm9ybWF0IGFzIEg2JyxcbiAgICAgICAgJ2luc2VydEhvcml6b250YWxSdWxlJzogJ0luc2VydCBob3Jpem9udGFsIHJ1bGUnLFxuICAgICAgICAnbGlua0RpYWxvZy5zaG93JzogJ1Nob3cgTGluayBEaWFsb2cnXG4gICAgICB9LFxuICAgICAgaGlzdG9yeToge1xuICAgICAgICB1bmRvOiAnVW5kbycsXG4gICAgICAgIHJlZG86ICdSZWRvJ1xuICAgICAgfSxcbiAgICAgIHNwZWNpYWxDaGFyOiB7XG4gICAgICAgIHNwZWNpYWxDaGFyOiAnU1BFQ0lBTCBDSEFSQUNURVJTJyxcbiAgICAgICAgc2VsZWN0OiAnU2VsZWN0IFNwZWNpYWwgY2hhcmFjdGVycydcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEBjbGFzcyBjb3JlLmtleVxuICAgKlxuICAgKiBPYmplY3QgZm9yIGtleWNvZGVzLlxuICAgKlxuICAgKiBAc2luZ2xldG9uXG4gICAqIEBhbHRlcm5hdGVDbGFzc05hbWUga2V5XG4gICAqL1xuICB2YXIga2V5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIga2V5TWFwID0ge1xuICAgICAgJ0JBQ0tTUEFDRSc6IDgsXG4gICAgICAnVEFCJzogOSxcbiAgICAgICdFTlRFUic6IDEzLFxuICAgICAgJ1NQQUNFJzogMzIsXG5cbiAgICAgIC8vIEFycm93XG4gICAgICAnTEVGVCc6IDM3LFxuICAgICAgJ1VQJzogMzgsXG4gICAgICAnUklHSFQnOiAzOSxcbiAgICAgICdET1dOJzogNDAsXG5cbiAgICAgIC8vIE51bWJlcjogMC05XG4gICAgICAnTlVNMCc6IDQ4LFxuICAgICAgJ05VTTEnOiA0OSxcbiAgICAgICdOVU0yJzogNTAsXG4gICAgICAnTlVNMyc6IDUxLFxuICAgICAgJ05VTTQnOiA1MixcbiAgICAgICdOVU01JzogNTMsXG4gICAgICAnTlVNNic6IDU0LFxuICAgICAgJ05VTTcnOiA1NSxcbiAgICAgICdOVU04JzogNTYsXG5cbiAgICAgIC8vIEFscGhhYmV0OiBhLXpcbiAgICAgICdCJzogNjYsXG4gICAgICAnRSc6IDY5LFxuICAgICAgJ0knOiA3MyxcbiAgICAgICdKJzogNzQsXG4gICAgICAnSyc6IDc1LFxuICAgICAgJ0wnOiA3NixcbiAgICAgICdSJzogODIsXG4gICAgICAnUyc6IDgzLFxuICAgICAgJ1UnOiA4NSxcbiAgICAgICdWJzogODYsXG4gICAgICAnWSc6IDg5LFxuICAgICAgJ1onOiA5MCxcblxuICAgICAgJ1NMQVNIJzogMTkxLFxuICAgICAgJ0xFRlRCUkFDS0VUJzogMjE5LFxuICAgICAgJ0JBQ0tTTEFTSCc6IDIyMCxcbiAgICAgICdSSUdIVEJSQUNLRVQnOiAyMjFcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZCBpc0VkaXRcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge051bWJlcn0ga2V5Q29kZVxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgICAqL1xuICAgICAgaXNFZGl0OiBmdW5jdGlvbiAoa2V5Q29kZSkge1xuICAgICAgICByZXR1cm4gbGlzdC5jb250YWlucyhbXG4gICAgICAgICAga2V5TWFwLkJBQ0tTUEFDRSxcbiAgICAgICAgICBrZXlNYXAuVEFCLFxuICAgICAgICAgIGtleU1hcC5FTlRFUixcbiAgICAgICAgICBrZXlNYXAuU1BBQ0VcbiAgICAgICAgXSwga2V5Q29kZSk7XG4gICAgICB9LFxuICAgICAgLyoqXG4gICAgICAgKiBAbWV0aG9kIGlzTW92ZVxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBrZXlDb2RlXG4gICAgICAgKiBAcmV0dXJuIHtCb29sZWFufVxuICAgICAgICovXG4gICAgICBpc01vdmU6IGZ1bmN0aW9uIChrZXlDb2RlKSB7XG4gICAgICAgIHJldHVybiBsaXN0LmNvbnRhaW5zKFtcbiAgICAgICAgICBrZXlNYXAuTEVGVCxcbiAgICAgICAgICBrZXlNYXAuVVAsXG4gICAgICAgICAga2V5TWFwLlJJR0hULFxuICAgICAgICAgIGtleU1hcC5ET1dOXG4gICAgICAgIF0sIGtleUNvZGUpO1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IG5hbWVGcm9tQ29kZVxuICAgICAgICogQHByb3BlcnR5IHtTdHJpbmd9IG5hbWVGcm9tQ29kZS44IFwiQkFDS1NQQUNFXCJcbiAgICAgICAqL1xuICAgICAgbmFtZUZyb21Db2RlOiBmdW5jLmludmVydE9iamVjdChrZXlNYXApLFxuICAgICAgY29kZToga2V5TWFwXG4gICAgfTtcbiAgfSkoKTtcblxuICB2YXIgcmFuZ2UgPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJuIGJvdW5kYXJ5UG9pbnQgZnJvbSBUZXh0UmFuZ2UsIGluc3BpcmVkIGJ5IEFuZHkgTmEncyBIdXNreVJhbmdlLmpzXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1RleHRSYW5nZX0gdGV4dFJhbmdlXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBpc1N0YXJ0XG4gICAgICogQHJldHVybiB7Qm91bmRhcnlQb2ludH1cbiAgICAgKlxuICAgICAqIEBzZWUgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL21zNTM1ODcyKHY9dnMuODUpLmFzcHhcbiAgICAgKi9cbiAgICB2YXIgdGV4dFJhbmdlVG9Qb2ludCA9IGZ1bmN0aW9uICh0ZXh0UmFuZ2UsIGlzU3RhcnQpIHtcbiAgICAgIHZhciBjb250YWluZXIgPSB0ZXh0UmFuZ2UucGFyZW50RWxlbWVudCgpLCBvZmZzZXQ7XG5cbiAgICAgIHZhciB0ZXN0ZXIgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpLCBwcmV2Q29udGFpbmVyO1xuICAgICAgdmFyIGNoaWxkTm9kZXMgPSBsaXN0LmZyb20oY29udGFpbmVyLmNoaWxkTm9kZXMpO1xuICAgICAgZm9yIChvZmZzZXQgPSAwOyBvZmZzZXQgPCBjaGlsZE5vZGVzLmxlbmd0aDsgb2Zmc2V0KyspIHtcbiAgICAgICAgaWYgKGRvbS5pc1RleHQoY2hpbGROb2Rlc1tvZmZzZXRdKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHRlc3Rlci5tb3ZlVG9FbGVtZW50VGV4dChjaGlsZE5vZGVzW29mZnNldF0pO1xuICAgICAgICBpZiAodGVzdGVyLmNvbXBhcmVFbmRQb2ludHMoJ1N0YXJ0VG9TdGFydCcsIHRleHRSYW5nZSkgPj0gMCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHByZXZDb250YWluZXIgPSBjaGlsZE5vZGVzW29mZnNldF07XG4gICAgICB9XG5cbiAgICAgIGlmIChvZmZzZXQgIT09IDAgJiYgZG9tLmlzVGV4dChjaGlsZE5vZGVzW29mZnNldCAtIDFdKSkge1xuICAgICAgICB2YXIgdGV4dFJhbmdlU3RhcnQgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpLCBjdXJUZXh0Tm9kZSA9IG51bGw7XG4gICAgICAgIHRleHRSYW5nZVN0YXJ0Lm1vdmVUb0VsZW1lbnRUZXh0KHByZXZDb250YWluZXIgfHwgY29udGFpbmVyKTtcbiAgICAgICAgdGV4dFJhbmdlU3RhcnQuY29sbGFwc2UoIXByZXZDb250YWluZXIpO1xuICAgICAgICBjdXJUZXh0Tm9kZSA9IHByZXZDb250YWluZXIgPyBwcmV2Q29udGFpbmVyLm5leHRTaWJsaW5nIDogY29udGFpbmVyLmZpcnN0Q2hpbGQ7XG5cbiAgICAgICAgdmFyIHBvaW50VGVzdGVyID0gdGV4dFJhbmdlLmR1cGxpY2F0ZSgpO1xuICAgICAgICBwb2ludFRlc3Rlci5zZXRFbmRQb2ludCgnU3RhcnRUb1N0YXJ0JywgdGV4dFJhbmdlU3RhcnQpO1xuICAgICAgICB2YXIgdGV4dENvdW50ID0gcG9pbnRUZXN0ZXIudGV4dC5yZXBsYWNlKC9bXFxyXFxuXS9nLCAnJykubGVuZ3RoO1xuXG4gICAgICAgIHdoaWxlICh0ZXh0Q291bnQgPiBjdXJUZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoICYmIGN1clRleHROb2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgdGV4dENvdW50IC09IGN1clRleHROb2RlLm5vZGVWYWx1ZS5sZW5ndGg7XG4gICAgICAgICAgY3VyVGV4dE5vZGUgPSBjdXJUZXh0Tm9kZS5uZXh0U2libGluZztcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbiAgICAgICAgdmFyIGR1bW15ID0gY3VyVGV4dE5vZGUubm9kZVZhbHVlOyAvLyBlbmZvcmNlIElFIHRvIHJlLXJlZmVyZW5jZSBjdXJUZXh0Tm9kZSwgaGFja1xuICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuXG4gICAgICAgIGlmIChpc1N0YXJ0ICYmIGN1clRleHROb2RlLm5leHRTaWJsaW5nICYmIGRvbS5pc1RleHQoY3VyVGV4dE5vZGUubmV4dFNpYmxpbmcpICYmXG4gICAgICAgICAgICB0ZXh0Q291bnQgPT09IGN1clRleHROb2RlLm5vZGVWYWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICB0ZXh0Q291bnQgLT0gY3VyVGV4dE5vZGUubm9kZVZhbHVlLmxlbmd0aDtcbiAgICAgICAgICBjdXJUZXh0Tm9kZSA9IGN1clRleHROb2RlLm5leHRTaWJsaW5nO1xuICAgICAgICB9XG5cbiAgICAgICAgY29udGFpbmVyID0gY3VyVGV4dE5vZGU7XG4gICAgICAgIG9mZnNldCA9IHRleHRDb3VudDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29udDogY29udGFpbmVyLFxuICAgICAgICBvZmZzZXQ6IG9mZnNldFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJuIFRleHRSYW5nZSBmcm9tIGJvdW5kYXJ5IHBvaW50IChpbnNwaXJlZCBieSBnb29nbGUgY2xvc3VyZS1saWJyYXJ5KVxuICAgICAqIEBwYXJhbSB7Qm91bmRhcnlQb2ludH0gcG9pbnRcbiAgICAgKiBAcmV0dXJuIHtUZXh0UmFuZ2V9XG4gICAgICovXG4gICAgdmFyIHBvaW50VG9UZXh0UmFuZ2UgPSBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgIHZhciB0ZXh0UmFuZ2VJbmZvID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgb2Zmc2V0KSB7XG4gICAgICAgIHZhciBub2RlLCBpc0NvbGxhcHNlVG9TdGFydDtcblxuICAgICAgICBpZiAoZG9tLmlzVGV4dChjb250YWluZXIpKSB7XG4gICAgICAgICAgdmFyIHByZXZUZXh0Tm9kZXMgPSBkb20ubGlzdFByZXYoY29udGFpbmVyLCBmdW5jLm5vdChkb20uaXNUZXh0KSk7XG4gICAgICAgICAgdmFyIHByZXZDb250YWluZXIgPSBsaXN0Lmxhc3QocHJldlRleHROb2RlcykucHJldmlvdXNTaWJsaW5nO1xuICAgICAgICAgIG5vZGUgPSAgcHJldkNvbnRhaW5lciB8fCBjb250YWluZXIucGFyZW50Tm9kZTtcbiAgICAgICAgICBvZmZzZXQgKz0gbGlzdC5zdW0obGlzdC50YWlsKHByZXZUZXh0Tm9kZXMpLCBkb20ubm9kZUxlbmd0aCk7XG4gICAgICAgICAgaXNDb2xsYXBzZVRvU3RhcnQgPSAhcHJldkNvbnRhaW5lcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBub2RlID0gY29udGFpbmVyLmNoaWxkTm9kZXNbb2Zmc2V0XSB8fCBjb250YWluZXI7XG4gICAgICAgICAgaWYgKGRvbS5pc1RleHQobm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0UmFuZ2VJbmZvKG5vZGUsIDApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG9mZnNldCA9IDA7XG4gICAgICAgICAgaXNDb2xsYXBzZVRvU3RhcnQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbm9kZTogbm9kZSxcbiAgICAgICAgICBjb2xsYXBzZVRvU3RhcnQ6IGlzQ29sbGFwc2VUb1N0YXJ0LFxuICAgICAgICAgIG9mZnNldDogb2Zmc2V0XG4gICAgICAgIH07XG4gICAgICB9O1xuXG4gICAgICB2YXIgdGV4dFJhbmdlID0gZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcbiAgICAgIHZhciBpbmZvID0gdGV4dFJhbmdlSW5mbyhwb2ludC5ub2RlLCBwb2ludC5vZmZzZXQpO1xuXG4gICAgICB0ZXh0UmFuZ2UubW92ZVRvRWxlbWVudFRleHQoaW5mby5ub2RlKTtcbiAgICAgIHRleHRSYW5nZS5jb2xsYXBzZShpbmZvLmNvbGxhcHNlVG9TdGFydCk7XG4gICAgICB0ZXh0UmFuZ2UubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCBpbmZvLm9mZnNldCk7XG4gICAgICByZXR1cm4gdGV4dFJhbmdlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBXcmFwcGVkIFJhbmdlXG4gICAgICpcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge05vZGV9IHNjIC0gc3RhcnQgY29udGFpbmVyXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHNvIC0gc3RhcnQgb2Zmc2V0XG4gICAgICogQHBhcmFtIHtOb2RlfSBlYyAtIGVuZCBjb250YWluZXJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZW8gLSBlbmQgb2Zmc2V0XG4gICAgICovXG4gICAgdmFyIFdyYXBwZWRSYW5nZSA9IGZ1bmN0aW9uIChzYywgc28sIGVjLCBlbykge1xuICAgICAgdGhpcy5zYyA9IHNjO1xuICAgICAgdGhpcy5zbyA9IHNvO1xuICAgICAgdGhpcy5lYyA9IGVjO1xuICAgICAgdGhpcy5lbyA9IGVvO1xuXG4gICAgICAvLyBuYXRpdmVSYW5nZTogZ2V0IG5hdGl2ZVJhbmdlIGZyb20gc2MsIHNvLCBlYywgZW9cbiAgICAgIHZhciBuYXRpdmVSYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGFnZW50LmlzVzNDUmFuZ2VTdXBwb3J0KSB7XG4gICAgICAgICAgdmFyIHczY1JhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgICAgICAgICB3M2NSYW5nZS5zZXRTdGFydChzYywgc28pO1xuICAgICAgICAgIHczY1JhbmdlLnNldEVuZChlYywgZW8pO1xuXG4gICAgICAgICAgcmV0dXJuIHczY1JhbmdlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB0ZXh0UmFuZ2UgPSBwb2ludFRvVGV4dFJhbmdlKHtcbiAgICAgICAgICAgIG5vZGU6IHNjLFxuICAgICAgICAgICAgb2Zmc2V0OiBzb1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGV4dFJhbmdlLnNldEVuZFBvaW50KCdFbmRUb0VuZCcsIHBvaW50VG9UZXh0UmFuZ2Uoe1xuICAgICAgICAgICAgbm9kZTogZWMsXG4gICAgICAgICAgICBvZmZzZXQ6IGVvXG4gICAgICAgICAgfSkpO1xuXG4gICAgICAgICAgcmV0dXJuIHRleHRSYW5nZTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc2M6IHNjLFxuICAgICAgICAgIHNvOiBzbyxcbiAgICAgICAgICBlYzogZWMsXG4gICAgICAgICAgZW86IGVvXG4gICAgICAgIH07XG4gICAgICB9O1xuXG4gICAgICB0aGlzLmdldFN0YXJ0UG9pbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbm9kZTogc2MsXG4gICAgICAgICAgb2Zmc2V0OiBzb1xuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgdGhpcy5nZXRFbmRQb2ludCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBub2RlOiBlYyxcbiAgICAgICAgICBvZmZzZXQ6IGVvXG4gICAgICAgIH07XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIHNlbGVjdCB1cGRhdGUgdmlzaWJsZSByYW5nZVxuICAgICAgICovXG4gICAgICB0aGlzLnNlbGVjdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5hdGl2ZVJuZyA9IG5hdGl2ZVJhbmdlKCk7XG4gICAgICAgIGlmIChhZ2VudC5pc1czQ1JhbmdlU3VwcG9ydCkge1xuICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgICBpZiAoc2VsZWN0aW9uLnJhbmdlQ291bnQgPiAwKSB7XG4gICAgICAgICAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlbGVjdGlvbi5hZGRSYW5nZShuYXRpdmVSbmcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5hdGl2ZVJuZy5zZWxlY3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBNb3ZlcyB0aGUgc2Nyb2xsYmFyIHRvIHN0YXJ0IGNvbnRhaW5lcihzYykgb2YgY3VycmVudCByYW5nZVxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgICAqL1xuICAgICAgdGhpcy5zY3JvbGxJbnRvVmlldyA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICAgICAgdmFyIGhlaWdodCA9ICQoY29udGFpbmVyKS5oZWlnaHQoKTtcbiAgICAgICAgaWYgKGNvbnRhaW5lci5zY3JvbGxUb3AgKyBoZWlnaHQgPCB0aGlzLnNjLm9mZnNldFRvcCkge1xuICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgKz0gTWF0aC5hYnMoY29udGFpbmVyLnNjcm9sbFRvcCArIGhlaWdodCAtIHRoaXMuc2Mub2Zmc2V0VG9wKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICAgKi9cbiAgICAgIHRoaXMubm9ybWFsaXplID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcGFyYW0ge0JvdW5kYXJ5UG9pbnR9IHBvaW50XG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNMZWZ0VG9SaWdodFxuICAgICAgICAgKiBAcmV0dXJuIHtCb3VuZGFyeVBvaW50fVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGdldFZpc2libGVQb2ludCA9IGZ1bmN0aW9uIChwb2ludCwgaXNMZWZ0VG9SaWdodCkge1xuICAgICAgICAgIGlmICgoZG9tLmlzVmlzaWJsZVBvaW50KHBvaW50KSAmJiAhZG9tLmlzRWRnZVBvaW50KHBvaW50KSkgfHxcbiAgICAgICAgICAgICAgKGRvbS5pc1Zpc2libGVQb2ludChwb2ludCkgJiYgZG9tLmlzUmlnaHRFZGdlUG9pbnQocG9pbnQpICYmICFpc0xlZnRUb1JpZ2h0KSB8fFxuICAgICAgICAgICAgICAoZG9tLmlzVmlzaWJsZVBvaW50KHBvaW50KSAmJiBkb20uaXNMZWZ0RWRnZVBvaW50KHBvaW50KSAmJiBpc0xlZnRUb1JpZ2h0KSB8fFxuICAgICAgICAgICAgICAoZG9tLmlzVmlzaWJsZVBvaW50KHBvaW50KSAmJiBkb20uaXNCbG9jayhwb2ludC5ub2RlKSAmJiBkb20uaXNFbXB0eShwb2ludC5ub2RlKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBwb2ludDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBwb2ludCBvbiBibG9jaydzIGVkZ2VcbiAgICAgICAgICB2YXIgYmxvY2sgPSBkb20uYW5jZXN0b3IocG9pbnQubm9kZSwgZG9tLmlzQmxvY2spO1xuICAgICAgICAgIGlmICgoKGRvbS5pc0xlZnRFZGdlUG9pbnRPZihwb2ludCwgYmxvY2spIHx8IGRvbS5pc1ZvaWQoZG9tLnByZXZQb2ludChwb2ludCkubm9kZSkpICYmICFpc0xlZnRUb1JpZ2h0KSB8fFxuICAgICAgICAgICAgICAoKGRvbS5pc1JpZ2h0RWRnZVBvaW50T2YocG9pbnQsIGJsb2NrKSB8fCBkb20uaXNWb2lkKGRvbS5uZXh0UG9pbnQocG9pbnQpLm5vZGUpKSAmJiBpc0xlZnRUb1JpZ2h0KSkge1xuXG4gICAgICAgICAgICAvLyByZXR1cm5zIHBvaW50IGFscmVhZHkgb24gdmlzaWJsZSBwb2ludFxuICAgICAgICAgICAgaWYgKGRvbS5pc1Zpc2libGVQb2ludChwb2ludCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHBvaW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gcmV2ZXJzZSBkaXJlY3Rpb25cbiAgICAgICAgICAgIGlzTGVmdFRvUmlnaHQgPSAhaXNMZWZ0VG9SaWdodDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgbmV4dFBvaW50ID0gaXNMZWZ0VG9SaWdodCA/IGRvbS5uZXh0UG9pbnRVbnRpbChkb20ubmV4dFBvaW50KHBvaW50KSwgZG9tLmlzVmlzaWJsZVBvaW50KSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb20ucHJldlBvaW50VW50aWwoZG9tLnByZXZQb2ludChwb2ludCksIGRvbS5pc1Zpc2libGVQb2ludCk7XG4gICAgICAgICAgcmV0dXJuIG5leHRQb2ludCB8fCBwb2ludDtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZW5kUG9pbnQgPSBnZXRWaXNpYmxlUG9pbnQodGhpcy5nZXRFbmRQb2ludCgpLCBmYWxzZSk7XG4gICAgICAgIHZhciBzdGFydFBvaW50ID0gdGhpcy5pc0NvbGxhcHNlZCgpID8gZW5kUG9pbnQgOiBnZXRWaXNpYmxlUG9pbnQodGhpcy5nZXRTdGFydFBvaW50KCksIHRydWUpO1xuXG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKFxuICAgICAgICAgIHN0YXJ0UG9pbnQubm9kZSxcbiAgICAgICAgICBzdGFydFBvaW50Lm9mZnNldCxcbiAgICAgICAgICBlbmRQb2ludC5ub2RlLFxuICAgICAgICAgIGVuZFBvaW50Lm9mZnNldFxuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiByZXR1cm5zIG1hdGNoZWQgbm9kZXMgb24gcmFuZ2VcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbcHJlZF0gLSBwcmVkaWNhdGUgZnVuY3Rpb25cbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuaW5jbHVkZUFuY2VzdG9yXVxuICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5mdWxseUNvbnRhaW5zXVxuICAgICAgICogQHJldHVybiB7Tm9kZVtdfVxuICAgICAgICovXG4gICAgICB0aGlzLm5vZGVzID0gZnVuY3Rpb24gKHByZWQsIG9wdGlvbnMpIHtcbiAgICAgICAgcHJlZCA9IHByZWQgfHwgZnVuYy5vaztcblxuICAgICAgICB2YXIgaW5jbHVkZUFuY2VzdG9yID0gb3B0aW9ucyAmJiBvcHRpb25zLmluY2x1ZGVBbmNlc3RvcjtcbiAgICAgICAgdmFyIGZ1bGx5Q29udGFpbnMgPSBvcHRpb25zICYmIG9wdGlvbnMuZnVsbHlDb250YWlucztcblxuICAgICAgICAvLyBUT0RPIGNvbXBhcmUgcG9pbnRzIGFuZCBzb3J0XG4gICAgICAgIHZhciBzdGFydFBvaW50ID0gdGhpcy5nZXRTdGFydFBvaW50KCk7XG4gICAgICAgIHZhciBlbmRQb2ludCA9IHRoaXMuZ2V0RW5kUG9pbnQoKTtcblxuICAgICAgICB2YXIgbm9kZXMgPSBbXTtcbiAgICAgICAgdmFyIGxlZnRFZGdlTm9kZXMgPSBbXTtcblxuICAgICAgICBkb20ud2Fsa1BvaW50KHN0YXJ0UG9pbnQsIGVuZFBvaW50LCBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgICBpZiAoZG9tLmlzRWRpdGFibGUocG9pbnQubm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB2YXIgbm9kZTtcbiAgICAgICAgICBpZiAoZnVsbHlDb250YWlucykge1xuICAgICAgICAgICAgaWYgKGRvbS5pc0xlZnRFZGdlUG9pbnQocG9pbnQpKSB7XG4gICAgICAgICAgICAgIGxlZnRFZGdlTm9kZXMucHVzaChwb2ludC5ub2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkb20uaXNSaWdodEVkZ2VQb2ludChwb2ludCkgJiYgbGlzdC5jb250YWlucyhsZWZ0RWRnZU5vZGVzLCBwb2ludC5ub2RlKSkge1xuICAgICAgICAgICAgICBub2RlID0gcG9pbnQubm9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGluY2x1ZGVBbmNlc3Rvcikge1xuICAgICAgICAgICAgbm9kZSA9IGRvbS5hbmNlc3Rvcihwb2ludC5ub2RlLCBwcmVkKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9kZSA9IHBvaW50Lm5vZGU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG5vZGUgJiYgcHJlZChub2RlKSkge1xuICAgICAgICAgICAgbm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgIHJldHVybiBsaXN0LnVuaXF1ZShub2Rlcyk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIHJldHVybnMgY29tbW9uQW5jZXN0b3Igb2YgcmFuZ2VcbiAgICAgICAqIEByZXR1cm4ge0VsZW1lbnR9IC0gY29tbW9uQW5jZXN0b3JcbiAgICAgICAqL1xuICAgICAgdGhpcy5jb21tb25BbmNlc3RvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRvbS5jb21tb25BbmNlc3RvcihzYywgZWMpO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiByZXR1cm5zIGV4cGFuZGVkIHJhbmdlIGJ5IHByZWRcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBwcmVkIC0gcHJlZGljYXRlIGZ1bmN0aW9uXG4gICAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICAgKi9cbiAgICAgIHRoaXMuZXhwYW5kID0gZnVuY3Rpb24gKHByZWQpIHtcbiAgICAgICAgdmFyIHN0YXJ0QW5jZXN0b3IgPSBkb20uYW5jZXN0b3Ioc2MsIHByZWQpO1xuICAgICAgICB2YXIgZW5kQW5jZXN0b3IgPSBkb20uYW5jZXN0b3IoZWMsIHByZWQpO1xuXG4gICAgICAgIGlmICghc3RhcnRBbmNlc3RvciAmJiAhZW5kQW5jZXN0b3IpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgYm91bmRhcnlQb2ludHMgPSB0aGlzLmdldFBvaW50cygpO1xuXG4gICAgICAgIGlmIChzdGFydEFuY2VzdG9yKSB7XG4gICAgICAgICAgYm91bmRhcnlQb2ludHMuc2MgPSBzdGFydEFuY2VzdG9yO1xuICAgICAgICAgIGJvdW5kYXJ5UG9pbnRzLnNvID0gMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbmRBbmNlc3Rvcikge1xuICAgICAgICAgIGJvdW5kYXJ5UG9pbnRzLmVjID0gZW5kQW5jZXN0b3I7XG4gICAgICAgICAgYm91bmRhcnlQb2ludHMuZW8gPSBkb20ubm9kZUxlbmd0aChlbmRBbmNlc3Rvcik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5zYyxcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5zbyxcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5lYyxcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5lb1xuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzQ29sbGFwc2VUb1N0YXJ0XG4gICAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICAgKi9cbiAgICAgIHRoaXMuY29sbGFwc2UgPSBmdW5jdGlvbiAoaXNDb2xsYXBzZVRvU3RhcnQpIHtcbiAgICAgICAgaWYgKGlzQ29sbGFwc2VUb1N0YXJ0KSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBXcmFwcGVkUmFuZ2Uoc2MsIHNvLCBzYywgc28pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKGVjLCBlbywgZWMsIGVvKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBzcGxpdFRleHQgb24gcmFuZ2VcbiAgICAgICAqL1xuICAgICAgdGhpcy5zcGxpdFRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBpc1NhbWVDb250YWluZXIgPSBzYyA9PT0gZWM7XG4gICAgICAgIHZhciBib3VuZGFyeVBvaW50cyA9IHRoaXMuZ2V0UG9pbnRzKCk7XG5cbiAgICAgICAgaWYgKGRvbS5pc1RleHQoZWMpICYmICFkb20uaXNFZGdlUG9pbnQodGhpcy5nZXRFbmRQb2ludCgpKSkge1xuICAgICAgICAgIGVjLnNwbGl0VGV4dChlbyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZG9tLmlzVGV4dChzYykgJiYgIWRvbS5pc0VkZ2VQb2ludCh0aGlzLmdldFN0YXJ0UG9pbnQoKSkpIHtcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5zYyA9IHNjLnNwbGl0VGV4dChzbyk7XG4gICAgICAgICAgYm91bmRhcnlQb2ludHMuc28gPSAwO1xuXG4gICAgICAgICAgaWYgKGlzU2FtZUNvbnRhaW5lcikge1xuICAgICAgICAgICAgYm91bmRhcnlQb2ludHMuZWMgPSBib3VuZGFyeVBvaW50cy5zYztcbiAgICAgICAgICAgIGJvdW5kYXJ5UG9pbnRzLmVvID0gZW8gLSBzbztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5zYyxcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5zbyxcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5lYyxcbiAgICAgICAgICBib3VuZGFyeVBvaW50cy5lb1xuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBkZWxldGUgY29udGVudHMgb24gcmFuZ2VcbiAgICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgICAqL1xuICAgICAgdGhpcy5kZWxldGVDb250ZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJuZyA9IHRoaXMuc3BsaXRUZXh0KCk7XG4gICAgICAgIHZhciBub2RlcyA9IHJuZy5ub2RlcyhudWxsLCB7XG4gICAgICAgICAgZnVsbHlDb250YWluczogdHJ1ZVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBmaW5kIG5ldyBjdXJzb3IgcG9pbnRcbiAgICAgICAgdmFyIHBvaW50ID0gZG9tLnByZXZQb2ludFVudGlsKHJuZy5nZXRTdGFydFBvaW50KCksIGZ1bmN0aW9uIChwb2ludCkge1xuICAgICAgICAgIHJldHVybiAhbGlzdC5jb250YWlucyhub2RlcywgcG9pbnQubm9kZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBlbXB0eVBhcmVudHMgPSBbXTtcbiAgICAgICAgJC5lYWNoKG5vZGVzLCBmdW5jdGlvbiAoaWR4LCBub2RlKSB7XG4gICAgICAgICAgLy8gZmluZCBlbXB0eSBwYXJlbnRzXG4gICAgICAgICAgdmFyIHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgICBpZiAocG9pbnQubm9kZSAhPT0gcGFyZW50ICYmIGRvbS5ub2RlTGVuZ3RoKHBhcmVudCkgPT09IDEpIHtcbiAgICAgICAgICAgIGVtcHR5UGFyZW50cy5wdXNoKHBhcmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRvbS5yZW1vdmUobm9kZSwgZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyByZW1vdmUgZW1wdHkgcGFyZW50c1xuICAgICAgICAkLmVhY2goZW1wdHlQYXJlbnRzLCBmdW5jdGlvbiAoaWR4LCBub2RlKSB7XG4gICAgICAgICAgZG9tLnJlbW92ZShub2RlLCBmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKFxuICAgICAgICAgIHBvaW50Lm5vZGUsXG4gICAgICAgICAgcG9pbnQub2Zmc2V0LFxuICAgICAgICAgIHBvaW50Lm5vZGUsXG4gICAgICAgICAgcG9pbnQub2Zmc2V0XG4gICAgICAgICkubm9ybWFsaXplKCk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIG1ha2VJc09uOiByZXR1cm4gaXNPbihwcmVkKSBmdW5jdGlvblxuICAgICAgICovXG4gICAgICB2YXIgbWFrZUlzT24gPSBmdW5jdGlvbiAocHJlZCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBhbmNlc3RvciA9IGRvbS5hbmNlc3RvcihzYywgcHJlZCk7XG4gICAgICAgICAgcmV0dXJuICEhYW5jZXN0b3IgJiYgKGFuY2VzdG9yID09PSBkb20uYW5jZXN0b3IoZWMsIHByZWQpKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG5cbiAgICAgIC8vIGlzT25FZGl0YWJsZToganVkZ2Ugd2hldGhlciByYW5nZSBpcyBvbiBlZGl0YWJsZSBvciBub3RcbiAgICAgIHRoaXMuaXNPbkVkaXRhYmxlID0gbWFrZUlzT24oZG9tLmlzRWRpdGFibGUpO1xuICAgICAgLy8gaXNPbkxpc3Q6IGp1ZGdlIHdoZXRoZXIgcmFuZ2UgaXMgb24gbGlzdCBub2RlIG9yIG5vdFxuICAgICAgdGhpcy5pc09uTGlzdCA9IG1ha2VJc09uKGRvbS5pc0xpc3QpO1xuICAgICAgLy8gaXNPbkFuY2hvcjoganVkZ2Ugd2hldGhlciByYW5nZSBpcyBvbiBhbmNob3Igbm9kZSBvciBub3RcbiAgICAgIHRoaXMuaXNPbkFuY2hvciA9IG1ha2VJc09uKGRvbS5pc0FuY2hvcik7XG4gICAgICAvLyBpc09uQ2VsbDoganVkZ2Ugd2hldGhlciByYW5nZSBpcyBvbiBjZWxsIG5vZGUgb3Igbm90XG4gICAgICB0aGlzLmlzT25DZWxsID0gbWFrZUlzT24oZG9tLmlzQ2VsbCk7XG4gICAgICAvLyBpc09uRGF0YToganVkZ2Ugd2hldGhlciByYW5nZSBpcyBvbiBkYXRhIG5vZGUgb3Igbm90XG4gICAgICB0aGlzLmlzT25EYXRhID0gbWFrZUlzT24oZG9tLmlzRGF0YSk7XG5cbiAgICAgIC8qKlxuICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcHJlZFxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgICAqL1xuICAgICAgdGhpcy5pc0xlZnRFZGdlT2YgPSBmdW5jdGlvbiAocHJlZCkge1xuICAgICAgICBpZiAoIWRvbS5pc0xlZnRFZGdlUG9pbnQodGhpcy5nZXRTdGFydFBvaW50KCkpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vZGUgPSBkb20uYW5jZXN0b3IodGhpcy5zYywgcHJlZCk7XG4gICAgICAgIHJldHVybiBub2RlICYmIGRvbS5pc0xlZnRFZGdlT2YodGhpcy5zYywgbm9kZSk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIHJldHVybnMgd2hldGhlciByYW5nZSB3YXMgY29sbGFwc2VkIG9yIG5vdFxuICAgICAgICovXG4gICAgICB0aGlzLmlzQ29sbGFwc2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2MgPT09IGVjICYmIHNvID09PSBlbztcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogd3JhcCBpbmxpbmUgbm9kZXMgd2hpY2ggY2hpbGRyZW4gb2YgYm9keSB3aXRoIHBhcmFncmFwaFxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgICAqL1xuICAgICAgdGhpcy53cmFwQm9keUlubGluZVdpdGhQYXJhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZG9tLmlzQm9keUNvbnRhaW5lcihzYykgJiYgZG9tLmlzRW1wdHkoc2MpKSB7XG4gICAgICAgICAgc2MuaW5uZXJIVE1MID0gZG9tLmVtcHR5UGFyYTtcbiAgICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzYy5maXJzdENoaWxkLCAwLCBzYy5maXJzdENoaWxkLCAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBbd29ya2Fyb3VuZF0gZmlyZWZveCBvZnRlbiBjcmVhdGUgcmFuZ2Ugb24gbm90IHZpc2libGUgcG9pbnQuIHNvIG5vcm1hbGl6ZSBoZXJlLlxuICAgICAgICAgKiAgLSBmaXJlZm94OiB8PHA+dGV4dDwvcD58XG4gICAgICAgICAqICAtIGNocm9tZTogPHA+fHRleHR8PC9wPlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHJuZyA9IHRoaXMubm9ybWFsaXplKCk7XG4gICAgICAgIGlmIChkb20uaXNQYXJhSW5saW5lKHNjKSB8fCBkb20uaXNQYXJhKHNjKSkge1xuICAgICAgICAgIHJldHVybiBybmc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmaW5kIGlubGluZSB0b3AgYW5jZXN0b3JcbiAgICAgICAgdmFyIHRvcEFuY2VzdG9yO1xuICAgICAgICBpZiAoZG9tLmlzSW5saW5lKHJuZy5zYykpIHtcbiAgICAgICAgICB2YXIgYW5jZXN0b3JzID0gZG9tLmxpc3RBbmNlc3Rvcihybmcuc2MsIGZ1bmMubm90KGRvbS5pc0lubGluZSkpO1xuICAgICAgICAgIHRvcEFuY2VzdG9yID0gbGlzdC5sYXN0KGFuY2VzdG9ycyk7XG4gICAgICAgICAgaWYgKCFkb20uaXNJbmxpbmUodG9wQW5jZXN0b3IpKSB7XG4gICAgICAgICAgICB0b3BBbmNlc3RvciA9IGFuY2VzdG9yc1thbmNlc3RvcnMubGVuZ3RoIC0gMl0gfHwgcm5nLnNjLmNoaWxkTm9kZXNbcm5nLnNvXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG9wQW5jZXN0b3IgPSBybmcuc2MuY2hpbGROb2Rlc1tybmcuc28gPiAwID8gcm5nLnNvIC0gMSA6IDBdO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gc2libGluZ3Mgbm90IGluIHBhcmFncmFwaFxuICAgICAgICB2YXIgaW5saW5lU2libGluZ3MgPSBkb20ubGlzdFByZXYodG9wQW5jZXN0b3IsIGRvbS5pc1BhcmFJbmxpbmUpLnJldmVyc2UoKTtcbiAgICAgICAgaW5saW5lU2libGluZ3MgPSBpbmxpbmVTaWJsaW5ncy5jb25jYXQoZG9tLmxpc3ROZXh0KHRvcEFuY2VzdG9yLm5leHRTaWJsaW5nLCBkb20uaXNQYXJhSW5saW5lKSk7XG5cbiAgICAgICAgLy8gd3JhcCB3aXRoIHBhcmFncmFwaFxuICAgICAgICBpZiAoaW5saW5lU2libGluZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIHBhcmEgPSBkb20ud3JhcChsaXN0LmhlYWQoaW5saW5lU2libGluZ3MpLCAncCcpO1xuICAgICAgICAgIGRvbS5hcHBlbmRDaGlsZE5vZGVzKHBhcmEsIGxpc3QudGFpbChpbmxpbmVTaWJsaW5ncykpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIGluc2VydCBub2RlIGF0IGN1cnJlbnQgY3Vyc29yXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICAgKiBAcmV0dXJuIHtOb2RlfVxuICAgICAgICovXG4gICAgICB0aGlzLmluc2VydE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICB2YXIgcm5nID0gdGhpcy53cmFwQm9keUlubGluZVdpdGhQYXJhKCkuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgICAgdmFyIGluZm8gPSBkb20uc3BsaXRQb2ludChybmcuZ2V0U3RhcnRQb2ludCgpLCBkb20uaXNJbmxpbmUobm9kZSkpO1xuXG4gICAgICAgIGlmIChpbmZvLnJpZ2h0Tm9kZSkge1xuICAgICAgICAgIGluZm8ucmlnaHROb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGluZm8ucmlnaHROb2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbmZvLmNvbnRhaW5lci5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub2RlO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBpbnNlcnQgaHRtbCBhdCBjdXJyZW50IGN1cnNvclxuICAgICAgICovXG4gICAgICB0aGlzLnBhc3RlSFRNTCA9IGZ1bmN0aW9uIChtYXJrdXApIHtcbiAgICAgICAgdmFyIGNvbnRlbnRzQ29udGFpbmVyID0gJCgnPGRpdj48L2Rpdj4nKS5odG1sKG1hcmt1cClbMF07XG4gICAgICAgIHZhciBjaGlsZE5vZGVzID0gbGlzdC5mcm9tKGNvbnRlbnRzQ29udGFpbmVyLmNoaWxkTm9kZXMpO1xuXG4gICAgICAgIHZhciBybmcgPSB0aGlzLndyYXBCb2R5SW5saW5lV2l0aFBhcmEoKS5kZWxldGVDb250ZW50cygpO1xuXG4gICAgICAgIHJldHVybiBjaGlsZE5vZGVzLnJldmVyc2UoKS5tYXAoZnVuY3Rpb24gKGNoaWxkTm9kZSkge1xuICAgICAgICAgIHJldHVybiBybmcuaW5zZXJ0Tm9kZShjaGlsZE5vZGUpO1xuICAgICAgICB9KS5yZXZlcnNlKCk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIHJldHVybnMgdGV4dCBpbiByYW5nZVxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm4ge1N0cmluZ31cbiAgICAgICAqL1xuICAgICAgdGhpcy50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5hdGl2ZVJuZyA9IG5hdGl2ZVJhbmdlKCk7XG4gICAgICAgIHJldHVybiBhZ2VudC5pc1czQ1JhbmdlU3VwcG9ydCA/IG5hdGl2ZVJuZy50b1N0cmluZygpIDogbmF0aXZlUm5nLnRleHQ7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIHJldHVybnMgcmFuZ2UgZm9yIHdvcmQgYmVmb3JlIGN1cnNvclxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2ZpbmRBZnRlcl0gLSBmaW5kIGFmdGVyIGN1cnNvciwgZGVmYXVsdDogZmFsc2VcbiAgICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgICAqL1xuICAgICAgdGhpcy5nZXRXb3JkUmFuZ2UgPSBmdW5jdGlvbiAoZmluZEFmdGVyKSB7XG4gICAgICAgIHZhciBlbmRQb2ludCA9IHRoaXMuZ2V0RW5kUG9pbnQoKTtcblxuICAgICAgICBpZiAoIWRvbS5pc0NoYXJQb2ludChlbmRQb2ludCkpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzdGFydFBvaW50ID0gZG9tLnByZXZQb2ludFVudGlsKGVuZFBvaW50LCBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICAgICAgICByZXR1cm4gIWRvbS5pc0NoYXJQb2ludChwb2ludCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChmaW5kQWZ0ZXIpIHtcbiAgICAgICAgICBlbmRQb2ludCA9IGRvbS5uZXh0UG9pbnRVbnRpbChlbmRQb2ludCwgZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgICAgICAgICByZXR1cm4gIWRvbS5pc0NoYXJQb2ludChwb2ludCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShcbiAgICAgICAgICBzdGFydFBvaW50Lm5vZGUsXG4gICAgICAgICAgc3RhcnRQb2ludC5vZmZzZXQsXG4gICAgICAgICAgZW5kUG9pbnQubm9kZSxcbiAgICAgICAgICBlbmRQb2ludC5vZmZzZXRcbiAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogY3JlYXRlIG9mZnNldFBhdGggYm9va21hcmtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge05vZGV9IGVkaXRhYmxlXG4gICAgICAgKi9cbiAgICAgIHRoaXMuYm9va21hcmsgPSBmdW5jdGlvbiAoZWRpdGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzOiB7XG4gICAgICAgICAgICBwYXRoOiBkb20ubWFrZU9mZnNldFBhdGgoZWRpdGFibGUsIHNjKSxcbiAgICAgICAgICAgIG9mZnNldDogc29cbiAgICAgICAgICB9LFxuICAgICAgICAgIGU6IHtcbiAgICAgICAgICAgIHBhdGg6IGRvbS5tYWtlT2Zmc2V0UGF0aChlZGl0YWJsZSwgZWMpLFxuICAgICAgICAgICAgb2Zmc2V0OiBlb1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogY3JlYXRlIG9mZnNldFBhdGggYm9va21hcmsgYmFzZSBvbiBwYXJhZ3JhcGhcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge05vZGVbXX0gcGFyYXNcbiAgICAgICAqL1xuICAgICAgdGhpcy5wYXJhQm9va21hcmsgPSBmdW5jdGlvbiAocGFyYXMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzOiB7XG4gICAgICAgICAgICBwYXRoOiBsaXN0LnRhaWwoZG9tLm1ha2VPZmZzZXRQYXRoKGxpc3QuaGVhZChwYXJhcyksIHNjKSksXG4gICAgICAgICAgICBvZmZzZXQ6IHNvXG4gICAgICAgICAgfSxcbiAgICAgICAgICBlOiB7XG4gICAgICAgICAgICBwYXRoOiBsaXN0LnRhaWwoZG9tLm1ha2VPZmZzZXRQYXRoKGxpc3QubGFzdChwYXJhcyksIGVjKSksXG4gICAgICAgICAgICBvZmZzZXQ6IGVvXG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBnZXRDbGllbnRSZWN0c1xuICAgICAgICogQHJldHVybiB7UmVjdFtdfVxuICAgICAgICovXG4gICAgICB0aGlzLmdldENsaWVudFJlY3RzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbmF0aXZlUm5nID0gbmF0aXZlUmFuZ2UoKTtcbiAgICAgICAgcmV0dXJuIG5hdGl2ZVJuZy5nZXRDbGllbnRSZWN0cygpO1xuICAgICAgfTtcbiAgICB9O1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgY29yZS5yYW5nZVxuICAgKlxuICAgKiBEYXRhIHN0cnVjdHVyZVxuICAgKiAgKiBCb3VuZGFyeVBvaW50OiBhIHBvaW50IG9mIGRvbSB0cmVlXG4gICAqICAqIEJvdW5kYXJ5UG9pbnRzOiB0d28gYm91bmRhcnlQb2ludHMgY29ycmVzcG9uZGluZyB0byB0aGUgc3RhcnQgYW5kIHRoZSBlbmQgb2YgdGhlIFJhbmdlXG4gICAqXG4gICAqIFNlZSB0byBodHRwOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1UcmF2ZXJzYWwtUmFuZ2UvcmFuZ2VzLmh0bWwjTGV2ZWwtMi1SYW5nZS1Qb3NpdGlvblxuICAgKlxuICAgKiBAc2luZ2xldG9uXG4gICAqIEBhbHRlcm5hdGVDbGFzc05hbWUgcmFuZ2VcbiAgICovXG4gICAgcmV0dXJuIHtcbiAgICAgIC8qKlxuICAgICAgICogY3JlYXRlIFJhbmdlIE9iamVjdCBGcm9tIGFyZ3VtZW50cyBvciBCcm93c2VyIFNlbGVjdGlvblxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Tm9kZX0gc2MgLSBzdGFydCBjb250YWluZXJcbiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzbyAtIHN0YXJ0IG9mZnNldFxuICAgICAgICogQHBhcmFtIHtOb2RlfSBlYyAtIGVuZCBjb250YWluZXJcbiAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBlbyAtIGVuZCBvZmZzZXRcbiAgICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgICAqL1xuICAgICAgY3JlYXRlOiBmdW5jdGlvbiAoc2MsIHNvLCBlYywgZW8pIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDQpIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gICAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgeyAvL2NvbGxhcHNlZFxuICAgICAgICAgIGVjID0gc2M7XG4gICAgICAgICAgZW8gPSBzbztcbiAgICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHdyYXBwZWRSYW5nZSA9IHRoaXMuY3JlYXRlRnJvbVNlbGVjdGlvbigpO1xuICAgICAgICAgIGlmICghd3JhcHBlZFJhbmdlICYmIGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHdyYXBwZWRSYW5nZSA9IHRoaXMuY3JlYXRlRnJvbU5vZGUoYXJndW1lbnRzWzBdKTtcbiAgICAgICAgICAgIHJldHVybiB3cmFwcGVkUmFuZ2UuY29sbGFwc2UoZG9tLmVtcHR5UGFyYSA9PT0gYXJndW1lbnRzWzBdLmlubmVySFRNTCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB3cmFwcGVkUmFuZ2U7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZUZyb21TZWxlY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNjLCBzbywgZWMsIGVvO1xuICAgICAgICBpZiAoYWdlbnQuaXNXM0NSYW5nZVN1cHBvcnQpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7XG4gICAgICAgICAgaWYgKCFzZWxlY3Rpb24gfHwgc2VsZWN0aW9uLnJhbmdlQ291bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZG9tLmlzQm9keShzZWxlY3Rpb24uYW5jaG9yTm9kZSkpIHtcbiAgICAgICAgICAgIC8vIEZpcmVmb3g6IHJldHVybnMgZW50aXJlIGJvZHkgYXMgcmFuZ2Ugb24gaW5pdGlhbGl6YXRpb24uXG4gICAgICAgICAgICAvLyBXZSB3b24ndCBuZXZlciBuZWVkIGl0LlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIG5hdGl2ZVJuZyA9IHNlbGVjdGlvbi5nZXRSYW5nZUF0KDApO1xuICAgICAgICAgIHNjID0gbmF0aXZlUm5nLnN0YXJ0Q29udGFpbmVyO1xuICAgICAgICAgIHNvID0gbmF0aXZlUm5nLnN0YXJ0T2Zmc2V0O1xuICAgICAgICAgIGVjID0gbmF0aXZlUm5nLmVuZENvbnRhaW5lcjtcbiAgICAgICAgICBlbyA9IG5hdGl2ZVJuZy5lbmRPZmZzZXQ7XG4gICAgICAgIH0gZWxzZSB7IC8vIElFODogVGV4dFJhbmdlXG4gICAgICAgICAgdmFyIHRleHRSYW5nZSA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgIHZhciB0ZXh0UmFuZ2VFbmQgPSB0ZXh0UmFuZ2UuZHVwbGljYXRlKCk7XG4gICAgICAgICAgdGV4dFJhbmdlRW5kLmNvbGxhcHNlKGZhbHNlKTtcbiAgICAgICAgICB2YXIgdGV4dFJhbmdlU3RhcnQgPSB0ZXh0UmFuZ2U7XG4gICAgICAgICAgdGV4dFJhbmdlU3RhcnQuY29sbGFwc2UodHJ1ZSk7XG5cbiAgICAgICAgICB2YXIgc3RhcnRQb2ludCA9IHRleHRSYW5nZVRvUG9pbnQodGV4dFJhbmdlU3RhcnQsIHRydWUpLFxuICAgICAgICAgIGVuZFBvaW50ID0gdGV4dFJhbmdlVG9Qb2ludCh0ZXh0UmFuZ2VFbmQsIGZhbHNlKTtcblxuICAgICAgICAgIC8vIHNhbWUgdmlzaWJsZSBwb2ludCBjYXNlOiByYW5nZSB3YXMgY29sbGFwc2VkLlxuICAgICAgICAgIGlmIChkb20uaXNUZXh0KHN0YXJ0UG9pbnQubm9kZSkgJiYgZG9tLmlzTGVmdEVkZ2VQb2ludChzdGFydFBvaW50KSAmJlxuICAgICAgICAgICAgICBkb20uaXNUZXh0Tm9kZShlbmRQb2ludC5ub2RlKSAmJiBkb20uaXNSaWdodEVkZ2VQb2ludChlbmRQb2ludCkgJiZcbiAgICAgICAgICAgICAgZW5kUG9pbnQubm9kZS5uZXh0U2libGluZyA9PT0gc3RhcnRQb2ludC5ub2RlKSB7XG4gICAgICAgICAgICBzdGFydFBvaW50ID0gZW5kUG9pbnQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc2MgPSBzdGFydFBvaW50LmNvbnQ7XG4gICAgICAgICAgc28gPSBzdGFydFBvaW50Lm9mZnNldDtcbiAgICAgICAgICBlYyA9IGVuZFBvaW50LmNvbnQ7XG4gICAgICAgICAgZW8gPSBlbmRQb2ludC5vZmZzZXQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFdyYXBwZWRSYW5nZShzYywgc28sIGVjLCBlbyk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2RcbiAgICAgICAqXG4gICAgICAgKiBjcmVhdGUgV3JhcHBlZFJhbmdlIGZyb20gbm9kZVxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAgICovXG4gICAgICBjcmVhdGVGcm9tTm9kZTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgdmFyIHNjID0gbm9kZTtcbiAgICAgICAgdmFyIHNvID0gMDtcbiAgICAgICAgdmFyIGVjID0gbm9kZTtcbiAgICAgICAgdmFyIGVvID0gZG9tLm5vZGVMZW5ndGgoZWMpO1xuXG4gICAgICAgIC8vIGJyb3dzZXJzIGNhbid0IHRhcmdldCBhIHBpY3R1cmUgb3Igdm9pZCBub2RlXG4gICAgICAgIGlmIChkb20uaXNWb2lkKHNjKSkge1xuICAgICAgICAgIHNvID0gZG9tLmxpc3RQcmV2KHNjKS5sZW5ndGggLSAxO1xuICAgICAgICAgIHNjID0gc2MucGFyZW50Tm9kZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9tLmlzQlIoZWMpKSB7XG4gICAgICAgICAgZW8gPSBkb20ubGlzdFByZXYoZWMpLmxlbmd0aCAtIDE7XG4gICAgICAgICAgZWMgPSBlYy5wYXJlbnROb2RlO1xuICAgICAgICB9IGVsc2UgaWYgKGRvbS5pc1ZvaWQoZWMpKSB7XG4gICAgICAgICAgZW8gPSBkb20ubGlzdFByZXYoZWMpLmxlbmd0aDtcbiAgICAgICAgICBlYyA9IGVjLnBhcmVudE5vZGU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGUoc2MsIHNvLCBlYywgZW8pO1xuICAgICAgfSxcblxuICAgICAgLyoqXG4gICAgICAgKiBjcmVhdGUgV3JhcHBlZFJhbmdlIGZyb20gbm9kZSBhZnRlciBwb3NpdGlvblxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAgICovXG4gICAgICBjcmVhdGVGcm9tTm9kZUJlZm9yZTogZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRnJvbU5vZGUobm9kZSkuY29sbGFwc2UodHJ1ZSk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIGNyZWF0ZSBXcmFwcGVkUmFuZ2UgZnJvbSBub2RlIGFmdGVyIHBvc2l0aW9uXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtOb2RlfSBub2RlXG4gICAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9XG4gICAgICAgKi9cbiAgICAgIGNyZWF0ZUZyb21Ob2RlQWZ0ZXI6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUZyb21Ob2RlKG5vZGUpLmNvbGxhcHNlKCk7XG4gICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAqIEBtZXRob2RcbiAgICAgICAqXG4gICAgICAgKiBjcmVhdGUgV3JhcHBlZFJhbmdlIGZyb20gYm9va21hcmtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge05vZGV9IGVkaXRhYmxlXG4gICAgICAgKiBAcGFyYW0ge09iamVjdH0gYm9va21hcmtcbiAgICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgICAqL1xuICAgICAgY3JlYXRlRnJvbUJvb2ttYXJrOiBmdW5jdGlvbiAoZWRpdGFibGUsIGJvb2ttYXJrKSB7XG4gICAgICAgIHZhciBzYyA9IGRvbS5mcm9tT2Zmc2V0UGF0aChlZGl0YWJsZSwgYm9va21hcmsucy5wYXRoKTtcbiAgICAgICAgdmFyIHNvID0gYm9va21hcmsucy5vZmZzZXQ7XG4gICAgICAgIHZhciBlYyA9IGRvbS5mcm9tT2Zmc2V0UGF0aChlZGl0YWJsZSwgYm9va21hcmsuZS5wYXRoKTtcbiAgICAgICAgdmFyIGVvID0gYm9va21hcmsuZS5vZmZzZXQ7XG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKHNjLCBzbywgZWMsIGVvKTtcbiAgICAgIH0sXG5cbiAgICAgIC8qKlxuICAgICAgICogQG1ldGhvZFxuICAgICAgICpcbiAgICAgICAqIGNyZWF0ZSBXcmFwcGVkUmFuZ2UgZnJvbSBwYXJhQm9va21hcmtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge09iamVjdH0gYm9va21hcmtcbiAgICAgICAqIEBwYXJhbSB7Tm9kZVtdfSBwYXJhc1xuICAgICAgICogQHJldHVybiB7V3JhcHBlZFJhbmdlfVxuICAgICAgICovXG4gICAgICBjcmVhdGVGcm9tUGFyYUJvb2ttYXJrOiBmdW5jdGlvbiAoYm9va21hcmssIHBhcmFzKSB7XG4gICAgICAgIHZhciBzbyA9IGJvb2ttYXJrLnMub2Zmc2V0O1xuICAgICAgICB2YXIgZW8gPSBib29rbWFyay5lLm9mZnNldDtcbiAgICAgICAgdmFyIHNjID0gZG9tLmZyb21PZmZzZXRQYXRoKGxpc3QuaGVhZChwYXJhcyksIGJvb2ttYXJrLnMucGF0aCk7XG4gICAgICAgIHZhciBlYyA9IGRvbS5mcm9tT2Zmc2V0UGF0aChsaXN0Lmxhc3QocGFyYXMpLCBib29rbWFyay5lLnBhdGgpO1xuXG4gICAgICAgIHJldHVybiBuZXcgV3JhcHBlZFJhbmdlKHNjLCBzbywgZWMsIGVvKTtcbiAgICAgIH1cbiAgICB9O1xuICB9KSgpO1xuXG4gIC8qKlxuICAgKiBAY2xhc3MgY29yZS5hc3luY1xuICAgKlxuICAgKiBBc3luYyBmdW5jdGlvbnMgd2hpY2ggcmV0dXJucyBgUHJvbWlzZWBcbiAgICpcbiAgICogQHNpbmdsZXRvblxuICAgKiBAYWx0ZXJuYXRlQ2xhc3NOYW1lIGFzeW5jXG4gICAqL1xuICB2YXIgYXN5bmMgPSAoZnVuY3Rpb24gKCkge1xuICAgIC8qKlxuICAgICAqIEBtZXRob2QgcmVhZEZpbGVBc0RhdGFVUkxcbiAgICAgKlxuICAgICAqIHJlYWQgY29udGVudHMgb2YgZmlsZSBhcyByZXByZXNlbnRpbmcgVVJMXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0ZpbGV9IGZpbGVcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfSAtIHRoZW46IGRhdGFVcmxcbiAgICAgKi9cbiAgICB2YXIgcmVhZEZpbGVBc0RhdGFVUkwgPSBmdW5jdGlvbiAoZmlsZSkge1xuICAgICAgcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24gKGRlZmVycmVkKSB7XG4gICAgICAgICQuZXh0ZW5kKG5ldyBGaWxlUmVhZGVyKCksIHtcbiAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgZGF0YVVSTCA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGF0YVVSTCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbmVycm9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QodGhpcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KS5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgICAgfSkucHJvbWlzZSgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGNyZWF0ZUltYWdlXG4gICAgICpcbiAgICAgKiBjcmVhdGUgYDxpbWFnZT5gIGZyb20gdXJsIHN0cmluZ1xuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHVybFxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9IC0gdGhlbjogJGltYWdlXG4gICAgICovXG4gICAgdmFyIGNyZWF0ZUltYWdlID0gZnVuY3Rpb24gKHVybCkge1xuICAgICAgcmV0dXJuICQuRGVmZXJyZWQoZnVuY3Rpb24gKGRlZmVycmVkKSB7XG4gICAgICAgIHZhciAkaW1nID0gJCgnPGltZz4nKTtcblxuICAgICAgICAkaW1nLm9uZSgnbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkaW1nLm9mZignZXJyb3IgYWJvcnQnKTtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCRpbWcpO1xuICAgICAgICB9KS5vbmUoJ2Vycm9yIGFib3J0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRpbWcub2ZmKCdsb2FkJykuZGV0YWNoKCk7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCRpbWcpO1xuICAgICAgICB9KS5jc3Moe1xuICAgICAgICAgIGRpc3BsYXk6ICdub25lJ1xuICAgICAgICB9KS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KS5hdHRyKCdzcmMnLCB1cmwpO1xuICAgICAgfSkucHJvbWlzZSgpO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVhZEZpbGVBc0RhdGFVUkw6IHJlYWRGaWxlQXNEYXRhVVJMLFxuICAgICAgY3JlYXRlSW1hZ2U6IGNyZWF0ZUltYWdlXG4gICAgfTtcbiAgfSkoKTtcblxuICAvKipcbiAgICogQGNsYXNzIGVkaXRpbmcuSGlzdG9yeVxuICAgKlxuICAgKiBFZGl0b3IgSGlzdG9yeVxuICAgKlxuICAgKi9cbiAgdmFyIEhpc3RvcnkgPSBmdW5jdGlvbiAoJGVkaXRhYmxlKSB7XG4gICAgdmFyIHN0YWNrID0gW10sIHN0YWNrT2Zmc2V0ID0gLTE7XG4gICAgdmFyIGVkaXRhYmxlID0gJGVkaXRhYmxlWzBdO1xuXG4gICAgdmFyIG1ha2VTbmFwc2hvdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBybmcgPSByYW5nZS5jcmVhdGUoZWRpdGFibGUpO1xuICAgICAgdmFyIGVtcHR5Qm9va21hcmsgPSB7czoge3BhdGg6IFtdLCBvZmZzZXQ6IDB9LCBlOiB7cGF0aDogW10sIG9mZnNldDogMH19O1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb250ZW50czogJGVkaXRhYmxlLmh0bWwoKSxcbiAgICAgICAgYm9va21hcms6IChybmcgPyBybmcuYm9va21hcmsoZWRpdGFibGUpIDogZW1wdHlCb29rbWFyaylcbiAgICAgIH07XG4gICAgfTtcblxuICAgIHZhciBhcHBseVNuYXBzaG90ID0gZnVuY3Rpb24gKHNuYXBzaG90KSB7XG4gICAgICBpZiAoc25hcHNob3QuY29udGVudHMgIT09IG51bGwpIHtcbiAgICAgICAgJGVkaXRhYmxlLmh0bWwoc25hcHNob3QuY29udGVudHMpO1xuICAgICAgfVxuICAgICAgaWYgKHNuYXBzaG90LmJvb2ttYXJrICE9PSBudWxsKSB7XG4gICAgICAgIHJhbmdlLmNyZWF0ZUZyb21Cb29rbWFyayhlZGl0YWJsZSwgc25hcHNob3QuYm9va21hcmspLnNlbGVjdCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAqIEBtZXRob2QgcmV3aW5kXG4gICAgKiBSZXdpbmRzIHRoZSBoaXN0b3J5IHN0YWNrIGJhY2sgdG8gdGhlIGZpcnN0IHNuYXBzaG90IHRha2VuLlxuICAgICogTGVhdmVzIHRoZSBzdGFjayBpbnRhY3QsIHNvIHRoYXQgXCJSZWRvXCIgY2FuIHN0aWxsIGJlIHVzZWQuXG4gICAgKi9cbiAgICB0aGlzLnJld2luZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIENyZWF0ZSBzbmFwIHNob3QgaWYgbm90IHlldCByZWNvcmRlZFxuICAgICAgaWYgKCRlZGl0YWJsZS5odG1sKCkgIT09IHN0YWNrW3N0YWNrT2Zmc2V0XS5jb250ZW50cykge1xuICAgICAgICB0aGlzLnJlY29yZFVuZG8oKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIHRvIHRoZSBmaXJzdCBhdmFpbGFibGUgc25hcHNob3QuXG4gICAgICBzdGFja09mZnNldCA9IDA7XG5cbiAgICAgIC8vIEFwcGx5IHRoYXQgc25hcHNob3QuXG4gICAgICBhcHBseVNuYXBzaG90KHN0YWNrW3N0YWNrT2Zmc2V0XSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICogQG1ldGhvZCByZXNldFxuICAgICogUmVzZXRzIHRoZSBoaXN0b3J5IHN0YWNrIGNvbXBsZXRlbHk7IHJldmVydGluZyB0byBhbiBlbXB0eSBlZGl0b3IuXG4gICAgKi9cbiAgICB0aGlzLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy8gQ2xlYXIgdGhlIHN0YWNrLlxuICAgICAgc3RhY2sgPSBbXTtcblxuICAgICAgLy8gUmVzdG9yZSBzdGFja09mZnNldCB0byBpdHMgb3JpZ2luYWwgdmFsdWUuXG4gICAgICBzdGFja09mZnNldCA9IC0xO1xuXG4gICAgICAvLyBDbGVhciB0aGUgZWRpdGFibGUgYXJlYS5cbiAgICAgICRlZGl0YWJsZS5odG1sKCcnKTtcblxuICAgICAgLy8gUmVjb3JkIG91ciBmaXJzdCBzbmFwc2hvdCAob2Ygbm90aGluZykuXG4gICAgICB0aGlzLnJlY29yZFVuZG8oKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogdW5kb1xuICAgICAqL1xuICAgIHRoaXMudW5kbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIENyZWF0ZSBzbmFwIHNob3QgaWYgbm90IHlldCByZWNvcmRlZFxuICAgICAgaWYgKCRlZGl0YWJsZS5odG1sKCkgIT09IHN0YWNrW3N0YWNrT2Zmc2V0XS5jb250ZW50cykge1xuICAgICAgICB0aGlzLnJlY29yZFVuZG8oKTtcbiAgICAgIH1cblxuICAgICAgaWYgKDAgPCBzdGFja09mZnNldCkge1xuICAgICAgICBzdGFja09mZnNldC0tO1xuICAgICAgICBhcHBseVNuYXBzaG90KHN0YWNrW3N0YWNrT2Zmc2V0XSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJlZG9cbiAgICAgKi9cbiAgICB0aGlzLnJlZG8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoc3RhY2subGVuZ3RoIC0gMSA+IHN0YWNrT2Zmc2V0KSB7XG4gICAgICAgIHN0YWNrT2Zmc2V0Kys7XG4gICAgICAgIGFwcGx5U25hcHNob3Qoc3RhY2tbc3RhY2tPZmZzZXRdKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmVjb3JkZWQgdW5kb1xuICAgICAqL1xuICAgIHRoaXMucmVjb3JkVW5kbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHN0YWNrT2Zmc2V0Kys7XG5cbiAgICAgIC8vIFdhc2ggb3V0IHN0YWNrIGFmdGVyIHN0YWNrT2Zmc2V0XG4gICAgICBpZiAoc3RhY2subGVuZ3RoID4gc3RhY2tPZmZzZXQpIHtcbiAgICAgICAgc3RhY2sgPSBzdGFjay5zbGljZSgwLCBzdGFja09mZnNldCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBuZXcgc25hcHNob3QgYW5kIHB1c2ggaXQgdG8gdGhlIGVuZFxuICAgICAgc3RhY2sucHVzaChtYWtlU25hcHNob3QoKSk7XG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogQGNsYXNzIGVkaXRpbmcuU3R5bGVcbiAgICpcbiAgICogU3R5bGVcbiAgICpcbiAgICovXG4gIHZhciBTdHlsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIGpRdWVyeUNTU1xuICAgICAqXG4gICAgICogW3dvcmthcm91bmRdIGZvciBvbGQgalF1ZXJ5XG4gICAgICogcGFzc2luZyBhbiBhcnJheSBvZiBzdHlsZSBwcm9wZXJ0aWVzIHRvIC5jc3MoKVxuICAgICAqIHdpbGwgcmVzdWx0IGluIGFuIG9iamVjdCBvZiBwcm9wZXJ0eS12YWx1ZSBwYWlycy5cbiAgICAgKiAoY29tcGFiaWxpdHkgd2l0aCB2ZXJzaW9uIDwgMS45KVxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0gIHtqUXVlcnl9ICRvYmpcbiAgICAgKiBAcGFyYW0gIHtBcnJheX0gcHJvcGVydHlOYW1lcyAtIEFuIGFycmF5IG9mIG9uZSBvciBtb3JlIENTUyBwcm9wZXJ0aWVzLlxuICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgKi9cbiAgICB2YXIgalF1ZXJ5Q1NTID0gZnVuY3Rpb24gKCRvYmosIHByb3BlcnR5TmFtZXMpIHtcbiAgICAgIGlmIChhZ2VudC5qcXVlcnlWZXJzaW9uIDwgMS45KSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgICAgJC5lYWNoKHByb3BlcnR5TmFtZXMsIGZ1bmN0aW9uIChpZHgsIHByb3BlcnR5TmFtZSkge1xuICAgICAgICAgIHJlc3VsdFtwcm9wZXJ0eU5hbWVdID0gJG9iai5jc3MocHJvcGVydHlOYW1lKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gJG9iai5jc3MuY2FsbCgkb2JqLCBwcm9wZXJ0eU5hbWVzKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBzdHlsZSBvYmplY3QgZnJvbSBub2RlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJG5vZGVcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICovXG4gICAgdGhpcy5mcm9tTm9kZSA9IGZ1bmN0aW9uICgkbm9kZSkge1xuICAgICAgdmFyIHByb3BlcnRpZXMgPSBbJ2ZvbnQtZmFtaWx5JywgJ2ZvbnQtc2l6ZScsICd0ZXh0LWFsaWduJywgJ2xpc3Qtc3R5bGUtdHlwZScsICdsaW5lLWhlaWdodCddO1xuICAgICAgdmFyIHN0eWxlSW5mbyA9IGpRdWVyeUNTUygkbm9kZSwgcHJvcGVydGllcykgfHwge307XG4gICAgICBzdHlsZUluZm9bJ2ZvbnQtc2l6ZSddID0gcGFyc2VJbnQoc3R5bGVJbmZvWydmb250LXNpemUnXSwgMTApO1xuICAgICAgcmV0dXJuIHN0eWxlSW5mbztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcGFyYWdyYXBoIGxldmVsIHN0eWxlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dyYXBwZWRSYW5nZX0gcm5nXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHN0eWxlSW5mb1xuICAgICAqL1xuICAgIHRoaXMuc3R5bGVQYXJhID0gZnVuY3Rpb24gKHJuZywgc3R5bGVJbmZvKSB7XG4gICAgICAkLmVhY2gocm5nLm5vZGVzKGRvbS5pc1BhcmEsIHtcbiAgICAgICAgaW5jbHVkZUFuY2VzdG9yOiB0cnVlXG4gICAgICB9KSwgZnVuY3Rpb24gKGlkeCwgcGFyYSkge1xuICAgICAgICAkKHBhcmEpLmNzcyhzdHlsZUluZm8pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydCBhbmQgcmV0dXJucyBzdHlsZU5vZGVzIG9uIHJhbmdlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtXcmFwcGVkUmFuZ2V9IHJuZ1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBvcHRpb25zIGZvciBzdHlsZU5vZGVzXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtvcHRpb25zLm5vZGVOYW1lXSAtIGRlZmF1bHQ6IGBTUEFOYFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuZXhwYW5kQ2xvc2VzdFNpYmxpbmddIC0gZGVmYXVsdDogYGZhbHNlYFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMub25seVBhcnRpYWxDb250YWluc10gLSBkZWZhdWx0OiBgZmFsc2VgXG4gICAgICogQHJldHVybiB7Tm9kZVtdfVxuICAgICAqL1xuICAgIHRoaXMuc3R5bGVOb2RlcyA9IGZ1bmN0aW9uIChybmcsIG9wdGlvbnMpIHtcbiAgICAgIHJuZyA9IHJuZy5zcGxpdFRleHQoKTtcblxuICAgICAgdmFyIG5vZGVOYW1lID0gb3B0aW9ucyAmJiBvcHRpb25zLm5vZGVOYW1lIHx8ICdTUEFOJztcbiAgICAgIHZhciBleHBhbmRDbG9zZXN0U2libGluZyA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5leHBhbmRDbG9zZXN0U2libGluZyk7XG4gICAgICB2YXIgb25seVBhcnRpYWxDb250YWlucyA9ICEhKG9wdGlvbnMgJiYgb3B0aW9ucy5vbmx5UGFydGlhbENvbnRhaW5zKTtcblxuICAgICAgaWYgKHJuZy5pc0NvbGxhcHNlZCgpKSB7XG4gICAgICAgIHJldHVybiBbcm5nLmluc2VydE5vZGUoZG9tLmNyZWF0ZShub2RlTmFtZSkpXTtcbiAgICAgIH1cblxuICAgICAgdmFyIHByZWQgPSBkb20ubWFrZVByZWRCeU5vZGVOYW1lKG5vZGVOYW1lKTtcbiAgICAgIHZhciBub2RlcyA9IHJuZy5ub2Rlcyhkb20uaXNUZXh0LCB7XG4gICAgICAgIGZ1bGx5Q29udGFpbnM6IHRydWVcbiAgICAgIH0pLm1hcChmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICByZXR1cm4gZG9tLnNpbmdsZUNoaWxkQW5jZXN0b3IodGV4dCwgcHJlZCkgfHwgZG9tLndyYXAodGV4dCwgbm9kZU5hbWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChleHBhbmRDbG9zZXN0U2libGluZykge1xuICAgICAgICBpZiAob25seVBhcnRpYWxDb250YWlucykge1xuICAgICAgICAgIHZhciBub2Rlc0luUmFuZ2UgPSBybmcubm9kZXMoKTtcbiAgICAgICAgICAvLyBjb21wb3NlIHdpdGggcGFydGlhbCBjb250YWlucyBwcmVkaWNhdGlvblxuICAgICAgICAgIHByZWQgPSBmdW5jLmFuZChwcmVkLCBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgcmV0dXJuIGxpc3QuY29udGFpbnMobm9kZXNJblJhbmdlLCBub2RlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBub2Rlcy5tYXAoZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgICB2YXIgc2libGluZ3MgPSBkb20ud2l0aENsb3Nlc3RTaWJsaW5ncyhub2RlLCBwcmVkKTtcbiAgICAgICAgICB2YXIgaGVhZCA9IGxpc3QuaGVhZChzaWJsaW5ncyk7XG4gICAgICAgICAgdmFyIHRhaWxzID0gbGlzdC50YWlsKHNpYmxpbmdzKTtcbiAgICAgICAgICAkLmVhY2godGFpbHMsIGZ1bmN0aW9uIChpZHgsIGVsZW0pIHtcbiAgICAgICAgICAgIGRvbS5hcHBlbmRDaGlsZE5vZGVzKGhlYWQsIGVsZW0uY2hpbGROb2Rlcyk7XG4gICAgICAgICAgICBkb20ucmVtb3ZlKGVsZW0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBsaXN0LmhlYWQoc2libGluZ3MpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBub2RlcztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogZ2V0IGN1cnJlbnQgc3R5bGUgb24gY3Vyc29yXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dyYXBwZWRSYW5nZX0gcm5nXG4gICAgICogQHJldHVybiB7T2JqZWN0fSAtIG9iamVjdCBjb250YWlucyBzdHlsZSBwcm9wZXJ0aWVzLlxuICAgICAqL1xuICAgIHRoaXMuY3VycmVudCA9IGZ1bmN0aW9uIChybmcpIHtcbiAgICAgIHZhciAkY29udCA9ICQoIWRvbS5pc0VsZW1lbnQocm5nLnNjKSA/IHJuZy5zYy5wYXJlbnROb2RlIDogcm5nLnNjKTtcbiAgICAgIHZhciBzdHlsZUluZm8gPSB0aGlzLmZyb21Ob2RlKCRjb250KTtcblxuICAgICAgLy8gZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUgZm9yIHRvZ2dsZSBzdGF0ZVxuICAgICAgLy8gW3dvcmthcm91bmRdIHByZXZlbnQgRmlyZWZveCBuc3Jlc3VsdDogXCIweDgwMDA0MDA1IChOU19FUlJPUl9GQUlMVVJFKVwiXG4gICAgICB0cnkge1xuICAgICAgICBzdHlsZUluZm8gPSAkLmV4dGVuZChzdHlsZUluZm8sIHtcbiAgICAgICAgICAnZm9udC1ib2xkJzogZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoJ2JvbGQnKSA/ICdib2xkJyA6ICdub3JtYWwnLFxuICAgICAgICAgICdmb250LWl0YWxpYyc6IGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKCdpdGFsaWMnKSA/ICdpdGFsaWMnIDogJ25vcm1hbCcsXG4gICAgICAgICAgJ2ZvbnQtdW5kZXJsaW5lJzogZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoJ3VuZGVybGluZScpID8gJ3VuZGVybGluZScgOiAnbm9ybWFsJyxcbiAgICAgICAgICAnZm9udC1zdWJzY3JpcHQnOiBkb2N1bWVudC5xdWVyeUNvbW1hbmRTdGF0ZSgnc3Vic2NyaXB0JykgPyAnc3Vic2NyaXB0JyA6ICdub3JtYWwnLFxuICAgICAgICAgICdmb250LXN1cGVyc2NyaXB0JzogZG9jdW1lbnQucXVlcnlDb21tYW5kU3RhdGUoJ3N1cGVyc2NyaXB0JykgPyAnc3VwZXJzY3JpcHQnIDogJ25vcm1hbCcsXG4gICAgICAgICAgJ2ZvbnQtc3RyaWtldGhyb3VnaCc6IGRvY3VtZW50LnF1ZXJ5Q29tbWFuZFN0YXRlKCdzdHJpa2V0aHJvdWdoJykgPyAnc3RyaWtldGhyb3VnaCcgOiAnbm9ybWFsJ1xuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICAgIC8vIGxpc3Qtc3R5bGUtdHlwZSB0byBsaXN0LXN0eWxlKHVub3JkZXJlZCwgb3JkZXJlZClcbiAgICAgIGlmICghcm5nLmlzT25MaXN0KCkpIHtcbiAgICAgICAgc3R5bGVJbmZvWydsaXN0LXN0eWxlJ10gPSAnbm9uZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgb3JkZXJlZFR5cGVzID0gWydjaXJjbGUnLCAnZGlzYycsICdkaXNjLWxlYWRpbmctemVybycsICdzcXVhcmUnXTtcbiAgICAgICAgdmFyIGlzVW5vcmRlcmVkID0gJC5pbkFycmF5KHN0eWxlSW5mb1snbGlzdC1zdHlsZS10eXBlJ10sIG9yZGVyZWRUeXBlcykgPiAtMTtcbiAgICAgICAgc3R5bGVJbmZvWydsaXN0LXN0eWxlJ10gPSBpc1Vub3JkZXJlZCA/ICd1bm9yZGVyZWQnIDogJ29yZGVyZWQnO1xuICAgICAgfVxuXG4gICAgICB2YXIgcGFyYSA9IGRvbS5hbmNlc3Rvcihybmcuc2MsIGRvbS5pc1BhcmEpO1xuICAgICAgaWYgKHBhcmEgJiYgcGFyYS5zdHlsZVsnbGluZS1oZWlnaHQnXSkge1xuICAgICAgICBzdHlsZUluZm9bJ2xpbmUtaGVpZ2h0J10gPSBwYXJhLnN0eWxlLmxpbmVIZWlnaHQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbGluZUhlaWdodCA9IHBhcnNlSW50KHN0eWxlSW5mb1snbGluZS1oZWlnaHQnXSwgMTApIC8gcGFyc2VJbnQoc3R5bGVJbmZvWydmb250LXNpemUnXSwgMTApO1xuICAgICAgICBzdHlsZUluZm9bJ2xpbmUtaGVpZ2h0J10gPSBsaW5lSGVpZ2h0LnRvRml4ZWQoMSk7XG4gICAgICB9XG5cbiAgICAgIHN0eWxlSW5mby5hbmNob3IgPSBybmcuaXNPbkFuY2hvcigpICYmIGRvbS5hbmNlc3Rvcihybmcuc2MsIGRvbS5pc0FuY2hvcik7XG4gICAgICBzdHlsZUluZm8uYW5jZXN0b3JzID0gZG9tLmxpc3RBbmNlc3Rvcihybmcuc2MsIGRvbS5pc0VkaXRhYmxlKTtcbiAgICAgIHN0eWxlSW5mby5yYW5nZSA9IHJuZztcblxuICAgICAgcmV0dXJuIHN0eWxlSW5mbztcbiAgICB9O1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBjbGFzcyBlZGl0aW5nLkJ1bGxldFxuICAgKlxuICAgKiBAYWx0ZXJuYXRlQ2xhc3NOYW1lIEJ1bGxldFxuICAgKi9cbiAgdmFyIEJ1bGxldCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAvKipcbiAgICAgKiB0b2dnbGUgb3JkZXJlZCBsaXN0XG4gICAgICovXG4gICAgdGhpcy5pbnNlcnRPcmRlcmVkTGlzdCA9IGZ1bmN0aW9uIChlZGl0YWJsZSkge1xuICAgICAgdGhpcy50b2dnbGVMaXN0KCdPTCcsIGVkaXRhYmxlKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogdG9nZ2xlIHVub3JkZXJlZCBsaXN0XG4gICAgICovXG4gICAgdGhpcy5pbnNlcnRVbm9yZGVyZWRMaXN0ID0gZnVuY3Rpb24gKGVkaXRhYmxlKSB7XG4gICAgICB0aGlzLnRvZ2dsZUxpc3QoJ1VMJywgZWRpdGFibGUpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBpbmRlbnRcbiAgICAgKi9cbiAgICB0aGlzLmluZGVudCA9IGZ1bmN0aW9uIChlZGl0YWJsZSkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIHJuZyA9IHJhbmdlLmNyZWF0ZShlZGl0YWJsZSkud3JhcEJvZHlJbmxpbmVXaXRoUGFyYSgpO1xuXG4gICAgICB2YXIgcGFyYXMgPSBybmcubm9kZXMoZG9tLmlzUGFyYSwgeyBpbmNsdWRlQW5jZXN0b3I6IHRydWUgfSk7XG4gICAgICB2YXIgY2x1c3RlcmVkcyA9IGxpc3QuY2x1c3RlckJ5KHBhcmFzLCBmdW5jLnBlcTIoJ3BhcmVudE5vZGUnKSk7XG5cbiAgICAgICQuZWFjaChjbHVzdGVyZWRzLCBmdW5jdGlvbiAoaWR4LCBwYXJhcykge1xuICAgICAgICB2YXIgaGVhZCA9IGxpc3QuaGVhZChwYXJhcyk7XG4gICAgICAgIGlmIChkb20uaXNMaShoZWFkKSkge1xuICAgICAgICAgIHNlbGYud3JhcExpc3QocGFyYXMsIGhlYWQucGFyZW50Tm9kZS5ub2RlTmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJC5lYWNoKHBhcmFzLCBmdW5jdGlvbiAoaWR4LCBwYXJhKSB7XG4gICAgICAgICAgICAkKHBhcmEpLmNzcygnbWFyZ2luTGVmdCcsIGZ1bmN0aW9uIChpZHgsIHZhbCkge1xuICAgICAgICAgICAgICByZXR1cm4gKHBhcnNlSW50KHZhbCwgMTApIHx8IDApICsgMjU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJuZy5zZWxlY3QoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogb3V0ZGVudFxuICAgICAqL1xuICAgIHRoaXMub3V0ZGVudCA9IGZ1bmN0aW9uIChlZGl0YWJsZSkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIHJuZyA9IHJhbmdlLmNyZWF0ZShlZGl0YWJsZSkud3JhcEJvZHlJbmxpbmVXaXRoUGFyYSgpO1xuXG4gICAgICB2YXIgcGFyYXMgPSBybmcubm9kZXMoZG9tLmlzUGFyYSwgeyBpbmNsdWRlQW5jZXN0b3I6IHRydWUgfSk7XG4gICAgICB2YXIgY2x1c3RlcmVkcyA9IGxpc3QuY2x1c3RlckJ5KHBhcmFzLCBmdW5jLnBlcTIoJ3BhcmVudE5vZGUnKSk7XG5cbiAgICAgICQuZWFjaChjbHVzdGVyZWRzLCBmdW5jdGlvbiAoaWR4LCBwYXJhcykge1xuICAgICAgICB2YXIgaGVhZCA9IGxpc3QuaGVhZChwYXJhcyk7XG4gICAgICAgIGlmIChkb20uaXNMaShoZWFkKSkge1xuICAgICAgICAgIHNlbGYucmVsZWFzZUxpc3QoW3BhcmFzXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJC5lYWNoKHBhcmFzLCBmdW5jdGlvbiAoaWR4LCBwYXJhKSB7XG4gICAgICAgICAgICAkKHBhcmEpLmNzcygnbWFyZ2luTGVmdCcsIGZ1bmN0aW9uIChpZHgsIHZhbCkge1xuICAgICAgICAgICAgICB2YWwgPSAocGFyc2VJbnQodmFsLCAxMCkgfHwgMCk7XG4gICAgICAgICAgICAgIHJldHVybiB2YWwgPiAyNSA/IHZhbCAtIDI1IDogJyc7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJuZy5zZWxlY3QoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogdG9nZ2xlIGxpc3RcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsaXN0TmFtZSAtIE9MIG9yIFVMXG4gICAgICovXG4gICAgdGhpcy50b2dnbGVMaXN0ID0gZnVuY3Rpb24gKGxpc3ROYW1lLCBlZGl0YWJsZSkge1xuICAgICAgdmFyIHJuZyA9IHJhbmdlLmNyZWF0ZShlZGl0YWJsZSkud3JhcEJvZHlJbmxpbmVXaXRoUGFyYSgpO1xuXG4gICAgICB2YXIgcGFyYXMgPSBybmcubm9kZXMoZG9tLmlzUGFyYSwgeyBpbmNsdWRlQW5jZXN0b3I6IHRydWUgfSk7XG4gICAgICB2YXIgYm9va21hcmsgPSBybmcucGFyYUJvb2ttYXJrKHBhcmFzKTtcbiAgICAgIHZhciBjbHVzdGVyZWRzID0gbGlzdC5jbHVzdGVyQnkocGFyYXMsIGZ1bmMucGVxMigncGFyZW50Tm9kZScpKTtcblxuICAgICAgLy8gcGFyYWdyYXBoIHRvIGxpc3RcbiAgICAgIGlmIChsaXN0LmZpbmQocGFyYXMsIGRvbS5pc1B1cmVQYXJhKSkge1xuICAgICAgICB2YXIgd3JhcHBlZFBhcmFzID0gW107XG4gICAgICAgICQuZWFjaChjbHVzdGVyZWRzLCBmdW5jdGlvbiAoaWR4LCBwYXJhcykge1xuICAgICAgICAgIHdyYXBwZWRQYXJhcyA9IHdyYXBwZWRQYXJhcy5jb25jYXQoc2VsZi53cmFwTGlzdChwYXJhcywgbGlzdE5hbWUpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcmFzID0gd3JhcHBlZFBhcmFzO1xuICAgICAgLy8gbGlzdCB0byBwYXJhZ3JhcGggb3IgY2hhbmdlIGxpc3Qgc3R5bGVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBkaWZmTGlzdHMgPSBybmcubm9kZXMoZG9tLmlzTGlzdCwge1xuICAgICAgICAgIGluY2x1ZGVBbmNlc3RvcjogdHJ1ZVxuICAgICAgICB9KS5maWx0ZXIoZnVuY3Rpb24gKGxpc3ROb2RlKSB7XG4gICAgICAgICAgcmV0dXJuICEkLm5vZGVOYW1lKGxpc3ROb2RlLCBsaXN0TmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChkaWZmTGlzdHMubGVuZ3RoKSB7XG4gICAgICAgICAgJC5lYWNoKGRpZmZMaXN0cywgZnVuY3Rpb24gKGlkeCwgbGlzdE5vZGUpIHtcbiAgICAgICAgICAgIGRvbS5yZXBsYWNlKGxpc3ROb2RlLCBsaXN0TmFtZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFyYXMgPSB0aGlzLnJlbGVhc2VMaXN0KGNsdXN0ZXJlZHMsIHRydWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJhbmdlLmNyZWF0ZUZyb21QYXJhQm9va21hcmsoYm9va21hcmssIHBhcmFzKS5zZWxlY3QoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtOb2RlW119IHBhcmFzXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGxpc3ROYW1lXG4gICAgICogQHJldHVybiB7Tm9kZVtdfVxuICAgICAqL1xuICAgIHRoaXMud3JhcExpc3QgPSBmdW5jdGlvbiAocGFyYXMsIGxpc3ROYW1lKSB7XG4gICAgICB2YXIgaGVhZCA9IGxpc3QuaGVhZChwYXJhcyk7XG4gICAgICB2YXIgbGFzdCA9IGxpc3QubGFzdChwYXJhcyk7XG5cbiAgICAgIHZhciBwcmV2TGlzdCA9IGRvbS5pc0xpc3QoaGVhZC5wcmV2aW91c1NpYmxpbmcpICYmIGhlYWQucHJldmlvdXNTaWJsaW5nO1xuICAgICAgdmFyIG5leHRMaXN0ID0gZG9tLmlzTGlzdChsYXN0Lm5leHRTaWJsaW5nKSAmJiBsYXN0Lm5leHRTaWJsaW5nO1xuXG4gICAgICB2YXIgbGlzdE5vZGUgPSBwcmV2TGlzdCB8fCBkb20uaW5zZXJ0QWZ0ZXIoZG9tLmNyZWF0ZShsaXN0TmFtZSB8fCAnVUwnKSwgbGFzdCk7XG5cbiAgICAgIC8vIFAgdG8gTElcbiAgICAgIHBhcmFzID0gcGFyYXMubWFwKGZ1bmN0aW9uIChwYXJhKSB7XG4gICAgICAgIHJldHVybiBkb20uaXNQdXJlUGFyYShwYXJhKSA/IGRvbS5yZXBsYWNlKHBhcmEsICdMSScpIDogcGFyYTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBhcHBlbmQgdG8gbGlzdCg8dWw+LCA8b2w+KVxuICAgICAgZG9tLmFwcGVuZENoaWxkTm9kZXMobGlzdE5vZGUsIHBhcmFzKTtcblxuICAgICAgaWYgKG5leHRMaXN0KSB7XG4gICAgICAgIGRvbS5hcHBlbmRDaGlsZE5vZGVzKGxpc3ROb2RlLCBsaXN0LmZyb20obmV4dExpc3QuY2hpbGROb2RlcykpO1xuICAgICAgICBkb20ucmVtb3ZlKG5leHRMaXN0KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHBhcmFzO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbWV0aG9kIHJlbGVhc2VMaXN0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0FycmF5W119IGNsdXN0ZXJlZHNcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzRXNjYXBzZVRvQm9keVxuICAgICAqIEByZXR1cm4ge05vZGVbXX1cbiAgICAgKi9cbiAgICB0aGlzLnJlbGVhc2VMaXN0ID0gZnVuY3Rpb24gKGNsdXN0ZXJlZHMsIGlzRXNjYXBzZVRvQm9keSkge1xuICAgICAgdmFyIHJlbGVhc2VkUGFyYXMgPSBbXTtcblxuICAgICAgJC5lYWNoKGNsdXN0ZXJlZHMsIGZ1bmN0aW9uIChpZHgsIHBhcmFzKSB7XG4gICAgICAgIHZhciBoZWFkID0gbGlzdC5oZWFkKHBhcmFzKTtcbiAgICAgICAgdmFyIGxhc3QgPSBsaXN0Lmxhc3QocGFyYXMpO1xuXG4gICAgICAgIHZhciBoZWFkTGlzdCA9IGlzRXNjYXBzZVRvQm9keSA/IGRvbS5sYXN0QW5jZXN0b3IoaGVhZCwgZG9tLmlzTGlzdCkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkLnBhcmVudE5vZGU7XG4gICAgICAgIHZhciBsYXN0TGlzdCA9IGhlYWRMaXN0LmNoaWxkTm9kZXMubGVuZ3RoID4gMSA/IGRvbS5zcGxpdFRyZWUoaGVhZExpc3QsIHtcbiAgICAgICAgICBub2RlOiBsYXN0LnBhcmVudE5vZGUsXG4gICAgICAgICAgb2Zmc2V0OiBkb20ucG9zaXRpb24obGFzdCkgKyAxXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBpc1NraXBQYWRkaW5nQmxhbmtIVE1MOiB0cnVlXG4gICAgICAgIH0pIDogbnVsbDtcblxuICAgICAgICB2YXIgbWlkZGxlTGlzdCA9IGRvbS5zcGxpdFRyZWUoaGVhZExpc3QsIHtcbiAgICAgICAgICBub2RlOiBoZWFkLnBhcmVudE5vZGUsXG4gICAgICAgICAgb2Zmc2V0OiBkb20ucG9zaXRpb24oaGVhZClcbiAgICAgICAgfSwge1xuICAgICAgICAgIGlzU2tpcFBhZGRpbmdCbGFua0hUTUw6IHRydWVcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcGFyYXMgPSBpc0VzY2Fwc2VUb0JvZHkgPyBkb20ubGlzdERlc2NlbmRhbnQobWlkZGxlTGlzdCwgZG9tLmlzTGkpIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmZyb20obWlkZGxlTGlzdC5jaGlsZE5vZGVzKS5maWx0ZXIoZG9tLmlzTGkpO1xuXG4gICAgICAgIC8vIExJIHRvIFBcbiAgICAgICAgaWYgKGlzRXNjYXBzZVRvQm9keSB8fCAhZG9tLmlzTGlzdChoZWFkTGlzdC5wYXJlbnROb2RlKSkge1xuICAgICAgICAgIHBhcmFzID0gcGFyYXMubWFwKGZ1bmN0aW9uIChwYXJhKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9tLnJlcGxhY2UocGFyYSwgJ1AnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICQuZWFjaChsaXN0LmZyb20ocGFyYXMpLnJldmVyc2UoKSwgZnVuY3Rpb24gKGlkeCwgcGFyYSkge1xuICAgICAgICAgIGRvbS5pbnNlcnRBZnRlcihwYXJhLCBoZWFkTGlzdCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHJlbW92ZSBlbXB0eSBsaXN0c1xuICAgICAgICB2YXIgcm9vdExpc3RzID0gbGlzdC5jb21wYWN0KFtoZWFkTGlzdCwgbWlkZGxlTGlzdCwgbGFzdExpc3RdKTtcbiAgICAgICAgJC5lYWNoKHJvb3RMaXN0cywgZnVuY3Rpb24gKGlkeCwgcm9vdExpc3QpIHtcbiAgICAgICAgICB2YXIgbGlzdE5vZGVzID0gW3Jvb3RMaXN0XS5jb25jYXQoZG9tLmxpc3REZXNjZW5kYW50KHJvb3RMaXN0LCBkb20uaXNMaXN0KSk7XG4gICAgICAgICAgJC5lYWNoKGxpc3ROb2Rlcy5yZXZlcnNlKCksIGZ1bmN0aW9uIChpZHgsIGxpc3ROb2RlKSB7XG4gICAgICAgICAgICBpZiAoIWRvbS5ub2RlTGVuZ3RoKGxpc3ROb2RlKSkge1xuICAgICAgICAgICAgICBkb20ucmVtb3ZlKGxpc3ROb2RlLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVsZWFzZWRQYXJhcyA9IHJlbGVhc2VkUGFyYXMuY29uY2F0KHBhcmFzKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVsZWFzZWRQYXJhcztcbiAgICB9O1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIEBjbGFzcyBlZGl0aW5nLlR5cGluZ1xuICAgKlxuICAgKiBUeXBpbmdcbiAgICpcbiAgICovXG4gIHZhciBUeXBpbmcgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyBhIEJ1bGxldCBpbnN0YW5jZSB0byB0b2dnbGUgbGlzdHMgb2ZmXG4gICAgdmFyIGJ1bGxldCA9IG5ldyBCdWxsZXQoKTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydCB0YWJcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7V3JhcHBlZFJhbmdlfSBybmdcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGFic2l6ZVxuICAgICAqL1xuICAgIHRoaXMuaW5zZXJ0VGFiID0gZnVuY3Rpb24gKHJuZywgdGFic2l6ZSkge1xuICAgICAgdmFyIHRhYiA9IGRvbS5jcmVhdGVUZXh0KG5ldyBBcnJheSh0YWJzaXplICsgMSkuam9pbihkb20uTkJTUF9DSEFSKSk7XG4gICAgICBybmcgPSBybmcuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgIHJuZy5pbnNlcnROb2RlKHRhYiwgdHJ1ZSk7XG5cbiAgICAgIHJuZyA9IHJhbmdlLmNyZWF0ZSh0YWIsIHRhYnNpemUpO1xuICAgICAgcm5nLnNlbGVjdCgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBpbnNlcnQgcGFyYWdyYXBoXG4gICAgICovXG4gICAgdGhpcy5pbnNlcnRQYXJhZ3JhcGggPSBmdW5jdGlvbiAoZWRpdGFibGUpIHtcbiAgICAgIHZhciBybmcgPSByYW5nZS5jcmVhdGUoZWRpdGFibGUpO1xuXG4gICAgICAvLyBkZWxldGVDb250ZW50cyBvbiByYW5nZS5cbiAgICAgIHJuZyA9IHJuZy5kZWxldGVDb250ZW50cygpO1xuXG4gICAgICAvLyBXcmFwIHJhbmdlIGlmIGl0IG5lZWRzIHRvIGJlIHdyYXBwZWQgYnkgcGFyYWdyYXBoXG4gICAgICBybmcgPSBybmcud3JhcEJvZHlJbmxpbmVXaXRoUGFyYSgpO1xuXG4gICAgICAvLyBmaW5kaW5nIHBhcmFncmFwaFxuICAgICAgdmFyIHNwbGl0Um9vdCA9IGRvbS5hbmNlc3Rvcihybmcuc2MsIGRvbS5pc1BhcmEpO1xuXG4gICAgICB2YXIgbmV4dFBhcmE7XG4gICAgICAvLyBvbiBwYXJhZ3JhcGg6IHNwbGl0IHBhcmFncmFwaFxuICAgICAgaWYgKHNwbGl0Um9vdCkge1xuICAgICAgICAvLyBpZiBpdCBpcyBhbiBlbXB0eSBsaW5lIHdpdGggbGlcbiAgICAgICAgaWYgKGRvbS5pc0VtcHR5KHNwbGl0Um9vdCkgJiYgZG9tLmlzTGkoc3BsaXRSb290KSkge1xuICAgICAgICAgIC8vIHRvb2dsZSBVTC9PTCBhbmQgZXNjYXBlXG4gICAgICAgICAgYnVsbGV0LnRvZ2dsZUxpc3Qoc3BsaXRSb290LnBhcmVudE5vZGUubm9kZU5hbWUpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gaWYgaXQgaXMgYW4gZW1wdHkgbGluZSB3aXRoIHBhcmEgb24gYmxvY2txdW90ZVxuICAgICAgICB9IGVsc2UgaWYgKGRvbS5pc0VtcHR5KHNwbGl0Um9vdCkgJiYgZG9tLmlzUGFyYShzcGxpdFJvb3QpICYmIGRvbS5pc0Jsb2NrcXVvdGUoc3BsaXRSb290LnBhcmVudE5vZGUpKSB7XG4gICAgICAgICAgLy8gZXNjYXBlIGJsb2NrcXVvdGVcbiAgICAgICAgICBkb20uaW5zZXJ0QWZ0ZXIoc3BsaXRSb290LCBzcGxpdFJvb3QucGFyZW50Tm9kZSk7XG4gICAgICAgICAgbmV4dFBhcmEgPSBzcGxpdFJvb3Q7XG4gICAgICAgIC8vIGlmIG5ldyBsaW5lIGhhcyBjb250ZW50IChub3QgYSBsaW5lIGJyZWFrKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5leHRQYXJhID0gZG9tLnNwbGl0VHJlZShzcGxpdFJvb3QsIHJuZy5nZXRTdGFydFBvaW50KCkpO1xuXG4gICAgICAgICAgdmFyIGVtcHR5QW5jaG9ycyA9IGRvbS5saXN0RGVzY2VuZGFudChzcGxpdFJvb3QsIGRvbS5pc0VtcHR5QW5jaG9yKTtcbiAgICAgICAgICBlbXB0eUFuY2hvcnMgPSBlbXB0eUFuY2hvcnMuY29uY2F0KGRvbS5saXN0RGVzY2VuZGFudChuZXh0UGFyYSwgZG9tLmlzRW1wdHlBbmNob3IpKTtcblxuICAgICAgICAgICQuZWFjaChlbXB0eUFuY2hvcnMsIGZ1bmN0aW9uIChpZHgsIGFuY2hvcikge1xuICAgICAgICAgICAgZG9tLnJlbW92ZShhbmNob3IpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gcmVwbGFjZSBlbXB0eSBoZWFkaW5nIG9yIHByZSB3aXRoIFAgdGFnXG4gICAgICAgICAgaWYgKChkb20uaXNIZWFkaW5nKG5leHRQYXJhKSB8fCBkb20uaXNQcmUobmV4dFBhcmEpKSAmJiBkb20uaXNFbXB0eShuZXh0UGFyYSkpIHtcbiAgICAgICAgICAgIG5leHRQYXJhID0gZG9tLnJlcGxhY2UobmV4dFBhcmEsICdwJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAvLyBubyBwYXJhZ3JhcGg6IGluc2VydCBlbXB0eSBwYXJhZ3JhcGhcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBuZXh0ID0gcm5nLnNjLmNoaWxkTm9kZXNbcm5nLnNvXTtcbiAgICAgICAgbmV4dFBhcmEgPSAkKGRvbS5lbXB0eVBhcmEpWzBdO1xuICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgIHJuZy5zYy5pbnNlcnRCZWZvcmUobmV4dFBhcmEsIG5leHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJuZy5zYy5hcHBlbmRDaGlsZChuZXh0UGFyYSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmFuZ2UuY3JlYXRlKG5leHRQYXJhLCAwKS5ub3JtYWxpemUoKS5zZWxlY3QoKS5zY3JvbGxJbnRvVmlldyhlZGl0YWJsZSk7XG4gICAgfTtcbiAgfTtcblxuICAvKipcbiAgICogQGNsYXNzIGVkaXRpbmcuVGFibGVcbiAgICpcbiAgICogVGFibGVcbiAgICpcbiAgICovXG4gIHZhciBUYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBoYW5kbGUgdGFiIGtleVxuICAgICAqXG4gICAgICogQHBhcmFtIHtXcmFwcGVkUmFuZ2V9IHJuZ1xuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNTaGlmdFxuICAgICAqL1xuICAgIHRoaXMudGFiID0gZnVuY3Rpb24gKHJuZywgaXNTaGlmdCkge1xuICAgICAgdmFyIGNlbGwgPSBkb20uYW5jZXN0b3Iocm5nLmNvbW1vbkFuY2VzdG9yKCksIGRvbS5pc0NlbGwpO1xuICAgICAgdmFyIHRhYmxlID0gZG9tLmFuY2VzdG9yKGNlbGwsIGRvbS5pc1RhYmxlKTtcbiAgICAgIHZhciBjZWxscyA9IGRvbS5saXN0RGVzY2VuZGFudCh0YWJsZSwgZG9tLmlzQ2VsbCk7XG5cbiAgICAgIHZhciBuZXh0Q2VsbCA9IGxpc3RbaXNTaGlmdCA/ICdwcmV2JyA6ICduZXh0J10oY2VsbHMsIGNlbGwpO1xuICAgICAgaWYgKG5leHRDZWxsKSB7XG4gICAgICAgIHJhbmdlLmNyZWF0ZShuZXh0Q2VsbCwgMCkuc2VsZWN0KCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGNyZWF0ZSBlbXB0eSB0YWJsZSBlbGVtZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcm93Q291bnRcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gY29sQ291bnRcbiAgICAgKiBAcmV0dXJuIHtOb2RlfVxuICAgICAqL1xuICAgIHRoaXMuY3JlYXRlVGFibGUgPSBmdW5jdGlvbiAoY29sQ291bnQsIHJvd0NvdW50LCBvcHRpb25zKSB7XG4gICAgICB2YXIgdGRzID0gW10sIHRkSFRNTDtcbiAgICAgIGZvciAodmFyIGlkeENvbCA9IDA7IGlkeENvbCA8IGNvbENvdW50OyBpZHhDb2wrKykge1xuICAgICAgICB0ZHMucHVzaCgnPHRkPicgKyBkb20uYmxhbmsgKyAnPC90ZD4nKTtcbiAgICAgIH1cbiAgICAgIHRkSFRNTCA9IHRkcy5qb2luKCcnKTtcblxuICAgICAgdmFyIHRycyA9IFtdLCB0ckhUTUw7XG4gICAgICBmb3IgKHZhciBpZHhSb3cgPSAwOyBpZHhSb3cgPCByb3dDb3VudDsgaWR4Um93KyspIHtcbiAgICAgICAgdHJzLnB1c2goJzx0cj4nICsgdGRIVE1MICsgJzwvdHI+Jyk7XG4gICAgICB9XG4gICAgICB0ckhUTUwgPSB0cnMuam9pbignJyk7XG4gICAgICB2YXIgJHRhYmxlID0gJCgnPHRhYmxlPicgKyB0ckhUTUwgKyAnPC90YWJsZT4nKTtcbiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMudGFibGVDbGFzc05hbWUpIHtcbiAgICAgICAgJHRhYmxlLmFkZENsYXNzKG9wdGlvbnMudGFibGVDbGFzc05hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gJHRhYmxlWzBdO1xuICAgIH07XG4gIH07XG5cblxuICB2YXIgS0VZX0JPR1VTID0gJ2JvZ3VzJztcblxuICAvKipcbiAgICogQGNsYXNzIEVkaXRvclxuICAgKi9cbiAgdmFyIEVkaXRvciA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyICRub3RlID0gY29udGV4dC5sYXlvdXRJbmZvLm5vdGU7XG4gICAgdmFyICRlZGl0b3IgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdG9yO1xuICAgIHZhciAkZWRpdGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGFibGU7XG4gICAgdmFyIG9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdmFyIGxhbmcgPSBvcHRpb25zLmxhbmdJbmZvO1xuXG4gICAgdmFyIGVkaXRhYmxlID0gJGVkaXRhYmxlWzBdO1xuICAgIHZhciBsYXN0UmFuZ2UgPSBudWxsO1xuXG4gICAgdmFyIHN0eWxlID0gbmV3IFN0eWxlKCk7XG4gICAgdmFyIHRhYmxlID0gbmV3IFRhYmxlKCk7XG4gICAgdmFyIHR5cGluZyA9IG5ldyBUeXBpbmcoKTtcbiAgICB2YXIgYnVsbGV0ID0gbmV3IEJ1bGxldCgpO1xuICAgIHZhciBoaXN0b3J5ID0gbmV3IEhpc3RvcnkoJGVkaXRhYmxlKTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGJpbmQgY3VzdG9tIGV2ZW50c1xuICAgICAgJGVkaXRhYmxlLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBrZXkuY29kZS5FTlRFUikge1xuICAgICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdlbnRlcicsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgna2V5ZG93bicsIGV2ZW50KTtcblxuICAgICAgICBpZiAoIWV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnMuc2hvcnRjdXRzKSB7XG4gICAgICAgICAgICBzZWxmLmhhbmRsZUtleU1hcChldmVudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNlbGYucHJldmVudERlZmF1bHRFZGl0YWJsZVNob3J0Q3V0cyhldmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KS5vbigna2V5dXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ2tleXVwJywgZXZlbnQpO1xuICAgICAgfSkub24oJ2ZvY3VzJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdmb2N1cycsIGV2ZW50KTtcbiAgICAgIH0pLm9uKCdibHVyJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdibHVyJywgZXZlbnQpO1xuICAgICAgfSkub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnbW91c2Vkb3duJywgZXZlbnQpO1xuICAgICAgfSkub24oJ21vdXNldXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ21vdXNldXAnLCBldmVudCk7XG4gICAgICB9KS5vbignc2Nyb2xsJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdzY3JvbGwnLCBldmVudCk7XG4gICAgICB9KS5vbigncGFzdGUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ3Bhc3RlJywgZXZlbnQpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGluaXQgY29udGVudCBiZWZvcmUgc2V0IGV2ZW50XG4gICAgICAkZWRpdGFibGUuaHRtbChkb20uaHRtbCgkbm90ZSkgfHwgZG9tLmVtcHR5UGFyYSk7XG5cbiAgICAgIC8vIFt3b3JrYXJvdW5kXSBJRSBkb2Vzbid0IGhhdmUgaW5wdXQgZXZlbnRzIGZvciBjb250ZW50RWRpdGFibGVcbiAgICAgIC8vIC0gc2VlOiBodHRwczovL2dvby5nbC80YmZJdkFcbiAgICAgIHZhciBjaGFuZ2VFdmVudE5hbWUgPSBhZ2VudC5pc01TSUUgPyAnRE9NQ2hhcmFjdGVyRGF0YU1vZGlmaWVkIERPTVN1YnRyZWVNb2RpZmllZCBET01Ob2RlSW5zZXJ0ZWQnIDogJ2lucHV0JztcbiAgICAgICRlZGl0YWJsZS5vbihjaGFuZ2VFdmVudE5hbWUsIGZ1bmMuZGVib3VuY2UoZnVuY3Rpb24gKCkge1xuICAgICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnY2hhbmdlJywgJGVkaXRhYmxlLmh0bWwoKSk7XG4gICAgICB9LCAyNTApKTtcblxuICAgICAgJGVkaXRvci5vbignZm9jdXNpbicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnZm9jdXNpbicsIGV2ZW50KTtcbiAgICAgIH0pLm9uKCdmb2N1c291dCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnZm9jdXNvdXQnLCBldmVudCk7XG4gICAgICB9KTtcblxuICAgICAgaWYgKCFvcHRpb25zLmFpck1vZGUpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMud2lkdGgpIHtcbiAgICAgICAgICAkZWRpdG9yLm91dGVyV2lkdGgob3B0aW9ucy53aWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuaGVpZ2h0KSB7XG4gICAgICAgICAgJGVkaXRhYmxlLm91dGVySGVpZ2h0KG9wdGlvbnMuaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5tYXhIZWlnaHQpIHtcbiAgICAgICAgICAkZWRpdGFibGUuY3NzKCdtYXgtaGVpZ2h0Jywgb3B0aW9ucy5tYXhIZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLm1pbkhlaWdodCkge1xuICAgICAgICAgICRlZGl0YWJsZS5jc3MoJ21pbi1oZWlnaHQnLCBvcHRpb25zLm1pbkhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaGlzdG9yeS5yZWNvcmRVbmRvKCk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICRlZGl0YWJsZS5vZmYoKTtcbiAgICB9O1xuXG4gICAgdGhpcy5oYW5kbGVLZXlNYXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHZhciBrZXlNYXAgPSBvcHRpb25zLmtleU1hcFthZ2VudC5pc01hYyA/ICdtYWMnIDogJ3BjJ107XG4gICAgICB2YXIga2V5cyA9IFtdO1xuXG4gICAgICBpZiAoZXZlbnQubWV0YUtleSkgeyBrZXlzLnB1c2goJ0NNRCcpOyB9XG4gICAgICBpZiAoZXZlbnQuY3RybEtleSAmJiAhZXZlbnQuYWx0S2V5KSB7IGtleXMucHVzaCgnQ1RSTCcpOyB9XG4gICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHsga2V5cy5wdXNoKCdTSElGVCcpOyB9XG5cbiAgICAgIHZhciBrZXlOYW1lID0ga2V5Lm5hbWVGcm9tQ29kZVtldmVudC5rZXlDb2RlXTtcbiAgICAgIGlmIChrZXlOYW1lKSB7XG4gICAgICAgIGtleXMucHVzaChrZXlOYW1lKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGV2ZW50TmFtZSA9IGtleU1hcFtrZXlzLmpvaW4oJysnKV07XG4gICAgICBpZiAoZXZlbnROYW1lKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKGV2ZW50TmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKGtleS5pc0VkaXQoZXZlbnQua2V5Q29kZSkpIHtcbiAgICAgICAgdGhpcy5hZnRlckNvbW1hbmQoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5wcmV2ZW50RGVmYXVsdEVkaXRhYmxlU2hvcnRDdXRzID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAvLyBCKEJvbGQsIDY2KSAvIEkoSXRhbGljLCA3MykgLyBVKFVuZGVybGluZSwgODUpXG4gICAgICBpZiAoKGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSkgJiZcbiAgICAgICAgbGlzdC5jb250YWlucyhbNjYsIDczLCA4NV0sIGV2ZW50LmtleUNvZGUpKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGNyZWF0ZSByYW5nZVxuICAgICAqIEByZXR1cm4ge1dyYXBwZWRSYW5nZX1cbiAgICAgKi9cbiAgICB0aGlzLmNyZWF0ZVJhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgcmV0dXJuIHJhbmdlLmNyZWF0ZShlZGl0YWJsZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHNhdmVSYW5nZVxuICAgICAqXG4gICAgICogc2F2ZSBjdXJyZW50IHJhbmdlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt0aGVuQ29sbGFwc2U9ZmFsc2VdXG4gICAgICovXG4gICAgdGhpcy5zYXZlUmFuZ2UgPSBmdW5jdGlvbiAodGhlbkNvbGxhcHNlKSB7XG4gICAgICBsYXN0UmFuZ2UgPSB0aGlzLmNyZWF0ZVJhbmdlKCk7XG4gICAgICBpZiAodGhlbkNvbGxhcHNlKSB7XG4gICAgICAgIGxhc3RSYW5nZS5jb2xsYXBzZSgpLnNlbGVjdCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiByZXN0b3JlUmFuZ2VcbiAgICAgKlxuICAgICAqIHJlc3RvcmUgbGF0ZWx5IHJhbmdlXG4gICAgICovXG4gICAgdGhpcy5yZXN0b3JlUmFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAobGFzdFJhbmdlKSB7XG4gICAgICAgIGxhc3RSYW5nZS5zZWxlY3QoKTtcbiAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUYXJnZXQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgJGVkaXRhYmxlLmRhdGEoJ3RhcmdldCcsIG5vZGUpO1xuICAgIH07XG5cbiAgICB0aGlzLmNsZWFyVGFyZ2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgJGVkaXRhYmxlLnJlbW92ZURhdGEoJ3RhcmdldCcpO1xuICAgIH07XG5cbiAgICB0aGlzLnJlc3RvcmVUYXJnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJGVkaXRhYmxlLmRhdGEoJ3RhcmdldCcpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBjdXJyZW50U3R5bGVcbiAgICAgKlxuICAgICAqIGN1cnJlbnQgc3R5bGVcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R8Qm9vbGVhbn0gdW5mb2N1c1xuICAgICAqL1xuICAgIHRoaXMuY3VycmVudFN0eWxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJuZyA9IHJhbmdlLmNyZWF0ZSgpO1xuICAgICAgaWYgKHJuZykge1xuICAgICAgICBybmcgPSBybmcubm9ybWFsaXplKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcm5nID8gc3R5bGUuY3VycmVudChybmcpIDogc3R5bGUuZnJvbU5vZGUoJGVkaXRhYmxlKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogc3R5bGUgZnJvbSBub2RlXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2pRdWVyeX0gJG5vZGVcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAgICovXG4gICAgdGhpcy5zdHlsZUZyb21Ob2RlID0gZnVuY3Rpb24gKCRub2RlKSB7XG4gICAgICByZXR1cm4gc3R5bGUuZnJvbU5vZGUoJG5vZGUpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiB1bmRvXG4gICAgICovXG4gICAgdGhpcy51bmRvID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ2JlZm9yZS5jb21tYW5kJywgJGVkaXRhYmxlLmh0bWwoKSk7XG4gICAgICBoaXN0b3J5LnVuZG8oKTtcbiAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdjaGFuZ2UnLCAkZWRpdGFibGUuaHRtbCgpKTtcbiAgICB9O1xuICAgIGNvbnRleHQubWVtbygnaGVscC51bmRvJywgbGFuZy5oZWxwLnVuZG8pO1xuXG4gICAgLyoqXG4gICAgICogcmVkb1xuICAgICAqL1xuICAgIHRoaXMucmVkbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdiZWZvcmUuY29tbWFuZCcsICRlZGl0YWJsZS5odG1sKCkpO1xuICAgICAgaGlzdG9yeS5yZWRvKCk7XG4gICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnY2hhbmdlJywgJGVkaXRhYmxlLmh0bWwoKSk7XG4gICAgfTtcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAucmVkbycsIGxhbmcuaGVscC5yZWRvKTtcblxuICAgIC8qKlxuICAgICAqIGJlZm9yZSBjb21tYW5kXG4gICAgICovXG4gICAgdmFyIGJlZm9yZUNvbW1hbmQgPSB0aGlzLmJlZm9yZUNvbW1hbmQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnYmVmb3JlLmNvbW1hbmQnLCAkZWRpdGFibGUuaHRtbCgpKTtcbiAgICAgIC8vIGtlZXAgZm9jdXMgb24gZWRpdGFibGUgYmVmb3JlIGNvbW1hbmQgZXhlY3V0aW9uXG4gICAgICBzZWxmLmZvY3VzKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGFmdGVyIGNvbW1hbmRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IGlzUHJldmVudFRyaWdnZXJcbiAgICAgKi9cbiAgICB2YXIgYWZ0ZXJDb21tYW5kID0gdGhpcy5hZnRlckNvbW1hbmQgPSBmdW5jdGlvbiAoaXNQcmV2ZW50VHJpZ2dlcikge1xuICAgICAgaGlzdG9yeS5yZWNvcmRVbmRvKCk7XG4gICAgICBpZiAoIWlzUHJldmVudFRyaWdnZXIpIHtcbiAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ2NoYW5nZScsICRlZGl0YWJsZS5odG1sKCkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovXG4gICAgLy8gbmF0aXZlIGNvbW1hbmRzKHdpdGggZXhlY0NvbW1hbmQpLCBnZW5lcmF0ZSBmdW5jdGlvbiBmb3IgZXhlY0NvbW1hbmRcbiAgICB2YXIgY29tbWFuZHMgPSBbJ2JvbGQnLCAnaXRhbGljJywgJ3VuZGVybGluZScsICdzdHJpa2V0aHJvdWdoJywgJ3N1cGVyc2NyaXB0JywgJ3N1YnNjcmlwdCcsXG4gICAgICAgICAgICAgICAgICAgICdqdXN0aWZ5TGVmdCcsICdqdXN0aWZ5Q2VudGVyJywgJ2p1c3RpZnlSaWdodCcsICdqdXN0aWZ5RnVsbCcsXG4gICAgICAgICAgICAgICAgICAgICdmb3JtYXRCbG9jaycsICdyZW1vdmVGb3JtYXQnLFxuICAgICAgICAgICAgICAgICAgICAnYmFja0NvbG9yJywgJ2ZvcmVDb2xvcicsICdmb250TmFtZSddO1xuXG4gICAgZm9yICh2YXIgaWR4ID0gMCwgbGVuID0gY29tbWFuZHMubGVuZ3RoOyBpZHggPCBsZW47IGlkeCArKykge1xuICAgICAgdGhpc1tjb21tYW5kc1tpZHhdXSA9IChmdW5jdGlvbiAoc0NtZCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgYmVmb3JlQ29tbWFuZCgpO1xuICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKHNDbWQsIGZhbHNlLCB2YWx1ZSk7XG4gICAgICAgICAgYWZ0ZXJDb21tYW5kKHRydWUpO1xuICAgICAgICB9O1xuICAgICAgfSkoY29tbWFuZHNbaWR4XSk7XG4gICAgICBjb250ZXh0Lm1lbW8oJ2hlbHAuJyArIGNvbW1hbmRzW2lkeF0sIGxhbmcuaGVscFtjb21tYW5kc1tpZHhdXSk7XG4gICAgfVxuICAgIC8qIGpzaGludCBpZ25vcmU6ZW5kICovXG5cbiAgICAvKipcbiAgICAgKiBoYW5kbGUgdGFiIGtleVxuICAgICAqL1xuICAgIHRoaXMudGFiID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJuZyA9IHRoaXMuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIGlmIChybmcuaXNDb2xsYXBzZWQoKSAmJiBybmcuaXNPbkNlbGwoKSkge1xuICAgICAgICB0YWJsZS50YWIocm5nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJlZm9yZUNvbW1hbmQoKTtcbiAgICAgICAgdHlwaW5nLmluc2VydFRhYihybmcsIG9wdGlvbnMudGFiU2l6ZSk7XG4gICAgICAgIGFmdGVyQ29tbWFuZCgpO1xuICAgICAgfVxuICAgIH07XG4gICAgY29udGV4dC5tZW1vKCdoZWxwLnRhYicsIGxhbmcuaGVscC50YWIpO1xuXG4gICAgLyoqXG4gICAgICogaGFuZGxlIHNoaWZ0K3RhYiBrZXlcbiAgICAgKi9cbiAgICB0aGlzLnVudGFiID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJuZyA9IHRoaXMuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIGlmIChybmcuaXNDb2xsYXBzZWQoKSAmJiBybmcuaXNPbkNlbGwoKSkge1xuICAgICAgICB0YWJsZS50YWIocm5nLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnRleHQubWVtbygnaGVscC51bnRhYicsIGxhbmcuaGVscC51bnRhYik7XG5cbiAgICAvKipcbiAgICAgKiBydW4gZ2l2ZW4gZnVuY3Rpb24gYmV0d2VlbiBiZWZvcmVDb21tYW5kIGFuZCBhZnRlckNvbW1hbmRcbiAgICAgKi9cbiAgICB0aGlzLndyYXBDb21tYW5kID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBiZWZvcmVDb21tYW5kKCk7XG4gICAgICAgIGZuLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7XG4gICAgICAgIGFmdGVyQ29tbWFuZCgpO1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogaW5zZXJ0IHBhcmFncmFwaFxuICAgICAqL1xuICAgIHRoaXMuaW5zZXJ0UGFyYWdyYXBoID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoKSB7XG4gICAgICB0eXBpbmcuaW5zZXJ0UGFyYWdyYXBoKGVkaXRhYmxlKTtcbiAgICB9KTtcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAuaW5zZXJ0UGFyYWdyYXBoJywgbGFuZy5oZWxwLmluc2VydFBhcmFncmFwaCk7XG5cbiAgICB0aGlzLmluc2VydE9yZGVyZWRMaXN0ID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoKSB7XG4gICAgICBidWxsZXQuaW5zZXJ0T3JkZXJlZExpc3QoZWRpdGFibGUpO1xuICAgIH0pO1xuICAgIGNvbnRleHQubWVtbygnaGVscC5pbnNlcnRPcmRlcmVkTGlzdCcsIGxhbmcuaGVscC5pbnNlcnRPcmRlcmVkTGlzdCk7XG5cbiAgICB0aGlzLmluc2VydFVub3JkZXJlZExpc3QgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIGJ1bGxldC5pbnNlcnRVbm9yZGVyZWRMaXN0KGVkaXRhYmxlKTtcbiAgICB9KTtcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAuaW5zZXJ0VW5vcmRlcmVkTGlzdCcsIGxhbmcuaGVscC5pbnNlcnRVbm9yZGVyZWRMaXN0KTtcblxuICAgIHRoaXMuaW5kZW50ID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoKSB7XG4gICAgICBidWxsZXQuaW5kZW50KGVkaXRhYmxlKTtcbiAgICB9KTtcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAuaW5kZW50JywgbGFuZy5oZWxwLmluZGVudCk7XG5cbiAgICB0aGlzLm91dGRlbnQgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICgpIHtcbiAgICAgIGJ1bGxldC5vdXRkZW50KGVkaXRhYmxlKTtcbiAgICB9KTtcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAub3V0ZGVudCcsIGxhbmcuaGVscC5vdXRkZW50KTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydCBpbWFnZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHNyY1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfEZ1bmN0aW9ufSBwYXJhbVxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9XG4gICAgICovXG4gICAgdGhpcy5pbnNlcnRJbWFnZSA9IGZ1bmN0aW9uIChzcmMsIHBhcmFtKSB7XG4gICAgICByZXR1cm4gYXN5bmMuY3JlYXRlSW1hZ2Uoc3JjLCBwYXJhbSkudGhlbihmdW5jdGlvbiAoJGltYWdlKSB7XG4gICAgICAgIGJlZm9yZUNvbW1hbmQoKTtcblxuICAgICAgICBpZiAodHlwZW9mIHBhcmFtID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgcGFyYW0oJGltYWdlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHBhcmFtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgJGltYWdlLmF0dHIoJ2RhdGEtZmlsZW5hbWUnLCBwYXJhbSk7XG4gICAgICAgICAgfVxuICAgICAgICAgICRpbWFnZS5jc3MoJ3dpZHRoJywgTWF0aC5taW4oJGVkaXRhYmxlLndpZHRoKCksICRpbWFnZS53aWR0aCgpKSk7XG4gICAgICAgIH1cblxuICAgICAgICAkaW1hZ2Uuc2hvdygpO1xuICAgICAgICByYW5nZS5jcmVhdGUoZWRpdGFibGUpLmluc2VydE5vZGUoJGltYWdlWzBdKTtcbiAgICAgICAgcmFuZ2UuY3JlYXRlRnJvbU5vZGVBZnRlcigkaW1hZ2VbMF0pLnNlbGVjdCgpO1xuICAgICAgICBhZnRlckNvbW1hbmQoKTtcbiAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ2ltYWdlLnVwbG9hZC5lcnJvcicsIGUpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydEltYWdlc1xuICAgICAqIEBwYXJhbSB7RmlsZVtdfSBmaWxlc1xuICAgICAqL1xuICAgIHRoaXMuaW5zZXJ0SW1hZ2VzID0gZnVuY3Rpb24gKGZpbGVzKSB7XG4gICAgICAkLmVhY2goZmlsZXMsIGZ1bmN0aW9uIChpZHgsIGZpbGUpIHtcbiAgICAgICAgdmFyIGZpbGVuYW1lID0gZmlsZS5uYW1lO1xuICAgICAgICBpZiAob3B0aW9ucy5tYXhpbXVtSW1hZ2VGaWxlU2l6ZSAmJiBvcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplIDwgZmlsZS5zaXplKSB7XG4gICAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ2ltYWdlLnVwbG9hZC5lcnJvcicsIGxhbmcuaW1hZ2UubWF4aW11bUZpbGVTaXplRXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFzeW5jLnJlYWRGaWxlQXNEYXRhVVJMKGZpbGUpLnRoZW4oZnVuY3Rpb24gKGRhdGFVUkwpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmluc2VydEltYWdlKGRhdGFVUkwsIGZpbGVuYW1lKTtcbiAgICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdpbWFnZS51cGxvYWQuZXJyb3InKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydEltYWdlc09yQ2FsbGJhY2tcbiAgICAgKiBAcGFyYW0ge0ZpbGVbXX0gZmlsZXNcbiAgICAgKi9cbiAgICB0aGlzLmluc2VydEltYWdlc09yQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZmlsZXMpIHtcbiAgICAgIHZhciBjYWxsYmFja3MgPSBvcHRpb25zLmNhbGxiYWNrcztcblxuICAgICAgLy8gSWYgb25JbWFnZVVwbG9hZCBvcHRpb25zIHNldHRlZFxuICAgICAgaWYgKGNhbGxiYWNrcy5vbkltYWdlVXBsb2FkKSB7XG4gICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdpbWFnZS51cGxvYWQnLCBmaWxlcyk7XG4gICAgICAvLyBlbHNlIGluc2VydCBJbWFnZSBhcyBkYXRhVVJMXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmluc2VydEltYWdlcyhmaWxlcyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydE5vZGVcbiAgICAgKiBpbnNlcnQgbm9kZVxuICAgICAqIEBwYXJhbSB7Tm9kZX0gbm9kZVxuICAgICAqL1xuICAgIHRoaXMuaW5zZXJ0Tm9kZSA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgIHZhciBybmcgPSB0aGlzLmNyZWF0ZVJhbmdlKCk7XG4gICAgICBybmcuaW5zZXJ0Tm9kZShub2RlKTtcbiAgICAgIHJhbmdlLmNyZWF0ZUZyb21Ob2RlQWZ0ZXIobm9kZSkuc2VsZWN0KCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBpbnNlcnQgdGV4dFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0XG4gICAgICovXG4gICAgdGhpcy5pbnNlcnRUZXh0ID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAodGV4dCkge1xuICAgICAgdmFyIHJuZyA9IHRoaXMuY3JlYXRlUmFuZ2UoKTtcbiAgICAgIHZhciB0ZXh0Tm9kZSA9IHJuZy5pbnNlcnROb2RlKGRvbS5jcmVhdGVUZXh0KHRleHQpKTtcbiAgICAgIHJhbmdlLmNyZWF0ZSh0ZXh0Tm9kZSwgZG9tLm5vZGVMZW5ndGgodGV4dE5vZGUpKS5zZWxlY3QoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybiBzZWxlY3RlZCBwbGFpbiB0ZXh0XG4gICAgICogQHJldHVybiB7U3RyaW5nfSB0ZXh0XG4gICAgICovXG4gICAgdGhpcy5nZXRTZWxlY3RlZFRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5jcmVhdGVSYW5nZSgpO1xuXG4gICAgICAvLyBpZiByYW5nZSBvbiBhbmNob3IsIGV4cGFuZCByYW5nZSB3aXRoIGFuY2hvclxuICAgICAgaWYgKHJuZy5pc09uQW5jaG9yKCkpIHtcbiAgICAgICAgcm5nID0gcmFuZ2UuY3JlYXRlRnJvbU5vZGUoZG9tLmFuY2VzdG9yKHJuZy5zYywgZG9tLmlzQW5jaG9yKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBybmcudG9TdHJpbmcoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcGFzdGUgSFRNTFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtYXJrdXBcbiAgICAgKi9cbiAgICB0aGlzLnBhc3RlSFRNTCA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKG1hcmt1cCkge1xuICAgICAgdmFyIGNvbnRlbnRzID0gdGhpcy5jcmVhdGVSYW5nZSgpLnBhc3RlSFRNTChtYXJrdXApO1xuICAgICAgcmFuZ2UuY3JlYXRlRnJvbU5vZGVBZnRlcihsaXN0Lmxhc3QoY29udGVudHMpKS5zZWxlY3QoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIGZvcm1hdEJsb2NrXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGFnTmFtZVxuICAgICAqL1xuICAgIHRoaXMuZm9ybWF0QmxvY2sgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICh0YWdOYW1lKSB7XG4gICAgICAvLyBbd29ya2Fyb3VuZF0gZm9yIE1TSUUsIElFIG5lZWQgYDxgXG4gICAgICB0YWdOYW1lID0gYWdlbnQuaXNNU0lFID8gJzwnICsgdGFnTmFtZSArICc+JyA6IHRhZ05hbWU7XG4gICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnRm9ybWF0QmxvY2snLCBmYWxzZSwgdGFnTmFtZSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmZvcm1hdFBhcmEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmZvcm1hdEJsb2NrKCdQJyk7XG4gICAgfTtcbiAgICBjb250ZXh0Lm1lbW8oJ2hlbHAuZm9ybWF0UGFyYScsIGxhbmcuaGVscC5mb3JtYXRQYXJhKTtcblxuICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbiAgICBmb3IgKHZhciBpZHggPSAxOyBpZHggPD0gNjsgaWR4ICsrKSB7XG4gICAgICB0aGlzWydmb3JtYXRIJyArIGlkeF0gPSBmdW5jdGlvbiAoaWR4KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdGhpcy5mb3JtYXRCbG9jaygnSCcgKyBpZHgpO1xuICAgICAgICB9O1xuICAgICAgfShpZHgpO1xuICAgICAgY29udGV4dC5tZW1vKCdoZWxwLmZvcm1hdEgnK2lkeCwgbGFuZy5oZWxwWydmb3JtYXRIJyArIGlkeF0pO1xuICAgIH07XG4gICAgLyoganNoaW50IGlnbm9yZTplbmQgKi9cblxuICAgIC8qKlxuICAgICAqIGZvbnRTaXplXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgLSBweFxuICAgICAqL1xuICAgIHRoaXMuZm9udFNpemUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhciBybmcgPSB0aGlzLmNyZWF0ZVJhbmdlKCk7XG5cbiAgICAgIGlmIChybmcgJiYgcm5nLmlzQ29sbGFwc2VkKCkpIHtcbiAgICAgICAgdmFyIHNwYW5zID0gc3R5bGUuc3R5bGVOb2RlcyhybmcpO1xuICAgICAgICB2YXIgZmlyc3RTcGFuID0gbGlzdC5oZWFkKHNwYW5zKTtcblxuICAgICAgICAkKHNwYW5zKS5jc3Moe1xuICAgICAgICAgICdmb250LXNpemUnOiB2YWx1ZSArICdweCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gW3dvcmthcm91bmRdIGFkZGVkIHN0eWxlZCBib2d1cyBzcGFuIGZvciBzdHlsZVxuICAgICAgICAvLyAgLSBhbHNvIGJvZ3VzIGNoYXJhY3RlciBuZWVkZWQgZm9yIGN1cnNvciBwb3NpdGlvblxuICAgICAgICBpZiAoZmlyc3RTcGFuICYmICFkb20ubm9kZUxlbmd0aChmaXJzdFNwYW4pKSB7XG4gICAgICAgICAgZmlyc3RTcGFuLmlubmVySFRNTCA9IGRvbS5aRVJPX1dJRFRIX05CU1BfQ0hBUjtcbiAgICAgICAgICByYW5nZS5jcmVhdGVGcm9tTm9kZUFmdGVyKGZpcnN0U3Bhbi5maXJzdENoaWxkKS5zZWxlY3QoKTtcbiAgICAgICAgICAkZWRpdGFibGUuZGF0YShLRVlfQk9HVVMsIGZpcnN0U3Bhbik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJlZm9yZUNvbW1hbmQoKTtcbiAgICAgICAgJChzdHlsZS5zdHlsZU5vZGVzKHJuZykpLmNzcyh7XG4gICAgICAgICAgJ2ZvbnQtc2l6ZSc6IHZhbHVlICsgJ3B4J1xuICAgICAgICB9KTtcbiAgICAgICAgYWZ0ZXJDb21tYW5kKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGluc2VydCBob3Jpem9udGFsIHJ1bGVcbiAgICAgKi9cbiAgICB0aGlzLmluc2VydEhvcml6b250YWxSdWxlID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaHJOb2RlID0gdGhpcy5jcmVhdGVSYW5nZSgpLmluc2VydE5vZGUoZG9tLmNyZWF0ZSgnSFInKSk7XG4gICAgICBpZiAoaHJOb2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgIHJhbmdlLmNyZWF0ZShock5vZGUubmV4dFNpYmxpbmcsIDApLm5vcm1hbGl6ZSgpLnNlbGVjdCgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNvbnRleHQubWVtbygnaGVscC5pbnNlcnRIb3Jpem9udGFsUnVsZScsIGxhbmcuaGVscC5pbnNlcnRIb3Jpem9udGFsUnVsZSk7XG5cbiAgICAvKipcbiAgICAgKiByZW1vdmUgYm9ndXMgbm9kZSBhbmQgY2hhcmFjdGVyXG4gICAgICovXG4gICAgdGhpcy5yZW1vdmVCb2d1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBib2d1c05vZGUgPSAkZWRpdGFibGUuZGF0YShLRVlfQk9HVVMpO1xuICAgICAgaWYgKCFib2d1c05vZGUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgdGV4dE5vZGUgPSBsaXN0LmZpbmQobGlzdC5mcm9tKGJvZ3VzTm9kZS5jaGlsZE5vZGVzKSwgZG9tLmlzVGV4dCk7XG5cbiAgICAgIHZhciBib2d1c0NoYXJJZHggPSB0ZXh0Tm9kZS5ub2RlVmFsdWUuaW5kZXhPZihkb20uWkVST19XSURUSF9OQlNQX0NIQVIpO1xuICAgICAgaWYgKGJvZ3VzQ2hhcklkeCAhPT0gLTEpIHtcbiAgICAgICAgdGV4dE5vZGUuZGVsZXRlRGF0YShib2d1c0NoYXJJZHgsIDEpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZG9tLmlzRW1wdHkoYm9ndXNOb2RlKSkge1xuICAgICAgICBkb20ucmVtb3ZlKGJvZ3VzTm9kZSk7XG4gICAgICB9XG5cbiAgICAgICRlZGl0YWJsZS5yZW1vdmVEYXRhKEtFWV9CT0dVUyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGxpbmVIZWlnaHRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcbiAgICAgKi9cbiAgICB0aGlzLmxpbmVIZWlnaHQgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgc3R5bGUuc3R5bGVQYXJhKHRoaXMuY3JlYXRlUmFuZ2UoKSwge1xuICAgICAgICBsaW5lSGVpZ2h0OiB2YWx1ZVxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiB1bmxpbmtcbiAgICAgKlxuICAgICAqIEB0eXBlIGNvbW1hbmRcbiAgICAgKi9cbiAgICB0aGlzLnVubGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBybmcgPSB0aGlzLmNyZWF0ZVJhbmdlKCk7XG4gICAgICBpZiAocm5nLmlzT25BbmNob3IoKSkge1xuICAgICAgICB2YXIgYW5jaG9yID0gZG9tLmFuY2VzdG9yKHJuZy5zYywgZG9tLmlzQW5jaG9yKTtcbiAgICAgICAgcm5nID0gcmFuZ2UuY3JlYXRlRnJvbU5vZGUoYW5jaG9yKTtcbiAgICAgICAgcm5nLnNlbGVjdCgpO1xuXG4gICAgICAgIGJlZm9yZUNvbW1hbmQoKTtcbiAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ3VubGluaycpO1xuICAgICAgICBhZnRlckNvbW1hbmQoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogY3JlYXRlIGxpbmsgKGNvbW1hbmQpXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGlua0luZm9cbiAgICAgKi9cbiAgICB0aGlzLmNyZWF0ZUxpbmsgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uIChsaW5rSW5mbykge1xuICAgICAgdmFyIGxpbmtVcmwgPSBsaW5rSW5mby51cmw7XG4gICAgICB2YXIgbGlua1RleHQgPSBsaW5rSW5mby50ZXh0O1xuICAgICAgdmFyIGlzTmV3V2luZG93ID0gbGlua0luZm8uaXNOZXdXaW5kb3c7XG4gICAgICB2YXIgcm5nID0gbGlua0luZm8ucmFuZ2UgfHwgdGhpcy5jcmVhdGVSYW5nZSgpO1xuICAgICAgdmFyIGlzVGV4dENoYW5nZWQgPSBybmcudG9TdHJpbmcoKSAhPT0gbGlua1RleHQ7XG5cbiAgICAgIC8vIGhhbmRsZSBzcGFjZWQgdXJscyBmcm9tIGlucHV0XG4gICAgICBpZiAodHlwZW9mIGxpbmtVcmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGxpbmtVcmwgPSBsaW5rVXJsLnRyaW0oKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMub25DcmVhdGVMaW5rKSB7XG4gICAgICAgIGxpbmtVcmwgPSBvcHRpb25zLm9uQ3JlYXRlTGluayhsaW5rVXJsKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGFuY2hvcnMgPSBbXTtcbiAgICAgIGlmIChpc1RleHRDaGFuZ2VkKSB7XG4gICAgICAgIHJuZyA9IHJuZy5kZWxldGVDb250ZW50cygpO1xuICAgICAgICB2YXIgYW5jaG9yID0gcm5nLmluc2VydE5vZGUoJCgnPEE+JyArIGxpbmtUZXh0ICsgJzwvQT4nKVswXSk7XG4gICAgICAgIGFuY2hvcnMucHVzaChhbmNob3IpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYW5jaG9ycyA9IHN0eWxlLnN0eWxlTm9kZXMocm5nLCB7XG4gICAgICAgICAgbm9kZU5hbWU6ICdBJyxcbiAgICAgICAgICBleHBhbmRDbG9zZXN0U2libGluZzogdHJ1ZSxcbiAgICAgICAgICBvbmx5UGFydGlhbENvbnRhaW5zOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAkLmVhY2goYW5jaG9ycywgZnVuY3Rpb24gKGlkeCwgYW5jaG9yKSB7XG4gICAgICAgIC8vIGlmIHVybCBkb2Vzbid0IG1hdGNoIGFuIFVSTCBzY2hlbWEsIHNldCBodHRwOi8vIGFzIGRlZmF1bHRcbiAgICAgICAgbGlua1VybCA9IC9eW0EtWmEtel1bQS1aYS16MC05Ky0uXSpcXDpbXFwvXFwvXT8vLnRlc3QobGlua1VybCkgP1xuICAgICAgICAgIGxpbmtVcmwgOiAnaHR0cDovLycgKyBsaW5rVXJsO1xuXG4gICAgICAgICQoYW5jaG9yKS5hdHRyKCdocmVmJywgbGlua1VybCk7XG4gICAgICAgIGlmIChpc05ld1dpbmRvdykge1xuICAgICAgICAgICQoYW5jaG9yKS5hdHRyKCd0YXJnZXQnLCAnX2JsYW5rJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJChhbmNob3IpLnJlbW92ZUF0dHIoJ3RhcmdldCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdmFyIHN0YXJ0UmFuZ2UgPSByYW5nZS5jcmVhdGVGcm9tTm9kZUJlZm9yZShsaXN0LmhlYWQoYW5jaG9ycykpO1xuICAgICAgdmFyIHN0YXJ0UG9pbnQgPSBzdGFydFJhbmdlLmdldFN0YXJ0UG9pbnQoKTtcbiAgICAgIHZhciBlbmRSYW5nZSA9IHJhbmdlLmNyZWF0ZUZyb21Ob2RlQWZ0ZXIobGlzdC5sYXN0KGFuY2hvcnMpKTtcbiAgICAgIHZhciBlbmRQb2ludCA9IGVuZFJhbmdlLmdldEVuZFBvaW50KCk7XG5cbiAgICAgIHJhbmdlLmNyZWF0ZShcbiAgICAgICAgc3RhcnRQb2ludC5ub2RlLFxuICAgICAgICBzdGFydFBvaW50Lm9mZnNldCxcbiAgICAgICAgZW5kUG9pbnQubm9kZSxcbiAgICAgICAgZW5kUG9pbnQub2Zmc2V0XG4gICAgICApLnNlbGVjdCgpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyBsaW5rIGluZm9cbiAgICAgKlxuICAgICAqIEByZXR1cm4ge09iamVjdH1cbiAgICAgKiBAcmV0dXJuIHtXcmFwcGVkUmFuZ2V9IHJldHVybi5yYW5nZVxuICAgICAqIEByZXR1cm4ge1N0cmluZ30gcmV0dXJuLnRleHRcbiAgICAgKiBAcmV0dXJuIHtCb29sZWFufSBbcmV0dXJuLmlzTmV3V2luZG93PXRydWVdXG4gICAgICogQHJldHVybiB7U3RyaW5nfSBbcmV0dXJuLnVybD1cIlwiXVxuICAgICAqL1xuICAgIHRoaXMuZ2V0TGlua0luZm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgcm5nID0gdGhpcy5jcmVhdGVSYW5nZSgpLmV4cGFuZChkb20uaXNBbmNob3IpO1xuXG4gICAgICAvLyBHZXQgdGhlIGZpcnN0IGFuY2hvciBvbiByYW5nZShmb3IgZWRpdCkuXG4gICAgICB2YXIgJGFuY2hvciA9ICQobGlzdC5oZWFkKHJuZy5ub2Rlcyhkb20uaXNBbmNob3IpKSk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJhbmdlOiBybmcsXG4gICAgICAgIHRleHQ6IHJuZy50b1N0cmluZygpLFxuICAgICAgICBpc05ld1dpbmRvdzogJGFuY2hvci5sZW5ndGggPyAkYW5jaG9yLmF0dHIoJ3RhcmdldCcpID09PSAnX2JsYW5rJyA6IGZhbHNlLFxuICAgICAgICB1cmw6ICRhbmNob3IubGVuZ3RoID8gJGFuY2hvci5hdHRyKCdocmVmJykgOiAnJ1xuICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogc2V0dGluZyBjb2xvclxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNPYmpDb2xvciAgY29sb3IgY29kZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzT2JqQ29sb3IuZm9yZUNvbG9yIGZvcmVncm91bmQgY29sb3JcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc09iakNvbG9yLmJhY2tDb2xvciBiYWNrZ3JvdW5kIGNvbG9yXG4gICAgICovXG4gICAgdGhpcy5jb2xvciA9IHRoaXMud3JhcENvbW1hbmQoZnVuY3Rpb24gKGNvbG9ySW5mbykge1xuICAgICAgdmFyIGZvcmVDb2xvciA9IGNvbG9ySW5mby5mb3JlQ29sb3I7XG4gICAgICB2YXIgYmFja0NvbG9yID0gY29sb3JJbmZvLmJhY2tDb2xvcjtcblxuICAgICAgaWYgKGZvcmVDb2xvcikgeyBkb2N1bWVudC5leGVjQ29tbWFuZCgnZm9yZUNvbG9yJywgZmFsc2UsIGZvcmVDb2xvcik7IH1cbiAgICAgIGlmIChiYWNrQ29sb3IpIHsgZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2JhY2tDb2xvcicsIGZhbHNlLCBiYWNrQ29sb3IpOyB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBpbnNlcnQgVGFibGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkaW1lbnNpb24gb2YgdGFibGUgKGV4IDogXCI1eDVcIilcbiAgICAgKi9cbiAgICB0aGlzLmluc2VydFRhYmxlID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoZGltKSB7XG4gICAgICB2YXIgZGltZW5zaW9uID0gZGltLnNwbGl0KCd4Jyk7XG5cbiAgICAgIHZhciBybmcgPSB0aGlzLmNyZWF0ZVJhbmdlKCkuZGVsZXRlQ29udGVudHMoKTtcbiAgICAgIHJuZy5pbnNlcnROb2RlKHRhYmxlLmNyZWF0ZVRhYmxlKGRpbWVuc2lvblswXSwgZGltZW5zaW9uWzFdLCBvcHRpb25zKSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBmbG9hdCBtZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICovXG4gICAgdGhpcy5mbG9hdE1lID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHZhciAkdGFyZ2V0ID0gJCh0aGlzLnJlc3RvcmVUYXJnZXQoKSk7XG4gICAgICAkdGFyZ2V0LmNzcygnZmxvYXQnLCB2YWx1ZSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiByZXNpemUgb3ZlcmxheSBlbGVtZW50XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICovXG4gICAgdGhpcy5yZXNpemUgPSB0aGlzLndyYXBDb21tYW5kKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdmFyICR0YXJnZXQgPSAkKHRoaXMucmVzdG9yZVRhcmdldCgpKTtcbiAgICAgICR0YXJnZXQuY3NzKHtcbiAgICAgICAgd2lkdGg6IHZhbHVlICogMTAwICsgJyUnLFxuICAgICAgICBoZWlnaHQ6ICcnXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7UG9zaXRpb259IHBvc1xuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkdGFyZ2V0IC0gdGFyZ2V0IGVsZW1lbnRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtiS2VlcFJhdGlvXSAtIGtlZXAgcmF0aW9cbiAgICAgKi9cbiAgICB0aGlzLnJlc2l6ZVRvID0gZnVuY3Rpb24gKHBvcywgJHRhcmdldCwgYktlZXBSYXRpbykge1xuICAgICAgdmFyIGltYWdlU2l6ZTtcbiAgICAgIGlmIChiS2VlcFJhdGlvKSB7XG4gICAgICAgIHZhciBuZXdSYXRpbyA9IHBvcy55IC8gcG9zLng7XG4gICAgICAgIHZhciByYXRpbyA9ICR0YXJnZXQuZGF0YSgncmF0aW8nKTtcbiAgICAgICAgaW1hZ2VTaXplID0ge1xuICAgICAgICAgIHdpZHRoOiByYXRpbyA+IG5ld1JhdGlvID8gcG9zLnggOiBwb3MueSAvIHJhdGlvLFxuICAgICAgICAgIGhlaWdodDogcmF0aW8gPiBuZXdSYXRpbyA/IHBvcy54ICogcmF0aW8gOiBwb3MueVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW1hZ2VTaXplID0ge1xuICAgICAgICAgIHdpZHRoOiBwb3MueCxcbiAgICAgICAgICBoZWlnaHQ6IHBvcy55XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgICR0YXJnZXQuY3NzKGltYWdlU2l6ZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJlbW92ZSBtZWRpYSBvYmplY3RcbiAgICAgKi9cbiAgICB0aGlzLnJlbW92ZU1lZGlhID0gdGhpcy53cmFwQ29tbWFuZChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJHRhcmdldCA9ICQodGhpcy5yZXN0b3JlVGFyZ2V0KCkpLmRldGFjaCgpO1xuICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ21lZGlhLmRlbGV0ZScsICR0YXJnZXQsICRlZGl0YWJsZSk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiByZXR1cm5zIHdoZXRoZXIgZWRpdGFibGUgYXJlYSBoYXMgZm9jdXMgb3Igbm90LlxuICAgICAqL1xuICAgIHRoaXMuaGFzRm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJGVkaXRhYmxlLmlzKCc6Zm9jdXMnKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogc2V0IGZvY3VzXG4gICAgICovXG4gICAgdGhpcy5mb2N1cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFt3b3JrYXJvdW5kXSBTY3JlZW4gd2lsbCBtb3ZlIHdoZW4gcGFnZSBpcyBzY29sbGVkIGluIElFLlxuICAgICAgLy8gIC0gZG8gZm9jdXMgd2hlbiBub3QgZm9jdXNlZFxuICAgICAgaWYgKCF0aGlzLmhhc0ZvY3VzKCkpIHtcbiAgICAgICAgJGVkaXRhYmxlLmZvY3VzKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgd2hldGhlciBjb250ZW50cyBpcyBlbXB0eSBvciBub3QuXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB0aGlzLmlzRW1wdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZG9tLmlzRW1wdHkoJGVkaXRhYmxlWzBdKSB8fCBkb20uZW1wdHlQYXJhID09PSAkZWRpdGFibGUuaHRtbCgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFsbCBjb250ZW50cyBhbmQgcmVzdG9yZXMgdGhlIGVkaXRhYmxlIGluc3RhbmNlIHRvIGFuIF9lbXB0eVBhcmFfLlxuICAgICAqL1xuICAgIHRoaXMuZW1wdHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb250ZXh0Lmludm9rZSgnY29kZScsIGRvbS5lbXB0eVBhcmEpO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIENsaXBib2FyZCA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyICRlZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZTtcblxuICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgJ3N1bW1lcm5vdGUua2V5ZG93bic6IGZ1bmN0aW9uICh3ZSwgZSkge1xuICAgICAgICBpZiAoc2VsZi5uZWVkS2V5ZG93bkhvb2soKSkge1xuICAgICAgICAgIGlmICgoZS5jdHJsS2V5IHx8IGUubWV0YUtleSkgJiYgZS5rZXlDb2RlID09PSBrZXkuY29kZS5WKSB7XG4gICAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLnNhdmVSYW5nZScpO1xuICAgICAgICAgICAgc2VsZi4kcGFzdGUuZm9jdXMoKTtcblxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHNlbGYucGFzdGVCeUhvb2soKTtcbiAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLm5lZWRLZXlkb3duSG9vayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAoYWdlbnQuaXNNU0lFICYmIGFnZW50LmJyb3dzZXJWZXJzaW9uID4gMTApIHx8IGFnZW50LmlzRkY7XG4gICAgfTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFt3b3JrYXJvdW5kXSBnZXR0aW5nIGltYWdlIGZyb20gY2xpcGJvYXJkXG4gICAgICAvLyAgLSBJRTExIGFuZCBGaXJlZm94OiBDVFJMK3YgaG9va1xuICAgICAgLy8gIC0gV2Via2l0OiBldmVudC5jbGlwYm9hcmREYXRhXG4gICAgICBpZiAodGhpcy5uZWVkS2V5ZG93bkhvb2soKSkge1xuICAgICAgICB0aGlzLiRwYXN0ZSA9ICQoJzxkaXYgdGFiaW5kZXg9XCItMVwiIC8+JykuYXR0cignY29udGVudGVkaXRhYmxlJywgdHJ1ZSkuY3NzKHtcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICBsZWZ0OiAtMTAwMDAwLFxuICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgfSk7XG4gICAgICAgICRlZGl0YWJsZS5iZWZvcmUodGhpcy4kcGFzdGUpO1xuXG4gICAgICAgIHRoaXMuJHBhc3RlLm9uKCdwYXN0ZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdwYXN0ZScsIGV2ZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkZWRpdGFibGUub24oJ3Bhc3RlJywgdGhpcy5wYXN0ZUJ5RXZlbnQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5uZWVkS2V5ZG93bkhvb2soKSkge1xuICAgICAgICB0aGlzLiRwYXN0ZS5yZW1vdmUoKTtcbiAgICAgICAgdGhpcy4kcGFzdGUgPSBudWxsO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnBhc3RlQnlIb29rID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG5vZGUgPSB0aGlzLiRwYXN0ZVswXS5maXJzdENoaWxkO1xuXG4gICAgICBpZiAoZG9tLmlzSW1nKG5vZGUpKSB7XG4gICAgICAgIHZhciBkYXRhVVJJID0gbm9kZS5zcmM7XG4gICAgICAgIHZhciBkZWNvZGVkRGF0YSA9IGF0b2IoZGF0YVVSSS5zcGxpdCgnLCcpWzFdKTtcbiAgICAgICAgdmFyIGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoZGVjb2RlZERhdGEubGVuZ3RoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWNvZGVkRGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGFycmF5W2ldID0gZGVjb2RlZERhdGEuY2hhckNvZGVBdChpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2FycmF5XSwgeyB0eXBlOiAnaW1hZ2UvcG5nJyB9KTtcbiAgICAgICAgYmxvYi5uYW1lID0gJ2NsaXBib2FyZC5wbmcnO1xuXG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IuZm9jdXMnKTtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5pbnNlcnRJbWFnZXNPckNhbGxiYWNrJywgW2Jsb2JdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBwYXN0ZUNvbnRlbnQgPSAkKCc8ZGl2IC8+JykuaHRtbCh0aGlzLiRwYXN0ZS5odG1sKCkpLmh0bWwoKTtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5yZXN0b3JlUmFuZ2UnKTtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5mb2N1cycpO1xuXG4gICAgICAgIGlmIChwYXN0ZUNvbnRlbnQpIHtcbiAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLnBhc3RlSFRNTCcsIHBhc3RlQ29udGVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy4kcGFzdGUuZW1wdHkoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogcGFzdGUgYnkgY2xpcGJvYXJkIGV2ZW50XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudFxuICAgICAqL1xuICAgIHRoaXMucGFzdGVCeUV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICB2YXIgY2xpcGJvYXJkRGF0YSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2xpcGJvYXJkRGF0YTtcbiAgICAgIGlmIChjbGlwYm9hcmREYXRhICYmIGNsaXBib2FyZERhdGEuaXRlbXMgJiYgY2xpcGJvYXJkRGF0YS5pdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBsaXN0LmhlYWQoY2xpcGJvYXJkRGF0YS5pdGVtcyk7XG4gICAgICAgIGlmIChpdGVtLmtpbmQgPT09ICdmaWxlJyAmJiBpdGVtLnR5cGUuaW5kZXhPZignaW1hZ2UvJykgIT09IC0xKSB7XG4gICAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5pbnNlcnRJbWFnZXNPckNhbGxiYWNrJywgW2l0ZW0uZ2V0QXNGaWxlKCldKTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmFmdGVyQ29tbWFuZCcpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgdmFyIERyb3B6b25lID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgJGRvY3VtZW50ID0gJChkb2N1bWVudCk7XG4gICAgdmFyICRlZGl0b3IgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdG9yO1xuICAgIHZhciAkZWRpdGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGFibGU7XG4gICAgdmFyIG9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdmFyIGxhbmcgPSBvcHRpb25zLmxhbmdJbmZvO1xuICAgIHZhciBkb2N1bWVudEV2ZW50SGFuZGxlcnMgPSB7fTtcblxuICAgIHZhciAkZHJvcHpvbmUgPSAkKFtcbiAgICAgICc8ZGl2IGNsYXNzPVwibm90ZS1kcm9wem9uZVwiPicsXG4gICAgICAnICA8ZGl2IGNsYXNzPVwibm90ZS1kcm9wem9uZS1tZXNzYWdlXCIvPicsXG4gICAgICAnPC9kaXY+J1xuICAgIF0uam9pbignJykpLnByZXBlbmRUbygkZWRpdG9yKTtcblxuICAgIHZhciBkZXRhY2hEb2N1bWVudEV2ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgT2JqZWN0LmtleXMoZG9jdW1lbnRFdmVudEhhbmRsZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgJGRvY3VtZW50Lm9mZihrZXkuc3Vic3RyKDIpLnRvTG93ZXJDYXNlKCksIGRvY3VtZW50RXZlbnRIYW5kbGVyc1trZXldKTtcbiAgICAgIH0pO1xuICAgICAgZG9jdW1lbnRFdmVudEhhbmRsZXJzID0ge307XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGF0dGFjaCBEcmFnIGFuZCBEcm9wIEV2ZW50c1xuICAgICAqL1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChvcHRpb25zLmRpc2FibGVEcmFnQW5kRHJvcCkge1xuICAgICAgICAvLyBwcmV2ZW50IGRlZmF1bHQgZHJvcCBldmVudFxuICAgICAgICBkb2N1bWVudEV2ZW50SGFuZGxlcnMub25Ecm9wID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH07XG4gICAgICAgICRkb2N1bWVudC5vbignZHJvcCcsIGRvY3VtZW50RXZlbnRIYW5kbGVycy5vbkRyb3ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hdHRhY2hEcmFnQW5kRHJvcEV2ZW50KCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGF0dGFjaCBEcmFnIGFuZCBEcm9wIEV2ZW50c1xuICAgICAqL1xuICAgIHRoaXMuYXR0YWNoRHJhZ0FuZERyb3BFdmVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBjb2xsZWN0aW9uID0gJCgpLFxuICAgICAgICAgICRkcm9wem9uZU1lc3NhZ2UgPSAkZHJvcHpvbmUuZmluZCgnLm5vdGUtZHJvcHpvbmUtbWVzc2FnZScpO1xuXG4gICAgICBkb2N1bWVudEV2ZW50SGFuZGxlcnMub25EcmFnZW50ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgaXNDb2RldmlldyA9IGNvbnRleHQuaW52b2tlKCdjb2Rldmlldy5pc0FjdGl2YXRlZCcpO1xuICAgICAgICB2YXIgaGFzRWRpdG9yU2l6ZSA9ICRlZGl0b3Iud2lkdGgoKSA+IDAgJiYgJGVkaXRvci5oZWlnaHQoKSA+IDA7XG4gICAgICAgIGlmICghaXNDb2RldmlldyAmJiAhY29sbGVjdGlvbi5sZW5ndGggJiYgaGFzRWRpdG9yU2l6ZSkge1xuICAgICAgICAgICRlZGl0b3IuYWRkQ2xhc3MoJ2RyYWdvdmVyJyk7XG4gICAgICAgICAgJGRyb3B6b25lLndpZHRoKCRlZGl0b3Iud2lkdGgoKSk7XG4gICAgICAgICAgJGRyb3B6b25lLmhlaWdodCgkZWRpdG9yLmhlaWdodCgpKTtcbiAgICAgICAgICAkZHJvcHpvbmVNZXNzYWdlLnRleHQobGFuZy5pbWFnZS5kcmFnSW1hZ2VIZXJlKTtcbiAgICAgICAgfVxuICAgICAgICBjb2xsZWN0aW9uID0gY29sbGVjdGlvbi5hZGQoZS50YXJnZXQpO1xuICAgICAgfTtcblxuICAgICAgZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJhZ2xlYXZlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb24ubm90KGUudGFyZ2V0KTtcbiAgICAgICAgaWYgKCFjb2xsZWN0aW9uLmxlbmd0aCkge1xuICAgICAgICAgICRlZGl0b3IucmVtb3ZlQ2xhc3MoJ2RyYWdvdmVyJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGRvY3VtZW50RXZlbnRIYW5kbGVycy5vbkRyb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbGxlY3Rpb24gPSAkKCk7XG4gICAgICAgICRlZGl0b3IucmVtb3ZlQ2xhc3MoJ2RyYWdvdmVyJyk7XG4gICAgICB9O1xuXG4gICAgICAvLyBzaG93IGRyb3B6b25lIG9uIGRyYWdlbnRlciB3aGVuIGRyYWdnaW5nIGEgb2JqZWN0IHRvIGRvY3VtZW50XG4gICAgICAvLyAtYnV0IG9ubHkgaWYgdGhlIGVkaXRvciBpcyB2aXNpYmxlLCBpLmUuIGhhcyBhIHBvc2l0aXZlIHdpZHRoIGFuZCBoZWlnaHRcbiAgICAgICRkb2N1bWVudC5vbignZHJhZ2VudGVyJywgZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJhZ2VudGVyKVxuICAgICAgICAub24oJ2RyYWdsZWF2ZScsIGRvY3VtZW50RXZlbnRIYW5kbGVycy5vbkRyYWdsZWF2ZSlcbiAgICAgICAgLm9uKCdkcm9wJywgZG9jdW1lbnRFdmVudEhhbmRsZXJzLm9uRHJvcCk7XG5cbiAgICAgIC8vIGNoYW5nZSBkcm9wem9uZSdzIG1lc3NhZ2Ugb24gaG92ZXIuXG4gICAgICAkZHJvcHpvbmUub24oJ2RyYWdlbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGRyb3B6b25lLmFkZENsYXNzKCdob3ZlcicpO1xuICAgICAgICAkZHJvcHpvbmVNZXNzYWdlLnRleHQobGFuZy5pbWFnZS5kcm9wSW1hZ2UpO1xuICAgICAgfSkub24oJ2RyYWdsZWF2ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGRyb3B6b25lLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuICAgICAgICAkZHJvcHpvbmVNZXNzYWdlLnRleHQobGFuZy5pbWFnZS5kcmFnSW1hZ2VIZXJlKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBhdHRhY2ggZHJvcEltYWdlXG4gICAgICAkZHJvcHpvbmUub24oJ2Ryb3AnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIGRhdGFUcmFuc2ZlciA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyO1xuXG4gICAgICAgIGlmIChkYXRhVHJhbnNmZXIgJiYgZGF0YVRyYW5zZmVyLmZpbGVzICYmIGRhdGFUcmFuc2Zlci5maWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICRlZGl0YWJsZS5mb2N1cygpO1xuICAgICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0SW1hZ2VzT3JDYWxsYmFjaycsIGRhdGFUcmFuc2Zlci5maWxlcyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJC5lYWNoKGRhdGFUcmFuc2Zlci50eXBlcywgZnVuY3Rpb24gKGlkeCwgdHlwZSkge1xuICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBkYXRhVHJhbnNmZXIuZ2V0RGF0YSh0eXBlKTtcblxuICAgICAgICAgICAgaWYgKHR5cGUudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd0ZXh0JykgPiAtMSkge1xuICAgICAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLnBhc3RlSFRNTCcsIGNvbnRlbnQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgJChjb250ZW50KS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmluc2VydE5vZGUnLCB0aGlzKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pLm9uKCdkcmFnb3ZlcicsIGZhbHNlKTsgLy8gcHJldmVudCBkZWZhdWx0IGRyYWdvdmVyIGV2ZW50XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGRldGFjaERvY3VtZW50RXZlbnQoKTtcbiAgICB9O1xuICB9O1xuXG5cbiAgdmFyIENvZGVNaXJyb3I7XG4gIGlmIChhZ2VudC5oYXNDb2RlTWlycm9yKSB7XG4gICAgaWYgKGFnZW50LmlzU3VwcG9ydEFtZCkge1xuICAgICAgcmVxdWlyZShbJ2NvZGVtaXJyb3InXSwgZnVuY3Rpb24gKGNtKSB7XG4gICAgICAgIENvZGVNaXJyb3IgPSBjbTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBDb2RlTWlycm9yID0gd2luZG93LkNvZGVNaXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBDb2Rldmlld1xuICAgKi9cbiAgdmFyIENvZGV2aWV3ID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgJGVkaXRvciA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0b3I7XG4gICAgdmFyICRlZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZTtcbiAgICB2YXIgJGNvZGFibGUgPSBjb250ZXh0LmxheW91dEluZm8uY29kYWJsZTtcbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcblxuICAgIHRoaXMuc3luYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBpc0NvZGV2aWV3ID0gdGhpcy5pc0FjdGl2YXRlZCgpO1xuICAgICAgaWYgKGlzQ29kZXZpZXcgJiYgYWdlbnQuaGFzQ29kZU1pcnJvcikge1xuICAgICAgICAkY29kYWJsZS5kYXRhKCdjbUVkaXRvcicpLnNhdmUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICB0aGlzLmlzQWN0aXZhdGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICRlZGl0b3IuaGFzQ2xhc3MoJ2NvZGV2aWV3Jyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHRvZ2dsZSBjb2Rldmlld1xuICAgICAqL1xuICAgIHRoaXMudG9nZ2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuaXNBY3RpdmF0ZWQoKSkge1xuICAgICAgICB0aGlzLmRlYWN0aXZhdGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuYWN0aXZhdGUoKTtcbiAgICAgIH1cbiAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdjb2Rldmlldy50b2dnbGVkJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGFjdGl2YXRlIGNvZGUgdmlld1xuICAgICAqL1xuICAgIHRoaXMuYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAkY29kYWJsZS52YWwoZG9tLmh0bWwoJGVkaXRhYmxlLCBvcHRpb25zLnByZXR0aWZ5SHRtbCkpO1xuICAgICAgJGNvZGFibGUuaGVpZ2h0KCRlZGl0YWJsZS5oZWlnaHQoKSk7XG5cbiAgICAgIGNvbnRleHQuaW52b2tlKCd0b29sYmFyLnVwZGF0ZUNvZGV2aWV3JywgdHJ1ZSk7XG4gICAgICAkZWRpdG9yLmFkZENsYXNzKCdjb2RldmlldycpO1xuICAgICAgJGNvZGFibGUuZm9jdXMoKTtcblxuICAgICAgLy8gYWN0aXZhdGUgQ29kZU1pcnJvciBhcyBjb2RhYmxlXG4gICAgICBpZiAoYWdlbnQuaGFzQ29kZU1pcnJvcikge1xuICAgICAgICB2YXIgY21FZGl0b3IgPSBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSgkY29kYWJsZVswXSwgb3B0aW9ucy5jb2RlbWlycm9yKTtcblxuICAgICAgICAvLyBDb2RlTWlycm9yIFRlcm5TZXJ2ZXJcbiAgICAgICAgaWYgKG9wdGlvbnMuY29kZW1pcnJvci50ZXJuKSB7XG4gICAgICAgICAgdmFyIHNlcnZlciA9IG5ldyBDb2RlTWlycm9yLlRlcm5TZXJ2ZXIob3B0aW9ucy5jb2RlbWlycm9yLnRlcm4pO1xuICAgICAgICAgIGNtRWRpdG9yLnRlcm5TZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgICAgY21FZGl0b3Iub24oJ2N1cnNvckFjdGl2aXR5JywgZnVuY3Rpb24gKGNtKSB7XG4gICAgICAgICAgICBzZXJ2ZXIudXBkYXRlQXJnSGludHMoY20pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29kZU1pcnJvciBoYXNuJ3QgUGFkZGluZy5cbiAgICAgICAgY21FZGl0b3Iuc2V0U2l6ZShudWxsLCAkZWRpdGFibGUub3V0ZXJIZWlnaHQoKSk7XG4gICAgICAgICRjb2RhYmxlLmRhdGEoJ2NtRWRpdG9yJywgY21FZGl0b3IpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBkZWFjdGl2YXRlIGNvZGUgdmlld1xuICAgICAqL1xuICAgIHRoaXMuZGVhY3RpdmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGRlYWN0aXZhdGUgQ29kZU1pcnJvciBhcyBjb2RhYmxlXG4gICAgICBpZiAoYWdlbnQuaGFzQ29kZU1pcnJvcikge1xuICAgICAgICB2YXIgY21FZGl0b3IgPSAkY29kYWJsZS5kYXRhKCdjbUVkaXRvcicpO1xuICAgICAgICAkY29kYWJsZS52YWwoY21FZGl0b3IuZ2V0VmFsdWUoKSk7XG4gICAgICAgIGNtRWRpdG9yLnRvVGV4dEFyZWEoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHZhbHVlID0gZG9tLnZhbHVlKCRjb2RhYmxlLCBvcHRpb25zLnByZXR0aWZ5SHRtbCkgfHwgZG9tLmVtcHR5UGFyYTtcbiAgICAgIHZhciBpc0NoYW5nZSA9ICRlZGl0YWJsZS5odG1sKCkgIT09IHZhbHVlO1xuXG4gICAgICAkZWRpdGFibGUuaHRtbCh2YWx1ZSk7XG4gICAgICAkZWRpdGFibGUuaGVpZ2h0KG9wdGlvbnMuaGVpZ2h0ID8gJGNvZGFibGUuaGVpZ2h0KCkgOiAnYXV0bycpO1xuICAgICAgJGVkaXRvci5yZW1vdmVDbGFzcygnY29kZXZpZXcnKTtcblxuICAgICAgaWYgKGlzQ2hhbmdlKSB7XG4gICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdjaGFuZ2UnLCAkZWRpdGFibGUuaHRtbCgpLCAkZWRpdGFibGUpO1xuICAgICAgfVxuXG4gICAgICAkZWRpdGFibGUuZm9jdXMoKTtcblxuICAgICAgY29udGV4dC5pbnZva2UoJ3Rvb2xiYXIudXBkYXRlQ29kZXZpZXcnLCBmYWxzZSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmlzQWN0aXZhdGVkKCkpIHtcbiAgICAgICAgdGhpcy5kZWFjdGl2YXRlKCk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICB2YXIgRURJVEFCTEVfUEFERElORyA9IDI0O1xuXG4gIHZhciBTdGF0dXNiYXIgPSBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgIHZhciAkZG9jdW1lbnQgPSAkKGRvY3VtZW50KTtcbiAgICB2YXIgJHN0YXR1c2JhciA9IGNvbnRleHQubGF5b3V0SW5mby5zdGF0dXNiYXI7XG4gICAgdmFyICRlZGl0YWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5lZGl0YWJsZTtcbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChvcHRpb25zLmFpck1vZGUgfHwgb3B0aW9ucy5kaXNhYmxlUmVzaXplRWRpdG9yKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgJHN0YXR1c2Jhci5vbignbW91c2Vkb3duJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIHZhciBlZGl0YWJsZVRvcCA9ICRlZGl0YWJsZS5vZmZzZXQoKS50b3AgLSAkZG9jdW1lbnQuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgJGRvY3VtZW50Lm9uKCdtb3VzZW1vdmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgaGVpZ2h0ID0gZXZlbnQuY2xpZW50WSAtIChlZGl0YWJsZVRvcCArIEVESVRBQkxFX1BBRERJTkcpO1xuXG4gICAgICAgICAgaGVpZ2h0ID0gKG9wdGlvbnMubWluaGVpZ2h0ID4gMCkgPyBNYXRoLm1heChoZWlnaHQsIG9wdGlvbnMubWluaGVpZ2h0KSA6IGhlaWdodDtcbiAgICAgICAgICBoZWlnaHQgPSAob3B0aW9ucy5tYXhIZWlnaHQgPiAwKSA/IE1hdGgubWluKGhlaWdodCwgb3B0aW9ucy5tYXhIZWlnaHQpIDogaGVpZ2h0O1xuXG4gICAgICAgICAgJGVkaXRhYmxlLmhlaWdodChoZWlnaHQpO1xuICAgICAgICB9KS5vbmUoJ21vdXNldXAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJGRvY3VtZW50Lm9mZignbW91c2Vtb3ZlJyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICRzdGF0dXNiYXIub2ZmKCk7XG4gICAgICAkc3RhdHVzYmFyLnJlbW92ZSgpO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgIHZhciAkZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB2YXIgJHRvb2xiYXIgPSBjb250ZXh0LmxheW91dEluZm8udG9vbGJhcjtcbiAgICB2YXIgJGVkaXRhYmxlID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRhYmxlO1xuICAgIHZhciAkY29kYWJsZSA9IGNvbnRleHQubGF5b3V0SW5mby5jb2RhYmxlO1xuXG4gICAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyk7XG4gICAgdmFyICRzY3JvbGxiYXIgPSAkKCdodG1sLCBib2R5Jyk7XG5cbiAgICAvKipcbiAgICAgKiB0b2dnbGUgZnVsbHNjcmVlblxuICAgICAqL1xuICAgIHRoaXMudG9nZ2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHJlc2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgICAgICRlZGl0YWJsZS5jc3MoJ2hlaWdodCcsIHNpemUuaCk7XG4gICAgICAgICRjb2RhYmxlLmNzcygnaGVpZ2h0Jywgc2l6ZS5oKTtcbiAgICAgICAgaWYgKCRjb2RhYmxlLmRhdGEoJ2NtZWRpdG9yJykpIHtcbiAgICAgICAgICAkY29kYWJsZS5kYXRhKCdjbWVkaXRvcicpLnNldHNpemUobnVsbCwgc2l6ZS5oKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgJGVkaXRvci50b2dnbGVDbGFzcygnZnVsbHNjcmVlbicpO1xuICAgICAgaWYgKHRoaXMuaXNGdWxsc2NyZWVuKCkpIHtcbiAgICAgICAgJGVkaXRhYmxlLmRhdGEoJ29yZ0hlaWdodCcsICRlZGl0YWJsZS5jc3MoJ2hlaWdodCcpKTtcblxuICAgICAgICAkd2luZG93Lm9uKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmVzaXplKHtcbiAgICAgICAgICAgIGg6ICR3aW5kb3cuaGVpZ2h0KCkgLSAkdG9vbGJhci5vdXRlckhlaWdodCgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuXG4gICAgICAgICRzY3JvbGxiYXIuY3NzKCdvdmVyZmxvdycsICdoaWRkZW4nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICR3aW5kb3cub2ZmKCdyZXNpemUnKTtcbiAgICAgICAgcmVzaXplKHtcbiAgICAgICAgICBoOiAkZWRpdGFibGUuZGF0YSgnb3JnSGVpZ2h0JylcbiAgICAgICAgfSk7XG4gICAgICAgICRzY3JvbGxiYXIuY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRleHQuaW52b2tlKCd0b29sYmFyLnVwZGF0ZUZ1bGxzY3JlZW4nLCB0aGlzLmlzRnVsbHNjcmVlbigpKTtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0Z1bGxzY3JlZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gJGVkaXRvci5oYXNDbGFzcygnZnVsbHNjcmVlbicpO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIEhhbmRsZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyICRkb2N1bWVudCA9ICQoZG9jdW1lbnQpO1xuICAgIHZhciAkZWRpdGluZ0FyZWEgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGluZ0FyZWE7XG4gICAgdmFyIG9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG5cbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLm1vdXNlZG93bic6IGZ1bmN0aW9uICh3ZSwgZSkge1xuICAgICAgICBpZiAoc2VsZi51cGRhdGUoZS50YXJnZXQpKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUua2V5dXAgc3VtbWVybm90ZS5zY3JvbGwgc3VtbWVybm90ZS5jaGFuZ2Ugc3VtbWVybm90ZS5kaWFsb2cuc2hvd24nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYudXBkYXRlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJGhhbmRsZSA9ICQoW1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm5vdGUtaGFuZGxlXCI+JyxcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJub3RlLWNvbnRyb2wtc2VsZWN0aW9uXCI+JyxcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJub3RlLWNvbnRyb2wtc2VsZWN0aW9uLWJnXCI+PC9kaXY+JyxcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJub3RlLWNvbnRyb2wtaG9sZGVyIG5vdGUtY29udHJvbC1ud1wiPjwvZGl2PicsXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibm90ZS1jb250cm9sLWhvbGRlciBub3RlLWNvbnRyb2wtbmVcIj48L2Rpdj4nLFxuICAgICAgICAnPGRpdiBjbGFzcz1cIm5vdGUtY29udHJvbC1ob2xkZXIgbm90ZS1jb250cm9sLXN3XCI+PC9kaXY+JyxcbiAgICAgICAgJzxkaXYgY2xhc3M9XCInLFxuICAgICAgICAob3B0aW9ucy5kaXNhYmxlUmVzaXplSW1hZ2UgPyAnbm90ZS1jb250cm9sLWhvbGRlcicgOiAnbm90ZS1jb250cm9sLXNpemluZycpLFxuICAgICAgICAnIG5vdGUtY29udHJvbC1zZVwiPjwvZGl2PicsXG4gICAgICAgIChvcHRpb25zLmRpc2FibGVSZXNpemVJbWFnZSA/ICcnIDogJzxkaXYgY2xhc3M9XCJub3RlLWNvbnRyb2wtc2VsZWN0aW9uLWluZm9cIj48L2Rpdj4nKSxcbiAgICAgICAgJzwvZGl2PicsXG4gICAgICAgICc8L2Rpdj4nXG4gICAgICBdLmpvaW4oJycpKS5wcmVwZW5kVG8oJGVkaXRpbmdBcmVhKTtcblxuICAgICAgdGhpcy4kaGFuZGxlLm9uKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGRvbS5pc0NvbnRyb2xTaXppbmcoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICB2YXIgJHRhcmdldCA9IHNlbGYuJGhhbmRsZS5maW5kKCcubm90ZS1jb250cm9sLXNlbGVjdGlvbicpLmRhdGEoJ3RhcmdldCcpLFxuICAgICAgICAgICAgICBwb3NTdGFydCA9ICR0YXJnZXQub2Zmc2V0KCksXG4gICAgICAgICAgICAgIHNjcm9sbFRvcCA9ICRkb2N1bWVudC5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICRkb2N1bWVudC5vbignbW91c2Vtb3ZlJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLnJlc2l6ZVRvJywge1xuICAgICAgICAgICAgICB4OiBldmVudC5jbGllbnRYIC0gcG9zU3RhcnQubGVmdCxcbiAgICAgICAgICAgICAgeTogZXZlbnQuY2xpZW50WSAtIChwb3NTdGFydC50b3AgLSBzY3JvbGxUb3ApXG4gICAgICAgICAgICB9LCAkdGFyZ2V0LCAhZXZlbnQuc2hpZnRLZXkpO1xuXG4gICAgICAgICAgICBzZWxmLnVwZGF0ZSgkdGFyZ2V0WzBdKTtcbiAgICAgICAgICB9KS5vbmUoJ21vdXNldXAnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJGRvY3VtZW50Lm9mZignbW91c2Vtb3ZlJyk7XG4gICAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmFmdGVyQ29tbWFuZCcpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaWYgKCEkdGFyZ2V0LmRhdGEoJ3JhdGlvJykpIHsgLy8gb3JpZ2luYWwgcmF0aW8uXG4gICAgICAgICAgICAkdGFyZ2V0LmRhdGEoJ3JhdGlvJywgJHRhcmdldC5oZWlnaHQoKSAvICR0YXJnZXQud2lkdGgoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kaGFuZGxlLnJlbW92ZSgpO1xuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIHZhciBpc0ltYWdlID0gZG9tLmlzSW1nKHRhcmdldCk7XG4gICAgICB2YXIgJHNlbGVjdGlvbiA9IHRoaXMuJGhhbmRsZS5maW5kKCcubm90ZS1jb250cm9sLXNlbGVjdGlvbicpO1xuXG4gICAgICBjb250ZXh0Lmludm9rZSgnaW1hZ2VQb3BvdmVyLnVwZGF0ZScsIHRhcmdldCk7XG5cbiAgICAgIGlmIChpc0ltYWdlKSB7XG4gICAgICAgIHZhciAkaW1hZ2UgPSAkKHRhcmdldCk7XG4gICAgICAgIHZhciBwb3MgPSAkaW1hZ2UucG9zaXRpb24oKTtcblxuICAgICAgICAvLyBpbmNsdWRlIG1hcmdpblxuICAgICAgICB2YXIgaW1hZ2VTaXplID0ge1xuICAgICAgICAgIHc6ICRpbWFnZS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgIGg6ICRpbWFnZS5vdXRlckhlaWdodCh0cnVlKVxuICAgICAgICB9O1xuXG4gICAgICAgICRzZWxlY3Rpb24uY3NzKHtcbiAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICAgIHRvcDogcG9zLnRvcCxcbiAgICAgICAgICB3aWR0aDogaW1hZ2VTaXplLncsXG4gICAgICAgICAgaGVpZ2h0OiBpbWFnZVNpemUuaFxuICAgICAgICB9KS5kYXRhKCd0YXJnZXQnLCAkaW1hZ2UpOyAvLyBzYXZlIGN1cnJlbnQgaW1hZ2UgZWxlbWVudC5cblxuICAgICAgICB2YXIgc2l6aW5nVGV4dCA9IGltYWdlU2l6ZS53ICsgJ3gnICsgaW1hZ2VTaXplLmg7XG4gICAgICAgICRzZWxlY3Rpb24uZmluZCgnLm5vdGUtY29udHJvbC1zZWxlY3Rpb24taW5mbycpLnRleHQoc2l6aW5nVGV4dCk7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3Iuc2F2ZVRhcmdldCcsIHRhcmdldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGlzSW1hZ2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGhpZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkaGFuZGxlXG4gICAgICovXG4gICAgdGhpcy5oaWRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5jbGVhclRhcmdldCcpO1xuICAgICAgdGhpcy4kaGFuZGxlLmNoaWxkcmVuKCkuaGlkZSgpO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIEF1dG9MaW5rID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGRlZmF1bHRTY2hlbWUgPSAnaHR0cDovLyc7XG4gICAgdmFyIGxpbmtQYXR0ZXJuID0gL14oW0EtWmEtel1bQS1aYS16MC05Ky0uXSpcXDpbXFwvXFwvXT98bWFpbHRvOltBLVowLTkuXyUrLV0rQCk/KHd3d1xcLik/KC4rKSQvaTtcblxuICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgJ3N1bW1lcm5vdGUua2V5dXAnOiBmdW5jdGlvbiAod2UsIGUpIHtcbiAgICAgICAgaWYgKCFlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgc2VsZi5oYW5kbGVLZXl1cChlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICdzdW1tZXJub3RlLmtleWRvd24nOiBmdW5jdGlvbiAod2UsIGUpIHtcbiAgICAgICAgc2VsZi5oYW5kbGVLZXlkb3duKGUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgIH07XG5cbiAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgIH07XG5cbiAgICB0aGlzLnJlcGxhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoIXRoaXMubGFzdFdvcmRSYW5nZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBrZXl3b3JkID0gdGhpcy5sYXN0V29yZFJhbmdlLnRvU3RyaW5nKCk7XG4gICAgICB2YXIgbWF0Y2ggPSBrZXl3b3JkLm1hdGNoKGxpbmtQYXR0ZXJuKTtcblxuICAgICAgaWYgKG1hdGNoICYmIChtYXRjaFsxXSB8fCBtYXRjaFsyXSkpIHtcbiAgICAgICAgdmFyIGxpbmsgPSBtYXRjaFsxXSA/IGtleXdvcmQgOiBkZWZhdWx0U2NoZW1lICsga2V5d29yZDtcbiAgICAgICAgdmFyIG5vZGUgPSAkKCc8YSAvPicpLmh0bWwoa2V5d29yZCkuYXR0cignaHJlZicsIGxpbmspWzBdO1xuXG4gICAgICAgIHRoaXMubGFzdFdvcmRSYW5nZS5pbnNlcnROb2RlKG5vZGUpO1xuICAgICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmZvY3VzJyk7XG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgdGhpcy5oYW5kbGVLZXlkb3duID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChsaXN0LmNvbnRhaW5zKFtrZXkuY29kZS5FTlRFUiwga2V5LmNvZGUuU1BBQ0VdLCBlLmtleUNvZGUpKSB7XG4gICAgICAgIHZhciB3b3JkUmFuZ2UgPSBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmNyZWF0ZVJhbmdlJykuZ2V0V29yZFJhbmdlKCk7XG4gICAgICAgIHRoaXMubGFzdFdvcmRSYW5nZSA9IHdvcmRSYW5nZTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5oYW5kbGVLZXl1cCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAobGlzdC5jb250YWlucyhba2V5LmNvZGUuRU5URVIsIGtleS5jb2RlLlNQQUNFXSwgZS5rZXlDb2RlKSkge1xuICAgICAgICB0aGlzLnJlcGxhY2UoKTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiB0ZXh0YXJlYSBhdXRvIHN5bmMuXG4gICAqL1xuICB2YXIgQXV0b1N5bmMgPSBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgIHZhciAkbm90ZSA9IGNvbnRleHQubGF5b3V0SW5mby5ub3RlO1xuXG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICAnc3VtbWVybm90ZS5jaGFuZ2UnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRub3RlLnZhbChjb250ZXh0Lmludm9rZSgnY29kZScpKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5zaG91bGRJbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGRvbS5pc1RleHRhcmVhKCRub3RlWzBdKTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBQbGFjZWhvbGRlciA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciAkZWRpdGluZ0FyZWEgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdGluZ0FyZWE7XG4gICAgdmFyIG9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG5cbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLmluaXQgc3VtbWVybm90ZS5jaGFuZ2UnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYudXBkYXRlKCk7XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUuY29kZXZpZXcudG9nZ2xlZCc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi51cGRhdGUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5zaG91bGRJbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICEhb3B0aW9ucy5wbGFjZWhvbGRlcjtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcGxhY2Vob2xkZXIgPSAkKCc8ZGl2IGNsYXNzPVwibm90ZS1wbGFjZWhvbGRlclwiPicpO1xuICAgICAgdGhpcy4kcGxhY2Vob2xkZXIub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb250ZXh0Lmludm9rZSgnZm9jdXMnKTtcbiAgICAgIH0pLnRleHQob3B0aW9ucy5wbGFjZWhvbGRlcikucHJlcGVuZFRvKCRlZGl0aW5nQXJlYSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJHBsYWNlaG9sZGVyLnJlbW92ZSgpO1xuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBpc1Nob3cgPSAhY29udGV4dC5pbnZva2UoJ2NvZGV2aWV3LmlzQWN0aXZhdGVkJykgJiYgY29udGV4dC5pbnZva2UoJ2VkaXRvci5pc0VtcHR5Jyk7XG4gICAgICB0aGlzLiRwbGFjZWhvbGRlci50b2dnbGUoaXNTaG93KTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBCdXR0b25zID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHVpID0gJC5zdW1tZXJub3RlLnVpO1xuXG4gICAgdmFyICR0b29sYmFyID0gY29udGV4dC5sYXlvdXRJbmZvLnRvb2xiYXI7XG4gICAgdmFyIG9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG4gICAgdmFyIGxhbmcgPSBvcHRpb25zLmxhbmdJbmZvO1xuXG4gICAgdmFyIGludmVydGVkS2V5TWFwID0gZnVuYy5pbnZlcnRPYmplY3Qob3B0aW9ucy5rZXlNYXBbYWdlbnQuaXNNYWMgPyAnbWFjJyA6ICdwYyddKTtcblxuICAgIHZhciByZXByZXNlbnRTaG9ydGN1dCA9IHRoaXMucmVwcmVzZW50U2hvcnRjdXQgPSBmdW5jdGlvbiAoZWRpdG9yTWV0aG9kKSB7XG4gICAgICB2YXIgc2hvcnRjdXQgPSBpbnZlcnRlZEtleU1hcFtlZGl0b3JNZXRob2RdO1xuICAgICAgaWYgKCFvcHRpb25zLnNob3J0Y3V0cyB8fCAhc2hvcnRjdXQpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoYWdlbnQuaXNNYWMpIHtcbiAgICAgICAgc2hvcnRjdXQgPSBzaG9ydGN1dC5yZXBsYWNlKCdDTUQnLCAn4oyYJykucmVwbGFjZSgnU0hJRlQnLCAn4oenJyk7XG4gICAgICB9XG5cbiAgICAgIHNob3J0Y3V0ID0gc2hvcnRjdXQucmVwbGFjZSgnQkFDS1NMQVNIJywgJ1xcXFwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCdTTEFTSCcsICcvJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnTEVGVEJSQUNLRVQnLCAnWycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJ1JJR0hUQlJBQ0tFVCcsICddJyk7XG5cbiAgICAgIHJldHVybiAnICgnICsgc2hvcnRjdXQgKyAnKSc7XG4gICAgfTtcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuYWRkVG9vbGJhckJ1dHRvbnMoKTtcbiAgICAgIHRoaXMuYWRkSW1hZ2VQb3BvdmVyQnV0dG9ucygpO1xuICAgICAgdGhpcy5hZGRMaW5rUG9wb3ZlckJ1dHRvbnMoKTtcbiAgICAgIHRoaXMuZm9udEluc3RhbGxlZE1hcCA9IHt9O1xuICAgIH07XG5cbiAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBkZWxldGUgdGhpcy5mb250SW5zdGFsbGVkTWFwO1xuICAgIH07XG5cbiAgICB0aGlzLmlzRm9udEluc3RhbGxlZCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICBpZiAoIXNlbGYuZm9udEluc3RhbGxlZE1hcC5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICBzZWxmLmZvbnRJbnN0YWxsZWRNYXBbbmFtZV0gPSBhZ2VudC5pc0ZvbnRJbnN0YWxsZWQobmFtZSkgfHxcbiAgICAgICAgICBsaXN0LmNvbnRhaW5zKG9wdGlvbnMuZm9udE5hbWVzSWdub3JlQ2hlY2ssIG5hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2VsZi5mb250SW5zdGFsbGVkTWFwW25hbWVdO1xuICAgIH07XG5cbiAgICB0aGlzLmFkZFRvb2xiYXJCdXR0b25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uc3R5bGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b25Hcm91cChbXG4gICAgICAgICAgdWkuYnV0dG9uKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLm1hZ2ljKSArICcgJyArIHVpLmljb24ob3B0aW9ucy5pY29ucy5jYXJldCwgJ3NwYW4nKSxcbiAgICAgICAgICAgIHRvb2x0aXA6IGxhbmcuc3R5bGUuc3R5bGUsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHVpLmRyb3Bkb3duKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXN0eWxlJyxcbiAgICAgICAgICAgIGl0ZW1zOiBjb250ZXh0Lm9wdGlvbnMuc3R5bGVUYWdzLFxuICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uIChpdGVtKSB7XG5cbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGl0ZW0gPSB7IHRhZzogaXRlbSwgdGl0bGU6IChsYW5nLnN0eWxlLmhhc093blByb3BlcnR5KGl0ZW0pID8gbGFuZy5zdHlsZVtpdGVtXSA6IGl0ZW0pIH07XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB2YXIgdGFnID0gaXRlbS50YWc7XG4gICAgICAgICAgICAgIHZhciB0aXRsZSA9IGl0ZW0udGl0bGU7XG4gICAgICAgICAgICAgIHZhciBzdHlsZSA9IGl0ZW0uc3R5bGUgPyAnIHN0eWxlPVwiJyArIGl0ZW0uc3R5bGUgKyAnXCIgJyA6ICcnO1xuICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gaXRlbS5jbGFzc05hbWUgPyAnIGNsYXNzPVwiJyArIGl0ZW0uY2xhc3NOYW1lICsgJ1wiJyA6ICcnO1xuXG4gICAgICAgICAgICAgIHJldHVybiAnPCcgKyB0YWcgKyBzdHlsZSArIGNsYXNzTmFtZSArICc+JyArIHRpdGxlICsgJzwvJyArIHRhZyArICAnPic7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmZvcm1hdEJsb2NrJylcbiAgICAgICAgICB9KVxuICAgICAgICBdKS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5ib2xkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWJ0bi1ib2xkJyxcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmJvbGQpLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuZm9udC5ib2xkICsgcmVwcmVzZW50U2hvcnRjdXQoJ2JvbGQnKSxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuYm9sZCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLml0YWxpYycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1idG4taXRhbGljJyxcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLml0YWxpYyksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5mb250Lml0YWxpYyArIHJlcHJlc2VudFNob3J0Y3V0KCdpdGFsaWMnKSxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuaXRhbGljJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24udW5kZXJsaW5lJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWJ0bi11bmRlcmxpbmUnLFxuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMudW5kZXJsaW5lKSxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmZvbnQudW5kZXJsaW5lICsgcmVwcmVzZW50U2hvcnRjdXQoJ3VuZGVybGluZScpLFxuICAgICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci51bmRlcmxpbmUnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5jbGVhcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5lcmFzZXIpLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuZm9udC5jbGVhciArIHJlcHJlc2VudFNob3J0Y3V0KCdyZW1vdmVGb3JtYXQnKSxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVtb3ZlRm9ybWF0JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uc3RyaWtldGhyb3VnaCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1idG4tc3RyaWtldGhyb3VnaCcsXG4gICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5zdHJpa2V0aHJvdWdoKSxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmZvbnQuc3RyaWtldGhyb3VnaCArIHJlcHJlc2VudFNob3J0Y3V0KCdzdHJpa2V0aHJvdWdoJyksXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLnN0cmlrZXRocm91Z2gnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5zdXBlcnNjcmlwdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1idG4tc3VwZXJzY3JpcHQnLFxuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMuc3VwZXJzY3JpcHQpLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuZm9udC5zdXBlcnNjcmlwdCxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3Iuc3VwZXJzY3JpcHQnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5zdWJzY3JpcHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ25vdGUtYnRuLXN1YnNjcmlwdCcsXG4gICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5zdWJzY3JpcHQpLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuZm9udC5zdWJzY3JpcHQsXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLnN1YnNjcmlwdCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmZvbnRuYW1lJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uR3JvdXAoW1xuICAgICAgICAgIHVpLmJ1dHRvbih7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdkcm9wZG93bi10b2dnbGUnLFxuICAgICAgICAgICAgY29udGVudHM6ICc8c3BhbiBjbGFzcz1cIm5vdGUtY3VycmVudC1mb250bmFtZVwiLz4gJyArIHVpLmljb24ob3B0aW9ucy5pY29ucy5jYXJldCwgJ3NwYW4nKSxcbiAgICAgICAgICAgIHRvb2x0aXA6IGxhbmcuZm9udC5uYW1lLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB0b2dnbGU6ICdkcm9wZG93bidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICB1aS5kcm9wZG93bkNoZWNrKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLWZvbnRuYW1lJyxcbiAgICAgICAgICAgIGNoZWNrQ2xhc3NOYW1lOiBvcHRpb25zLmljb25zLm1lbnVDaGVjayxcbiAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLmZvbnROYW1lcy5maWx0ZXIoc2VsZi5pc0ZvbnRJbnN0YWxsZWQpLFxuICAgICAgICAgICAgdGVtcGxhdGU6IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gc3R5bGU9XCJmb250LWZhbWlseTonICsgaXRlbSArICdcIj4nICsgaXRlbSArICc8L3NwYW4+JztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuZm9udE5hbWUnKVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmZvbnRzaXplJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uR3JvdXAoW1xuICAgICAgICAgIHVpLmJ1dHRvbih7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdkcm9wZG93bi10b2dnbGUnLFxuICAgICAgICAgICAgY29udGVudHM6ICc8c3BhbiBjbGFzcz1cIm5vdGUtY3VycmVudC1mb250c2l6ZVwiLz4nICsgdWkuaWNvbihvcHRpb25zLmljb25zLmNhcmV0LCAnc3BhbicpLFxuICAgICAgICAgICAgdG9vbHRpcDogbGFuZy5mb250LnNpemUsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHVpLmRyb3Bkb3duQ2hlY2soe1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tZm9udHNpemUnLFxuICAgICAgICAgICAgY2hlY2tDbGFzc05hbWU6IG9wdGlvbnMuaWNvbnMubWVudUNoZWNrLFxuICAgICAgICAgICAgaXRlbXM6IG9wdGlvbnMuZm9udFNpemVzLFxuICAgICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmZvbnRTaXplJylcbiAgICAgICAgICB9KVxuICAgICAgICBdKS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5jb2xvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbkdyb3VwKHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLWNvbG9yJyxcbiAgICAgICAgICBjaGlsZHJlbjogW1xuICAgICAgICAgICAgdWkuYnV0dG9uKHtcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1jdXJyZW50LWNvbG9yLWJ1dHRvbicsXG4gICAgICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMuZm9udCArICcgbm90ZS1yZWNlbnQtY29sb3InKSxcbiAgICAgICAgICAgICAgdG9vbHRpcDogbGFuZy5jb2xvci5yZWNlbnQsXG4gICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHZhciAkYnV0dG9uID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICAgICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IuY29sb3InLCB7XG4gICAgICAgICAgICAgICAgICBiYWNrQ29sb3I6ICRidXR0b24uYXR0cignZGF0YS1iYWNrQ29sb3InKSxcbiAgICAgICAgICAgICAgICAgIGZvcmVDb2xvcjogJGJ1dHRvbi5hdHRyKCdkYXRhLWZvcmVDb2xvcicpXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoJGJ1dHRvbikge1xuICAgICAgICAgICAgICAgIHZhciAkcmVjZW50Q29sb3IgPSAkYnV0dG9uLmZpbmQoJy5ub3RlLXJlY2VudC1jb2xvcicpO1xuICAgICAgICAgICAgICAgICRyZWNlbnRDb2xvci5jc3MoJ2JhY2tncm91bmQtY29sb3InLCAnI0ZGRkYwMCcpO1xuICAgICAgICAgICAgICAgICRidXR0b24uYXR0cignZGF0YS1iYWNrQ29sb3InLCAnI0ZGRkYwMCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHVpLmJ1dHRvbih7XG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMuY2FyZXQsICdzcGFuJyksXG4gICAgICAgICAgICAgIHRvb2x0aXA6IGxhbmcuY29sb3IubW9yZSxcbiAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHVpLmRyb3Bkb3duKHtcbiAgICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAgICAnPGxpPicsXG4gICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJidG4tZ3JvdXBcIj4nLFxuICAgICAgICAgICAgICAgICcgIDxkaXYgY2xhc3M9XCJub3RlLXBhbGV0dGUtdGl0bGVcIj4nICsgbGFuZy5jb2xvci5iYWNrZ3JvdW5kICsgJzwvZGl2PicsXG4gICAgICAgICAgICAgICAgJyAgPGRpdj4nLFxuICAgICAgICAgICAgICAgICcgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJub3RlLWNvbG9yLXJlc2V0IGJ0biBidG4tZGVmYXVsdFwiIGRhdGEtZXZlbnQ9XCJiYWNrQ29sb3JcIiBkYXRhLXZhbHVlPVwiaW5oZXJpdFwiPicsXG4gICAgICAgICAgICAgICAgbGFuZy5jb2xvci50cmFuc3BhcmVudCxcbiAgICAgICAgICAgICAgICAnICAgIDwvYnV0dG9uPicsXG4gICAgICAgICAgICAgICAgJyAgPC9kaXY+JyxcbiAgICAgICAgICAgICAgICAnICA8ZGl2IGNsYXNzPVwibm90ZS1ob2xkZXJcIiBkYXRhLWV2ZW50PVwiYmFja0NvbG9yXCIvPicsXG4gICAgICAgICAgICAgICAgJzwvZGl2PicsXG4gICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJidG4tZ3JvdXBcIj4nLFxuICAgICAgICAgICAgICAgICcgIDxkaXYgY2xhc3M9XCJub3RlLXBhbGV0dGUtdGl0bGVcIj4nICsgbGFuZy5jb2xvci5mb3JlZ3JvdW5kICsgJzwvZGl2PicsXG4gICAgICAgICAgICAgICAgJyAgPGRpdj4nLFxuICAgICAgICAgICAgICAgICcgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJub3RlLWNvbG9yLXJlc2V0IGJ0biBidG4tZGVmYXVsdFwiIGRhdGEtZXZlbnQ9XCJyZW1vdmVGb3JtYXRcIiBkYXRhLXZhbHVlPVwiZm9yZUNvbG9yXCI+JyxcbiAgICAgICAgICAgICAgICBsYW5nLmNvbG9yLnJlc2V0VG9EZWZhdWx0LFxuICAgICAgICAgICAgICAgICcgICAgPC9idXR0b24+JyxcbiAgICAgICAgICAgICAgICAnICA8L2Rpdj4nLFxuICAgICAgICAgICAgICAgICcgIDxkaXYgY2xhc3M9XCJub3RlLWhvbGRlclwiIGRhdGEtZXZlbnQ9XCJmb3JlQ29sb3JcIi8+JyxcbiAgICAgICAgICAgICAgICAnPC9kaXY+JyxcbiAgICAgICAgICAgICAgICAnPC9saT4nXG4gICAgICAgICAgICAgIF0uam9pbignJyksXG4gICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoJGRyb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgJGRyb3Bkb3duLmZpbmQoJy5ub3RlLWhvbGRlcicpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgdmFyICRob2xkZXIgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgJGhvbGRlci5hcHBlbmQodWkucGFsZXR0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGNvbG9yczogb3B0aW9ucy5jb2xvcnMsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50TmFtZTogJGhvbGRlci5kYXRhKCdldmVudCcpXG4gICAgICAgICAgICAgICAgICB9KS5yZW5kZXIoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgJGJ1dHRvbiA9ICQoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnROYW1lID0gJGJ1dHRvbi5kYXRhKCdldmVudCcpO1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICRidXR0b24uZGF0YSgndmFsdWUnKTtcblxuICAgICAgICAgICAgICAgIGlmIChldmVudE5hbWUgJiYgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldmVudE5hbWUgPT09ICdiYWNrQ29sb3InID8gJ2JhY2tncm91bmQtY29sb3InIDogJ2NvbG9yJztcbiAgICAgICAgICAgICAgICAgIHZhciAkY29sb3IgPSAkYnV0dG9uLmNsb3Nlc3QoJy5ub3RlLWNvbG9yJykuZmluZCgnLm5vdGUtcmVjZW50LWNvbG9yJyk7XG4gICAgICAgICAgICAgICAgICB2YXIgJGN1cnJlbnRCdXR0b24gPSAkYnV0dG9uLmNsb3Nlc3QoJy5ub3RlLWNvbG9yJykuZmluZCgnLm5vdGUtY3VycmVudC1jb2xvci1idXR0b24nKTtcblxuICAgICAgICAgICAgICAgICAgJGNvbG9yLmNzcyhrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICRjdXJyZW50QnV0dG9uLmF0dHIoJ2RhdGEtJyArIGV2ZW50TmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci4nICsgZXZlbnROYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF1cbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24udWwnLCAgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLnVub3JkZXJlZGxpc3QpLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcubGlzdHMudW5vcmRlcmVkICsgcmVwcmVzZW50U2hvcnRjdXQoJ2luc2VydFVub3JkZXJlZExpc3QnKSxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IuaW5zZXJ0VW5vcmRlcmVkTGlzdCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLm9sJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLm9yZGVyZWRsaXN0KSxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmxpc3RzLm9yZGVyZWQgKyByZXByZXNlbnRTaG9ydGN1dCgnaW5zZXJ0T3JkZXJlZExpc3QnKSxcbiAgICAgICAgICBjbGljazogIGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmluc2VydE9yZGVyZWRMaXN0JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgdmFyIGp1c3RpZnlMZWZ0ID0gdWkuYnV0dG9uKHtcbiAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5hbGlnbkxlZnQpLFxuICAgICAgICB0b29sdGlwOiBsYW5nLnBhcmFncmFwaC5sZWZ0ICsgcmVwcmVzZW50U2hvcnRjdXQoJ2p1c3RpZnlMZWZ0JyksXG4gICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5qdXN0aWZ5TGVmdCcpXG4gICAgICB9KTtcblxuICAgICAgdmFyIGp1c3RpZnlDZW50ZXIgPSB1aS5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmFsaWduQ2VudGVyKSxcbiAgICAgICAgdG9vbHRpcDogbGFuZy5wYXJhZ3JhcGguY2VudGVyICsgcmVwcmVzZW50U2hvcnRjdXQoJ2p1c3RpZnlDZW50ZXInKSxcbiAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmp1c3RpZnlDZW50ZXInKVxuICAgICAgfSk7XG5cbiAgICAgIHZhciBqdXN0aWZ5UmlnaHQgPSB1aS5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmFsaWduUmlnaHQpLFxuICAgICAgICB0b29sdGlwOiBsYW5nLnBhcmFncmFwaC5yaWdodCArIHJlcHJlc2VudFNob3J0Y3V0KCdqdXN0aWZ5UmlnaHQnKSxcbiAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmp1c3RpZnlSaWdodCcpXG4gICAgICB9KTtcblxuICAgICAgdmFyIGp1c3RpZnlGdWxsID0gdWkuYnV0dG9uKHtcbiAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5hbGlnbkp1c3RpZnkpLFxuICAgICAgICB0b29sdGlwOiBsYW5nLnBhcmFncmFwaC5qdXN0aWZ5ICsgcmVwcmVzZW50U2hvcnRjdXQoJ2p1c3RpZnlGdWxsJyksXG4gICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5qdXN0aWZ5RnVsbCcpXG4gICAgICB9KTtcblxuICAgICAgdmFyIG91dGRlbnQgPSB1aS5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLm91dGRlbnQpLFxuICAgICAgICB0b29sdGlwOiBsYW5nLnBhcmFncmFwaC5vdXRkZW50ICsgcmVwcmVzZW50U2hvcnRjdXQoJ291dGRlbnQnKSxcbiAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLm91dGRlbnQnKVxuICAgICAgfSk7XG5cbiAgICAgIHZhciBpbmRlbnQgPSB1aS5idXR0b24oe1xuICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmluZGVudCksXG4gICAgICAgIHRvb2x0aXA6IGxhbmcucGFyYWdyYXBoLmluZGVudCArIHJlcHJlc2VudFNob3J0Y3V0KCdpbmRlbnQnKSxcbiAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmluZGVudCcpXG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uanVzdGlmeUxlZnQnLCBmdW5jLmludm9rZShqdXN0aWZ5TGVmdCwgJ3JlbmRlcicpKTtcbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmp1c3RpZnlDZW50ZXInLCBmdW5jLmludm9rZShqdXN0aWZ5Q2VudGVyLCAncmVuZGVyJykpO1xuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uanVzdGlmeVJpZ2h0JywgZnVuYy5pbnZva2UoanVzdGlmeVJpZ2h0LCAncmVuZGVyJykpO1xuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uanVzdGlmeUZ1bGwnLCBmdW5jLmludm9rZShqdXN0aWZ5RnVsbCwgJ3JlbmRlcicpKTtcbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLm91dGRlbnQnLCBmdW5jLmludm9rZShvdXRkZW50LCAncmVuZGVyJykpO1xuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uaW5kZW50JywgZnVuYy5pbnZva2UoaW5kZW50LCAncmVuZGVyJykpO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5wYXJhZ3JhcGgnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b25Hcm91cChbXG4gICAgICAgICAgdWkuYnV0dG9uKHtcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2Ryb3Bkb3duLXRvZ2dsZScsXG4gICAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmFsaWduTGVmdCkgKyAnICcgKyB1aS5pY29uKG9wdGlvbnMuaWNvbnMuY2FyZXQsICdzcGFuJyksXG4gICAgICAgICAgICB0b29sdGlwOiBsYW5nLnBhcmFncmFwaC5wYXJhZ3JhcGgsXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHRvZ2dsZTogJ2Ryb3Bkb3duJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHVpLmRyb3Bkb3duKFtcbiAgICAgICAgICAgIHVpLmJ1dHRvbkdyb3VwKHtcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1hbGlnbicsXG4gICAgICAgICAgICAgIGNoaWxkcmVuOiBbanVzdGlmeUxlZnQsIGp1c3RpZnlDZW50ZXIsIGp1c3RpZnlSaWdodCwganVzdGlmeUZ1bGxdXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHVpLmJ1dHRvbkdyb3VwKHtcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1saXN0JyxcbiAgICAgICAgICAgICAgY2hpbGRyZW46IFtvdXRkZW50LCBpbmRlbnRdXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIF0pXG4gICAgICAgIF0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmhlaWdodCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbkdyb3VwKFtcbiAgICAgICAgICB1aS5idXR0b24oe1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tdG9nZ2xlJyxcbiAgICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMudGV4dEhlaWdodCkgKyAnICcgKyB1aS5pY29uKG9wdGlvbnMuaWNvbnMuY2FyZXQsICdzcGFuJyksXG4gICAgICAgICAgICB0b29sdGlwOiBsYW5nLmZvbnQuaGVpZ2h0LFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB0b2dnbGU6ICdkcm9wZG93bidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICB1aS5kcm9wZG93bkNoZWNrKHtcbiAgICAgICAgICAgIGl0ZW1zOiBvcHRpb25zLmxpbmVIZWlnaHRzLFxuICAgICAgICAgICAgY2hlY2tDbGFzc05hbWU6IG9wdGlvbnMuaWNvbnMubWVudUNoZWNrLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAnZHJvcGRvd24tbGluZS1oZWlnaHQnLFxuICAgICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmxpbmVIZWlnaHQnKVxuICAgICAgICAgIH0pXG4gICAgICAgIF0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLnRhYmxlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uR3JvdXAoW1xuICAgICAgICAgIHVpLmJ1dHRvbih7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdkcm9wZG93bi10b2dnbGUnLFxuICAgICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy50YWJsZSkgKyAnICcgKyB1aS5pY29uKG9wdGlvbnMuaWNvbnMuY2FyZXQsICdzcGFuJyksXG4gICAgICAgICAgICB0b29sdGlwOiBsYW5nLnRhYmxlLnRhYmxlLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICB0b2dnbGU6ICdkcm9wZG93bidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KSxcbiAgICAgICAgICB1aS5kcm9wZG93bih7XG4gICAgICAgICAgICBjbGFzc05hbWU6ICdub3RlLXRhYmxlJyxcbiAgICAgICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibm90ZS1kaW1lbnNpb24tcGlja2VyXCI+JyxcbiAgICAgICAgICAgICAgJyAgPGRpdiBjbGFzcz1cIm5vdGUtZGltZW5zaW9uLXBpY2tlci1tb3VzZWNhdGNoZXJcIiBkYXRhLWV2ZW50PVwiaW5zZXJ0VGFibGVcIiBkYXRhLXZhbHVlPVwiMXgxXCIvPicsXG4gICAgICAgICAgICAgICcgIDxkaXYgY2xhc3M9XCJub3RlLWRpbWVuc2lvbi1waWNrZXItaGlnaGxpZ2h0ZWRcIi8+JyxcbiAgICAgICAgICAgICAgJyAgPGRpdiBjbGFzcz1cIm5vdGUtZGltZW5zaW9uLXBpY2tlci11bmhpZ2hsaWdodGVkXCIvPicsXG4gICAgICAgICAgICAgICc8L2Rpdj4nLFxuICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm5vdGUtZGltZW5zaW9uLWRpc3BsYXlcIj4xIHggMTwvZGl2PidcbiAgICAgICAgICAgIF0uam9pbignJylcbiAgICAgICAgICB9KVxuICAgICAgICBdLCB7XG4gICAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICgkbm9kZSkge1xuICAgICAgICAgICAgdmFyICRjYXRjaGVyID0gJG5vZGUuZmluZCgnLm5vdGUtZGltZW5zaW9uLXBpY2tlci1tb3VzZWNhdGNoZXInKTtcbiAgICAgICAgICAgICRjYXRjaGVyLmNzcyh7XG4gICAgICAgICAgICAgIHdpZHRoOiBvcHRpb25zLmluc2VydFRhYmxlTWF4U2l6ZS5jb2wgKyAnZW0nLFxuICAgICAgICAgICAgICBoZWlnaHQ6IG9wdGlvbnMuaW5zZXJ0VGFibGVNYXhTaXplLnJvdyArICdlbSdcbiAgICAgICAgICAgIH0pLm1vdXNlZG93bihjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5pbnNlcnRUYWJsZScpKVxuICAgICAgICAgICAgICAub24oJ21vdXNlbW92ZScsIHNlbGYudGFibGVNb3ZlSGFuZGxlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5saW5rJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmxpbmspLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcubGluay5saW5rICsgcmVwcmVzZW50U2hvcnRjdXQoJ2xpbmtEaWFsb2cuc2hvdycpLFxuICAgICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2xpbmtEaWFsb2cuc2hvdycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLnBpY3R1cmUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMucGljdHVyZSksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5pbWFnZS5pbWFnZSxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdpbWFnZURpYWxvZy5zaG93JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24udmlkZW8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMudmlkZW8pLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcudmlkZW8udmlkZW8sXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcigndmlkZW9EaWFsb2cuc2hvdycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmhyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLm1pbnVzKSxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmhyLmluc2VydCArIHJlcHJlc2VudFNob3J0Y3V0KCdpbnNlcnRIb3Jpem9udGFsUnVsZScpLFxuICAgICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5pbnNlcnRIb3Jpem9udGFsUnVsZScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmZ1bGxzY3JlZW4nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2J0bi1mdWxsc2NyZWVuJyxcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmFycm93c0FsdCksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5vcHRpb25zLmZ1bGxzY3JlZW4sXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZnVsbHNjcmVlbi50b2dnbGUnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5jb2RldmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnYnRuLWNvZGV2aWV3JyxcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmNvZGUpLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcub3B0aW9ucy5jb2RldmlldyxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdjb2Rldmlldy50b2dnbGUnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5yZWRvJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLnJlZG8pLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuaGlzdG9yeS5yZWRvICsgcmVwcmVzZW50U2hvcnRjdXQoJ3JlZG8nKSxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVkbycpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLnVuZG8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMudW5kbyksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5oaXN0b3J5LnVuZG8gKyByZXByZXNlbnRTaG9ydGN1dCgndW5kbycpLFxuICAgICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci51bmRvJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uaGVscCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5xdWVzdGlvbiksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5vcHRpb25zLmhlbHAsXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignaGVscERpYWxvZy5zaG93JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogaW1hZ2UgOiBbXG4gICAgICogICBbJ2ltYWdlc2l6ZScsIFsnaW1hZ2VTaXplMTAwJywgJ2ltYWdlU2l6ZTUwJywgJ2ltYWdlU2l6ZTI1J11dLFxuICAgICAqICAgWydmbG9hdCcsIFsnZmxvYXRMZWZ0JywgJ2Zsb2F0UmlnaHQnLCAnZmxvYXROb25lJyBdXSxcbiAgICAgKiAgIFsncmVtb3ZlJywgWydyZW1vdmVNZWRpYSddXVxuICAgICAqIF0sXG4gICAgICovXG4gICAgdGhpcy5hZGRJbWFnZVBvcG92ZXJCdXR0b25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy8gSW1hZ2UgU2l6ZSBCdXR0b25zXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5pbWFnZVNpemUxMDAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiAnPHNwYW4gY2xhc3M9XCJub3RlLWZvbnRzaXplLTEwXCI+MTAwJTwvc3Bhbj4nLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuaW1hZ2UucmVzaXplRnVsbCxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVzaXplJywgJzEnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uaW1hZ2VTaXplNTAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAgdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogJzxzcGFuIGNsYXNzPVwibm90ZS1mb250c2l6ZS0xMFwiPjUwJTwvc3Bhbj4nLFxuICAgICAgICAgIHRvb2x0aXA6IGxhbmcuaW1hZ2UucmVzaXplSGFsZixcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdlZGl0b3IucmVzaXplJywgJzAuNScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5pbWFnZVNpemUyNScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6ICc8c3BhbiBjbGFzcz1cIm5vdGUtZm9udHNpemUtMTBcIj4yNSU8L3NwYW4+JyxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmltYWdlLnJlc2l6ZVF1YXJ0ZXIsXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLnJlc2l6ZScsICcwLjI1JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gRmxvYXQgQnV0dG9uc1xuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uZmxvYXRMZWZ0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmFsaWduTGVmdCksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5pbWFnZS5mbG9hdExlZnQsXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmZsb2F0TWUnLCAnbGVmdCcpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnRleHQubWVtbygnYnV0dG9uLmZsb2F0UmlnaHQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMuYWxpZ25SaWdodCksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5pbWFnZS5mbG9hdFJpZ2h0LFxuICAgICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci5mbG9hdE1lJywgJ3JpZ2h0JylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5tZW1vKCdidXR0b24uZmxvYXROb25lJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdWkuYnV0dG9uKHtcbiAgICAgICAgICBjb250ZW50czogdWkuaWNvbihvcHRpb25zLmljb25zLmFsaWduSnVzdGlmeSksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5pbWFnZS5mbG9hdE5vbmUsXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLmZsb2F0TWUnLCAnbm9uZScpXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFJlbW92ZSBCdXR0b25zXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5yZW1vdmVNZWRpYScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy50cmFzaCksXG4gICAgICAgICAgdG9vbHRpcDogbGFuZy5pbWFnZS5yZW1vdmUsXG4gICAgICAgICAgY2xpY2s6IGNvbnRleHQuY3JlYXRlSW52b2tlSGFuZGxlcignZWRpdG9yLnJlbW92ZU1lZGlhJylcbiAgICAgICAgfSkucmVuZGVyKCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5hZGRMaW5rUG9wb3ZlckJ1dHRvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi5saW5rRGlhbG9nU2hvdycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHVpLmJ1dHRvbih7XG4gICAgICAgICAgY29udGVudHM6IHVpLmljb24ob3B0aW9ucy5pY29ucy5saW5rKSxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmxpbmsuZWRpdCxcbiAgICAgICAgICBjbGljazogY29udGV4dC5jcmVhdGVJbnZva2VIYW5kbGVyKCdsaW5rRGlhbG9nLnNob3cnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb250ZXh0Lm1lbW8oJ2J1dHRvbi51bmxpbmsnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB1aS5idXR0b24oe1xuICAgICAgICAgIGNvbnRlbnRzOiB1aS5pY29uKG9wdGlvbnMuaWNvbnMudW5saW5rKSxcbiAgICAgICAgICB0b29sdGlwOiBsYW5nLmxpbmsudW5saW5rLFxuICAgICAgICAgIGNsaWNrOiBjb250ZXh0LmNyZWF0ZUludm9rZUhhbmRsZXIoJ2VkaXRvci51bmxpbmsnKVxuICAgICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB0aGlzLmJ1aWxkID0gZnVuY3Rpb24gKCRjb250YWluZXIsIGdyb3Vwcykge1xuICAgICAgZm9yICh2YXIgZ3JvdXBJZHggPSAwLCBncm91cExlbiA9IGdyb3Vwcy5sZW5ndGg7IGdyb3VwSWR4IDwgZ3JvdXBMZW47IGdyb3VwSWR4KyspIHtcbiAgICAgICAgdmFyIGdyb3VwID0gZ3JvdXBzW2dyb3VwSWR4XTtcbiAgICAgICAgdmFyIGdyb3VwTmFtZSA9IGdyb3VwWzBdO1xuICAgICAgICB2YXIgYnV0dG9ucyA9IGdyb3VwWzFdO1xuXG4gICAgICAgIHZhciAkZ3JvdXAgPSB1aS5idXR0b25Hcm91cCh7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS0nICsgZ3JvdXBOYW1lXG4gICAgICAgIH0pLnJlbmRlcigpO1xuXG4gICAgICAgIGZvciAodmFyIGlkeCA9IDAsIGxlbiA9IGJ1dHRvbnMubGVuZ3RoOyBpZHggPCBsZW47IGlkeCsrKSB7XG4gICAgICAgICAgdmFyIGJ1dHRvbiA9IGNvbnRleHQubWVtbygnYnV0dG9uLicgKyBidXR0b25zW2lkeF0pO1xuICAgICAgICAgIGlmIChidXR0b24pIHtcbiAgICAgICAgICAgICRncm91cC5hcHBlbmQodHlwZW9mIGJ1dHRvbiA9PT0gJ2Z1bmN0aW9uJyA/IGJ1dHRvbihjb250ZXh0KSA6IGJ1dHRvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgICRncm91cC5hcHBlbmRUbygkY29udGFpbmVyKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVDdXJyZW50U3R5bGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc3R5bGVJbmZvID0gY29udGV4dC5pbnZva2UoJ2VkaXRvci5jdXJyZW50U3R5bGUnKTtcbiAgICAgIHRoaXMudXBkYXRlQnRuU3RhdGVzKHtcbiAgICAgICAgJy5ub3RlLWJ0bi1ib2xkJzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzdHlsZUluZm9bJ2ZvbnQtYm9sZCddID09PSAnYm9sZCc7XG4gICAgICAgIH0sXG4gICAgICAgICcubm90ZS1idG4taXRhbGljJzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBzdHlsZUluZm9bJ2ZvbnQtaXRhbGljJ10gPT09ICdpdGFsaWMnO1xuICAgICAgICB9LFxuICAgICAgICAnLm5vdGUtYnRuLXVuZGVybGluZSc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gc3R5bGVJbmZvWydmb250LXVuZGVybGluZSddID09PSAndW5kZXJsaW5lJztcbiAgICAgICAgfSxcbiAgICAgICAgJy5ub3RlLWJ0bi1zdWJzY3JpcHQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlSW5mb1snZm9udC1zdWJzY3JpcHQnXSA9PT0gJ3N1YnNjcmlwdCc7XG4gICAgICAgIH0sXG4gICAgICAgICcubm90ZS1idG4tc3VwZXJzY3JpcHQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlSW5mb1snZm9udC1zdXBlcnNjcmlwdCddID09PSAnc3VwZXJzY3JpcHQnO1xuICAgICAgICB9LFxuICAgICAgICAnLm5vdGUtYnRuLXN0cmlrZXRocm91Z2gnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHN0eWxlSW5mb1snZm9udC1zdHJpa2V0aHJvdWdoJ10gPT09ICdzdHJpa2V0aHJvdWdoJztcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChzdHlsZUluZm9bJ2ZvbnQtZmFtaWx5J10pIHtcbiAgICAgICAgdmFyIGZvbnROYW1lcyA9IHN0eWxlSW5mb1snZm9udC1mYW1pbHknXS5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoL1tcXCdcXFwiXS9nLCAnJylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9cXHMrJC8sICcnKVxuICAgICAgICAgICAgLnJlcGxhY2UoL15cXHMrLywgJycpO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGZvbnROYW1lID0gbGlzdC5maW5kKGZvbnROYW1lcywgc2VsZi5pc0ZvbnRJbnN0YWxsZWQpO1xuXG4gICAgICAgICR0b29sYmFyLmZpbmQoJy5kcm9wZG93bi1mb250bmFtZSBsaSBhJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy8gYWx3YXlzIGNvbXBhcmUgc3RyaW5nIHRvIGF2b2lkIGNyZWF0aW5nIGFub3RoZXIgZnVuYy5cbiAgICAgICAgICB2YXIgaXNDaGVja2VkID0gKCQodGhpcykuZGF0YSgndmFsdWUnKSArICcnKSA9PT0gKGZvbnROYW1lICsgJycpO1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gaXNDaGVja2VkID8gJ2NoZWNrZWQnIDogJyc7XG4gICAgICAgIH0pO1xuICAgICAgICAkdG9vbGJhci5maW5kKCcubm90ZS1jdXJyZW50LWZvbnRuYW1lJykudGV4dChmb250TmFtZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdHlsZUluZm9bJ2ZvbnQtc2l6ZSddKSB7XG4gICAgICAgIHZhciBmb250U2l6ZSA9IHN0eWxlSW5mb1snZm9udC1zaXplJ107XG4gICAgICAgICR0b29sYmFyLmZpbmQoJy5kcm9wZG93bi1mb250c2l6ZSBsaSBhJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy8gYWx3YXlzIGNvbXBhcmUgd2l0aCBzdHJpbmcgdG8gYXZvaWQgY3JlYXRpbmcgYW5vdGhlciBmdW5jLlxuICAgICAgICAgIHZhciBpc0NoZWNrZWQgPSAoJCh0aGlzKS5kYXRhKCd2YWx1ZScpICsgJycpID09PSAoZm9udFNpemUgKyAnJyk7XG4gICAgICAgICAgdGhpcy5jbGFzc05hbWUgPSBpc0NoZWNrZWQgPyAnY2hlY2tlZCcgOiAnJztcbiAgICAgICAgfSk7XG4gICAgICAgICR0b29sYmFyLmZpbmQoJy5ub3RlLWN1cnJlbnQtZm9udHNpemUnKS50ZXh0KGZvbnRTaXplKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN0eWxlSW5mb1snbGluZS1oZWlnaHQnXSkge1xuICAgICAgICB2YXIgbGluZUhlaWdodCA9IHN0eWxlSW5mb1snbGluZS1oZWlnaHQnXTtcbiAgICAgICAgJHRvb2xiYXIuZmluZCgnLmRyb3Bkb3duLWxpbmUtaGVpZ2h0IGxpIGEnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAvLyBhbHdheXMgY29tcGFyZSB3aXRoIHN0cmluZyB0byBhdm9pZCBjcmVhdGluZyBhbm90aGVyIGZ1bmMuXG4gICAgICAgICAgdmFyIGlzQ2hlY2tlZCA9ICgkKHRoaXMpLmRhdGEoJ3ZhbHVlJykgKyAnJykgPT09IChsaW5lSGVpZ2h0ICsgJycpO1xuICAgICAgICAgIHRoaXMuY2xhc3NOYW1lID0gaXNDaGVja2VkID8gJ2NoZWNrZWQnIDogJyc7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZUJ0blN0YXRlcyA9IGZ1bmN0aW9uIChpbmZvcykge1xuICAgICAgJC5lYWNoKGluZm9zLCBmdW5jdGlvbiAoc2VsZWN0b3IsIHByZWQpIHtcbiAgICAgICAgdWkudG9nZ2xlQnRuQWN0aXZlKCR0b29sYmFyLmZpbmQoc2VsZWN0b3IpLCBwcmVkKCkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMudGFibGVNb3ZlSGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgdmFyIFBYX1BFUl9FTSA9IDE4O1xuICAgICAgdmFyICRwaWNrZXIgPSAkKGV2ZW50LnRhcmdldC5wYXJlbnROb2RlKTsgLy8gdGFyZ2V0IGlzIG1vdXNlY2F0Y2hlclxuICAgICAgdmFyICRkaW1lbnNpb25EaXNwbGF5ID0gJHBpY2tlci5uZXh0KCk7XG4gICAgICB2YXIgJGNhdGNoZXIgPSAkcGlja2VyLmZpbmQoJy5ub3RlLWRpbWVuc2lvbi1waWNrZXItbW91c2VjYXRjaGVyJyk7XG4gICAgICB2YXIgJGhpZ2hsaWdodGVkID0gJHBpY2tlci5maW5kKCcubm90ZS1kaW1lbnNpb24tcGlja2VyLWhpZ2hsaWdodGVkJyk7XG4gICAgICB2YXIgJHVuaGlnaGxpZ2h0ZWQgPSAkcGlja2VyLmZpbmQoJy5ub3RlLWRpbWVuc2lvbi1waWNrZXItdW5oaWdobGlnaHRlZCcpO1xuXG4gICAgICB2YXIgcG9zT2Zmc2V0O1xuICAgICAgLy8gSFRNTDUgd2l0aCBqUXVlcnkgLSBlLm9mZnNldFggaXMgdW5kZWZpbmVkIGluIEZpcmVmb3hcbiAgICAgIGlmIChldmVudC5vZmZzZXRYID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIHBvc0NhdGNoZXIgPSAkKGV2ZW50LnRhcmdldCkub2Zmc2V0KCk7XG4gICAgICAgIHBvc09mZnNldCA9IHtcbiAgICAgICAgICB4OiBldmVudC5wYWdlWCAtIHBvc0NhdGNoZXIubGVmdCxcbiAgICAgICAgICB5OiBldmVudC5wYWdlWSAtIHBvc0NhdGNoZXIudG9wXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwb3NPZmZzZXQgPSB7XG4gICAgICAgICAgeDogZXZlbnQub2Zmc2V0WCxcbiAgICAgICAgICB5OiBldmVudC5vZmZzZXRZXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHZhciBkaW0gPSB7XG4gICAgICAgIGM6IE1hdGguY2VpbChwb3NPZmZzZXQueCAvIFBYX1BFUl9FTSkgfHwgMSxcbiAgICAgICAgcjogTWF0aC5jZWlsKHBvc09mZnNldC55IC8gUFhfUEVSX0VNKSB8fCAxXG4gICAgICB9O1xuXG4gICAgICAkaGlnaGxpZ2h0ZWQuY3NzKHsgd2lkdGg6IGRpbS5jICsgJ2VtJywgaGVpZ2h0OiBkaW0uciArICdlbScgfSk7XG4gICAgICAkY2F0Y2hlci5kYXRhKCd2YWx1ZScsIGRpbS5jICsgJ3gnICsgZGltLnIpO1xuXG4gICAgICBpZiAoMyA8IGRpbS5jICYmIGRpbS5jIDwgb3B0aW9ucy5pbnNlcnRUYWJsZU1heFNpemUuY29sKSB7XG4gICAgICAgICR1bmhpZ2hsaWdodGVkLmNzcyh7IHdpZHRoOiBkaW0uYyArIDEgKyAnZW0nfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICgzIDwgZGltLnIgJiYgZGltLnIgPCBvcHRpb25zLmluc2VydFRhYmxlTWF4U2l6ZS5yb3cpIHtcbiAgICAgICAgJHVuaGlnaGxpZ2h0ZWQuY3NzKHsgaGVpZ2h0OiBkaW0uciArIDEgKyAnZW0nfSk7XG4gICAgICB9XG5cbiAgICAgICRkaW1lbnNpb25EaXNwbGF5Lmh0bWwoZGltLmMgKyAnIHggJyArIGRpbS5yKTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBUb29sYmFyID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgdWkgPSAkLnN1bW1lcm5vdGUudWk7XG5cbiAgICB2YXIgJG5vdGUgPSBjb250ZXh0LmxheW91dEluZm8ubm90ZTtcbiAgICB2YXIgJHRvb2xiYXIgPSBjb250ZXh0LmxheW91dEluZm8udG9vbGJhcjtcbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcblxuICAgIHRoaXMuc2hvdWxkSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAhb3B0aW9ucy5haXJNb2RlO1xuICAgIH07XG5cbiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBvcHRpb25zLnRvb2xiYXIgPSBvcHRpb25zLnRvb2xiYXIgfHwgW107XG5cbiAgICAgIGlmICghb3B0aW9ucy50b29sYmFyLmxlbmd0aCkge1xuICAgICAgICAkdG9vbGJhci5oaWRlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZXh0Lmludm9rZSgnYnV0dG9ucy5idWlsZCcsICR0b29sYmFyLCBvcHRpb25zLnRvb2xiYXIpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucy50b29sYmFyQ29udGFpbmVyKSB7XG4gICAgICAgICR0b29sYmFyLmFwcGVuZFRvKG9wdGlvbnMudG9vbGJhckNvbnRhaW5lcik7XG4gICAgICB9XG5cbiAgICAgICRub3RlLm9uKCdzdW1tZXJub3RlLmtleXVwIHN1bW1lcm5vdGUubW91c2V1cCBzdW1tZXJub3RlLmNoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2J1dHRvbnMudXBkYXRlQ3VycmVudFN0eWxlJyk7XG4gICAgICB9KTtcblxuICAgICAgY29udGV4dC5pbnZva2UoJ2J1dHRvbnMudXBkYXRlQ3VycmVudFN0eWxlJyk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICR0b29sYmFyLmNoaWxkcmVuKCkucmVtb3ZlKCk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlRnVsbHNjcmVlbiA9IGZ1bmN0aW9uIChpc0Z1bGxzY3JlZW4pIHtcbiAgICAgIHVpLnRvZ2dsZUJ0bkFjdGl2ZSgkdG9vbGJhci5maW5kKCcuYnRuLWZ1bGxzY3JlZW4nKSwgaXNGdWxsc2NyZWVuKTtcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGVDb2RldmlldyA9IGZ1bmN0aW9uIChpc0NvZGV2aWV3KSB7XG4gICAgICB1aS50b2dnbGVCdG5BY3RpdmUoJHRvb2xiYXIuZmluZCgnLmJ0bi1jb2RldmlldycpLCBpc0NvZGV2aWV3KTtcbiAgICAgIGlmIChpc0NvZGV2aWV3KSB7XG4gICAgICAgIHRoaXMuZGVhY3RpdmF0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmFjdGl2YXRlID0gZnVuY3Rpb24gKGlzSW5jbHVkZUNvZGV2aWV3KSB7XG4gICAgICB2YXIgJGJ0biA9ICR0b29sYmFyLmZpbmQoJ2J1dHRvbicpO1xuICAgICAgaWYgKCFpc0luY2x1ZGVDb2Rldmlldykge1xuICAgICAgICAkYnRuID0gJGJ0bi5ub3QoJy5idG4tY29kZXZpZXcnKTtcbiAgICAgIH1cbiAgICAgIHVpLnRvZ2dsZUJ0bigkYnRuLCB0cnVlKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZWFjdGl2YXRlID0gZnVuY3Rpb24gKGlzSW5jbHVkZUNvZGV2aWV3KSB7XG4gICAgICB2YXIgJGJ0biA9ICR0b29sYmFyLmZpbmQoJ2J1dHRvbicpO1xuICAgICAgaWYgKCFpc0luY2x1ZGVDb2Rldmlldykge1xuICAgICAgICAkYnRuID0gJGJ0bi5ub3QoJy5idG4tY29kZXZpZXcnKTtcbiAgICAgIH1cbiAgICAgIHVpLnRvZ2dsZUJ0bigkYnRuLCBmYWxzZSk7XG4gICAgfTtcbiAgfTtcblxuICB2YXIgTGlua0RpYWxvZyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB1aSA9ICQuc3VtbWVybm90ZS51aTtcblxuICAgIHZhciAkZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB2YXIgbGFuZyA9IG9wdGlvbnMubGFuZ0luZm87XG5cbiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJGNvbnRhaW5lciA9IG9wdGlvbnMuZGlhbG9nc0luQm9keSA/ICQoZG9jdW1lbnQuYm9keSkgOiAkZWRpdG9yO1xuXG4gICAgICB2YXIgYm9keSA9ICc8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPicgK1xuICAgICAgICAgICAgICAgICAgICc8bGFiZWw+JyArIGxhbmcubGluay50ZXh0VG9EaXNwbGF5ICsgJzwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz1cIm5vdGUtbGluay10ZXh0IGZvcm0tY29udHJvbFwiIHR5cGU9XCJ0ZXh0XCIgLz4nICtcbiAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj4nICtcbiAgICAgICAgICAgICAgICAgICAnPGxhYmVsPicgKyBsYW5nLmxpbmsudXJsICsgJzwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz1cIm5vdGUtbGluay11cmwgZm9ybS1jb250cm9sXCIgdHlwZT1cInRleHRcIiB2YWx1ZT1cImh0dHA6Ly9cIiAvPicgK1xuICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICghb3B0aW9ucy5kaXNhYmxlTGlua1RhcmdldCA/XG4gICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJjaGVja2JveFwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgJzxsYWJlbD4nICsgJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBjaGVja2VkPiAnICsgbGFuZy5saW5rLm9wZW5Jbk5ld1dpbmRvdyArICc8L2xhYmVsPicgK1xuICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nIDogJydcbiAgICAgICAgICAgICAgICAgKTtcbiAgICAgIHZhciBmb290ZXIgPSAnPGJ1dHRvbiBocmVmPVwiI1wiIGNsYXNzPVwiYnRuIC1kYXJrIG5vdGUtbGluay1idG4gZGlzYWJsZWRcIiBkaXNhYmxlZD4nICsgbGFuZy5saW5rLmluc2VydCArICc8L2J1dHRvbj4nO1xuXG4gICAgICB0aGlzLiRkaWFsb2cgPSB1aS5kaWFsb2coe1xuICAgICAgICBjbGFzc05hbWU6ICdsaW5rLWRpYWxvZycsXG4gICAgICAgIHRpdGxlOiBsYW5nLmxpbmsuaW5zZXJ0LFxuICAgICAgICBmYWRlOiBvcHRpb25zLmRpYWxvZ3NGYWRlLFxuICAgICAgICBib2R5OiBib2R5LFxuICAgICAgICBmb290ZXI6IGZvb3RlclxuICAgICAgfSkucmVuZGVyKCkuYXBwZW5kVG8oJGNvbnRhaW5lcik7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHVpLmhpZGVEaWFsb2codGhpcy4kZGlhbG9nKTtcbiAgICAgIHRoaXMuJGRpYWxvZy5yZW1vdmUoKTtcbiAgICB9O1xuXG4gICAgdGhpcy5iaW5kRW50ZXJLZXkgPSBmdW5jdGlvbiAoJGlucHV0LCAkYnRuKSB7XG4gICAgICAkaW5wdXQub24oJ2tleXByZXNzJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSBrZXkuY29kZS5FTlRFUikge1xuICAgICAgICAgICRidG4udHJpZ2dlcignY2xpY2snKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHRvZ2dsZSB1cGRhdGUgYnV0dG9uXG4gICAgICovXG4gICAgdGhpcy50b2dnbGVMaW5rQnRuID0gZnVuY3Rpb24gKCRsaW5rQnRuLCAkbGlua1RleHQsICRsaW5rVXJsKSB7XG4gICAgICB1aS50b2dnbGVCdG4oJGxpbmtCdG4sICRsaW5rVGV4dC52YWwoKSAmJiAkbGlua1VybC52YWwoKSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFNob3cgbGluayBkaWFsb2cgYW5kIHNldCBldmVudCBoYW5kbGVycyBvbiBkaWFsb2cgY29udHJvbHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gbGlua0luZm9cbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfVxuICAgICAqL1xuICAgIHRoaXMuc2hvd0xpbmtEaWFsb2cgPSBmdW5jdGlvbiAobGlua0luZm8pIHtcbiAgICAgIHJldHVybiAkLkRlZmVycmVkKGZ1bmN0aW9uIChkZWZlcnJlZCkge1xuICAgICAgICB2YXIgJGxpbmtUZXh0ID0gc2VsZi4kZGlhbG9nLmZpbmQoJy5ub3RlLWxpbmstdGV4dCcpLFxuICAgICAgICAkbGlua1VybCA9IHNlbGYuJGRpYWxvZy5maW5kKCcubm90ZS1saW5rLXVybCcpLFxuICAgICAgICAkbGlua0J0biA9IHNlbGYuJGRpYWxvZy5maW5kKCcubm90ZS1saW5rLWJ0bicpLFxuICAgICAgICAkb3BlbkluTmV3V2luZG93ID0gc2VsZi4kZGlhbG9nLmZpbmQoJ2lucHV0W3R5cGU9Y2hlY2tib3hdJyk7XG5cbiAgICAgICAgdWkub25EaWFsb2dTaG93bihzZWxmLiRkaWFsb2csIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjb250ZXh0LnRyaWdnZXJFdmVudCgnZGlhbG9nLnNob3duJyk7XG5cbiAgICAgICAgICAvLyBpZiBubyB1cmwgd2FzIGdpdmVuLCBjb3B5IHRleHQgdG8gdXJsXG4gICAgICAgICAgaWYgKCFsaW5rSW5mby51cmwpIHtcbiAgICAgICAgICAgIGxpbmtJbmZvLnVybCA9IGxpbmtJbmZvLnRleHQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJGxpbmtUZXh0LnZhbChsaW5rSW5mby50ZXh0KTtcblxuICAgICAgICAgIHZhciBoYW5kbGVMaW5rVGV4dFVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYudG9nZ2xlTGlua0J0bigkbGlua0J0biwgJGxpbmtUZXh0LCAkbGlua1VybCk7XG4gICAgICAgICAgICAvLyBpZiBsaW5rdGV4dCB3YXMgbW9kaWZpZWQgYnkga2V5dXAsXG4gICAgICAgICAgICAvLyBzdG9wIGNsb25pbmcgdGV4dCBmcm9tIGxpbmtVcmxcbiAgICAgICAgICAgIGxpbmtJbmZvLnRleHQgPSAkbGlua1RleHQudmFsKCk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgICRsaW5rVGV4dC5vbignaW5wdXQnLCBoYW5kbGVMaW5rVGV4dFVwZGF0ZSkub24oJ3Bhc3RlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgc2V0VGltZW91dChoYW5kbGVMaW5rVGV4dFVwZGF0ZSwgMCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB2YXIgaGFuZGxlTGlua1VybFVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHNlbGYudG9nZ2xlTGlua0J0bigkbGlua0J0biwgJGxpbmtUZXh0LCAkbGlua1VybCk7XG4gICAgICAgICAgICAvLyBkaXNwbGF5IHNhbWUgbGluayBvbiBgVGV4dCB0byBkaXNwbGF5YCBpbnB1dFxuICAgICAgICAgICAgLy8gd2hlbiBjcmVhdGUgYSBuZXcgbGlua1xuICAgICAgICAgICAgaWYgKCFsaW5rSW5mby50ZXh0KSB7XG4gICAgICAgICAgICAgICRsaW5rVGV4dC52YWwoJGxpbmtVcmwudmFsKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICAkbGlua1VybC5vbignaW5wdXQnLCBoYW5kbGVMaW5rVXJsVXBkYXRlKS5vbigncGFzdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGhhbmRsZUxpbmtVcmxVcGRhdGUsIDApO1xuICAgICAgICAgIH0pLnZhbChsaW5rSW5mby51cmwpLnRyaWdnZXIoJ2ZvY3VzJyk7XG5cbiAgICAgICAgICBzZWxmLnRvZ2dsZUxpbmtCdG4oJGxpbmtCdG4sICRsaW5rVGV4dCwgJGxpbmtVcmwpO1xuICAgICAgICAgIHNlbGYuYmluZEVudGVyS2V5KCRsaW5rVXJsLCAkbGlua0J0bik7XG4gICAgICAgICAgc2VsZi5iaW5kRW50ZXJLZXkoJGxpbmtUZXh0LCAkbGlua0J0bik7XG5cbiAgICAgICAgICAkb3BlbkluTmV3V2luZG93LnByb3AoJ2NoZWNrZWQnLCBsaW5rSW5mby5pc05ld1dpbmRvdyk7XG5cbiAgICAgICAgICAkbGlua0J0bi5vbmUoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHtcbiAgICAgICAgICAgICAgcmFuZ2U6IGxpbmtJbmZvLnJhbmdlLFxuICAgICAgICAgICAgICB1cmw6ICRsaW5rVXJsLnZhbCgpLFxuICAgICAgICAgICAgICB0ZXh0OiAkbGlua1RleHQudmFsKCksXG4gICAgICAgICAgICAgIGlzTmV3V2luZG93OiAkb3BlbkluTmV3V2luZG93LmlzKCc6Y2hlY2tlZCcpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlbGYuJGRpYWxvZy5tb2RhbCgnaGlkZScpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB1aS5vbkRpYWxvZ0hpZGRlbihzZWxmLiRkaWFsb2csIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAvLyBkZXRhY2ggZXZlbnRzXG4gICAgICAgICAgJGxpbmtUZXh0Lm9mZignaW5wdXQgcGFzdGUga2V5cHJlc3MnKTtcbiAgICAgICAgICAkbGlua1VybC5vZmYoJ2lucHV0IHBhc3RlIGtleXByZXNzJyk7XG4gICAgICAgICAgJGxpbmtCdG4ub2ZmKCdjbGljaycpO1xuXG4gICAgICAgICAgaWYgKGRlZmVycmVkLnN0YXRlKCkgPT09ICdwZW5kaW5nJykge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB1aS5zaG93RGlhbG9nKHNlbGYuJGRpYWxvZyk7XG4gICAgICB9KS5wcm9taXNlKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBsYXlvdXRJbmZvXG4gICAgICovXG4gICAgdGhpcy5zaG93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGxpbmtJbmZvID0gY29udGV4dC5pbnZva2UoJ2VkaXRvci5nZXRMaW5rSW5mbycpO1xuXG4gICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLnNhdmVSYW5nZScpO1xuICAgICAgdGhpcy5zaG93TGlua0RpYWxvZyhsaW5rSW5mbykudGhlbihmdW5jdGlvbiAobGlua0luZm8pIHtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5yZXN0b3JlUmFuZ2UnKTtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5jcmVhdGVMaW5rJywgbGlua0luZm8pO1xuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG4gICAgICB9KTtcbiAgICB9O1xuICAgIGNvbnRleHQubWVtbygnaGVscC5saW5rRGlhbG9nLnNob3cnLCBvcHRpb25zLmxhbmdJbmZvLmhlbHBbJ2xpbmtEaWFsb2cuc2hvdyddKTtcbiAgfTtcblxuICB2YXIgTGlua1BvcG92ZXIgPSBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgdWkgPSAkLnN1bW1lcm5vdGUudWk7XG5cbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcblxuICAgIHRoaXMuZXZlbnRzID0ge1xuICAgICAgJ3N1bW1lcm5vdGUua2V5dXAgc3VtbWVybm90ZS5tb3VzZXVwIHN1bW1lcm5vdGUuY2hhbmdlIHN1bW1lcm5vdGUuc2Nyb2xsJzogZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLnVwZGF0ZSgpO1xuICAgICAgfSxcbiAgICAgICdzdW1tZXJub3RlLmRpYWxvZy5zaG93bic6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi5oaWRlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc2hvdWxkSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAhbGlzdC5pc0VtcHR5KG9wdGlvbnMucG9wb3Zlci5saW5rKTtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcG9wb3ZlciA9IHVpLnBvcG92ZXIoe1xuICAgICAgICBjbGFzc05hbWU6ICdub3RlLWxpbmstcG9wb3ZlcicsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoJG5vZGUpIHtcbiAgICAgICAgICB2YXIgJGNvbnRlbnQgPSAkbm9kZS5maW5kKCcucG9wb3Zlci1jb250ZW50Jyk7XG4gICAgICAgICAgJGNvbnRlbnQucHJlcGVuZCgnPHNwYW4+PGEgdGFyZ2V0PVwiX2JsYW5rXCI+PC9hPiZuYnNwOzwvc3Bhbj4nKTtcbiAgICAgICAgfVxuICAgICAgfSkucmVuZGVyKCkuYXBwZW5kVG8oJ2JvZHknKTtcbiAgICAgIHZhciAkY29udGVudCA9IHRoaXMuJHBvcG92ZXIuZmluZCgnLnBvcG92ZXItY29udGVudCcpO1xuXG4gICAgICBjb250ZXh0Lmludm9rZSgnYnV0dG9ucy5idWlsZCcsICRjb250ZW50LCBvcHRpb25zLnBvcG92ZXIubGluayk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJHBvcG92ZXIucmVtb3ZlKCk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy8gUHJldmVudCBmb2N1c2luZyBvbiBlZGl0YWJsZSB3aGVuIGludm9rZSgnY29kZScpIGlzIGV4ZWN1dGVkXG4gICAgICBpZiAoIWNvbnRleHQuaW52b2tlKCdlZGl0b3IuaGFzRm9jdXMnKSkge1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgcm5nID0gY29udGV4dC5pbnZva2UoJ2VkaXRvci5jcmVhdGVSYW5nZScpO1xuICAgICAgaWYgKHJuZy5pc0NvbGxhcHNlZCgpICYmIHJuZy5pc09uQW5jaG9yKCkpIHtcbiAgICAgICAgdmFyIGFuY2hvciA9IGRvbS5hbmNlc3Rvcihybmcuc2MsIGRvbS5pc0FuY2hvcik7XG4gICAgICAgIHZhciBocmVmID0gJChhbmNob3IpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgdGhpcy4kcG9wb3Zlci5maW5kKCdhJykuYXR0cignaHJlZicsIGhyZWYpLmh0bWwoaHJlZik7XG5cbiAgICAgICAgdmFyIHBvcyA9IGRvbS5wb3NGcm9tUGxhY2Vob2xkZXIoYW5jaG9yKTtcbiAgICAgICAgdGhpcy4kcG9wb3Zlci5jc3Moe1xuICAgICAgICAgIGRpc3BsYXk6ICdibG9jaycsXG4gICAgICAgICAgbGVmdDogcG9zLmxlZnQsXG4gICAgICAgICAgdG9wOiBwb3MudG9wXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuaGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJHBvcG92ZXIuaGlkZSgpO1xuICAgIH07XG4gIH07XG5cbiAgdmFyIEltYWdlRGlhbG9nID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHVpID0gJC5zdW1tZXJub3RlLnVpO1xuXG4gICAgdmFyICRlZGl0b3IgPSBjb250ZXh0LmxheW91dEluZm8uZWRpdG9yO1xuICAgIHZhciBvcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuICAgIHZhciBsYW5nID0gb3B0aW9ucy5sYW5nSW5mbztcblxuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkY29udGFpbmVyID0gb3B0aW9ucy5kaWFsb2dzSW5Cb2R5ID8gJChkb2N1bWVudC5ib2R5KSA6ICRlZGl0b3I7XG5cbiAgICAgIHZhciBpbWFnZUxpbWl0YXRpb24gPSAnJztcbiAgICAgIGlmIChvcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplKSB7XG4gICAgICAgIHZhciB1bml0ID0gTWF0aC5mbG9vcihNYXRoLmxvZyhvcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplKSAvIE1hdGgubG9nKDEwMjQpKTtcbiAgICAgICAgdmFyIHJlYWRhYmxlU2l6ZSA9IChvcHRpb25zLm1heGltdW1JbWFnZUZpbGVTaXplIC8gTWF0aC5wb3coMTAyNCwgdW5pdCkpLnRvRml4ZWQoMikgKiAxICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICcgJyArICcgS01HVFAnW3VuaXRdICsgJ0InO1xuICAgICAgICBpbWFnZUxpbWl0YXRpb24gPSAnPHNtYWxsPicgKyBsYW5nLmltYWdlLm1heGltdW1GaWxlU2l6ZSArICcgOiAnICsgcmVhZGFibGVTaXplICsgJzwvc21hbGw+JztcbiAgICAgIH1cblxuICAgICAgdmFyIGJvZHkgPSAnPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXAgbm90ZS1ncm91cC1zZWxlY3QtZnJvbS1maWxlc1wiPicgK1xuICAgICAgICAgICAgICAgICAgICc8bGFiZWw+JyArIGxhbmcuaW1hZ2Uuc2VsZWN0RnJvbUZpbGVzICsgJzwvbGFiZWw+JyArXG4gICAgICAgICAgICAgICAgICAgJzxpbnB1dCBjbGFzcz1cIm5vdGUtaW1hZ2UtaW5wdXQgZm9ybS1jb250cm9sXCIgdHlwZT1cImZpbGVcIiBuYW1lPVwiZmlsZXNcIiBhY2NlcHQ9XCJpbWFnZS8qXCIgbXVsdGlwbGU9XCJtdWx0aXBsZVwiIC8+JyArXG4gICAgICAgICAgICAgICAgICAgaW1hZ2VMaW1pdGF0aW9uICtcbiAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXAgbm90ZS1ncm91cC1pbWFnZS11cmxcIiBzdHlsZT1cIm92ZXJmbG93OmF1dG87XCI+JyArXG4gICAgICAgICAgICAgICAgICAgJzxsYWJlbD4nICsgbGFuZy5pbWFnZS51cmwgKyAnPC9sYWJlbD4nICtcbiAgICAgICAgICAgICAgICAgICAnPGlucHV0IGNsYXNzPVwibm90ZS1pbWFnZS11cmwgZm9ybS1jb250cm9sIGNvbC1tZC0xMlwiIHR5cGU9XCJ0ZXh0XCIgLz4nICtcbiAgICAgICAgICAgICAgICAgJzwvZGl2Pic7XG4gICAgICB2YXIgZm9vdGVyID0gJzxidXR0b24gaHJlZj1cIiNcIiBjbGFzcz1cImJ0biAtZGFyayBub3RlLWltYWdlLWJ0biBkaXNhYmxlZFwiIGRpc2FibGVkPicgKyBsYW5nLmltYWdlLmluc2VydCArICc8L2J1dHRvbj4nO1xuXG4gICAgICB0aGlzLiRkaWFsb2cgPSB1aS5kaWFsb2coe1xuICAgICAgICB0aXRsZTogbGFuZy5pbWFnZS5pbnNlcnQsXG4gICAgICAgIGZhZGU6IG9wdGlvbnMuZGlhbG9nc0ZhZGUsXG4gICAgICAgIGJvZHk6IGJvZHksXG4gICAgICAgIGZvb3RlcjogZm9vdGVyXG4gICAgICB9KS5yZW5kZXIoKS5hcHBlbmRUbygkY29udGFpbmVyKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdWkuaGlkZURpYWxvZyh0aGlzLiRkaWFsb2cpO1xuICAgICAgdGhpcy4kZGlhbG9nLnJlbW92ZSgpO1xuICAgIH07XG5cbiAgICB0aGlzLmJpbmRFbnRlcktleSA9IGZ1bmN0aW9uICgkaW5wdXQsICRidG4pIHtcbiAgICAgICRpbnB1dC5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGtleS5jb2RlLkVOVEVSKSB7XG4gICAgICAgICAgJGJ0bi50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5zaG93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5zYXZlUmFuZ2UnKTtcbiAgICAgIHRoaXMuc2hvd0ltYWdlRGlhbG9nKCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAvLyBbd29ya2Fyb3VuZF0gaGlkZSBkaWFsb2cgYmVmb3JlIHJlc3RvcmUgcmFuZ2UgZm9yIElFIHJhbmdlIGZvY3VzXG4gICAgICAgIHVpLmhpZGVEaWFsb2coc2VsZi4kZGlhbG9nKTtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5yZXN0b3JlUmFuZ2UnKTtcblxuICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7IC8vIGltYWdlIHVybFxuICAgICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IuaW5zZXJ0SW1hZ2UnLCBkYXRhKTtcbiAgICAgICAgfSBlbHNlIHsgLy8gYXJyYXkgb2YgZmlsZXNcbiAgICAgICAgICBjb250ZXh0Lmludm9rZSgnZWRpdG9yLmluc2VydEltYWdlc09yQ2FsbGJhY2snLCBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogc2hvdyBpbWFnZSBkaWFsb2dcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkZGlhbG9nXG4gICAgICogQHJldHVybiB7UHJvbWlzZX1cbiAgICAgKi9cbiAgICB0aGlzLnNob3dJbWFnZURpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAkLkRlZmVycmVkKGZ1bmN0aW9uIChkZWZlcnJlZCkge1xuICAgICAgICB2YXIgJGltYWdlSW5wdXQgPSBzZWxmLiRkaWFsb2cuZmluZCgnLm5vdGUtaW1hZ2UtaW5wdXQnKSxcbiAgICAgICAgICAgICRpbWFnZVVybCA9IHNlbGYuJGRpYWxvZy5maW5kKCcubm90ZS1pbWFnZS11cmwnKSxcbiAgICAgICAgICAgICRpbWFnZUJ0biA9IHNlbGYuJGRpYWxvZy5maW5kKCcubm90ZS1pbWFnZS1idG4nKTtcblxuICAgICAgICB1aS5vbkRpYWxvZ1Nob3duKHNlbGYuJGRpYWxvZywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdkaWFsb2cuc2hvd24nKTtcblxuICAgICAgICAgIC8vIENsb25pbmcgaW1hZ2VJbnB1dCB0byBjbGVhciBlbGVtZW50LlxuICAgICAgICAgICRpbWFnZUlucHV0LnJlcGxhY2VXaXRoKCRpbWFnZUlucHV0LmNsb25lKClcbiAgICAgICAgICAgIC5vbignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRoaXMuZmlsZXMgfHwgdGhpcy52YWx1ZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnZhbCgnJylcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgJGltYWdlQnRuLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgkaW1hZ2VVcmwudmFsKCkpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgJGltYWdlVXJsLm9uKCdrZXl1cCBwYXN0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSAkaW1hZ2VVcmwudmFsKCk7XG4gICAgICAgICAgICB1aS50b2dnbGVCdG4oJGltYWdlQnRuLCB1cmwpO1xuICAgICAgICAgIH0pLnZhbCgnJykudHJpZ2dlcignZm9jdXMnKTtcbiAgICAgICAgICBzZWxmLmJpbmRFbnRlcktleSgkaW1hZ2VVcmwsICRpbWFnZUJ0bik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHVpLm9uRGlhbG9nSGlkZGVuKHNlbGYuJGRpYWxvZywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRpbWFnZUlucHV0Lm9mZignY2hhbmdlJyk7XG4gICAgICAgICAgJGltYWdlVXJsLm9mZigna2V5dXAgcGFzdGUga2V5cHJlc3MnKTtcbiAgICAgICAgICAkaW1hZ2VCdG4ub2ZmKCdjbGljaycpO1xuXG4gICAgICAgICAgaWYgKGRlZmVycmVkLnN0YXRlKCkgPT09ICdwZW5kaW5nJykge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB1aS5zaG93RGlhbG9nKHNlbGYuJGRpYWxvZyk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBJbWFnZVBvcG92ZXIgPSBmdW5jdGlvbiAoY29udGV4dCkge1xuICAgIHZhciB1aSA9ICQuc3VtbWVybm90ZS51aTtcblxuICAgIHZhciBvcHRpb25zID0gY29udGV4dC5vcHRpb25zO1xuXG4gICAgdGhpcy5zaG91bGRJbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuICFsaXN0LmlzRW1wdHkob3B0aW9ucy5wb3BvdmVyLmltYWdlKTtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcG9wb3ZlciA9IHVpLnBvcG92ZXIoe1xuICAgICAgICBjbGFzc05hbWU6ICdub3RlLWltYWdlLXBvcG92ZXInXG4gICAgICB9KS5yZW5kZXIoKS5hcHBlbmRUbygnYm9keScpO1xuICAgICAgdmFyICRjb250ZW50ID0gdGhpcy4kcG9wb3Zlci5maW5kKCcucG9wb3Zlci1jb250ZW50Jyk7XG5cbiAgICAgIGNvbnRleHQuaW52b2tlKCdidXR0b25zLmJ1aWxkJywgJGNvbnRlbnQsIG9wdGlvbnMucG9wb3Zlci5pbWFnZSk7XG4gICAgfTtcblxuICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJHBvcG92ZXIucmVtb3ZlKCk7XG4gICAgfTtcblxuICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgICAgaWYgKGRvbS5pc0ltZyh0YXJnZXQpKSB7XG4gICAgICAgIHZhciBwb3MgPSBkb20ucG9zRnJvbVBsYWNlaG9sZGVyKHRhcmdldCk7XG4gICAgICAgIHRoaXMuJHBvcG92ZXIuY3NzKHtcbiAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICAgIHRvcDogcG9zLnRvcFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyLmhpZGUoKTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBWaWRlb0RpYWxvZyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB1aSA9ICQuc3VtbWVybm90ZS51aTtcblxuICAgIHZhciAkZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB2YXIgbGFuZyA9IG9wdGlvbnMubGFuZ0luZm87XG5cbiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJGNvbnRhaW5lciA9IG9wdGlvbnMuZGlhbG9nc0luQm9keSA/ICQoZG9jdW1lbnQuYm9keSkgOiAkZWRpdG9yO1xuXG4gICAgICB2YXIgYm9keSA9ICc8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cCByb3ctZmx1aWRcIj4nICtcbiAgICAgICAgICAnPGxhYmVsPicgKyBsYW5nLnZpZGVvLnVybCArICcgPHNtYWxsIGNsYXNzPVwidGV4dC1tdXRlZFwiPicgKyBsYW5nLnZpZGVvLnByb3ZpZGVycyArICc8L3NtYWxsPjwvbGFiZWw+JyArXG4gICAgICAgICAgJzxpbnB1dCBjbGFzcz1cIm5vdGUtdmlkZW8tdXJsIGZvcm0tY29udHJvbCBzcGFuMTJcIiB0eXBlPVwidGV4dFwiIC8+JyArXG4gICAgICAgICAgJzwvZGl2Pic7XG4gICAgICB2YXIgZm9vdGVyID0gJzxidXR0b24gaHJlZj1cIiNcIiBjbGFzcz1cImJ0biAtZGFyayBub3RlLXZpZGVvLWJ0biBkaXNhYmxlZFwiIGRpc2FibGVkPicgKyBsYW5nLnZpZGVvLmluc2VydCArICc8L2J1dHRvbj4nO1xuXG4gICAgICB0aGlzLiRkaWFsb2cgPSB1aS5kaWFsb2coe1xuICAgICAgICB0aXRsZTogbGFuZy52aWRlby5pbnNlcnQsXG4gICAgICAgIGZhZGU6IG9wdGlvbnMuZGlhbG9nc0ZhZGUsXG4gICAgICAgIGJvZHk6IGJvZHksXG4gICAgICAgIGZvb3RlcjogZm9vdGVyXG4gICAgICB9KS5yZW5kZXIoKS5hcHBlbmRUbygkY29udGFpbmVyKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdWkuaGlkZURpYWxvZyh0aGlzLiRkaWFsb2cpO1xuICAgICAgdGhpcy4kZGlhbG9nLnJlbW92ZSgpO1xuICAgIH07XG5cbiAgICB0aGlzLmJpbmRFbnRlcktleSA9IGZ1bmN0aW9uICgkaW5wdXQsICRidG4pIHtcbiAgICAgICRpbnB1dC5vbigna2V5cHJlc3MnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IGtleS5jb2RlLkVOVEVSKSB7XG4gICAgICAgICAgJGJ0bi50cmlnZ2VyKCdjbGljaycpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5jcmVhdGVWaWRlb05vZGUgPSBmdW5jdGlvbiAodXJsKSB7XG4gICAgICAvLyB2aWRlbyB1cmwgcGF0dGVybnMoeW91dHViZSwgaW5zdGFncmFtLCB2aW1lbywgZGFpbHltb3Rpb24sIHlvdWt1LCBtcDQsIG9nZywgd2VibSlcbiAgICAgIHZhciB5dFJlZ0V4cCA9IC9eKD86aHR0cHM/OlxcL1xcLyk/KD86d3d3XFwuKT8oPzp5b3V0dVxcLmJlXFwvfHlvdXR1YmVcXC5jb21cXC8oPzplbWJlZFxcL3x2XFwvfHdhdGNoXFw/dj18d2F0Y2hcXD8uKyZ2PSkpKChcXHd8LSl7MTF9KSg/OlxcUyspPyQvO1xuICAgICAgdmFyIHl0TWF0Y2ggPSB1cmwubWF0Y2goeXRSZWdFeHApO1xuXG4gICAgICB2YXIgaWdSZWdFeHAgPSAvKD86d3d3XFwufFxcL1xcLylpbnN0YWdyYW1cXC5jb21cXC9wXFwvKC5bYS16QS1aMC05Xy1dKikvO1xuICAgICAgdmFyIGlnTWF0Y2ggPSB1cmwubWF0Y2goaWdSZWdFeHApO1xuXG4gICAgICB2YXIgdlJlZ0V4cCA9IC9cXC9cXC92aW5lXFwuY29cXC92XFwvKFthLXpBLVowLTldKykvO1xuICAgICAgdmFyIHZNYXRjaCA9IHVybC5tYXRjaCh2UmVnRXhwKTtcblxuICAgICAgdmFyIHZpbVJlZ0V4cCA9IC9cXC9cXC8ocGxheWVyXFwuKT92aW1lb1xcLmNvbVxcLyhbYS16XSpcXC8pKihbMC05XXs2LDExfSlbP10/LiovO1xuICAgICAgdmFyIHZpbU1hdGNoID0gdXJsLm1hdGNoKHZpbVJlZ0V4cCk7XG5cbiAgICAgIHZhciBkbVJlZ0V4cCA9IC8uK2RhaWx5bW90aW9uLmNvbVxcLyh2aWRlb3xodWIpXFwvKFteX10rKVteI10qKCN2aWRlbz0oW15fJl0rKSk/LztcbiAgICAgIHZhciBkbU1hdGNoID0gdXJsLm1hdGNoKGRtUmVnRXhwKTtcblxuICAgICAgdmFyIHlvdWt1UmVnRXhwID0gL1xcL1xcL3ZcXC55b3VrdVxcLmNvbVxcL3Zfc2hvd1xcL2lkXyhcXHcrKT0qXFwuaHRtbC87XG4gICAgICB2YXIgeW91a3VNYXRjaCA9IHVybC5tYXRjaCh5b3VrdVJlZ0V4cCk7XG5cbiAgICAgIHZhciBtcDRSZWdFeHAgPSAvXi4rLihtcDR8bTR2KSQvO1xuICAgICAgdmFyIG1wNE1hdGNoID0gdXJsLm1hdGNoKG1wNFJlZ0V4cCk7XG5cbiAgICAgIHZhciBvZ2dSZWdFeHAgPSAvXi4rLihvZ2d8b2d2KSQvO1xuICAgICAgdmFyIG9nZ01hdGNoID0gdXJsLm1hdGNoKG9nZ1JlZ0V4cCk7XG5cbiAgICAgIHZhciB3ZWJtUmVnRXhwID0gL14uKy4od2VibSkkLztcbiAgICAgIHZhciB3ZWJtTWF0Y2ggPSB1cmwubWF0Y2god2VibVJlZ0V4cCk7XG5cbiAgICAgIHZhciAkdmlkZW87XG4gICAgICBpZiAoeXRNYXRjaCAmJiB5dE1hdGNoWzFdLmxlbmd0aCA9PT0gMTEpIHtcbiAgICAgICAgdmFyIHlvdXR1YmVJZCA9IHl0TWF0Y2hbMV07XG4gICAgICAgICR2aWRlbyA9ICQoJzxpZnJhbWU+JylcbiAgICAgICAgICAgIC5hdHRyKCdmcmFtZWJvcmRlcicsIDApXG4gICAgICAgICAgICAuYXR0cignc3JjJywgJy8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLycgKyB5b3V0dWJlSWQpXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCAnNjQwJykuYXR0cignaGVpZ2h0JywgJzM2MCcpO1xuICAgICAgfSBlbHNlIGlmIChpZ01hdGNoICYmIGlnTWF0Y2hbMF0ubGVuZ3RoKSB7XG4gICAgICAgICR2aWRlbyA9ICQoJzxpZnJhbWU+JylcbiAgICAgICAgICAgIC5hdHRyKCdmcmFtZWJvcmRlcicsIDApXG4gICAgICAgICAgICAuYXR0cignc3JjJywgJ2h0dHBzOi8vaW5zdGFncmFtLmNvbS9wLycgKyBpZ01hdGNoWzFdICsgJy9lbWJlZC8nKVxuICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgJzYxMicpLmF0dHIoJ2hlaWdodCcsICc3MTAnKVxuICAgICAgICAgICAgLmF0dHIoJ3Njcm9sbGluZycsICdubycpXG4gICAgICAgICAgICAuYXR0cignYWxsb3d0cmFuc3BhcmVuY3knLCAndHJ1ZScpO1xuICAgICAgfSBlbHNlIGlmICh2TWF0Y2ggJiYgdk1hdGNoWzBdLmxlbmd0aCkge1xuICAgICAgICAkdmlkZW8gPSAkKCc8aWZyYW1lPicpXG4gICAgICAgICAgICAuYXR0cignZnJhbWVib3JkZXInLCAwKVxuICAgICAgICAgICAgLmF0dHIoJ3NyYycsIHZNYXRjaFswXSArICcvZW1iZWQvc2ltcGxlJylcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICc2MDAnKS5hdHRyKCdoZWlnaHQnLCAnNjAwJylcbiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICd2aW5lLWVtYmVkJyk7XG4gICAgICB9IGVsc2UgaWYgKHZpbU1hdGNoICYmIHZpbU1hdGNoWzNdLmxlbmd0aCkge1xuICAgICAgICAkdmlkZW8gPSAkKCc8aWZyYW1lIHdlYmtpdGFsbG93ZnVsbHNjcmVlbiBtb3phbGxvd2Z1bGxzY3JlZW4gYWxsb3dmdWxsc2NyZWVuPicpXG4gICAgICAgICAgICAuYXR0cignZnJhbWVib3JkZXInLCAwKVxuICAgICAgICAgICAgLmF0dHIoJ3NyYycsICcvL3BsYXllci52aW1lby5jb20vdmlkZW8vJyArIHZpbU1hdGNoWzNdKVxuICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgJzY0MCcpLmF0dHIoJ2hlaWdodCcsICczNjAnKTtcbiAgICAgIH0gZWxzZSBpZiAoZG1NYXRjaCAmJiBkbU1hdGNoWzJdLmxlbmd0aCkge1xuICAgICAgICAkdmlkZW8gPSAkKCc8aWZyYW1lPicpXG4gICAgICAgICAgICAuYXR0cignZnJhbWVib3JkZXInLCAwKVxuICAgICAgICAgICAgLmF0dHIoJ3NyYycsICcvL3d3dy5kYWlseW1vdGlvbi5jb20vZW1iZWQvdmlkZW8vJyArIGRtTWF0Y2hbMl0pXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCAnNjQwJykuYXR0cignaGVpZ2h0JywgJzM2MCcpO1xuICAgICAgfSBlbHNlIGlmICh5b3VrdU1hdGNoICYmIHlvdWt1TWF0Y2hbMV0ubGVuZ3RoKSB7XG4gICAgICAgICR2aWRlbyA9ICQoJzxpZnJhbWUgd2Via2l0YWxsb3dmdWxsc2NyZWVuIG1vemFsbG93ZnVsbHNjcmVlbiBhbGxvd2Z1bGxzY3JlZW4+JylcbiAgICAgICAgICAgIC5hdHRyKCdmcmFtZWJvcmRlcicsIDApXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgJzQ5OCcpXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCAnNTEwJylcbiAgICAgICAgICAgIC5hdHRyKCdzcmMnLCAnLy9wbGF5ZXIueW91a3UuY29tL2VtYmVkLycgKyB5b3VrdU1hdGNoWzFdKTtcbiAgICAgIH0gZWxzZSBpZiAobXA0TWF0Y2ggfHwgb2dnTWF0Y2ggfHwgd2VibU1hdGNoKSB7XG4gICAgICAgICR2aWRlbyA9ICQoJzx2aWRlbyBjb250cm9scz4nKVxuICAgICAgICAgICAgLmF0dHIoJ3NyYycsIHVybClcbiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsICc2NDAnKS5hdHRyKCdoZWlnaHQnLCAnMzYwJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyB0aGlzIGlzIG5vdCBhIGtub3duIHZpZGVvIGxpbmsuIE5vdyB3aGF0LCBDYXQ/IE5vdyB3aGF0P1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgICR2aWRlby5hZGRDbGFzcygnbm90ZS12aWRlby1jbGlwJyk7XG5cbiAgICAgIHJldHVybiAkdmlkZW9bMF07XG4gICAgfTtcblxuICAgIHRoaXMuc2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ZXh0ID0gY29udGV4dC5pbnZva2UoJ2VkaXRvci5nZXRTZWxlY3RlZFRleHQnKTtcbiAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3Iuc2F2ZVJhbmdlJyk7XG4gICAgICB0aGlzLnNob3dWaWRlb0RpYWxvZyh0ZXh0KS50aGVuKGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgICAgLy8gW3dvcmthcm91bmRdIGhpZGUgZGlhbG9nIGJlZm9yZSByZXN0b3JlIHJhbmdlIGZvciBJRSByYW5nZSBmb2N1c1xuICAgICAgICB1aS5oaWRlRGlhbG9nKHNlbGYuJGRpYWxvZyk7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG5cbiAgICAgICAgLy8gYnVpbGQgbm9kZVxuICAgICAgICB2YXIgJG5vZGUgPSBzZWxmLmNyZWF0ZVZpZGVvTm9kZSh1cmwpO1xuXG4gICAgICAgIGlmICgkbm9kZSkge1xuICAgICAgICAgIC8vIGluc2VydCB2aWRlbyBub2RlXG4gICAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5pbnNlcnROb2RlJywgJG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5yZXN0b3JlUmFuZ2UnKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBzaG93IGltYWdlIGRpYWxvZ1xuICAgICAqXG4gICAgICogQHBhcmFtIHtqUXVlcnl9ICRkaWFsb2dcbiAgICAgKiBAcmV0dXJuIHtQcm9taXNlfVxuICAgICAqL1xuICAgIHRoaXMuc2hvd1ZpZGVvRGlhbG9nID0gZnVuY3Rpb24gKHRleHQpIHtcbiAgICAgIHJldHVybiAkLkRlZmVycmVkKGZ1bmN0aW9uIChkZWZlcnJlZCkge1xuICAgICAgICB2YXIgJHZpZGVvVXJsID0gc2VsZi4kZGlhbG9nLmZpbmQoJy5ub3RlLXZpZGVvLXVybCcpLFxuICAgICAgICAgICAgJHZpZGVvQnRuID0gc2VsZi4kZGlhbG9nLmZpbmQoJy5ub3RlLXZpZGVvLWJ0bicpO1xuXG4gICAgICAgIHVpLm9uRGlhbG9nU2hvd24oc2VsZi4kZGlhbG9nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29udGV4dC50cmlnZ2VyRXZlbnQoJ2RpYWxvZy5zaG93bicpO1xuXG4gICAgICAgICAgJHZpZGVvVXJsLnZhbCh0ZXh0KS5vbignaW5wdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1aS50b2dnbGVCdG4oJHZpZGVvQnRuLCAkdmlkZW9VcmwudmFsKCkpO1xuICAgICAgICAgIH0pLnRyaWdnZXIoJ2ZvY3VzJyk7XG5cbiAgICAgICAgICAkdmlkZW9CdG4uY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCR2aWRlb1VybC52YWwoKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBzZWxmLmJpbmRFbnRlcktleSgkdmlkZW9VcmwsICR2aWRlb0J0bik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHVpLm9uRGlhbG9nSGlkZGVuKHNlbGYuJGRpYWxvZywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICR2aWRlb1VybC5vZmYoJ2lucHV0Jyk7XG4gICAgICAgICAgJHZpZGVvQnRuLm9mZignY2xpY2snKTtcblxuICAgICAgICAgIGlmIChkZWZlcnJlZC5zdGF0ZSgpID09PSAncGVuZGluZycpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdWkuc2hvd0RpYWxvZyhzZWxmLiRkaWFsb2cpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfTtcblxuICB2YXIgSGVscERpYWxvZyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB1aSA9ICQuc3VtbWVybm90ZS51aTtcblxuICAgIHZhciAkZWRpdG9yID0gY29udGV4dC5sYXlvdXRJbmZvLmVkaXRvcjtcbiAgICB2YXIgb3B0aW9ucyA9IGNvbnRleHQub3B0aW9ucztcbiAgICB2YXIgbGFuZyA9IG9wdGlvbnMubGFuZ0luZm87XG5cbiAgICB0aGlzLmNyZWF0ZVNob3J0Q3V0TGlzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBrZXlNYXAgPSBvcHRpb25zLmtleU1hcFthZ2VudC5pc01hYyA/ICdtYWMnIDogJ3BjJ107XG4gICAgICByZXR1cm4gT2JqZWN0LmtleXMoa2V5TWFwKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgY29tbWFuZCA9IGtleU1hcFtrZXldO1xuICAgICAgICB2YXIgJHJvdyA9ICQoJzxkaXY+PGRpdiBjbGFzcz1cImhlbHAtbGlzdC1pdGVtXCIvPjwvZGl2PicpO1xuICAgICAgICAkcm93LmFwcGVuZCgkKCc8bGFiZWw+PGtiZD4nICsga2V5ICsgJzwva2RiPjwvbGFiZWw+JykuY3NzKHtcbiAgICAgICAgICAnd2lkdGgnOiAxODAsXG4gICAgICAgICAgJ21hcmdpbi1yaWdodCc6IDEwXG4gICAgICAgIH0pKS5hcHBlbmQoJCgnPHNwYW4vPicpLmh0bWwoY29udGV4dC5tZW1vKCdoZWxwLicgKyBjb21tYW5kKSB8fCBjb21tYW5kKSk7XG4gICAgICAgIHJldHVybiAkcm93Lmh0bWwoKTtcbiAgICAgIH0pLmpvaW4oJycpO1xuICAgIH07XG5cbiAgICB0aGlzLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJGNvbnRhaW5lciA9IG9wdGlvbnMuZGlhbG9nc0luQm9keSA/ICQoZG9jdW1lbnQuYm9keSkgOiAkZWRpdG9yO1xuXG4gICAgICB2YXIgYm9keSA9IFtcbiAgICAgICAgJzxwIGNsYXNzPVwidGV4dC1jZW50ZXJcIj4nLFxuICAgICAgICAnPGEgaHJlZj1cImh0dHA6Ly9zdW1tZXJub3RlLm9yZy9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5TdW1tZXJub3RlIDAuOC4yPC9hPiDCtyAnLFxuICAgICAgICAnPGEgaHJlZj1cImh0dHBzOi8vZ2l0aHViLmNvbS9zdW1tZXJub3RlL3N1bW1lcm5vdGVcIiB0YXJnZXQ9XCJfYmxhbmtcIj5Qcm9qZWN0PC9hPiDCtyAnLFxuICAgICAgICAnPGEgaHJlZj1cImh0dHBzOi8vZ2l0aHViLmNvbS9zdW1tZXJub3RlL3N1bW1lcm5vdGUvaXNzdWVzXCIgdGFyZ2V0PVwiX2JsYW5rXCI+SXNzdWVzPC9hPicsXG4gICAgICAgICc8L3A+J1xuICAgICAgXS5qb2luKCcnKTtcblxuICAgICAgdGhpcy4kZGlhbG9nID0gdWkuZGlhbG9nKHtcbiAgICAgICAgdGl0bGU6IGxhbmcub3B0aW9ucy5oZWxwLFxuICAgICAgICBmYWRlOiBvcHRpb25zLmRpYWxvZ3NGYWRlLFxuICAgICAgICBib2R5OiB0aGlzLmNyZWF0ZVNob3J0Q3V0TGlzdCgpLFxuICAgICAgICBmb290ZXI6IGJvZHksXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoJG5vZGUpIHtcbiAgICAgICAgICAkbm9kZS5maW5kKCcubW9kYWwtYm9keScpLmNzcyh7XG4gICAgICAgICAgICAnbWF4LWhlaWdodCc6IDMwMCxcbiAgICAgICAgICAgICdvdmVyZmxvdyc6ICdzY3JvbGwnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pLnJlbmRlcigpLmFwcGVuZFRvKCRjb250YWluZXIpO1xuICAgIH07XG5cbiAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB1aS5oaWRlRGlhbG9nKHRoaXMuJGRpYWxvZyk7XG4gICAgICB0aGlzLiRkaWFsb2cucmVtb3ZlKCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIHNob3cgaGVscCBkaWFsb2dcbiAgICAgKlxuICAgICAqIEByZXR1cm4ge1Byb21pc2V9XG4gICAgICovXG4gICAgdGhpcy5zaG93SGVscERpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAkLkRlZmVycmVkKGZ1bmN0aW9uIChkZWZlcnJlZCkge1xuICAgICAgICB1aS5vbkRpYWxvZ1Nob3duKHNlbGYuJGRpYWxvZywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNvbnRleHQudHJpZ2dlckV2ZW50KCdkaWFsb2cuc2hvd24nKTtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICB1aS5zaG93RGlhbG9nKHNlbGYuJGRpYWxvZyk7XG4gICAgICB9KS5wcm9taXNlKCk7XG4gICAgfTtcblxuICAgIHRoaXMuc2hvdyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3Iuc2F2ZVJhbmdlJyk7XG4gICAgICB0aGlzLnNob3dIZWxwRGlhbG9nKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnRleHQuaW52b2tlKCdlZGl0b3IucmVzdG9yZVJhbmdlJyk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBBaXJQb3BvdmVyID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIHVpID0gJC5zdW1tZXJub3RlLnVpO1xuXG4gICAgdmFyIG9wdGlvbnMgPSBjb250ZXh0Lm9wdGlvbnM7XG5cbiAgICB2YXIgQUlSX01PREVfUE9QT1ZFUl9YX09GRlNFVCA9IDIwO1xuXG4gICAgdGhpcy5ldmVudHMgPSB7XG4gICAgICAnc3VtbWVybm90ZS5rZXl1cCBzdW1tZXJub3RlLm1vdXNldXAgc3VtbWVybm90ZS5zY3JvbGwnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYudXBkYXRlKCk7XG4gICAgICB9LFxuICAgICAgJ3N1bW1lcm5vdGUuY2hhbmdlIHN1bW1lcm5vdGUuZGlhbG9nLnNob3duJzogZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmhpZGUoKTtcbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5mb2N1c291dCc6IGZ1bmN0aW9uICh3ZSwgZSkge1xuICAgICAgICAvLyBbd29ya2Fyb3VuZF0gRmlyZWZveCBkb2Vzbid0IHN1cHBvcnQgcmVsYXRlZFRhcmdldCBvbiBmb2N1c291dFxuICAgICAgICAvLyAgLSBJZ25vcmUgaGlkZSBhY3Rpb24gb24gZm9jdXMgb3V0IGluIEZGLlxuICAgICAgICBpZiAoYWdlbnQuaXNGRikge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZS5yZWxhdGVkVGFyZ2V0IHx8ICFkb20uYW5jZXN0b3IoZS5yZWxhdGVkVGFyZ2V0LCBmdW5jLmVxKHNlbGYuJHBvcG92ZXJbMF0pKSkge1xuICAgICAgICAgIHNlbGYuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc2hvdWxkSW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBvcHRpb25zLmFpck1vZGUgJiYgIWxpc3QuaXNFbXB0eShvcHRpb25zLnBvcG92ZXIuYWlyKTtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcG9wb3ZlciA9IHVpLnBvcG92ZXIoe1xuICAgICAgICBjbGFzc05hbWU6ICdub3RlLWFpci1wb3BvdmVyJ1xuICAgICAgfSkucmVuZGVyKCkuYXBwZW5kVG8oJ2JvZHknKTtcbiAgICAgIHZhciAkY29udGVudCA9IHRoaXMuJHBvcG92ZXIuZmluZCgnLnBvcG92ZXItY29udGVudCcpO1xuXG4gICAgICBjb250ZXh0Lmludm9rZSgnYnV0dG9ucy5idWlsZCcsICRjb250ZW50LCBvcHRpb25zLnBvcG92ZXIuYWlyKTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5yZW1vdmUoKTtcbiAgICB9O1xuXG4gICAgdGhpcy51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc3R5bGVJbmZvID0gY29udGV4dC5pbnZva2UoJ2VkaXRvci5jdXJyZW50U3R5bGUnKTtcbiAgICAgIGlmIChzdHlsZUluZm8ucmFuZ2UgJiYgIXN0eWxlSW5mby5yYW5nZS5pc0NvbGxhcHNlZCgpKSB7XG4gICAgICAgIHZhciByZWN0ID0gbGlzdC5sYXN0KHN0eWxlSW5mby5yYW5nZS5nZXRDbGllbnRSZWN0cygpKTtcbiAgICAgICAgaWYgKHJlY3QpIHtcbiAgICAgICAgICB2YXIgYm5kID0gZnVuYy5yZWN0MmJuZChyZWN0KTtcbiAgICAgICAgICB0aGlzLiRwb3BvdmVyLmNzcyh7XG4gICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxuICAgICAgICAgICAgbGVmdDogTWF0aC5tYXgoYm5kLmxlZnQgKyBibmQud2lkdGggLyAyLCAwKSAtIEFJUl9NT0RFX1BPUE9WRVJfWF9PRkZTRVQsXG4gICAgICAgICAgICB0b3A6IGJuZC50b3AgKyBibmQuaGVpZ2h0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaGlkZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmhpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLiRwb3BvdmVyLmhpZGUoKTtcbiAgICB9O1xuICB9O1xuXG4gIHZhciBIaW50UG9wb3ZlciA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciB1aSA9ICQuc3VtbWVybm90ZS51aTtcblxuICAgIHZhciBQT1BPVkVSX0RJU1QgPSA1O1xuICAgIHZhciBoaW50ID0gY29udGV4dC5vcHRpb25zLmhpbnQgfHwgW107XG4gICAgdmFyIGRpcmVjdGlvbiA9IGNvbnRleHQub3B0aW9ucy5oaW50RGlyZWN0aW9uIHx8ICdib3R0b20nO1xuICAgIHZhciBoaW50cyA9ICQuaXNBcnJheShoaW50KSA/IGhpbnQgOiBbaGludF07XG5cbiAgICB0aGlzLmV2ZW50cyA9IHtcbiAgICAgICdzdW1tZXJub3RlLmtleXVwJzogZnVuY3Rpb24gKHdlLCBlKSB7XG4gICAgICAgIGlmICghZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgIHNlbGYuaGFuZGxlS2V5dXAoZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5rZXlkb3duJzogZnVuY3Rpb24gKHdlLCBlKSB7XG4gICAgICAgIHNlbGYuaGFuZGxlS2V5ZG93bihlKTtcbiAgICAgIH0sXG4gICAgICAnc3VtbWVybm90ZS5kaWFsb2cuc2hvd24nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuaGlkZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnNob3VsZEluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gaGludHMubGVuZ3RoID4gMDtcbiAgICB9O1xuXG4gICAgdGhpcy5pbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5sYXN0V29yZFJhbmdlID0gbnVsbDtcbiAgICAgIHRoaXMuJHBvcG92ZXIgPSB1aS5wb3BvdmVyKHtcbiAgICAgICAgY2xhc3NOYW1lOiAnbm90ZS1oaW50LXBvcG92ZXInLFxuICAgICAgICBoaWRlQXJyb3c6IHRydWUsXG4gICAgICAgIGRpcmVjdGlvbjogJydcbiAgICAgIH0pLnJlbmRlcigpLmFwcGVuZFRvKCdib2R5Jyk7XG5cbiAgICAgIHRoaXMuJHBvcG92ZXIuaGlkZSgpO1xuXG4gICAgICB0aGlzLiRjb250ZW50ID0gdGhpcy4kcG9wb3Zlci5maW5kKCcucG9wb3Zlci1jb250ZW50Jyk7XG5cbiAgICAgIHRoaXMuJGNvbnRlbnQub24oJ2NsaWNrJywgJy5ub3RlLWhpbnQtaXRlbScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi4kY29udGVudC5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgc2VsZi5yZXBsYWNlKCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5yZW1vdmUoKTtcbiAgICB9O1xuXG4gICAgdGhpcy5zZWxlY3RJdGVtID0gZnVuY3Rpb24gKCRpdGVtKSB7XG4gICAgICB0aGlzLiRjb250ZW50LmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAkaXRlbS5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgIHRoaXMuJGNvbnRlbnRbMF0uc2Nyb2xsVG9wID0gJGl0ZW1bMF0ub2Zmc2V0VG9wIC0gKHRoaXMuJGNvbnRlbnQuaW5uZXJIZWlnaHQoKSAvIDIpO1xuICAgIH07XG5cbiAgICB0aGlzLm1vdmVEb3duID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyICRjdXJyZW50ID0gdGhpcy4kY29udGVudC5maW5kKCcubm90ZS1oaW50LWl0ZW0uYWN0aXZlJyk7XG4gICAgICB2YXIgJG5leHQgPSAkY3VycmVudC5uZXh0KCk7XG5cbiAgICAgIGlmICgkbmV4dC5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RJdGVtKCRuZXh0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciAkbmV4dEdyb3VwID0gJGN1cnJlbnQucGFyZW50KCkubmV4dCgpO1xuXG4gICAgICAgIGlmICghJG5leHRHcm91cC5sZW5ndGgpIHtcbiAgICAgICAgICAkbmV4dEdyb3VwID0gdGhpcy4kY29udGVudC5maW5kKCcubm90ZS1oaW50LWdyb3VwJykuZmlyc3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbSgkbmV4dEdyb3VwLmZpbmQoJy5ub3RlLWhpbnQtaXRlbScpLmZpcnN0KCkpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLm1vdmVVcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkY3VycmVudCA9IHRoaXMuJGNvbnRlbnQuZmluZCgnLm5vdGUtaGludC1pdGVtLmFjdGl2ZScpO1xuICAgICAgdmFyICRwcmV2ID0gJGN1cnJlbnQucHJldigpO1xuXG4gICAgICBpZiAoJHByZXYubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbSgkcHJldik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgJHByZXZHcm91cCA9ICRjdXJyZW50LnBhcmVudCgpLnByZXYoKTtcblxuICAgICAgICBpZiAoISRwcmV2R3JvdXAubGVuZ3RoKSB7XG4gICAgICAgICAgJHByZXZHcm91cCA9IHRoaXMuJGNvbnRlbnQuZmluZCgnLm5vdGUtaGludC1ncm91cCcpLmxhc3QoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbSgkcHJldkdyb3VwLmZpbmQoJy5ub3RlLWhpbnQtaXRlbScpLmxhc3QoKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMucmVwbGFjZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkaXRlbSA9IHRoaXMuJGNvbnRlbnQuZmluZCgnLm5vdGUtaGludC1pdGVtLmFjdGl2ZScpO1xuXG4gICAgICBpZiAoJGl0ZW0ubGVuZ3RoKSB7XG4gICAgICAgIHZhciBub2RlID0gdGhpcy5ub2RlRnJvbUl0ZW0oJGl0ZW0pO1xuICAgICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UuaW5zZXJ0Tm9kZShub2RlKTtcbiAgICAgICAgcmFuZ2UuY3JlYXRlRnJvbU5vZGUobm9kZSkuY29sbGFwc2UoKS5zZWxlY3QoKTtcblxuICAgICAgICB0aGlzLmxhc3RXb3JkUmFuZ2UgPSBudWxsO1xuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgY29udGV4dC5pbnZva2UoJ2VkaXRvci5mb2N1cycpO1xuICAgICAgfVxuXG4gICAgfTtcblxuICAgIHRoaXMubm9kZUZyb21JdGVtID0gZnVuY3Rpb24gKCRpdGVtKSB7XG4gICAgICB2YXIgaGludCA9IGhpbnRzWyRpdGVtLmRhdGEoJ2luZGV4JyldO1xuICAgICAgdmFyIGl0ZW0gPSAkaXRlbS5kYXRhKCdpdGVtJyk7XG4gICAgICB2YXIgbm9kZSA9IGhpbnQuY29udGVudCA/IGhpbnQuY29udGVudChpdGVtKSA6IGl0ZW07XG4gICAgICBpZiAodHlwZW9mIG5vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIG5vZGUgPSBkb20uY3JlYXRlVGV4dChub2RlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBub2RlO1xuICAgIH07XG5cbiAgICB0aGlzLmNyZWF0ZUl0ZW1UZW1wbGF0ZXMgPSBmdW5jdGlvbiAoaGludElkeCwgaXRlbXMpIHtcbiAgICAgIHZhciBoaW50ID0gaGludHNbaGludElkeF07XG4gICAgICByZXR1cm4gaXRlbXMubWFwKGZ1bmN0aW9uIChpdGVtLCBpZHgpIHtcbiAgICAgICAgdmFyICRpdGVtID0gJCgnPGRpdiBjbGFzcz1cIm5vdGUtaGludC1pdGVtXCIvPicpO1xuICAgICAgICAkaXRlbS5hcHBlbmQoaGludC50ZW1wbGF0ZSA/IGhpbnQudGVtcGxhdGUoaXRlbSkgOiBpdGVtICsgJycpO1xuICAgICAgICAkaXRlbS5kYXRhKHtcbiAgICAgICAgICAnaW5kZXgnOiBoaW50SWR4LFxuICAgICAgICAgICdpdGVtJzogaXRlbVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoaGludElkeCA9PT0gMCAmJiBpZHggPT09IDApIHtcbiAgICAgICAgICAkaXRlbS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRpdGVtO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHRoaXMuaGFuZGxlS2V5ZG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoIXRoaXMuJHBvcG92ZXIuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoZS5rZXlDb2RlID09PSBrZXkuY29kZS5FTlRFUikge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMucmVwbGFjZSgpO1xuICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT09IGtleS5jb2RlLlVQKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5tb3ZlVXAoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09PSBrZXkuY29kZS5ET1dOKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5tb3ZlRG93bigpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnNlYXJjaEtleXdvcmQgPSBmdW5jdGlvbiAoaW5kZXgsIGtleXdvcmQsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgaGludCA9IGhpbnRzW2luZGV4XTtcbiAgICAgIGlmIChoaW50ICYmIGhpbnQubWF0Y2gudGVzdChrZXl3b3JkKSAmJiBoaW50LnNlYXJjaCkge1xuICAgICAgICB2YXIgbWF0Y2hlcyA9IGhpbnQubWF0Y2guZXhlYyhrZXl3b3JkKTtcbiAgICAgICAgaGludC5zZWFyY2gobWF0Y2hlc1sxXSwgY2FsbGJhY2spO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5jcmVhdGVHcm91cCA9IGZ1bmN0aW9uIChpZHgsIGtleXdvcmQpIHtcbiAgICAgIHZhciAkZ3JvdXAgPSAkKCc8ZGl2IGNsYXNzPVwibm90ZS1oaW50LWdyb3VwIG5vdGUtaGludC1ncm91cC0nICsgaWR4ICsgJ1wiLz4nKTtcbiAgICAgIHRoaXMuc2VhcmNoS2V5d29yZChpZHgsIGtleXdvcmQsIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICBpdGVtcyA9IGl0ZW1zIHx8IFtdO1xuICAgICAgICBpZiAoaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgICAgJGdyb3VwLmh0bWwoc2VsZi5jcmVhdGVJdGVtVGVtcGxhdGVzKGlkeCwgaXRlbXMpKTtcbiAgICAgICAgICBzZWxmLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiAkZ3JvdXA7XG4gICAgfTtcblxuICAgIHRoaXMuaGFuZGxlS2V5dXAgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGxpc3QuY29udGFpbnMoW2tleS5jb2RlLkVOVEVSLCBrZXkuY29kZS5VUCwga2V5LmNvZGUuRE9XTl0sIGUua2V5Q29kZSkpIHtcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0ga2V5LmNvZGUuRU5URVIpIHtcbiAgICAgICAgICBpZiAodGhpcy4kcG9wb3Zlci5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHdvcmRSYW5nZSA9IGNvbnRleHQuaW52b2tlKCdlZGl0b3IuY3JlYXRlUmFuZ2UnKS5nZXRXb3JkUmFuZ2UoKTtcbiAgICAgICAgdmFyIGtleXdvcmQgPSB3b3JkUmFuZ2UudG9TdHJpbmcoKTtcbiAgICAgICAgaWYgKGhpbnRzLmxlbmd0aCAmJiBrZXl3b3JkKSB7XG4gICAgICAgICAgdGhpcy4kY29udGVudC5lbXB0eSgpO1xuXG4gICAgICAgICAgdmFyIGJuZCA9IGZ1bmMucmVjdDJibmQobGlzdC5sYXN0KHdvcmRSYW5nZS5nZXRDbGllbnRSZWN0cygpKSk7XG4gICAgICAgICAgaWYgKGJuZCkge1xuXG4gICAgICAgICAgICB0aGlzLiRwb3BvdmVyLmhpZGUoKTtcblxuICAgICAgICAgICAgdGhpcy5sYXN0V29yZFJhbmdlID0gd29yZFJhbmdlO1xuXG4gICAgICAgICAgICBoaW50cy5mb3JFYWNoKGZ1bmN0aW9uIChoaW50LCBpZHgpIHtcbiAgICAgICAgICAgICAgaWYgKGhpbnQubWF0Y2gudGVzdChrZXl3b3JkKSkge1xuICAgICAgICAgICAgICAgIHNlbGYuY3JlYXRlR3JvdXAoaWR4LCBrZXl3b3JkKS5hcHBlbmRUbyhzZWxmLiRjb250ZW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHNldCBwb3NpdGlvbiBmb3IgcG9wb3ZlciBhZnRlciBncm91cCBpcyBjcmVhdGVkXG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndG9wJykge1xuICAgICAgICAgICAgICB0aGlzLiRwb3BvdmVyLmNzcyh7XG4gICAgICAgICAgICAgICAgbGVmdDogYm5kLmxlZnQsXG4gICAgICAgICAgICAgICAgdG9wOiBibmQudG9wIC0gdGhpcy4kcG9wb3Zlci5vdXRlckhlaWdodCgpIC0gUE9QT1ZFUl9ESVNUXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy4kcG9wb3Zlci5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQ6IGJuZC5sZWZ0LFxuICAgICAgICAgICAgICAgIHRvcDogYm5kLnRvcCArIGJuZC5oZWlnaHQgKyBQT1BPVkVSX0RJU1RcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5zaG93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy4kcG9wb3Zlci5zaG93KCk7XG4gICAgfTtcblxuICAgIHRoaXMuaGlkZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJHBvcG92ZXIuaGlkZSgpO1xuICAgIH07XG4gIH07XG5cblxuICAkLnN1bW1lcm5vdGUgPSAkLmV4dGVuZCgkLnN1bW1lcm5vdGUsIHtcbiAgICB2ZXJzaW9uOiAnMC44LjInLFxuICAgIHVpOiB1aSxcbiAgICBkb206IGRvbSxcblxuICAgIHBsdWdpbnM6IHt9LFxuXG4gICAgb3B0aW9uczoge1xuICAgICAgbW9kdWxlczoge1xuICAgICAgICAnZWRpdG9yJzogRWRpdG9yLFxuICAgICAgICAnY2xpcGJvYXJkJzogQ2xpcGJvYXJkLFxuICAgICAgICAnZHJvcHpvbmUnOiBEcm9wem9uZSxcbiAgICAgICAgJ2NvZGV2aWV3JzogQ29kZXZpZXcsXG4gICAgICAgICdzdGF0dXNiYXInOiBTdGF0dXNiYXIsXG4gICAgICAgICdmdWxsc2NyZWVuJzogRnVsbHNjcmVlbixcbiAgICAgICAgJ2hhbmRsZSc6IEhhbmRsZSxcbiAgICAgICAgLy8gRklYTUU6IEhpbnRQb3BvdmVyIG11c3QgYmUgZnJvbnQgb2YgYXV0b2xpbmtcbiAgICAgICAgLy8gIC0gU2NyaXB0IGVycm9yIGFib3V0IHJhbmdlIHdoZW4gRW50ZXIga2V5IGlzIHByZXNzZWQgb24gaGludCBwb3BvdmVyXG4gICAgICAgICdoaW50UG9wb3Zlcic6IEhpbnRQb3BvdmVyLFxuICAgICAgICAnYXV0b0xpbmsnOiBBdXRvTGluayxcbiAgICAgICAgJ2F1dG9TeW5jJzogQXV0b1N5bmMsXG4gICAgICAgICdwbGFjZWhvbGRlcic6IFBsYWNlaG9sZGVyLFxuICAgICAgICAnYnV0dG9ucyc6IEJ1dHRvbnMsXG4gICAgICAgICd0b29sYmFyJzogVG9vbGJhcixcbiAgICAgICAgJ2xpbmtEaWFsb2cnOiBMaW5rRGlhbG9nLFxuICAgICAgICAnbGlua1BvcG92ZXInOiBMaW5rUG9wb3ZlcixcbiAgICAgICAgJ2ltYWdlRGlhbG9nJzogSW1hZ2VEaWFsb2csXG4gICAgICAgICdpbWFnZVBvcG92ZXInOiBJbWFnZVBvcG92ZXIsXG4gICAgICAgICd2aWRlb0RpYWxvZyc6IFZpZGVvRGlhbG9nLFxuICAgICAgICAnaGVscERpYWxvZyc6IEhlbHBEaWFsb2csXG4gICAgICAgICdhaXJQb3BvdmVyJzogQWlyUG9wb3ZlclxuICAgICAgfSxcblxuICAgICAgYnV0dG9uczoge30sXG5cbiAgICAgIGxhbmc6ICdlbi1VUycsXG5cbiAgICAgIC8vIHRvb2xiYXJcbiAgICAgIHRvb2xiYXI6IFtcbiAgICAgICAgWydzdHlsZScsIFsnc3R5bGUnXV0sXG4gICAgICAgIFsnZm9udCcsIFsnYm9sZCcsICd1bmRlcmxpbmUnLCAnY2xlYXInXV0sXG4gICAgICAgIFsnZm9udG5hbWUnLCBbJ2ZvbnRuYW1lJ11dLFxuICAgICAgICBbJ2NvbG9yJywgWydjb2xvciddXSxcbiAgICAgICAgWydwYXJhJywgWyd1bCcsICdvbCcsICdwYXJhZ3JhcGgnXV0sXG4gICAgICAgIFsndGFibGUnLCBbJ3RhYmxlJ11dLFxuICAgICAgICBbJ2luc2VydCcsIFsnbGluaycsICdwaWN0dXJlJywgJ3ZpZGVvJ11dLFxuICAgICAgICBbJ3ZpZXcnLCBbJ2Z1bGxzY3JlZW4nLCAnY29kZXZpZXcnLCAnaGVscCddXVxuICAgICAgXSxcblxuICAgICAgLy8gcG9wb3ZlclxuICAgICAgcG9wb3Zlcjoge1xuICAgICAgICBpbWFnZTogW1xuICAgICAgICAgIFsnaW1hZ2VzaXplJywgWydpbWFnZVNpemUxMDAnLCAnaW1hZ2VTaXplNTAnLCAnaW1hZ2VTaXplMjUnXV0sXG4gICAgICAgICAgWydmbG9hdCcsIFsnZmxvYXRMZWZ0JywgJ2Zsb2F0UmlnaHQnLCAnZmxvYXROb25lJ11dLFxuICAgICAgICAgIFsncmVtb3ZlJywgWydyZW1vdmVNZWRpYSddXVxuICAgICAgICBdLFxuICAgICAgICBsaW5rOiBbXG4gICAgICAgICAgWydsaW5rJywgWydsaW5rRGlhbG9nU2hvdycsICd1bmxpbmsnXV1cbiAgICAgICAgXSxcbiAgICAgICAgYWlyOiBbXG4gICAgICAgICAgWydjb2xvcicsIFsnY29sb3InXV0sXG4gICAgICAgICAgWydmb250JywgWydib2xkJywgJ3VuZGVybGluZScsICdjbGVhciddXSxcbiAgICAgICAgICBbJ3BhcmEnLCBbJ3VsJywgJ3BhcmFncmFwaCddXSxcbiAgICAgICAgICBbJ3RhYmxlJywgWyd0YWJsZSddXSxcbiAgICAgICAgICBbJ2luc2VydCcsIFsnbGluaycsICdwaWN0dXJlJ11dXG4gICAgICAgIF1cbiAgICAgIH0sXG5cbiAgICAgIC8vIGFpciBtb2RlOiBpbmxpbmUgZWRpdG9yXG4gICAgICBhaXJNb2RlOiBmYWxzZSxcblxuICAgICAgd2lkdGg6IG51bGwsXG4gICAgICBoZWlnaHQ6IG51bGwsXG5cbiAgICAgIGZvY3VzOiBmYWxzZSxcbiAgICAgIHRhYlNpemU6IDQsXG4gICAgICBzdHlsZVdpdGhTcGFuOiB0cnVlLFxuICAgICAgc2hvcnRjdXRzOiB0cnVlLFxuICAgICAgdGV4dGFyZWFBdXRvU3luYzogdHJ1ZSxcbiAgICAgIGRpcmVjdGlvbjogbnVsbCxcblxuICAgICAgc3R5bGVUYWdzOiBbJ3AnLCAnYmxvY2txdW90ZScsICdwcmUnLCAnaDEnLCAnaDInLCAnaDMnLCAnaDQnLCAnaDUnLCAnaDYnXSxcblxuICAgICAgZm9udE5hbWVzOiBbXG4gICAgICAgICdBcmlhbCcsICdBcmlhbCBCbGFjaycsICdDb21pYyBTYW5zIE1TJywgJ0NvdXJpZXIgTmV3JyxcbiAgICAgICAgJ0hlbHZldGljYSBOZXVlJywgJ0hlbHZldGljYScsICdJbXBhY3QnLCAnTHVjaWRhIEdyYW5kZScsXG4gICAgICAgICdUYWhvbWEnLCAnVGltZXMgTmV3IFJvbWFuJywgJ1ZlcmRhbmEnXG4gICAgICBdLFxuXG4gICAgICBmb250U2l6ZXM6IFsnOCcsICc5JywgJzEwJywgJzExJywgJzEyJywgJzE0JywgJzE4JywgJzI0JywgJzM2J10sXG5cbiAgICAgIC8vIHBhbGxldGUgY29sb3JzKG4geCBuKVxuICAgICAgY29sb3JzOiBbXG4gICAgICAgIFsnIzAwMDAwMCcsICcjNDI0MjQyJywgJyM2MzYzNjMnLCAnIzlDOUM5NCcsICcjQ0VDNkNFJywgJyNFRkVGRUYnLCAnI0Y3RjdGNycsICcjRkZGRkZGJ10sXG4gICAgICAgIFsnI0ZGMDAwMCcsICcjRkY5QzAwJywgJyNGRkZGMDAnLCAnIzAwRkYwMCcsICcjMDBGRkZGJywgJyMwMDAwRkYnLCAnIzlDMDBGRicsICcjRkYwMEZGJ10sXG4gICAgICAgIFsnI0Y3QzZDRScsICcjRkZFN0NFJywgJyNGRkVGQzYnLCAnI0Q2RUZENicsICcjQ0VERUU3JywgJyNDRUU3RjcnLCAnI0Q2RDZFNycsICcjRTdENkRFJ10sXG4gICAgICAgIFsnI0U3OUM5QycsICcjRkZDNjlDJywgJyNGRkU3OUMnLCAnI0I1RDZBNScsICcjQTVDNkNFJywgJyM5Q0M2RUYnLCAnI0I1QTVENicsICcjRDZBNUJEJ10sXG4gICAgICAgIFsnI0U3NjM2MycsICcjRjdBRDZCJywgJyNGRkQ2NjMnLCAnIzk0QkQ3QicsICcjNzNBNUFEJywgJyM2QkFEREUnLCAnIzhDN0JDNicsICcjQzY3QkE1J10sXG4gICAgICAgIFsnI0NFMDAwMCcsICcjRTc5NDM5JywgJyNFRkM2MzEnLCAnIzZCQTU0QScsICcjNEE3QjhDJywgJyMzOTg0QzYnLCAnIzYzNEFBNScsICcjQTU0QTdCJ10sXG4gICAgICAgIFsnIzlDMDAwMCcsICcjQjU2MzA4JywgJyNCRDk0MDAnLCAnIzM5N0IyMScsICcjMTA0QTVBJywgJyMwODUyOTQnLCAnIzMxMTg3MycsICcjNzMxODQyJ10sXG4gICAgICAgIFsnIzYzMDAwMCcsICcjN0IzOTAwJywgJyM4NDYzMDAnLCAnIzI5NTIxOCcsICcjMDgzMTM5JywgJyMwMDMxNjMnLCAnIzIxMTA0QScsICcjNEExMDMxJ11cbiAgICAgIF0sXG5cbiAgICAgIGxpbmVIZWlnaHRzOiBbJzEuMCcsICcxLjInLCAnMS40JywgJzEuNScsICcxLjYnLCAnMS44JywgJzIuMCcsICczLjAnXSxcblxuICAgICAgdGFibGVDbGFzc05hbWU6ICd0YWJsZSAtYm9yZGVyZWQgLWRhcmsnLFxuXG4gICAgICBpbnNlcnRUYWJsZU1heFNpemU6IHtcbiAgICAgICAgY29sOiAxMCxcbiAgICAgICAgcm93OiAxMFxuICAgICAgfSxcblxuICAgICAgZGlhbG9nc0luQm9keTogZmFsc2UsXG4gICAgICBkaWFsb2dzRmFkZTogZmFsc2UsXG5cbiAgICAgIG1heGltdW1JbWFnZUZpbGVTaXplOiBudWxsLFxuXG4gICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgb25Jbml0OiBudWxsLFxuICAgICAgICBvbkZvY3VzOiBudWxsLFxuICAgICAgICBvbkJsdXI6IG51bGwsXG4gICAgICAgIG9uRW50ZXI6IG51bGwsXG4gICAgICAgIG9uS2V5dXA6IG51bGwsXG4gICAgICAgIG9uS2V5ZG93bjogbnVsbCxcbiAgICAgICAgb25JbWFnZVVwbG9hZDogbnVsbCxcbiAgICAgICAgb25JbWFnZVVwbG9hZEVycm9yOiBudWxsXG4gICAgICB9LFxuXG4gICAgICBjb2RlbWlycm9yOiB7XG4gICAgICAgIG1vZGU6ICd0ZXh0L2h0bWwnLFxuICAgICAgICBodG1sTW9kZTogdHJ1ZSxcbiAgICAgICAgbGluZU51bWJlcnM6IHRydWVcbiAgICAgIH0sXG5cbiAgICAgIGtleU1hcDoge1xuICAgICAgICBwYzoge1xuICAgICAgICAgICdFTlRFUic6ICdpbnNlcnRQYXJhZ3JhcGgnLFxuICAgICAgICAgICdDVFJMK1onOiAndW5kbycsXG4gICAgICAgICAgJ0NUUkwrWSc6ICdyZWRvJyxcbiAgICAgICAgICAnVEFCJzogJ3RhYicsXG4gICAgICAgICAgJ1NISUZUK1RBQic6ICd1bnRhYicsXG4gICAgICAgICAgJ0NUUkwrQic6ICdib2xkJyxcbiAgICAgICAgICAnQ1RSTCtJJzogJ2l0YWxpYycsXG4gICAgICAgICAgJ0NUUkwrVSc6ICd1bmRlcmxpbmUnLFxuICAgICAgICAgICdDVFJMK1NISUZUK1MnOiAnc3RyaWtldGhyb3VnaCcsXG4gICAgICAgICAgJ0NUUkwrQkFDS1NMQVNIJzogJ3JlbW92ZUZvcm1hdCcsXG4gICAgICAgICAgJ0NUUkwrU0hJRlQrTCc6ICdqdXN0aWZ5TGVmdCcsXG4gICAgICAgICAgJ0NUUkwrU0hJRlQrRSc6ICdqdXN0aWZ5Q2VudGVyJyxcbiAgICAgICAgICAnQ1RSTCtTSElGVCtSJzogJ2p1c3RpZnlSaWdodCcsXG4gICAgICAgICAgJ0NUUkwrU0hJRlQrSic6ICdqdXN0aWZ5RnVsbCcsXG4gICAgICAgICAgJ0NUUkwrU0hJRlQrTlVNNyc6ICdpbnNlcnRVbm9yZGVyZWRMaXN0JyxcbiAgICAgICAgICAnQ1RSTCtTSElGVCtOVU04JzogJ2luc2VydE9yZGVyZWRMaXN0JyxcbiAgICAgICAgICAnQ1RSTCtMRUZUQlJBQ0tFVCc6ICdvdXRkZW50JyxcbiAgICAgICAgICAnQ1RSTCtSSUdIVEJSQUNLRVQnOiAnaW5kZW50JyxcbiAgICAgICAgICAnQ1RSTCtOVU0wJzogJ2Zvcm1hdFBhcmEnLFxuICAgICAgICAgICdDVFJMK05VTTEnOiAnZm9ybWF0SDEnLFxuICAgICAgICAgICdDVFJMK05VTTInOiAnZm9ybWF0SDInLFxuICAgICAgICAgICdDVFJMK05VTTMnOiAnZm9ybWF0SDMnLFxuICAgICAgICAgICdDVFJMK05VTTQnOiAnZm9ybWF0SDQnLFxuICAgICAgICAgICdDVFJMK05VTTUnOiAnZm9ybWF0SDUnLFxuICAgICAgICAgICdDVFJMK05VTTYnOiAnZm9ybWF0SDYnLFxuICAgICAgICAgICdDVFJMK0VOVEVSJzogJ2luc2VydEhvcml6b250YWxSdWxlJyxcbiAgICAgICAgICAnQ1RSTCtLJzogJ2xpbmtEaWFsb2cuc2hvdydcbiAgICAgICAgfSxcblxuICAgICAgICBtYWM6IHtcbiAgICAgICAgICAnRU5URVInOiAnaW5zZXJ0UGFyYWdyYXBoJyxcbiAgICAgICAgICAnQ01EK1onOiAndW5kbycsXG4gICAgICAgICAgJ0NNRCtTSElGVCtaJzogJ3JlZG8nLFxuICAgICAgICAgICdUQUInOiAndGFiJyxcbiAgICAgICAgICAnU0hJRlQrVEFCJzogJ3VudGFiJyxcbiAgICAgICAgICAnQ01EK0InOiAnYm9sZCcsXG4gICAgICAgICAgJ0NNRCtJJzogJ2l0YWxpYycsXG4gICAgICAgICAgJ0NNRCtVJzogJ3VuZGVybGluZScsXG4gICAgICAgICAgJ0NNRCtTSElGVCtTJzogJ3N0cmlrZXRocm91Z2gnLFxuICAgICAgICAgICdDTUQrQkFDS1NMQVNIJzogJ3JlbW92ZUZvcm1hdCcsXG4gICAgICAgICAgJ0NNRCtTSElGVCtMJzogJ2p1c3RpZnlMZWZ0JyxcbiAgICAgICAgICAnQ01EK1NISUZUK0UnOiAnanVzdGlmeUNlbnRlcicsXG4gICAgICAgICAgJ0NNRCtTSElGVCtSJzogJ2p1c3RpZnlSaWdodCcsXG4gICAgICAgICAgJ0NNRCtTSElGVCtKJzogJ2p1c3RpZnlGdWxsJyxcbiAgICAgICAgICAnQ01EK1NISUZUK05VTTcnOiAnaW5zZXJ0VW5vcmRlcmVkTGlzdCcsXG4gICAgICAgICAgJ0NNRCtTSElGVCtOVU04JzogJ2luc2VydE9yZGVyZWRMaXN0JyxcbiAgICAgICAgICAnQ01EK0xFRlRCUkFDS0VUJzogJ291dGRlbnQnLFxuICAgICAgICAgICdDTUQrUklHSFRCUkFDS0VUJzogJ2luZGVudCcsXG4gICAgICAgICAgJ0NNRCtOVU0wJzogJ2Zvcm1hdFBhcmEnLFxuICAgICAgICAgICdDTUQrTlVNMSc6ICdmb3JtYXRIMScsXG4gICAgICAgICAgJ0NNRCtOVU0yJzogJ2Zvcm1hdEgyJyxcbiAgICAgICAgICAnQ01EK05VTTMnOiAnZm9ybWF0SDMnLFxuICAgICAgICAgICdDTUQrTlVNNCc6ICdmb3JtYXRINCcsXG4gICAgICAgICAgJ0NNRCtOVU01JzogJ2Zvcm1hdEg1JyxcbiAgICAgICAgICAnQ01EK05VTTYnOiAnZm9ybWF0SDYnLFxuICAgICAgICAgICdDTUQrRU5URVInOiAnaW5zZXJ0SG9yaXpvbnRhbFJ1bGUnLFxuICAgICAgICAgICdDTUQrSyc6ICdsaW5rRGlhbG9nLnNob3cnXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpY29uczoge1xuICAgICAgICAnYWxpZ24nOiAnbm90ZS1pY29uLWFsaWduJyxcbiAgICAgICAgJ2FsaWduQ2VudGVyJzogJ25vdGUtaWNvbi1hbGlnbi1jZW50ZXInLFxuICAgICAgICAnYWxpZ25KdXN0aWZ5JzogJ25vdGUtaWNvbi1hbGlnbi1qdXN0aWZ5JyxcbiAgICAgICAgJ2FsaWduTGVmdCc6ICdub3RlLWljb24tYWxpZ24tbGVmdCcsXG4gICAgICAgICdhbGlnblJpZ2h0JzogJ25vdGUtaWNvbi1hbGlnbi1yaWdodCcsXG4gICAgICAgICdpbmRlbnQnOiAnbm90ZS1pY29uLWFsaWduLWluZGVudCcsXG4gICAgICAgICdvdXRkZW50JzogJ25vdGUtaWNvbi1hbGlnbi1vdXRkZW50JyxcbiAgICAgICAgJ2Fycm93c0FsdCc6ICdub3RlLWljb24tYXJyb3dzLWFsdCcsXG4gICAgICAgICdib2xkJzogJ25vdGUtaWNvbi1ib2xkJyxcbiAgICAgICAgJ2NhcmV0JzogJ25vdGUtaWNvbi1jYXJldCcsXG4gICAgICAgICdjaXJjbGUnOiAnbm90ZS1pY29uLWNpcmNsZScsXG4gICAgICAgICdjbG9zZSc6ICdub3RlLWljb24tY2xvc2UnLFxuICAgICAgICAnY29kZSc6ICdub3RlLWljb24tY29kZScsXG4gICAgICAgICdlcmFzZXInOiAnbm90ZS1pY29uLWVyYXNlcicsXG4gICAgICAgICdmb250JzogJ25vdGUtaWNvbi1mb250JyxcbiAgICAgICAgJ2ZyYW1lJzogJ25vdGUtaWNvbi1mcmFtZScsXG4gICAgICAgICdpdGFsaWMnOiAnbm90ZS1pY29uLWl0YWxpYycsXG4gICAgICAgICdsaW5rJzogJ25vdGUtaWNvbi1saW5rJyxcbiAgICAgICAgJ3VubGluayc6ICdub3RlLWljb24tY2hhaW4tYnJva2VuJyxcbiAgICAgICAgJ21hZ2ljJzogJ25vdGUtaWNvbi1tYWdpYycsXG4gICAgICAgICdtZW51Q2hlY2snOiAnbm90ZS1pY29uLWNoZWNrJyxcbiAgICAgICAgJ21pbnVzJzogJ25vdGUtaWNvbi1taW51cycsXG4gICAgICAgICdvcmRlcmVkbGlzdCc6ICdub3RlLWljb24tb3JkZXJlZGxpc3QnLFxuICAgICAgICAncGVuY2lsJzogJ25vdGUtaWNvbi1wZW5jaWwnLFxuICAgICAgICAncGljdHVyZSc6ICdub3RlLWljb24tcGljdHVyZScsXG4gICAgICAgICdxdWVzdGlvbic6ICdub3RlLWljb24tcXVlc3Rpb24nLFxuICAgICAgICAncmVkbyc6ICdub3RlLWljb24tcmVkbycsXG4gICAgICAgICdzcXVhcmUnOiAnbm90ZS1pY29uLXNxdWFyZScsXG4gICAgICAgICdzdHJpa2V0aHJvdWdoJzogJ25vdGUtaWNvbi1zdHJpa2V0aHJvdWdoJyxcbiAgICAgICAgJ3N1YnNjcmlwdCc6ICdub3RlLWljb24tc3Vic2NyaXB0JyxcbiAgICAgICAgJ3N1cGVyc2NyaXB0JzogJ25vdGUtaWNvbi1zdXBlcnNjcmlwdCcsXG4gICAgICAgICd0YWJsZSc6ICdub3RlLWljb24tdGFibGUnLFxuICAgICAgICAndGV4dEhlaWdodCc6ICdub3RlLWljb24tdGV4dC1oZWlnaHQnLFxuICAgICAgICAndHJhc2gnOiAnbm90ZS1pY29uLXRyYXNoJyxcbiAgICAgICAgJ3VuZGVybGluZSc6ICdub3RlLWljb24tdW5kZXJsaW5lJyxcbiAgICAgICAgJ3VuZG8nOiAnbm90ZS1pY29uLXVuZG8nLFxuICAgICAgICAndW5vcmRlcmVkbGlzdCc6ICdub3RlLWljb24tdW5vcmRlcmVkbGlzdCcsXG4gICAgICAgICd2aWRlbyc6ICdub3RlLWljb24tdmlkZW8nXG4gICAgICB9XG4gICAgfVxuICB9KTtcblxufSkpO1xuIl19"}